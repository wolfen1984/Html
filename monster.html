<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Monster Hunt</title>
<style>
:root {
--red: #ff0000;
--green: #00ff00;
--yellow: #ffff00;
--blue: #5555ff;
--dark-bg: #0a0a0a;
--light-bg: #111;
--border: #333;
}

* {
box-sizing: border-box;
}

body {
margin: 0;
padding: 0;
background-color: var(--dark-bg);
color: #fff;
font-family: 'Courier New', monospace;
touch-action: manipulation;
overflow: hidden;
user-select: none;
-webkit-user-select: none;
height: 100vh;
width: 100vw;
}

#game-container {
width: 100%;
height: 100%;
position: relative;
display: flex;
flex-direction: column;
max-width: 600px;
margin: 0 auto;
}

#header {
text-align: center;
padding: 10px;
border-bottom: 1px solid var(--red);
background-color: rgba(0,0,0,0.7);
}

#game-title {
font-size: 2rem;
color: var(--red);
text-shadow: 0 0 10px var(--red), 0 0 20px var(--red);
margin: 5px 0;
letter-spacing: 2px;
font-weight: bold;
}

#player-info {
display: flex;
justify-content: space-between;
padding: 8px 10px;
border-bottom: 1px solid var(--border);
font-size: 0.9rem;
background-color: rgba(0,0,0,0.5);
}

#main-display {
flex-grow: 1;
padding: 15px;
overflow-y: auto;
line-height: 1.5;
font-size: 1rem;
background-color: rgba(0,0,0,0.3);
}

#controls {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 8px;
padding: 10px;
border-top: 1px solid var(--border);
background-color: rgba(0,0,0,0.7);
}

.btn {
background-color: var(--light-bg);
color: #fff;
border: 1px solid var(--red);
padding: 12px 5px;
text-align: center;
border-radius: 5px;
font-family: inherit;
font-size: 0.95rem;
transition: all 0.2s;
}

.btn:active {
transform: scale(0.98);
background-color: #222;
}

.btn-red {
color: var(--red);
font-weight: bold;
}

#action-buttons {
display: grid;
grid-template-columns: 1fr 1fr 1fr;
gap: 8px;
padding: 8px 10px;
background-color: rgba(0,0,0,0.7);
}

/* Window styles */
.window {
display: none;
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-color: rgba(0, 0, 0, 0.95);
padding: 20px;
overflow-y: auto;
z-index: 100;
}

.window-content {
max-width: 500px;
margin: 0 auto;
}

.close-btn {
position: absolute;
top: 15px;
right: 15px;
color: var(--red);
font-weight: bold;
font-size: 1.2rem;
padding: 5px 10px;
border: 1px solid var(--red);
border-radius: 3px;
}

/* Option styles */
.option {
margin: 12px 0;
padding: 12px;
border: 1px solid var(--red);
border-radius: 5px;
transition: all 0.2s;
}

.option:active {
background-color: #222;
}

.item-option {
border-color: var(--green);
}

.location-option {
border-color: var(--blue);
}

.shop-option {
border-color: var(--red);
}

/* Progress bars */
progress {
width: 100%;
height: 12px;
border-radius: 6px;
overflow: hidden;
}

progress::-webkit-progress-value {
background: var(--red);
border-radius: 6px;
}

progress::-webkit-progress-bar {
background: var(--border);
border-radius: 6px;
}

/* Special text colors */
.location {
color: var(--blue);
font-weight: bold;
}

.item {
color: var(--green);
}

.npc {
color: var(--yellow);
}

.enemy {
color: var(--red);
font-weight: bold;
}

.success {
color: var(--green);
}

.warning {
color: var(--yellow);
}

.danger {
color: var(--red);
}

/* Case files */
.case-file {
margin: 15px 0;
padding: 15px;
border: 1px solid var(--border);
border-radius: 5px;
background-color: rgba(20,20,20,0.7);
}

.case-file h3 {
margin-top: 0;
color: var(--red);
}

/* Combat log */
#combat-log {
max-height: 150px;
overflow-y: auto;
padding: 10px;
background-color: rgba(0,0,0,0.5);
border-radius: 5px;
margin-top: 15px;
}

/* Stats sections */
.stats-section {
margin-bottom: 20px;
padding-bottom: 15px;
border-bottom: 1px solid var(--border);
}

/* Shop items */
.shop-item {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 10px;
padding: 10px;
border: 1px solid var(--red);
border-radius: 5px;
}

.shop-item-info {
flex-grow: 1;
}

.shop-item-price {
color: var(--yellow);
font-weight: bold;
margin-left: 10px;
white-space: nowrap;
}

/* Animations */
@keyframes pulse {
0% { opacity: 0.6; }
50% { opacity: 1; }
100% { opacity: 0.6; }
}

.pulse {
animation: pulse 1.5s infinite;
}

/* Responsive adjustments */
@media (max-height: 700px) {
#main-display {
font-size: 0.9rem;
padding: 10px;
}

.btn {
padding: 10px 5px;
font-size: 0.9rem;
}

.case-file {
padding: 10px;
margin: 10px 0;
}
}
</style>
</head>
<body>
<div id="game-container">
<div id="header">
<div id="game-title">MONSTER HUNT</div>
<div>Agent McCracken</div>
</div>

<div id="player-info">
<div>HP: <span id="hp-display">100/100</span></div>
<div>Level: <span id="level-display">1</span></div>
<div>XP: <span id="xp-display">0/100</span></div>
<div>Money: $<span id="money-display">500</span></div>
<div>Rep: <span id="rep-display">0</span></div>
</div>

<div id="main-display">
<p>October 31, 1993</p>
<p>The phone rings in your small, cluttered office. Another case file lands on your desk.</p>
<p>Another monster to hunt.</p>
<p>Another truth to uncover.</p>
<p>They call you when they don't know who else to call.</p>
<p>They call you when the official story doesn't add up.</p>
<p>They call you when something... unnatural is at work.</p>
<p>You are Agent McCracken, private investigator specializing in cryptozoology and paranormal phenomena.</p>
<p>The truth is out there. Time to find it.</p>
</div>

<div id="action-buttons">
<button class="btn btn-red" onclick="openInventory()">INVENTORY</button>
<button class="btn btn-red" onclick="openCaseFiles()">CASE FILES</button>
<button class="btn btn-red" onclick="openStats()">STATS</button>
</div>

<div id="controls">
<button class="btn" onclick="move('investigate')">INVESTIGATE</button>
<button class="btn" onclick="move('talk')">TALK</button>
<button class="btn" onclick="move('use')">USE ITEM</button>
<button class="btn" onclick="move('travel')">TRAVEL</button>
</div>

<!-- Inventory Window -->
<div id="inventory-window" class="window">
<div class="window-content">
<h2>INVENTORY</h2>
<div id="inventory-items"></div>
</div>
<div class="close-btn" onclick="closeWindows()">✕</div>
</div>

<!-- Case Files Window -->
<div id="casefiles-window" class="window">
<div class="window-content">
<h2>CASE FILES</h2>
<div id="case-files">
<!-- Original 4 cases -->
<div class="case-file" onclick="selectCase('lochness')">
<h3>Case #042: Loch Ness Monster</h3>
<p>Scotland | Active since 1933</p>
<p class="pulse">Status: <span id="lochness-status">UNINVESTIGATED</span></p>
</div>
<div class="case-file" onclick="selectCase('mothman')">
<h3>Case #137: Mothman</h3>
<p>Point Pleasant, WV | Active since 1966</p>
<p class="pulse">Status: <span id="mothman-status">UNINVESTIGATED</span></p>
</div>
<div class="case-file" onclick="selectCase('bigfoot')">
<h3>Case #209: Bigfoot</h3>
<p>Pacific Northwest | Active since 1958</p>
<p class="pulse">Status: <span id="bigfoot-status">UNINVESTIGATED</span></p>
</div>
<div class="case-file" onclick="selectCase('swampbeast')">
<h3>Case #315: Swamp Beast</h3>
<p>Louisiana Bayou | Active since 1982</p>
<p class="pulse">Status: <span id="swampbeast-status">UNINVESTIGATED</span></p>
</div>

<!-- New Cases -->
<div class="case-file" onclick="selectCase('yeti')">
<h3>Case #418: Abominable Snowman</h3>
<p>Himalayas | Active since 1921</p>
<p class="pulse">Status: <span id="yeti-status">UNINVESTIGATED</span></p>
</div>
<div class="case-file" onclick="selectCase('sewergators')">
<h3>Case #523: Sewer Gators</h3>
<p>New York City | Active since 1935</p>
<p class="pulse">Status: <span id="sewergators-status">UNINVESTIGATED</span></p>
</div>
<div class="case-file" onclick="selectCase('jerseydevil')">
<h3>Case #629: Jersey Devil</h3>
<p>Pine Barrens, NJ | Active since 1735</p>
<p class="pulse">Status: <span id="jerseydevil-status">UNINVESTIGATED</span></p>
</div>
<div class="case-file" onclick="selectCase('deathworm')">
<h3>Case #734: Mongolian Death Worm</h3>
<p>Gobi Desert | Active since 1926</p>
<p class="pulse">Status: <span id="deathworm-status">UNINVESTIGATED</span></p>
</div>
</div>
</div>
<div class="close-btn" onclick="closeWindows()">✕</div>
</div>

<!-- Stats Window -->
<div id="stats-window" class="window">
<div class="window-content">
<h2>AGENT McCRACKEN</h2>
<div class="stats-section">
<h3>VITAL STATS</h3>
<p>Level: <span id="stat-level">1</span></p>
<p>XP: <span id="stat-xp">0</span>/<span id="stat-next-level">100</span></p>
<p>HP: <span id="stat-hp">100</span>/<span id="stat-maxhp">100</span></p>
<p>Money: $<span id="stat-money">500</span></p>
<p>Reputation: <span id="stat-reputation">0</span></p>
</div>

<div class="stats-section">
<h3>ABILITIES</h3>
<p>Investigation: <span id="stat-investigation">5</span></p>
<p>Stealth: <span id="stat-stealth">3</span></p>
<p>Combat: <span id="stat-combat">4</span></p>
<p>Persuasion: <span id="stat-persuasion">2</span></p>
<p>Luck: <span id="stat-luck">1</span></p>
<p>Survival: <span id="stat-survival">2</span></p>
</div>

<div class="stats-section">
<h3>EQUIPMENT</h3>
<div id="stat-weapons">
<p>• <span id="equip-weapon">Tranquilizer Gun</span></p>
<p>• <span id="equip-armor">None</span></p>
<p>• <span id="equip-accessory">None</span></p>
</div>
</div>

<div class="stats-section">
<h3>GAME</h3>
<div class="option" onclick="saveGame()">SAVE GAME</div>
<div class="option" onclick="loadGame()">LOAD GAME</div>
<div class="option shop-option" onclick="openShop()">VISIT SHOP</div>
</div>
</div>
<div class="close-btn" onclick="closeWindows()">✕</div>
</div>

<!-- Combat Window -->
<div id="combat-window" class="window">
<div class="window-content">
<h2>ENCOUNTER</h2>

<div id="combat-enemy">
<p class="enemy" id="enemy-name">ENEMY</p>
<progress id="enemy-hp-bar" value="100" max="100"></progress>
<p>HP: <span id="enemy-hp">100</span>/<span id="enemy-maxhp">100</span></p>
</div>

<div id="combat-player">
<p>AGENT McCRACKEN</p>
<progress id="player-hp-bar" value="100" max="100"></progress>
<p>HP: <span id="player-hp">100</span>/<span id="player-maxhp">100</span></p>
</div>

<div id="combat-options">
<div class="option" onclick="combatAction('shoot')">
<strong>SHOOT</strong><br>
<small>Tranquilizer Gun (15-25 damage)</small>
</div>
<div class="option" onclick="combatAction('knife')">
<strong>STAB</strong><br>
<small>Combat Knife (8-15 damage)</small>
</div>
<div class="option" onclick="combatAction('item')">
<strong>USE ITEM</strong><br>
<small>Select from inventory</small>
</div>
<div class="option danger" onclick="combatAction('flee')">
<strong>FLEE</strong><br>
<small>Attempt to escape</small>
</div>
</div>

<div id="combat-log"></div>
</div>
<div class="close-btn" onclick="endCombat()">✕ FLEE</div>
</div>

<!-- Combat Items Window -->
<div id="combat-items-window" class="window">
<div class="window-content">
<h2>SELECT ITEM</h2>
<div id="combat-items-list"></div>
</div>
<div class="close-btn" onclick="closeCombatItems()">✕ CANCEL</div>
</div>

<!-- Travel Window -->
<div id="travel-window" class="window">
<div class="window-content">
<h2>TRAVEL</h2>
<div id="travel-options"></div>
</div>
<div class="close-btn" onclick="closeTravel()">✕ CANCEL</div>
</div>

<!-- Shop Window -->
<div id="shop-window" class="window">
<div class="window-content">
<h2>EQUIPMENT SHOP</h2>
<p>Money: $<span id="shop-money">500</span></p>
<div id="shop-items">
<!-- Items will be populated here -->
</div>
</div>
<div class="close-btn" onclick="closeShop()">✕ CLOSE</div>
</div>

<!-- Notification System -->
<div id="notification" style="display:none; position:fixed; top:20px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.8); padding:10px 20px; border:1px solid var(--red); border-radius:5px; z-index:1000;"></div>
</div>

<script>
// Enhanced Game State with 8 cases
const gameState = {
currentLocation: 'office',
currentCase: null,
hp: 100,
maxHp: 100,
level: 1,
xp: 0,
xpToNextLevel: 100,
money: 500,
inventory: [
{name: "Flashlight", type: "tool", uses: -1},
{name: "Camera", type: "tool", uses: -1},
{name: "Voice Recorder", type: "tool", uses: -1},
{name: "First Aid Kit", type: "medical", uses: 4},
{name: "Tranquilizer Gun", type: "weapon", uses: -1},
{name: "Combat Knife", type: "weapon", uses: -1},
{name: "Tranquilizer Dart", type: "ammo", uses: 2},
{name: "Flare", type: "tool", uses: 1},
{name: "Night Vision Goggles", type: "equipment", uses: -1},
{name: "Thermal Camera", type: "equipment", uses: -1},
{name: "Gas Mask", type: "equipment", uses: -1}
],
equipment: {
weapon: "Tranquilizer Gun",
armor: null,
accessory: null
},
caseFiles: {
lochness: {
title: "Loch Ness Monster",
location: "Scotland",
status: "unstarted",
clues: 0,
maxClues: 5,
enemyHp: 120,
enemyMaxHp: 120,
enemyAttack: [10, 20],
locations: [
{name: "Local Village", description: "The small Scottish village is quiet, but the locals eye you suspiciously. Someone here must know something about the creature in the loch.", clues: 2},
{name: "Loch Shore", description: "The mist hangs low over the dark waters of Loch Ness. The air is unnaturally still. Perfect conditions for investigation.", clues: 2},
{name: "Castle Ruins", description: "The ancient ruins overlook the loch. Local legends say this was once a vantage point for spotting the monster centuries ago.", clues: 1}
]
},
mothman: {
title: "Mothman",
location: "Point Pleasant, WV",
status: "unstarted",
clues: 0,
maxClues: 5,
enemyHp: 100,
enemyMaxHp: 100,
enemyAttack: [15, 25],
locations: [
{name: "Town Square", description: "Point Pleasant's town square seems normal by day, but the locals whisper about strange sightings. The statue of the Mothman watches over the area.", clues: 1},
{name: "Abandoned Factory", description: "The abandoned factory creaks in the wind. Reports say this is where most of the recent sightings have occurred.", clues: 3},
{name: "TNT Area", description: "The restricted TNT area is eerily quiet. This is where the original Mothman sightings preceded the bridge collapse in 1967.", clues: 1}
]
},
bigfoot: {
title: "Bigfoot",
location: "Pacific Northwest",
status: "unstarted",
clues: 0,
maxClues: 5,
enemyHp: 150,
enemyMaxHp: 150,
enemyAttack: [20, 30],
locations: [
{name: "Ranger Station", description: "The forest ranger station is your best source for local information. The rangers seem nervous when you mention unusual activity.", clues: 1},
{name: "Deep Woods", description: "You venture deep into the Pacific Northwest forests. The trees tower overhead, blocking out much of the sunlight. Perfect habitat for a large, elusive creature.", clues: 3},
{name: "Mountain Cave", description: "The mountain cave system is rumored to be home to the creature. Strange noises echo from within the dark openings.", clues: 1}
]
},
swampbeast: {
title: "Swamp Beast",
location: "Louisiana Bayou",
status: "unstarted",
clues: 0,
maxClues: 5,
enemyHp: 110,
enemyMaxHp: 110,
enemyAttack: [12, 22],
locations: [
{name: "Fishing Village", description: "The small fishing village sits on the edge of the bayou. The locals speak in hushed tones about something in the swamp.", clues: 1},
{name: "Swamp Shack", description: "An abandoned shack in the middle of the swamp. Recent reports suggest this is where the creature has been seen most frequently.", clues: 2},
{name: "Alligator Pond", description: "A dangerous area of the swamp where even alligators avoid. The water here is unnaturally still, with strange ripples moving against the current.", clues: 2}
]
},
yeti: {
title: "Abominable Snowman",
location: "Himalayas",
status: "unstarted",
clues: 0,
maxClues: 5,
enemyHp: 140,
enemyMaxHp: 140,
enemyAttack: [18, 28],
locations: [
{name: "Base Camp", description: "The mountaineer base camp is abuzz with rumors of strange tracks above the snow line.", clues: 1},
{name: "Monastery", description: "Ancient Buddhist monks speak of a 'migoi' that protects the mountains.", clues: 2},
{name: "High Pass", description: "A treacherous mountain pass where several climbers have reported encounters.", clues: 2}
]
},
sewergators: {
title: "Sewer Gators",
location: "New York City",
status: "unstarted",
clues: 0,
maxClues: 5,
enemyHp: 90,
enemyMaxHp: 90,
enemyAttack: [10, 20],
locations: [
{name: "Subway Tunnels", description: "The labyrinthine tunnels beneath the city where maintenance workers report sightings.", clues: 2},
{name: "Storm Drains", description: "Massive drainage systems where unusual reptilian sounds echo.", clues: 2},
{name: "Abandoned Station", description: "A sealed-off subway station with reports of large, scaly inhabitants.", clues: 1}
]
},
jerseydevil: {
title: "Jersey Devil",
location: "Pine Barrens, NJ",
status: "unstarted",
clues: 0,
maxClues: 5,
enemyHp: 110,
enemyMaxHp: 110,
enemyAttack: [15, 25],
locations: [
{name: "Leeds Point", description: "The birthplace of the legend, where the creature was supposedly born in 1735.", clues: 1},
{name: "Abandoned Sawmill", description: "An old lumber operation where the devil was said to have been sighted for centuries.", clues: 2},
{name: "Devil's Den", description: "A remote area of the pine barrens avoided by locals for generations.", clues: 2}
]
},
deathworm: {
title: "Mongolian Death Worm",
location: "Gobi Desert",
status: "unstarted",
clues: 0,
maxClues: 5,
enemyHp: 130,
enemyMaxHp: 130,
enemyAttack: [20, 35],
locations: [
{name: "Nomad Camp", description: "Mongolian herders share tales of the allghoi khorkhoi that burrows beneath the sands.", clues: 2},
{name: "Sand Dunes", description: "Vast dunes where the creature is said to surface during rare rains.", clues: 2},
{name: "Ancient Ruins", description: "Petroglyphs depict a giant worm-like creature dating back centuries.", clues: 1}
]
}
},
stats: {
investigation: 5,
stealth: 3,
combat: 4,
persuasion: 2,
luck: 1,
survival: 2
},
inCombat: false,
currentEnemy: null,
gameTime: 0,
reputation: 0
};

// Shop Items
const shopItems = [
{name: "First Aid Kit", type: "medical", price: 100, uses: 3, description: "Restores 25-35 HP. Can be used 3 times."},
{name: "Tranquilizer Dart", type: "ammo", price: 50, uses: 2, description: "Ammo for Tranquilizer Gun. 2 darts per purchase."},
{name: "Flare", type: "tool", price: 75, uses: 1, description: "Stuns creatures temporarily. Single use."},
{name: "Combat Knife", type: "weapon", price: 150, uses: -1, description: "Basic melee weapon. 8-15 damage."},
{name: "Kevlar Vest", type: "armor", price: 250, uses: -1, description: "Reduces damage taken by 15%."},
{name: "Lucky Charm", type: "accessory", price: 200, uses: -1, description: "Increases luck by 2 points."},
{name: "Advanced Camera", type: "equipment", price: 300, uses: -1, description: "Increases investigation skill by 1."},
{name: "Stealth Boots", type: "equipment", price: 350, uses: -1, description: "Increases stealth skill by 1."}
];

// Case Descriptions
const caseDescriptions = {
lochness: "The Loch Ness Monster, or 'Nessie', is a cryptid reputed to inhabit Loch Ness in the Scottish Highlands. First modern sighting in 1933. Numerous sonar contacts and disputed photographs exist. Some theorize it's a surviving plesiosaur, others suggest more supernatural origins.",
mothman: "The Mothman is a humanoid creature reportedly seen in the Point Pleasant area from 1966-1967. Described as a large winged man with glowing red eyes. Often associated with impending disaster. Sightings continue to this day despite official denials.",
bigfoot: "Bigfoot, also known as Sasquatch, is an ape-like creature said to inhabit forests of North America. Hundreds of sightings, footprint casts, and blurry photographs exist. Some Native American tribes have legends of similar creatures long before European contact.",
swampbeast: "The Louisiana Swamp Beast is a humanoid creature reported in the bayous since 1982. Described as tall, covered in algae and moss, with glowing yellow eyes. Local legends speak of a cursed trapper or something more ancient lurking in the swamps.",
yeti: "The Abominable Snowman, or Yeti, is an ape-like entity said to inhabit the Himalayan mountain range. Reports date back to 1921, with indigenous Sherpas describing a large, hairy creature that leaves massive footprints in the snow.",
sewergators: "Urban legends speak of alligators living in the sewers beneath major cities, descendants of pets flushed down toilets that grew to enormous size in the labyrinthine tunnels. The most persistent reports come from New York City's underground.",
jerseydevil: "The Jersey Devil is a legendary creature said to inhabit the Pine Barrens of New Jersey. According to folklore, it was the cursed thirteenth child of Mother Leeds in 1735, with bat-like wings, a goat's head, and hooves.",
deathworm: "The Mongolian Death Worm, or allghoi khorkhoi, is said to inhabit the Gobi Desert. Locals describe a bright red worm-like creature 2-5 feet long that can spit corrosive venom and generate electric shocks to kill prey."
};

// Clue Texts
const clueTexts = {
lochness: [
"You discover strange sonar readings that show a large, moving object deep in the loch.",
"A local fisherman shares a photograph of an unusual wake pattern in the water.",
"You collect a scale sample that defies classification by your contacts at the university."
],
mothman: [
"A witness describes the creature's eerie glowing eyes and the sense of dread it brings.",
"You find strange feather-like fibers near the abandoned factory.",
"An old newspaper clipping details the 1967 bridge collapse and its connection to the sightings."
],
bigfoot: [
"You find a massive footprint cast that matches no known animal in the region.",
"Hair samples collected from a tree rubbing don't match any local wildlife.",
"A night camera trap captures a large, bipedal figure moving through the trees."
],
swampbeast: [
"You uncover reports of missing livestock with unusual bite patterns.",
"Strange noises were recorded coming from the swamp at night - deep guttural growls.",
"A local trapper shows you strange three-toed tracks near the alligator pond."
],
yeti: [
"You find enormous footprints in the snow that match no known animal.",
"A sherpa guide shows you strange tufts of reddish-brown hair caught on a rocky outcrop.",
"High-altitude audio recordings capture deep, guttural vocalizations unlike any known wildlife."
],
sewergators: [
"Maintenance workers share blurry photos of large reptilian eyes reflecting in tunnel darkness.",
"You discover unusual scratch marks on concrete walls at precise alligator height.",
"A retired sanitation worker confides about finding large, fresh eggshells in a drainage chamber."
],
jerseydevil: [
"Local farmers show you mutilated livestock with unusual puncture wounds.",
"You record eerie, high-pitched screeches that match historical descriptions of the creature's cry.",
"A park ranger shares thermal images of an unidentified flying creature with an unusual heat signature."
],
deathworm: [
"Nomads show you strange, tunnel-like depressions in the sand that appear overnight.",
"You collect samples of a strange, corrosive substance found near attack sites.",
"Ancient manuscripts describe encounters with a 'blood-colored worm' that matches modern reports."
]
};

// Attack Descriptions
const attackDescriptions = {
lochness: [
"The creature's massive tail slams into you!",
"It rears up and crashes down on you with terrifying force!",
"The beast rams you with its enormous bulk!"
],
mothman: [
"The Mothman swoops down, slashing at you with clawed hands!",
"Its glowing eyes seem to paralyze you as it strikes!",
"The creature emits a piercing shriek that disorients you before attacking!"
],
bigfoot: [
"The massive creature punches you with incredible strength!",
"It grabs you and hurls you against a tree!",
"Bigfoot roars and charges, slamming into you!"
],
swampbeast: [
"The Swamp Beast swings its algae-covered limbs at you!",
"It grabs you with its webbed hands and squeezes painfully!",
"The creature lets out a guttural roar before attacking!"
],
yeti: [
"The massive yeti swings its powerful arms, striking you with bone-jarring force!",
"It picks up a boulder and hurls it at you with terrifying accuracy!",
"The creature lets out a thunderous roar before charging directly at you!"
],
sewergators: [
"The enormous gator snaps its jaws shut just inches from your leg!",
"Its powerful tail whips around, slamming into you with crushing force!",
"The creature rolls violently, trying to drag you into the filthy water!"
],
jerseydevil: [
"The winged horror swoops down, slashing at you with its clawed hands!",
"It emits an ear-piercing shriek that disorients you before attacking!",
"The devil suddenly appears from the darkness, striking with terrifying speed!"
],
deathworm: [
"The worm rears up and spits a stream of corrosive venom at you!",
"It suddenly bursts from the sand beneath you, knocking you violently aside!",
"You feel a strange tingling just before the creature delivers an electric shock!"
]
};

// Combat Intro Texts
const introTexts = {
lochness: "The waters churn violently as a massive shape emerges from the depths of Loch Ness!",
mothman: "A shadow detaches from the darkness - glowing red eyes fix on you as the Mothman swoops down!",
bigfoot: "The trees shake as a massive, hairy humanoid crashes through the foliage toward you!",
swampbeast: "The swamp water erupts as a grotesque humanoid covered in algae rises before you!",
yeti: "A thunderous roar echoes through the mountains as a massive white-furred creature charges at you!",
sewergators: "The murky water explodes as a gigantic alligator with milky-white eyes lunges from the depths!",
jerseydevil: "An unearthly shriek pierces the night as the winged Jersey Devil swoops down upon you!",
deathworm: "The sand erupts violently as a thick, blood-red worm the size of a man emerges with shocking speed!"
};

// Notification System
function showNotification(message, type = 'normal') {
const notification = document.getElementById('notification');
notification.textContent = message;
notification.style.display = 'block';
notification.style.borderColor = type === 'success' ? 'var(--yellow)' :
type === 'warning' ? 'var(--yellow)' :
type === 'danger' ? 'var(--red)' : 'var(--border)';

setTimeout(() => {
notification.style.display = 'none';
}, 3000);
}

// UI Functions
function updateUI() {
document.getElementById('hp-display').textContent = `${gameState.hp}/${gameState.maxHp}`;
document.getElementById('level-display').textContent = gameState.level;
document.getElementById('xp-display').textContent = `${gameState.xp}/${gameState.xpToNextLevel}`;
document.getElementById('money-display').textContent = gameState.money;
document.getElementById('rep-display').textContent = gameState.reputation;

// Stats window
document.getElementById('stat-level').textContent = gameState.level;
document.getElementById('stat-xp').textContent = gameState.xp;
document.getElementById('stat-next-level').textContent = gameState.xpToNextLevel;
document.getElementById('stat-hp').textContent = gameState.hp;
document.getElementById('stat-maxhp').textContent = gameState.maxHp;
document.getElementById('stat-money').textContent = gameState.money;
document.getElementById('stat-reputation').textContent = gameState.reputation;
document.getElementById('stat-investigation').textContent = gameState.stats.investigation;
document.getElementById('stat-stealth').textContent = gameState.stats.stealth;
document.getElementById('stat-combat').textContent = gameState.stats.combat;
document.getElementById('stat-persuasion').textContent = gameState.stats.persuasion;
document.getElementById('stat-luck').textContent = gameState.stats.luck;
document.getElementById('stat-survival').textContent = gameState.stats.survival;

// Equipment
document.getElementById('equip-weapon').textContent = gameState.equipment.weapon || "None";
document.getElementById('equip-armor').textContent = gameState.equipment.armor || "None";
document.getElementById('equip-accessory').textContent = gameState.equipment.accessory || "None";

// Update case file statuses
for (const caseId in gameState.caseFiles) {
const statusElement = document.getElementById(`${caseId}-status`);
if (statusElement) {
statusElement.textContent = gameState.caseFiles[caseId].status.toUpperCase();
statusElement.className = gameState.caseFiles[caseId].status === 'completed' ? 'success' :
gameState.caseFiles[caseId].status === 'in progress' ? 'warning' : '';
}
}
}

function displayText(text, append = false) {
const mainDisplay = document.getElementById('main-display');

if (!append) {
mainDisplay.innerHTML = '';
}

// Split text into paragraphs if there are line breaks
const paragraphs = text.split('\n');
paragraphs.forEach(paragraph => {
if (paragraph.trim() !== '') {
const p = document.createElement('p');
p.textContent = paragraph;
mainDisplay.appendChild(p);
}
});

mainDisplay.scrollTop = mainDisplay.scrollHeight;
}

function openInventory() {
document.getElementById('inventory-window').style.display = 'block';
const inventoryItems = document.getElementById('inventory-items');
inventoryItems.innerHTML = '';

// Group items by type
const itemsByType = {};
gameState.inventory.forEach(item => {
if (!itemsByType[item.type]) {
itemsByType[item.type] = [];
}
itemsByType[item.type].push(item);
});

// Display items by category
for (const type in itemsByType) {
const typeHeader = document.createElement('h3');
typeHeader.textContent = type.toUpperCase();
inventoryItems.appendChild(typeHeader);

itemsByType[type].forEach(item => {
const div = document.createElement('div');
div.className = 'option';

let itemText = item.name;
if (item.uses > 0) {
itemText += ` (${item.uses} uses)`;
} else if (item.uses === 0) {
itemText += ` (EMPTY)`;
}

div.textContent = itemText;
div.onclick = function() { useInventoryItem(item); };
inventoryItems.appendChild(div);
});
}
}

function useInventoryItem(item) {
if (item.name === "First Aid Kit") {
const healAmount = 25 + Math.floor(Math.random() * 10);
gameState.hp = Math.min(gameState.hp + healAmount, gameState.maxHp);

// Reduce uses
const inventoryItem = gameState.inventory.find(i => i.name === item.name);
if (inventoryItem.uses > 0) {
inventoryItem.uses--;
if (inventoryItem.uses === 0) {
// Remove if no uses left
gameState.inventory = gameState.inventory.filter(i => i !== inventoryItem);
}
}

displayText(`You use a First Aid Kit, healing ${healAmount} HP!`, true);
showNotification(`Healed ${healAmount} HP!`, 'success');
updateUI();
} else {
displayText(`You can't use ${item.name} right now.`, true);
showNotification(`Can't use ${item.name} now`, 'warning');
}
}

function openCaseFiles() {
document.getElementById('casefiles-window').style.display = 'block';
}

function openStats() {
document.getElementById('stats-window').style.display = 'block';
}

function openShop() {
document.getElementById('shop-window').style.display = 'block';
document.getElementById('shop-money').textContent = gameState.money;
const shopItemsList = document.getElementById('shop-items');
shopItemsList.innerHTML = '';

shopItems.forEach(item => {
const div = document.createElement('div');
div.className = 'shop-item';

const infoDiv = document.createElement('div');
infoDiv.className = 'shop-item-info';
infoDiv.innerHTML = `<strong>${item.name}</strong><br><small>${item.description}</small>`;

const priceDiv = document.createElement('div');
priceDiv.className = 'shop-item-price';
priceDiv.textContent = `$${item.price}`;

const buyBtn = document.createElement('button');
buyBtn.className = 'btn';
buyBtn.textContent = 'BUY';
buyBtn.onclick = function() { buyItem(item); };

div.appendChild(infoDiv);
div.appendChild(priceDiv);
div.appendChild(buyBtn);
shopItemsList.appendChild(div);
});
}

function closeShop() {
document.getElementById('shop-window').style.display = 'none';
}

function buyItem(item) {
if (gameState.money >= item.price) {
gameState.money -= item.price;

// Add to inventory
const existingItem = gameState.inventory.find(i => i.name === item.name);
if (existingItem && item.uses > 0) {
existingItem.uses += item.uses;
} else {
gameState.inventory.push({
name: item.name,
type: item.type,
uses: item.uses
});
}

// Special equipment effects
if (item.name === "Kevlar Vest") {
gameState.equipment.armor = item.name;
} else if (item.name === "Lucky Charm") {
gameState.equipment.accessory = item.name;
gameState.stats.luck += 2;
} else if (item.name === "Advanced Camera") {
gameState.stats.investigation += 1;
} else if (item.name === "Stealth Boots") {
gameState.stats.stealth += 1;
}

showNotification(`Purchased ${item.name}!`, 'success');
document.getElementById('shop-money').textContent = gameState.money;
updateUI();
} else {
showNotification("Not enough money!", 'warning');
}
}

function closeWindows() {
document.querySelectorAll('.window').forEach(window => {
window.style.display = 'none';
});
}

function selectCase(caseId) {
gameState.currentCase = caseId;
gameState.caseFiles[caseId].status = 'in progress';

let caseText = `CASE FILE: ${gameState.caseFiles[caseId].title}\n`;
caseText += `LOCATION: ${gameState.caseFiles[caseId].location}\n\n`;
caseText += caseDescriptions[caseId];

displayText(caseText);
updateUI();
closeWindows();
showNotification(`Case selected: ${gameState.caseFiles[caseId].title}`, 'success');
}

// Travel Functions
function openTravel() {
document.getElementById('travel-window').style.display = 'block';
const travelOptions = document.getElementById('travel-options');
travelOptions.innerHTML = '';

// Always show return to office option
const officeOption = document.createElement('div');
officeOption.className = 'option location-option';
officeOption.innerHTML = `<strong>Return to Office</strong><br><small>Your base of operations</small>`;
officeOption.onclick = function() { travelTo('office'); };
travelOptions.appendChild(officeOption);

if (gameState.currentCase) {
const currentCase = gameState.caseFiles[gameState.currentCase];

// Show case-specific locations
currentCase.locations.forEach(location => {
const locOption = document.createElement('div');
locOption.className = 'option location-option';

let cluesText = '';
if (location.clues > 0) {
cluesText = `<br><small>Potential clues: ${location.clues}</small>`;
}

locOption.innerHTML = `<strong>${location.name}</strong>${cluesText}`;
locOption.onclick = function() {
travelTo(location.name.toLowerCase().replace(' ', '-'));
};
travelOptions.appendChild(locOption);
});

// Show confront option if all clues found
if (currentCase.clues >= currentCase.maxClues) {
const confrontOption = document.createElement('div');
confrontOption.className = 'option danger';
confrontOption.innerHTML = `<strong> the ${currentCase.title}</strong><br><small>Final showdown</small>`;
confrontOption.onclick = function() { confrontCreature(); };
travelOptions.appendChild(confrontOption);
}
}
}

function closeTravel() {
document.getElementById('travel-window').style.display = 'none';
}

function travelTo(location) {
gameState.currentLocation = location;
closeTravel();

let locationText = '';
if (location === 'office') {
locationText = "You return to your dusty office. Case files and newspaper clippings cover every surface.\n\n";
locationText += "The flickering neon sign outside casts an eerie glow through the blinds.";
showNotification("Returned to office", 'success');
} else if (gameState.currentCase) {
const currentCase = gameState.caseFiles[gameState.currentCase];
const locationData = currentCase.locations.find(loc =>
loc.name.toLowerCase().replace(' ', '-') === location);

if (locationData) {
locationText = `You arrive at ${locationData.name} in ${currentCase.location}.\n\n`;
locationText += locationData.description;
showNotification(`Arrived at ${locationData.name}`, 'success');
}
}

displayText(locationText);
}

function confrontCreature() {
if (gameState.currentCase && gameState.caseFiles[gameState.currentCase].clues >= gameState.caseFiles[gameState.currentCase].maxClues) {
closeTravel();
displayText(`You've gathered all the clues. Time to confront the ${gameState.caseFiles[gameState.currentCase].title}...`);
startCombat();
} else {
showNotification("You haven't found enough clues yet!", 'warning');
}
}

// Game Actions
function move(action) {
if (!gameState.currentCase && action !== 'travel') {
displayText("You need to select a case first from your CASE FILES.");
showNotification("Select a case first!", 'warning');
return;
}

const currentCase = gameState.currentCase ? gameState.caseFiles[gameState.currentCase] : null;

switch(action) {
case 'investigate':
let text = `You search for clues about the ${currentCase.title}...\n\n`;

// Calculate chance based on investigation skill
const investigationChance = 40 + (gameState.stats.investigation * 5);
const luckBonus = Math.floor(Math.random() * gameState.stats.luck * 5);
const survivalBonus = gameState.currentCase === 'yeti' || gameState.currentCase === 'deathworm' ?
Math.floor(gameState.stats.survival * 3) : 0;
const totalRoll = Math.floor(Math.random() * 100) + luckBonus + survivalBonus;

if (totalRoll <= investigationChance && currentCase.clues < currentCase.maxClues) {
currentCase.clues++;
text += `You found a clue! (${currentCase.clues}/${currentCase.maxClues})\n`;

// Add case-specific clue
text += clueTexts[gameState.currentCase][Math.floor(Math.random() * clueTexts[gameState.currentCase].length)];

// Add XP for finding clue
const xpGain = 10 + Math.floor(Math.random() * 5);
gameState.xp += xpGain;
checkLevelUp();
showNotification(`Found clue! +${xpGain} XP`, 'success');
} else if (currentCase.clues >= currentCase.maxClues) {
text += "You've found all available clues in this area. Maybe it's time to confront the creature...";
} else {
text += "You don't find anything useful this time. Maybe try again later.";
}

// Random chance of combat encounter when investigating
if (Math.random() < 0.25 && currentCase.clues >= 2) {
setTimeout(() => {
startCombat();
}, 1000);
}

displayText(text);
break;

case 'talk':
let talkText = `You attempt to interview locals about the ${currentCase.title}...\n\n`;

// Reputation affects persuasion chance
const repBonus = Math.floor(gameState.reputation / 10);
const persuasionRoll = Math.floor(Math.random() * 20) + 1 + gameState.stats.persuasion + repBonus;
if (persuasionRoll >= 12) {
const infoTypes = {
lochness: ["An old sailor tells you about unusual water disturbances at dawn.",
"A researcher shares unpublished sonar data showing anomalies."],
mothman: ["A retired police officer confides about unexplained events during the original sightings.",
"A shopkeeper shows you security footage of a large shadow moving impossibly fast."],
bigfoot: ["A park ranger admits to hearing unusual vocalizations at night.",
"A camper describes finding huge nests made of broken branches."],
swampbeast: ["A fisherman tells you about areas of the swamp even gators avoid.",
"A local doctor shares records of unusual bite wounds."],
yeti: ["A sherpa guide shares ancient legends about the yeti's behavior patterns.",
"A climber shows you photos of strange markings high on the mountain."],
sewergators: ["A retired sanitation worker describes hearing strange growls in the tunnels.",
"A homeless man claims to have seen 'something big' moving in the shadows."],
jerseydevil: ["An elderly local recounts family stories about the Jersey Devil's origins.",
"A historian shows you 19th century newspaper accounts of sightings."],
deathworm: ["A nomad elder describes traditional methods to avoid the death worm.",
"A geologist shares unusual seismic readings from the desert."]
};

const randomInfo = infoTypes[gameState.currentCase][Math.floor(Math.random() * infoTypes[gameState.currentCase].length)];
talkText += randomInfo + "\n";

const xpGain = 5 + Math.floor(Math.random() * 3);
gameState.xp += xpGain;
checkLevelUp();
showNotification(`Gathered information! +${xpGain} XP`, 'success');
} else if (persuasionRoll >= 8) {
talkText += "People seem nervous but won't share anything useful.\n";
} else {
talkText += "No one wants to talk to you. They seem afraid.\n";
}

displayText(talkText);
break;

case 'use':
openInventory();
break;

case 'travel':
openTravel();
return;
}

updateUI();
}

// Combat System
function startCombat() {
gameState.inCombat = true;
gameState.currentEnemy = gameState.currentCase;
const currentCase = gameState.caseFiles[gameState.currentCase];

// Reset enemy HP if starting new combat
currentCase.enemyHp = currentCase.enemyMaxHp;

document.getElementById('combat-window').style.display = 'block';
document.getElementById('enemy-name').textContent = currentCase.title.toUpperCase();
document.getElementById('enemy-hp').textContent = currentCase.enemyHp;
document.getElementById('enemy-maxhp').textContent = currentCase.enemyMaxHp;
document.getElementById('enemy-hp-bar').value = currentCase.enemyHp;
document.getElementById('enemy-hp-bar').max = currentCase.enemyMaxHp;

document.getElementById('player-hp').textContent = gameState.hp;
document.getElementById('player-maxhp').textContent = gameState.maxHp;
document.getElementById('player-hp-bar').value = gameState.hp;

const combatLog = document.getElementById('combat-log');
combatLog.innerHTML = '';

combatLog.innerHTML += `<p>${introTexts[gameState.currentCase]}</p>`;

showNotification(`Combat started with ${currentCase.title}!`, 'danger');
}

function openCombatItems() {
document.getElementById('combat-items-window').style.display = 'block';
const itemsList = document.getElementById('combat-items-list');
itemsList.innerHTML = '';

// Filter items that can be used in combat
const combatItems = gameState.inventory.filter(item =>
item.type === "medical" ||
item.type === "ammo" ||
item.name === "Flashlight" ||
item.name === "Flare" ||
item.name === "Gas Mask"
);

if (combatItems.length === 0) {
itemsList.innerHTML = '<p>No usable items in inventory!</p>';
return;
}

// Display usable items
combatItems.forEach(item => {
const div = document.createElement('div');
div.className = 'option item-option';

let usesText = '';
if (item.uses > 0) {
usesText = ` (${item.uses} uses)`;
} else if (item.uses === 0) {
usesText = ` (EMPTY)`;
div.className += ' disabled';
}

div.innerHTML = `<strong>${item.name}</strong>${usesText}`;

if (item.uses !== 0) {
div.onclick = function() { useCombatItem(item); };
}

itemsList.appendChild(div);
});
}

function closeCombatItems() {
document.getElementById('combat-items-window').style.display = 'none';
}

function useCombatItem(item) {
const combatLog = document.getElementById('combat-log');
const currentCase = gameState.caseFiles[gameState.currentCase];

// Find the item in inventory
const inventoryItem = gameState.inventory.find(invItem => invItem.name === item.name);

switch(item.name) {
case 'First Aid Kit':
const healAmount = 25 + Math.floor(Math.random() * 10);
gameState.hp = Math.min(gameState.hp + healAmount, gameState.maxHp);

// Reduce uses
if (inventoryItem.uses > 0) {
inventoryItem.uses--;
if (inventoryItem.uses === 0) {
// Remove if no uses left
gameState.inventory = gameState.inventory.filter(i => i !== inventoryItem);
}
}

combatLog.innerHTML += `<p class="success">You use a First Aid Kit, healing ${healAmount} HP!</p>`;
document.getElementById('player-hp').textContent = gameState.hp;
document.getElementById('player-hp-bar').value = gameState.hp;
showNotification(`Healed ${healAmount} HP!`, 'success');
break;

case 'Flashlight':
case 'Flare':
combatLog.innerHTML += `<p class="warning">You ${item.name === 'Flare' ? 'launch a flare' : 'flash the light'}, temporarily stunning the creature!</p>`;

// Reduce uses
if (inventoryItem.uses > 0) {
inventoryItem.uses--;
if (inventoryItem.uses === 0) {
gameState.inventory = gameState.inventory.filter(i => i !== inventoryItem);
}
}

// Next attack from enemy will be weaker
break;

case 'Tranquilizer Dart':
if (gameState.equipment.weapon === 'Tranquilizer Gun') {
const baseDamage = 15;
const damage = baseDamage + Math.floor(Math.random() * 10) + Math.floor(gameState.stats.combat / 2);
currentCase.enemyHp -= damage;

// Reduce ammo
if (inventoryItem.uses > 0) {
inventoryItem.uses--;
if (inventoryItem.uses === 0) {
gameState.inventory = gameState.inventory.filter(i => i !== inventoryItem);
}
}

combatLog.innerHTML += `<p class="success">You fire a tranquilizer dart, dealing ${damage} damage!</p>`;

// Update enemy HP display
document.getElementById('enemy-hp').textContent = currentCase.enemyHp;
document.getElementById('enemy-hp-bar').value = currentCase.enemyHp;
showNotification(`Hit for ${damage} damage!`, 'success');
} else {
combatLog.innerHTML += `<p class="danger">You need the Tranquilizer Gun equipped to use this!</p>`;
showNotification("Equip Tranquilizer Gun first!", 'warning');
}
break;

case 'Gas Mask':
if (gameState.currentCase === 'sewergators' || gameState.currentCase === 'deathworm') {
combatLog.innerHTML += `<p class="success">The gas mask protects you from the noxious fumes!</p>`;
showNotification("Gas mask protected you!", 'success');
} else {
combatLog.innerHTML += `<p>The gas mask doesn't help in this situation.</p>`;
}
break;
}

closeCombatItems();

// Check if enemy is defeated
if (currentCase.enemyHp <= 0) {
combatLog.innerHTML += `<p class="success">The ${currentCase.title} collapses! You've captured evidence of its existence!</p>`;

const xpReward = 50 + (currentCase.enemyMaxHp / 2);
gameState.xp += xpReward;
gameState.reputation += 10;
gameState.money += 200;

currentCase.status = 'completed';

setTimeout(() => {
endCombat();
displayText(`CASE CLOSED: ${currentCase.title}\n\nYou've gathered enough evidence to prove the creature's existence, though the truth may never be publicly acknowledged.\n\nRewards:\n+${xpReward} XP\n+$200\n+10 Reputation\n\nAnother case file awaits...`);
gameState.currentCase = null;
updateUI();
showNotification(`Case solved! +${xpReward} XP +$200`, 'success');
}, 2000);
return;
} else {
setTimeout(() => {
enemyTurn();
}, 1000);
}
}

function combatAction(action) {
const combatLog = document.getElementById('combat-log');
const currentCase = gameState.caseFiles[gameState.currentCase];

switch(action) {
case 'shoot':
if (gameState.equipment.weapon === 'Tranquilizer Gun') {
const hasAmmo = gameState.inventory.some(item => item.name === 'Tranquilizer Dart' && item.uses > 0);

if (hasAmmo) {
const baseDamage = 15;
const damage = baseDamage + Math.floor(Math.random() * 10) + Math.floor(gameState.stats.combat / 2);
currentCase.enemyHp -= damage;

combatLog.innerHTML += `<p class="success">You fire your tranquilizer gun, hitting the creature for ${damage} damage!</p>`;

// Update enemy HP display
document.getElementById('enemy-hp').textContent = currentCase.enemyHp;
document.getElementById('enemy-hp-bar').value = currentCase.enemyHp;
showNotification(`Shot for ${damage} damage!`, 'success');
} else {
combatLog.innerHTML += `<p class="danger">You're out of tranquilizer darts!</p>`;
showNotification("No ammo left!", 'warning');
}
} else {
combatLog.innerHTML += `<p class="danger">You don't have your tranquilizer gun equipped!</p>`;
showNotification("Equip Tranquilizer Gun first!", 'warning');
}
break;

case 'knife':
let baseDamage = 8;
// Apply luck bonus to damage
const luckBonus = Math.floor(Math.random() * gameState.stats.luck);
const damage = baseDamage + Math.floor(Math.random() * 7) + Math.floor(gameState.stats.combat / 2) + luckBonus;
currentCase.enemyHp -= damage;

combatLog.innerHTML += `<p class="success">You slash with your combat knife, dealing ${damage} damage!</p>`;

// Update enemy HP display
document.getElementById('enemy-hp').textContent = currentCase.enemyHp;
document.getElementById('enemy-hp-bar').value = currentCase.enemyHp;
showNotification(`Stabbed for ${damage} damage!`, 'success');
break;

case 'item':
openCombatItems();
return; // Skip enemy turn until item is used

case 'flee':
// Stealth affects flee chance
const fleeChance = 40 + (gameState.stats.stealth * 5);
if (Math.random() * 100 <= fleeChance) {
combatLog.innerHTML += `<p class="success">You successfully escape from the ${currentCase.title}!</p>`;
showNotification("Escaped successfully!", 'success');
setTimeout(() => {
endCombat();
displayText("You barely escape with your life. The creature disappears into the wilderness... for now.");
}, 1500);
} else {
combatLog.innerHTML += `<p class="danger">You fail to escape! The ${currentCase.title} attacks as you turn away!</p>`;
showNotification("Escape failed!", 'danger');
enemyTurn();
}
return;
}

// Check if enemy is defeated
if (currentCase.enemyHp <= 0) {
combatLog.innerHTML += `<p class="success">The ${currentCase.title} collapses! You've captured evidence of its existence!</p>`;

const xpReward = 50 + (currentCase.enemyMaxHp / 2);
gameState.xp += xpReward;
gameState.reputation += 10;
gameState.money += 200;

currentCase.status = 'completed';

setTimeout(() => {
endCombat();
displayText(`CASE CLOSED: ${currentCase.title}\n\nYou've gathered enough evidence to prove the creature's existence, though the truth may never be publicly acknowledged.\n\nRewards:\n+${xpReward} XP\n+$200\n+10 Reputation\n\nAnother case file awaits...`);
gameState.currentCase = null;
updateUI();
showNotification(`Case solved! +${xpReward} XP +$200`, 'success');
}, 2000);
return;
} else {
setTimeout(() => {
enemyTurn();
}, 1000);
}
}

function enemyTurn() {
const combatLog = document.getElementById('combat-log');
const currentCase = gameState.caseFiles[gameState.currentCase];

let [minDamage, maxDamage] = currentCase.enemyAttack;

// Apply armor damage reduction if wearing Kevlar Vest
if (gameState.equipment.armor === "Kevlar Vest") {
minDamage = Math.floor(minDamage * 0.85);
maxDamage = Math.floor(maxDamage * 0.85);
}

const enemyDamage = minDamage + Math.floor(Math.random() * (maxDamage - minDamage + 1));
gameState.hp -= enemyDamage;

const randomAttack = attackDescriptions[gameState.currentCase][Math.floor(Math.random() * attackDescriptions[gameState.currentCase].length)];

combatLog.innerHTML += `<p class="danger">${randomAttack} (${enemyDamage} damage)</p>`;

document.getElementById('player-hp').textContent = gameState.hp;
document.getElementById('player-hp-bar').value = gameState.hp;
showNotification(`Hit for ${enemyDamage} damage!`, 'danger');

// Check if player died
if (gameState.hp <= 0) {
combatLog.innerHTML += `<p class="danger">You collapse, the creature standing over you... everything fades to black.</p>`;
showNotification("You were defeated!", 'danger');
setTimeout(() => {
endCombat();
gameState.hp = Math.floor(gameState.maxHp / 2);
displayText("You wake up in a hospital bed, your notes and equipment gone. The case will have to wait until you recover.");
updateUI();
}, 2000);
}
}

function endCombat() {
gameState.inCombat = false;
gameState.currentEnemy = null;
document.getElementById('combat-window').style.display = 'none';
}

function checkLevelUp() {
if (gameState.xp >= gameState.xpToNextLevel) {
gameState.level++;
gameState.xp -= gameState.xpToNextLevel;
gameState.xpToNextLevel = Math.floor(gameState.xpToNextLevel * 1.5);
gameState.maxHp += 20 + Math.floor(gameState.level / 2);
gameState.hp = gameState.maxHp;

// Improve stats
const statOptions = ['investigation', 'stealth', 'combat', 'persuasion', 'luck', 'survival'];
const stat1 = statOptions[Math.floor(Math.random() * statOptions.length)];
let stat2 = statOptions[Math.floor(Math.random() * statOptions.length)];

// Ensure we don't upgrade same stat twice
while (stat2 === stat1) {
stat2 = statOptions[Math.floor(Math.random() * statOptions.length)];
}

gameState.stats[stat1]++;
gameState.stats[stat2]++;

displayText(`LEVEL UP! You are now level ${gameState.level}.\n\nYour ${stat1} and ${stat2} skills have improved.\n\nMax HP increased to ${gameState.maxHp}.`);
showNotification(`Level Up! Now level ${gameState.level}`, 'success');
updateUI();
}
}

// Save/Load System
function saveGame() {
try {
localStorage.setItem('monsterHuntSave', JSON.stringify(gameState));
showNotification("Game saved successfully!", 'success');
} catch (e) {
showNotification("Failed to save game!", 'danger');
console.error("Save error:", e);
}
}

function loadGame() {
try {
const saveData = localStorage.getItem('monsterHuntSave');
if (saveData) {
const loadedData = JSON.parse(saveData);

// Merge loaded data with current game state carefully
for (const key in loadedData) {
if (gameState.hasOwnProperty(key)) {
// Special handling for case files to ensure all cases exist
if (key === 'caseFiles') {
for (const caseId in loadedData.caseFiles) {
if (gameState.caseFiles[caseId]) {
gameState.caseFiles[caseId] = loadedData.caseFiles[caseId];
}
}
} else {
gameState[key] = loadedData[key];
}
}
}

updateUI();
displayText("Game loaded. Welcome back, Agent McCracken.");
showNotification("Game loaded successfully!", 'success');
closeWindows();
} else {
showNotification("No save data found", 'warning');
}
} catch (e) {
showNotification("Failed to load game!", 'danger');
console.error("Load error:", e);
}
}

// Initialize UI
updateUI();
</script>
</body>
</html>
