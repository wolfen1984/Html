<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FATHERLAND LEGACY - DOS Text Adventure</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=VT323&display=swap">
    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            color: #0f0;
            font-family: 'VT323', monospace;
            font-size: 18px;
            line-height: 1.4;
            height: 100vh;
            overflow: hidden;
            touch-action: manipulation;
        }
        
        #game-container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            max-width: 500px;
            margin: 0 auto;
            background-color: #111;
            position: relative;
            border-left: 2px solid #333;
            border-right: 2px solid #333;
        }
        
        #header {
            padding: 10px;
            border-bottom: 2px solid #0a0;
            text-align: center;
            background-color: #000;
            position: relative;
        }
        
        #title {
            font-size: 24px;
            color: #0f0;
            text-shadow: 0 0 5px #0f0;
            letter-spacing: 2px;
            margin: 5px 0;
        }
        
        #subtitle {
            font-size: 14px;
            color: #8f8;
            margin-bottom: 5px;
        }
        
        #screen-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        #main-screen {
            flex: 3;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #333;
        }
        
        #side-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }
        
        #screen {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }
        
        .screen-content {
            min-height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .text-output {
            flex: 1;
            margin-bottom: 15px;
            white-space: pre-wrap;
            word-break: break-word;
        }
        
        .command-line {
            display: flex;
            align-items: center;
            margin-top: auto;
            padding-top: 10px;
            border-top: 1px dashed #333;
        }
        
        .prompt {
            color: #0f0;
            margin-right: 8px;
            font-weight: bold;
            white-space: nowrap;
        }
        
        .input-line {
            flex: 1;
            background: transparent;
            border: none;
            color: #0f0;
            font-family: 'VT323', monospace;
            font-size: 18px;
            outline: none;
            caret-color: #0f0;
            min-width: 0;
        }
        
        .button-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
            margin-top: 15px;
        }
        
        .game-button {
            background-color: #222;
            border: 1px solid #0a0;
            color: #0f0;
            font-family: 'VT323', monospace;
            font-size: 16px;
            padding: 10px;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            touch-action: manipulation;
        }
        
        .game-button:hover, .game-button:focus {
            background-color: #0a0;
            color: #000;
        }
        
        .game-button:active {
            background-color: #0f0;
            transform: scale(0.98);
        }
        
        .class-button {
            border-left: 4px solid;
            padding-left: 10px;
        }
        
        .investigator { border-left-color: #00aaff; }
        .soldier { border-left-color: #ff5500; }
        .diplomat { border-left-color: #ffcc00; }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            padding: 8px 10px;
            border-top: 2px solid #0a0;
            background-color: #000;
            font-size: 14px;
        }
        
        .status-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
        }
        
        .status-label {
            font-size: 12px;
            color: #8f8;
            margin-bottom: 2px;
        }
        
        .status-value {
            color: #0f0;
        }
        
        .side-section {
            padding: 10px;
            border-bottom: 1px solid #333;
            flex: 1;
            overflow-y: auto;
            min-height: 0;
        }
        
        .side-section h3 {
            margin-top: 0;
            color: #0a0;
            border-bottom: 1px solid #0a0;
            padding-bottom: 5px;
            font-size: 16px;
        }
        
        #inventory-items {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .inventory-item {
            background-color: #222;
            border: 1px solid #333;
            padding: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .inventory-item:hover {
            border-color: #0a0;
            background-color: #2a2a2a;
        }
        
        .item-use-btn {
            background-color: #0a0;
            border: none;
            color: #000;
            font-family: 'VT323', monospace;
            padding: 2px 6px;
            font-size: 12px;
            cursor: pointer;
        }
        
        .clues-list {
            font-size: 14px;
            line-height: 1.3;
        }
        
        .clue-item {
            margin-bottom: 8px;
            padding-left: 10px;
            border-left: 2px solid #0a0;
        }
        
        .hidden {
            display: none !important;
        }
        
        .blinking-cursor {
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .scanline {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: rgba(0, 255, 0, 0.1);
            z-index: 999;
            pointer-events: none;
            animation: scan 8s linear infinite;
        }
        
        @keyframes scan {
            0% { top: 0%; }
            100% { top: 100%; }
        }
        
        .glitch {
            position: relative;
        }
        
        .glitch::before, .glitch::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .glitch::before {
            left: 2px;
            text-shadow: -1px 0 red;
            clip: rect(24px, 550px, 90px, 0);
            animation: glitch-anim 5s infinite linear alternate-reverse;
        }
        
        .glitch::after {
            left: -2px;
            text-shadow: -1px 0 blue;
            clip: rect(85px, 550px, 140px, 0);
            animation: glitch-anim2 5s infinite linear alternate-reverse;
        }
        
        @keyframes glitch-anim {
            0% { clip: rect(42px, 9999px, 44px, 0); }
            5% { clip: rect(12px, 9999px, 59px, 0); }
            10% { clip: rect(48px, 9999px, 29px, 0); }
            15% { clip: rect(42px, 9999px, 73px, 0); }
            20% { clip: rect(63px, 9999px, 27px, 0); }
            25% { clip: rect(34px, 9999px, 55px, 0); }
            30% { clip: rect(86px, 9999px, 73px, 0); }
            35% { clip: rect(20px, 9999px, 20px, 0); }
            40% { clip: rect(26px, 9999px, 60px, 0); }
            45% { clip: rect(25px, 9999px, 66px, 0); }
            50% { clip: rect(57px, 9999px, 98px, 0); }
            55% { clip: rect(5px, 9999px, 46px, 0); }
            60% { clip: rect(82px, 9999px, 31px, 0); }
            65% { clip: rect(54px, 9999px, 27px, 0); }
            70% { clip: rect(28px, 9999px, 99px, 0); }
            75% { clip: rect(45px, 9999px, 69px, 0); }
            80% { clip: rect(23px, 9999px, 85px, 0); }
            85% { clip: rect(54px, 9999px, 84px, 0); }
            90% { clip: rect(45px, 9999px, 47px, 0); }
            95% { clip: rect(37px, 9999px, 20px, 0); }
            100% { clip: rect(4px, 9999px, 91px, 0); }
        }
        
        @keyframes glitch-anim2 {
            0% { clip: rect(65px, 9999px, 100px, 0); }
            5% { clip: rect(52px, 9999px, 74px, 0); }
            10% { clip: rect(79px, 9999px, 85px, 0); }
            15% { clip: rect(75px, 9999px, 5px, 0); }
            20% { clip: rect(67px, 9999px, 61px, 0); }
            25% { clip: rect(14px, 9999px, 79px, 0); }
            30% { clip: rect(1px, 9999px, 66px, 0); }
            35% { clip: rect(86px, 9999px, 30px, 0); }
            40% { clip: rect(23px, 9999px, 98px, 0); }
            45% { clip: rect(85px, 9999px, 72px, 0); }
            50% { clip: rect(71px, 9999px, 75px, 0); }
            55% { clip: rect(2px, 9999px, 48px, 0); }
            60% { clip: rect(30px, 9999px, 16px, 0); }
            65% { clip: rect(59px, 9999px, 50px, 0); }
            70% { clip: rect(41px, 9999px, 62px, 0); }
            75% { clip: rect(2px, 9999px, 82px, 0); }
            80% { clip: rect(47px, 9999px, 73px, 0); }
            85% { clip: rect(3px, 9999px, 27px, 0); }
            90% { clip: rect(40px, 9999px, 86px, 0); }
            95% { clip: rect(45px, 9999px, 72px, 0); }
            100% { clip: rect(23px, 9999px, 49px, 0); }
        }
        
        .crt-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            opacity: 0.6;
        }
        
        .item-description {
            font-size: 14px;
            color: #8f8;
            margin-top: 5px;
            padding: 5px;
            background-color: #222;
            border-left: 3px solid #0a0;
        }
        
        .danger {
            color: #f44;
            border-color: #f44;
        }
        
        .success {
            color: #4f4;
            border-color: #4f4;
        }
        
        .warning {
            color: #ff0;
            border-color: #ff0;
        }
        
        .health-bar-container {
            width: 100%;
            height: 10px;
            background-color: #222;
            margin-top: 3px;
        }
        
        .health-bar {
            height: 100%;
            background-color: #0f0;
            transition: width 0.3s;
        }
        
        .suspicion-bar {
            height: 100%;
            background-color: #f00;
            transition: width 0.3s;
        }
        
        .rep-bar {
            height: 100%;
            background-color: #ff0;
            transition: width 0.3s;
        }
        
        .modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #000;
            border: 2px solid #0a0;
            padding: 20px;
            z-index: 1001;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal h3 {
            margin-top: 0;
            color: #0f0;
            border-bottom: 1px solid #0a0;
            padding-bottom: 10px;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
        }
        
        .close-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: #0f0;
            font-size: 20px;
            cursor: pointer;
        }
        
        /* Mobile optimizations */
        @media (max-width: 500px) {
            body { font-size: 16px; }
            #title { font-size: 20px; }
            .game-button { padding: 12px; font-size: 15px; }
            .status-bar { font-size: 12px; padding: 6px 8px; }
            .status-label { font-size: 10px; }
            .side-section h3 { font-size: 14px; }
            .inventory-item { font-size: 12px; padding: 6px; }
            #screen-container { flex-direction: column; }
            #side-panel { flex-direction: row; border-top: 1px solid #333; }
            .side-section { border-right: 1px solid #333; border-bottom: none; }
            .side-section:last-child { border-right: none; }
        }
        
        /* Prevent text selection */
        .game-button, .status-bar, #title, .inventory-item {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* Scrollbar styling */
        #screen::-webkit-scrollbar,
        .side-section::-webkit-scrollbar {
            width: 6px;
        }
        
        #screen::-webkit-scrollbar-track,
        .side-section::-webkit-scrollbar-track {
            background: #111;
        }
        
        #screen::-webkit-scrollbar-thumb,
        .side-section::-webkit-scrollbar-thumb {
            background: #0a0;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div class="scanline"></div>
        <div class="crt-overlay"></div>
        
        <div id="header">
            <div id="title" class="glitch" data-text="FATHERLAND LEGACY">FATHERLAND LEGACY</div>
            <div id="subtitle">A DOS Text Adventure - 1964 GERMAN REICH</div>
        </div>
        
        <div id="screen-container">
            <div id="main-screen">
                <div id="screen">
                    <div class="screen-content">
                        <div class="text-output" id="text-output">
                            <!-- Game text appears here -->
                        </div>
                        
                        <div class="button-container" id="button-container">
                            <!-- Game buttons appear here -->
                        </div>
                        
                        <div class="command-line" id="command-line">
                            <span class="prompt">C:\FATHERLAND&gt;</span>
                            <input type="text" class="input-line" id="input-line" autocomplete="off" spellcheck="false">
                        </div>
                    </div>
                </div>
                
                <div class="status-bar" id="status-bar">
                    <div class="status-item">
                        <span class="status-label">CLASS</span>
                        <span class="status-value" id="class-value">NONE</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">HEALTH</span>
                        <div class="status-value">
                            <div id="health-text">100</div>
                            <div class="health-bar-container">
                                <div class="health-bar" id="health-bar" style="width: 100%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="status-item">
                        <span class="status-label">SUSPICION</span>
                        <div class="status-value">
                            <div id="suspicion-text">0</div>
                            <div class="health-bar-container">
                                <div class="suspicion-bar" id="suspicion-bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="side-panel">
                <div class="side-section" id="inventory-section">
                    <h3>INVENTORY</h3>
                    <div id="inventory-items">
                        <!-- Inventory items appear here -->
                    </div>
                </div>
                
                <div class="side-section" id="clues-section">
                    <h3>CLUES & NOTES</h3>
                    <div id="clues-list" class="clues-list">
                        <!-- Clues appear here -->
                    </div>
                </div>
                
                <div class="side-section" id="stats-section">
                    <h3>STATUS</h3>
                    <div id="stats-display">
                        <!-- Stats appear here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for item examination -->
    <div id="item-modal" class="modal hidden">
        <button class="close-modal" id="close-modal">&times;</button>
        <h3 id="modal-item-name">Item Name</h3>
        <div id="modal-item-description"></div>
        <div class="modal-buttons" id="modal-buttons"></div>
    </div>
    
    <div id="modal-overlay" class="modal-overlay hidden"></div>

    <script>
        // Game State
        const gameState = {
            playerClass: null,
            location: 'start',
            time: '06:00',
            day: 1,
            inventory: [],
            clues: [],
            reputation: 50,
            suspicion: 0,
            health: 100,
            stamina: 100,
            money: 50,
            gameOver: false,
            currentScene: null,
            pendingItemUse: null
        };

        // Game Items Database
        const items = {
            pistol: {
                id: 'pistol',
                name: 'Walther P38 Pistol',
                description: 'Standard issue sidearm. 8 rounds remaining.',
                usable: true,
                classRestriction: ['soldier', 'investigator'],
                useText: 'Draw your weapon',
                useEffect: (scene) => {
                    if (scene === 'alexanderplatzMeeting' || scene === 'confrontation') {
                        addText('\n\nYou draw your weapon. The metallic click echoes in the silence.');
                        return {intimidation: 30, suspicion: 10};
                    }
                    return null;
                }
            },
            kripoBadge: {
                id: 'kripoBadge',
                name: 'Kripo Badge',
                description: 'Your official Kriminalpolizei identification.',
                usable: true,
                classRestriction: ['investigator'],
                useText: 'Show your badge',
                useEffect: (scene) => {
                    if (scene === 'checkpoint' || scene === 'archive') {
                        addText('\n\nYou flash your badge. Authority recognized.');
                        return {access: true, suspicion: -5};
                    }
                    return null;
                }
            },
            documents: {
                id: 'documents',
                name: 'Forged Documents',
                description: 'Papers identifying you as a low-level bureaucrat.',
                usable: true,
                classRestriction: ['diplomat'],
                useText: 'Present documents',
                useEffect: (scene) => {
                    if (scene === 'checkpoint' || scene === 'restrictedArea') {
                        addText('\n\nThe guard glances at your papers and waves you through.');
                        return {access: true, suspicion: 5};
                    }
                    return null;
                }
            },
            flask: {
                id: 'flask',
                name: 'Metal Flask',
                description: 'Contains strong schnapps. Restores stamina.',
                usable: true,
                useText: 'Take a drink',
                useEffect: () => {
                    if (gameState.stamina < 80) {
                        gameState.stamina = Math.min(100, gameState.stamina + 30);
                        addText('\n\nYou take a swig. The burning liquid revives you.');
                        updateStatsDisplay();
                        return {stamina: 30};
                    }
                    return null;
                }
            },
            firstAid: {
                id: 'firstAid',
                name: 'First Aid Kit',
                description: 'Basic medical supplies.',
                usable: true,
                useText: 'Use medical supplies',
                useEffect: () => {
                    if (gameState.health < 80) {
                        gameState.health = Math.min(100, gameState.health + 30);
                        addText('\n\nYou patch yourself up. Health restored.');
                        updateHealthDisplay();
                        return {health: 30};
                    }
                    return null;
                }
            },
            camera: {
                id: 'camera',
                name: 'Miniature Camera',
                description: 'Small spy camera. Film: 4 exposures remaining.',
                usable: true,
                classRestriction: ['investigator', 'diplomat'],
                useText: 'Take photograph',
                useEffect: (scene) => {
                    if (scene === 'archive' || scene === 'secretDocuments') {
                        addText('\n\nYou discreetly photograph the evidence. Evidence preserved.');
                        addClue('Photographic evidence');
                        return {clue: true};
                    }
                    return null;
                }
            },
            money: {
                id: 'money',
                name: 'Reichsmarks',
                description: `Cash: ${gameState.money} RM`,
                usable: true,
                useText: 'Bribe',
                useEffect: (scene) => {
                    if (scene === 'bribeOpportunity' && gameState.money >= 20) {
                        gameState.money -= 20;
                        addText('\n\nYou discreetly pass some bills. Cooperation secured.');
                        updateStatsDisplay();
                        return {access: true};
                    }
                    return null;
                }
            },
            notebook: {
                id: 'notebook',
                name: 'Leather Notebook',
                description: 'Your personal journal with coded notes.',
                usable: false
            },
            key: {
                id: 'key',
                name: 'Brass Key',
                description: 'Fits an unknown lock.',
                usable: true,
                useText: 'Try the key',
                useEffect: (scene) => {
                    if (scene === 'lockedDoor') {
                        addText('\n\nThe key turns smoothly. The lock opens.');
                        return {access: true};
                    }
                    return null;
                }
            }
        };

        // Starting items by class
        const startingItems = {
            investigator: ['kripoBadge', 'pistol', 'notebook', 'flask'],
            soldier: ['pistol', 'firstAid', 'flask'],
            diplomat: ['documents', 'camera', 'notebook', 'money']
        };

        // Game Scenes - Expanded
        const scenes = {
            start: {
                text: `SYSTEM BOOT...\nFATHERLAND LEGACY v2.0\n\nAPRIL 1964. GERMAN REICH.\n\nYou are a citizen of the Greater German Reich, twenty years after victory in the Second World War. The Reich spans from the Atlantic to the Urals. Yet rumors persist of dark secrets buried beneath the gleaming cities.\n\nToday, you received a cryptic message from a source claiming to have information that could shake the Reich to its foundations. You must proceed carefully - the Gestapo is always watching.\n\nSELECT YOUR PROFESSION:`,
                buttons: [
                    {text: "KRIMINALPOLIZEI INVESTIGATOR", action: "selectClass", class: "investigator", next: "classSelected"},
                    {text: "WEHRMACHT SOLDIER", action: "selectClass", class: "soldier", next: "classSelected"},
                    {text: "AUSWÄRTIGES AMT DIPLOMAT", action: "selectClass", class: "diplomat", next: "classSelected"}
                ],
                input: false
            },
            
            classSelected: {
                text: () => {
                    const classDescriptions = {
                        investigator: `KRIMINALPOLIZEI INVESTIGATOR selected.\n\nYou are a detective with the Kriminalpolizei, experienced in solving crimes that the regime would prefer to keep hidden. Your skills in deduction and forensics will help uncover the truth, but your position makes you vulnerable to scrutiny from the SS.`,
                        soldier: `WEHRMACHT SOLDIER selected.\n\nYou serve in the Wehrmacht, a veteran of the Eastern Front campaigns. Your military training gives you physical prowess and access to restricted areas, but questioning orders could lead to charges of treason.`,
                        diplomat: `AUSWÄRTIGES AMT DIPLOMAT selected.\n\nYou work for the Foreign Office, navigating the complex politics of the Reich and its occupied territories. Your connections and persuasive skills are valuable, but you operate in a world where a single misspoken word could mean disappearance.`
                    };
                    
                    // Add starting items
                    const items = startingItems[gameState.playerClass];
                    let itemText = '\n\nSTARTING EQUIPMENT:\n';
                    items.forEach(itemId => {
                        const item = items[itemId];
                        if (item) {
                            addItem(itemId);
                            itemText += `- ${item.name}\n`;
                        }
                    });
                    
                    return `${classDescriptions[gameState.playerClass]}${itemText}\n\nPress ENTER to begin your investigation...`;
                },
                buttons: [
                    {text: "BEGIN INVESTIGATION", action: "loadScene", next: "apartment"}
                ],
                input: false
            },
            
            apartment: {
                text: () => {
                    const timeText = gameState.time === '06:00' ? "early morning" : "evening";
                    return `BERLIN APARTMENT - DAY ${gameState.day}, ${gameState.time}\n\nYour modest apartment in the Berlin suburbs. The wireless plays martial music softly in the background. On your desk lies the encrypted message that arrived last night:\n\n"MEET AT ALEXANDERPLATZ U-BAHN. SOUTH ENTRANCE. 20:00 TONIGHT. COME ALONE. DESTRUCT AFTER READING."\n\nYou have the day ahead before the meeting. What will you do?`;
                },
                buttons: [
                    {text: "EXAMINE THE MESSAGE CLOSELY", action: "loadScene", next: "examineMessage"},
                    {text: "GO TO KRIPO HEADQUARTERS", action: "loadScene", next: "kripoHQ", condition: () => gameState.playerClass === 'investigator'},
                    {text: "REPORT TO BARRACKS", action: "loadScene", next: "barracks", condition: () => gameState.playerClass === 'soldier'},
                    {text: "VISIT FOREIGN OFFICE", action: "loadScene", next: "foreignOffice", condition: () => gameState.playerClass === 'diplomat'},
                    {text: "GO TO ALEXANDERPLATZ EARLY", action: "loadScene", next: "alexanderplatzScout"},
                    {text: "VISIT THE ARCHIVES", action: "loadScene", next: "archiveVisit", condition: () => gameState.inventory.some(i => i.id === 'kripoBadge')},
                    {text: "CHECK INVENTORY", action: "showInventory"}
                ],
                input: true
            },
            
            examineMessage: {
                text: `EXAMINING THE MESSAGE\n\nThe paper is cheap, untraceable. The handwriting is deliberately sloppy. But you notice something:\n\n1. The paper has a faint chemical smell - printing industry?\n2. There's a tiny ink smudge in the shape of a partial eagle\n3. The phrase "COME ALONE" is underlined twice\n\nThis was written by someone nervous but professional. The partial eagle might be from an official stamp.`,
                buttons: [
                    {text: "RETURN TO APARTMENT", action: "loadScene", next: "apartment"},
                    {text: "BURN THE MESSAGE", action: "action", next: "burnMessage"},
                    {text: "TAKE PHOTOGRAPH WITH CAMERA", action: "useItem", item: "camera", condition: () => hasItem('camera')}
                ],
                input: true
            },
            
            kripoHQ: {
                text: `KRIPO HEADQUARTERS, PRINZ-ALBRECHT-STRAßE\n\nThe headquarters buzzes with activity. Your superior, Kommissar Bauer, approaches.\n\n"Good, you're here. We have a sensitive case - a missing person from the Propaganda Ministry. Low priority officially, but I want you to look into it quietly."\n\nHe hands you a file. The missing person worked in archival services.`,
                buttons: [
                    {text: "ACCEPT THE CASE", action: "action", next: "acceptCase"},
                    {text: "DECLINE, PLEAD OTHER DUTIES", action: "loadScene", next: "apartment"},
                    {text: "ASK ABOUT ALEXANDERPLATZ", action: "action", next: "askAboutAlexanderplatz"},
                    {text: "SHOW HIM THE MESSAGE", action: "useItem", item: "notebook", condition: () => hasItem('notebook')}
                ],
                input: true
            },
            
            barracks: {
                text: `WEHRMACHT BARRACKS, BERLIN DISTRICT\n\nYour unit is on light duty today. Sergeant Müller barks orders in the courtyard. Several soldiers glance nervously at the political officer talking with the sergeant.\n\n"Everything in order, soldier?" the political officer asks as you approach.`,
                buttons: [
                    {text: "SALUTE AND REPORT", action: "action", next: "reportToOfficer"},
                    {text: "ASK ABOUT DETACHMENT TO ALEXANDERPLATZ", action: "action", next: "requestAlexanderplatz"},
                    {text: "CLAIM ILLNESS AND RETURN HOME", action: "loadScene", next: "apartment"},
                    {text: "OFFER BRIBE", action: "useItem", item: "money", condition: () => hasItem('money') && gameState.money >= 30}
                ],
                input: true
            },
            
            foreignOffice: {
                text: `FOREIGN OFFICE, WILHELMSTRASSE\n\nThe grand building hums with bureaucratic activity. Colleague Schmidt approaches you nervously.\n\n"Have you heard? Several junior diplomats have been... reassigned. To the Eastern territories. Without notice."\n\nHe lowers his voice. "They were asking questions about certain... historical records."`,
                buttons: [
                    {text: "PRESS FOR DETAILS", action: "action", next: "pressForDetails"},
                    {text: "CHANGE THE SUBJECT", action: "loadScene", next: "apartment"},
                    {text: "SHOW YOUR DOCUMENTS", action: "useItem", item: "documents", condition: () => hasItem('documents')},
                    {text: "SUGGEST MEETING AT ALEXANDERPLATZ", action: "action", next: "suggestMeeting"}
                ],
                input: true
            },
            
            alexanderplatzScout: {
                text: `ALEXANDERPLATZ - DAYTIME\n\nThe vast square bustles with activity. Trams rattle past the massive television tower construction site. You notice:\n\n1. Two Gestapo agents watching the U-Bahn entrance\n2. A newspaper vendor who keeps glancing at his watch\n3. Construction workers who seem out of place\n\nYou need to decide how to approach the meeting.`,
                buttons: [
                    {text: "RETURN LATER FOR MEETING", action: "advanceTime", next: "alexanderplatzMeeting"},
                    {text: "APPROACH NEWSPAPER VENDOR", action: "action", next: "approachVendor"},
                    {text: "USE CAMERA TO SURVEILLANCE", action: "useItem", item: "camera", condition: () => hasItem('camera')},
                    {text: "DRAW PISTOL (CAUTION)", action: "useItem", item: "pistol", condition: () => hasItem('pistol')}
                ],
                input: true
            },
            
            alexanderplatzMeeting: {
                text: () => {
                    let text = `ALEXANDERPLATZ - 20:00\n\nShadows lengthen across the square. The evening crowd thins. You wait at the south U-Bahn entrance.\n\nA man in a worn coat approaches. He keeps his head down.\n\n"Thank you for coming," he whispers. "My name is Vogel. I worked in the archive... I saw things."\n\nHe looks around nervously.`;
                    
                    if (gameState.suspicion > 30) {
                        text += `\n\nYou notice two men watching from across the square. They're trying to appear casual, but their posture gives them away.`;
                    }
                    
                    return text;
                },
                buttons: [
                    {text: "WHAT DID YOU SEE?", action: "action", next: "vogelRevelation"},
                    {text: "THIS COULD BE A TRAP", action: "action", next: "expressDoubt"},
                    {text: "SHOW YOUR BADGE", action: "useItem", item: "kripoBadge", condition: () => hasItem('kripoBadge')},
                    {text: "DRAW YOUR WEAPON", action: "useItem", item: "pistol", condition: () => hasItem('pistol')},
                    {text: "OFFER MONEY FOR INFORMATION", action: "useItem", item: "money", condition: () => hasItem('money') && gameState.money >= 40}
                ],
                input: true
            },
            
            vogelRevelation: {
                text: `Vogel leans closer, his voice barely audible.\n\n"The Final Solution... it wasn't just about resettlement. There were camps... extermination camps. Millions."\n\nHe presses a small notebook into your hand.\n\n"Names, dates, locations. They're destroying the records, but I saved this. You must--"\n\nSuddenly, headlights flood the area. A black sedan screeches to a halt. Vogel's eyes widen in terror.`,
                buttons: [
                    {text: "RUN WITH VOGEL", action: "action", next: "runWithVogel"},
                    {text: "HIDE IN SHADOWS", action: "action", next: "hideInShadows"},
                    {text: "CONFRONT THE ARRIVALS", action: "action", next: "confrontArrivals"},
                    {text: "USE PISTOL FOR COVER", action: "useItem", item: "pistol", condition: () => hasItem('pistol')}
                ],
                input: false
            },
            
            archiveVisit: {
                text: `PROPAGANDA MINISTRY ARCHIVES\n\nThe archive is a labyrinth of files and dust. The clerk eyes you suspiciously.\n\n"Access requires Level 4 clearance," he states flatly.`,
                buttons: [
                    {text: "SHOW KRIPO BADGE", action: "useItem", item: "kripoBadge", condition: () => hasItem('kripoBadge')},
                    {text: "PRESENT FORGED DOCUMENTS", action: "useItem", item: "documents", condition: () => hasItem('documents')},
                    {text: "OFFER BRIBE", action: "useItem", item: "money", condition: () => hasItem('money') && gameState.money >= 25},
                    {text: "LEAVE QUIETLY", action: "loadScene", next: "apartment"}
                ],
                input: true
            },
            
            // More scenes would continue here...
        };

        // DOM Elements
        const textOutput = document.getElementById('text-output');
        const buttonContainer = document.getElementById('button-container');
        const commandLine = document.getElementById('command-line');
        const inputLine = document.getElementById('input-line');
        const inventoryItems = document.getElementById('inventory-items');
        const cluesList = document.getElementById('clues-list');
        const statsDisplay = document.getElementById('stats-display');
        const healthBar = document.getElementById('health-bar');
        const healthText = document.getElementById('health-text');
        const suspicionBar = document.getElementById('suspicion-bar');
        const suspicionText = document.getElementById('suspicion-text');
        const classValue = document.getElementById('class-value');
        const itemModal = document.getElementById('item-modal');
        const modalOverlay = document.getElementById('modal-overlay');
        const modalItemName = document.getElementById('modal-item-name');
        const modalItemDescription = document.getElementById('modal-item-description');
        const modalButtons = document.getElementById('modal-buttons');
        const closeModal = document.getElementById('close-modal');

        // Game Functions
        function initGame() {
            loadScene('start');
            updateInventoryDisplay();
            updateCluesDisplay();
            updateStatsDisplay();
            
            // Set up input handler
            inputLine.addEventListener('keyup', function(event) {
                if (event.key === 'Enter') {
                    processCommand(this.value);
                    this.value = '';
                }
            });
            
            // Set up modal close
            closeModal.addEventListener('click', hideModal);
            modalOverlay.addEventListener('click', hideModal);
            
            // Focus on input line
            inputLine.focus();
            
            // Initial typing effect
            typeText("SYSTEM BOOT...\nFATHERLAND LEGACY v2.0\n\nINITIALIZING...", 50);
        }

        function typeText(text, speed = 30) {
            textOutput.innerHTML = '';
            let i = 0;
            
            function typeChar() {
                if (i < text.length) {
                    textOutput.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(typeChar, speed);
                    scrollToBottom();
                }
            }
            
            typeChar();
        }

        function addText(text) {
            textOutput.innerHTML += text;
            scrollToBottom();
        }

        function scrollToBottom() {
            const screen = document.getElementById('screen');
            setTimeout(() => {
                screen.scrollTop = screen.scrollHeight;
            }, 100);
        }

        function loadScene(sceneId) {
            gameState.currentScene = sceneId;
            const scene = scenes[sceneId];
            
            if (!scene) {
                console.error(`Scene ${sceneId} not found`);
                return;
            }
            
            // Update game state
            gameState.location = sceneId;
            
            // Clear buttons
            buttonContainer.innerHTML = '';
            
            // Show/hide command line
            if (scene.input === false) {
                commandLine.classList.add('hidden');
            } else {
                commandLine.classList.remove('hidden');
            }
            
            // Display scene text
            if (typeof scene.text === 'function') {
                textOutput.innerHTML = scene.text();
            } else {
                textOutput.innerHTML = scene.text;
            }
            
            // Add buttons
            if (scene.buttons && scene.buttons.length > 0) {
                scene.buttons.forEach(button => {
                    if (button.condition && !button.condition()) {
                        return;
                    }
                    
                    const buttonElement = document.createElement('button');
                    buttonElement.className = `game-button ${button.class || ''}`;
                    buttonElement.textContent = button.text;
                    buttonElement.dataset.action = button.action;
                    
                    if (button.action === 'useItem') {
                        buttonElement.dataset.item = button.item;
                    } else {
                        buttonElement.dataset.next = button.next;
                    }
                    
                    if (button.class) {
                        buttonElement.dataset.class = button.class;
                    }
                    
                    buttonContainer.appendChild(buttonElement);
                });
                buttonContainer.classList.remove('hidden');
            } else {
                buttonContainer.classList.add('hidden');
            }
            
            scrollToBottom();
        }

        function processCommand(command) {
            if (!command.trim()) return;
            
            addText(`\n\n&gt; ${command}\n`);
            
            const cmd = command.toLowerCase().trim();
            const parts = cmd.split(' ');
            const mainCmd = parts[0];
            
            switch(mainCmd) {
                case 'help':
                case '?':
                    addText(`\nAVAILABLE COMMANDS:\nLOOK - Examine surroundings\nINV - Show inventory\nUSE [item] - Use an item\nSTATUS - Show detailed status\nTIME - Check time\nMAP - Show locations (when available)\nSAVE - Save game (disabled)\nLOAD - Load game (disabled)`);
                    break;
                    
                case 'inv':
                case 'inventory':
                    showInventory();
                    break;
                    
                case 'use':
                    if (parts.length > 1) {
                        const itemName = parts.slice(1).join(' ');
                        useInventoryItem(itemName);
                    } else {
                        addText(`\nUse what? Example: USE PISTOL`);
                    }
                    break;
                    
                case 'status':
                    displayStatus();
                    break;
                    
                case 'time':
                    addText(`\nCurrent time: ${gameState.time}, Day ${gameState.day}`);
                    break;
                    
                case 'look':
                    addText(`\nYou examine your surroundings carefully...`);
                    // In a full implementation, this would reload scene description
                    break;
                    
                case 'save':
                    addText(`\nSave function disabled in browser version.`);
                    break;
                    
                default:
                    addText(`\nUnknown command. Type HELP for available commands.`);
            }
            
            scrollToBottom();
        }

        // Event Delegation for Game Buttons
        document.addEventListener('click', function(event) {
            const button = event.target.closest('.game-button');
            if (!button) return;
            
            const action = button.dataset.action;
            const next = button.dataset.next;
            const playerClass = button.dataset.class;
            const item = button.dataset.item;
            
            switch(action) {
                case 'selectClass':
                    selectClass(playerClass);
                    break;
                case 'loadScene':
                    loadScene(next);
                    break;
                case 'action':
                    performAction(next);
                    break;
                case 'useItem':
                    useInventoryItem(item);
                    break;
                case 'showInventory':
                    showInventory();
                    break;
                case 'advanceTime':
                    advanceTime(next);
                    break;
            }
        });

        // Event Delegation for Inventory Items
        inventoryItems.addEventListener('click', function(event) {
            const itemElement = event.target.closest('.inventory-item');
            if (!itemElement) return;
            
            const itemId = itemElement.dataset.itemId;
            if (itemId) {
                showItemModal(itemId);
            }
        });

        function selectClass(className) {
            gameState.playerClass = className;
            classValue.textContent = className.toUpperCase();
            
            // Add starting items
            startingItems[className].forEach(itemId => {
                addItem(itemId);
            });
            
            updateInventoryDisplay();
            updateStatsDisplay();
            loadScene('classSelected');
        }

        function addItem(itemId) {
            if (!gameState.inventory.some(item => item.id === itemId)) {
                gameState.inventory.push(items[itemId]);
                updateInventoryDisplay();
            }
        }

        function removeItem(itemId) {
            gameState.inventory = gameState.inventory.filter(item => item.id !== itemId);
            updateInventoryDisplay();
        }

        function hasItem(itemId) {
            return gameState.inventory.some(item => item.id === itemId);
        }

        function updateInventoryDisplay() {
            inventoryItems.innerHTML = '';
            
            if (gameState.inventory.length === 0) {
                inventoryItems.innerHTML = '<div style="color: #888; font-style: italic;">No items</div>';
                return;
            }
            
            gameState.inventory.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'inventory-item';
                itemElement.dataset.itemId = item.id;
                itemElement.innerHTML = `
                    <span>${item.name}</span>
                    ${item.usable ? '<button class="item-use-btn">USE</button>' : ''}
                `;
                inventoryItems.appendChild(itemElement);
            });
        }

        function updateCluesDisplay() {
            cluesList.innerHTML = '';
            
            if (gameState.clues.length === 0) {
                cluesList.innerHTML = '<div style="color: #888; font-style: italic;">No clues yet</div>';
                return;
            }
            
            gameState.clues.forEach(clue => {
                const clueElement = document.createElement('div');
                clueElement.className = 'clue-item';
                clueElement.textContent = clue;
                cluesList.appendChild(clueElement);
            });
        }

        function addClue(clueText) {
            if (!gameState.clues.includes(clueText)) {
                gameState.clues.push(clueText);
                updateCluesDisplay();
            }
        }

        function updateStatsDisplay() {
            let statsHTML = `
                <div>Day: ${gameState.day}</div>
                <div>Time: ${gameState.time}</div>
                <div>Reputation: ${gameState.reputation}/100</div>
                <div>Money: ${gameState.money} RM</div>
                <div>Stamina: ${gameState.stamina}/100</div>
                <div>Location: ${gameState.location}</div>
            `;
            
            statsDisplay.innerHTML = statsHTML;
            
            // Update health and suspicion bars
            healthBar.style.width = `${gameState.health}%`;
            healthText.textContent = gameState.health;
            suspicionBar.style.width = `${gameState.suspicion}%`;
            suspicionText.textContent = gameState.suspicion;
            
            // Update status bar color based on suspicion
            const statusBar = document.getElementById('status-bar');
            if (gameState.suspicion > 70) {
                statusBar.style.borderTopColor = '#f00';
            } else if (gameState.suspicion > 40) {
                statusBar.style.borderTopColor = '#ff0';
            } else {
                statusBar.style.borderTopColor = '#0a0';
            }
            
            // Update money in money item
            const moneyItem = items.money;
            if (moneyItem) {
                moneyItem.description = `Cash: ${gameState.money} RM`;
            }
        }

        function updateHealthDisplay() {
            healthBar.style.width = `${gameState.health}%`;
            healthText.textContent = gameState.health;
        }

        function showItemModal(itemId) {
            const item = items[itemId];
            if (!item) return;
            
            modalItemName.textContent = item.name;
            modalItemDescription.textContent = item.description;
            
            modalButtons.innerHTML = '';
            
            if (item.usable) {
                const useButton = document.createElement('button');
                useButton.className = 'game-button';
                useButton.textContent = item.useText || 'USE';
                useButton.addEventListener('click', () => {
                    useInventoryItem(itemId);
                    hideModal();
                });
                modalButtons.appendChild(useButton);
            }
            
            const closeButton = document.createElement('button');
            closeButton.className = 'game-button';
            closeButton.textContent = 'CLOSE';
            closeButton.addEventListener('click', hideModal);
            modalButtons.appendChild(closeButton);
            
            itemModal.classList.remove('hidden');
            modalOverlay.classList.remove('hidden');
        }

        function hideModal() {
            itemModal.classList.add('hidden');
            modalOverlay.classList.add('hidden');
        }

        function useInventoryItem(itemId) {
            const item = items[itemId];
            if (!item || !item.usable) {
                addText(`\nCannot use ${item?.name || 'that item'}.`);
                return;
            }
            
            // Check class restriction
            if (item.classRestriction && !item.classRestriction.includes(gameState.playerClass)) {
                addText(`\nYou are not trained to use ${item.name}.`);
                return;
            }
            
            // Apply item effect
            const effect = item.useEffect(gameState.currentScene);
            
            if (effect) {
                // Apply effects to game state
                if (effect.suspicion) {
                    gameState.suspicion = Math.max(0, Math.min(100, gameState.suspicion + effect.suspicion));
                }
                
                if (effect.health) {
                    gameState.health = Math.min(100, gameState.health + effect.health);
                }
                
                if (effect.stamina) {
                    gameState.stamina = Math.min(100, gameState.stamina + effect.stamina);
                }
                
                updateStatsDisplay();
            } else {
                addText(`\nUsing ${item.name} has no effect here.`);
            }
            
            scrollToBottom();
        }

        function showInventory() {
            addText(`\n\nINVENTORY ITEMS:\n${gameState.inventory.map(item => `- ${item.name}: ${item.description}`).join('\n')}`);
            scrollToBottom();
        }

        function displayStatus() {
            const statusText = `
FULL STATUS REPORT:
===================
CLASS: ${gameState.playerClass ? gameState.playerClass.toUpperCase() : 'NONE'}
HEALTH: ${gameState.health}/100
SUSPICION: ${gameState.suspicion}/100
REPUTATION: ${gameState.reputation}/100
STAMINA: ${gameState.stamina}/100
MONEY: ${gameState.money} RM
DAY: ${gameState.day}
TIME: ${gameState.time}

CLUES FOUND: ${gameState.clues.length}
INVENTORY ITEMS: ${gameState.inventory.length}
            `;
            
            addText(statusText);
        }

        function performAction(actionId) {
            switch(actionId) {
                case 'burnMessage':
                    addText(`\n\nYou carefully burn the message. Evidence destroyed.`);
                    gameState.suspicion = Math.max(0, gameState.suspicion - 5);
                    updateStatsDisplay();
                    setTimeout(() => loadScene('apartment'), 1500);
                    break;
                    
                case 'acceptCase':
                    addText(`\n\nYou accept the case file. Added to clues.`);
                    addClue('Missing archivist case file');
                    setTimeout(() => loadScene('apartment'), 1500);
                    break;
                    
                case 'askAboutAlexanderplatz':
                    addText(`\n\n"Alexanderplatz?" Bauer frowns. "Why do you ask? There have been... incidents there lately. Suspicious gatherings. The Gestapo has been watching. I'd avoid it unless on official business."`);
                    buttonContainer.innerHTML = `
                        <button class="game-button" data-action="loadScene" data-next="apartment">THANK HIM AND LEAVE</button>
                        <button class="game-button" data-action="action" data-next="askIncidents">ASK ABOUT THE INCIDENTS</button>
                    `;
                    break;
                    
                case 'askIncidents':
                    addText(`\n\n"Disappearances. People meeting with unknown contacts. The Gestapo is conducting 'interviews'. I shouldn't say more." Bauer looks uncomfortable. "Be careful."`);
                    buttonContainer.innerHTML = `
                        <button class="game-button" data-action="loadScene" data-next="apartment">RETURN TO APARTMENT</button>
                    `;
                    break;
                    
                case 'vogelRevelation':
                    // Already handled in scene
                    break;
                    
                case 'runWithVogel':
                    addText(`\n\nYou grab Vogel and run into the U-Bahn tunnels. Shouts echo behind you as you disappear into the darkness.`);
                    addClue('Vogel\'s notebook with camp records');
                    addItem('key');
                    gameState.suspicion += 20;
                    updateStatsDisplay();
                    setTimeout(() => loadScene('tunnelEscape'), 2000);
                    break;
                    
                // More actions would be implemented here...
            }
            
            scrollToBottom();
        }

        function advanceTime(nextScene) {
            // Simple time advancement
            const times = ['06:00', '08:00', '12:00', '15:00', '18:00', '20:00', '22:00'];
            const currentIndex = times.indexOf(gameState.time);
            
            if (currentIndex < times.length - 1) {
                gameState.time = times[currentIndex + 1];
            } else {
                gameState.time = '06:00';
                gameState.day++;
            }
            
            updateStatsDisplay();
            loadScene(nextScene);
        }

        // Initialize game when page loads
        window.addEventListener('DOMContentLoaded', initGame);
        
        // Keep input focused on mobile
        document.addEventListener('touchstart', function() {
            inputLine.focus();
        });
    </script>
</body>
</html>
