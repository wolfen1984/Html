<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Dracula: Vampire Hunter</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
touch-action: manipulation;
user-select: none;
-webkit-user-select: none;
font-family: 'Arial', sans-serif;
}

:root {
--common-color: #a0a0a0;
--uncommon-color: #2ecc71;
--rare-color: #3498db;
--epic-color: #9b59b6;
--legendary-color: #f1c40f;
--health-color: #e74c3c;
--mana-color: #3498db;
--xp-color: #2ecc71;
--gold-color: #f1c40f;
--night-bg: linear-gradient(to bottom, black, black);
--day-bg: linear-gradient(to bottom, black, black);
}

body {
background-color: #000000;
background: var(--night-bg);
color: white;
overflow: hidden;
width: 100vw;
height:100vh;
position: fixed;
}

#game-container {
width: 100%;
height: 60%;
position: relative;
display: flex;
flex-direction: column;
transition: background 1s;
}

/* Header Section */
#header {
padding: 10px;
background-color: rgba(0, 0, 0, 0.7);
border-bottom: 2px solid #800;
display: flex;
justify-content: space-between;
z-index: 10;
}

    /* Target just the gold amount number */
#player-gold {
    font-size: 20px; /* Adjust this value as needed */
    font-weight: bold; /* Optional: makes it stand out more */
}
    
#player-info {
display: flex;
flex-direction: column;
}

#player-name {
font-weight: bold;
color: #f88;
}

#player-stats {
display: flex;
gap: 15px;
}

.stat {
display: flex;
align-items: center;
font-size: 20px;
}

.stat-icon {
margin-right: 5px;
font-size: 20px;
}

.health-icon { color: var(--health-color); }
.mana-icon { color: var(--mana-color); }
.xp-icon { color: var(--xp-color); }
.gold-icon { color: var(--gold-color); }

/* Progress Bars */
.progress-container {
width: 100px;
background-color: rgba(0, 0, 0, 0.5);
border-radius: 3px;
overflow: hidden;
position: relative;
}

.progress-bar {
height: 10px;
transition: width 0.3s;
}

#player-health-bar { background-color: var(--health-color); }
#player-mana-bar { background-color: var(--mana-color); }
#player-xp-bar { background-color: var(--xp-color); }

.progress-text {
font-size: 20px;
text-align: center;
margin-top: 2px;
}

/* Main Content */
#main-content {
flex: 1;
padding: 10px;
overflow-y: auto;
position: relative;
}

/* Time Display */
#time-display {
position: absolute;
top: 5px;
right: 5px;
background-color: rgba(0, 0, 0, 0.7);
padding: 3px 8px;
border-radius: 10px;
font-size: 12px;
z-index: 5;
}

/* Combat Log */
#combat-log {
height: 120px;
overflow-y: auto;
margin-bottom: 10px;
padding: 5px;
background-color: rgba(0, 0, 0, 0.7);
border: 1px solid #333;
font-size: 14px;
border-radius: 5px;
}

.combat-message {
margin-bottom: 3px;
line-height: 1.3;
animation: fadeIn 0.3s;
}

@keyframes fadeIn {
from { opacity: 0; transform: translateY(5px); }
to { opacity: 1; transform: translateY(0); }
}

.player-message { color: #7af; }
.enemy-message { color: #f77; }
.system-message { color: #7f7; }
.damage-message { color: #f44; font-weight: bold; }
.heal-message { color: #4f4; font-weight: bold; }
.gold-message { color: var(--gold-color); }
.xp-message { color: var(--xp-color); }

/* Enemy Display */
#enemy-display {
text-align: center;
margin: 10px 0;
padding: 10px;
background-color: rgba(red);
border: 2px solid #f00;
border-radius: 5px;
animation: pulse 2s infinite;
}

@keyframes pulse {
0% { box-shadow: 0 0 5px rgba(255, 0, 0, 0.5); }
50% { box-shadow: 0 0 15px rgba(255, 0, 0, 0.8); }
100% { box-shadow: 0 0 5px rgba(255, 0, 0, 0.5); }
}

#enemy-name {
font-size: 18px;
color: red;
text-shadow: 0 0 3px #000;
}

#enemy-level {
font-size: 14px;
color: white;
}

#enemy-health {
height: 20px;
background-color: grey;
margin-top: 5px;
border-radius: 3px;
overflow: hidden;
}

#enemy-health-bar {
height: 100%;
width: 100%;
background-color: #f00;
transition: width 0.3s;
}

/* Action Buttons */
#action-buttons {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 10px;
margin-top: 10px;
}

.btn {
padding: 12px;
color: white;
border: none;
border-radius: 5px;
font-size: 16px;
text-align: center;
transition: all 0.2s;
box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
}

.btn:active {
transform: scale(0.95);
box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.btn-primary {
background-color: #800;
}

.btn-primary:active {
background-color: #a00;
}

.btn-secondary {
background-color: #444;
}

.btn-secondary:active {
background-color: #666;
}

.btn-special {
background-color: #084;
}

.btn-special:active {
background-color: #0a6;
}

.btn-disabled {
opacity: 0.6;
pointer-events: none;
}

/* Footer Navigation */
#footer {
display: grid;
grid-template-columns: 1fr 1fr 1fr 1fr;
background-color: rgba(0, 0, 0, 0.7);
border-top: 2px solid #800;
}

.footer-btn {
padding: 12px;
text-align: center;
color: white;
transition: all 0.2s;
}

.footer-btn:active {
background-color: rgba(255, 255, 255, 0.1);
}

.footer-btn i {
display: block;
font-size: 20px;
margin-bottom: 3px;
}

/* Screens (Inventory, Skills, Quests, Shop) */
.screen {
display: none;
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-color: rgba(0, 0, 0, 0.95);
padding: 15px;
overflow-y: auto;
z-index: 20;
}

.screen-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 15px;
padding-bottom: 10px;
border-bottom: 1px solid #800;
}

.screen-title {
font-size: 20px;
color: #f88;
}

.close-btn {
padding: 5px 10px;
background-color: #800;
border: none;
color: white;
border-radius: 3px;
}

/* Item Rarity Colors */
.common { color: var(--common-color); border-left-color: var(--common-color); }
.uncommon { color: var(--uncommon-color); border-left-color: var(--uncommon-color); }
.rare { color: var(--rare-color); border-left-color: var(--rare-color); }
.epic { color: var(--epic-color); border-left-color: var(--epic-color); }
.legendary { color: var(--legendary-color); border-left-color: var(--legendary-color); }

/* Lists (Items, Skills, Quests, Shop) */
.list {
display: grid;
gap: 10px;
}

.list-item {
background-color: rgba(50, 50, 50, 0.7);
padding: 10px;
border-radius: 5px;
border-left: 3px solid #800;
animation: fadeIn 0.3s;
}

.item-header, .skill-header, .quest-header, .shop-item-header {
display: flex;
justify-content: space-between;
margin-bottom: 5px;
}

.item-name, .skill-name, .quest-name, .shop-item-name {
font-weight: bold;
}

.item-stats, .skill-stats, .quest-stats, .shop-item-stats {
font-size: 14px;
color: #aaa;
}

.item-desc, .skill-desc, .quest-desc, .shop-item-desc {
font-size: 14px;
margin-top: 5px;
color: #ddd;
}

.item-actions {
display: flex;
gap: 5px;
margin-top: 8px;
}

.action-btn {
padding: 5px;
border: none;
border-radius: 3px;
color: white;
flex: 1;
text-align: center;
}

.use-btn { background-color: #084; }
.equip-btn { background-color: #800; }
.buy-btn { background-color: #800; }
.sell-btn { background-color: #444; }

.equipped {
border-left: 3px solid #0f0;
background-color: rgba(0, 50, 0, 0.3);
}

/* Skill Tree */
.skill-tree {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 15px;
margin-top: 15px;
}

.skill-category {
background-color: rgba(30, 30, 30, 0.7);
padding: 10px;
border-radius: 5px;
}

.skill-category-title {
text-align: center;
margin-bottom: 10px;
color: #f88;
font-size: 16px;
}

/* Level Up Notification */
#level-up-notification {
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
background-color: grey;
padding: 20px;
border-radius: 10px;
text-align: center;
z-index: 100;
display: none;
animation: pulse 1.5s infinite;
border: 2px solid gold;
max-width: 80%;
}

#level-up-notification h2 {
color: gold;
margin-bottom: 10px;
text-shadow: 0 0 3px #000;
}

#level-up-notification p {
    color: white; /* Change to any color you want */
    margin: 5px 0;
}

/* Save/Load Buttons */
#save-load-buttons {
position: absolute;
bottom: 60px;
right: 10px;
display: flex;
flex-direction: column;
gap: 5px;
z-index: 5;
}

.save-btn, .load-btn {
background-color: rgba(0, 0, 0, 0.7);
border: 1px solid #444;
color: white;
padding: 5px 10px;
border-radius: 15px;
font-size: 12px;
}

/* Tooltip */
.tooltip {
position: absolute;
background-color: rgba(0, 0, 0, 0.9);
border: 1px solid #800;
padding: 8px;
border-radius: 5px;
z-index: 100;
max-width: 200px;
pointer-events: none;
display: none;
}

/* Animations */
@keyframes shake {
0%, 100% { transform: translateX(0); }
10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
20%, 40%, 60%, 80% { transform: translateX(5px); }
}

.shake {
animation: shake 0.5s;
}

@keyframes flash {
0%, 100% { opacity: 1; }
50% { opacity: 0.3; }
}

.flash {
animation: flash 1s infinite;
}

/* Responsive Adjustments */
@media (max-height: 600px) {
#combat-log {
height: 80px;
}

.btn {
padding: 8px;
font-size: 14px;
}

.footer-btn {
padding: 8px;
font-size: 12px;
}

.footer-btn i {
font-size: 16px;
}
}
</style>
</head>
<body>
<div id="game-container">
<!-- Header Section -->
<div id="header">
<div id="player-info">
<div id="player-name">Dracula <span id="player-level">1</span></div>
<div class="stat">
<span class="stat-icon">&#x2694;&#xFE0F</span>
<span id="player-dmg">5-10</span>
</div>
</div>
<div id="player-stats">
<div class="stat">
<span class="stat-icon health-icon">&#x2764;&#xFE0F;</span>
<div>
<div class="progress-container">
<div class="progress-bar" id="player-health-bar"></div>
</div>
<div class="progress-text"><span id="player-health">50</span>/<span id="player-max-health">50</span></div>
</div>
</div>
<div class="stat">
<span class="stat-icon mana-icon">&#x1F52E</span>
<div>
<div class="progress-container">
<div class="progress-bar" id="player-mana-bar"></div>
</div>
<div class="progress-text"><span id="player-mana">30</span>/<span id="player-max-mana">30</span></div>
</div>
</div>
<div class="stat">
<span class="stat-icon xp-icon">&#x2B50;</span>
<div>
<div class="progress-container">
<div class="progress-bar" id="player-xp-bar"></div>
</div>
<div class="progress-text"><span id="player-xp">0</span>/<span id="player-next-level">100</span></div>
</div>
</div>
<div class="stat">
<span class="stat-icon gold-icon">&#x1F4B0;</span>
<span id="player-gold">50</span>
</div>
</div>
</div>

<!-- Time Display -->
<div id="time-display">Night</div>

<!-- Main Content -->
<div id="main-content">
<div id="combat-log">
<div class="combat-message system-message">Welcome to Transylvania, Dracula. Hunt the night creatures!</div>
</div>

<div id="enemy-display" style="display: none;">
<h3 id="enemy-name">Vampire</h3>
<div>Level <span id="enemy-level">1</span></div>
<div id="enemy-health">
<div id="enemy-health-bar"></div>
</div>
</div>

<div id="action-buttons">
<button id="attack-btn" class="btn btn-primary">Attack</button>
<button id="special-btn" class="btn btn-special">Blood Drain</button>
<button id="heal-btn" class="btn btn-secondary">Heal</button>
<button id="flee-btn" class="btn btn-secondary">Flee</button>
</div>
</div>

<!-- Footer Navigation -->
<div id="footer">
<div class="footer-btn" id="inventory-btn"><i>&#x1F392;</i>Inventory</div>
<div class="footer-btn" id="skills-btn"><i>&#x1F52E;</i>Skills</div>
<div class="footer-btn" id="quests-btn"><i>&#x1F4DC;</i>Quests</div>
<div class="footer-btn" id="shop-btn"><i>&#x1F3EA</i>Shop</div>
</div>

<!-- Save/Load Buttons -->
<div id="save-load-buttons">
<button class="save-btn" id="save-btn">Save</button>
<button class="load-btn" id="load-btn">Load</button>
</div>
</div>

<!-- Inventory Screen -->
<div id="inventory-screen" class="screen">
<div class="screen-header">
<h2 class="screen-title">Inventory</h2>
<button class="close-btn" id="close-inventory">X</button>
</div>
<div id="gold-display" class="stat">
<span class="stat-icon gold-icon">&#x1F392;</span>
<span id="inventory-gold">50</span> gold
</div>
<div class="list" id="inventory-list">
<!-- Items will be added here dynamically -->
</div>
</div>

<!-- Skills Screen -->
<div id="skills-screen" class="screen">
<div class="screen-header">
<h2 class="screen-title">Abilities</h2>
<button class="close-btn" id="close-skills">X</button>
</div>
<div class="skill-tree">
<div class="skill-category">
<div class="skill-category-title">Combat Skills</div>
<div class="list" id="combat-skills-list">
<!-- Combat skills will be added here dynamically -->
</div>
</div>
<div class="skill-category">
<div class="skill-category-title">Utility Skills</div>
<div class="list" id="utility-skills-list">
<!-- Utility skills will be added here dynamically -->
</div>
</div>
</div>
</div>

<!-- Quests Screen -->
<div id="quests-screen" class="screen">
<div class="screen-header">
<h2 class="screen-title">Quests</h2>
<button class="close-btn" id="close-quests">X</button>
</div>
<div class="list" id="quests-list">
<!-- Quests will be added here dynamically -->
</div>
</div>

<!-- Shop Screen -->
<div id="shop-screen" class="screen">
<div class="screen-header">
<h2 class="screen-title">Merchant</h2>
<button class="close-btn" id="close-shop">X</button>
</div>
<div id="shop-gold-display" class="stat">
<span class="stat-icon gold-icon">&#x1F4B0;</span>
<span id="shop-player-gold">50</span> gold
</div>
<div class="list" id="shop-items-list">
<!-- Shop items will be added here dynamically -->
</div>
</div>

<!-- Level Up Notification -->
<div id="level-up-notification">
<h2>Level Up!</h2>
<p>You are now level <span id="new-level">2</span>!</p>
<p>Max HP increased by 10!</p>
<p>Max Mana increased by 5!</p>
<button class="btn btn-primary" id="close-level-up">Continue</button>
</div>

<!-- Tooltip -->
<div id="tooltip" class="tooltip"></div>

<script>
// Game State
const gameState = {
player: {
name: "Dracula",
level: 1,
xp: 0,
nextLevel: 100,
health: 50,
maxHealth: 50,
mana: 30,
maxMana: 30,
gold: 50,
baseMinDmg: 5,
baseMaxDmg: 10,
criticalChance: 0.1,
criticalMultiplier: 1.5,
inventory: [],
equippedWeapon: null,
equippedArmor: null,
skills: [
{ id: 'blood_drain', name: 'Blood Drain', type: 'combat', description: 'Steal life from enemy (Heal 50% of damage)', cost: 15, cooldown: 3, currentCooldown: 0, level: 1, maxLevel: 3 },
{ id: 'vampiric_rage', name: 'Vampiric Rage', type: 'combat', description: 'Double damage for next attack', cost: 20, cooldown: 4, currentCooldown: 0, active: false, level: 0, maxLevel: 2 },
{ id: 'shadow_step', name: 'Shadow Step', type: 'combat', description: '50% chance to avoid enemy attack', cost: 25, cooldown: 5, currentCooldown: 0, active: false, level: 0, maxLevel: 1 },
{ id: 'dark_ritual', name: 'Dark Ritual', type: 'utility', description: 'Convert HP to Mana (1:2 ratio)', cost: 0, cooldown: 2, currentCooldown: 0, level: 0, maxLevel: 1 },
{ id: 'night_vision', name: 'Night Vision', type: 'utility', description: 'Increased damage at night', cost: 0, cooldown: 0, currentCooldown: 0, active: false, level: 1, maxLevel: 3 }
],
quests: [],
perks: [],
gameTime: 0,
enemiesDefeated: 0,
vampiresDefeated: 0,
bossesDefeated: 0,
daysPassed: 0
},
currentEnemy: null,
inCombat: false,
gameLog: [],
isDay: false
};

// Items Database
const itemsDB = {
weapons: [
{ id: 'wooden_stake', name: 'Wooden Stake', type: 'weapon', rarity: 'common', minDmg: 3, maxDmg: 7, value: 10, description: 'Basic weapon against vampires' },
{ id: 'silver_dagger', name: 'Silver Dagger', type: 'weapon', rarity: 'uncommon', minDmg: 8, maxDmg: 14, value: 50, description: 'Silver harms supernatural creatures' },
{ id: 'holy_sword', name: 'Holy Sword', type: 'weapon', rarity: 'rare', minDmg: 15, maxDmg: 25, value: 150, description: 'Blessed weapon with divine power' },
{ id: 'bloodthirster', name: 'Bloodthirster', type: 'weapon', rarity: 'epic', minDmg: 20, maxDmg: 35, value: 300, description: 'A blade that hungers for blood', special: '10% lifesteal' },
{ id: 'draculas_fang', name: "Dracula's Fang", type: 'weapon', rarity: 'legendary', minDmg: 30, maxDmg: 50, value: 500, description: 'A fang from the original Dracula', special: '15% lifesteal, +10% crit chance' }
],
armor: [
{ id: 'leather_armor', name: 'Leather Armor', type: 'armor', rarity: 'common', defense: 5, value: 30, description: 'Basic protection' },
{ id: 'chainmail', name: 'Chainmail', type: 'armor', rarity: 'uncommon', defense: 10, value: 80, description: 'Better protection against physical attacks' },
{ id: 'vampire_cloak', name: 'Vampire Cloak', type: 'armor', rarity: 'rare', defense: 15, value: 200, description: 'Magical cloak that enhances your abilities' },
{ id: 'shadow_veil', name: 'Shadow Veil', type: 'armor', rarity: 'epic', defense: 25, value: 400, description: 'Cloak woven from shadows', special: '+10% dodge chance' },
{ id: 'armor_of_night', name: 'Armor of Night', type: 'armor', rarity: 'legendary', defense: 35, value: 600, description: 'Armor infused with the power of darkness', special: '+15% dodge, +10% HP' }
],
consumables: [
{ id: 'health_potion', name: 'Health Potion', type: 'consumable', rarity: 'common', health: 20, value: 15, description: 'Restores 20 HP' },
{ id: 'greater_potion', name: 'Greater Potion', type: 'consumable', rarity: 'uncommon', health: 50, value: 40, description: 'Restores 50 HP' },
{ id: 'elixir', name: 'Elixir', type: 'consumable', rarity: 'rare', health: 100, value: 100, description: 'Fully restores HP' },
{ id: 'mana_potion', name: 'Mana Potion', type: 'consumable', rarity: 'uncommon', mana: 30, value: 30, description: 'Restores 30 Mana' },
{ id: 'greater_mana_potion', name: 'Greater Mana Potion', type: 'consumable', rarity: 'rare', mana: 60, value: 60, description: 'Restores 60 Mana' }
],
special: [
{ id: 'vampire_blood', name: 'Vampire Blood', type: 'special', rarity: 'rare', value: 75, description: 'Permanently increases max HP by 5', use: 'permanent_hp' },
{ id: 'moonstone', name: 'Moonstone', type: 'special', rarity: 'epic', value: 150, description: 'Permanently increases damage by 1-2', use: 'permanent_dmg' }
]
};

// Enemies Database
const enemiesDB = [
{ id: 'vampire', name: 'Vampire', level: 1, health: 30, maxHealth: 30, minDmg: 4, maxDmg: 8, xp: 25, gold: 10, isBoss: false },
{ id: 'werewolf', name: 'Werewolf', level: 2, health: 50, maxHealth: 50, minDmg: 8, maxDmg: 14, xp: 50, gold: 25, isBoss: false },
{ id: 'ghoul', name: 'Ghoul', level: 1, health: 25, maxHealth: 25, minDmg: 3, maxDmg: 6, xp: 20, gold: 5, isBoss: false },
{ id: 'vampire_lord', name: 'Vampire Lord', level: 3, health: 80, maxHealth: 80, minDmg: 12, maxDmg: 20, xp: 100, gold: 50, isBoss: true },
{ id: 'necromancer', name: 'Necromancer', level: 4, health: 60, maxHealth: 60, minDmg: 15, maxDmg: 25, xp: 120, gold: 75, isBoss: true },
{ id: 'blood_witch', name: 'Blood Witch', level: 5, health: 100, maxHealth: 100, minDmg: 20, maxDmg: 30, xp: 150, gold: 100, isBoss: true }
];

// Quests Database
const questsDB = [
{ id: 'first_blood', name: 'First Blood', description: 'Defeat 5 enemies', reward: 100, target: 5, type: 'enemies_defeated', completed: false, progress: 0 },
{ id: 'vampire_slayer', name: 'Vampire Slayer', description: 'Defeat 3 Vampires', reward: 150, target: 3, type: 'vampires_defeated', completed: false, progress: 0 },
{ id: 'wealthy_hunter', name: 'Wealthy Hunter', description: 'Collect 200 gold', reward: 50, target: 200, type: 'gold_collected', completed: false, progress: 0 },
{ id: 'boss_slayer', name: 'Boss Slayer', description: 'Defeat 1 Boss enemy', reward: 200, target: 1, type: 'bosses_defeated', completed: false, progress: 0 },
{ id: 'night_stalker', name: 'Night Stalker', description: 'Survive 3 nights', reward: 150, target: 3, type: 'nights_survived', completed: false, progress: 0 }
];

// Shop Items
const shopItems = [
{ id: 'health_potion', name: 'Health Potion', type: 'consumable', price: 15, stock: 5 },
{ id: 'mana_potion', name: 'Mana Potion', type: 'consumable', price: 30, stock: 3 },
{ id: 'greater_potion', name: 'Greater Potion', type: 'consumable', price: 40, stock: 2 },
{ id: 'wooden_stake', name: 'Wooden Stake', type: 'weapon', price: 30, stock: 1 },
{ id: 'leather_armor', name: 'Leather Armor', type: 'armor', price: 50, stock: 1 },
{ id: 'vampire_blood', name: 'Vampire Blood', type: 'special', price: 150, stock: 1 }
];

// DOM Elements
const elements = {
// Header
playerName: document.getElementById('player-name'),
playerLevel: document.getElementById('player-level'),
playerDmg: document.getElementById('player-dmg'),
playerHealth: document.getElementById('player-health'),
playerMaxHealth: document.getElementById('player-max-health'),
playerHealthBar: document.getElementById('player-health-bar'),
playerMana: document.getElementById('player-mana'),
playerMaxMana: document.getElementById('player-max-mana'),
playerManaBar: document.getElementById('player-mana-bar'),
playerXp: document.getElementById('player-xp'),
playerNextLevel: document.getElementById('player-next-level'),
playerXpBar: document.getElementById('player-xp-bar'),
playerGold: document.getElementById('player-gold'),

// Main Content
combatLog: document.getElementById('combat-log'),
enemyDisplay: document.getElementById('enemy-display'),
enemyName: document.getElementById('enemy-name'),
enemyLevel: document.getElementById('enemy-level'),
enemyHealthBar: document.getElementById('enemy-health-bar'),
timeDisplay: document.getElementById('time-display'),

// Action Buttons
attackBtn: document.getElementById('attack-btn'),
specialBtn: document.getElementById('special-btn'),
healBtn: document.getElementById('heal-btn'),
fleeBtn: document.getElementById('flee-btn'),

// Footer Buttons
inventoryBtn: document.getElementById('inventory-btn'),
skillsBtn: document.getElementById('skills-btn'),
questsBtn: document.getElementById('quests-btn'),
shopBtn: document.getElementById('shop-btn'),

// Screens
inventoryScreen: document.getElementById('inventory-screen'),
skillsScreen: document.getElementById('skills-screen'),
questsScreen: document.getElementById('quests-screen'),
shopScreen: document.getElementById('shop-screen'),

// Close Buttons
closeInventory: document.getElementById('close-inventory'),
closeSkills: document.getElementById('close-skills'),
closeQuests: document.getElementById('close-quests'),
closeShop: document.getElementById('close-shop'),

// Lists
inventoryList: document.getElementById('inventory-list'),
combatSkillsList: document.getElementById('combat-skills-list'),
utilitySkillsList: document.getElementById('utility-skills-list'),
questsList: document.getElementById('quests-list'),
shopItemsList: document.getElementById('shop-items-list'),

// Gold Displays
inventoryGold: document.getElementById('inventory-gold'),
shopPlayerGold: document.getElementById('shop-player-gold'),

// Level Up
levelUpNotification: document.getElementById('level-up-notification'),
closeLevelUp: document.getElementById('close-level-up'),
newLevel: document.getElementById('new-level'),

// Save/Load
saveBtn: document.getElementById('save-btn'),
loadBtn: document.getElementById('load-btn'),

// Tooltip
tooltip: document.getElementById('tooltip'),

// Game Container
gameContainer: document.getElementById('game-container')
};

// Initialize the game
function initGame() {
// Add starting items
gameState.player.inventory.push({...itemsDB.weapons[0]});
gameState.player.inventory.push({...itemsDB.consumables[0]});
gameState.player.inventory.push({...itemsDB.consumables[0]});

// Equip starting weapon
equipItem(itemsDB.weapons[0].id);

// Add initial quests
gameState.player.quests = JSON.parse(JSON.stringify(questsDB));

// Update UI
updatePlayerStats();
renderQuests();

// Start game time
startGameTime();

// Spawn first enemy
setTimeout(spawnEnemy, 1000);

// Setup event listeners
setupEventListeners();

// Add welcome message
addToCombatLog('Welcome to Transylvania, Dracula. Hunt the night creatures!', 'system');
addToCombatLog('Use the buttons at the bottom to access your inventory, skills, quests, and the shop.', 'system');
}

// Setup event listeners
function setupEventListeners() {
// Combat actions
elements.attackBtn.addEventListener('click', attack);
elements.specialBtn.addEventListener('click', useSpecialSkill);
elements.healBtn.addEventListener('click', useHealthPotion);
elements.fleeBtn.addEventListener('click', flee);

// Navigation
elements.inventoryBtn.addEventListener('click', () => {
elements.inventoryScreen.style.display = 'block';
renderInventory();
});

elements.skillsBtn.addEventListener('click', () => {
elements.skillsScreen.style.display = 'block';
renderSkills();
});

elements.questsBtn.addEventListener('click', () => {
elements.questsScreen.style.display = 'block';
renderQuests();
});

elements.shopBtn.addEventListener('click', () => {
elements.shopScreen.style.display = 'block';
elements.shopPlayerGold.textContent = gameState.player.gold;
renderShop();
});

// Close buttons
elements.closeInventory.addEventListener('click', () => {
elements.inventoryScreen.style.display = 'none';
});

elements.closeSkills.addEventListener('click', () => {
elements.skillsScreen.style.display = 'none';
});

elements.closeQuests.addEventListener('click', () => {
elements.questsScreen.style.display = 'none';
});

elements.closeShop.addEventListener('click', () => {
elements.shopScreen.style.display = 'none';
});

elements.closeLevelUp.addEventListener('click', () => {
elements.levelUpNotification.style.display = 'none';
});

// Save/Load
elements.saveBtn.addEventListener('click', saveGame);
elements.loadBtn.addEventListener('click', loadGame);

// Tooltip
document.addEventListener('mousemove', moveTooltip);
document.addEventListener('touchmove', moveTooltip);
}

// Update player stats in UI
function updatePlayerStats() {
elements.playerHealth.textContent = gameState.player.health;
elements.playerMaxHealth.textContent = gameState.player.maxHealth;
elements.playerHealthBar.style.width = `${(gameState.player.health / gameState.player.maxHealth) * 100}%`;

elements.playerMana.textContent = gameState.player.mana;
elements.playerMaxMana.textContent = gameState.player.maxMana;
elements.playerManaBar.style.width = `${(gameState.player.mana / gameState.player.maxMana) * 100}%`;

elements.playerXp.textContent = gameState.player.xp;
elements.playerNextLevel.textContent = gameState.player.nextLevel;
elements.playerXpBar.style.width = `${(gameState.player.xp / gameState.player.nextLevel) * 100}%`;

elements.playerLevel.textContent = gameState.player.level;
elements.playerGold.textContent = gameState.player.gold;
elements.playerName.textContent = `Dracula Lv.${gameState.player.level}`;

// Calculate player damage
let minDmg = gameState.player.baseMinDmg;
let maxDmg = gameState.player.baseMaxDmg;

if (gameState.player.equippedWeapon) {
minDmg += gameState.player.equippedWeapon.minDmg;
maxDmg += gameState.player.equippedWeapon.maxDmg;
}

// Apply night vision bonus if active and it's night
const nightVision = gameState.player.skills.find(s => s.id === 'night_vision');
if (nightVision && nightVision.level > 0 && !gameState.isDay) {
const bonus = 1 + (nightVision.level * 0.1); // 10% per level
minDmg = Math.floor(minDmg * bonus);
maxDmg = Math.floor(maxDmg * bonus);
}

elements.playerDmg.textContent = `${minDmg}-${maxDmg}`;

// Update skill buttons
updateSkillButtons();
}

// Start game time (day/night cycle)
function startGameTime() {
// Game time advances every 2 minutes (120000ms)
gameState.gameTimeInterval = setInterval(updateGameTime, 120000);
updateGameTime();
}

// Update game time (day/night cycle)
function updateGameTime() {
gameState.gameTime++;

// Toggle between day and night every 2 game time units (4 minutes)
gameState.isDay = gameState.gameTime % 2 === 0;

if (gameState.isDay) {
elements.gameContainer.style.background = 'var(--day-bg)';
elements.timeDisplay.textContent = 'Day';
addToCombatLog('The sun rises. Enemies are weaker during the day.', 'system');
} else {
elements.gameContainer.style.background = 'var(--night-bg)';
elements.timeDisplay.textContent = 'Night';
addToCombatLog('Night falls. Your vampiric powers grow stronger.', 'system');
gameState.player.daysPassed++;
updateQuestProgress('nights_survived');
}

// Update night vision skill state
const nightVision = gameState.player.skills.find(s => s.id === 'night_vision');
if (nightVision && nightVision.level > 0) {
nightVision.active = !gameState.isDay;
}

updatePlayerStats();
}

// Spawn a random enemy
function spawnEnemy() {
if (gameState.inCombat) return;

let enemyPool = [...enemiesDB];

// Filter enemies based on player level
if (gameState.player.level < 2) {
enemyPool = enemyPool.filter(e => !e.isBoss && e.level <= 2);
} else if (gameState.player.level < 3) {
enemyPool = enemyPool.filter(e => e.level <= 3);
} else if (gameState.player.level < 5) {
enemyPool = enemyPool.filter(e => e.level <= 4);
}

// Higher chance for bosses at higher levels
if (gameState.player.level >= 3 && Math.random() < 0.3) {
enemyPool = enemyPool.filter(e => e.isBoss);
}

// Night time makes enemies stronger
const nightMultiplier = gameState.isDay ? 0.8 : 1.2;

const randomEnemy = enemyPool[Math.floor(Math.random() * enemyPool.length)];
gameState.currentEnemy = JSON.parse(JSON.stringify(randomEnemy));

// Scale enemy stats with player level
const levelDiff = gameState.player.level - gameState.currentEnemy.level;
if (levelDiff > 0) {
gameState.currentEnemy.health = Math.floor(gameState.currentEnemy.health * (1 + levelDiff * 0.2) * nightMultiplier);
gameState.currentEnemy.maxHealth = Math.floor(gameState.currentEnemy.maxHealth * (1 + levelDiff * 0.2) * nightMultiplier);
gameState.currentEnemy.minDmg = Math.floor(gameState.currentEnemy.minDmg * (1 + levelDiff * 0.1) * nightMultiplier);
gameState.currentEnemy.maxDmg = Math.floor(gameState.currentEnemy.maxDmg * (1 + levelDiff * 0.1) * nightMultiplier);
gameState.currentEnemy.xp = Math.floor(gameState.currentEnemy.xp * (1 + levelDiff * 0.2));
gameState.currentEnemy.gold = Math.floor(gameState.currentEnemy.gold * (1 + levelDiff * 0.1));
gameState.currentEnemy.level += levelDiff;
} else if (levelDiff < 0) {
// Scale down if player is lower level than enemy base level
gameState.currentEnemy.health = Math.floor(gameState.currentEnemy.health * (1 + levelDiff * 0.1) * nightMultiplier);
gameState.currentEnemy.maxHealth = Math.floor(gameState.currentEnemy.maxHealth * (1 + levelDiff * 0.1) * nightMultiplier);
gameState.currentEnemy.minDmg = Math.floor(gameState.currentEnemy.minDmg * (1 + levelDiff * 0.05) * nightMultiplier);
gameState.currentEnemy.maxDmg = Math.floor(gameState.currentEnemy.maxDmg * (1 + levelDiff * 0.05) * nightMultiplier);
gameState.currentEnemy.xp = Math.floor(gameState.currentEnemy.xp * (1 + levelDiff * 0.1));
gameState.currentEnemy.gold = Math.floor(gameState.currentEnemy.gold * (1 + levelDiff * 0.05));
gameState.currentEnemy.level += levelDiff;
} else {
// Just apply night multiplier
gameState.currentEnemy.health = Math.floor(gameState.currentEnemy.health * nightMultiplier);
gameState.currentEnemy.maxHealth = Math.floor(gameState.currentEnemy.maxHealth * nightMultiplier);
gameState.currentEnemy.minDmg = Math.floor(gameState.currentEnemy.minDmg * nightMultiplier);
gameState.currentEnemy.maxDmg = Math.floor(gameState.currentEnemy.maxDmg * nightMultiplier);
}

// Ensure minimum values
gameState.currentEnemy.health = Math.max(10, gameState.currentEnemy.health);
gameState.currentEnemy.maxHealth = Math.max(10, gameState.currentEnemy.maxHealth);
gameState.currentEnemy.minDmg = Math.max(1, gameState.currentEnemy.minDmg);
gameState.currentEnemy.maxDmg = Math.max(2, gameState.currentEnemy.maxDmg);
gameState.currentEnemy.xp = Math.max(5, gameState.currentEnemy.xp);
gameState.currentEnemy.gold = Math.max(1, gameState.currentEnemy.gold);

elements.enemyName.textContent = gameState.currentEnemy.name;
elements.enemyLevel.textContent = gameState.currentEnemy.level;
elements.enemyHealthBar.style.width = '100%';
elements.enemyDisplay.style.display = 'block';

gameState.inCombat = true;

addToCombatLog(`A ${gameState.currentEnemy.name} (Lv.${gameState.currentEnemy.level}) appears!`, 'system');

// Shake enemy display for emphasis
elements.enemyDisplay.classList.add('shake');
setTimeout(() => {
elements.enemyDisplay.classList.remove('shake');
}, 500);
}

// Attack enemy
function attack() {
if (!gameState.inCombat) return;

// Calculate player damage
let minDmg = gameState.player.baseMinDmg;
let maxDmg = gameState.player.baseMaxDmg;

if (gameState.player.equippedWeapon) {
minDmg += gameState.player.equippedWeapon.minDmg;
maxDmg += gameState.player.equippedWeapon.maxDmg;

// Check for weapon special effects
if (gameState.player.equippedWeapon.special && gameState.player.equippedWeapon.special.includes('lifesteal')) {
const lifestealPercent = parseInt(gameState.player.equippedWeapon.special.match(/\d+/)[0]) / 100;
// Handled in damage calculation
}

if (gameState.player.equippedWeapon.special && gameState.player.equippedWeapon.special.includes('crit chance')) {
const critBonus = parseInt(gameState.player.equippedWeapon.special.match(/\d+/)[0]) / 100;
gameState.player.criticalChance += critBonus;
}
}

// Check for vampiric rage
const vampiricRage = gameState.player.skills.find(s => s.id === 'vampiric_rage');
if (vampiricRage && vampiricRage.active) {
minDmg *= 2;
maxDmg *= 2;
vampiricRage.active = false;
addToCombatLog('Vampiric Rage enhances your attack!', 'player');
}

// Calculate damage
let damage = Math.floor(Math.random() * (maxDmg - minDmg + 1)) + minDmg;

// Check for critical hit
let isCritical = false;
if (Math.random() < gameState.player.criticalChance) {
damage = Math.floor(damage * gameState.player.criticalMultiplier);
isCritical = true;
}

// Apply lifesteal if weapon has it
if (gameState.player.equippedWeapon && gameState.player.equippedWeapon.special && gameState.player.equippedWeapon.special.includes('lifesteal')) {
const lifestealPercent = parseInt(gameState.player.equippedWeapon.special.match(/\d+/)[0]) / 100;
const healAmount = Math.floor(damage * lifestealPercent);
gameState.player.health += healAmount;
if (gameState.player.health > gameState.player.maxHealth) {
gameState.player.health = gameState.player.maxHealth;
}
addToCombatLog(`Lifesteal heals you for ${healAmount} HP!`, 'heal');
updatePlayerStats();
}

gameState.currentEnemy.health -= damage;

if (gameState.currentEnemy.health < 0) gameState.currentEnemy.health = 0;

elements.enemyHealthBar.style.width = `${(gameState.currentEnemy.health / gameState.currentEnemy.maxHealth) * 100}%`;

if (isCritical) {
addToCombatLog(`You critically hit the ${gameState.currentEnemy.name} for ${damage} damage!`, 'damage');
} else {
addToCombatLog(`You hit the ${gameState.currentEnemy.name} for ${damage} damage!`, 'player');
}

// Check if enemy is defeated
if (gameState.currentEnemy.health <= 0) {
enemyDefeated();
return;
}

// Enemy counterattack
setTimeout(enemyAttack, 500);
}

// Enemy attack
function enemyAttack() {
if (!gameState.inCombat) return;

// Check for shadow step dodge
const shadowStep = gameState.player.skills.find(s => s.id === 'shadow_step');
if (shadowStep && shadowStep.level > 0 && Math.random() < 0.5) {
addToCombatLog(`You shadow step away from the ${gameState.currentEnemy.name}'s attack!`, 'system');
return;
}

// Calculate enemy damage
let damage = Math.floor(Math.random() * (gameState.currentEnemy.maxDmg - gameState.currentEnemy.minDmg + 1)) + gameState.currentEnemy.minDmg;

// Apply armor reduction if equipped
if (gameState.player.equippedArmor) {
damage -= gameState.player.equippedArmor.defense;
if (damage < 1) damage = 1;

// Check for armor special effects
if (gameState.player.equippedArmor.special && gameState.player.equippedArmor.special.includes('dodge')) {
const dodgePercent = parseInt(gameState.player.equippedArmor.special.match(/\d+/)[0]) / 100;
if (Math.random() < dodgePercent) {
addToCombatLog(`You dodge the ${gameState.currentEnemy.name}'s attack!`, 'system');
return;
}
}
}

gameState.player.health -= damage;

if (gameState.player.health < 0) gameState.player.health = 0;

updatePlayerStats();

addToCombatLog(`The ${gameState.currentEnemy.name} hits you for ${damage} damage!`, 'enemy');

// Check if player is defeated
if (gameState.player.health <= 0) {
playerDefeated();
}
}

// Use special skill
function useSpecialSkill() {
if (!gameState.inCombat) return;

const bloodDrain = gameState.player.skills.find(s => s.id === 'blood_drain');

if (bloodDrain.currentCooldown > 0) {
addToCombatLog(`Blood Drain is on cooldown for ${bloodDrain.currentCooldown} more turns.`, 'system');
return;
}

if (gameState.player.mana < bloodDrain.cost) {
addToCombatLog(`Not enough mana for Blood Drain! (Need ${bloodDrain.cost})`, 'system');
return;
}

// Calculate damage
let minDmg = gameState.player.baseMinDmg;
let maxDmg = gameState.player.baseMaxDmg;

if (gameState.player.equippedWeapon) {
minDmg += gameState.player.equippedWeapon.minDmg;
maxDmg += gameState.player.equippedWeapon.maxDmg;
}

// Apply skill level bonus
const damageBonus = 1 + (bloodDrain.level * 0.15); // 15% more damage per level
minDmg = Math.floor(minDmg * damageBonus);
maxDmg = Math.floor(maxDmg * damageBonus);

const damage = Math.floor(Math.random() * (maxDmg - minDmg + 1)) + minDmg;
const healAmount = Math.floor(damage * (0.5 + (bloodDrain.level * 0.1))); // 50% + 10% per level

gameState.currentEnemy.health -= damage;
gameState.player.health += healAmount;
gameState.player.mana -= bloodDrain.cost;

if (gameState.player.health > gameState.player.maxHealth) {
gameState.player.health = gameState.player.maxHealth;
}

if (gameState.currentEnemy.health < 0) gameState.currentEnemy.health = 0;

elements.enemyHealthBar.style.width = `${(gameState.currentEnemy.health / gameState.currentEnemy.maxHealth) * 100}%`;

bloodDrain.currentCooldown = bloodDrain.cooldown;
updatePlayerStats();
updateSkillButtons();

addToCombatLog(`You drain ${damage} life from the ${gameState.currentEnemy.name} and heal ${healAmount} HP!`, 'player');
addToCombatLog(`Used ${bloodDrain.cost} Mana.`, 'system');

// Check if enemy is defeated
if (gameState.currentEnemy.health <= 0) {
enemyDefeated();
return;
}

// Enemy counterattack
setTimeout(enemyAttack, 500);
}

// Use health potion
function useHealthPotion() {
const potion = gameState.player.inventory.find(item =>
item.id === 'health_potion' ||
item.id === 'greater_potion' ||
item.id === 'elixir'
);

if (!potion) {
addToCombatLog('You have no health potions!', 'system');
return;
}

let healAmount = 0;

if (potion.id === 'health_potion') {
healAmount = 20;
} else if (potion.id === 'greater_potion') {
healAmount = 50;
} else if (potion.id === 'elixir') {
healAmount = gameState.player.maxHealth;
}

gameState.player.health += healAmount;

if (gameState.player.health > gameState.player.maxHealth) {
gameState.player.health = gameState.player.maxHealth;
}

// Remove potion from inventory
const potionIndex = gameState.player.inventory.findIndex(item => item.id === potion.id);
if (potionIndex !== -1) {
gameState.player.inventory.splice(potionIndex, 1);
}

updatePlayerStats();
renderInventory();
addToCombatLog(`You use a ${potion.name} and heal ${healAmount} HP.`, 'heal');

// Enemy gets a free attack if in combat
if (gameState.inCombat) {
setTimeout(enemyAttack, 500);
}
}

// Use mana potion
function useManaPotion() {
const potion = gameState.player.inventory.find(item =>
item.id === 'mana_potion' ||
item.id === 'greater_mana_potion'
);

if (!potion) {
addToCombatLog('You have no mana potions!', 'system');
return;
}

let manaAmount = 0;

if (potion.id === 'mana_potion') {
manaAmount = 30;
} else if (potion.id === 'greater_mana_potion') {
manaAmount = 60;
}

gameState.player.mana += manaAmount;

if (gameState.player.mana > gameState.player.maxMana) {
gameState.player.mana = gameState.player.maxMana;
}

// Remove potion from inventory
const potionIndex = gameState.player.inventory.findIndex(item => item.id === potion.id);
if (potionIndex !== -1) {
gameState.player.inventory.splice(potionIndex, 1);
}

updatePlayerStats();
renderInventory();
addToCombatLog(`You use a ${potion.name} and restore ${manaAmount} Mana.`, 'system');
}

// Use dark ritual (convert HP to Mana)
function useDarkRitual() {
const darkRitual = gameState.player.skills.find(s => s.id === 'dark_ritual');

if (darkRitual.currentCooldown > 0) {
addToCombatLog(`Dark Ritual is on cooldown for ${darkRitual.currentCooldown} more turns.`, 'system');
return;
}

const hpCost = 10;
if (gameState.player.health <= hpCost) {
addToCombatLog(`Not enough HP for Dark Ritual! (Need ${hpCost})`, 'system');
return;
}

const manaGain = 20;

gameState.player.health -= hpCost;
gameState.player.mana += manaGain;

if (gameState.player.mana > gameState.player.maxMana) {
gameState.player.mana = gameState.player.maxMana;
}

darkRitual.currentCooldown = darkRitual.cooldown;
updatePlayerStats();
renderSkills();

addToCombatLog(`You sacrifice ${hpCost} HP to gain ${manaGain} Mana.`, 'system');
}

// Flee from combat
function flee() {
if (!gameState.inCombat) return;

const fleeChance = 0.6; // 60% chance to flee

if (Math.random() < fleeChance) {
addToCombatLog(`You successfully flee from the ${gameState.currentEnemy.name}!`, 'system');
endCombat();
} else {
addToCombatLog(`You fail to flee from the ${gameState.currentEnemy.name}!`, 'system');
setTimeout(enemyAttack, 500);
}
}

// Enemy defeated
function enemyDefeated() {
const xpGained = gameState.currentEnemy.xp;
const goldGained = gameState.currentEnemy.gold;

gameState.player.xp += xpGained;
gameState.player.gold += goldGained;
gameState.enemiesDefeated++;

// Track specific enemy types
if (gameState.currentEnemy.id === 'vampire') {
gameState.vampiresDefeated++;
}

if (gameState.currentEnemy.isBoss) {
gameState.bossesDefeated++;
}

addToCombatLog(`You defeated the ${gameState.currentEnemy.name} and gained ${xpGained} XP and ${goldGained} gold!`, 'system');

// Random loot drop
if (Math.random() < 0.3) {
const possibleDrops = [...itemsDB.consumables];
if (gameState.currentEnemy.isBoss) {
possibleDrops.push(...itemsDB.weapons.filter(w => w.rarity === 'rare'));
possibleDrops.push(...itemsDB.armor.filter(a => a.rarity === 'rare'));
}

const droppedItem = possibleDrops[Math.floor(Math.random() * possibleDrops.length)];
gameState.player.inventory.push({...droppedItem});

addToCombatLog(`The enemy dropped a ${droppedItem.name}!`, 'system');
}

// Update quest progress
updateQuestProgress('enemies_defeated');
if (gameState.currentEnemy.id === 'vampire') {
updateQuestProgress('vampires_defeated');
}
if (gameState.currentEnemy.isBoss) {
updateQuestProgress('bosses_defeated');
}

// Check for level up
checkLevelUp();

// End combat
endCombat();

// Spawn new enemy after delay
setTimeout(spawnEnemy, 2000);
}

// Player defeated
function playerDefeated() {
addToCombatLog(`You were defeated by the ${gameState.currentEnemy.name}!`, 'system');
addToCombatLog('Game Over! Refresh to play again.', 'system');

// Disable buttons
elements.attackBtn.disabled = true;
elements.specialBtn.disabled = true;
elements.healBtn.disabled = true;
elements.fleeBtn.disabled = true;

gameState.inCombat = false;

// Stop game time
clearInterval(gameState.gameTimeInterval);
}

// End combat
function endCombat() {
gameState.inCombat = false;
elements.enemyDisplay.style.display = 'none';

// Reduce cooldowns
gameState.player.skills.forEach(skill => {
if (skill.currentCooldown > 0) {
skill.currentCooldown--;
}
});

updateSkillButtons();
}

// Check for level up
function checkLevelUp() {
if (gameState.player.xp >= gameState.player.nextLevel) {
gameState.player.level++;
gameState.player.xp -= gameState.player.nextLevel;
gameState.player.nextLevel = Math.floor(gameState.player.nextLevel * 1.5);
gameState.player.maxHealth += 10;
gameState.player.health = gameState.player.maxHealth;
gameState.player.maxMana += 5;
gameState.player.mana = gameState.player.maxMana;

// Show level up notification
elements.newLevel.textContent = gameState.player.level;
elements.levelUpNotification.style.display = 'block';

addToCombatLog(`You leveled up to level ${gameState.player.level}!`, 'system');

updatePlayerStats();
}
}

// Update quest progress
function updateQuestProgress(type) {
gameState.player.quests.forEach(quest => {
if (quest.completed) return;

if (type === 'enemies_defeated' && quest.type === 'enemies_defeated') {
quest.progress = gameState.enemiesDefeated;
if (quest.progress >= quest.target) {
quest.completed = true;
gameState.player.gold += quest.reward;
addToCombatLog(`Quest "${quest.name}" completed! You earned ${quest.reward} gold.`, 'gold');
updatePlayerStats();
}
} else if (type === 'vampires_defeated' && quest.type === 'vampires_defeated') {
quest.progress = gameState.vampiresDefeated;
if (quest.progress >= quest.target) {
quest.completed = true;
gameState.player.gold += quest.reward;
addToCombatLog(`Quest "${quest.name}" completed! You earned ${quest.reward} gold.`, 'gold');
updatePlayerStats();
}
} else if (type === 'gold_collected' && quest.type === 'gold_collected') {
quest.progress = gameState.player.gold;
if (quest.progress >= quest.target) {
quest.completed = true;
gameState.player.gold += quest.reward;
addToCombatLog(`Quest "${quest.name}" completed! You earned ${quest.reward} gold.`, 'gold');
updatePlayerStats();
}
} else if (type === 'bosses_defeated' && quest.type === 'bosses_defeated') {
quest.progress = gameState.bossesDefeated;
if (quest.progress >= quest.target) {
quest.completed = true;
gameState.player.gold += quest.reward;
addToCombatLog(`Quest "${quest.name}" completed! You earned ${quest.reward} gold.`, 'gold');
updatePlayerStats();
}
} else if (type === 'nights_survived' && quest.type === 'nights_survived') {
quest.progress = gameState.daysPassed;
if (quest.progress >= quest.target) {
quest.completed = true;
gameState.player.gold += quest.reward;
addToCombatLog(`Quest "${quest.name}" completed! You earned ${quest.reward} gold.`, 'gold');
updatePlayerStats();
}
}
});

renderQuests();
}

// Equip item
function equipItem(itemId) {
const item = itemsDB.weapons.concat(itemsDB.armor).find(i => i.id === itemId);

if (!item) return;

if (item.type === 'weapon') {
gameState.player.equippedWeapon = {...item};
addToCombatLog(`You equipped ${item.name}.`, 'system');
} else if (item.type === 'armor') {
gameState.player.equippedArmor = {...item};
addToCombatLog(`You equipped ${item.name}.`, 'system');
}

updatePlayerStats();
renderInventory();
}

// Use item
function useItem(itemId) {
const item = gameState.player.inventory.find(i => i.id === itemId);

if (!item) return;

if (item.type === 'consumable') {
if (item.id === 'health_potion' || item.id === 'greater_potion' || item.id === 'elixir') {
useHealthPotion();
} else if (item.id === 'mana_potion' || item.id === 'greater_mana_potion') {
useManaPotion();
}
} else if (item.type === 'special') {
if (item.use === 'permanent_hp') {
gameState.player.maxHealth += 5;
gameState.player.health += 5;

// Remove item from inventory
const itemIndex = gameState.player.inventory.findIndex(i => i.id === itemId);
if (itemIndex !== -1) {
gameState.player.inventory.splice(itemIndex, 1);
}

addToCombatLog(`You used ${item.name}. Max HP increased by 5!`, 'heal');
updatePlayerStats();
renderInventory();
} else if (item.use === 'permanent_dmg') {
gameState.player.baseMinDmg += 1;
gameState.player.baseMaxDmg += 2;

// Remove item from inventory
const itemIndex = gameState.player.inventory.findIndex(i => i.id === itemId);
if (itemIndex !== -1) {
gameState.player.inventory.splice(itemIndex, 1);
}

addToCombatLog(`You used ${item.name}. Base damage increased by 1-2!`, 'system');
updatePlayerStats();
renderInventory();
}
} else if (item.type === 'weapon' || item.type === 'armor') {
equipItem(itemId);
}
}

// Buy item from shop
function buyItem(itemId) {
const shopItem = shopItems.find(i => i.id === itemId);

if (!shopItem) return;

if (gameState.player.gold >= shopItem.price) {
gameState.player.gold -= shopItem.price;

// Find the actual item in itemsDB
let itemToAdd;
if (shopItem.type === 'consumable') {
itemToAdd = itemsDB.consumables.find(i => i.id === itemId);
} else if (shopItem.type === 'weapon') {
itemToAdd = itemsDB.weapons.find(i => i.id === itemId);
} else if (shopItem.type === 'armor') {
itemToAdd = itemsDB.armor.find(i => i.id === itemId);
} else if (shopItem.type === 'special') {
itemToAdd = itemsDB.special.find(i => i.id === itemId);
}

if (itemToAdd) {
gameState.player.inventory.push({...itemToAdd});
addToCombatLog(`You bought a ${itemToAdd.name} for ${shopItem.price} gold.`, 'system');

// Reduce shop stock
shopItem.stock--;
if (shopItem.stock <= 0) {
const shopIndex = shopItems.findIndex(i => i.id === itemId);
if (shopIndex !== -1) {
shopItems.splice(shopIndex, 1);
}
}
}

updatePlayerStats();
elements.shopPlayerGold.textContent = gameState.player.gold;
renderShop();
renderInventory();
} else {
addToCombatLog('Not enough gold!', 'system');
}
}

// Upgrade skill
function upgradeSkill(skillId) {
const skill = gameState.player.skills.find(s => s.id === skillId);

if (!skill) return;

// Check if skill can be upgraded further
if (skill.level >= skill.maxLevel) {
addToCombatLog(`${skill.name} is already at max level!`, 'system');
return;
}

// Check if player has enough skill points (1 per level)
const skillPoints = Math.floor(gameState.player.level / 2) - gameState.player.skills.reduce((sum, s) => sum + s.level, 0);

if (skillPoints <= 0) {
addToCombatLog('Not enough skill points! Level up to gain more.', 'system');
return;
}

// Upgrade skill
skill.level++;

// Apply immediate effects if needed
if (skill.id === 'night_vision') {
skill.active = !gameState.isDay;
}

addToCombatLog(`${skill.name} upgraded to level ${skill.level}!`, 'system');
updatePlayerStats();
renderSkills();
}

// Update skill buttons
function updateSkillButtons() {
const bloodDrain = gameState.player.skills.find(s => s.id === 'blood_drain');

if (bloodDrain.currentCooldown > 0) {
elements.specialBtn.textContent = `Blood Drain (${bloodDrain.currentCooldown})`;
elements.specialBtn.classList.add('btn-disabled');
} else {
elements.specialBtn.textContent = 'Blood Drain';
elements.specialBtn.classList.remove('btn-disabled');
}

if (gameState.player.mana < bloodDrain.cost) {
elements.specialBtn.classList.add('btn-disabled');
} else {
elements.specialBtn.classList.remove('btn-disabled');
}
}

// Add message to combat log
function addToCombatLog(message, type) {
const messageElement = document.createElement('div');
messageElement.classList.add('combat-message');

if (type === 'player') {
messageElement.classList.add('player-message');
} else if (type === 'enemy') {
messageElement.classList.add('enemy-message');
} else if (type === 'system') {
messageElement.classList.add('system-message');
} else if (type === 'damage') {
messageElement.classList.add('damage-message');
} else if (type === 'heal') {
messageElement.classList.add('heal-message');
} else if (type === 'gold') {
messageElement.classList.add('gold-message');
} else if (type === 'xp') {
messageElement.classList.add('xp-message');
}

messageElement.textContent = message;
elements.combatLog.appendChild(messageElement);

// Auto-scroll to bottom
elements.combatLog.scrollTop = elements.combatLog.scrollHeight;

// Keep only the last 50 messages
if (elements.combatLog.children.length > 50) {
elements.combatLog.removeChild(elements.combatLog.children[0]);
}
}

// Render inventory
function renderInventory() {
elements.inventoryList.innerHTML = '';
elements.inventoryGold.textContent = gameState.player.gold;

if (gameState.player.inventory.length === 0) {
elements.inventoryList.innerHTML = '<div class="list-item">Your inventory is empty.</div>';
return;
}

// Group items by type for better organization
const groupedItems = {
weapons: [],
armor: [],
consumables: [],
special: []
};

gameState.player.inventory.forEach(item => {
if (item.type === 'weapon') groupedItems.weapons.push(item);
else if (item.type === 'armor') groupedItems.armor.push(item);
else if (item.type === 'consumable') groupedItems.consumables.push(item);
else if (item.type === 'special') groupedItems.special.push(item);
});

// Render each category
if (groupedItems.weapons.length > 0) {
const categoryHeader = document.createElement('div');
categoryHeader.className = 'list-item';
categoryHeader.textContent = 'Weapons';
categoryHeader.style.fontWeight = 'bold';
categoryHeader.style.borderLeft = '3px solid #800';
elements.inventoryList.appendChild(categoryHeader);

groupedItems.weapons.forEach(item => renderInventoryItem(item));
}

if (groupedItems.armor.length > 0) {
const categoryHeader = document.createElement('div');
categoryHeader.className = 'list-item';
categoryHeader.textContent = 'Armor';
categoryHeader.style.fontWeight = 'bold';
categoryHeader.style.borderLeft = '3px solid #800';
elements.inventoryList.appendChild(categoryHeader);

groupedItems.armor.forEach(item => renderInventoryItem(item));
}

if (groupedItems.consumables.length > 0) {
const categoryHeader = document.createElement('div');
categoryHeader.className = 'list-item';
categoryHeader.textContent = 'Consumables';
categoryHeader.style.fontWeight = 'bold';
categoryHeader.style.borderLeft = '3px solid #800';
elements.inventoryList.appendChild(categoryHeader);

groupedItems.consumables.forEach(item => renderInventoryItem(item));
}

if (groupedItems.special.length > 0) {
const categoryHeader = document.createElement('div');
categoryHeader.className = 'list-item';
categoryHeader.textContent = 'Special Items';
categoryHeader.style.fontWeight = 'bold';
categoryHeader.style.borderLeft = '3px solid #800';
elements.inventoryList.appendChild(categoryHeader);

groupedItems.special.forEach(item => renderInventoryItem(item));
}
}

// Render individual inventory item
function renderInventoryItem(item) {
const itemElement = document.createElement('div');
itemElement.className = `list-item ${item.rarity || 'common'}`;

if ((gameState.player.equippedWeapon && gameState.player.equippedWeapon.id === item.id) ||
(gameState.player.equippedArmor && gameState.player.equippedArmor.id === item.id)) {
itemElement.classList.add('equipped');
}

let statsText = '';
if (item.type === 'weapon') {
statsText = `Damage: ${item.minDmg}-${item.maxDmg}`;
if (item.special) statsText += ` | ${item.special}`;
} else if (item.type === 'armor') {
statsText = `Defense: ${item.defense}`;
if (item.special) statsText += ` | ${item.special}`;
} else if (item.type === 'consumable') {
if (item.health) statsText = `Heals ${item.health} HP`;
else if (item.mana) statsText = `Restores ${item.mana} Mana`;
}

itemElement.innerHTML = `
<div class="item-header">
<div class="item-name">${item.name}</div>
<div>${item.value || 0} gold</div>
</div>
<div class="item-stats">${statsText}</div>
<div class="item-desc">${item.description}</div>
<div class="item-actions">
${item.type === 'consumable' || item.type === 'special' ?
`<button class="action-btn use-btn" onclick="useItem('${item.id}')">Use</button>` :
`<button class="action-btn equip-btn" onclick="equipItem('${item.id}')">Equip</button>`
}
</div>
`;

// Add tooltip events
itemElement.addEventListener('mouseenter', (e) => showTooltip(e, item));
itemElement.addEventListener('mouseleave', hideTooltip);
itemElement.addEventListener('touchstart', (e) => showTooltip(e, item));
itemElement.addEventListener('touchend', hideTooltip);

elements.inventoryList.appendChild(itemElement);
}

// Render skills
function renderSkills() {
elements.combatSkillsList.innerHTML = '';
elements.utilitySkillsList.innerHTML = '';

const combatSkills = gameState.player.skills.filter(s => s.type === 'combat');
const utilitySkills = gameState.player.skills.filter(s => s.type === 'utility');

combatSkills.forEach(skill => renderSkillItem(skill, elements.combatSkillsList));
utilitySkills.forEach(skill => renderSkillItem(skill, elements.utilitySkillsList));
}

// Render individual skill
function renderSkillItem(skill, parentElement) {
const skillElement = document.createElement('div');
skillElement.className = 'list-item';

const canUpgrade = skill.level < skill.maxLevel && 
                  (Math.floor(gameState.player.level / 2) - gameState.player.skills.reduce((sum, s) => sum + s.level, 0)) > 0;

skillElement.innerHTML = `
<div class="skill-header">
<div class="skill-name">${skill.name} (Lv.${skill.level}/${skill.maxLevel})</div>
${skill.cost > 0 ? `<div>Cost: ${skill.cost} Mana</div>` : ''}
</div>
<div class="skill-stats">Cooldown: ${skill.cooldown} turns</div>
<div class="skill-desc">${skill.description}</div>
${canUpgrade ? `<button class="action-btn use-btn" onclick="upgradeSkill('${skill.id}')">Upgrade</button>` : ''}
`;

// Add tooltip events
skillElement.addEventListener('mouseenter', (e) => showTooltip(e, skill));
skillElement.addEventListener('mouseleave', hideTooltip);
skillElement.addEventListener('touchstart', (e) => showTooltip(e, skill));
skillElement.addEventListener('touchend', hideTooltip);

parentElement.appendChild(skillElement);
}

// Render quests
function renderQuests() {
elements.questsList.innerHTML = '';

if (gameState.player.quests.length === 0) {
elements.questsList.innerHTML = '<div class="list-item">No active quests.</div>';
return;
}

gameState.player.quests.forEach(quest => {
const questElement = document.createElement('div');
questElement.className = 'list-item';

if (quest.completed) {
questElement.innerHTML = `
<div class="quest-header">
<div class="quest-name">${quest.name} (Completed)</div>
<div>+${quest.reward} gold</div>
</div>
<div class="quest-desc">${quest.description}</div>
`;
} else {
questElement.innerHTML = `
<div class="quest-header">
<div class="quest-name">${quest.name}</div>
<div>Reward: ${quest.reward} gold</div>
</div>
<div class="quest-stats">Progress: ${quest.progress}/${quest.target}</div>
<div class="quest-desc">${quest.description}</div>
<div class="progress-container" style="width: 100%; margin-top: 5px;">
<div class="progress-bar" style="width: ${(quest.progress / quest.target) * 100}%; background-color: #800;"></div>
</div>
`;
}

elements.questsList.appendChild(questElement);
});
}

// Render shop
function renderShop() {
elements.shopItemsList.innerHTML = '';

if (shopItems.length === 0) {
elements.shopItemsList.innerHTML = '<div class="list-item">Shop is empty. Come back later!</div>';
return;
}

// Group items by type
const groupedItems = {
weapons: [],
armor: [],
consumables: [],
special: []
};

shopItems.forEach(item => {
const fullItem = itemsDB.weapons.concat(itemsDB.armor, itemsDB.consumables, itemsDB.special).find(i => i.id === item.id);
if (fullItem) {
if (fullItem.type === 'weapon') groupedItems.weapons.push({...fullItem, price: item.price, stock: item.stock});
else if (fullItem.type === 'armor') groupedItems.armor.push({...fullItem, price: item.price, stock: item.stock});
else if (fullItem.type === 'consumable') groupedItems.consumables.push({...fullItem, price: item.price, stock: item.stock});
else if (fullItem.type === 'special') groupedItems.special.push({...fullItem, price: item.price, stock: item.stock});
}
});

// Render each category
if (groupedItems.weapons.length > 0) {
const categoryHeader = document.createElement('div');
categoryHeader.className = 'list-item';
categoryHeader.textContent = 'Weapons';
categoryHeader.style.fontWeight = 'bold';
categoryHeader.style.borderLeft = '3px solid #800';
elements.shopItemsList.appendChild(categoryHeader);

groupedItems.weapons.forEach(item => renderShopItem(item));
}

if (groupedItems.armor.length > 0) {
const categoryHeader = document.createElement('div');
categoryHeader.className = 'list-item';
categoryHeader.textContent = 'Armor';
categoryHeader.style.fontWeight = 'bold';
categoryHeader.style.borderLeft = '3px solid #800';
elements.shopItemsList.appendChild(categoryHeader);

groupedItems.armor.forEach(item => renderShopItem(item));
}

if (groupedItems.consumables.length > 0) {
const categoryHeader = document.createElement('div');
categoryHeader.className = 'list-item';
categoryHeader.textContent = 'Consumables';
categoryHeader.style.fontWeight = 'bold';
categoryHeader.style.borderLeft = '3px solid #800';
elements.shopItemsList.appendChild(categoryHeader);

groupedItems.consumables.forEach(item => renderShopItem(item));
}

if (groupedItems.special.length > 0) {
const categoryHeader = document.createElement('div');
categoryHeader.className = 'list-item';
categoryHeader.textContent = 'Special Items';
categoryHeader.style.fontWeight = 'bold';
categoryHeader.style.borderLeft = '3px solid #800';
elements.shopItemsList.appendChild(categoryHeader);

groupedItems.special.forEach(item => renderShopItem(item));
}
}

// Render individual shop item
function renderShopItem(item) {
const shopItemElement = document.createElement('div');
shopItemElement.className = `list-item ${item.rarity || 'common'}`;

let statsText = '';
if (item.type === 'weapon') {
statsText = `Damage: ${item.minDmg}-${item.maxDmg}`;
if (item.special) statsText += ` | ${item.special}`;
} else if (item.type === 'armor') {
statsText = `Defense: ${item.defense}`;
if (item.special) statsText += ` | ${item.special}`;
} else if (item.type === 'consumable') {
if (item.health) statsText = `Heals ${item.health} HP`;
else if (item.mana) statsText = `Restores ${item.mana} Mana`;
}

shopItemElement.innerHTML = `
<div class="shop-item-header">
<div class="shop-item-name">${item.name}</div>
<div>${item.price} gold (${item.stock} left)</div>
</div>
<div class="shop-item-stats">${statsText}</div>
<div class="shop-item-desc">${item.description}</div>
<button class="action-btn buy-btn" onclick="buyItem('${item.id}')">Buy</button>
`;

// Add tooltip events
shopItemElement.addEventListener('mouseenter', (e) => showTooltip(e, item));
shopItemElement.addEventListener('mouseleave', hideTooltip);
shopItemElement.addEventListener('touchstart', (e) => showTooltip(e, item));
shopItemElement.addEventListener('touchend', hideTooltip);

elements.shopItemsList.appendChild(shopItemElement);
}

// Show tooltip
function showTooltip(event, item) {
let tooltipText = `<strong>${item.name}</strong><br>`;

if (item.type === 'weapon') {
tooltipText += `Damage: ${item.minDmg}-${item.maxDmg}<br>`;
if (item.special) tooltipText += `Special: ${item.special}<br>`;
} else if (item.type === 'armor') {
tooltipText += `Defense: ${item.defense}<br>`;
if (item.special) tooltipText += `Special: ${item.special}<br>`;
} else if (item.type === 'consumable') {
if (item.health) tooltipText += `Heals: ${item.health} HP<br>`;
if (item.mana) tooltipText += `Restores: ${item.mana} Mana<br>`;
} else if (item.type === 'special') {
tooltipText += `${item.description}<br>`;
} else if (item.type === 'skill') {
tooltipText += `${item.description}<br>`;
tooltipText += `Level: ${item.level}/${item.maxLevel}<br>`;
if (item.cost > 0) tooltipText += `Cost: ${item.cost} Mana<br>`;
tooltipText += `Cooldown: ${item.cooldown} turns<br>`;
}

if (item.rarity) {
tooltipText += `Rarity: <span style="color: var(--${item.rarity}-color)">${item.rarity.charAt(0).toUpperCase() + item.rarity.slice(1)}</span>`;
}

elements.tooltip.innerHTML = tooltipText;
elements.tooltip.style.display = 'block';

// Position tooltip based on event type (mouse or touch)
if (event.type === 'touchstart') {
const touch = event.touches[0];
positionTooltip(touch.clientX, touch.clientY);
} else {
positionTooltip(event.clientX, event.clientY);
}
}

// Position tooltip
function positionTooltip(x, y) {
const tooltip = elements.tooltip;
const padding = 10;

// Position tooltip to the right of the cursor with padding
tooltip.style.left = `${x + padding}px`;
tooltip.style.top = `${y + padding}px`;

// Adjust if tooltip would go off screen
const rect = tooltip.getBoundingClientRect();
if (rect.right > window.innerWidth) {
tooltip.style.left = `${x - rect.width - padding}px`;
}
if (rect.bottom > window.innerHeight) {
tooltip.style.top = `${y - rect.height - padding}px`;
}
}

// Move tooltip (for mouse/touch movement)
function moveTooltip(event) {
if (elements.tooltip.style.display === 'block') {
if (event.type === 'touchmove') {
const touch = event.touches[0];
positionTooltip(touch.clientX, touch.clientY);
} else {
positionTooltip(event.clientX, event.clientY);
}
}
}

// Hide tooltip
function hideTooltip() {
elements.tooltip.style.display = 'none';
}

// Save game
function saveGame() {
try {
localStorage.setItem('draculaGameSave', JSON.stringify(gameState));
addToCombatLog('Game saved successfully!', 'system');
} catch (e) {
addToCombatLog('Failed to save game: ' + e.message, 'system');
}
}

// Load game
function loadGame() {
try {
const savedGame = localStorage.getItem('draculaGameSave');
if (savedGame) {
const parsedGame = JSON.parse(savedGame);

// Merge with current game state to ensure new properties are included
Object.assign(gameState, parsedGame);

// Restart game time interval
clearInterval(gameState.gameTimeInterval);
startGameTime();

// Update UI
updatePlayerStats();
renderInventory();
renderSkills();
renderQuests();

addToCombatLog('Game loaded successfully!', 'system');

// Spawn enemy if not in combat
if (!gameState.inCombat) {
setTimeout(spawnEnemy, 1000);
}
} else {
addToCombatLog('No saved game found!', 'system');
}
} catch (e) {
addToCombatLog('Failed to load game: ' + e.message, 'system');
}
}

// Make functions available globally for HTML onclick
window.useItem = useItem;
window.buyItem = buyItem;
window.equipItem = equipItem;
window.upgradeSkill = upgradeSkill;


// Start the game when page loads
window.onload = initGame;
</script>
</body>
</html>
