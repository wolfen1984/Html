<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dracula's Last Rise - Level 2: The Woodlands</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Retro DOS computer style - Blood Red/Black theme */
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Source Code Pro', 'Courier New', monospace;
            background-color: #000;
            color: #fff;
            margin: 0;
            padding: 10px;
            line-height: 1.5;
            max-width: 100%;
            overflow-x: hidden;
            min-height: 100vh;
            background-image: 
                linear-gradient(rgba(120, 0, 0, 0.15) 1px, transparent 1px),
                linear-gradient(90deg, rgba(120, 0, 0, 0.15) 1px, transparent 1px);
            background-size: 30px 30px;
        }
        
        .container {
            max-width: 700px;
            margin: 0 auto;
            padding: 15px;
            border: 3px solid #cc0000;
            background-color: #000;
            box-shadow: 0 0 30px rgba(204, 0, 0, 0.5);
            position: relative;
            min-height: calc(100vh - 40px);
            overflow: hidden;
        }
        
        /* Scanline effect for authentic CRT monitor feel */
        .container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                transparent 50%,
                rgba(120, 0, 0, 0.1) 50%
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 2;
        }
        
        .header {
            text-align: center;
            border-bottom: 2px dashed #cc0000;
            padding-bottom: 15px;
            margin-bottom: 20px;
            position: relative;
        }
        
        h1 {
            font-family: 'Press Start 2P', 'Courier New', monospace;
            color: #cc0000;
            text-shadow: 0 0 8px #cc0000;
            font-size: 32px;
            margin: 10px 0;
            letter-spacing: 2px;
            text-transform: uppercase;
            font-weight: normal;
        }
        
        h2 {
            font-family: 'Press Start 2P', 'Courier New', monospace;
            color: #fff;
            border-bottom: 1px solid #cc0000;
            padding-bottom: 5px;
            margin-top: 25px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 20px;
            font-weight: normal;
        }
        
        .screen {
            display: none;
            position: relative;
            z-index: 1;
        }
        
        .active-screen {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Level Progress Indicator */
        .level-progress {
            display: flex;
            justify-content: space-between;
            background-color: #111;
            border: 1px solid #cc0000;
            padding: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .level-number {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #333;
            font-weight: bold;
            color: #888;
            background-color: #222;
            font-family: 'Press Start 2P', 'Courier New', monospace;
            font-size: 12px;
        }
        
        .level-number.completed {
            background-color: #220000;
            color: #cc8888;
            border-color: #cc8888;
        }
        
        .level-number.current {
            background-color: #cc0000;
            color: #000;
            border-color: #cc0000;
            box-shadow: 0 0 12px #cc0000;
            text-shadow: 0 0 2px #000;
            font-weight: bold;
        }
        
        /* Stats Bar */
        .stats-bar {
            background-color: #111;
            border: 1px solid #cc0000;
            padding: 10px;
            margin: 15px 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            font-size: 14px;
        }
        
        .stat-item {
            margin: 5px 10px;
        }
        
        .stat-label {
            color: #fff;
        }
        
        .stat-value {
            color: #cc0000;
            font-weight: bold;
            font-size: 16px;
        }
        
        /* Inventory */
        .inventory-container {
            background-color: #111;
            border: 1px solid #cc0000;
            padding: 10px;
            margin: 15px 0;
        }
        
        .inventory-title {
            color: #cc0000;
            margin-bottom: 10px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'Press Start 2P', 'Courier New', monospace;
            font-size: 14px;
        }
        
        .inventory {
            min-height: 60px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .inventory-item {
            display: inline-block;
            background-color: #222;
            border: 1px solid #cc0000;
            padding: 8px 12px;
            color: #fff;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .inventory-item:hover {
            background-color: #333;
            border-color: #ff4444;
            transform: translateY(-2px);
        }
        
        .inventory-item.equipped::after {
            content: "E";
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #cc0000;
            color: #000;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-family: 'Press Start 2P', 'Courier New', monospace;
        }
        
        /* Story Text Area */
        .story-text {
            background-color: #000;
            border: 1px solid #cc0000;
            padding: 15px;
            margin: 20px 0;
            min-height: 200px;
            overflow-y: auto;
            max-height: 350px;
            font-size: 16px;
            line-height: 1.6;
            color: #fff;
        }
        
        /* Choice Buttons */
        .choice-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        
        .choice-btn {
            background-color: #222;
            color: #fff;
            border: 2px solid #cc0000;
            padding: 15px;
            font-family: 'Source Code Pro', 'Courier New', monospace;
            font-size: 16px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .choice-btn:hover, .choice-btn:active {
            background-color: #333;
            color: #ff4444;
            border-color: #ff4444;
            box-shadow: 0 0 10px rgba(255, 68, 68, 0.3);
        }
        
        .choice-btn::after {
            content: ">";
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #cc0000;
            font-weight: bold;
        }
        
        .choice-btn:hover::after {
            color: #ff4444;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-top: 20px;
            gap: 10px;
        }
        
        .action-btn {
            background-color: #222;
            color: #fff;
            border: 2px solid #cc0000;
            padding: 10px 15px;
            font-family: 'Source Code Pro', 'Courier New', monospace;
            font-size: 14px;
            cursor: pointer;
            flex-grow: 1;
            text-align: center;
            transition: all 0.2s;
        }
        
        .action-btn:hover, .action-btn:active {
            background-color: #333;
            color: #ff4444;
            border-color: #ff4444;
        }
        
        /* Dice Roll Display */
        .dice-roll {
            background-color: #330000;
            border: 1px solid #cc0000;
            padding: 10px;
            margin: 10px 0;
            text-align: center;
            color: #cc0000;
            font-weight: bold;
        }
        
        /* Combat Display */
        .combat-log {
            background-color: #550000;
            border: 1px solid #ff0000;
            padding: 10px;
            margin: 10px 0;
            color: #cc0000;
            font-weight: bold;
        }
        
        /* Special Text Styles */
        .game-over {
            color: #f66;
            font-weight: bold;
            text-align: center;
            font-size: 24px;
            margin: 20px;
            text-shadow: 0 0 5px #f66;
            font-family: 'Press Start 2P', 'Courier New', monospace;
        }
        
        .victory {
            color: #cc0000;
            font-weight: bold;
            text-align: center;
            font-size: 24px;
            margin: 20px;
            text-shadow: 0 0 8px #cc0000;
            font-family: 'Press Start 2P', 'Courier New', monospace;
        }
        
        .success {
            color: #6f6;
            font-weight: bold;
        }
        
        .damage {
            color: #f66;
            font-weight: bold;
        }
        
        .enemy {
            color: #fa6;
            font-weight: bold;
        }
        
        .gold {
            color: #ffd700;
            font-weight: bold;
        }
        
        .item {
            color: #8ff;
            font-weight: bold;
        }
        
        .vampire {
            color: #f66;
            font-weight: bold;
            text-shadow: 0 0 3px #f66;
        }
        
        .npc {
            color: #6f9;
            font-weight: bold;
        }
        
        .woodlands {
            color: #6a6;
            font-weight: bold;
        }
        
        .creature {
            color: #a6f;
            font-weight: bold;
        }
        
        .wolf {
            color: #c96;
            font-weight: bold;
        }
        
        .church {
            color: #fc6;
            font-weight: bold;
        }
        
        .cultist {
            color: #f84;
            font-weight: bold;
        }
        
        /* Blinking cursor effect */
        .blinking-cursor {
            display: inline-block;
            width: 10px;
            height: 20px;
            background-color: #cc0000;
            vertical-align: middle;
            margin-left: 5px;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        /* Sound Toggle */
        .sound-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #111;
            border: 1px solid #cc0000;
            color: #fff;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
            z-index: 10;
            font-family: 'Source Code Pro', 'Courier New', monospace;
        }
        
        .sound-toggle:hover {
            background: #222;
            color: #ff4444;
        }
        
        /* New Game Button */
        .new-game-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #111;
            border: 1px solid #cc0000;
            color: #fff;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
            z-index: 10;
            font-family: 'Source Code Pro', 'Courier New', monospace;
        }
        
        .new-game-btn:hover {
            background: #222;
            color: #ff4444;
        }
        
        /* Responsive Design */
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            h2 {
                font-size: 16px;
            }
            
            .stats-bar {
                font-size: 12px;
            }
            
            .choice-btn {
                padding: 12px;
                font-size: 14px;
            }
            
            .level-number {
                width: 25px;
                height: 25px;
                font-size: 10px;
            }
            
            .inventory-title {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sound Toggle -->
        <div class="sound-toggle" onclick="toggleSound()">
            SOUND: <span id="sound-status">ON</span>
        </div>
        
        <!-- New Game Button -->
        <div class="new-game-btn" onclick="newGame()">
            NEW GAME
        </div>
        
        <div class="header">
            <h1>DRACULA'S LAST RISE</h1>
            <h2>LEVEL 2: THE WOODLANDS</h2>
        </div>
        
        <!-- Level Progress Indicator -->
        <div class="level-progress">
            <div class="level-number completed">1</div>
            <div class="level-number current">2</div>
            <div class="level-number">3</div>
            <div class="level-number">4</div>
            <div class="level-number">5</div>
            <div class="level-number">6</div>
            <div class="level-number">7</div>
            <div class="level-number">8</div>
            <div class="level-number">9</div>
            <div class="level-number">10</div>
        </div>
        
        <!-- Game Screen -->
        <div id="screen-game" class="screen active-screen">
            <div class="stats-bar">
                <div class="stat-item"><span class="stat-label">STRENGTH:</span> <span id="stat-strength" class="stat-value">0</span></div>
                <div class="stat-item"><span class="stat-label">HEALTH:</span> <span id="stat-health" class="stat-value">0</span>/<span id="stat-maxhealth" class="stat-value">0</span></div>
                <div class="stat-item"><span class="stat-label">AGILITY:</span> <span id="stat-agility" class="stat-value">0</span></div>
                <div class="stat-item"><span class="stat-label">GOLD:</span> <span id="stat-gold" class="stat-value">0</span></div>
            </div>
            
            <div class="inventory-container">
                <div class="inventory-title">
                    <span>INVENTORY</span>
                    <span id="inventory-count">ITEMS: 0/10</span>
                </div>
                <div class="inventory" id="inventory">
                    <!-- Inventory items will be added here -->
                </div>
            </div>
            
            <h2>THE WOODLANDS</h2>
            <div class="story-text" id="story-text">
                <!-- Story content will be inserted here -->
            </div>
            
            <div class="choice-buttons" id="choice-buttons">
                <!-- Choice buttons will be inserted here -->
            </div>
            
            <div class="action-buttons">
                <button class="action-btn" onclick="useAgility()">USE AGILITY</button>
                <button class="action-btn" onclick="useItem()">USE ITEM</button>
                <button class="action-btn" onclick="saveGame()">SAVE GAME</button>
                <button class="action-btn" onclick="loadGame()">LOAD GAME</button>
            </div>
        </div>
        
        <!-- Level Complete Screen -->
        <div id="screen-complete" class="screen">
            <h2>CHURCH DISCOVERED!</h2>
            <div class="story-text">
                <p class="victory">YOU HAVE COMPLETED LEVEL 2!</p>
                <div style="margin-top: 15px; padding: 10px; background-color: #330000; border: 1px solid #cc0000;">
                    <p>You stand before the ruins of the old church, having survived the dangers of the woodlands. Inside, you found evidence of dark rituals and learned crucial information.</p>
                    <p>A captured cultist, broken by your interrogation, revealed the next phase of Dracula's plan: "The master gathers his strength in the <span class="church">Mountains of Moor</span>. The ancient castle there... it's being prepared for his return."</p>
                    <p>You also discovered a map pointing to a hidden pass through the mountains - the only safe route to Dracula's castle.</p>
                    <p>Your journey continues, but now you have a clear destination and purpose.</p>
                </div>
                
                <div class="stats-bar">
                    <div class="stat-item"><span class="stat-label">FINAL STRENGTH:</span> <span id="complete-stat-strength" class="stat-value">0</span></div>
                    <div class="stat-item"><span class="stat-label">FINAL HEALTH:</span> <span id="complete-stat-health" class="stat-value">0</span></div>
                    <div class="stat-item"><span class="stat-label">FINAL AGILITY:</span> <span id="complete-stat-agility" class="stat-value">0</span></div>
                    <div class="stat-item"><span class="stat-label">FINAL GOLD:</span> <span id="complete-stat-gold" class="stat-value">0</span></div>
                </div>
                
                <div style="margin-top: 15px; padding: 10px; background-color: #003322; border: 1px solid #00ff88;">
                    <h3 style="color: #00ff88; margin-top: 0;">LEVEL 2 ACCOMPLISHMENTS:</h3>
                    <ul style="margin-left: 20px;">
                        <li>Survived the haunted woodlands</li>
                        <li>Discovered the cult's gathering place</li>
                        <li>Obtained information about Dracula's mountain castle</li>
                        <li>Found a map to the Mountains of Moor</li>
                    </ul>
                    <p style="margin-top: 10px;">The path ahead leads to the treacherous <span class="church">Mountains of Moor</span>, where Dracula's ancient castle awaits. The journey will be perilous, but you must continue if you are to stop the vampire lord's return.</p>
                </div>
            </div>
            
            <div class="choice-buttons">
                <button class="choice-btn" onclick="goToNextLevel()">CONTINUE TO LEVEL 3: MOUNTAINS OF MOOR</button>
            </div>
        </div>
        
        <div class="footer">
            DRACULA'S LAST RISE - A Gothic Horror Adventure<br>
            Level 2: The Woodlands
        </div>
    </div>

    <script>
        // Sound System
        let soundEnabled = true;
        let audioContext;
        
        // Simple beep generator using Web Audio API
        function playBeep(frequency, duration, type = 'square') {
            if (!soundEnabled) return;
            
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = type;
                
                // Volume envelope
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            } catch (e) {
                console.log("Web Audio not supported:", e);
            }
        }
        
        // Sound effects for level 2
        function playSound(type) {
            if (!soundEnabled) return;
            
            switch(type) {
                case 'click':
                    playBeep(800, 0.1, 'square');
                    break;
                case 'roll':
                    playBeep(400, 0.05, 'sine');
                    setTimeout(() => playBeep(600, 0.05, 'sine'), 50);
                    setTimeout(() => playBeep(300, 0.1, 'sine'), 100);
                    break;
                case 'combat':
                    playBeep(1200, 0.05, 'sawtooth');
                    break;
                case 'item':
                    playBeep(600, 0.2, 'triangle');
                    break;
                case 'success':
                    playBeep(1000, 0.15, 'sine');
                    setTimeout(() => playBeep(1200, 0.15, 'sine'), 150);
                    break;
                case 'failure':
                    playBeep(300, 0.3, 'sawtooth');
                    break;
                case 'damage':
                    playBeep(200, 0.2, 'square');
                    break;
                case 'victory':
                    playBeep(500, 0.1, 'sine');
                    setTimeout(() => playBeep(700, 0.1, 'sine'), 100);
                    setTimeout(() => playBeep(900, 0.1, 'sine'), 200);
                    setTimeout(() => playBeep(1100, 0.2, 'sine'), 300);
                    setTimeout(() => playBeep(1300, 0.3, 'sine'), 500);
                    break;
                case 'gold':
                    playBeep(1000, 0.1, 'sine');
                    for(let i = 0; i < 5; i++) {
                        setTimeout(() => playBeep(800 + i*100, 0.1, 'sine'), 100 + i*100);
                    }
                    break;
                case 'wolf':
                    playBeep(80, 0.4, 'square');
                    setTimeout(() => playBeep(60, 0.4, 'square'), 400);
                    break;
                case 'forest':
                    playBeep(200, 0.2, 'sine');
                    setTimeout(() => playBeep(300, 0.2, 'sine'), 200);
                    setTimeout(() => playBeep(400, 0.2, 'sine'), 400);
                    break;
                case 'vampire':
                    playBeep(150, 0.3, 'sawtooth');
                    setTimeout(() => playBeep(120, 0.3, 'sawtooth'), 300);
                    break;
                case 'church':
                    playBeep(300, 0.3, 'sine');
                    setTimeout(() => playBeep(500, 0.3, 'sine'), 300);
                    break;
                case 'cultist':
                    playBeep(400, 0.2, 'square');
                    setTimeout(() => playBeep(350, 0.2, 'square'), 200);
                    break;
            }
        }
        
        // Toggle sound on/off
        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('sound-status').textContent = soundEnabled ? 'ON' : 'OFF';
            
            if (soundEnabled) {
                playSound('click');
            }
        }
        
        // New Game function
        function newGame() {
            playSound('click');
            if (confirm("Start a new game from Level 1? This will erase your current progress.")) {
                localStorage.removeItem('draculaGameState');
                window.location.href = 'le1.html';
            }
        }
        
        // Game state object (loaded from localStorage)
        let gameState = {
            playerClass: '',
            strength: 0,
            maxHealth: 0,
            health: 0,
            agility: 0,
            gold: 0,
            inventory: [],
            equippedWeapon: '',
            equippedArmor: '',
            currentSection: 1,
            gameComplete: false,
            level: 2,
            // Level 2 specific flags
            wolfPackDefeated: false,
            vampireSpawnEncountered: false,
            cultistInterrogated: false,
            churchFound: false,
            mapFound: false,
            // Special items from level 1
            hasSilverWeapon: false,
            hasHealingHerbs: false,
            hasTorch: false
        };
        
        // Combat state
        let combatState = {
            active: false,
            enemyName: '',
            enemyHealth: 0,
            enemyCurrentHealth: 0,
            enemyStrength: 0,
            enemyDamageDice: 1,
            enemyDamageSides: 6,
            nextSection: 0,
            round: 1,
            isGroup: false,
            groupCount: 0
        };
        
        // Initialize game for level 2
        function initGame() {
            // Load game state from localStorage
            const savedGame = localStorage.getItem('draculaGameState');
            if (savedGame) {
                try {
                    const savedState = JSON.parse(savedGame);
                    
                    // Only load if saved level is 1 or 2
                    if (savedState.level === 1 || savedState.level === 2) {
                        Object.assign(gameState, savedState);
                        gameState.level = 2; // Ensure we're on level 2
                        gameState.currentSection = 1; // Start at beginning of level 2
                        
                        // If game was already completed, show complete screen
                        if (gameState.gameComplete && gameState.level === 2) {
                            showCompleteScreen();
                            return;
                        }
                        
                        // Otherwise, start the game
                        updateStatsDisplay();
                        updateInventoryDisplay();
                        loadSection(gameState.currentSection);
                        return;
                    }
                } catch (e) {
                    console.error("Error loading saved game:", e);
                }
            }
            
            // No saved game or wrong level - redirect to level 1
            alert("No game progress found. Starting from Level 1.");
            window.location.href = 'le1.html';
        }
        
        // Show specific screen
        function showScreen(screenId) {
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => {
                screen.classList.remove('active-screen');
            });
            document.getElementById(screenId).classList.add('active-screen');
        }
        
        // Update stats display
        function updateStatsDisplay() {
            document.getElementById('stat-strength').textContent = gameState.strength;
            document.getElementById('stat-health').textContent = gameState.health;
            document.getElementById('stat-maxhealth').textContent = gameState.maxHealth;
            document.getElementById('stat-agility').textContent = gameState.agility;
            document.getElementById('stat-gold').textContent = gameState.gold;
        }
        
        // Add item to inventory
        function addToInventory(item) {
            if (!gameState.inventory.includes(item) && item !== gameState.equippedWeapon && item !== gameState.equippedArmor) {
                gameState.inventory.push(item);
                updateInventoryDisplay();
            }
        }
        
        // Remove item from inventory
        function removeFromInventory(item) {
            const index = gameState.inventory.indexOf(item);
            if (index !== -1) {
                gameState.inventory.splice(index, 1);
                updateInventoryDisplay();
            }
        }
        
        // Update inventory display
        function updateInventoryDisplay() {
            const inventoryDiv = document.getElementById('inventory');
            inventoryDiv.innerHTML = '';
            
            // Add equipped weapon and armor first
            if (gameState.equippedWeapon) {
                const equippedWeapon = document.createElement('div');
                equippedWeapon.className = 'inventory-item equipped';
                equippedWeapon.textContent = gameState.equippedWeapon;
                equippedWeapon.onclick = () => {
                    playSound('click');
                    document.getElementById('story-text').innerHTML += 
                        `<div class="dice-roll">Currently equipped: <span class='item'>${gameState.equippedWeapon}</span></div>`;
                };
                inventoryDiv.appendChild(equippedWeapon);
            }
            
            if (gameState.equippedArmor) {
                const equippedArmor = document.createElement('div');
                equippedArmor.className = 'inventory-item equipped';
                equippedArmor.textContent = gameState.equippedArmor;
                equippedArmor.onclick = () => {
                    playSound('click');
                    document.getElementById('story-text').innerHTML += 
                        `<div class="dice-roll">Currently equipped: <span class='item'>${gameState.equippedArmor}</span></div>`;
                };
                inventoryDiv.appendChild(equippedArmor);
            }
            
            // Add other inventory items
            gameState.inventory.forEach(item => {
                // Skip if it's the equipped weapon or armor
                if (item !== gameState.equippedWeapon && item !== gameState.equippedArmor) {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'inventory-item';
                    itemElement.textContent = item;
                    itemElement.onclick = () => {
                        useInventoryItem(item);
                    };
                    inventoryDiv.appendChild(itemElement);
                }
            });
            
            // Update inventory count
            const totalItems = gameState.inventory.length + (gameState.equippedWeapon ? 1 : 0) + (gameState.equippedArmor ? 1 : 0);
            document.getElementById('inventory-count').textContent = `ITEMS: ${totalItems}/10`;
        }
        
        // Use inventory item
        function useInventoryItem(item) {
            playSound('click');
            let message = "";
            
            if (item === 'Health Potion') {
                const healAmount = rollDice(2, 6) + 5;
                const oldHealth = gameState.health;
                gameState.health = Math.min(gameState.maxHealth, gameState.health + healAmount);
                const actualHeal = gameState.health - oldHealth;
                removeFromInventory(item);
                playSound('item');
                message = `You drink the <span class='item'>Health Potion</span> and restore ${actualHeal} Health!`;
                updateStatsDisplay();
            } else if (item === 'Healing Herbs') {
                const healAmount = rollDice(1, 6) + 2;
                const oldHealth = gameState.health;
                gameState.health = Math.min(gameState.maxHealth, gameState.health + healAmount);
                const actualHeal = gameState.health - oldHealth;
                removeFromInventory(item);
                playSound('item');
                message = `You use the <span class='item'>Healing Herbs</span> and restore ${actualHeal} Health!`;
                updateStatsDisplay();
            } else if (item === 'Smoke Bomb') {
                if (combatState.active) {
                    // Escape combat
                    message = `You throw a <span class='item'>Smoke Bomb</span> and escape from combat!`;
                    combatState.active = false;
                    removeFromInventory(item);
                    loadSection(combatState.nextSection + 1); // Go to next section after escape
                } else {
                    message = "The <span class='item'>Smoke Bomb</span> can be used to escape from combat.";
                }
            } else if (item === 'Ancient Tome') {
                message = "The <span class='item'>Ancient Tome</span> contains knowledge about vampires and their weaknesses.";
                if (!gameState.inventory.includes('Silver Amulet')) {
                    message += " You find a silver amulet tucked between its pages!";
                    addToInventory('Silver Amulet');
                }
            } else if (item === 'Torch') {
                if (!gameState.hasTorch) {
                    gameState.hasTorch = true;
                    playSound('item');
                    message = "You light the <span class='item'>Torch</span>. It illuminates your path and might scare away creatures of the night.";
                } else {
                    message = "The <span class='item'>Torch</span> is already lit, providing light in the dark woodlands.";
                }
            } else if (item === 'Silver Amulet') {
                message = "The <span class='item'>Silver Amulet</span> feels warm to the touch. It might offer protection against dark creatures.";
            } else if (item === 'Mountain Map') {
                message = "The <span class='item'>Mountain Map</span> shows a hidden pass through the Mountains of Moor. This will be essential for your next journey.";
            } else if (item === 'Cultist Dagger') {
                message = "The <span class='item'>Cultist Dagger</span> is etched with strange symbols. It feels cold and heavy in your hand.";
            } else if (item === 'Wolf Pelt') {
                message = "The <span class='item'>Wolf Pelt</span> is thick and warm. It could be useful in colder climates.";
            } else {
                message = `You examine the <span class='item'>${item}</span>.`;
            }
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${message}</div>`;
        }
        
        // Use item from action button
        function useItem() {
            playSound('click');
            if (gameState.inventory.length === 0 && !gameState.equippedWeapon && !gameState.equippedArmor) {
                document.getElementById('story-text').innerHTML += 
                    `<div class="dice-roll">You have no usable items in your inventory.</div>`;
                return;
            }
            
            let itemText = "<div class='dice-roll'><strong>Select an item to use:</strong><br>";
            
            // Show equipped items
            if (gameState.equippedWeapon || gameState.equippedArmor) {
                itemText += `<br><strong>Equipped:</strong><br>`;
                if (gameState.equippedWeapon) {
                    itemText += `<button onclick="useInventoryItem('${gameState.equippedWeapon}')" class="action-btn" style="margin: 5px;">${gameState.equippedWeapon}</button> `;
                }
                if (gameState.equippedArmor) {
                    itemText += `<button onclick="useInventoryItem('${gameState.equippedArmor}')" class="action-btn" style="margin: 5px;">${gameState.equippedArmor}</button>`;
                }
            }
            
            // Show inventory items
            const usableItems = gameState.inventory.filter(item => 
                item !== gameState.equippedWeapon && item !== gameState.equippedArmor);
            
            if (usableItems.length > 0) {
                if (gameState.equippedWeapon || gameState.equippedArmor) {
                    itemText += `<br><br>`;
                }
                itemText += `<strong>Inventory:</strong><br>`;
                usableItems.forEach(item => {
                    itemText += `<button onclick="useInventoryItem('${item}')" class="action-btn" style="margin: 5px;">${item}</button> `;
                });
            }
            
            itemText += `<br><br><button onclick="document.getElementById('story-text').innerHTML += '<div class=dice-roll>Item use cancelled.</div>'" class="action-btn">Cancel</button>`;
            itemText += "</div>";
            
            document.getElementById('story-text').innerHTML += itemText;
        }
        
        // Game story sections for Level 2: The Woodlands
        const storySections = {
            1: {
                text: "You stand at the edge of the ancient woodlands, the information from the tavern bartender fresh in your mind. The trees here are twisted and gnarled, their branches reaching like skeletal fingers against the blood-red moon. The path ahead is barely visible, swallowed by shadow and fog. Strange sounds echo from deep within the forest - the howl of unnatural beasts, whispered chants, and the rustle of things moving just beyond sight. According to the bartender, there's an old church deep in these woods where Dracula's cult gathers. That's where you'll find answers - and likely confrontation.",
                choices: [
                    {text: "Follow the overgrown path", nextSection: 2, skillCheck: false},
                    {text: "Cut through the dense underbrush", nextSection: 3, skillCheck: true, checkType: 'agility', difficulty: 15},
                    {text: "Light a torch if you have one", nextSection: 4, skillCheck: false, requirement: function() { return gameState.hasTorch || gameState.inventory.includes('Torch'); }}
                ]
            },
            2: {
                text: "You follow what appears to be an old hunting path. The ground is soft and damp, your footsteps making almost no sound. Ahead, you see two glowing eyes reflecting in the darkness.",
                choices: [
                    {text: "Approach cautiously", nextSection: 5, skillCheck: false},
                    {text: "Ready your weapon", nextSection: 6, skillCheck: false},
                    {text: "Hide and observe", nextSection: 7, skillCheck: true, checkType: 'agility', difficulty: 16}
                ]
            },
            3: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 8, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You move quietly through the underbrush, avoiding thorns and snapping branches. You make progress without alerting any creatures.";
                    } else {
                        const damage = rollDice(1, 6);
                        gameState.health -= damage;
                        updateStatsDisplay();
                        playSound('damage');
                        return "You stumble through the thick brush, getting scratched by thorns for " + damage + " damage. The noise might have alerted something nearby.";
                    }
                }
            },
            4: {
                text: "You light your torch. The flame pushes back the darkness, revealing the twisted forms of the trees around you. The light seems to make the shadows dance unnaturally.",
                choices: [
                    {text: "Follow the path with torch lit", nextSection: 9, skillCheck: false},
                    {text: "Investigate a strange sound to the left", nextSection: 10, skillCheck: false}
                ],
                action: function() {
                    gameState.hasTorch = true;
                    playSound('item');
                    return "The torchlight comforts you, but also makes you a visible target in the darkness of the woodlands.";
                }
            },
            5: {
                text: "As you approach, the creature steps into a patch of moonlight. It's a large wolf with matted fur and eyes that glow with an unnatural red light. It growls, baring teeth that look too long and sharp.",
                choices: [
                    {text: "Attempt to scare it away with fire", nextSection: 11, skillCheck: false, requirement: function() { return gameState.hasTorch; }},
                    {text: "Fight the corrupted wolf", nextSection: 12, skillCheck: false},
                    {text: "Try to sneak around it", nextSection: 13, skillCheck: true, checkType: 'agility', difficulty: 17}
                ],
                action: function() {
                    playSound('wolf');
                    return "<span class='wolf'>Corrupted Wolf</span>: The creature looks diseased, with patches of missing fur and a strange intelligence in its eyes.";
                }
            },
            6: {
                text: "You draw your weapon as the creature emerges from the shadows. It's a wolf, but wrong somehow - its movements are too fluid, its eyes too intelligent. It snarls and prepares to attack.",
                choices: [
                    {text: "Attack first", nextSection: 14, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Corrupted Wolf";
                    combatState.enemyHealth = 30;
                    combatState.enemyCurrentHealth = 30;
                    combatState.enemyStrength = 16;
                    combatState.enemyDamageDice = 2;
                    combatState.enemyDamageSides = 6;
                    combatState.nextSection = 15;
                    combatState.round = 0;
                    combatState.isGroup = false;
                    combatState.groupCount = 1;
                    
                    playSound('wolf');
                    return "<span class='wolf'>Corrupted Wolf</span>: Health " + combatState.enemyCurrentHealth + ", Strength " + combatState.enemyStrength;
                }
            },
            7: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 16, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You hide behind a thick tree and watch as the creature - a corrupted wolf - sniffs the air, then moves off into the woods. You avoid confrontation.";
                    } else {
                        playSound('failure');
                        return "You try to hide but step on a dry branch. The creature turns toward you, growling loudly.";
                    }
                }
            },
            8: {
                text: "After navigating through the underbrush, you find yourself in a small clearing. In the center stands a stone altar, stained dark with what looks like old blood.",
                choices: [
                    {text: "Examine the altar", nextSection: 17, skillCheck: false},
                    {text: "Search the area around the altar", nextSection: 18, skillCheck: true, checkType: 'agility', difficulty: 14},
                    {text: "Leave quickly - this place feels wrong", nextSection: 19, skillCheck: false}
                ]
            },
            9: {
                text: "With your torch lighting the way, you follow the path deeper into the woodlands. The light keeps most small creatures at bay, but you occasionally see larger shapes moving just beyond the circle of illumination.",
                choices: [
                    {text: "Continue along the main path", nextSection: 20, skillCheck: false},
                    {text: "Investigate a side path marked with strange symbols", nextSection: 21, skillCheck: false}
                ],
                action: function() {
                    return "The torchlight casts long, dancing shadows that seem to move with a life of their own.";
                }
            },
            10: {
                text: "You move toward the strange sound. As you approach, you realize it's coming from a small cave entrance partially hidden by vines. A cold draft emanates from within, carrying with it the scent of damp earth and something else... something metallic.",
                choices: [
                    {text: "Enter the cave", nextSection: 22, skillCheck: false},
                    {text: "Listen at the entrance", nextSection: 23, skillCheck: true, checkType: 'agility', difficulty: 15},
                    {text: "Mark the location and continue on the path", nextSection: 24, skillCheck: false}
                ],
                action: function() {
                    playSound('forest');
                    return "The cave entrance looks like it was made by natural erosion, but there are markings around it that seem intentional.";
                }
            },
            11: {
                text: "You thrust your torch toward the wolf. It flinches back, snarling at the flame. Fire seems to unsettle it more than a normal animal.",
                choices: [
                    {text: "Press the advantage with the torch", nextSection: 25, skillCheck: false},
                    {text: "Attack while it's distracted", nextSection: 26, skillCheck: false},
                    {text: "Back away slowly", nextSection: 27, skillCheck: true, checkType: 'agility', difficulty: 14}
                ],
                action: function() {
                    return "<span class='wolf'>Corrupted Wolf</span>: The creature eyes the flame warily, growling but keeping its distance.";
                }
            },
            12: {
                text: "You ready your weapon as the wolf circles you, looking for an opening. Its movements are unnaturally quick for an animal of its size.",
                choices: [
                    {text: "Attack the wolf", nextSection: 14, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Corrupted Wolf";
                    combatState.enemyHealth = 30;
                    combatState.enemyCurrentHealth = 30;
                    combatState.enemyStrength = 16;
                    combatState.enemyDamageDice = 2;
                    combatState.enemyDamageSides = 6;
                    combatState.nextSection = 15;
                    combatState.round = 0;
                    combatState.isGroup = false;
                    combatState.groupCount = 1;
                    
                    playSound('wolf');
                    return "<span class='wolf'>Corrupted Wolf</span>: Health " + combatState.enemyCurrentHealth + ", Strength " + combatState.enemyStrength;
                }
            },
            13: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 28, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You move quietly around the wolf, keeping to the shadows. The creature seems distracted by something in the distance, allowing you to slip past unnoticed.";
                    } else {
                        playSound('wolf');
                        return "The wolf catches your movement and turns toward you, snarling. It's ready to attack!";
                    }
                }
            },
            14: {
                text: "",
                choices: [
                    {text: "Attack!", nextSection: 14, skillCheck: false}
                ],
                action: function() {
                    // Execute one round of combat
                    if (combatState.active) {
                        const combatResult = executeCombatRound();
                        
                        // Check if combat is over
                        if (combatState.enemyCurrentHealth <= 0) {
                            combatState.active = false;
                            gameState.wolfPackDefeated = true;
                            // Automatically go to victory section after a short delay
                            setTimeout(() => {
                                loadSection(combatState.nextSection);
                            }, 1500);
                            return combatResult + "<br><br><span class='success'>You defeated the corrupted wolf!</span>";
                        } else if (gameState.health <= 0) {
                            combatState.active = false;
                            // Game over - will be handled in executeCombatRound
                            return combatResult;
                        }
                        
                        return combatResult;
                    }
                    return "Combat has ended.";
                }
            },
            15: {
                text: "With the corrupted wolf defeated, you examine its body. The corruption seems unnatural - patches of its fur have fallen out, and its teeth and claws are elongated. This is clearly the work of dark magic.",
                choices: [
                    {text: "Continue along the path", nextSection: 29, skillCheck: false},
                    {text: "Search the area where the wolf came from", nextSection: 30, skillCheck: false}
                ],
                action: function() {
                    addToInventory('Wolf Pelt');
                    playSound('item');
                    return "You take the wolf's pelt as evidence of the corruption spreading through these woods.";
                }
            },
            16: {
                text: "After avoiding the wolf, you continue deeper into the woodlands. The trees grow thicker here, and the air feels colder.",
                choices: [
                    {text: "Continue along the path", nextSection: 29, skillCheck: false}
                ]
            },
            17: {
                text: "The altar is made of dark stone, worn smooth by time. The stains on its surface are definitely blood, and recent enough that they haven't fully dried. Carved into the stone are symbols that make your skin crawl - they seem to pulse with a faint dark energy.",
                choices: [
                    {text: "Touch the symbols", nextSection: 31, skillCheck: false},
                    {text: "Search for clues around the altar", nextSection: 32, skillCheck: false},
                    {text: "Destroy the altar", nextSection: 33, skillCheck: true, checkType: 'strength', difficulty: 17}
                ],
                action: function() {
                    playSound('forest');
                    return "This is clearly a site of dark rituals. The air around the altar feels heavy and oppressive.";
                }
            },
            18: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 34, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        const goldFound = rollDice(2, 10);
                        gameState.gold += goldFound;
                        updateStatsDisplay();
                        return "You find a small pouch hidden in the roots of a nearby tree. It contains <span class='gold'>" + goldFound + " Gold</span>. It must have been left here by a previous traveler... or victim.";
                    } else {
                        playSound('failure');
                        return "You search the area but find nothing of value. The place feels increasingly hostile.";
                    }
                }
            },
            19: {
                text: "You decide to leave the clearing. The oppressive feeling lifts slightly as you move away from the altar, but the woods remain dark and threatening.",
                choices: [
                    {text: "Continue along the path", nextSection: 29, skillCheck: false}
                ],
                action: function() {
                    return "Sometimes discretion is the better part of valor, especially in haunted places like these woodlands.";
                }
            },
            20: {
                text: "The path winds through increasingly dense forest. You hear strange sounds all around - whispering leaves, cracking branches, and what sounds like distant chanting.",
                choices: [
                    {text: "Follow the sound of chanting", nextSection: 35, skillCheck: true, checkType: 'agility', difficulty: 16},
                    {text: "Stay on the path and ignore the sounds", nextSection: 36, skillCheck: false},
                    {text: "Climb a tree to get a better view", nextSection: 37, skillCheck: true, checkType: 'agility', difficulty: 15}
                ]
            },
            21: {
                text: "The side path is marked with symbols carved into tree trunks. They're similar to the ones you saw on the altar - dark, twisting shapes that seem to writhe in the torchlight.",
                choices: [
                    {text: "Follow the marked path", nextSection: 38, skillCheck: false},
                    {text: "Turn back to the main path", nextSection: 20, skillCheck: false}
                ]
            },
            22: {
                text: "You enter the cave, your torch illuminating damp stone walls. The cave descends gradually, and the air grows colder with each step. After about fifty feet, you find a small chamber with what appears to be a makeshift campsite.",
                choices: [
                    {text: "Search the campsite", nextSection: 39, skillCheck: false},
                    {text: "Listen for any occupants", nextSection: 40, skillCheck: true, checkType: 'agility', difficulty: 16},
                    {text: "Leave the cave", nextSection: 41, skillCheck: false}
                ],
                action: function() {
                    return "The campsite looks recently used. There's a bedroll, an empty pack, and the ashes of a small fire.";
                }
            },
            23: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 42, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You hear faint breathing coming from deeper in the cave. It's slow and regular - someone or something is sleeping inside.";
                    } else {
                        playSound('failure');
                        return "You can't hear anything over the sound of your own breathing and the wind in the trees.";
                    }
                }
            },
            24: {
                text: "You mark the cave's location with a piece of cloth torn from your cloak, then continue along the main path. The cave might be worth investigating later, but for now you need to find the old church.",
                choices: [
                    {text: "Continue along the path", nextSection: 29, skillCheck: false}
                ],
                action: function() {
                    return "You tie the cloth to a branch near the cave entrance, creating a marker you can find again if needed.";
                }
            },
            25: {
                text: "You advance with the torch, waving it aggressively. The wolf yelps and retreats, its fur smoking where the flame touched it. It turns and disappears into the woods, casting one last hateful glance back at you.",
                choices: [
                    {text: "Continue along the path", nextSection: 29, skillCheck: false}
                ],
                action: function() {
                    playSound('success');
                    return "<span class='success'>The corrupted wolf flees from your torch!</span> Fire is clearly effective against these twisted creatures.";
                }
            },
            26: {
                text: "While the wolf is distracted by the torch, you strike with your weapon!",
                choices: [
                    {text: "Continue the attack", nextSection: 43, skillCheck: false}
                ],
                action: function() {
                    // Surprise round advantage
                    const surpriseDamage = rollDice(2, 8);
                    
                    combatState.active = true;
                    combatState.enemyName = "Distracted Wolf";
                    combatState.enemyHealth = 30 - surpriseDamage;
                    combatState.enemyCurrentHealth = 30 - surpriseDamage;
                    combatState.enemyStrength = 14; // Lower due to distraction
                    combatState.enemyDamageDice = 2;
                    combatState.enemyDamageSides = 5;
                    combatState.nextSection = 15;
                    combatState.round = 0;
                    combatState.isGroup = false;
                    combatState.groupCount = 1;
                    
                    playSound('combat');
                    return "You strike while the wolf is distracted for " + surpriseDamage + " damage!<br><br><span class='wolf'>Distracted Wolf</span>: Health " + combatState.enemyCurrentHealth + ", Strength " + combatState.enemyStrength;
                }
            },
            27: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 44, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You back away slowly, keeping the torch between you and the wolf. The creature watches you but doesn't pursue, allowing you to retreat safely.";
                    } else {
                        playSound('wolf');
                        return "You stumble as you back away, lowering the torch momentarily. The wolf sees an opportunity and attacks!";
                    }
                }
            },
            28: {
                text: "After sneaking past the wolf, you continue along the path. The woods grow darker and more oppressive the deeper you go.",
                choices: [
                    {text: "Continue along the path", nextSection: 29, skillCheck: false}
                ]
            },
            29: {
                text: "The path begins to ascend slightly. You're moving into higher ground within the woodlands. The trees thin somewhat, allowing more moonlight to filter through. Ahead, you see a break in the trees and what might be a structure.",
                choices: [
                    {text: "Approach the structure cautiously", nextSection: 45, skillCheck: false},
                    {text: "Circle around to approach from the side", nextSection: 46, skillCheck: true, checkType: 'agility', difficulty: 16},
                    {text: "Hide and observe from a distance", nextSection: 47, skillCheck: true, checkType: 'agility', difficulty: 15}
                ],
                action: function() {
                    playSound('forest');
                    return "This could be the old church the bartender mentioned. Or it could be something else entirely. Caution is advised.";
                }
            },
            30: {
                text: "You search the area where the wolf emerged. Among the underbrush, you find the remains of a small animal - a rabbit, by the looks of it. But there's something strange about the carcass... it appears to have been drained of blood.",
                choices: [
                    {text: "Examine the carcass more closely", nextSection: 48, skillCheck: false},
                    {text: "Continue along the path", nextSection: 29, skillCheck: false},
                    {text: "Search the immediate area", nextSection: 49, skillCheck: true, checkType: 'agility', difficulty: 14}
                ],
                action: function() {
                    return "The animal's body is pale and withered, with two small puncture wounds on its neck. This is the work of a vampire or one of its minions.";
                }
            },
            31: {
                text: "As your fingers touch the cold stone, a jolt of dark energy runs up your arm. You feel a sudden chill and hear whispering voices in your mind. The symbols glow faintly with a sickly purple light.",
                choices: [
                    {text: "Pull away immediately", nextSection: 50, skillCheck: false},
                    {text: "Try to understand the whispers", nextSection: 51, skillCheck: true, checkType: 'strength', difficulty: 18}
                ],
                action: function() {
                    const damage = rollDice(1, 8);
                    gameState.health -= damage;
                    updateStatsDisplay();
                    playSound('damage');
                    return "The dark energy drains " + damage + " health from you! The whispers grow louder, promising power in exchange for service...";
                }
            },
            32: {
                text: "You search around the altar carefully. In the roots of a nearby tree, you find a small leather-bound book. Its pages are filled with disturbing illustrations and notes in a language you don't recognize.",
                choices: [
                    {text: "Take the book", nextSection: 52, skillCheck: false},
                    {text: "Leave it - it feels tainted", nextSection: 53, skillCheck: false}
                ],
                action: function() {
                    return "The book radiates the same dark energy as the altar. It's clearly a cultist's journal or ritual text.";
                }
            },
            33: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 54, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You bring your weapon down on the altar with all your strength. The stone cracks, and the dark energy dissipates with a wailing sound. You've cleansed this site of its corruption.";
                    } else {
                        playSound('failure');
                        const damage = rollDice(1, 10);
                        gameState.health -= damage;
                        updateStatsDisplay();
                        return "You strike the altar, but it resists your attack. A burst of dark energy strikes back, dealing " + damage + " damage to you! The altar remains intact.";
                    }
                }
            },
            34: {
                text: "After searching the area, you continue on your way. The altar site feels slightly less oppressive now that you're leaving it behind.",
                choices: [
                    {text: "Continue along the path", nextSection: 29, skillCheck: false}
                ]
            },
            35: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 55, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You move silently toward the chanting. Through the trees, you see a group of hooded figures gathered in a clearing. They're performing some kind of ritual around a central figure who appears to be floating above the ground.";
                    } else {
                        playSound('failure');
                        return "You try to approach quietly but step on a dry branch. The chanting stops abruptly. You've been discovered!";
                    }
                }
            },
            36: {
                text: "You ignore the chanting and stay on the path. The sounds fade behind you, but you can't shake the feeling that you're being watched from the shadows.",
                choices: [
                    {text: "Continue along the path", nextSection: 29, skillCheck: false}
                ],
                action: function() {
                    return "Sometimes it's better not to investigate every strange sound in haunted woodlands. Survival comes first.";
                }
            },
            37: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 56, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        gameState.churchFound = true;
                        return "From your vantage point, you can see a stone structure about half a mile ahead. It looks like a small church or chapel, partially in ruins. That must be your destination!";
                    } else {
                        const damage = rollDice(1, 6);
                        gameState.health -= damage;
                        updateStatsDisplay();
                        playSound('damage');
                        return "You slip while climbing down and fall, taking " + damage + " damage. You didn't get a good view of the surrounding area.";
                    }
                }
            },
            38: {
                text: "The marked path leads to a small clearing where three hooded figures stand around a circle drawn in the dirt. They haven't noticed you yet.",
                choices: [
                    {text: "Attack the cultists", nextSection: 57, skillCheck: false},
                    {text: "Listen to their conversation", nextSection: 58, skillCheck: true, checkType: 'agility', difficulty: 17},
                    {text: "Retreat quietly", nextSection: 59, skillCheck: true, checkType: 'agility', difficulty: 15}
                ],
                action: function() {
                    playSound('cultist');
                    return "<span class='cultist'>Cultists</span>: These are clearly followers of Dracula, marked by their dark robes and the silver vampire symbol pendants they wear.";
                }
            },
            39: {
                text: "You search the campsite. In the pack, you find some dried rations, a water skin, and a small journal. The journal's last entry reads: 'The cult gathers at the old church tonight. I must witness their ritual and gather proof. If I don't return, tell the constable...' The entry ends abruptly.",
                choices: [
                    {text: "Take the journal", nextSection: 60, skillCheck: false},
                    {text: "Take the rations", nextSection: 61, skillCheck: false},
                    {text: "Wait to see if the owner returns", nextSection: 62, skillCheck: false}
                ],
                action: function() {
                    return "This campsite belonged to an investigator, like yourself. They were trying to gather evidence against the cult.";
                }
            },
            40: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 63, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You hear nothing but the drip of water from the cave ceiling. The campsite appears to be abandoned, at least for now.";
                    } else {
                        playSound('failure');
                        return "You can't hear anything over the sound of your own breathing. The cave is eerily silent.";
                    }
                }
            },
            41: {
                text: "You decide to leave the cave. The campsite gives you an uneasy feeling, and you'd rather not be caught in an enclosed space if the occupant returns.",
                choices: [
                    {text: "Continue along the path", nextSection: 29, skillCheck: false}
                ],
                action: function() {
                    return "You exit the cave and continue your journey through the woodlands, making a mental note of the cave's location.";
                }
            },
            42: {
                text: "After listening at the cave entrance, you decide what to do next.",
                choices: [
                    {text: "Enter the cave", nextSection: 22, skillCheck: false},
                    {text: "Mark the location and continue", nextSection: 24, skillCheck: false}
                ]
            },
            43: {
                text: "",
                choices: [
                    {text: "Attack!", nextSection: 43, skillCheck: false}
                ],
                action: function() {
                    // Execute one round of combat
                    if (combatState.active) {
                        const combatResult = executeCombatRound();
                        
                        // Check if combat is over
                        if (combatState.enemyCurrentHealth <= 0) {
                            combatState.active = false;
                            gameState.wolfPackDefeated = true;
                            // Automatically go to victory section after a short delay
                            setTimeout(() => {
                                loadSection(combatState.nextSection);
                            }, 1500);
                            return combatResult + "<br><br><span class='success'>You defeated the corrupted wolf!</span>";
                        } else if (gameState.health <= 0) {
                            combatState.active = false;
                            // Game over - will be handled in executeCombatRound
                            return combatResult;
                        }
                        
                        return combatResult;
                    }
                    return "Combat has ended.";
                }
            },
            44: {
                text: "After retreating from the wolf, you continue along the path. The encounter has left you shaken but unharmed.",
                choices: [
                    {text: "Continue along the path", nextSection: 29, skillCheck: false}
                ]
            },
            45: {
                text: "You approach the structure cautiously. It is indeed the old church mentioned by the bartender. The building is in disrepair, with part of the roof collapsed and vines covering the stone walls. Flickering light comes from within, and you can hear chanting.",
                choices: [
                    {text: "Enter through the main doors", nextSection: 64, skillCheck: false},
                    {text: "Look for another entrance", nextSection: 65, skillCheck: true, checkType: 'agility', difficulty: 16},
                    {text: "Observe from outside first", nextSection: 66, skillCheck: true, checkType: 'agility', difficulty: 15}
                ],
                action: function() {
                    gameState.churchFound = true;
                    playSound('church');
                    return "This is it - the cult's gathering place. The air here feels charged with dark energy, and the chanting from within sets your teeth on edge.";
                }
            },
            46: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 67, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You circle around to the side of the church and find a broken window partially hidden by vines. It provides a good view of the interior without being immediately visible to those inside.";
                    } else {
                        playSound('failure');
                        return "You try to circle around but trip over a root, making noise. A guard posted outside the church turns toward the sound!";
                    }
                }
            },
            47: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 68, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You find a good hiding spot behind a thick tree. From here, you can see two cultists standing guard at the church entrance. There are at least a dozen more inside, judging by the volume of the chanting.";
                    } else {
                        playSound('failure');
                        return "You try to hide but choose a spot with poor cover. One of the cultist guards spots you and raises the alarm!";
                    }
                }
            },
            48: {
                text: "The rabbit's body is completely drained of blood, with only two small puncture wounds on its neck. This is classic vampire feeding behavior, but the creature that did this was likely not a full vampire - their thralls and spawn also feed this way.",
                choices: [
                    {text: "Continue along the path", nextSection: 29, skillCheck: false},
                    {text: "Search for tracks", nextSection: 69, skillCheck: true, checkType: 'agility', difficulty: 16}
                ],
                action: function() {
                    gameState.vampireSpawnEncountered = true;
                    return "This confirms that vampire spawn are active in these woodlands. They're likely guarding the approaches to the church.";
                }
            },
            49: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 70, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        addToInventory('Silver Amulet');
                        return "You find a small silver amulet hidden under some leaves. It's warm to the touch - silver often reacts to the presence of dark creatures.";
                    } else {
                        playSound('failure');
                        return "You search the area but find nothing of value. The sense of being watched grows stronger.";
                    }
                }
            },
            50: {
                text: "You pull your hand away from the altar, breaking the connection. The whispers fade, but a lingering chill remains in your fingers.",
                choices: [
                    {text: "Leave the altar area", nextSection: 19, skillCheck: false},
                    {text: "Try to destroy the altar", nextSection: 33, skillCheck: false}
                ],
                action: function() {
                    return "Touching dark artifacts is never wise. The energy they contain can corrupt even the strongest will.";
                }
            },
            51: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 71, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You focus your will against the dark whispers. Through the mental assault, you catch fragments of information: '...the master awakens in the mountains... the castle must be prepared... the sacrifice at the full moon...'";
                        gameState.mapFound = true;
                    } else {
                        playSound('failure');
                        const damage = rollDice(2, 8);
                        gameState.health -= damage;
                        updateStatsDisplay();
                        return "The dark energy overwhelms your mind. You collapse to your knees, taking " + damage + " damage as the whispers promise power, glory, and eternal life in exchange for your service to the dark lord.";
                    }
                }
            },
            52: {
                text: "You take the book, feeling its dark energy through the leather cover. It might contain valuable information about the cult's plans, but carrying it feels like carrying a piece of the corruption itself.",
                choices: [
                    {text: "Leave the altar area", nextSection: 19, skillCheck: false}
                ],
                action: function() {
                    addToInventory('Cultist Journal');
                    playSound('item');
                    return "The book is heavy in your pack, both physically and spiritually. You'll need to be careful studying it.";
                }
            },
            53: {
                text: "You leave the book where you found it. Some knowledge is better left undiscovered, and this feels like one of those cases.",
                choices: [
                    {text: "Leave the altar area", nextSection: 19, skillCheck: false}
                ],
                action: function() {
                    return "Wisdom is knowing what not to touch. You feel lighter having left the tainted book behind.";
                }
            },
            54: {
                text: "After your attempt to destroy the altar, you decide to leave the area. The dark energy has either been dispelled or driven deeper underground.",
                choices: [
                    {text: "Continue along the path", nextSection: 29, skillCheck: false}
                ]
            },
            55: {
                text: "You observe the ritual from hiding. The central figure is indeed floating, surrounded by cultists chanting in a language that hurts your ears. Suddenly, the figure's head snaps toward your hiding place - it knows you're there!",
                choices: [
                    {text: "Attack the cultists", nextSection: 72, skillCheck: false},
                    {text: "Run back to the path", nextSection: 73, skillCheck: true, checkType: 'agility', difficulty: 17},
                    {text: "Try to reason with them", nextSection: 74, skillCheck: false}
                ],
                action: function() {
                    playSound('vampire');
                    return "The floating figure has pale skin, sharp features, and eyes that glow red in the darkness. This is a vampire spawn - one of Dracula's lesser children but still dangerous.";
                }
            },
            56: {
                text: "Now that you've spotted the church, you need to decide how to approach it.",
                choices: [
                    {text: "Approach the church cautiously", nextSection: 45, skillCheck: false},
                    {text: "Wait until night falls completely", nextSection: 75, skillCheck: false}
                ]
            },
            57: {
                text: "You draw your weapon and charge the cultists, catching them by surprise!",
                choices: [
                    {text: "Attack!", nextSection: 76, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Cultist Trio";
                    combatState.enemyHealth = 45;
                    combatState.enemyCurrentHealth = 45;
                    combatState.enemyStrength = 14;
                    combatState.enemyDamageDice = 2;
                    combatState.enemyDamageSides = 6;
                    combatState.nextSection = 77;
                    combatState.round = 0;
                    combatState.isGroup = true;
                    combatState.groupCount = 3;
                    
                    playSound('cultist');
                    return "<span class='cultist'>Cultist Trio</span>: Health " + combatState.enemyCurrentHealth + ", Strength " + combatState.enemyStrength;
                }
            },
            58: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 78, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You listen to the cultists' conversation: '...the master will be pleased with our progress. The sacrifices have strengthened him. Soon he will rise from his mountain tomb and claim his dominion over the living.' 'And we shall rule beside him,' another responds. 'Eternal life for the faithful.'";
                    } else {
                        playSound('failure');
                        return "You can't make out their words over the wind in the trees. One of them looks in your direction, as if sensing your presence.";
                    }
                }
            },
            59: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 79, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You retreat quietly, leaving the cultists to their preparations. You now know their location and can approach more carefully.";
                    } else {
                        playSound('failure');
                        return "You try to retreat but step on a branch. The cultists turn toward the sound!";
                    }
                }
            },
            60: {
                text: "You take the journal. The investigator's notes detail the cult's activities over the past month, including the dates of their gatherings and descriptions of key members. This could be valuable evidence.",
                choices: [
                    {text: "Take the rations as well", nextSection: 61, skillCheck: false},
                    {text: "Wait a while longer", nextSection: 62, skillCheck: false},
                    {text: "Leave the cave", nextSection: 41, skillCheck: false}
                ],
                action: function() {
                    addToInventory('Investigator\'s Journal');
                    playSound('item');
                    return "The journal confirms much of what you already suspected, but adds details about the cult's hierarchy and their connection to Dracula's mountain castle.";
                }
            },
            61: {
                text: "You take the rations. They're not much, but they might keep you going if your journey takes longer than expected.",
                choices: [
                    {text: "Take the journal if you haven't", nextSection: 60, skillCheck: false},
                    {text: "Wait a while longer", nextSection: 62, skillCheck: false},
                    {text: "Leave the cave", nextSection: 41, skillCheck: false}
                ],
                action: function() {
                    addToInventory('Dried Rations');
                    playSound('item');
                    return "The rations are basic but edible. Every bit helps when you're hunting vampires in haunted woodlands.";
                }
            },
            62: {
                text: "You wait in the cave for an hour, but no one returns. The investigator is likely dead or captured by the cult. You should continue your mission.",
                choices: [
                    {text: "Take the journal", nextSection: 60, skillCheck: false},
                    {text: "Take the rations", nextSection: 61, skillCheck: false},
                    {text: "Leave the cave", nextSection: 41, skillCheck: false}
                ],
                action: function() {
                    return "Waiting any longer would be a waste of precious time. The cult's ritual is probably happening tonight.";
                }
            },
            63: {
                text: "After determining the cave is empty, you search the campsite.",
                choices: [
                    {text: "Search the campsite", nextSection: 39, skillCheck: false}
                ]
            },
            64: {
                text: "You push open the heavy wooden doors and enter the church. Inside, a dozen cultists are gathered around an altar where a vampire spawn presides over some dark ceremony. All eyes turn to you as you enter.",
                choices: [
                    {text: "Attack the cult", nextSection: 80, skillCheck: false},
                    {text: "Demand they surrender", nextSection: 81, skillCheck: false},
                    {text: "Try to bluff your way through", nextSection: 82, skillCheck: true, checkType: 'agility', difficulty: 18}
                ],
                action: function() {
                    playSound('church');
                    return "<span class='vampire'>Vampire Spawn</span>: 'Well, well. Another offering for our master. How thoughtful of you to deliver yourself.'";
                }
            },
            65: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 83, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You find a side entrance - a small door that leads to what was once the church's sacristy. From here, you can observe the main chamber without being immediately noticed.";
                    } else {
                        playSound('failure');
                        return "You search for another entrance but find nothing. In the process, you make enough noise to alert the guards!";
                    }
                }
            },
            66: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 84, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You watch from a hidden position. You count twelve cultists inside, plus the vampire spawn leading them. They're performing a ritual that involves drinking from a chalice filled with a dark liquid. The air grows colder as they chant.";
                    } else {
                        playSound('failure');
                        return "While observing, you shift position and your weapon clatters against a stone. The guards outside turn toward the sound!";
                    }
                }
            },
            67: {
                text: "Through the broken window, you can see the interior of the church clearly. The cultists are gathered around their vampire leader, drinking from a shared chalice. This is clearly some kind of initiation or empowerment ritual.",
                choices: [
                    {text: "Enter through the window", nextSection: 85, skillCheck: true, checkType: 'agility', difficulty: 16},
                    {text: "Return to the front entrance", nextSection: 64, skillCheck: false},
                    {text: "Wait and observe", nextSection: 86, skillCheck: false}
                ]
            },
            68: {
                text: "Now that you've been spotted, you need to decide how to proceed.",
                choices: [
                    {text: "Fight the guards", nextSection: 87, skillCheck: false},
                    {text: "Try to talk your way out", nextSection: 88, skillCheck: false},
                    {text: "Run for the woods", nextSection: 89, skillCheck: false}
                ]
            },
            69: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 90, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You find tracks leading away from the rabbit's body. They're humanoid but with an unusual gait - the creature was dragging one foot slightly. The tracks lead deeper into the woods, toward where you believe the church is located.";
                    } else {
                        playSound('failure');
                        return "The ground is too hard and covered with leaves to make out any clear tracks. You lose the trail.";
                    }
                }
            },
            70: {
                text: "After searching the area, you continue on your way.",
                choices: [
                    {text: "Continue along the path", nextSection: 29, skillCheck: false}
                ]
            },
            71: {
                text: "You stagger away from the altar, the dark whispers still echoing in your mind. But you've gained valuable information: Dracula's awakening is centered in the Mountains of Moor, at his ancient castle.",
                choices: [
                    {text: "Leave the altar area", nextSection: 19, skillCheck: false}
                ],
                action: function() {
                    gameState.mapFound = true;
                    return "The knowledge was hard-won, but now you know where you must go next after dealing with the cult here in the woodlands.";
                }
            },
            72: {
                text: "You charge the ritual gathering, catching them by surprise!",
                choices: [
                    {text: "Attack!", nextSection: 91, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Cultists & Vampire Spawn";
                    combatState.enemyHealth = 60;
                    combatState.enemyCurrentHealth = 60;
                    combatState.enemyStrength = 18;
                    combatState.enemyDamageDice = 3;
                    combatState.enemyDamageSides = 6;
                    combatState.nextSection = 92;
                    combatState.round = 0;
                    combatState.isGroup = true;
                    combatState.groupCount = 8;
                    
                    playSound('vampire');
                    return "<span class='vampire'>Cultists & Vampire Spawn</span>: Health " + combatState.enemyCurrentHealth + ", Strength " + combatState.enemyStrength;
                }
            },
            73: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 93, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You turn and run back toward the path, the cultists' cries fading behind you. You've escaped, but they'll be on high alert now.";
                    } else {
                        const damage = rollDice(2, 6);
                        gameState.health -= damage;
                        updateStatsDisplay();
                        playSound('damage');
                        return "You try to run but one of the cultists throws a dagger that strikes your leg for " + damage + " damage! They're closing in!";
                    }
                }
            },
            74: {
                text: "'I come in peace!' you shout, stepping into the clearing with your hands raised. 'I only seek information about Dracula's return.'",
                choices: [
                    {text: "Continue", nextSection: 94, skillCheck: false}
                ],
                action: function() {
                    playSound('cultist');
                    return "<span class='vampire'>Vampire Spawn</span>: 'Information? You'll get all the information you need when you join us in eternal service. Drink from the chalice, and all will be revealed.'";
                }
            },
            75: {
                text: "You wait until full darkness falls. The cult's chanting grows louder, and you can see flickering light through the church's broken windows. Under cover of darkness, you might have a better chance of approaching unseen.",
                choices: [
                    {text: "Approach the church now", nextSection: 45, skillCheck: false}
                ],
                action: function() {
                    return "Night has fully fallen. The blood moon is high in the sky, casting an eerie red light over the woodlands. It's now or never.";
                }
            },
            76: {
                text: "",
                choices: [
                    {text: "Attack!", nextSection: 76, skillCheck: false}
                ],
                action: function() {
                    // Execute one round of combat
                    if (combatState.active) {
                        const combatResult = executeCombatRound();
                        
                        // Check if combat is over
                        if (combatState.enemyCurrentHealth <= 0) {
                            combatState.active = false;
                            // Automatically go to victory section after a short delay
                            setTimeout(() => {
                                loadSection(combatState.nextSection);
                            }, 1500);
                            return combatResult + "<br><br><span class='success'>You defeated the cultists!</span>";
                        } else if (gameState.health <= 0) {
                            combatState.active = false;
                            // Game over - will be handled in executeCombatRound
                            return combatResult;
                        }
                        
                        return combatResult;
                    }
                    return "Combat has ended.";
                }
            },
            77: {
                text: "With the three cultists defeated, you search their bodies. One of them carries a map showing a route through the Mountains of Moor to Dracula's castle. Another has a silver dagger with the vampire lord's symbol on the hilt.",
                choices: [
                    {text: "Take the map", nextSection: 95, skillCheck: false},
                    {text: "Take the dagger", nextSection: 96, skillCheck: false},
                    {text: "Take both", nextSection: 97, skillCheck: false}
                ],
                action: function() {
                    gameState.cultistInterrogated = true;
                    playSound('item');
                    return "These cultists were clearly prepared for a journey to the mountains. The map is detailed, showing a hidden pass that avoids the main roads.";
                }
            },
            78: {
                text: "Now that you've heard their plans, you need to decide what to do.",
                choices: [
                    {text: "Attack the cultists", nextSection: 57, skillCheck: false},
                    {text: "Retreat quietly", nextSection: 59, skillCheck: false}
                ]
            },
            79: {
                text: "You retreat from the cultists' clearing and return to the main path. You now have a better understanding of what you're facing.",
                choices: [
                    {text: "Continue toward the church", nextSection: 29, skillCheck: false}
                ]
            },
            80: {
                text: "You draw your weapon and charge into the midst of the cultists!",
                choices: [
                    {text: "Attack!", nextSection: 98, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Church Cultists & Vampire Spawn";
                    combatState.enemyHealth = 80;
                    combatState.enemyCurrentHealth = 80;
                    combatState.enemyStrength = 20;
                    combatState.enemyDamageDice = 3;
                    combatState.enemyDamageSides = 6;
                    combatState.nextSection = 99;
                    combatState.round = 0;
                    combatState.isGroup = true;
                    combatState.groupCount = 13;
                    
                    playSound('vampire');
                    return "<span class='vampire'>Church Cultists & Vampire Spawn</span>: Health " + combatState.enemyCurrentHealth + ", Strength " + combatState.enemyStrength;
                }
            },
            81: {
                text: "'In the name of all that's holy, I order you to surrender!' you shout. The cultists laugh, and the vampire spawn smiles cruelly.",
                choices: [
                    {text: "Attack when they refuse", nextSection: 80, skillCheck: false},
                    {text: "Try a different approach", nextSection: 82, skillCheck: false}
                ],
                action: function() {
                    return "<span class='vampire'>Vampire Spawn</span>: 'Holy? There is nothing holy here. Only the eternal night and our master's glory.'";
                }
            },
            82: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 100, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "'I wish to join the master's service,' you say, trying to sound convincing. The vampire spawn studies you for a long moment. 'Perhaps... you do have potential. But first, you must prove your loyalty. Drink from the chalice.'";
                    } else {
                        playSound('failure');
                        return "'You're lying,' the vampire spawn says immediately. 'I can hear the falsehood in your heartbeat. Kill the intruder!'";
                    }
                }
            },
            83: {
                text: "From the sacristy, you have a clear view of the main chamber. The cultists are completely focused on their ritual, unaware of your presence. This gives you the element of surprise.",
                choices: [
                    {text: "Attack from the shadows", nextSection: 101, skillCheck: false},
                    {text: "Listen to the ritual", nextSection: 102, skillCheck: true, checkType: 'agility', difficulty: 15},
                    {text: "Search the sacristy", nextSection: 103, skillCheck: false}
                ]
            },
            84: {
                text: "Now that you've observed the ritual, you need to decide how to proceed.",
                choices: [
                    {text: "Enter through the main doors", nextSection: 64, skillCheck: false},
                    {text: "Look for another entrance", nextSection: 65, skillCheck: false}
                ]
            },
            85: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 104, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You slip through the window quietly and land in a shadowed corner of the church. The cultists haven't noticed your entry.";
                    } else {
                        playSound('failure');
                        return "You try to climb through the window but get caught on a piece of broken glass. It clatters to the floor, and every head in the church turns toward you!";
                    }
                }
            },
            86: {
                text: "You continue to observe the ritual. The cultists drink from the chalice one by one. Each seems to grow stronger, their eyes glowing with the same red light as the vampire spawn. This is some kind of empowerment ritual, giving them a fraction of vampire power.",
                choices: [
                    {text: "Enter through the window", nextSection: 85, skillCheck: false},
                    {text: "Go to the main entrance", nextSection: 64, skillCheck: false}
                ],
                action: function() {
                    return "The ritual is nearly complete. Soon all the cultists will have been 'blessed' with dark power. You need to act soon if you're going to stop them.";
                }
            },
            87: {
                text: "You decide to fight the two guards before more cultists arrive.",
                choices: [
                    {text: "Attack!", nextSection: 105, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Church Guards";
                    combatState.enemyHealth = 30;
                    combatState.enemyCurrentHealth = 30;
                    combatState.enemyStrength = 14;
                    combatState.enemyDamageDice = 2;
                    combatState.enemyDamageSides = 6;
                    combatState.nextSection = 106;
                    combatState.round = 0;
                    combatState.isGroup = true;
                    combatState.groupCount = 2;
                    
                    playSound('cultist');
                    return "<span class='cultist'>Church Guards</span>: Health " + combatState.enemyCurrentHealth + ", Strength " + combatState.enemyStrength;
                }
            },
            88: {
                text: "'I come in peace,' you say, raising your hands. 'I was sent by the bartender at the Blood Moon Tavern. He said you had information about Dracula.'",
                choices: [
                    {text: "Continue", nextSection: 107, skillCheck: false}
                ],
                action: function() {
                    return "The guards exchange glances. 'The bartender sent you? He's supposed to be on our side,' one says suspiciously.";
                }
            },
            89: {
                text: "You turn and flee into the woods, using your knowledge of the terrain to lose your pursuers. You circle around and approach the church from a different direction.",
                choices: [
                    {text: "Approach the church cautiously", nextSection: 45, skillCheck: false}
                ],
                action: function() {
                    playSound('success');
                    return "You've escaped, but the cult is now on high alert. Your next approach will need to be even more careful.";
                }
            },
            90: {
                text: "Following the tracks, you find yourself approaching the old church from an unexpected direction. The tracks lead right to a side entrance.",
                choices: [
                    {text: "Enter through the side entrance", nextSection: 108, skillCheck: false},
                    {text: "Return to the front of the church", nextSection: 45, skillCheck: false}
                ]
            },
            91: {
                text: "",
                choices: [
                    {text: "Attack!", nextSection: 91, skillCheck: false}
                ],
                action: function() {
                    // Execute one round of combat
                    if (combatState.active) {
                        const combatResult = executeCombatRound();
                        
                        // Check if combat is over
                        if (combatState.enemyCurrentHealth <= 0) {
                            combatState.active = false;
                            // Automatically go to victory section after a short delay
                            setTimeout(() => {
                                loadSection(combatState.nextSection);
                            }, 1500);
                            return combatResult + "<br><br><span class='success'>You defeated the cultists and vampire spawn!</span>";
                        } else if (gameState.health <= 0) {
                            combatState.active = false;
                            // Game over - will be handled in executeCombatRound
                            return combatResult;
                        }
                        
                        return combatResult;
                    }
                    return "Combat has ended.";
                }
            },
            92: {
                text: "With the cultists and vampire spawn defeated, you search the ritual site. Among the items, you find a detailed map of the Mountains of Moor with Dracula's castle marked clearly. You also find correspondence indicating that the vampire lord's awakening is nearly complete.",
                choices: [
                    {text: "Take the map and continue to the church", nextSection: 109, skillCheck: false},
                    {text: "Return to the tavern with this evidence", nextSection: 110, skillCheck: false}
                ],
                action: function() {
                    gameState.mapFound = true;
                    gameState.cultistInterrogated = true;
                    playSound('item');
                    return "This is the proof you needed. Dracula is indeed gathering his forces, and his mountain castle is the center of his power.";
                }
            },
            93: {
                text: "You escape the cultists and make your way back to the path. You'll need to be more careful approaching the church.",
                choices: [
                    {text: "Continue toward the church", nextSection: 29, skillCheck: false}
                ]
            },
            94: {
                text: "The vampire spawn floats toward you. 'Information? You'll get all the information you need when you join us in eternal service. Drink from the chalice, and all will be revealed.'",
                choices: [
                    {text: "Drink from the chalice (Game Over)", nextSection: 111, skillCheck: false},
                    {text: "Refuse and attack", nextSection: 72, skillCheck: false},
                    {text: "Try to escape", nextSection: 73, skillCheck: false}
                ],
                action: function() {
                    return "The chalice contains a dark, thick liquid that smells of blood and something else... something bitter and chemical.";
                }
            },
            95: {
                text: "You take the map. It shows a route through the Mountains of Moor that avoids the main passes, which are likely watched by Dracula's forces. This could be invaluable for your journey.",
                choices: [
                    {text: "Continue toward the church", nextSection: 29, skillCheck: false}
                ],
                action: function() {
                    addToInventory('Mountain Map');
                    gameState.mapFound = true;
                    playSound('item');
                    return "The map is detailed, showing not just the route but also locations of fresh water, shelter, and potential dangers.";
                }
            },
            96: {
                text: "You take the silver dagger. It's well-made and balanced, with Dracula's symbol - a bat with outstretched wings - engraved on the hilt.",
                choices: [
                    {text: "Continue toward the church", nextSection: 29, skillCheck: false}
                ],
                action: function() {
                    addToInventory('Cultist Dagger');
                    playSound('item');
                    return "The dagger feels cold in your hand, as if it carries the chill of the grave. Still, a silver weapon could be useful against vampires.";
                }
            },
            97: {
                text: "You take both the map and the dagger. The map will guide you to Dracula's mountain castle, and the dagger is a serviceable weapon against the creatures of the night.",
                choices: [
                    {text: "Continue toward the church", nextSection: 29, skillCheck: false}
                ],
                action: function() {
                    addToInventory('Mountain Map');
                    addToInventory('Cultist Dagger');
                    gameState.mapFound = true;
                    playSound('item');
                    return "Armed with both knowledge and a weapon, you feel better prepared for what lies ahead.";
                }
            },
            98: {
                text: "",
                choices: [
                    {text: "Attack!", nextSection: 98, skillCheck: false}
                ],
                action: function() {
                    // Execute one round of combat
                    if (combatState.active) {
                        const combatResult = executeCombatRound();
                        
                        // Check if combat is over
                        if (combatState.enemyCurrentHealth <= 0) {
                            combatState.active = false;
                            // Automatically go to victory section after a short delay
                            setTimeout(() => {
                                loadSection(combatState.nextSection);
                            }, 1500);
                            return combatResult + "<br><br><span class='success'>You defeated the church cultists and vampire spawn!</span>";
                        } else if (gameState.health <= 0) {
                            combatState.active = false;
                            // Game over - will be handled in executeCombatRound
                            return combatResult;
                        }
                        
                        return combatResult;
                    }
                    return "Combat has ended.";
                }
            },
            99: {
                text: "With the cultists and vampire spawn defeated, the church falls silent. You search the area and find important documents detailing Dracula's plans and the location of his mountain castle. You've accomplished your mission in the woodlands.",
                choices: [
                    {text: "Complete Level 2", nextSection: 112, skillCheck: false}
                ],
                action: function() {
                    gameState.gameComplete = true;
                    if (!gameState.inventory.includes('Mountain Map')) {
                        addToInventory('Mountain Map');
                    }
                    gameState.mapFound = true;
                    gameState.cultistInterrogated = true;
                    playSound('victory');
                    return "The church is cleansed of the cult's influence. You've gathered crucial information about Dracula's location and plans. Your next destination is clear: the Mountains of Moor.";
                }
            },
            100: {
                text: "The vampire spawn offers you the chalice. The liquid inside is dark and viscous, with a metallic smell. Drinking it would bind you to Dracula's service, but refusing would mean instant attack.",
                choices: [
                    {text: "Drink from the chalice (Game Over)", nextSection: 113, skillCheck: false},
                    {text: "Attack instead", nextSection: 80, skillCheck: false},
                    {text: "Try to knock the chalice away", nextSection: 114, skillCheck: true, checkType: 'agility', difficulty: 17}
                ]
            },
            101: {
                text: "You burst from the sacristy, catching the cultists by surprise!",
                choices: [
                    {text: "Attack!", nextSection: 115, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Surprised Cultists & Vampire Spawn";
                    combatState.enemyHealth = 70; // Lower due to surprise
                    combatState.enemyCurrentHealth = 70;
                    combatState.enemyStrength = 18; // Lower due to surprise
                    combatState.enemyDamageDice = 2;
                    combatState.enemyDamageSides = 8;
                    combatState.nextSection = 99;
                    combatState.round = 0;
                    combatState.isGroup = true;
                    combatState.groupCount = 13;
                    
                    playSound('vampire');
                    return "<span class='vampire'>Surprised Cultists & Vampire Spawn</span>: Health " + combatState.enemyCurrentHealth + ", Strength " + combatState.enemyStrength;
                }
            },
            102: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 116, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You listen to the vampire spawn's words: '...and with this final sacrament, you will be bound to our master's will. When he rises from his mountain tomb, you shall stand beside him as lords of the night.' This confirms that Dracula's awakening is centered in the mountains.";
                    } else {
                        playSound('failure');
                        return "You can't make out the words clearly from this distance. The chanting drowns out the specific instructions.";
                    }
                }
            },
            103: {
                text: "You search the sacristy. In an old chest, you find church records that have been defaced with dark symbols. More importantly, you find a map showing the route to Dracula's mountain castle, hidden in a false bottom of the chest.",
                choices: [
                    {text: "Take the map", nextSection: 117, skillCheck: false},
                    {text: "Attack the cultists from here", nextSection: 101, skillCheck: false},
                    {text: "Leave quietly with the map", nextSection: 118, skillCheck: true, checkType: 'agility', difficulty: 18}
                ],
                action: function() {
                    return "The map is exactly what you came to find. With this, you could leave now and head straight for the Mountains of Moor.";
                }
            },
            104: {
                text: "Now inside the church, you need to decide your next move. The cultists are still focused on their ritual.",
                choices: [
                    {text: "Attack from your hidden position", nextSection: 101, skillCheck: false},
                    {text: "Wait for the right moment", nextSection: 119, skillCheck: false},
                    {text: "Try to sabotage the ritual", nextSection: 120, skillCheck: true, checkType: 'agility', difficulty: 17}
                ]
            },
            105: {
                text: "",
                choices: [
                    {text: "Attack!", nextSection: 105, skillCheck: false}
                ],
                action: function() {
                    // Execute one round of combat
                    if (combatState.active) {
                        const combatResult = executeCombatRound();
                        
                        // Check if combat is over
                        if (combatState.enemyCurrentHealth <= 0) {
                            combatState.active = false;
                            // Automatically go to victory section after a short delay
                            setTimeout(() => {
                                loadSection(combatState.nextSection);
                            }, 1500);
                            return combatResult + "<br><br><span class='success'>You defeated the church guards!</span>";
                        } else if (gameState.health <= 0) {
                            combatState.active = false;
                            // Game over - will be handled in executeCombatRound
                            return combatResult;
                        }
                        
                        return combatResult;
                    }
                    return "Combat has ended.";
                }
            },
            106: {
                text: "With the guards defeated, you can now approach the church entrance. The noise of the battle might have alerted those inside, so you'll need to be cautious.",
                choices: [
                    {text: "Enter the church", nextSection: 64, skillCheck: false},
                    {text: "Look for another entrance", nextSection: 65, skillCheck: false}
                ],
                action: function() {
                    playSound('success');
                    return "You've cleared the outside guards. The path to the church doors is now open.";
                }
            },
            107: {
                text: "The guards lower their weapons slightly. 'The bartender sent you? He gave you the code word?' one asks suspiciously.",
                choices: [
                    {text: "Try to bluff your way through", nextSection: 121, skillCheck: true, checkType: 'agility', difficulty: 17},
                    {text: "Attack while they're confused", nextSection: 87, skillCheck: false},
                    {text: "Admit you don't know the code word", nextSection: 122, skillCheck: false}
                ],
                action: function() {
                    return "You weren't given any code word by the bartender. This is a test.";
                }
            },
            108: {
                text: "You enter through the side door and find yourself in a storage room filled with crates and barrels. From here, you can hear the chanting more clearly. A door leads to the main chamber.",
                choices: [
                    {text: "Enter the main chamber", nextSection: 123, skillCheck: false},
                    {text: "Search the storage room first", nextSection: 124, skillCheck: false}
                ]
            },
            109: {
                text: "With the map in hand, you continue toward the church. You might find more information there, or you might decide you have enough to proceed to the mountains.",
                choices: [
                    {text: "Approach the church", nextSection: 45, skillCheck: false}
                ]
            },
            110: {
                text: "You decide to return to the tavern with the evidence you've gathered. The bartender and other concerned villagers need to know what you've discovered.",
                choices: [
                    {text: "Complete Level 2", nextSection: 112, skillCheck: false}
                ],
                action: function() {
                    gameState.gameComplete = true;
                    if (!gameState.inventory.includes('Mountain Map')) {
                        addToInventory('Mountain Map');
                    }
                    gameState.mapFound = true;
                    playSound('victory');
                    return "You've gathered crucial intelligence about Dracula's plans. Returning to civilization to share this information is a valid choice, though it means leaving the cult intact for now.";
                }
            },
            111: {
                text: "You drink from the chalice. The liquid is thick and bitter, with a metallic aftertaste. Immediately, you feel a cold fire spreading through your veins. The world seems to sharpen, and you feel stronger... but also hungrier. The vampire spawn smiles. 'Welcome to the family.'",
                choices: [
                    {text: "Game Over - You joined the cult", nextSection: 125, skillCheck: false}
                ],
                action: function() {
                    return "You have become one of Dracula's servants. Your quest to stop him ends here, in service to the very darkness you sought to destroy.";
                }
            },
            112: {
                text: "",
                choices: [
                    {text: "Complete Level 2", nextSection: 126, skillCheck: false}
                ],
                action: function() {
                    // Show complete screen
                    showCompleteScreen();
                    return "";
                }
            },
            113: {
                text: "You drink from the chalice and feel your free will slipping away. The vampire spawn smiles as you kneel before it, now bound to Dracula's service. Your quest ends here, not in victory but in eternal servitude.",
                choices: [
                    {text: "Game Over", nextSection: 127, skillCheck: false}
                ],
                action: function() {
                    return "<div class='game-over'>YOU HAVE FALLEN TO DARKNESS</div><br>You are now one of Dracula's thralls. The world will fall to eternal night, and you helped make it happen.";
                }
            },
            114: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 128, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You slap the chalice from the vampire spawn's hand. The dark liquid spills across the stone floor, sizzling where it touches. 'You dare!' the creature snarls, and the cultists draw their weapons. Battle is inevitable now.";
                    } else {
                        playSound('failure');
                        return "You try to knock the chalice away but miss. The vampire spawn's hand moves with supernatural speed, grabbing your wrist. 'Foolish mortal,' it sneers before forcing the chalice to your lips.";
                    }
                }
            },
            115: {
                text: "",
                choices: [
                    {text: "Attack!", nextSection: 115, skillCheck: false}
                ],
                action: function() {
                    // Execute one round of combat
                    if (combatState.active) {
                        const combatResult = executeCombatRound();
                        
                        // Check if combat is over
                        if (combatState.enemyCurrentHealth <= 0) {
                            combatState.active = false;
                            // Automatically go to victory section after a short delay
                            setTimeout(() => {
                                loadSection(combatState.nextSection);
                            }, 1500);
                            return combatResult + "<br><br><span class='success'>You defeated the surprised cultists and vampire spawn!</span>";
                        } else if (gameState.health <= 0) {
                            combatState.active = false;
                            // Game over - will be handled in executeCombatRound
                            return combatResult;
                        }
                        
                        return combatResult;
                    }
                    return "Combat has ended.";
                }
            },
            116: {
                text: "Now that you've heard the ritual's purpose, you need to decide how to proceed.",
                choices: [
                    {text: "Attack from your hidden position", nextSection: 101, skillCheck: false},
                    {text: "Try to sabotage the ritual", nextSection: 120, skillCheck: false}
                ]
            },
            117: {
                text: "You take the map. It shows the route to Dracula's mountain castle in detail, including potential hazards and safe resting places along the way.",
                choices: [
                    {text: "Attack the cultists", nextSection: 101, skillCheck: false},
                    {text: "Leave quietly with the map", nextSection: 118, skillCheck: false}
                ],
                action: function() {
                    addToInventory('Mountain Map');
                    gameState.mapFound = true;
                    playSound('item');
                    return "With this map, you could bypass the cultists entirely and head straight for the Mountains of Moor. But leaving them to complete their ritual might have consequences.";
                }
            },
            118: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 129, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You slip out of the church as quietly as you entered. You have the information you came for - the location of Dracula's mountain castle. There's no need to risk further confrontation.";
                        gameState.gameComplete = true;
                        setTimeout(() => {
                            showCompleteScreen();
                        }, 2000);
                        return "";
                    } else {
                        playSound('failure');
                        return "You try to leave quietly but step on a loose floorboard that creaks loudly. The chanting stops abruptly. You've been discovered!";
                    }
                }
            },
            119: {
                text: "You wait for the right moment. The ritual reaches its climax - the vampire spawn raises the chalice high, and all the cultists kneel. This might be your best chance to strike.",
                choices: [
                    {text: "Attack now", nextSection: 101, skillCheck: false},
                    {text: "Wait until the ritual is complete", nextSection: 130, skillCheck: false}
                ],
                action: function() {
                    return "Striking during the ritual's climax might disrupt it entirely, potentially weakening the cultists. But waiting might give you more information.";
                }
            },
            120: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 131, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You notice that the ritual's power seems to be channeled through candles arranged in a specific pattern. Quietly, you extinguish several of them. The vampire spawn suddenly stumbles, and the chanting falters. You've weakened the ritual!";
                        // Weaken the enemy for combat
                        combatState.enemyStrength = 16;
                        combatState.enemyHealth = 60;
                    } else {
                        playSound('failure');
                        return "You try to sabotage the ritual but knock over a candlestick in the process. It clatters loudly to the floor, and all eyes turn to you. So much for stealth!";
                    }
                }
            },
            121: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 132, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "'The blood moon rises,' you say confidently, remembering the tavern's name. The guards nod. 'Very well. The master is inside. Don't interrupt the ritual.' They step aside, allowing you to enter.";
                    } else {
                        playSound('failure');
                        return "'That's not the right code,' one guard says, raising his weapon. 'You're an impostor!'";
                    }
                }
            },
            122: {
                text: "'I don't know any code word,' you admit. The guards' expressions harden. 'Then you're not one of us. Seize them!'",
                choices: [
                    {text: "Fight the guards", nextSection: 87, skillCheck: false},
                    {text: "Try to escape", nextSection: 89, skillCheck: false}
                ],
                action: function() {
                    playSound('cultist');
                    return "Honesty isn't always the best policy when dealing with cultists.";
                }
            },
            123: {
                text: "You enter the main chamber of the church. The cultists are so focused on their ritual that they don't immediately notice you. The vampire spawn at the center of the ritual has its back to you.",
                choices: [
                    {text: "Attack from behind", nextSection: 133, skillCheck: false},
                    {text: "Observe first", nextSection: 134, skillCheck: false},
                    {text: "Try to disrupt the ritual", nextSection: 120, skillCheck: false}
                ]
            },
            124: {
                text: "You search the storage room. Among the supplies, you find a crate containing silver stakes - tools for hunting vampires. You also find a journal that mentions 'the mountain castle' and 'the master's awakening.'",
                choices: [
                    {text: "Take a silver stake", nextSection: 135, skillCheck: false},
                    {text: "Take the journal", nextSection: 136, skillCheck: false},
                    {text: "Enter the main chamber", nextSection: 123, skillCheck: false}
                ],
                action: function() {
                    return "This storage room contains supplies for both the cult and potential vampire hunters. Interesting mix.";
                }
            },
            125: {
                text: "",
                choices: [
                    {text: "Game Over", nextSection: 137, skillCheck: false}
                ],
                action: function() {
                    showScreen('screen-game');
                    document.getElementById('story-text').innerHTML = "<div class='game-over'>YOU HAVE JOINED THE CULT</div><br><p>Your journey ends here, not as a hero but as another servant of the darkness. Dracula will rise, and you will help him plunge the world into eternal night.</p><br><button class='choice-btn' onclick='window.location.href=\"le1.html\"'>START OVER FROM LEVEL 1</button>";
                    return "";
                }
            },
            126: {
                text: "",
                choices: []
            },
            127: {
                text: "",
                choices: [
                    {text: "Game Over", nextSection: 137, skillCheck: false}
                ],
                action: function() {
                    showScreen('screen-game');
                    document.getElementById('story-text').innerHTML = "<div class='game-over'>GAME OVER</div><br><p>You have fallen to darkness. The world will know eternal night because you failed.</p><br><button class='choice-btn' onclick='window.location.href=\"le1.html\"'>START OVER FROM LEVEL 1</button>";
                    return "";
                }
            },
            128: {
                text: "After your attempt to knock away the chalice, combat begins.",
                choices: [
                    {text: "Continue to combat", nextSection: 80, skillCheck: false}
                ]
            },
            129: {
                text: "You successfully escape the church with the map. You have the information you need about Dracula's mountain castle. There's no need to risk further confrontation with the cult.",
                choices: [
                    {text: "Complete Level 2", nextSection: 126, skillCheck: false}
                ],
                action: function() {
                    gameState.gameComplete = true;
                    setTimeout(() => {
                        showCompleteScreen();
                    }, 1000);
                    return "";
                }
            },
            130: {
                text: "You wait until the ritual is complete. The cultists rise, their eyes glowing with dark power. They've all been transformed into something more than human, but less than vampire. The vampire spawn turns and smiles at you. 'Ah, our audience has stayed for the finale. How thoughtful.'",
                choices: [
                    {text: "Attack now", nextSection: 138, skillCheck: false},
                    {text: "Try to talk your way out", nextSection: 139, skillCheck: false}
                ],
                action: function() {
                    playSound('vampire');
                    return "Waiting might have been a mistake. The cultists are now empowered by the ritual, making them more dangerous opponents.";
                }
            },
            131: {
                text: "After your attempt to sabotage the ritual, combat begins.",
                choices: [
                    {text: "Continue to combat", nextSection: 101, skillCheck: false}
                ]
            },
            132: {
                text: "The guards let you pass. You enter the church and find yourself in the midst of the ritual.",
                choices: [
                    {text: "Continue", nextSection: 64, skillCheck: false}
                ]
            },
            133: {
                text: "You strike the vampire spawn from behind, catching it completely by surprise!",
                choices: [
                    {text: "Attack!", nextSection: 140, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Surprised Vampire Spawn & Cultists";
                    combatState.enemyHealth = 50; // Much lower due to surprise back attack
                    combatState.enemyCurrentHealth = 50;
                    combatState.enemyStrength = 16; // Lower due to surprise
                    combatState.enemyDamageDice = 2;
                    combatState.enemyDamageSides = 6;
                    combatState.nextSection = 99;
                    combatState.round = 0;
                    combatState.isGroup = true;
                    combatState.groupCount = 13;
                    
                    playSound('vampire');
                    return "<span class='vampire'>Surprised Vampire Spawn & Cultists</span>: Health " + combatState.enemyCurrentHealth + ", Strength " + combatState.enemyStrength;
                }
            },
            134: {
                text: "You observe the ritual from your hidden position. The vampire spawn is chanting in an ancient language, and as it does, dark energy flows from the cultists into the chalice. This is a power-sharing ritual, strengthening the spawn at the expense of the cultists' life force.",
                choices: [
                    {text: "Attack now", nextSection: 133, skillCheck: false},
                    {text: "Wait for the right moment", nextSection: 119, skillCheck: false}
                ],
                action: function() {
                    return "The ritual seems to be draining the cultists. If you wait, they might be weakened... but the vampire spawn might grow stronger.";
                }
            },
            135: {
                text: "You take one of the silver stakes. It's a classic vampire hunting tool - drive it through the heart and the creature will be destroyed.",
                choices: [
                    {text: "Enter the main chamber", nextSection: 123, skillCheck: false}
                ],
                action: function() {
                    addToInventory('Silver Stake');
                    playSound('item');
                    return "The stake is cold and heavy in your hand. Properly used, it could end a vampire's existence permanently.";
                }
            },
            136: {
                text: "You take the journal. It contains notes about Dracula's mountain castle, including its defenses and the best ways to approach it. There's also mention of a 'daylight chamber' where the vampire lord is most vulnerable.",
                choices: [
                    {text: "Enter the main chamber", nextSection: 123, skillCheck: false}
                ],
                action: function() {
                    addToInventory('Castle Journal');
                    gameState.mapFound = true;
                    playSound('item');
                    return "This journal contains invaluable intelligence about your ultimate target. It mentions that Dracula is weakened during daylight and must rest in his coffin, which is kept in a special chamber in the castle.";
                }
            },
            137: {
                text: "",
                choices: []
            },
            138: {
                text: "You attack the newly empowered cultists and their vampire leader!",
                choices: [
                    {text: "Attack!", nextSection: 141, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Empowered Cultists & Vampire Spawn";
                    combatState.enemyHealth = 90; // Higher due to ritual completion
                    combatState.enemyCurrentHealth = 90;
                    combatState.enemyStrength = 22; // Higher due to ritual completion
                    combatState.enemyDamageDice = 3;
                    combatState.enemyDamageSides = 8;
                    combatState.nextSection = 99;
                    combatState.round = 0;
                    combatState.isGroup = true;
                    combatState.groupCount = 13;
                    
                    playSound('vampire');
                    return "<span class='vampire'>Empowered Cultists & Vampire Spawn</span>: Health " + combatState.enemyCurrentHealth + ", Strength " + combatState.enemyStrength;
                }
            },
            139: {
                text: "'I come bearing a message from... a higher power,' you say, trying to sound authoritative. The vampire spawn laughs. 'There is no power higher than our master. Kill this fool.'",
                choices: [
                    {text: "Attack as they approach", nextSection: 138, skillCheck: false},
                    {text: "Try to escape", nextSection: 142, skillCheck: true, checkType: 'agility', difficulty: 19}
                ],
                action: function() {
                    return "<span class='vampire'>Vampire Spawn</span>: 'Your lies are transparent, mortal. Your blood will feed our strength.'";
                }
            },
            140: {
                text: "",
                choices: [
                    {text: "Attack!", nextSection: 140, skillCheck: false}
                ],
                action: function() {
                    // Execute one round of combat
                    if (combatState.active) {
                        const combatResult = executeCombatRound();
                        
                        // Check if combat is over
                        if (combatState.enemyCurrentHealth <= 0) {
                            combatState.active = false;
                            // Automatically go to victory section after a short delay
                            setTimeout(() => {
                                loadSection(combatState.nextSection);
                            }, 1500);
                            return combatResult + "<br><br><span class='success'>You defeated the surprised cultists and vampire spawn!</span>";
                        } else if (gameState.health <= 0) {
                            combatState.active = false;
                            // Game over - will be handled in executeCombatRound
                            return combatResult;
                        }
                        
                        return combatResult;
                    }
                    return "Combat has ended.";
                }
            },
            141: {
                text: "",
                choices: [
                    {text: "Attack!", nextSection: 141, skillCheck: false}
                ],
                action: function() {
                    // Execute one round of combat
                    if (combatState.active) {
                        const combatResult = executeCombatRound();
                        
                        // Check if combat is over
                        if (combatState.enemyCurrentHealth <= 0) {
                            combatState.active = false;
                            // Automatically go to victory section after a short delay
                            setTimeout(() => {
                                loadSection(combatState.nextSection);
                            }, 1500);
                            return combatResult + "<br><br><span class='success'>You defeated the empowered cultists and vampire spawn!</span>";
                        } else if (gameState.health <= 0) {
                            combatState.active = false;
                            // Game over - will be handled in executeCombatRound
                            return combatResult;
                        }
                        
                        return combatResult;
                    }
                    return "Combat has ended.";
                }
            },
            142: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 143, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You turn and flee, using every trick you know to lose your pursuers in the church's maze-like interior. You escape out a side door and into the woods. You'll need to regroup and approach differently.";
                    } else {
                        const damage = rollDice(3, 6);
                        gameState.health -= damage;
                        updateStatsDisplay();
                        playSound('damage');
                        return "You try to escape but the newly empowered cultists move with supernatural speed. One catches you with a dagger strike for " + damage + " damage! You're surrounded!";
                    }
                }
            },
            143: {
                text: "You escape the church and find a safe place to hide in the woods. After catching your breath, you approach the church again, trying a different tactic.",
                choices: [
                    {text: "Approach the church cautiously", nextSection: 45, skillCheck: false}
                ]
            }
        };
        
        // Load story section
        function loadSection(sectionId) {
            playSound('click');
            gameState.currentSection = sectionId;
            const section = storySections[sectionId];
            
            if (!section) {
                document.getElementById('story-text').innerHTML = "<p class='game-over'>Error: Story section not found!</p>";
                return;
            }
            
            let storyText = section.text;
            
            // Execute any section action
            if (section.action) {
                const actionResult = section.action();
                if (actionResult) {
                    storyText += "<br><br>" + actionResult;
                }
            }
            
            document.getElementById('story-text').innerHTML = "<p>" + storyText + "</p><div class='blinking-cursor'></div>";
            
            // Clear choice buttons
            const choiceButtons = document.getElementById('choice-buttons');
            choiceButtons.innerHTML = '';
            
            // If in combat, show attack button
            if (combatState.active && (sectionId === 14 || sectionId === 43 || sectionId === 76 || sectionId === 91 || sectionId === 98 || sectionId === 105 || sectionId === 115 || sectionId === 140 || sectionId === 141)) {
                const attackButton = document.createElement('button');
                attackButton.className = 'choice-btn';
                attackButton.textContent = "Attack!";
                attackButton.onclick = function() {
                    loadSection(sectionId); // Reload the same section to execute another combat round
                };
                choiceButtons.appendChild(attackButton);
                return;
            }
            
            // Filter choices based on requirements
            const availableChoices = section.choices.filter(choice => {
                if (!choice.requirement) return true;
                if (typeof choice.requirement === 'function') {
                    return choice.requirement();
                }
                return gameState.inventory.includes(choice.requirement) || 
                       gameState.equippedWeapon === choice.requirement ||
                       gameState.equippedArmor === choice.requirement;
            });
            
            // If no choices available (and not a special section), provide a default
            if (availableChoices.length === 0 && section.choices.length > 0) {
                const button = document.createElement('button');
                button.className = 'choice-btn';
                button.textContent = "Continue";
                button.onclick = function() {
                    loadSection(1); // Go back to start
                };
                choiceButtons.appendChild(button);
            } else {
                availableChoices.forEach(choice => {
                    const button = document.createElement('button');
                    button.className = 'choice-btn';
                    button.textContent = choice.text;
                    button.onclick = function() {
                        if (choice.skillCheck) {
                            performSkillCheck(choice.checkType, choice.difficulty, choice.nextSection);
                        } else {
                            loadSection(choice.nextSection);
                        }
                    };
                    choiceButtons.appendChild(button);
                });
            }
            
            // Save game progress
            saveGame();
        }
        
        // Execute one round of combat
        function executeCombatRound() {
            combatState.round++;
            
            // Roll dice for both combatants
            const playerRoll = rollDice(2, 6);
            const enemyRoll = rollDice(2, 6);
            
            // Add strength to dice rolls
            const playerTotal = playerRoll + gameState.strength;
            const enemyTotal = enemyRoll + combatState.enemyStrength;
            
            let resultText = `<div class="combat-log"><span class="enemy">ROUND ${combatState.round}: ${combatState.enemyName}</span><br>`;
            resultText += `Your Health: ${gameState.health}/${gameState.maxHealth}, Enemy Health: ${combatState.enemyCurrentHealth}<br>`;
            resultText += `You roll ${playerRoll} + Strength ${gameState.strength} = <strong>${playerTotal}</strong><br>`;
            resultText += `Enemy rolls ${enemyRoll} + Strength ${combatState.enemyStrength} = <strong>${enemyTotal}</strong><br>`;
            
            if (playerTotal > enemyTotal) {
                // Player hits enemy
                let damage = 0;
                let weaponType = gameState.equippedWeapon;
                
                // Weapon bonuses
                if (weaponType === 'Steel Sword') {
                    damage = rollDice(2, 8) + 3;
                } else if (weaponType === 'Silver Dagger' || weaponType === 'Cultist Dagger') {
                    damage = rollDice(2, 6) + 2;
                    // Silver weapons are extra effective against vampires
                    if (combatState.enemyName.includes('Vampire')) {
                        damage += 5;
                        resultText += "<span class='success'>Silver weapon bonus against vampire!</span><br>";
                    }
                } else if (weaponType === 'Walking Stick') {
                    damage = rollDice(1, 6) + 1;
                } else {
                    damage = rollDice(1, 6);
                }
                
                combatState.enemyCurrentHealth -= damage;
                resultText += `<span class="success">You hit for ${damage} damage!</span><br>`;
                playSound('combat');
                
            } else if (playerTotal < enemyTotal) {
                // Enemy hits player
                let enemyDamage = rollDice(combatState.enemyDamageDice, combatState.enemyDamageSides);
                
                // Group enemies attack together
                if (combatState.isGroup && combatState.groupCount > 1) {
                    enemyDamage += Math.floor(combatState.groupCount * 2); // Extra damage for group
                    resultText += `The enemies attack together!<br>`;
                }
                
                gameState.health -= enemyDamage;
                resultText += `<span class="damage">The ${combatState.enemyName} hits you for ${enemyDamage} damage!</span>`;
                playSound('damage');
                
            } else {
                // Tie - no damage dealt
                resultText += "The attacks are evenly matched! No damage dealt this round.";
            }
            
            resultText += `</div>`;
            updateStatsDisplay();
            
            // Check for player death
            if (gameState.health <= 0) {
                gameState.health = 0;
                updateStatsDisplay();
                resultText += `<div class="game-over">YOU HAVE DIED</div>`;
                resultText += `<br><button class="choice-btn" onclick="window.location.href='le1.html'">START OVER FROM LEVEL 1</button>`;
                combatState.active = false;
            }
            
            return resultText;
        }
        
        // Show complete screen
        function showCompleteScreen() {
            // Update complete screen stats
            document.getElementById('complete-stat-strength').textContent = gameState.strength;
            document.getElementById('complete-stat-health').textContent = gameState.health;
            document.getElementById('complete-stat-agility').textContent = gameState.agility;
            document.getElementById('complete-stat-gold').textContent = gameState.gold;
            
            playSound('victory');
            showScreen('screen-complete');
            
            // Save completed game state
            saveGame();
        }
        
        // Go to next level
        function goToNextLevel() {
            playSound('click');
            // Save game state for level 3
            gameState.level = 3;
            gameState.currentSection = 1;
            saveGame();
            
            // Redirect to level 3
            window.location.href = 'le3.html';
        }
        
        // Perform skill check
        function performSkillCheck(checkType, difficulty, nextSection) {
            playSound('roll');
            const diceRoll = rollDice(2, 6);
            let statValue = gameState[checkType];
            let success = diceRoll <= statValue;
            
            // Store result globally for section actions to use
            window.checkResult = success;
            
            let resultText = `You roll ${diceRoll}. Your ${checkType.toUpperCase()} is ${statValue}. `;
            resultText += success ? 
                `<span class="success">Success!</span>` : 
                `<span class="damage">Failure!</span>`;
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${resultText}</div>`;
            
            if (success) {
                playSound('success');
            } else {
                playSound('failure');
            }
            
            // Continue to next section after a brief delay
            setTimeout(() => {
                loadSection(nextSection);
            }, 1500);
        }
        
        // Use Agility
        function useAgility() {
            playSound('click');
            if (gameState.agility <= 0) {
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">You have no Agility!</div>`;
                return;
            }
            
            const diceRoll = rollDice(2, 6);
            const success = diceRoll <= gameState.agility;
            
            let resultText = `You use your agility... Roll: ${diceRoll}, Agility: ${gameState.agility}. `;
            resultText += success ? 
                `<span class="success">Agile!</span> You move with grace and speed.` : 
                `<span class="damage">Clumsy!</span> You fumble.`;
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${resultText}</div>`;
            
            if (success) {
                playSound('success');
                // Good effect
                const goodEffects = [
                    "You dodge an attack!",
                    "You move silently past an enemy.",
                    "You climb a difficult obstacle.",
                    "You slip through a narrow passage."
                ];
                const effect = goodEffects[Math.floor(Math.random() * goodEffects.length)];
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">${effect}</div>`;
            } else {
                playSound('failure');
                // Bad effect
                const badEffects = [
                    "You trip and take 5 damage!",
                    "You make noise and alert nearby enemies.",
                    "You get tangled in something.",
                    "You knock something over, making noise."
                ];
                const effect = badEffects[Math.floor(Math.random() * badEffects.length)];
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">${effect}</div>`;
                
                if (effect.includes("damage")) {
                    gameState.health -= 5;
                    updateStatsDisplay();
                    playSound('damage');
                }
            }
        }
        
        // Save game
        function saveGame() {
            playSound('click');
            localStorage.setItem('draculaGameState', JSON.stringify(gameState));
            document.getElementById('story-text').innerHTML += `<div class="dice-roll"><span class="success">Game saved!</span></div>`;
        }
        
        // Load game
        function loadGame() {
            playSound('click');
            const savedGame = localStorage.getItem('draculaGameState');
            if (savedGame) {
                try {
                    const savedState = JSON.parse(savedGame);
                    
                    // Only load if saved level is 2 or player is coming from level 1
                    if (savedState.level === 1 || savedState.level === 2) {
                        Object.assign(gameState, savedState);
                        gameState.level = 2; // Ensure we're on level 2
                        
                        updateStatsDisplay();
                        updateInventoryDisplay();
                        loadSection(gameState.currentSection);
                        
                        document.getElementById('story-text').innerHTML += `<div class="dice-roll"><span class="success">Game loaded!</span></div>`;
                    } else {
                        document.getElementById('story-text').innerHTML += `<div class="dice-roll">No saved game found for Level 2.</div>`;
                    }
                } catch (e) {
                    document.getElementById('story-text').innerHTML += `<div class="dice-roll">Error loading saved game.</div>`;
                }
            } else {
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">No saved game found.</div>`;
            }
        }
        
        // Utility function to roll dice
        function rollDice(num, sides) {
            let total = 0;
            for (let i = 0; i < num; i++) {
                total += Math.floor(Math.random() * sides) + 1;
            }
            return total;
        }
        
        // Initialize on load
        window.onload = initGame;
        
        // Add click sound to all buttons
        document.addEventListener('DOMContentLoaded', function() {
            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => {
                button.addEventListener('click', function() {
                    playSound('click');
                });
            });
        });
    </script>
</body>
</html>
