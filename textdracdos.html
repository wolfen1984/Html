<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dracula 1986 - Enhanced Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #000;
            color: #fff;
            font-family: 'Press Start 2P', monospace;
            font-size: 16px;
            line-height: 1.6;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            padding: 0;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
            background-color: #111;
            padding: 10px;
            gap: 10px;
        }
        
        .header {
            text-align: center;
            padding: 5px 0;
            border-bottom: 1px solid #444;
            flex-shrink: 0;
            height: 60px;
        }
        
        h1 {
            color: #ff0000;
            font-size: 20px;
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.7);
            margin-bottom: 5px;
            letter-spacing: 1px;
        }
        
        .subtitle {
            color: #aaa;
            font-size: 10px;
            margin-bottom: 5px;
        }
        
        .game-area {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            gap: 10px;
            min-height: 0; /* Important for Firefox */
        }
        
        .output-container {
            flex-grow: 1;
            min-height: 0;
            display: flex;
            flex-direction: column;
            background-color: #000;
            border: 2px solid #333;
            position: relative;
        }
        
        .output {
            background-color: #000;
            color: #fff;
            padding: 15px;
            overflow-y: auto;
            flex-grow: 1;
            font-size: 16px;
            line-height: 1.8;
        }
        
        .input-area {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: #111;
            padding: 10px;
            border: 1px solid #333;
            flex-shrink: 0;
            height: 60px;
        }
        
        .prompt {
            color: #ff0000;
            font-weight: bold;
            white-space: nowrap;
            font-size: 16px;
        }
        
        #command {
            background-color: #000;
            color: #fff;
            border: 1px solid #333;
            font-family: 'Press Start 2P', monospace;
            font-size: 16px;
            padding: 10px;
            flex-grow: 1;
            outline: none;
            height: 40px;
        }
        
        #command:focus {
            border-color: #ff0000;
            box-shadow: 0 0 5px rgba(255, 0, 0, 0.5);
        }
        
        .status-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
            background-color: #222;
            padding: 8px;
            border: 1px solid #333;
            flex-shrink: 0;
            height: 50px;
            font-size: 11px;
        }
        
        .status-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .status-label {
            color: #aaa;
            font-size: 8px;
            margin-bottom: 2px;
            text-align: center;
        }
        
        .status-value {
            color: #fff;
            font-size: 11px;
            text-align: center;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 5px;
            flex-shrink: 0;
            padding: 5px 0;
            height: 60px;
        }
        
        button {
            background-color: #222;
            color: #fff;
            border: 1px solid #333;
            font-family: 'Press Start 2P', monospace;
            font-size: 10px;
            padding: 8px 10px;
            cursor: pointer;
            transition: all 0.2s;
            flex-grow: 1;
            min-width: 100px;
        }
        
        button:hover {
            background-color: #333;
            border-color: #ff0000;
        }
        
        .intro-text {
            color: #ff0000;
            text-align: center;
            animation: pulse 3s infinite;
            font-size: 12px;
            padding: 5px;
        }
        
        @keyframes pulse {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }
        
        .output-line {
            margin-bottom: 12px;
            animation: fadeIn 0.3s;
            word-wrap: break-word;
            word-break: break-word;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .location {
            color: #ff9900;
            font-weight: bold;
        }
        
        .item {
            color: #00cc00;
        }
        
        .enemy {
            color: #ff0000;
        }
        
        .error {
            color: #ff5555;
        }
        
        .success {
            color: #55ff55;
        }
        
        .help {
            color: #aaa;
        }
        
        .npc {
            color: #55aaff;
        }
        
        .dialogue {
            color: #ffff55;
            font-style: italic;
            margin-left: 20px;
        }
        
        .inventory-title {
            color: #ff9900;
            margin-top: 15px;
            margin-bottom: 5px;
        }
        
        .inventory-item {
            color: #00cc00;
            margin-left: 20px;
        }
        
        .equipped {
            color: #ffaa00;
        }
        
        .combat {
            color: #ff5555;
            font-weight: bold;
        }
        
        .scroll-indicator {
            position: absolute;
            bottom: 10px;
            right: 10px;
            color: #666;
            font-size: 8px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .game-stats {
            display: flex;
            justify-content: space-around;
            padding: 5px;
            background-color: #1a1a1a;
            border: 1px solid #333;
            font-size: 9px;
            flex-shrink: 0;
            height: 40px;
            align-items: center;
        }
        
        .quick-commands {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            padding: 5px;
            background-color: #111;
            border: 1px solid #333;
            flex-shrink: 0;
            height: 60px;
            justify-content: center;
            align-items: center;
        }
        
        .quick-cmd {
            background-color: #222;
            color: #aaa;
            border: 1px solid #333;
            padding: 6px 8px;
            font-size: 9px;
            cursor: pointer;
            flex-grow: 1;
            text-align: center;
            min-width: 80px;
        }
        
        .quick-cmd:hover {
            background-color: #333;
            color: #fff;
        }
        
        .command-history {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.8);
            border: 1px solid #333;
            padding: 5px;
            font-size: 10px;
            max-width: 300px;
            z-index: 100;
            display: none;
        }
        
        /* Landscape orientation adjustments */
        @media (orientation: landscape) {
            .container {
                padding: 5px;
                gap: 5px;
            }
            
            .header {
                height: 40px;
                padding: 2px 0;
            }
            
            h1 {
                font-size: 16px;
                margin-bottom: 2px;
            }
            
            .subtitle {
                font-size: 8px;
            }
            
            .status-bar {
                grid-template-columns: repeat(4, 1fr);
                height: 40px;
                font-size: 9px;
                padding: 5px;
            }
            
            .status-label {
                font-size: 7px;
            }
            
            .status-value {
                font-size: 9px;
            }
            
            .game-stats {
                height: 35px;
                font-size: 8px;
            }
            
            .quick-commands {
                height: 50px;
            }
            
            .input-area {
                height: 50px;
                padding: 8px;
            }
            
            #command {
                font-size: 14px;
                height: 35px;
                padding: 8px;
            }
            
            .controls {
                height: 50px;
            }
            
            button {
                font-size: 9px;
                padding: 6px 8px;
                min-width: 80px;
            }
            
            .output {
                font-size: 14px;
                line-height: 1.6;
                padding: 10px;
            }
        }
        
        /* Portrait orientation adjustments */
        @media (orientation: portrait) {
            .container {
                padding: 8px;
                gap: 8px;
            }
            
            .header {
                height: 70px;
            }
            
            h1 {
                font-size: 22px;
            }
            
            .subtitle {
                font-size: 11px;
            }
            
            .game-area {
                gap: 8px;
            }
            
            .output {
                font-size: 18px;
                line-height: 1.8;
                padding: 12px;
            }
            
            .input-area {
                height: 70px;
            }
            
            #command {
                font-size: 18px;
                height: 50px;
            }
            
            .status-bar {
                height: 60px;
                font-size: 12px;
            }
            
            .status-label {
                font-size: 9px;
            }
            
            .status-value {
                font-size: 12px;
            }
            
            .controls {
                height: 70px;
            }
            
            button {
                font-size: 11px;
                padding: 10px;
                min-width: 110px;
            }
            
            .quick-commands {
                height: 70px;
            }
            
            .quick-cmd {
                font-size: 10px;
                padding: 8px;
                min-width: 90px;
            }
        }
        
        /* Mobile specific adjustments */
        @media (max-width: 768px) and (orientation: portrait) {
            .header {
                height: 60px;
            }
            
            h1 {
                font-size: 18px;
            }
            
            .subtitle {
                font-size: 9px;
            }
            
            .output {
                font-size: 16px;
                padding: 10px;
            }
            
            .input-area {
                height: 60px;
            }
            
            #command {
                font-size: 16px;
                height: 40px;
            }
            
            .controls {
                height: auto;
                min-height: 60px;
            }
            
            button {
                font-size: 9px;
                padding: 8px;
                min-width: 90px;
            }
            
            .status-bar {
                height: 50px;
            }
            
            .status-label {
                font-size: 8px;
            }
            
            .status-value {
                font-size: 10px;
            }
        }
        
        /* Desktop adjustments */
        @media (min-width: 1024px) {
            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
            }
            
            .output {
                font-size: 18px;
                line-height: 1.8;
            }
            
            #command {
                font-size: 18px;
            }
            
            .status-bar {
                font-size: 14px;
                padding: 10px;
            }
            
            .status-label {
                font-size: 10px;
            }
            
            .status-value {
                font-size: 14px;
            }
            
            button {
                font-size: 12px;
                padding: 10px 15px;
            }
        }
        
        /* Hide scrollbar but keep functionality */
        .output::-webkit-scrollbar {
            width: 8px;
        }
        
        .output::-webkit-scrollbar-track {
            background: #111;
        }
        
        .output::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 4px;
        }
        
        .output::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>DRACULA 1986</h1>
            <div class="subtitle">TEXT ADVENTURE - ENHANCED EDITION</div>
        </div>
        
        <div class="intro-text">TRANSCARPATHIA AWAITS... ENTER YOUR COMMAND</div>
        
        <div class="game-area">
            <div class="output-container">
                <div class="output" id="output">
                    <!-- Game output will appear here -->
                </div>
                <div class="scroll-indicator">▼ SCROLL ▼</div>
            </div>
            
            <div class="quick-commands">
                <div class="quick-cmd" data-cmd="LOOK">LOOK</div>
                <div class="quick-cmd" data-cmd="INVENTORY">INVENTORY</div>
                <div class="quick-cmd" data-cmd="TALK">TALK</div>
                <div class="quick-cmd" data-cmd="EQUIP">EQUIP</div>
                <div class="quick-cmd" data-cmd="ATTACK">ATTACK</div>
                <div class="quick-cmd" data-cmd="HELP">HELP</div>
            </div>
            
            <div class="input-area">
                <div class="prompt">&gt;</div>
                <input type="text" id="command" placeholder="Type command (e.g. LOOK, TALK VILLAGER, EQUIP STAKE)" autocomplete="off" autofocus>
            </div>
            
            <div class="status-bar">
                <div class="status-item">
                    <div class="status-label">LOCATION</div>
                    <div class="status-value" id="location">Gates</div>
                </div>
                <div class="status-item">
                    <div class="status-label">HEALTH</div>
                    <div class="status-value" id="health">100%</div>
                </div>
                <div class="status-item">
                    <div class="status-label">WEAPON</div>
                    <div class="status-value" id="weapon">None</div>
                </div>
                <div class="status-item">
                    <div class="status-label">TURNS</div>
                    <div class="status-value" id="turns">0</div>
                </div>
            </div>
            
            <div class="game-stats">
                <div>KILLS: <span id="kills">0</span></div>
                <div>COINS: <span id="coins">0</span></div>
                <div>ARMOR: <span id="armor">None</span></div>
                <div>XP: <span id="xp">0</span></div>
            </div>
            
            <div class="controls">
                <button id="help-btn">HELP</button>
                <button id="talk-btn">TALK</button>
                <button id="equip-btn">EQUIP</button>
                <button id="save-btn">SAVE</button>
                <button id="load-btn">LOAD</button>
                <button id="restart-btn">RESTART</button>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Game State
        const gameState = {
            currentLocation: 'castleGates',
            health: 100,
            maxHealth: 100,
            time: 'night',
            inventory: [],
            equippedWeapon: null,
            equippedArmor: null,
            kills: 0,
            coins: 0,
            experience: 0,
            level: 1,
            turns: 0,
            playerAttack: 10,
            playerDefense: 5,
            npcDialogue: {},
            locations: {
                castleGates: {
                    name: 'Castle Gates',
                    description: 'You stand before the imposing gates of CASTLE DRACULA. The iron gates are rusted but still formidable. To the NORTH lies the castle courtyard. A cold wind blows from the EAST.',
                    items: ['rusty key', 'torch'],
                    enemies: [],
                    npcs: [{name: 'old man', dialogue: 'Beware the castle! None who enter return the same... if they return at all.', givesItem: null, givesInfo: 'The werewolves fear silver.'}],
                    exits: {north: 'courtyard', east: 'forestPath', south: 'road'}
                },
                courtyard: {
                    name: 'Castle Courtyard',
                    description: 'A desolate courtyard surrounded by high stone walls. A large wooden door leads into the castle to the WEST. The castle gates are to the SOUTH. A stone well stands in the center.',
                    items: ['wooden stake', 'leather armor'],
                    enemies: ['bat swarm'],
                    npcs: [],
                    exits: {south: 'castleGates', west: 'greatHall', down: 'well', east: 'stables'}
                },
                greatHall: {
                    name: 'Great Hall',
                    description: 'A vast hall with a high ceiling. Dusty tapestries line the walls depicting ancient battles. A grand staircase leads UP. The courtyard is to the EAST.',
                    items: ['silver cross', 'health potion'],
                    enemies: [],
                    npcs: [{name: 'ghostly knight', dialogue: 'I fell defending this hall centuries ago. Dracula must be stopped!', givesItem: 'enchanted sword', givesInfo: 'The secret passage is behind the third tapestry.'}],
                    exits: {east: 'courtyard', up: 'upperHallway', north: 'diningHall', west: 'kitchen'}
                },
                upperHallway: {
                    name: 'Upper Hallway',
                    description: 'A long, dark hallway with several doors. Cobwebs hang from the ceiling. The staircase leads DOWN.',
                    items: ['garlic clove', 'silver dagger'],
                    enemies: ['shadow figure'],
                    npcs: [],
                    exits: {down: 'greatHall', north: 'library', south: 'bedchamber', east: 'balcony', west: 'servantQuarters'}
                },
                library: {
                    name: 'Library',
                    description: 'A room filled with ancient books and scrolls. A large book lies open on a desk. The hallway is to the SOUTH.',
                    items: ['vampire tome', 'map of castle'],
                    enemies: [],
                    npcs: [{name: 'mad librarian', dialogue: 'Knowledge is power! But some knowledge corrupts... The vampire lore section is restricted.', givesItem: 'elder scroll', givesInfo: 'Dracula rests in his coffin during daylight hours.'}],
                    exits: {south: 'upperHallway', east: 'study'}
                },
                bedchamber: {
                    name: 'Dracula\'s Bedchamber',
                    description: 'An opulent but dusty bedroom. A large black coffin rests in the center on a stone dais. The hallway is to the NORTH.',
                    items: [],
                    enemies: ['dracula'],
                    npcs: [],
                    exits: {north: 'upperHallway', west: 'secretPassage'}
                },
                forestPath: {
                    name: 'Forest Path',
                    description: 'A dark path through the Transylvanian forest. The castle gates are to the WEST. The path continues EAST. Strange howls echo in the distance.',
                    items: ['holy water', 'herbs'],
                    enemies: ['wolf', 'werewolf'],
                    npcs: [{name: 'lost villager', dialogue: 'They took my family! The castle... I cannot go back there.', givesItem: 'lucky charm', givesInfo: 'The gypsy camp has powerful charms.'}],
                    exits: {west: 'castleGates', east: 'village', north: 'gypsyCamp', south: 'creek'}
                },
                village: {
                    name: 'Village',
                    description: 'A small, terrified village at the edge of the forest. The path to the castle is WEST. A church stands to the NORTH.',
                    items: ['silver bullet', 'bread'],
                    enemies: [],
                    npcs: [
                        {name: 'villager', dialogue: 'We bar our doors at night. You should too.', givesItem: null, givesInfo: 'The blacksmith has silver weapons.'},
                        {name: 'blacksmith', dialogue: 'I forge silver for protection. Business is good these nights.', givesItem: 'silver amulet', givesInfo: 'Silver harms all creatures of the night.'}
                    ],
                    exits: {west: 'forestPath', north: 'church', east: 'market', south: 'inn'}
                },
                church: {
                    name: 'Church',
                    description: 'A small, abandoned church. An altar stands at the front with a large cross. The village is to the SOUTH.',
                    items: ['holy symbol', 'blessed water'],
                    enemies: [],
                    npcs: [{name: 'priest', dialogue: 'God be with you, hunter. This evil must be purged from our land.', givesItem: 'blessed stake', givesInfo: 'The crypt below holds ancient relics.'}],
                    exits: {south: 'village', down: 'crypt'}
                },
                well: {
                    name: 'Bottom of Well',
                    description: 'You are at the bottom of a deep, dark well. Water drips from the walls. Something glints in the mud.',
                    items: ['old coin', 'emerald', 'skeleton key'],
                    enemies: ['giant rat'],
                    npcs: [],
                    exits: {up: 'courtyard'}
                },
                crypt: {
                    name: 'Crypt',
                    description: 'An ancient burial chamber beneath the church. Stone coffins line the walls. The air is cold and still.',
                    items: ['ancient armor', 'gold coin'],
                    enemies: ['zombie', 'ghost'],
                    npcs: [{name: 'ancient spirit', dialogue: 'I guarded the holy relics for centuries. Take them and use them well.', givesItem: 'holy relic', givesInfo: 'The red coffin contains a powerful weapon.'}],
                    exits: {up: 'church', east: 'catacombs'}
                },
                gypsyCamp: {
                    name: 'Gypsy Camp',
                    description: 'A colorful camp with caravans and campfires. The gypsies eye you warily.',
                    items: ['healing herbs', 'fortune card'],
                    enemies: [],
                    npcs: [
                        {name: 'gypsy woman', dialogue: 'The cards speak of great danger... and great courage.', givesItem: 'protective charm', givesInfo: 'The full moon empowers werewolves.'},
                        {name: 'gypsy elder', dialogue: 'Dracula was once a man. Now he is a curse upon this land.', givesItem: null, givesInfo: 'His weakness is in his past.'}
                    ],
                    exits: {south: 'forestPath', west: 'secretCave'}
                },
                market: {
                    name: 'Village Market',
                    description: 'A small market square with few stalls open. People hurry about their business.',
                    items: ['garlic necklace', 'silver mirror'],
                    enemies: [],
                    npcs: [
                        {name: 'merchant', dialogue: 'Silverware? Holy symbols? I have what you need... for a price.', givesItem: null, givesInfo: 'Rumor says Dracula keeps his treasure in the east tower.'},
                        {name: 'beggar', dialogue: 'Spare a coin for an old man? I once worked in the castle...', givesItem: null, givesInfo: 'The servants entrance is hidden behind the stables.'}
                    ],
                    exits: {west: 'village', north: 'blacksmith'}
                },
                inn: {
                    name: 'Black Raven Inn',
                    description: 'A warm inn with a crackling fireplace. Patrons whisper in hushed tones.',
                    items: ['ale', 'roasted chicken'],
                    enemies: [],
                    npcs: [
                        {name: 'innkeeper', dialogue: 'A room for the night? You look like you need it.', givesItem: 'room key', givesInfo: 'Strange travelers pass through here, heading to the castle.'},
                        {name: 'hunter', dialogue: 'You hunt the count too? May your aim be true and your stake sharp.', givesItem: 'hunting knife', givesInfo: 'I lost my partner in the catacombs.'}
                    ],
                    exits: {north: 'village', up: 'guestRoom'}
                }
            },
            weapons: {
                'wooden stake': {damage: 15, type: 'piercing', vsVampire: 30},
                'silver dagger': {damage: 10, type: 'slashing', vsWerewolf: 20},
                'enchanted sword': {damage: 20, type: 'slashing', vsUndead: 25},
                'hunting knife': {damage: 8, type: 'slashing'},
                'silver bullet': {damage: 12, type: 'ranged', vsWerewolf: 25},
                'blessed stake': {damage: 18, type: 'piercing', vsVampire: 35, vsUndead: 20}
            },
            armor: {
                'leather armor': {defense: 5, type: 'light'},
                'ancient armor': {defense: 10, type: 'heavy'},
                'silver amulet': {defense: 3, type: 'accessory', vsVampire: 5},
                'protective charm': {defense: 2, type: 'accessory'}
            },
            enemyStats: {
                'bat swarm': {health: 20, damage: 5, weakness: 'fire'},
                'wolf': {health: 30, damage: 8, weakness: 'silver'},
                'werewolf': {health: 50, damage: 15, weakness: 'silver'},
                'shadow figure': {health: 25, damage: 7, weakness: 'light'},
                'dracula': {health: 100, damage: 25, weakness: 'wooden stake', special: 'life drain'},
                'giant rat': {health: 15, damage: 4, weakness: null},
                'zombie': {health: 40, damage: 10, weakness: 'headshot'},
                'ghost': {health: 30, damage: 8, weakness: 'holy'},
                'skeleton': {health: 25, damage: 6, weakness: 'blunt'},
                'ghoul': {health: 35, damage: 12, weakness: 'fire'}
            },
            gameOver: false,
            gameWon: false,
            commandsHistory: []
        };

        // DOM elements
        const outputElement = document.getElementById('output');
        const commandInput = document.getElementById('command');
        const locationElement = document.getElementById('location');
        const healthElement = document.getElementById('health');
        const weaponElement = document.getElementById('weapon');
        const turnsElement = document.getElementById('turns');
        const killsElement = document.getElementById('kills');
        const coinsElement = document.getElementById('coins');
        const armorElement = document.getElementById('armor');
        const xpElement = document.getElementById('xp');
        
        // Initialize game
        function initGame() {
            clearOutput();
            addOutput("DRACULA 1986 - ENHANCED EDITION", 'location');
            addOutput("Based on the CRL Group classic");
            addOutput("");
            addOutput("You are a vampire hunter in Transylvania, 1986.");
            addOutput("Your mission: Destroy Count Dracula and his minions!");
            addOutput("");
            addOutput("NEW FEATURES:");
            addOutput("- TALK to NPCs for information and items", 'npc');
            addOutput("- EQUIP weapons and armor for combat", 'success');
            addOutput("- Expanded world with multiple locations", 'location');
            addOutput("- Improved combat with stats and weaknesses", 'combat');
            addOutput("");
            addOutput("Type HELP for commands, LOOK to examine your surroundings.");
            addOutput("");
            updateStatus();
            look();
        }
        
        // Add text to output
        function addOutput(text, className = '') {
            const line = document.createElement('div');
            line.className = `output-line ${className}`;
            line.textContent = text;
            outputElement.appendChild(line);
            outputElement.scrollTop = outputElement.scrollHeight;
        }
        
        // Clear output
        function clearOutput() {
            outputElement.innerHTML = '';
        }
        
        // Update status display
        function updateStatus() {
            const location = gameState.locations[gameState.currentLocation];
            locationElement.textContent = location.name.substring(0, 12);
            healthElement.textContent = `${gameState.health}%`;
            weaponElement.textContent = gameState.equippedWeapon ? 
                gameState.equippedWeapon.substring(0, 8) : 'None';
            turnsElement.textContent = gameState.turns;
            killsElement.textContent = gameState.kills;
            coinsElement.textContent = gameState.coins;
            armorElement.textContent = gameState.equippedArmor ? 
                gameState.equippedArmor.substring(0, 8) : 'None';
            xpElement.textContent = gameState.experience;
        }
        
        // Look at current location
        function look() {
            const location = gameState.locations[gameState.currentLocation];
            addOutput(`You are at: ${location.name}`, 'location');
            addOutput(location.description);
            
            // Show items
            if (location.items.length > 0) {
                addOutput("You see here:", 'item');
                location.items.forEach(item => {
                    addOutput(`  - ${item}`, 'item');
                });
            }
            
            // Show NPCs
            if (location.npcs && location.npcs.length > 0) {
                addOutput("You see:", 'npc');
                location.npcs.forEach(npc => {
                    addOutput(`  - ${npc.name}`, 'npc');
                });
            }
            
            // Show enemies
            if (location.enemies.length > 0) {
                addOutput("You encounter:", 'enemy');
                location.enemies.forEach(enemy => {
                    addOutput(`  - ${enemy}`, 'enemy');
                });
            }
            
            // Show exits
            const exits = Object.keys(location.exits);
            if (exits.length > 0) {
                addOutput("Exits: " + exits.map(exit => exit.toUpperCase()).join(', '));
            }
        }
        
        // Process player command
        function processCommand(command) {
            if (gameState.gameOver || gameState.gameWon) {
                if (command.toLowerCase() === 'restart') {
                    restartGame();
                }
                return;
            }
            
            gameState.turns++;
            
            const cmd = command.toLowerCase().trim();
            const parts = cmd.split(' ');
            const action = parts[0];
            const target = parts.slice(1).join(' ');
            
            // Add to history
            gameState.commandsHistory.push(command);
            
            // Display command
            addOutput(`> ${command}`, 'help');
            
            // Process actions
            switch(action) {
                case 'look':
                case 'l':
                    look();
                    break;
                    
                case 'go':
                case 'move':
                case 'walk':
                    if (target) {
                        go(target);
                    } else {
                        addOutput("Go where? Specify a direction.", 'error');
                    }
                    break;
                    
                case 'north':
                case 'n':
                    go('north');
                    break;
                    
                case 'south':
                case 's':
                    go('south');
                    break;
                    
                case 'east':
                case 'e':
                    go('east');
                    break;
                    
                case 'west':
                case 'w':
                    go('west');
                    break;
                    
                case 'up':
                case 'u':
                    go('up');
                    break;
                    
                case 'down':
                case 'd':
                    go('down');
                    break;
                    
                case 'take':
                case 'get':
                    if (target) {
                        takeItem(target);
                    } else {
                        addOutput("Take what?", 'error');
                    }
                    break;
                    
                case 'drop':
                    if (target) {
                        dropItem(target);
                    } else {
                        addOutput("Drop what?", 'error');
                    }
                    break;
                    
                case 'inventory':
                case 'i':
                    showInventory();
                    break;
                    
                case 'use':
                    if (target) {
                        useItem(target);
                    } else {
                        addOutput("Use what?", 'error');
                    }
                    break;
                    
                case 'equip':
                    if (target) {
                        equipItem(target);
                    } else {
                        addOutput("Equip what? Type EQUIP [item name]", 'error');
                    }
                    break;
                    
                case 'unequip':
                    if (target) {
                        unequipItem(target);
                    } else {
                        addOutput("Unequip what?", 'error');
                    }
                    break;
                    
                case 'attack':
                case 'fight':
                    if (target) {
                        attackEnemy(target);
                    } else {
                        addOutput("Attack what?", 'error');
                    }
                    break;
                    
                case 'talk':
                    if (target) {
                        talkToNPC(target);
                    } else {
                        addOutput("Talk to whom?", 'error');
                    }
                    break;
                    
                case 'help':
                case '?':
                    showHelp();
                    break;
                    
                case 'save':
                    saveGame();
                    break;
                    
                case 'load':
                    loadGame();
                    break;
                    
                case 'restart':
                    restartGame();
                    break;
                    
                case 'examine':
                case 'x':
                    if (target) {
                        examine(target);
                    } else {
                        addOutput("Examine what?", 'error');
                    }
                    break;
                    
                case 'map':
                    showMap();
                    break;
                    
                case 'flee':
                case 'run':
                    fleeCombat();
                    break;
                    
                case 'status':
                case 'stats':
                    showStats();
                    break;
                    
                case 'buy':
                    if (target) {
                        buyItem(target);
                    } else {
                        addOutput("Buy what?", 'error');
                    }
                    break;
                    
                default:
                    addOutput("I don't understand that command. Type HELP for available commands.", 'error');
            }
            
            updateStatus();
            
            // Random events
            if (gameState.turns % 5 === 0) {
                randomEvent();
            }
        }
        
        // Move to a new location
        function go(direction) {
            const location = gameState.locations[gameState.currentLocation];
            const exit = location.exits[direction.toLowerCase()];
            
            if (exit) {
                // Check for enemies blocking the way
                if (location.enemies.length > 0) {
                    addOutput(`The ${location.enemies[0]} blocks your path!`, 'enemy');
                    addOutput("You must DEFEAT or FLEE from enemies!", 'combat');
                    return;
                }
                
                gameState.currentLocation = exit;
                addOutput(`You go ${direction.toUpperCase()}`, 'success');
                look();
                
                // Random health drain at night
                if (gameState.time === 'night' && Math.random() > 0.7) {
                    const drain = Math.floor(Math.random() * 5) + 1;
                    gameState.health -= drain;
                    addOutput(`The cold night drains your strength! (-${drain} health)`, 'error');
                    checkHealth();
                }
                
                // Random enemy encounter
                if (Math.random() > 0.7) {
                    const enemies = ['wolf', 'bat swarm', 'ghoul', 'zombie'];
                    const randomEnemy = enemies[Math.floor(Math.random() * enemies.length)];
                    const location = gameState.locations[gameState.currentLocation];
                    location.enemies.push(randomEnemy);
                    addOutput(`A ${randomEnemy} appears!`, 'enemy');
                }
            } else {
                addOutput(`You can't go ${direction.toUpperCase()} from here.`, 'error');
            }
        }
        
        // Take an item
        function takeItem(itemName) {
            const location = gameState.locations[gameState.currentLocation];
            const itemIndex = location.items.findIndex(item => 
                item.toLowerCase().includes(itemName.toLowerCase())
            );
            
            if (itemIndex !== -1) {
                const item = location.items[itemIndex];
                gameState.inventory.push(item);
                location.items.splice(itemIndex, 1);
                addOutput(`You take the ${item}.`, 'success');
                
                // Special item effects
                if (item.includes('coin')) {
                    gameState.coins++;
                    addOutput(`You now have ${gameState.coins} coins.`, 'success');
                }
                
                if (item === 'health potion') {
                    addOutput("This could restore your health when USED.", 'help');
                }
                
                if (item === 'map of castle') {
                    addOutput("The map reveals secret passages!", 'success');
                }
            } else {
                addOutput(`There is no ${itemName} here.`, 'error');
            }
        }
        
        // Drop an item
        function dropItem(itemName) {
            const itemIndex = gameState.inventory.findIndex(item => 
                item.toLowerCase().includes(itemName.toLowerCase())
            );
            
            if (itemIndex !== -1) {
                const item = gameState.inventory[itemIndex];
                
                // Unequip if dropping equipped item
                if (gameState.equippedWeapon === item) {
                    gameState.equippedWeapon = null;
                    addOutput(`You unequip and drop the ${item}.`, 'success');
                }
                
                if (gameState.equippedArmor === item) {
                    gameState.equippedArmor = null;
                    addOutput(`You unequip and drop the ${item}.`, 'success');
                }
                
                const location = gameState.locations[gameState.currentLocation];
                location.items.push(item);
                gameState.inventory.splice(itemIndex, 1);
                addOutput(`You drop the ${item}.`, 'success');
            } else {
                addOutput(`You don't have ${itemName}.`, 'error');
            }
        }
        
        // Show inventory
        function showInventory() {
            if (gameState.inventory.length === 0) {
                addOutput("You are carrying nothing.", 'help');
            } else {
                addOutput("You are carrying:", 'inventory-title');
                gameState.inventory.forEach(item => {
                    let itemText = `  - ${item}`;
                    if (item === gameState.equippedWeapon) itemText += " (EQUIPPED)";
                    if (item === gameState.equippedArmor) itemText += " (EQUIPPED)";
                    addOutput(itemText, 'inventory-item');
                });
            }
            
            addOutput(`Coins: ${gameState.coins}`, 'item');
        }
        
        // Equip an item
        function equipItem(itemName) {
            // Check if item is in inventory
            const itemIndex = gameState.inventory.findIndex(item => 
                item.toLowerCase().includes(itemName.toLowerCase())
            );
            
            if (itemIndex === -1) {
                addOutput(`You don't have ${itemName}.`, 'error');
                return;
            }
            
            const item = gameState.inventory[itemIndex];
            
            // Check if it's a weapon
            if (gameState.weapons[item]) {
                if (gameState.equippedWeapon) {
                    addOutput(`You unequip ${gameState.equippedWeapon} and equip ${item}.`, 'success');
                } else {
                    addOutput(`You equip the ${item}.`, 'success');
                }
                gameState.equippedWeapon = item;
                gameState.playerAttack = 10 + gameState.weapons[item].damage;
            }
            // Check if it's armor
            else if (gameState.armor[item]) {
                if (gameState.equippedArmor) {
                    addOutput(`You unequip ${gameState.equippedArmor} and equip ${item}.`, 'success');
                } else {
                    addOutput(`You equip the ${item}.`, 'success');
                }
                gameState.equippedArmor = item;
                gameState.playerDefense = 5 + gameState.armor[item].defense;
            }
            else {
                addOutput(`You cannot equip ${item}.`, 'error');
            }
            
            updateStatus();
        }
        
        // Unequip an item
        function unequipItem(itemName) {
            if (gameState.equippedWeapon && gameState.equippedWeapon.toLowerCase().includes(itemName.toLowerCase())) {
                addOutput(`You unequip the ${gameState.equippedWeapon}.`, 'success');
                gameState.equippedWeapon = null;
                gameState.playerAttack = 10;
            }
            else if (gameState.equippedArmor && gameState.equippedArmor.toLowerCase().includes(itemName.toLowerCase())) {
                addOutput(`You unequip the ${gameState.equippedArmor}.`, 'success');
                gameState.equippedArmor = null;
                gameState.playerDefense = 5;
            }
            else {
                addOutput(`You don't have ${itemName} equipped.`, 'error');
            }
            
            updateStatus();
        }
        
        // Use an item
        function useItem(itemName) {
            const itemIndex = gameState.inventory.findIndex(item => 
                item.toLowerCase().includes(itemName.toLowerCase())
            );
            
            if (itemIndex === -1) {
                addOutput(`You don't have ${itemName}.`, 'error');
                return;
            }
            
            const item = gameState.inventory[itemIndex];
            const location = gameState.locations[gameState.currentLocation];
            
            // Special item uses
            if (item === 'health potion') {
                const heal = 30;
                gameState.health = Math.min(gameState.maxHealth, gameState.health + heal);
                gameState.inventory.splice(itemIndex, 1);
                addOutput(`You drink the health potion and restore ${heal} health!`, 'success');
                return;
            }
            
            if (item === 'torch' && location.enemies.includes('shadow figure')) {
                addOutput("You brandish the torch!", 'success');
                addOutput("The shadow figure recoils from the light!", 'success');
                location.enemies = location.enemies.filter(e => e !== 'shadow figure');
                addOutput("The shadow figure dissipates!", 'success');
                gameState.experience += 25;
                return;
            }
            
            if (item === 'garlic clove' && location.enemies.some(e => e.includes('vampire'))) {
                addOutput("You brandish the garlic clove!", 'success');
                addOutput("The vampires are repelled by the smell!", 'success');
                return;
            }
            
            if (item === 'holy water') {
                if (location.enemies.length > 0) {
                    addOutput("You sprinkle holy water on the enemies!", 'success');
                    location.enemies.forEach(enemy => {
                        if (gameState.enemyStats[enemy] && gameState.enemyStats[enemy].weakness === 'holy') {
                            addOutput(`The ${enemy} is destroyed by the holy water!`, 'success');
                            gameState.experience += 20;
                            gameState.kills++;
                        }
                    });
                    location.enemies = location.enemies.filter(enemy => 
                        !gameState.enemyStats[enemy] || gameState.enemyStats[enemy].weakness !== 'holy'
                    );
                    gameState.inventory.splice(itemIndex, 1);
                } else {
                    addOutput("You use the holy water, but there are no enemies here.", 'help');
                }
                return;
            }
            
            // Default use message
            addOutput(`You use the ${item}, but nothing happens.`, 'help');
        }
        
        // Talk to an NPC
        function talkToNPC(npcName) {
            const location = gameState.locations[gameState.currentLocation];
            
            if (!location.npcs || location.npcs.length === 0) {
                addOutput("There's no one here to talk to.", 'error');
                return;
            }
            
            // Find NPC
            const npc = location.npcs.find(n => 
                n.name.toLowerCase().includes(npcName.toLowerCase())
            );
            
            if (!npc) {
                addOutput(`You don't see ${npcName} here.`, 'error');
                return;
            }
            
            // Display dialogue
            addOutput(`${npc.name.toUpperCase()}:`, 'npc');
            addOutput(`"${npc.dialogue}"`, 'dialogue');
            
            // Give item if not already given
            if (npc.givesItem && !gameState.npcDialogue[`${location.name}_${npc.name}`]) {
                addOutput(`${npc.name} gives you: ${npc.givesItem}`, 'success');
                gameState.inventory.push(npc.givesItem);
                gameState.npcDialogue[`${location.name}_${npc.name}`] = true;
            }
            
            // Give information
            if (npc.givesInfo) {
                addOutput(`${npc.name} tells you: ${npc.givesInfo}`, 'help');
            }
            
            // Special NPC interactions
            if (npc.name === 'merchant') {
                addOutput("MERCHANT: I sell: health potion (5 coins), silver dagger (15 coins)", 'npc');
                addOutput("Say BUY [item] to purchase.", 'help');
            }
            
            if (npc.name === 'blacksmith') {
                addOutput("BLACKSMITH: I can forge silver weapons if you bring me silver coins.", 'npc');
            }
        }
        
        // Attack an enemy
        function attackEnemy(enemyName) {
            const location = gameState.locations[gameState.currentLocation];
            const enemyIndex = location.enemies.findIndex(enemy => 
                enemy.toLowerCase().includes(enemyName.toLowerCase())
            );
            
            if (enemyIndex === -1) {
                addOutput(`There is no ${enemyName} here.`, 'error');
                return;
            }
            
            const enemy = location.enemies[enemyIndex];
            const enemyStat = gameState.enemyStats[enemy] || {health: 30, damage: 10, weakness: null};
            
            addOutput(`You attack the ${enemy}!`, 'combat');
            
            // Calculate damage
            let damage = gameState.playerAttack;
            const weapon = gameState.weapons[gameState.equippedWeapon];
            
            // Check for weapon advantages
            if (weapon) {
                if (enemy === 'dracula' && weapon.vsVampire) {
                    damage += weapon.vsVampire;
                    addOutput("Your weapon is especially effective against vampires!", 'success');
                }
                if (enemy === 'werewolf' && weapon.vsWerewolf) {
                    damage += weapon.vsWerewolf;
                    addOutput("Silver hurts werewolves!", 'success');
                }
            }
            
            // Apply damage
            const finalDamage = Math.max(5, Math.floor(damage * (0.8 + Math.random() * 0.4)));
            addOutput(`You hit the ${enemy} for ${finalDamage} damage!`, 'combat');
            
            // Enemy counterattack
            const enemyDamage = Math.max(1, Math.floor(enemyStat.damage * (0.7 + Math.random() * 0.6) - gameState.playerDefense));
            
            if (enemyDamage > 0) {
                gameState.health -= enemyDamage;
                addOutput(`The ${enemy} strikes back for ${enemyDamage} damage!`, 'enemy');
                checkHealth();
            } else {
                addOutput(`Your armor absorbs the ${enemy}'s attack!`, 'success');
            }
            
            // Check if enemy is defeated
            if (finalDamage >= (enemyStat.health || 30)) {
                addOutput(`You have defeated the ${enemy}!`, 'success');
                location.enemies.splice(enemyIndex, 1);
                gameState.kills++;
                gameState.experience += enemy === 'dracula' ? 100 : 20;
                
                // Loot drop
                if (Math.random() > 0.5) {
                    const loots = {
                        'dracula': ['dracula\'s ring', 'ancient key', 'vampire dust'],
                        'werewolf': ['werewolf fang', 'silver fur', 'claw'],
                        'zombie': ['rotten flesh', 'tattered cloth', 'rusty nail'],
                        'ghost': ['ectoplasm', 'haunted shroud']
                    };
                    
                    const lootList = loots[enemy] || ['coins', 'health potion'];
                    const loot = lootList[Math.floor(Math.random() * lootList.length)];
                    
                    if (loot === 'coins') {
                        const coinAmount = Math.floor(Math.random() * 10) + 5;
                        gameState.coins += coinAmount;
                        addOutput(`The ${enemy} drops ${coinAmount} coins!`, 'item');
                    } else {
                        location.items.push(loot);
                        addOutput(`The ${enemy} drops: ${loot}`, 'item');
                    }
                }
                
                // Check for victory
                if (enemy === 'dracula') {
                    gameState.gameWon = true;
                    addOutput("");
                    addOutput("*** CONGRATULATIONS! YOU HAVE DEFEATED DRACULA! ***", 'success');
                    addOutput("Transylvania is safe once again.", 'success');
                    addOutput("");
                    addOutput("Final Stats:", 'location');
                    addOutput(`Turns: ${gameState.turns}`, 'help');
                    addOutput(`Kills: ${gameState.kills}`, 'help');
                    addOutput(`Coins: ${gameState.coins}`, 'help');
                    addOutput(`Experience: ${gameState.experience}`, 'help');
                    addOutput("");
                    addOutput("Type RESTART to play again.");
                }
            } else {
                addOutput(`The ${enemy} looks wounded but still stands.`, 'enemy');
            }
        }
        
        // Flee from combat
        function fleeCombat() {
            const location = gameState.locations[gameState.currentLocation];
            
            if (location.enemies.length === 0) {
                addOutput("There's nothing to flee from!", 'error');
                return;
            }
            
            if (Math.random() > 0.4) {
                addOutput("You successfully flee from combat!", 'success');
                // Move player to a random adjacent location
                const exits = Object.keys(location.exits);
                if (exits.length > 0) {
                    const randomExit = exits[Math.floor(Math.random() * exits.length)];
                    gameState.currentLocation = location.exits[randomExit];
                    addOutput(`You flee ${randomExit.toUpperCase()} to ${gameState.locations[gameState.currentLocation].name}`, 'success');
                    look();
                }
            } else {
                addOutput("You fail to flee!", 'error');
                // Take damage when failing to flee
                const enemy = location.enemies[0];
                const enemyStat = gameState.enemyStats[enemy] || {damage: 10};
                const damage = Math.floor(enemyStat.damage * 0.5);
                gameState.health -= damage;
                addOutput(`The ${enemy} attacks you as you retreat! (-${damage} health)`, 'enemy');
                checkHealth();
            }
        }
        
        // Show help
        function showHelp() {
            addOutput("=== DRACULA 1986 - ENHANCED HELP ===", 'help');
            addOutput("MOVEMENT: GO NORTH/SOUTH/EAST/WEST/UP/DOWN", 'help');
            addOutput("         (or just type N, S, E, W, U, D)", 'help');
            addOutput("ACTIONS: LOOK, TAKE <item>, DROP <item>, USE <item>", 'help');
            addOutput("         EQUIP <weapon/armor>, UNEQUIP <item>", 'help');
            addOutput("         ATTACK <enemy>, FLEE, TALK <npc>", 'help');
            addOutput("         EXAMINE <object>, BUY <item> (from merchants)", 'help');
            addOutput("INFO:    INVENTORY, STATUS, MAP, HELP", 'help');
            addOutput("SYSTEM:  SAVE, LOAD, RESTART", 'help');
            addOutput("");
            addOutput("COMBAT: Equip weapons before fighting.", 'combat');
            addOutput("        Silver weapons work best against werewolves.", 'combat');
            addOutput("        Wooden stakes are deadly to vampires.", 'combat');
            addOutput("        Use FLEE to escape dangerous fights.", 'combat');
            addOutput("");
            addOutput("NPCs: Talk to NPCs for information, items, and quests.", 'npc');
            addOutput("");
            addOutput("GOAL: Find Dracula and destroy him with a wooden stake!", 'help');
        }
        
        // Show player stats
        function showStats() {
            addOutput("=== YOUR STATS ===", 'location');
            addOutput(`Health: ${gameState.health}/${gameState.maxHealth}`, 'help');
            addOutput(`Attack: ${gameState.playerAttack}`, 'help');
            addOutput(`Defense: ${gameState.playerDefense}`, 'help');
            addOutput(`Level: ${gameState.level}`, 'help');
            addOutput(`Experience: ${gameState.experience}`, 'help');
            addOutput(`Kills: ${gameState.kills}`, 'help');
            addOutput(`Coins: ${gameState.coins}`, 'help');
            addOutput(`Turns: ${gameState.turns}`, 'help');
            
            if (gameState.equippedWeapon) {
                addOutput(`Weapon: ${gameState.equippedWeapon}`, 'equipped');
                const weapon = gameState.weapons[gameState.equippedWeapon];
                if (weapon) {
                    addOutput(`  Damage: ${weapon.damage}`, 'help');
                    if (weapon.vsVampire) addOutput(`  vs Vampires: +${weapon.vsVampire}`, 'help');
                    if (weapon.vsWerewolf) addOutput(`  vs Werewolves: +${weapon.vsWerewolf}`, 'help');
                }
            }
            
            if (gameState.equippedArmor) {
                addOutput(`Armor: ${gameState.equippedArmor}`, 'equipped');
                const armor = gameState.armor[gameState.equippedArmor];
                if (armor) {
                    addOutput(`  Defense: ${armor.defense}`, 'help');
                }
            }
        }
        
        // Examine something
        function examine(target) {
            const location = gameState.locations[gameState.currentLocation];
            
            // Check if target is in location items
            const item = location.items.find(item => 
                item.toLowerCase().includes(target.toLowerCase())
            );
            
            if (item) {
                addOutput(`You examine the ${item}:`, 'help');
                
                // Item-specific descriptions
                const descriptions = {
                    'rusty key': 'An old rusty key. Might open something.',
                    'wooden stake': 'A sharp wooden stake. Perfect for vampire hunting.',
                    'silver cross': 'A silver crucifix. Offers protection against evil.',
                    'garlic clove': 'A clove of garlic. Vampires hate the smell.',
                    'vampire tome': 'An ancient book about vampires and their weaknesses.',
                    'holy water': 'A small vial of blessed water.',
                    'silver bullet': 'A single silver bullet. Effective against werewolves.',
                    'holy symbol': 'A sacred symbol. It glows with divine energy.',
                    'old coin': 'An old Transylvanian coin. Worthless but interesting.',
                    'enchanted sword': 'A sword that glows with magical energy. Very effective against undead.',
                    'health potion': 'A red potion that restores health when consumed.',
                    'map of castle': 'Shows the layout of Castle Dracula with secret passages marked.',
                    'silver dagger': 'A dagger made of pure silver. Harmful to werewolves.',
                    'leather armor': 'Light armor made of hardened leather. Provides basic protection.',
                    'ancient armor': 'Heavy armor from a bygone era. Excellent protection but cumbersome.',
                    'blessed stake': 'A wooden stake blessed by a priest. Extra effective against vampires.',
                    'holy relic': 'An ancient religious artifact. Radiates holy power.'
                };
                
                addOutput(descriptions[item] || 'You see nothing special about it.', 'help');
                return;
            }
            
            // Check if target is in inventory
            const invItem = gameState.inventory.find(item => 
                item.toLowerCase().includes(target.toLowerCase())
            );
            
            if (invItem) {
                examine(invItem); // Reuse the same function
                return;
            }
            
            // Check if target is an enemy
            const enemy = location.enemies.find(enemy => 
                enemy.toLowerCase().includes(target.toLowerCase())
            );
            
            if (enemy) {
                addOutput(`You examine the ${enemy}:`, 'help');
                
                const descriptions = {
                    'bat swarm': 'A swarm of vampire bats. They look hungry.',
                    'shadow figure': 'A shadowy figure. It seems to be watching you.',
                    'dracula': 'Count Dracula himself! He looks powerful and dangerous.',
                    'wolf': 'A large, menacing wolf. Its eyes glow red.',
                    'werewolf': 'A terrifying hybrid of man and wolf. Silver harms them.',
                    'zombie': 'A reanimated corpse. Slow but strong.',
                    'ghost': 'A spectral entity. Holy weapons work best.',
                    'skeleton': 'An animated skeleton. Vulnerable to blunt weapons.',
                    'ghoul': 'A flesh-eating undead. Fears fire.',
                    'giant rat': 'A rodent of unusual size. Probably diseased.'
                };
                
                const enemyStat = gameState.enemyStats[enemy];
                if (enemyStat) {
                    addOutput(descriptions[enemy] || 'A dangerous creature. Better be careful.', 'help');
                    if (enemyStat.weakness) {
                        addOutput(`Weakness: ${enemyStat.weakness}`, 'help');
                    }
                } else {
                    addOutput('A dangerous creature. Better be careful.', 'help');
                }
                return;
            }
            
            // Check if target is an NPC
            if (location.npcs) {
                const npc = location.npcs.find(n => 
                    n.name.toLowerCase().includes(target.toLowerCase())
                );
                
                if (npc) {
                    addOutput(`You examine ${npc.name}:`, 'npc');
                    addOutput(`${npc.name} looks like they might have information. Try TALKING to them.`, 'help');
                    return;
                }
            }
            
            addOutput(`You don't see any ${target} here.`, 'error');
        }
        
        // Show map
        function showMap() {
            addOutput("=== TRANSYLVANIA MAP ===", 'help');
            addOutput("           [Church]---[Crypt]", 'help');
            addOutput("              |", 'help');
            addOutput("[Blacksmith]--[Market]--[Village]--[Forest]--[Gypsy Camp]", 'help');
            addOutput("              |          |", 'help');
            addOutput("           [Inn]     [Castle Gates]--[Courtyard]--[Stables]", 'help');
            addOutput("                          |             |", 'help');
            addOutput("                       [Road]     [Great Hall]--[Dining Hall]", 'help');
            addOutput("                                   |         |", 'help');
            addOutput("                                 [Well] [Upper Hall]--[Library]", 'help');
            addOutput("                                             |    |", 'help');
            addOutput("                                        [Balcony] [Bedchamber]", 'help');
            addOutput("");
            addOutput("You are currently at: " + gameState.locations[gameState.currentLocation].name, 'location');
        }
        
        // Buy from merchant
        function buyItem(itemName) {
            const location = gameState.locations[gameState.currentLocation];
            const merchant = location.npcs?.find(n => n.name === 'merchant');
            
            if (!merchant) {
                addOutput("There's no merchant here to buy from.", 'error');
                return;
            }
            
            const prices = {
                'health potion': 5,
                'silver dagger': 15,
                'torch': 2,
                'garlic clove': 1
            };
            
            const item = Object.keys(prices).find(i => i.includes(itemName.toLowerCase()));
            
            if (!item) {
                addOutput(`The merchant doesn't sell ${itemName}.`, 'error');
                return;
            }
            
            if (gameState.coins < prices[item]) {
                addOutput(`You need ${prices[item]} coins to buy ${item}. You have ${gameState.coins}.`, 'error');
                return;
            }
            
            gameState.coins -= prices[item];
            gameState.inventory.push(item);
            addOutput(`You buy ${item} for ${prices[item]} coins.`, 'success');
            addOutput(`You now have ${gameState.coins} coins remaining.`, 'help');
        }
        
        // Random events
        function randomEvent() {
            if (Math.random() > 0.7) {
                const events = [
                    "You hear a distant howl...",
                    "The moon emerges from behind the clouds.",
                    "A cold wind chills you to the bone.",
                    "Something scuttles in the darkness.",
                    "The shadows seem to move on their own."
                ];
                addOutput(events[Math.floor(Math.random() * events.length)], 'help');
            }
            
            // Time change
            if (gameState.turns % 15 === 0) {
                gameState.time = gameState.time === 'night' ? 'day' : 'night';
                addOutput(`Dawn breaks... It is now ${gameState.time}.`, 'help');
                
                // Vampires are weaker during day
                if (gameState.time === 'day') {
                    addOutput("Vampires are less powerful during daylight hours.", 'help');
                }
            }
            
            // Level up
            if (gameState.experience >= gameState.level * 100) {
                gameState.level++;
                gameState.maxHealth += 10;
                gameState.health = gameState.maxHealth;
                gameState.playerAttack += 2;
                gameState.playerDefense += 1;
                addOutput(`*** LEVEL UP! You are now level ${gameState.level}! ***`, 'success');
                addOutput("Your health, attack, and defense have increased!", 'success');
            }
        }
        
        // Check health
        function checkHealth() {
            if (gameState.health <= 0) {
                gameState.health = 0;
                gameState.gameOver = true;
                addOutput("");
                addOutput("*** GAME OVER ***", 'error');
                addOutput("You have been defeated by the creatures of the night.", 'error');
                addOutput("");
                addOutput("Final Stats:", 'location');
                addOutput(`Turns: ${gameState.turns}`, 'help');
                addOutput(`Kills: ${gameState.kills}`, 'help');
                addOutput(`Coins: ${gameState.coins}`, 'help');
                addOutput(`Experience: ${gameState.experience}`, 'help');
                addOutput("");
                addOutput("Type RESTART to try again.");
            }
        }
        
        // Save game
        function saveGame() {
            const saveData = {
                currentLocation: gameState.currentLocation,
                health: gameState.health,
                maxHealth: gameState.maxHealth,
                inventory: [...gameState.inventory],
                equippedWeapon: gameState.equippedWeapon,
                equippedArmor: gameState.equippedArmor,
                kills: gameState.kills,
                coins: gameState.coins,
                experience: gameState.experience,
                level: gameState.level,
                turns: gameState.turns,
                playerAttack: gameState.playerAttack,
                playerDefense: gameState.playerDefense,
                npcDialogue: {...gameState.npcDialogue}
            };
            
            localStorage.setItem('dracula1986_enhanced_save', JSON.stringify(saveData));
            addOutput("Game saved successfully!", 'success');
        }
        
        // Load game
        function loadGame() {
            const saveData = localStorage.getItem('dracula1986_enhanced_save');
            if (saveData) {
                const loaded = JSON.parse(saveData);
                
                // Restore game state
                Object.assign(gameState, loaded);
                
                addOutput("Game loaded successfully!", 'success');
                look();
                showStats();
            } else {
                addOutput("No saved game found.", 'error');
            }
        }
        
        // Restart game
        function restartGame() {
            // Reset game state
            gameState.currentLocation = 'castleGates';
            gameState.health = 100;
            gameState.maxHealth = 100;
            gameState.time = 'night';
            gameState.inventory = [];
            gameState.equippedWeapon = null;
            gameState.equippedArmor = null;
            gameState.kills = 0;
            gameState.coins = 0;
            gameState.experience = 0;
            gameState.level = 1;
            gameState.turns = 0;
            gameState.playerAttack = 10;
            gameState.playerDefense = 5;
            gameState.npcDialogue = {};
            gameState.gameOver = false;
            gameState.gameWon = false;
            
            // Reset all locations (in a real implementation, you'd want to reset to initial state)
            initGame();
        }
        
        // Set up event listeners
        document.addEventListener('DOMContentLoaded', () => {
            initGame();
            
            // Handle command input
            commandInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const command = commandInput.value.trim();
                    if (command) {
                        processCommand(command);
                        commandInput.value = '';
                    }
                }
            });
            
            // Handle quick command buttons
            document.querySelectorAll('.quick-cmd').forEach(button => {
                button.addEventListener('click', () => {
                    const cmd = button.getAttribute('data-cmd');
                    commandInput.value = cmd + ' ';
                    commandInput.focus();
                });
            });
            
            // Handle button clicks
            document.getElementById('help-btn').addEventListener('click', () => {
                processCommand('help');
            });
            
            document.getElementById('talk-btn').addEventListener('click', () => {
                processCommand('talk');
            });
            
            document.getElementById('equip-btn').addEventListener('click', () => {
                processCommand('equip');
            });
            
            document.getElementById('save-btn').addEventListener('click', () => {
                processCommand('save');
            });
            
            document.getElementById('load-btn').addEventListener('click', () => {
                processCommand('load');
            });
            
            document.getElementById('restart-btn').addEventListener('click', () => {
                processCommand('restart');
            });
            
            // Auto-focus input
            commandInput.focus();
            
            // Handle window resize
            window.addEventListener('resize', () => {
                // Scroll to bottom on resize
                outputElement.scrollTop = outputElement.scrollHeight;
            });
        });
    </script>
</body>
</html>
