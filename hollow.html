<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hollowlands</title>
<style>
body {
background-color: #000;
color: #fff;
font-family: 'Courier New', monospace;
margin: 0;
padding: 10px;
overflow-x: hidden;
text-shadow: 0 0 5px rgba(255,255,255,0.3);
}

#game-container {
max-width: 100%;
margin: 0 auto;
}

#game-title {
color: #ff0000;
text-align: center;
font-size: 28px;
margin-bottom: 15px;
text-shadow: 0 0 15px #f00, 0 0 25px #f00;
border-bottom: 1px solid #ff0000;
padding-bottom: 10px;
font-weight: bold;
letter-spacing: 2px;
text-transform: uppercase;
}

#game-screen {
border: 1px solid #333;
padding: 10px;
min-height: 150px;
margin-bottom: 10px;
overflow-y: auto;
max-height: 200px;
background-color: #000;
font-size: 20px;
}

#player-stats {
border: 1px solid #333;
padding: 10px;
margin-bottom: 10px;
background-color: #000;
font-size: 20px;
}

.button-row {
display: flex;
flex-wrap: wrap;
margin-bottom: 5px;
}

.game-button {
background-color: #000;
color: #fff;
border: 1px solid #fff;
padding: 8px;
margin: 2px;
flex-grow: 1;
min-width: 70px;
cursor: pointer;
font-family: 'Courier New', monospace;
font-size: 20px;
}

.game-button:hover {
border-color: #f00;
color: #f00;
}

.selected {
color: #f00;
border-color: #f00;
}

.important {
color: #ff0;
}

.enemy {
color: #f55;
font-size: 20px;
}

.item {
color: #5f5;
}

.gold {
color: #ff0;
}

.health {
color: #f55;
}

.mana {
color: #55f;
}

.xp {
color: #5af;
}

.damage {
color: #f55;
}

.heal {
color: #5f5;
}

.critical {
color: #f80;
font-weight: bold;
}

.debuff {
color: #a5a;
}

#inventory-screen, #character-screen, #shop-screen, #combat-screen {
display: none;
}

.item-info {
border: 1px solid #333;
padding: 5px;
margin-top: 5px;
background-color: #000;
}

.class-warrior {
color: #f55;
}

.class-mage {
color: #55f;
}

.class-rogue {
color: #5f5;
}

/* CRT effect */
body::after {
content: "";
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: linear-gradient(rgba(18, 16, 16, 0.1) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
z-index: 100;
pointer-events: none;
}

/* Scanlines */
body::before {
content: "";
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: linear-gradient(to bottom,
transparent 0%,
rgba(0, 0, 0, 0.2) 50%,
transparent 100%);
background-size: 100% 4px;
z-index: 101;
pointer-events: none;
animation: scanline 8s linear infinite;
}

@keyframes scanline {
0% { background-position: 0 0; }
100% { background-position: 0 100%; }
}
</style>
</head>
<body>
<div id="game-container">
<div id="game-title">HOLLOWLANDS</div>

<!-- Main Game Screen -->
<div id="game-screen"></div>

<!-- Player Stats -->
<div id="player-stats"></div>

<!-- Main Menu Buttons -->
<div id="main-buttons" class="button-row">
<button class="game-button" onclick="showScreen('explore')">EXPLORE</button>
<button class="game-button" onclick="showScreen('character')">CHARACTER</button>
<button class="game-button" onclick="showScreen('inventory')">INVENTORY</button>
<button class="game-button" onclick="showScreen('shop')">SHOP</button>
</div>

<!-- Explore Screen -->
<div id="explore-screen">
<div class="button-row">
<button class="game-button" onclick="exploreArea()">EXPLORE</button>
<button class="game-button" onclick="rest()">REST</button>
<button class="game-button" onclick="changeArea()">MOVE AREA</button>
</div>
</div>

<!-- Character Screen -->
<div id="character-screen">
<div id="character-info"></div>
<div class="button-row">
<button class="game-button" onclick="showScreen('main')">BACK</button>
</div>
</div>

<!-- Inventory Screen -->
<div id="inventory-screen">
<div id="inventory-items"></div>
<div id="item-details"></div>
<div class="button-row">
<button class="game-button" onclick="showScreen('main')">BACK</button>
</div>
</div>

<!-- Shop Screen -->
<div id="shop-screen">
<div id="shop-items"></div>
<div class="button-row">
<button class="game-button" onclick="showScreen('main')">BACK</button>
<button class="game-button" onclick="refreshShop()">REFRESH (50G)</button>
</div>
</div>

<!-- Combat Screen -->
<div id="combat-screen">
<div id="combat-info"></div>
<div id="combat-actions" class="button-row"></div>
</div>

<!-- Class Selection Screen (Initial) -->
<div id="class-select-screen">
<div class="button-row">
<button class="game-button class-warrior" onclick="selectClass('warrior')">WARRIOR</button>
<button class="game-button class-mage" onclick="selectClass('mage')">MAGE</button>
<button class="game-button class-rogue" onclick="selectClass('rogue')">ROGUE</button>
</div>
<div id="class-description"></div>
</div>
</div>

<script>
// Game State
const gameState = {
player: {
name: "Adventurer",
class: null,
level: 1,
xp: 0,
xpToNextLevel: 100,
health: 100,
maxHealth: 100,
mana: 50,
maxMana: 50,
strength: 10,
dexterity: 10,
intelligence: 10,
constitution: 10,
gold: 50,
equippedWeapon: null,
equippedArmor: null,
inventory: [],
skills: [],
currentArea: "Forest",
inCombat: false,
currentEnemy: null,
buffs: [],
debuffs: []
},
areas: [
{ name: "Forest", minLevel: 1, unlocked: true },
{ name: "Caves", minLevel: 3, unlocked: false },
{ name: "Ruins", minLevel: 6, unlocked: false },
{ name: "Dungeon", minLevel: 9, unlocked: false },
{ name: "Abyss", minLevel: 12, unlocked: false }
],
enemies: {
Forest: [
{ name: "Goblin", health: 40, maxHealth: 40, damage: "8-12", xp: 25, gold: 10, level: 1, critChance: 0.05 },
{ name: "Wolf", health: 35, maxHealth: 35, damage: "10-14", xp: 30, gold: 15, level: 1, critChance: 0.1 },
{ name: "Bandit", health: 50, maxHealth: 50, damage: "12-16", xp: 40, gold: 25, level: 2, critChance: 0.1 }
],
Caves: [
{ name: "Cave Spider", health: 70, maxHealth: 70, damage: "15-20", xp: 60, gold: 30, level: 3, poisonChance: 0.3, poisonDamage: 3 },
{ name: "Skeleton", health: 80, maxHealth: 80, damage: "18-22", xp: 70, gold: 40, level: 4, armor: 5 },
{ name: "Troll", health: 120, maxHealth: 120, damage: "20-25", xp: 90, gold: 60, level: 5, regen: 5 }
],
Ruins: [
{ name: "Wraith", health: 100, maxHealth: 100, damage: "25-30", xp: 120, gold: 80, level: 6, magicResist: 15 },
{ name: "Stone Golem", health: 180, maxHealth: 180, damage: "30-35", xp: 150, gold: 100, level: 7, armor: 15 },
{ name: "Necromancer", health: 110, maxHealth: 110, damage: "35-40", xp: 180, gold: 120, level: 8, magicDamage: 20 }
],
Dungeon: [
{ name: "Hellhound", health: 150, maxHealth: 150, damage: "40-45", xp: 220, gold: 150, level: 9, fireDamage: 10 },
{ name: "Dark Knight", health: 250, maxHealth: 250, damage: "45-50", xp: 280, gold: 200, level: 10, armor: 20 },
{ name: "Demon Spawn", health: 300, maxHealth: 300, damage: "50-60", xp: 350, gold: 250, level: 12, lifesteal: 0.2 }
],
Abyss: [
{ name: "Elder Demon", health: 600, maxHealth: 600, damage: "60-70", xp: 600, gold: 500, level: 15, magicResist: 30, armor: 25 },
{ name: "Abyssal Horror", health: 1000, maxHealth: 1000, damage: "70-80", xp: 900, gold: 800, level: 20, regen: 20 },
{ name: "Lord of Darkness", health: 1500, maxHealth: 1500, damage: "80-100", xp: 1500, gold: 1200, level: 25, lifesteal: 0.3 }
]
},
items: {
weapons: [
{ id: 1, name: "Rusty Sword", type: "weapon", damage: "8-12", value: 15, level: 1 },
{ id: 2, name: "Iron Axe", type: "weapon", damage: "12-16", value: 35, level: 2 },
{ id: 3, name: "Steel Longsword", type: "weapon", damage: "16-20", value: 70, level: 3 },
{ id: 4, name: "Enchanted Blade", type: "weapon", damage: "22-28", value: 150, level: 5, critChance: 0.1 },
{ id: 5, name: "Demon Edge", type: "weapon", damage: "35-45", value: 300, level: 8, lifesteal: 0.1 },
{ id: 6, name: "Staff of Fire", type: "weapon", damage: "12-18", magicDamage: 20, value: 80, level: 3 },
{ id: 7, name: "Arcane Scepter", type: "weapon", damage: "8-14", magicDamage: 30, value: 150, level: 5, manaRegen: 5 },
{ id: 8, name: "Dagger", type: "weapon", damage: "6-10", critChance: 0.25, value: 25, level: 1 },
{ id: 9, name: "Assassin's Blade", type: "weapon", damage: "14-18", critChance: 0.35, value: 120, level: 4, poisonDamage: 5 }
],
armor: [
{ id: 10, name: "Leather Armor", type: "armor", defense: 8, value: 30, level: 1 },
{ id: 11, name: "Chainmail", type: "armor", defense: 15, value: 70, level: 2 },
{ id: 12, name: "Plate Armor", type: "armor", defense: 25, value: 150, level: 4, blockChance: 0.1 },
{ id: 13, name: "Mage Robes", type: "armor", defense: 12, magicResist: 20, value: 90, level: 3, manaRegen: 3 },
{ id: 14, name: "Shadow Cloak", type: "armor", defense: 10, dodgeChance: 0.2, value: 120, level: 4 }
],
consumables: [
{ id: 15, name: "Health Potion", type: "consumable", effect: { health: 50 }, value: 30 },
{ id: 16, name: "Mana Potion", type: "consumable", effect: { mana: 40 }, value: 35 },
{ id: 17, name: "Elixir of Strength", type: "consumable", effect: { strength: 5 }, duration: 5, value: 70 },
{ id: 18, name: "Scroll of Fireball", type: "consumable", effect: { damage: 60 }, value: 60 },
{ id: 19, name: "Potion of Vitality", type: "consumable", effect: { maxHealth: 20 }, permanent: true, value: 100 }
]
},
classSkills: {
warrior: [
{ name: "Power Strike", cost: 15, damageMultiplier: 1.8, description: "A powerful strike that deals 1.8x damage" },
{ name: "Taunt", cost: 10, effect: "Taunts the enemy, reducing their damage by 30% for 3 turns", description: "Reduces enemy damage by 30% for 3 turns" },
{ name: "Shield Bash", cost: 20, damage: 15, stunChance: 0.4, description: "Bash with shield, 40% chance to stun" },
{ name: "Battle Cry", cost: 25, effect: "Increases your strength by 5 for 5 turns", description: "+5 Strength for 5 turns" }
],
mage: [
{ name: "Fireball", cost: 20, damage: 35, description: "Hurl a ball of fire at the enemy" },
{ name: "Frost Nova", cost: 25, damage: 25, freezeChance: 0.5, description: "Freeze enemies with 50% chance to stun" },
{ name: "Arcane Missiles", cost: 15, damage: "15-20", missiles: 3, description: "Launch 3 magic missiles" },
{ name: "Mana Shield", cost: 30, effect: "Absorbs 50% damage with mana for 3 turns", description: "50% damage to mana for 3 turns" }
],
rogue: [
{ name: "Backstab", cost: 15, damageMultiplier: 2.5, requiresStealth: true, description: "Deal 2.5x damage from stealth" },
{ name: "Poison Dart", cost: 12, damage: 8, poisonDamage: 5, duration: 4, description: "Poison the enemy over 4 turns" },
{ name: "Shadow Step", cost: 20, effect: "Dodge next 2 attacks", description: "Avoid the next 2 enemy attacks" },
{ name: "Smoke Bomb", cost: 25, effect: "Gain stealth for 3 turns", description: "Enter stealth for 3 turns" }
]
},
shopItems: [],
gameLog: ["Welcome to the Hollowlands! Choose your class to begin..."],
classDescriptions: {
warrior: "The Warrior excels in close combat with high health and strength. Can wear heavy armor and wield powerful weapons. Starts with higher health and strength but lower mana.",
mage: "The Mage harnesses arcane power to cast devastating spells. High intelligence boosts magical damage. Starts with powerful spells but lower health and armor.",
rogue: "The Rogue relies on speed and precision. High dexterity increases critical hit chance and dodge. Starts with high crit chance and evasion but lower defense."
}
};

// Initialize the game
function initGame() {
updateGameScreen();
generateShopItems();
}

// Update the main game screen with the game log
function updateGameScreen() {
const gameScreen = document.getElementById("game-screen");
gameScreen.innerHTML = gameState.gameLog.slice(-10).join("<br>");
gameScreen.scrollTop = gameScreen.scrollHeight;

updatePlayerStats();
}

// Update player stats display
function updatePlayerStats() {
const statsElement = document.getElementById("player-stats");
const player = gameState.player;

let statsHTML = `[${player.name}] <span class="class-${player.class}">${player.class ? player.class.toUpperCase() : ''}</span> Lvl:${player.level} `;
statsHTML += `<span class="health">HP:${player.health}/${player.maxHealth}</span> `;

if (player.class === 'mage' || player.class === 'warrior') {
statsHTML += `<span class="mana">MP:${player.mana}/${player.maxMana}</span> `;
}

statsHTML += `<span class="xp">XP:${player.xp}/${player.xpToNextLevel}</span> `;
statsHTML += `<span class="gold">Gold:${player.gold}</span>`;

if (player.equippedWeapon) {
statsHTML += `<br>Weapon: <span class="item">${player.equippedWeapon.name}</span> (${player.equippedWeapon.damage})`;
}

if (player.equippedArmor) {
statsHTML += ` | Armor: <span class="item">${player.equippedArmor.name}</span> (Def:${player.equippedArmor.defense})`;
}

statsElement.innerHTML = statsHTML;
}

// Show different game screens
function showScreen(screen) {
document.getElementById("explore-screen").style.display = "none";
document.getElementById("character-screen").style.display = "none";
document.getElementById("inventory-screen").style.display = "none";
document.getElementById("shop-screen").style.display = "none";
document.getElementById("combat-screen").style.display = "none";
document.getElementById("main-buttons").style.display = "flex";

if (screen === "explore") {
document.getElementById("explore-screen").style.display = "block";
addToGameLog(`You are exploring the ${gameState.player.currentArea}.`);
} else if (screen === "character") {
document.getElementById("character-screen").style.display = "block";
document.getElementById("main-buttons").style.display = "none";
showCharacterScreen();
} else if (screen === "inventory") {
document.getElementById("inventory-screen").style.display = "block";
document.getElementById("main-buttons").style.display = "none";
showInventory();
} else if (screen === "shop") {
document.getElementById("shop-screen").style.display = "block";
document.getElementById("main-buttons").style.display = "none";
showShop();
} else if (screen === "main") {
// Already handled by hiding others
} else if (screen === "combat") {
document.getElementById("combat-screen").style.display = "block";
document.getElementById("main-buttons").style.display = "none";
updateCombatScreen();
}

updateGameScreen();
}

// Add message to game log
function addToGameLog(message) {
gameState.gameLog.push(message);
if (gameState.gameLog.length > 50) {
gameState.gameLog.shift();
}
updateGameScreen();
}

// Explore area function
function exploreArea() {
const player = gameState.player;

// Chance to find combat, items, or nothing
const roll = Math.random();

if (roll < 0.7) { // 70% chance for combat
startCombat();
} else if (roll < 0.9) { // 20% chance to find item
findItem();
} else { // 10% chance to find nothing
addToGameLog("You explore the area but find nothing of interest.");
}
}

// Change to a different area
function changeArea() {
const player = gameState.player;
const availableAreas = gameState.areas.filter(area => area.unlocked && area.name !== player.currentArea);

if (availableAreas.length === 0) {
addToGameLog("No other areas are available yet. Keep leveling up!");
return;
}

// Randomly select a new area
const newArea = availableAreas[Math.floor(Math.random() * availableAreas.length)];
player.currentArea = newArea.name;
addToGameLog(`You travel to the ${newArea.name}.`);
}

// Start combat with random enemy
function startCombat() {
const player = gameState.player;
const areaEnemies = gameState.enemies[player.currentArea];
const randomEnemy = {...areaEnemies[Math.floor(Math.random() * areaEnemies.length)]};

// Scale enemy stats based on player level
const levelDiff = player.level - randomEnemy.level;
if (levelDiff > 0) {
randomEnemy.health = Math.floor(randomEnemy.health * (1 + levelDiff * 0.1));
randomEnemy.maxHealth = randomEnemy.health;
const damageRange = randomEnemy.damage.split("-").map(Number);
damageRange[0] = Math.floor(damageRange[0] * (1 + levelDiff * 0.1));
damageRange[1] = Math.floor(damageRange[1] * (1 + levelDiff * 0.1));
randomEnemy.damage = damageRange.join("-");
}

gameState.player.inCombat = true;
gameState.player.currentEnemy = randomEnemy;

addToGameLog(`<span class="enemy">A ${randomEnemy.name} (Lvl ${randomEnemy.level}) appears!</span>`);
showScreen("combat");
}

// Update combat screen
function updateCombatScreen() {
const player = gameState.player;
const enemy = gameState.player.currentEnemy;

if (!enemy) return;

let combatHTML = `<span class="enemy">${enemy.name} (Lvl ${enemy.level})</span><br>`;
combatHTML += `<span class="health">HP: ${enemy.health}/${enemy.maxHealth}</span><br><br>`;
combatHTML += `What will you do?`;

document.getElementById("combat-info").innerHTML = combatHTML;

// Create combat actions
const actionsDiv = document.getElementById("combat-actions");
actionsDiv.innerHTML = "";

// Basic attack
const attackBtn = document.createElement("button");
attackBtn.className = "game-button";
attackBtn.textContent = "ATTACK";
attackBtn.onclick = function() { playerAttack(); };
actionsDiv.appendChild(attackBtn);

// Class skills
player.skills.forEach(skill => {
const skillBtn = document.createElement("button");
skillBtn.className = "game-button";
skillBtn.textContent = skill.name.toUpperCase();
skillBtn.onclick = function() { useSkill(skill); };

// Disable if not enough mana
if (player.mana < skill.cost) {
skillBtn.disabled = true;
}

actionsDiv.appendChild(skillBtn);
});

// Flee button
const fleeBtn = document.createElement("button");
fleeBtn.className = "game-button";
fleeBtn.textContent = "FLEE";
fleeBtn.onclick = function() { attemptFlee(); };
actionsDiv.appendChild(fleeBtn);

// Use item button
const itemsBtn = document.createElement("button");
itemsBtn.className = "game-button";
itemsBtn.textContent = "ITEMS";
itemsBtn.onclick = function() { showCombatItems(); };
actionsDiv.appendChild(itemsBtn);
}

// Player attack in combat
function playerAttack() {
const player = gameState.player;
const enemy = gameState.player.currentEnemy;

if (!enemy) return;

let damage = 5; // Base damage

// Calculate damage based on weapon
if (player.equippedWeapon) {
const damageRange = player.equippedWeapon.damage.split("-").map(Number);
damage = Math.floor(Math.random() * (damageRange[1] - damageRange[0] + 1)) + damageRange[0];

// Add strength bonus for physical attacks
if (player.class === 'warrior' || player.class === 'rogue') {
damage += Math.floor(player.strength / 2);
}

// Check for critical hit (rogue has higher chance)
let critChance = 0.1; // Base 10% chance
if (player.equippedWeapon.critChance) {
critChance += player.equippedWeapon.critChance;
}
if (player.class === 'rogue') {
critChance += player.dexterity / 100;
}

if (Math.random() < critChance) {
damage *= 2;
addToGameLog(`<span class="critical">Critical hit!</span> You attack the ${enemy.name} for <span class="damage">${damage}</span> damage!`);
} else {
addToGameLog(`You attack the ${enemy.name} for <span class="damage">${damage}</span> damage!`);
}
} else {
// Bare hands
damage += Math.floor(player.strength / 3);
addToGameLog(`You punch the ${enemy.name} for <span class="damage">${damage}</span> damage!`);
}

// Apply enemy armor reduction
if (enemy.armor) {
damage = Math.max(1, damage - enemy.armor);
}

enemy.health -= damage;

// Check for lifesteal
if (player.equippedWeapon && player.equippedWeapon.lifesteal) {
const healAmount = Math.floor(damage * player.equippedWeapon.lifesteal);
player.health = Math.min(player.maxHealth, player.health + healAmount);
addToGameLog(`You steal <span class="heal">${healAmount}</span> health!`);
}

// Check if enemy is defeated
if (enemy.health <= 0) {
enemy.health = 0;
defeatEnemy();
} else {
// Enemy attacks back
enemyAttack();
}

updateCombatScreen();
}

// Use skill in combat
function useSkill(skill) {
const player = gameState.player;
const enemy = gameState.player.currentEnemy;

if (!enemy) return;

// Deduct mana cost
player.mana -= skill.cost;

// Handle different skills
if (skill.damageMultiplier) {
let damage = 5; // Base damage

if (player.equippedWeapon) {
const damageRange = player.equippedWeapon.damage.split("-").map(Number);
damage = Math.floor(Math.random() * (damageRange[1] - damageRange[0] + 1)) + damageRange[0];
}

damage = Math.floor(damage * skill.damageMultiplier);

// Add stat bonuses
if (player.class === 'warrior') {
damage += Math.floor(player.strength / 2);
} else if (player.class === 'rogue') {
damage += Math.floor(player.dexterity / 2);
} else if (player.class === 'mage') {
damage += Math.floor(player.intelligence);
}

addToGameLog(`You use <span class="important">${skill.name}</span> on the ${enemy.name} for <span class="damage">${damage}</span> damage!`);
enemy.health -= damage;
} else if (skill.damage) {
let damage = skill.damage;

// Mage spells scale with intelligence
if (player.class === 'mage') {
damage += Math.floor(player.intelligence * 1.5);
}

addToGameLog(`You use <span class="important">${skill.name}</span> on the ${enemy.name} for <span class="damage">${damage}</span> damage!`);
enemy.health -= damage;
} else if (skill.effect) {
addToGameLog(`You use <span class="important">${skill.name}</span>: ${skill.effect}`);
// In a more complete game, we'd track buffs/debuffs
}

// Check for freeze effect
if (skill.freezeChance && Math.random() < skill.freezeChance) {
addToGameLog(`<span class="debuff">The ${enemy.name} is frozen!</span>`);
}

// Check if enemy is defeated
if (enemy.health <= 0) {
enemy.health = 0;
defeatEnemy();
} else {
// Enemy attacks back
enemyAttack();
}

updateCombatScreen();
}

// Enemy attack in combat
function enemyAttack() {
const player = gameState.player;
const enemy = gameState.player.currentEnemy;

if (!enemy) return;

// Calculate enemy damage
let damage;
if (typeof enemy.damage === "string") {
const damageRange = enemy.damage.split("-").map(Number);
damage = Math.floor(Math.random() * (damageRange[1] - damageRange[0] + 1)) + damageRange[0];
} else {
damage = enemy.damage;
}

// Check for enemy critical hit
if (enemy.critChance && Math.random() < enemy.critChance) {
damage *= 2;
addToGameLog(`<span class="critical">The ${enemy.name} lands a critical hit!</span>`);
}

// Add any special damage types
if (enemy.fireDamage) {
damage += enemy.fireDamage;
addToGameLog(`<span class="debuff">The attack burns you for ${enemy.fireDamage} extra damage!</span>`);
}
if (enemy.poisonDamage) {
addToGameLog(`<span class="debuff">You are poisoned for ${enemy.poisonDamage} damage per turn!</span>`);
// In a full game, we'd track this debuff
}

// Reduce damage by armor if equipped
if (player.equippedArmor) {
damage -= player.equippedArmor.defense;
if (damage < 1) damage = 1; // Minimum 1 damage

// Check for block chance
if (player.equippedArmor.blockChance && Math.random() < player.equippedArmor.blockChance) {
damage = 0;
addToGameLog(`<span class="important">Your armor blocks the attack!</span>`);
}
}

// Rogue has chance to dodge
if (player.class === 'rogue') {
const dodgeChance = 0.1 + (player.dexterity / 200);
if (player.equippedArmor && player.equippedArmor.dodgeChance) {
dodgeChance += player.equippedArmor.dodgeChance;
}

if (Math.random() < dodgeChance) {
addToGameLog(`<span class="important">You dodge the ${enemy.name}'s attack!</span>`);
return;
}
}

player.health -= damage;
addToGameLog(`The ${enemy.name} attacks you for <span class="damage">${damage}</span> damage!`);

// Check for enemy lifesteal
if (enemy.lifesteal) {
const enemyHeal = Math.floor(damage * enemy.lifesteal);
enemy.health = Math.min(enemy.maxHealth, enemy.health + enemyHeal);
addToGameLog(`The ${enemy.name} heals for <span class="heal">${enemyHeal}</span> health!`);
}

// Check for enemy regen
if (enemy.regen) {
enemy.health = Math.min(enemy.maxHealth, enemy.health + enemy.regen);
}

// Check if player is defeated
if (player.health <= 0) {
player.health = 0;
addToGameLog(`<span class="enemy">You have been defeated by the ${enemy.name}!</span>`);
addToGameLog("You wake up back at camp, having lost some gold and items...");

// Lose some gold and items
const goldLost = Math.floor(player.gold * 0.3);
player.gold -= goldLost;
if (player.gold < 0) player.gold = 0;

// Lose a random item (10% chance for each item)
for (let i = player.inventory.length - 1; i >= 0; i--) {
if (Math.random() < 0.1) {
addToGameLog(`You lost your ${player.inventory[i].name} in the fight!`);
player.inventory.splice(i, 1);
}
}

// Reset health
player.health = Math.floor(player.maxHealth / 3);
if (player.class === 'mage' || player.class === 'warrior') {
player.mana = Math.floor(player.maxMana / 3);
}

// End combat
gameState.player.inCombat = false;
gameState.player.currentEnemy = null;
showScreen("main");
}
}

// Attempt to flee from combat
function attemptFlee() {
const player = gameState.player;
const enemy = gameState.player.currentEnemy;

// Rogue has higher chance to flee
let fleeChance = 0.4;
if (player.class === 'rogue') {
fleeChance = 0.6;
}

// Reduce chance if enemy is faster
if (enemy.level > player.level) {
fleeChance -= 0.1 * (enemy.level - player.level);
}

if (Math.random() < fleeChance) {
addToGameLog(`You successfully flee from the ${enemy.name}!`);
gameState.player.inCombat = false;
gameState.player.currentEnemy = null;
showScreen("main");
} else {
addToGameLog(`You fail to flee from the ${enemy.name}!`);
enemyAttack();
}
}

// Show items during combat
function showCombatItems() {
const player = gameState.player;
const consumables = player.inventory.filter(item => item.type === "consumable");

const actionsDiv = document.getElementById("combat-actions");
actionsDiv.innerHTML = "";

if (consumables.length === 0) {
const noItemsBtn = document.createElement("button");
noItemsBtn.className = "game-button";
noItemsBtn.textContent = "NO ITEMS";
noItemsBtn.disabled = true;
actionsDiv.appendChild(noItemsBtn);
} else {
consumables.forEach(item => {
const itemBtn = document.createElement("button");
itemBtn.className = "game-button";
itemBtn.textContent = item.name.toUpperCase();
itemBtn.onclick = function() { useItem(item); };
actionsDiv.appendChild(itemBtn);
});
}

const backBtn = document.createElement("button");
backBtn.className = "game-button";
backBtn.textContent = "BACK";
backBtn.onclick = function() { updateCombatScreen(); };
actionsDiv.appendChild(backBtn);
}

// Use item during combat
function useItem(item) {
const player = gameState.player;

if (item.effect.health) {
player.health += item.effect.health;
if (player.health > player.maxHealth) player.health = player.maxHealth;
addToGameLog(`You use ${item.name} and restore <span class="heal">${item.effect.health}</span> health!`);
} else if (item.effect.mana) {
player.mana += item.effect.mana;
if (player.mana > player.maxMana) player.mana = player.maxMana;
addToGameLog(`You use ${item.name} and restore <span class="heal">${item.effect.mana}</span> mana!`);
} else if (item.effect.damage) {
const enemy = gameState.player.currentEnemy;
enemy.health -= item.effect.damage;
addToGameLog(`You use ${item.name} and deal <span class="damage">${item.effect.damage}</span> damage to the ${enemy.name}!`);

if (enemy.health <= 0) {
enemy.health = 0;
defeatEnemy();
return;
}
}

// Remove item from inventory
const itemIndex = player.inventory.findIndex(i => i.id === item.id);
if (itemIndex !== -1) {
player.inventory.splice(itemIndex, 1);
}

// Enemy still gets an attack
enemyAttack();

updateCombatScreen();
}

// Defeat enemy in combat
function defeatEnemy() {
const player = gameState.player;
const enemy = gameState.player.currentEnemy;

addToGameLog(`<span class="important">You defeated the ${enemy.name}!</span>`);

// Gain XP
const xpGain = enemy.xp;
player.xp += xpGain;
addToGameLog(`You gain <span class="xp">${xpGain} XP</span>!`);

// Gain gold
const goldGain = enemy.gold;
player.gold += goldGain;
addToGameLog(`You find <span class="gold">${goldGain} gold</span> on the ${enemy.name}.`);

// Check for level up
checkLevelUp();

// Check for area unlocks
checkAreaUnlocks();

// Small chance to find item
if (Math.random() < 0.4) {
findItem();
}

// End combat
gameState.player.inCombat = false;
gameState.player.currentEnemy = null;
showScreen("main");
}

// Check if player levels up
function checkLevelUp() {
const player = gameState.player;

if (player.xp >= player.xpToNextLevel) {
player.level++;
player.xp -= player.xpToNextLevel;
player.xpToNextLevel = Math.floor(player.xpToNextLevel * 1.5);

// Increase stats based on class
if (player.class === 'warrior') {
player.maxHealth += 25;
player.health += 25;
player.strength += 4;
player.constitution += 3;
player.dexterity += 1;
player.maxMana += 5;
player.mana += 5;
} else if (player.class === 'mage') {
player.maxHealth += 12;
player.health += 12;
player.maxMana += 20;
player.mana += 20;
player.intelligence += 5;
player.dexterity += 1;
} else if (player.class === 'rogue') {
player.maxHealth += 18;
player.health += 18;
player.dexterity += 4;
player.strength += 2;
player.constitution += 2;
}

addToGameLog(`<span class="important">You leveled up to level ${player.level}!</span>`);
addToGameLog(`Your stats have improved!`);

// Check for another level up (unlikely but possible)
checkLevelUp();
}
}

// Check if new areas should be unlocked
function checkAreaUnlocks() {
const player = gameState.player;
gameState.areas.forEach(area => {
if (!area.unlocked && player.level >= area.minLevel) {
area.unlocked = true;
addToGameLog(`<span class="important">New area unlocked: ${area.name}!</span>`);
}
});
}

// Find random item
function findItem() {
const player = gameState.player;
const allItems = [...gameState.items.weapons, ...gameState.items.armor, ...gameState.items.consumables];
const randomItem = {...allItems[Math.floor(Math.random() * allItems.length)]};

// Only find items appropriate for player level
if (randomItem.level && randomItem.level > player.level) {
// Try again for a lower level item
return findItem();
}

player.inventory.push(randomItem);
addToGameLog(`You found a <span class="item">${randomItem.name}</span>!`);
}

// Rest to recover health and mana
function rest() {
const player = gameState.player;

const healthRecovered = Math.floor(player.maxHealth * 0.5);
player.health = Math.min(player.maxHealth, player.health + healthRecovered);

if (player.class === 'mage' || player.class === 'warrior') {
const manaRecovered = Math.floor(player.maxMana * 0.5);
player.mana = Math.min(player.maxMana, player.mana + manaRecovered);
}

addToGameLog(`You rest and recover <span class="heal">${healthRecovered}</span> health.`);
updatePlayerStats();
}

// Show character screen
function showCharacterScreen() {
const player = gameState.player;
let charHTML = `<span class="class-${player.class}">${player.class.toUpperCase()}</span> Level: ${player.level}<br>`;
charHTML += `XP: ${player.xp}/${player.xpToNextLevel}<br><br>`;
charHTML += `<span class="health">Health: ${player.health}/${player.maxHealth}</span><br>`;

if (player.class === 'mage' || player.class === 'warrior') {
charHTML += `<span class="mana">Mana: ${player.mana}/${player.maxMana}</span><br>`;
}

charHTML += `<br><strong>Stats:</strong><br>`;
charHTML += `Strength: ${player.strength}<br>`;
charHTML += `Dexterity: ${player.dexterity}<br>`;
charHTML += `Intelligence: ${player.intelligence}<br>`;
charHTML += `Constitution: ${player.constitution}<br><br>`;

charHTML += `<strong>Equipment:</strong><br>`;
charHTML += `Weapon: ${player.equippedWeapon ? player.equippedWeapon.name : "None"}<br>`;
charHTML += `Armor: ${player.equippedArmor ? player.equippedArmor.name : "None"}<br><br>`;

charHTML += `<strong>Current Area:</strong> ${player.currentArea}<br>`;
charHTML += `<strong>Unlocked Areas:</strong> `;
charHTML += gameState.areas.filter(a => a.unlocked).map(a => a.name).join(", ");

document.getElementById("character-info").innerHTML = charHTML;
}

// Show inventory
function showInventory() {
const player = gameState.player;
const inventoryDiv = document.getElementById("inventory-items");

if (player.inventory.length === 0) {
inventoryDiv.innerHTML = "Your inventory is empty.";
document.getElementById("item-details").innerHTML = "";
return;
}

let inventoryHTML = "<h3>Inventory:</h3>";
inventoryHTML += `<span class="gold">Gold: ${player.gold}</span><br><br>`;

// Group items by type
const weapons = player.inventory.filter(item => item.type === "weapon");
const armor = player.inventory.filter(item => item.type === "armor");
const consumables = player.inventory.filter(item => item.type === "consumable");

if (weapons.length > 0) {
inventoryHTML += "<strong>Weapons:</strong><br>";
weapons.forEach(weapon => {
inventoryHTML += `<button class="game-button" onclick="showItemDetails(${weapon.id})" style="text-align:left;margin:2px 0;padding:5px;">${weapon.name} (${weapon.damage})</button><br>`;
});
}

if (armor.length > 0) {
inventoryHTML += "<br><strong>Armor:</strong><br>";
armor.forEach(armorItem => {
inventoryHTML += `<button class="game-button" onclick="showItemDetails(${armorItem.id})" style="text-align:left;margin:2px 0;padding:5px;">${armorItem.name} (Def:${armorItem.defense})</button><br>`;
});
}

if (consumables.length > 0) {
inventoryHTML += "<br><strong>Consumables:</strong><br>";
consumables.forEach(consumable => {
inventoryHTML += `<button class="game-button" onclick="showItemDetails(${consumable.id})" style="text-align:left;margin:2px 0;padding:5px;">${consumable.name}</button><br>`;
});
}

inventoryDiv.innerHTML = inventoryHTML;
}

// Show item details
function showItemDetails(itemId) {
const player = gameState.player;
const item = player.inventory.find(i => i.id === itemId);

if (!item) return;

let detailsHTML = `<div class="item-info"><h3>${item.name}</h3>`;

if (item.type === "weapon") {
detailsHTML += `Type: Weapon<br>`;
detailsHTML += `Damage: ${item.damage}<br>`;
if (item.magicDamage) {
detailsHTML += `Magic Damage: +${item.magicDamage}<br>`;
}
if (item.critChance) {
detailsHTML += `Crit Chance: +${Math.floor(item.critChance * 100)}%<br>`;
}
if (item.lifesteal) {
detailsHTML += `Lifesteal: ${Math.floor(item.lifesteal * 100)}%<br>`;
}
detailsHTML += `Level: ${item.level}<br>`;
detailsHTML += `Value: ${item.value} gold<br><br>`;

// Equip button if not already equipped
if (player.equippedWeapon && player.equippedWeapon.id === item.id) {
detailsHTML += `<button class="game-button" disabled>EQUIPPED</button> `;
} else {
detailsHTML += `<button class="game-button" onclick="equipItem(${item.id})">EQUIP</button> `;
}
} else if (item.type === "armor") {
detailsHTML += `Type: Armor<br>`;
detailsHTML += `Defense: ${item.defense}<br>`;
if (item.magicResist) {
detailsHTML += `Magic Resist: +${item.magicResist}<br>`;
}
if (item.dodgeChance) {
detailsHTML += `Dodge Chance: +${Math.floor(item.dodgeChance * 100)}%<br>`;
}
if (item.blockChance) {
detailsHTML += `Block Chance: +${Math.floor(item.blockChance * 100)}%<br>`;
}
if (item.manaRegen) {
detailsHTML += `Mana Regen: +${item.manaRegen}/turn<br>`;
}
detailsHTML += `Level: ${item.level}<br>`;
detailsHTML += `Value: ${item.value} gold<br><br>`;

// Equip button if not already equipped
if (player.equippedArmor && player.equippedArmor.id === item.id) {
detailsHTML += `<button class="game-button" disabled>EQUIPPED</button> `;
} else {
detailsHTML += `<button class="game-button" onclick="equipItem(${item.id})">EQUIP</button> `;
}
} else if (item.type === "consumable") {
detailsHTML += `Type: Consumable<br>`;
if (item.effect.health) {
detailsHTML += `Restores ${item.effect.health} health<br>`;
} else if (item.effect.mana) {
detailsHTML += `Restores ${item.effect.mana} mana<br>`;
} else if (item.effect.damage) {
detailsHTML += `Deals ${item.effect.damage} damage<br>`;
} else if (item.effect.strength) {
detailsHTML += `+${item.effect.strength} Strength for ${item.duration} turns<br>`;
} else if (item.effect.maxHealth) {
detailsHTML += `Permanently increases max health by ${item.effect.maxHealth}<br>`;
}
detailsHTML += `Value: ${item.value} gold<br><br>`;

detailsHTML += `<button class="game-button" onclick="useInventoryItem(${item.id})">USE</button> `;
}

detailsHTML += `<button class="game-button" onclick="sellItem(${item.id})">SELL</button>`;
detailsHTML += `</div>`;

document.getElementById("item-details").innerHTML = detailsHTML;
}

// Equip item
function equipItem(itemId) {
const player = gameState.player;
const item = player.inventory.find(i => i.id === itemId);

if (!item) return;

if (item.type === "weapon") {
// Unequip current weapon if any
if (player.equippedWeapon) {
player.inventory.push(player.equippedWeapon);
}
player.equippedWeapon = item;

// Remove from inventory
const itemIndex = player.inventory.findIndex(i => i.id === item.id);
if (itemIndex !== -1) {
player.inventory.splice(itemIndex, 1);
}

addToGameLog(`You equipped the ${item.name}.`);
} else if (item.type === "armor") {
// Unequip current armor if any
if (player.equippedArmor) {
player.inventory.push(player.equippedArmor);
}
player.equippedArmor = item;

// Remove from inventory
const itemIndex = player.inventory.findIndex(i => i.id === item.id);
if (itemIndex !== -1) {
player.inventory.splice(itemIndex, 1);
}

addToGameLog(`You equipped the ${item.name}.`);
}

showInventory();
}

// Use item from inventory (outside combat)
function useInventoryItem(itemId) {
const player = gameState.player;
const item = player.inventory.find(i => i.id === itemId);

if (!item) return;

if (item.effect.health) {
player.health += item.effect.health;
if (player.health > player.maxHealth) player.health = player.maxHealth;
addToGameLog(`You use ${item.name} and restore <span class="heal">${item.effect.health}</span> health!`);
} else if (item.effect.mana) {
player.mana += item.effect.mana;
if (player.mana > player.maxMana) player.mana = player.maxMana;
addToGameLog(`You use ${item.name} and restore <span class="heal">${item.effect.mana}</span> mana!`);
} else if (item.effect.maxHealth) {
player.maxHealth += item.effect.maxHealth;
player.health += item.effect.maxHealth;
addToGameLog(`You use ${item.name} and permanently increase your max health by <span class="heal">${item.effect.maxHealth}</span>!`);
}

// Remove item from inventory
const itemIndex = player.inventory.findIndex(i => i.id === item.id);
if (itemIndex !== -1) {
player.inventory.splice(itemIndex, 1);
}

showInventory();
updatePlayerStats();
}

// Sell item
function sellItem(itemId) {
const player = gameState.player;
const item = player.inventory.find(i => i.id === itemId);

if (!item) return;

// Can't sell equipped items
if ((player.equippedWeapon && player.equippedWeapon.id === item.id) ||
(player.equippedArmor && player.equippedArmor.id === item.id)) {
addToGameLog("You can't sell equipped items!");
return;
}

const sellValue = Math.floor(item.value * 0.75);
player.gold += sellValue;

// Remove from inventory
const itemIndex = player.inventory.findIndex(i => i.id === item.id);
if (itemIndex !== -1) {
player.inventory.splice(itemIndex, 1);
}

addToGameLog(`You sold ${item.name} for <span class="gold">${sellValue} gold</span>.`);
showInventory();
updatePlayerStats();
}

// Generate shop items
function generateShopItems() {
const player = gameState.player;
gameState.shopItems = [];

// Generate 2 weapons, 1 armor, and 2 consumables
const allWeapons = gameState.items.weapons.filter(w => w.level <= player.level + 2);
const allArmor = gameState.items.armor.filter(a => a.level <= player.level + 2);
const allConsumables = gameState.items.consumables;

// Add random weapons
for (let i = 0; i < 2; i++) {
if (allWeapons.length > 0) {
const randomWeapon = {...allWeapons[Math.floor(Math.random() * allWeapons.length)]};
gameState.shopItems.push(randomWeapon);
}
}

// Add random armor
if (allArmor.length > 0) {
const randomArmor = {...allArmor[Math.floor(Math.random() * allArmor.length)]};
gameState.shopItems.push(randomArmor);
}

// Add random consumables
for (let i = 0; i < 2; i++) {
if (allConsumables.length > 0) {
const randomConsumable = {...allConsumables[Math.floor(Math.random() * allConsumables.length)]};
gameState.shopItems.push(randomConsumable);
}
}
}

// Show shop
function showShop() {
const player = gameState.player;
const shopDiv = document.getElementById("shop-items");

if (gameState.shopItems.length === 0) {
shopDiv.innerHTML = "The shop is currently empty.";
return;
}

let shopHTML = "<h3>Shop:</h3>";
shopHTML += `<span class="gold">Your gold: ${player.gold}</span><br><br>`;

gameState.shopItems.forEach(item => {
shopHTML += `<div style="margin-bottom:10px;border-bottom:1px solid #333;padding-bottom:5px;">`;
shopHTML += `<strong>${item.name}</strong> - ${item.value} gold<br>`;

if (item.type === "weapon") {
shopHTML += `Damage: ${item.damage} `;
if (item.magicDamage) shopHTML += `+ ${item.magicDamage} magic `;
if (item.critChance) shopHTML += `(${Math.floor(item.critChance * 100)}% crit) `;
if (item.lifesteal) shopHTML += `(${Math.floor(item.lifesteal * 100)}% lifesteal) `;
} else if (item.type === "armor") {
shopHTML += `Defense: ${item.defense} `;
if (item.magicResist) shopHTML += `Magic Resist: ${item.magicResist} `;
if (item.dodgeChance) shopHTML += `Dodge: ${Math.floor(item.dodgeChance * 100)}% `;
if (item.blockChance) shopHTML += `Block: ${Math.floor(item.blockChance * 100)}% `;
} else if (item.type === "consumable") {
if (item.effect.health) {
shopHTML += `Restores ${item.effect.health} health `;
} else if (item.effect.mana) {
shopHTML += `Restores ${item.effect.mana} mana `;
} else if (item.effect.damage) {
shopHTML += `Deals ${item.effect.damage} damage `;
} else if (item.effect.maxHealth) {
shopHTML += `+${item.effect.maxHealth} max HP `;
}
}

shopHTML += `<br>Level: ${item.level || "N/A"}<br>`;
shopHTML += `<button class="game-button" onclick="buyItem(${item.id})" ${player.gold < item.value ? "disabled" : ""}>BUY</button>`;
shopHTML += `</div>`;
});

shopDiv.innerHTML = shopHTML;
}

// Refresh shop items
function refreshShop() {
const player = gameState.player;
if (player.gold < 50) {
addToGameLog("You need 50 gold to refresh the shop!");
return;
}

player.gold -= 50;
generateShopItems();
showShop();
addToGameLog("The shopkeeper brings out new items... (-50 gold)");
updatePlayerStats();
}

// Buy item from shop
function buyItem(itemId) {
const player = gameState.player;
const item = gameState.shopItems.find(i => i.id === itemId);

if (!item) return;

if (player.gold >= item.value) {
player.gold -= item.value;
player.inventory.push({...item});

// Remove from shop
const itemIndex = gameState.shopItems.findIndex(i => i.id === item.id);
if (itemIndex !== -1) {
gameState.shopItems.splice(itemIndex, 1);
}

addToGameLog(`You bought ${item.name} for <span class="gold">${item.value} gold</span>.`);
showShop();
updatePlayerStats();
} else {
addToGameLog("Not enough gold!");
}
}

// Class selection functions
function selectClass(className) {
const player = gameState.player;
player.class = className;

// Set class-specific stats
if (className === 'warrior') {
player.maxHealth = 150;
player.health = 150;
player.maxMana = 40;
player.mana = 40;
player.strength = 18;
player.dexterity = 8;
player.intelligence = 5;
player.constitution = 15;

// Starting equipment
player.equippedWeapon = {...gameState.items.weapons.find(w => w.id === 1)}; // Rusty Sword
player.equippedArmor = {...gameState.items.armor.find(a => a.id === 10)}; // Leather Armor
player.skills = [...gameState.classSkills.warrior];
} else if (className === 'mage') {
player.maxHealth = 90;
player.health = 90;
player.maxMana = 100;
player.mana = 100;
player.strength = 5;
player.dexterity = 8;
player.intelligence = 18;
player.constitution = 8;

// Starting equipment
player.equippedWeapon = {...gameState.items.weapons.find(w => w.id === 6)}; // Staff of Fire
player.equippedArmor = {...gameState.items.armor.find(a => a.id === 13)}; // Mage Robes
player.skills = [...gameState.classSkills.mage];
} else if (className === 'rogue') {
player.maxHealth = 120;
player.health = 120;
player.strength = 8;
player.dexterity = 18;
player.intelligence = 8;
player.constitution = 10;

// Starting equipment
player.equippedWeapon = {...gameState.items.weapons.find(w => w.id === 8)}; // Dagger
player.equippedArmor = {...gameState.items.armor.find(a => a.id === 14)}; // Shadow Cloak
player.skills = [...gameState.classSkills.rogue];
}

// Hide class selection and show main game
document.getElementById("class-select-screen").style.display = "none";
document.getElementById("main-buttons").style.display = "flex";

addToGameLog(`You have chosen the path of the ${className}. Your adventure begins!`);
updatePlayerStats();
}

// Show class description when hovering over class button
function showClassDescription(className) {
document.getElementById("class-description").innerHTML = gameState.classDescriptions[className];
}

// Initialize class selection screen
function initClassSelection() {
document.getElementById("main-buttons").style.display = "none";
document.getElementById("class-select-screen").style.display = "block";

// Add event listeners for class buttons
document.querySelector(".class-warrior").addEventListener("mouseover", function() { showClassDescription('warrior'); });
document.querySelector(".class-mage").addEventListener("mouseover", function() { showClassDescription('mage'); });
document.querySelector(".class-rogue").addEventListener("mouseover", function() { showClassDescription('rogue'); });
}

// Initialize the game when page loads
window.onload = function() {
initClassSelection();
};
</script>
</body>
</html>
