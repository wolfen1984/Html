<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dracula's Rise - Vampire Hunter Adventure</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #000;
            color: #fff;
            font-family: 'Press Start 2P', cursive;
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .game-container {
            border: 4px double #fff;
            padding: 20px;
            margin-bottom: 20px;
            background-color: #111;
            min-height: 80vh;
        }
        
        .screen {
            display: none;
        }
        
        .active {
            display: block;
        }
        
        h1, h2, h3 {
            color: #ff3333;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 0 5px #ff0000;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 30px;
        }
        
        h2 {
            font-size: 1.8rem;
            margin-top: 20px;
        }
        
        h3 {
            font-size: 1.2rem;
            text-align: left;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
            margin-top: 15px;
        }
        
        .game-text {
            background-color: #000;
            border: 2px solid #333;
            padding: 15px;
            margin: 20px 0;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            font-size: 0.9rem;
            line-height: 1.8;
        }
        
        .game-text p {
            margin-bottom: 15px;
        }
        
        .npc-dialogue {
            color: #ffff66;
            font-style: italic;
            margin: 10px 0;
            padding-left: 10px;
            border-left: 2px solid #ffff66;
        }
        
        .player-dialogue {
            color: #66ff66;
            margin: 10px 0;
            padding-left: 10px;
            border-left: 2px solid #66ff66;
        }
        
        .button-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }
        
        button {
            background-color: #222;
            color: #fff;
            border: 2px solid #666;
            font-family: 'Press Start 2P', cursive;
            padding: 12px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
            flex-grow: 1;
            min-width: 200px;
        }
        
        button:hover:not(:disabled) {
            background-color: #333;
            border-color: #ff3333;
            color: #ff3333;
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-item {
            background-color: #222;
            padding: 10px;
            border: 1px solid #444;
            text-align: center;
        }
        
        .stat-value {
            color: #ffff66;
            font-weight: bold;
            font-size: 1.5rem;
        }
        
        .inventory {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
        }
        
        .item {
            background-color: #1a1a1a;
            padding: 8px;
            border: 1px solid #333;
            font-size: 0.8rem;
        }
        
        .item-rare {
            border-color: #ff9900;
            color: #ff9900;
        }
        
        .item-legendary {
            border-color: #ff3366;
            color: #ff3366;
        }
        
        .outcome-good {
            color: #66ff66;
        }
        
        .outcome-bad {
            color: #ff6666;
        }
        
        .warning {
            color: #ff9900;
        }
        
        .game-over {
            color: #ff0000;
            font-size: 1.5rem;
            text-align: center;
            margin: 30px 0;
        }
        
        .victory {
            color: #66ff66;
            font-size: 1.5rem;
            text-align: center;
            margin: 30px 0;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #666;
            font-size: 0.7rem;
            border-top: 1px solid #333;
            padding-top: 15px;
        }
        
        /* Combat styles */
        .combat-screen {
            background-color: #220000;
            border: 2px solid #ff0000;
        }
        
        .combatant {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 10px 0;
            background-color: #330000;
            border: 1px solid #660000;
        }
        
        .combatant-player {
            border-color: #006600;
            background-color: #003300;
        }
        
        .health-bar {
            width: 100%;
            height: 20px;
            background-color: #330000;
            border: 1px solid #666;
            margin: 5px 0;
        }
        
        .health-fill {
            height: 100%;
            background-color: #ff0000;
            transition: width 0.3s;
        }
        
        .health-fill-player {
            background-color: #66ff66;
        }
        
        /* Dice roller */
        .dice-roller {
            background-color: #222;
            border: 2px solid #666;
            padding: 10px;
            margin: 10px 0;
            text-align: center;
        }
        
        .dice-result {
            font-size: 2rem;
            color: #ffff66;
            margin: 10px 0;
        }
        
        .roll-button {
            background-color: #333;
            color: #ffff66;
            border-color: #ffff66;
        }
        
        /* Skill check display */
        .skill-check {
            background-color: #1a1a2a;
            border: 1px solid #4444ff;
            padding: 10px;
            margin: 10px 0;
        }
        
        .skill-success {
            color: #3399ff;
            background-color: #112233;
            padding: 5px;
            margin: 5px 0;
            border-left: 3px solid #3399ff;
        }
        
        .skill-failure {
            color: #ff6666;
            background-color: #332222;
            padding: 5px;
            margin: 5px 0;
            border-left: 3px solid #ff6666;
        }
        
        /* Puzzle and trap styles */
        .puzzle-container {
            background-color: #1a1a1a;
            border: 2px dashed #ff9900;
            padding: 15px;
            margin: 15px 0;
        }
        
        .trap-warning {
            color: #ff3333;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* Gamebook section numbers */
        .section-number {
            color: #ffff66;
            font-weight: bold;
            margin-right: 10px;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }
            
            h2 {
                font-size: 1.3rem;
            }
            
            .game-text {
                font-size: 0.8rem;
            }
            
            button {
                font-size: 0.7rem;
                min-width: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Start Screen -->
        <div id="start-screen" class="screen active">
            <h1>DRACULA'S RISE</h1>
            <h2>VAMPIRE HUNTER ADVENTURE</h2>
            <div class="game-text">
                <p>Transylvania, 1897. The blood moon rises over the Carpathian Mountains.</p>
                <p>You are a vampire hunter who has traveled to this remote village to fulfill your destiny: to find and destroy Count Dracula in his mountain castle.</p>
                <p>The villagers speak in hushed tones of the creature that stalks the night, feeding on their kin.</p>
                <p class="warning">This is a Fighting Fantasy-style gamebook adventure. You will need:</p>
                <p>• Your CHARACTER SHEET (Stamina, Skill, Luck)</p>
                <p>• Two six-sided dice (2D6)</p>
                <p>• A pencil and eraser to track your inventory and stats</p>
                <p class="outcome-good">Now with 80+ sections! Multiple paths to victory!</p>
                <p class="outcome-bad">Beware: Death lurks in every shadow!</p>
            </div>
            <div class="button-container">
                <button id="start-btn">BEGIN YOUR QUEST</button>
                <button id="rules-btn">GAME RULES</button>
            </div>
        </div>
        
        <!-- Rules Screen -->
        <div id="rules-screen" class="screen">
            <h2>GAMEBOOK RULES</h2>
            <div class="game-text">
                <h3>YOUR CHARACTER</h3>
                <p><span class="section-number">1.</span> <strong>STAMINA:</strong> Your health. If it reaches 0, you die.</p>
                <p><span class="section-number">2.</span> <strong>SKILL:</strong> Your combat ability and agility.</p>
                <p><span class="section-number">3.</span> <strong>LUCK:</strong> Your fortune. Test Luck to avoid traps or find treasure.</p>
                
                <h3>COMBAT</h3>
                <p><span class="section-number">1.</span> Roll 2D6 + your SKILL vs enemy's 2D6 + their SKILL</p>
                <p><span class="section-number">2.</span> Higher score hits for damage (see enemy stats)</p>
                <p><span class="section-number">3.</span> You may flee on your turn (Test Skill to escape)</p>
                
                <h3>TESTING SKILL</h3>
                <p>Roll 2D6. If result ≤ your SKILL, you succeed!</p>
                <p>Example: Skill 12 needs 12 or less on 2D6</p>
                
                <h3>TESTING LUCK</h3>
                <p>Roll 2D6. If result ≤ your LUCK, you're lucky!</p>
                <p>Each Luck test reduces LUCK by 1 (win or lose)</p>
                
                <h3>INVENTORY</h3>
                <p>You can carry 10 items. Weapons, armor, and special items take slots.</p>
                <p>Some items give combat bonuses or solve puzzles.</p>
            </div>
            <div class="button-container">
                <button onclick="showStartScreen()">BACK</button>
                <button onclick="showCharacterScreen()">CREATE CHARACTER</button>
            </div>
        </div>
        
        <!-- Character Creation Screen -->
        <div id="character-screen" class="screen">
            <h2>CREATE YOUR VAMPIRE HUNTER</h2>
            <div class="game-text">
                <p>Roll 2D6 for each stat, then distribute 6 bonus points as you wish.</p>
                <p class="warning">Write these scores on your character sheet!</p>
                
                <div class="stats-container">
                    <div class="stat-item">
                        <h3>STAMINA</h3>
                        <div class="dice-roller">
                            <div class="dice-result" id="stamina-roll">--</div>
                            <button class="roll-button" onclick="rollStat('stamina')">ROLL 2D6 + 12</button>
                        </div>
                        <p>Current: <span id="stamina-value" class="stat-value">0</span></p>
                        <button onclick="adjustStat('stamina', 1)">+</button>
                        <button onclick="adjustStat('stamina', -1)">-</button>
                    </div>
                    
                    <div class="stat-item">
                        <h3>SKILL</h3>
                        <div class="dice-roller">
                            <div class="dice-result" id="skill-roll">--</div>
                            <button class="roll-button" onclick="rollStat('skill')">ROLL 2D6 + 6</button>
                        </div>
                        <p>Current: <span id="skill-value" class="stat-value">0</span></p>
                        <button onclick="adjustStat('skill', 1)">+</button>
                        <button onclick="adjustStat('skill', -1)">-</button>
                    </div>
                    
                    <div class="stat-item">
                        <h3>LUCK</h3>
                        <div class="dice-roller">
                            <div class="dice-result" id="luck-roll">--</div>
                            <button class="roll-button" onclick="rollStat('luck')">ROLL 2D6 + 6</button>
                        </div>
                        <p>Current: <span id="luck-value" class="stat-value">0</span></p>
                        <button onclick="adjustStat('luck', 1)">+</button>
                        <button onclick="adjustStat('luck', -1)">-</button>
                    </div>
                </div>
                
                <p>Bonus points remaining: <span id="bonus-points" class="stat-value">6</span></p>
                <p class="warning">Minimum Stamina: 12, Minimum Skill: 6, Minimum Luck: 6</p>
                
                <h3>CHOOSE STARTING EQUIPMENT</h3>
                <p>Select 3 items from the list below:</p>
            </div>
            
            <div class="button-container">
                <button onclick="selectEquipment('silver_dagger')">SILVER DAGGER (+1 Skill vs undead)</button>
                <button onclick="selectEquipment('holy_water')">VIAL OF HOLY WATER (3 uses)</button>
                <button onclick="selectEquipment('garlic_charm')">GARLIC CHARM (protection vs vampires)</button>
                <button onclick="selectEquipment('healing_potion')">HEALING POTION (+4 Stamina)</button>
                <button onclick="selectEquipment('lantern')">BRASS LANTERN (light in darkness)</button>
                <button onclick="selectEquipment('wooden_stake')">WOODEN STAKE (kills vampires)</button>
                <button onclick="selectEquipment('silver_bullets')">SILVER BULLETS (6 rounds)</button>
                <button onclick="selectEquipment('holy_symbol')">HOLY SYMBOL (repels undead)</button>
            </div>
            
            <div class="inventory" id="selected-equipment">
                <!-- Selected equipment will appear here -->
            </div>
            
            <div class="button-container">
                <button id="begin-btn" onclick="startGame()" disabled>BEGIN ADVENTURE AT SECTION 1</button>
            </div>
        </div>
        
        <!-- Main Game Screen -->
        <div id="game-screen" class="screen">
            <h2>DRACULA'S RISE - VAMPIRE HUNTER</h2>
            
            <div class="stats-container">
                <div class="stat-item">
                    <h3>STAMINA</h3>
                    <div class="stat-value" id="current-stamina">0</div>
                    <div class="health-bar">
                        <div id="stamina-bar" class="health-fill health-fill-player" style="width: 100%"></div>
                    </div>
                </div>
                <div class="stat-item">
                    <h3>SKILL</h3>
                    <div class="stat-value" id="current-skill">0</div>
                    <div>Bonus: <span id="skill-bonus">+0</span></div>
                </div>
                <div class="stat-item">
                    <h3>LUCK</h3>
                    <div class="stat-value" id="current-luck">0</div>
                    <div>Next Test: <span id="luck-test">--</span></div>
                </div>
                <div class="stat-item">
                    <h3>SECTION</h3>
                    <div class="stat-value" id="current-section">1</div>
                    <div>Gamebook Reference</div>
                </div>
                <div class="stat-item">
                    <h3>GOLD</h3>
                    <div class="stat-value" id="current-gold">10</div>
                    <div>Coins</div>
                </div>
            </div>
            
            <div class="button-container">
                <button onclick="showInventory()">INVENTORY (<span id="inventory-count">0</span>/10)</button>
                <button onclick="rollDice()">ROLL DICE</button>
                <button onclick="testLuck()">TEST LUCK</button>
                <button onclick="useHealingItem()">USE HEALING</button>
            </div>
            
            <div class="game-text" id="game-text">
                <!-- Game text will be added here dynamically -->
            </div>
            
            <div class="button-container" id="action-buttons">
                <!-- Action buttons will be added here dynamically -->
            </div>
            
            <div id="dice-results" style="display:none;">
                <!-- Dice results will appear here -->
            </div>
        </div>
        
        <!-- Inventory Screen -->
        <div id="inventory-screen" class="screen">
            <h2>INVENTORY</h2>
            <div class="game-text">
                <h3>EQUIPMENT (<span id="total-items">0</span>/10 slots)</h3>
                <div class="inventory" id="inventory-items">
                    <!-- Inventory items will appear here -->
                </div>
                
                <h3>WEAPONS (Equipped)</h3>
                <div id="equipped-weapons">
                    <!-- Equipped weapons will appear here -->
                </div>
                
                <h3>SPECIAL ITEMS</h3>
                <div id="special-items">
                    <!-- Special items will appear here -->
                </div>
                
                <h3>PROVISIONS</h3>
                <div id="provisions">
                    <!-- Provisions will appear here -->
                </div>
            </div>
            <div class="button-container">
                <button onclick="showGameScreen()">RETURN TO GAME</button>
                <button onclick="useHealing()">USE HEALING (if available)</button>
            </div>
        </div>
        
        <!-- Combat Screen -->
        <div id="combat-screen" class="screen">
            <h2>COMBAT!</h2>
            <div class="game-text combat-screen" id="combat-text">
                <!-- Combat text will appear here -->
            </div>
            
            <div class="stats-container">
                <div class="stat-item">
                    <h3>YOUR STAMINA</h3>
                    <div class="stat-value" id="combat-player-stamina">0</div>
                    <div class="health-bar">
                        <div id="player-combat-bar" class="health-fill health-fill-player" style="width: 100%"></div>
                    </div>
                </div>
                <div class="stat-item">
                    <h3>ENEMY STAMINA</h3>
                    <div class="stat-value" id="combat-enemy-stamina">0</div>
                    <div class="health-bar">
                        <div id="enemy-combat-bar" class="health-fill" style="width: 100%"></div>
                    </div>
                </div>
            </div>
            
            <div id="combat-round">
                <!-- Combat round info will appear here -->
            </div>
            
            <div class="button-container" id="combat-actions">
                <!-- Combat actions will appear here -->
            </div>
        </div>
        
        <!-- Game Over Screen -->
        <div id="gameover-screen" class="screen">
            <h2>YOUR ADVENTURE HAS ENDED</h2>
            <div class="game-text" id="gameover-text">
                <!-- Game over text will appear here -->
            </div>
            <div class="button-container">
                <button onclick="restartGame()">TRY AGAIN</button>
                <button onclick="continueFromGameOver()">CONTINUE FROM LAST SAVE</button>
            </div>
        </div>
        
        <!-- Victory Screen -->
        <div id="victory-screen" class="screen">
            <h2>VICTORY!</h2>
            <div class="game-text" id="victory-text">
                <!-- Victory text will appear here -->
            </div>
            <div class="button-container">
                <button onclick="restartGame()">PLAY AGAIN</button>
                <button onclick="continueFromVictory()">CONTINUE ADVENTURE</button>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>DRACULA'S RISE - VAMPIRE HUNTER ADVENTURE</p>
        <p>Face the darkness and end the vampire's reign!</p>
    </div>

    <script>
        // Gamebook Adventure State
        const gameState = {
            screen: 'start',
            stats: {
                initialStamina: 0,
                stamina: 0,
                maxStamina: 0,
                initialSkill: 0,
                skill: 0,
                skillBonus: 0,
                initialLuck: 0,
                luck: 0,
                gold: 10
            },
            inventory: [],
            equippedWeapon: null,
            armor: null,
            currentSection: 1,
            visitedSections: [],
            combat: {
                active: false,
                enemy: null,
                enemyStamina: 0,
                round: 1,
                playerRoll: 0,
                enemyRoll: 0
            },
            dice: {
                value1: 0,
                value2: 0,
                total: 0
            },
            gameOver: false,
            victory: false,
            bonusPoints: 6,
            selectedEquipment: [],
            savedSection: 1
        };
        
        // GAMEBOOK SECTIONS
        const sections = {
            1: {
                text: "You arrive at the village of Targoviste as night falls. The locals eye you suspiciously as you enter the 'Blood Moon Tavern.' The air is thick with fear and the smell of cheap ale. The bartender, a grizzled old man, approaches you. 'You're not from around here. Looking for the castle?' he asks, wiping a glass. Do you:",
                options: [
                    { text: "Ask about the castle and Dracula", goto: 2, test: null },
                    { text: "Keep to yourself and drink quietly", goto: 3, test: null },
                    { text: "Ask if there's a room for the night", goto: 4, test: null },
                    { text: "Leave immediately for the forest path", goto: 5, test: { type: "luck", difficulty: 8 } }
                ]
            },
            2: {
                text: "The bartender leans in, lowering his voice. 'The castle is cursed. Dracula's been preying on our village for months. His minions come at night. The forest path is dangerous - wolves, bandits, and worse. You'll need supplies.' He offers you a map for 5 gold pieces. Do you:",
                options: [
                    { text: "Buy the map (5 gold)", goto: 6, test: { type: "gold", amount: 5 } },
                    { text: "Decline and head out anyway", goto: 5, test: null },
                    { text: "Ask about hiring a guide", goto: 7, test: null },
                    { text: "Threaten him for information", goto: 8, test: { type: "skill", difficulty: 10 } }
                ]
            },
            3: {
                text: "You sit in a corner, nursing your ale. A rough-looking man approaches your table. 'You look like a hunter. We could use someone like you. There's good money in protecting our village from the night creatures.' He offers you 20 gold to stay and guard the village tonight. Do you:",
                options: [
                    { text: "Accept the guard job", goto: 9, test: null },
                    { text: "Decline and continue your quest", goto: 5, test: null },
                    { text: "Ask about the night creatures", goto: 10, test: null },
                    { text: "Challenge him to a drinking contest", goto: 11, test: { type: "stamina", difficulty: 14 } }
                ]
            },
            4: {
                text: "The bartender nods. 'Room's 2 gold for the night. But I warn you - strange things happen after midnight.' You pay and head upstairs. The room is sparse but clean. At midnight, you hear scratching at your window. Do you:",
                options: [
                    { text: "Investigate the window", goto: 12, test: null },
                    { text: "Ignore it and try to sleep", goto: 13, test: { type: "luck", difficulty: 7 } },
                    { text: "Barricade the door and wait", goto: 14, test: null },
                    { text: "Go downstairs to investigate", goto: 15, test: null }
                ]
            },
            5: {
                text: "You leave the tavern and head toward the forest path leading to the mountains. The moon is full, casting eerie shadows. The path splits: one way follows a stream, the other climbs a rocky ridge. Which do you take?",
                options: [
                    { text: "Follow the stream path", goto: 16, test: null },
                    { text: "Take the rocky ridge path", goto: 17, test: { type: "skill", difficulty: 9 } },
                    { text: "Look for a hidden third path", goto: 18, test: { type: "skill", difficulty: 11 } },
                    { text: "Return to the village", goto: 1, test: null }
                ]
            },
            6: {
                text: "You buy the map. It shows the forest paths, mountain trails, and castle entrances. The bartender warns: 'Beware the wolves in the forest and the bats in the mountains. And whatever you do, don't be caught outside after midnight.' You thank him and head out.",
                effect: { item: "castle_map", gold: -5 },
                options: [
                    { text: "Head to the forest", goto: 5, test: null }
                ]
            },
            7: {
                text: "'Guides don't last long,' the bartender says. 'But Old Gregor might help you - if he's sober. He lives in the hut by the mill. He knows the mountain paths better than anyone.' Do you:",
                options: [
                    { text: "Go find Old Gregor", goto: 19, test: null },
                    { text: "Forget the guide and go alone", goto: 5, test: null },
                    { text: "Offer extra gold for a guide", goto: 20, test: { type: "gold", amount: 10 } }
                ]
            },
            8: {
                text: "You grab the bartender by his collar. 'Tell me what I need to know!' The tavern goes silent. Test your Skill to intimidate him.",
                options: [
                    { text: "Test Skill to intimidate", goto: 21, test: { type: "skill", difficulty: 10 } },
                    { text: "Release him and apologize", goto: 2, test: null }
                ]
            },
            9: {
                text: "You accept the guard job. The man introduces himself as Viktor, the village headman. 'Meet me at the north gate at sundown. We'll patrol together.' The pay is good, but it delays your quest. Do you:",
                options: [
                    { text: "Keep your word and guard tonight", goto: 22, test: null },
                    { text: "Take the advance and sneak away", goto: 23, test: { type: "luck", difficulty: 12 } },
                    { text: "Ask for equipment instead of gold", goto: 24, test: null }
                ]
            },
            10: {
                text: "'The creatures... they come from the castle,' the man says, looking around nervously. 'Bats that turn into men, wolves with red eyes, mist that takes form. Some say Dracula himself walks among us in disguise.' He shudders. 'You're brave or foolish to go there.'",
                options: [
                    { text: "Ask more about the castle", goto: 25, test: null },
                    { text: "Accept the guard job", goto: 9, test: null },
                    { text: "Leave for the forest", goto: 5, test: null }
                ]
            },
            11: {
                text: "You challenge the man to a drinking contest. The tavern cheers as mugs are filled. Test your Stamina - roll 2D6 and add your Stamina score.",
                options: [
                    { text: "Test Stamina for drinking contest", goto: 26, test: { type: "skill", target: function() { return gameState.stats.stamina; } } },
                    { text: "Back out gracefully", goto: 3, test: null }
                ]
            },
            12: {
                text: "You approach the window cautiously. Outside, a pale face stares back at you - a VAMPIRE! It crashes through the window!",
                options: [
                    { text: "Fight the vampire", goto: 27, combat: "vampire_minion" },
                    { text: "Use holy water if you have it", goto: 28, test: { type: "item", item: "holy_water" } },
                    { text: "Jump out the window to escape", goto: 29, test: { type: "skill", difficulty: 9 } }
                ]
            },
            13: {
                text: "You try to ignore the noise and sleep. The scratching grows louder, then stops. Suddenly, the door bursts open! A GHOUL charges in!",
                options: [
                    { text: "Fight the ghoul", goto: 30, combat: "ghoul" },
                    { text: "Use holy symbol if you have it", goto: 31, test: { type: "item", item: "holy_symbol" } },
                    { text: "Escape through the window", goto: 29, test: { type: "skill", difficulty: 8 } }
                ]
            },
            14: {
                text: "You barricade the door with furniture. The scratching continues for an hour, then stops. You survive the night unharmed. In the morning, you find claw marks on your door. The villagers are grateful you survived - they give you 5 gold for your bravery.",
                effect: { gold: 5 },
                options: [
                    { text: "Head to the forest", goto: 5, test: null }
                ]
            },
            15: {
                text: "You go downstairs to investigate. The tavern is empty except for the bartender, who's polishing glasses. 'Couldn't sleep?' he asks. 'It's the castle's influence. Gets worse every night.' He offers you a special garlic infusion for 3 gold. Do you:",
                options: [
                    { text: "Buy the garlic infusion", goto: 32, test: { type: "gold", amount: 3 } },
                    { text: "Go back to your room", goto: 12, test: null },
                    { text: "Leave the tavern immediately", goto: 5, test: null }
                ]
            },
            16: {
                text: "You follow the stream path. The water looks clean and refreshing. After an hour, you come to a clearing with an old stone bridge. Under the bridge, you see a glint of metal. Do you:",
                options: [
                    { text: "Investigate under the bridge", goto: 33, test: null },
                    { text: "Continue along the path", goto: 34, test: null },
                    { text: "Drink from the stream", goto: 35, test: { type: "luck", difficulty: 7 } },
                    { text: "Set up camp for the night", goto: 36, test: null }
                ]
            },
            17: {
                text: "You take the rocky ridge path. The climb is steep and treacherous. Test your Skill to navigate safely.",
                options: [
                    { text: "Test Skill to climb", goto: 37, test: { type: "skill", difficulty: 9 } },
                    { text: "Use rope if you have it", goto: 38, test: { type: "item", item: "rope" } },
                    { text: "Go back and take the stream path", goto: 16, test: null }
                ]
            },
            18: {
                text: "You search for a hidden path. After 30 minutes, you find an overgrown trail marked with strange symbols. It looks like it hasn't been used in years. Do you:",
                options: [
                    { text: "Take the hidden path", goto: 39, test: null },
                    { text: "Avoid it as possibly trapped", goto: 5, test: null },
                    { text: "Study the symbols first", goto: 40, test: { type: "skill", difficulty: 12 } }
                ]
            },
            19: {
                text: "You find Old Gregor's hut by the mill. He's an ancient man with a long white beard. 'So you seek the castle, eh?' he cackles. 'I'll guide you for 10 gold. Or... you could do me a favor first. My dog's been taken by the forest wolves. Get him back, and I'll guide you for free.'",
                options: [
                    { text: "Pay 10 gold for his services", goto: 41, test: { type: "gold", amount: 10 } },
                    { text: "Accept his quest to find the dog", goto: 42, test: null },
                    { text: "Threaten him into guiding you", goto: 43, test: { type: "skill", difficulty: 11 } },
                    { text: "Leave and go alone", goto: 5, test: null }
                ]
            },
            20: {
                text: "You offer 10 gold for a guide. The bartender thinks, then says: 'My nephew Andrei might do it. He's young but knows the mountains. Wait here.' He returns with a sturdy young man. 'I'll take you to the castle gates for 10 gold,' Andrei says.",
                options: [
                    { text: "Hire Andrei", goto: 44, test: { type: "gold", amount: 10 } },
                    { text: "Change your mind", goto: 5, test: null }
                ]
            },
            21: {
                text: "Success! The bartender tells you everything: 'The forest has three dangers: the wolves at the stream crossing, the bandits at the old mill, and the vampire bats in the caves. The castle has a secret entrance through the catacombs. Here's a silver cross - it might help.' He gives you a silver cross.",
                effect: { item: "silver_cross" },
                options: [
                    { text: "Thank him and leave", goto: 5, test: null }
                ]
            },
            22: {
                text: "You guard the village with Viktor. At midnight, howls echo from the forest. Three WEREWOLVES attack the north gate!",
                options: [
                    { text: "Fight the werewolves", goto: 45, combat: "werewolf_pack" },
                    { text: "Use silver weapons if you have them", goto: 46, test: { type: "item", item: "silver_bullets" } },
                    { text: "Retreat to the guard tower", goto: 47, test: null }
                ]
            },
            23: {
                text: "You take the advance payment (20 gold) and sneak out of the village. But Viktor catches you at the gate! 'Thief!' he shouts. The villagers are angry. Test your Luck to escape.",
                effect: { gold: 20 },
                options: [
                    { text: "Test Luck to escape", goto: 48, test: { type: "luck", difficulty: 12 } },
                    { text: "Fight your way out", goto: 49, combat: "angry_villagers" },
                    { text: "Return the money and apologize", goto: 50, test: null }
                ]
            },
            24: {
                text: "'Equipment, eh?' Viktor says. 'I have a silvered sword, but it's family heirloom. I'll lend it to you if you promise to return it after you kill Dracula.' He shows you a beautifully crafted sword.",
                options: [
                    { text: "Take the silvered sword on loan", goto: 51, test: null },
                    { text: "Prefer the gold payment", goto: 9, test: null }
                ]
            },
            25: {
                text: "'The castle...' the man whispers. 'They say it has a thousand rooms and a hundred traps. The Count sleeps in a crypt deep below. You'll need more than courage to reach him.' He offers you a vial of holy water for 5 gold.",
                options: [
                    { text: "Buy the holy water", goto: 52, test: { type: "gold", amount: 5 } },
                    { text: "Ask about weaknesses", goto: 53, test: null },
                    { text: "Leave for the forest", goto: 5, test: null }
                ]
            },
            26: {
                text: "The drinking contest begins! Roll 2D6 and add your Stamina. If total is 14 or more, you win!",
                options: [
                    { text: "Roll for drinking contest", goto: 54, test: { type: "skill", target: function() { return gameState.stats.stamina + 5; } } },
                    { text: "Forfeit early", goto: 55, test: null }
                ]
            },
            27: {
                text: "VAMPIRE MINION attacks! Skill 8, Stamina 10. It hisses, revealing fangs!",
                combat: {
                    enemy: "vampire_minion",
                    skill: 8,
                    stamina: 10,
                    damage: "2d6+1",
                    weakness: "holy",
                    loot: ["vampire_dust", "gold_coins"],
                    escape: 4
                }
            },
            28: {
                text: "You throw holy water at the vampire! It screams as the blessed liquid burns its flesh. The creature retreats out the window. You survive the night.",
                options: [
                    { text: "Head to the forest at dawn", goto: 5, test: null }
                ]
            },
            29: {
                text: "You leap out the window! You land hard but survive. Running through the village, you reach the forest edge. Behind you, you hear inhuman howls. You escaped, but lost some gear in your room.",
                effect: { stamina: -2 },
                options: [
                    { text: "Continue into the forest", goto: 5, test: null }
                ]
            },
            30: {
                text: "GHOUL attacks! Skill 7, Stamina 8. The undead creature claws at you!",
                combat: {
                    enemy: "ghoul",
                    skill: 7,
                    stamina: 8,
                    damage: "2d6",
                    weakness: "holy",
                    loot: ["rotten_cloth"],
                    escape: 3
                }
            },
            31: {
                text: "You hold up your holy symbol! The ghoul hisses and retreats. It disappears into the night. You survive unharmed.",
                options: [
                    { text: "Head to the forest at dawn", goto: 5, test: null }
                ]
            },
            32: {
                text: "You buy the garlic infusion. 'Drink this before sleeping - it'll keep the creatures away,' the bartender says. You return to your room and drink it. The night passes peacefully. In the morning, you feel refreshed.",
                effect: { item: "garlic_infusion", gold: -3, stamina: 2 },
                options: [
                    { text: "Head to the forest", goto: 5, test: null }
                ]
            },
            33: {
                text: "Under the bridge, you find a skeleton clutching a silver dagger! You also find a pouch with 15 gold. But as you reach for it, you hear growling behind you. Two WOLVES have caught your scent!",
                effect: { items: ["silver_dagger2", "gold_pouch"], gold: 15 },
                options: [
                    { text: "Fight the wolves", goto: 56, combat: "wolf_pair" },
                    { text: "Try to scare them off with fire", goto: 57, test: { type: "skill", difficulty: 9 } },
                    { text: "Jump into the stream to escape", goto: 58, test: { type: "skill", difficulty: 8 } }
                ]
            },
            34: {
                text: "You continue along the path. The forest grows darker as night deepens. You hear something moving in the bushes. Suddenly, BANDITS jump out! 'Your money or your life!' their leader demands.",
                options: [
                    { text: "Fight the bandits", goto: 59, combat: "forest_bandits" },
                    { text: "Pay them 10 gold to pass", goto: 60, test: { type: "gold", amount: 10 } },
                    { text: "Try to negotiate", goto: 61, test: { type: "skill", difficulty: 10 } },
                    { text: "Run back the way you came", goto: 62, test: { type: "skill", difficulty: 11 } }
                ]
            },
            35: {
                text: "You drink from the stream. The water is cool and refreshing. Gain 2 Stamina. But as you drink, you notice bones in the water upstream. Test your Luck.",
                effect: { stamina: 2 },
                options: [
                    { text: "Test Luck", goto: 63, test: { type: "luck", difficulty: 8 } },
                    { text: "Continue along the path", goto: 34, test: null }
                ]
            },
            36: {
                text: "You set up camp for the night. As you build a fire, you hear howling in the distance. The fire keeps predators away. In the morning, you're rested. Gain 4 Stamina.",
                effect: { stamina: 4 },
                options: [
                    { text: "Continue along the path", goto: 34, test: null }
                ]
            },
            37: {
                text: "You carefully climb the rocky ridge. Halfway up, a rock gives way beneath your foot! Test your Skill to avoid falling.",
                options: [
                    { text: "Test Skill to avoid fall", goto: 64, test: { type: "skill", difficulty: 9 } },
                    { text: "Use climbing gear if you have it", goto: 65, test: { type: "item", item: "climbing_gear" } }
                ]
            },
            38: {
                text: "You use your rope to secure yourself as you climb. The ascent is still difficult but manageable. You reach the top of the ridge just as the sun sets. Below, you can see Dracula's castle in the distance!",
                options: [
                    { text: "Continue toward the castle", goto: 66, test: null },
                    { text: "Make camp for the night", goto: 67, test: null }
                ]
            },
            39: {
                text: "You take the hidden path. The symbols on the trees seem to glow in the moonlight. After an hour, the path leads to a clearing with a stone altar. On the altar lies an ancient book. Do you:",
                options: [
                    { text: "Take the book", goto: 68, test: null },
                    { text: "Ignore it and continue", goto: 69, test: null },
                    { text: "Investigate the altar", goto: 70, test: { type: "skill", difficulty: 10 } }
                ]
            },
            40: {
                text: "You study the symbols. They're protective wards against evil! This path was created by vampire hunters long ago. Following it should be safer than the main paths. You continue confidently.",
                options: [
                    { text: "Take the hidden path", goto: 71, test: null }
                ]
            },
            41: {
                text: "You pay Old Gregor 10 gold. 'Good, good,' he says, pocketing the coins. 'Follow me. I know a shortcut through the mountains.' He leads you up a steep trail. After three hours, you reach a vantage point overlooking the castle. 'There it is. The main gate is heavily guarded. But there's a secret entrance through the catacombs. I'll show you.'",
                effect: { gold: -10 },
                options: [
                    { text: "Follow him to the secret entrance", goto: 72, test: null },
                    { text: "Thank him and go alone from here", goto: 73, test: null },
                    { text: "Ask about castle defenses", goto: 74, test: null }
                ]
            },
            42: {
                text: "'My dog Rex was taken by the wolves near the old oak,' Old Gregor says. 'Bring him back alive, and I'll guide you.' You head to the old oak tree. You find wolf tracks and hear growling. Three wolves have the dog cornered!",
                options: [
                    { text: "Fight the wolves to save the dog", goto: 75, combat: "wolf_pack_dog" },
                    { text: "Try to scare the wolves away", goto: 76, test: { type: "skill", difficulty: 11 } },
                    { text: "Use food as distraction", goto: 77, test: { type: "item", item: "provisions" } }
                ]
            },
            43: {
                text: "You threaten Old Gregor with your weapon. 'You'll guide me now, old man!' He looks at you with surprisingly steady eyes. 'You have courage, hunter. But you lack wisdom.' Suddenly, he moves with supernatural speed, disarming you! He's no ordinary old man!",
                options: [
                    { text: "Apize immediately", goto: 78, test: null },
                    { text: "Fight this mysterious figure", goto: 79, combat: "old_gregor" },
                    { text: "Flee back to the village", goto: 1, test: { type: "skill", difficulty: 12 } }
                ]
            },
            44: {
                text: "You hire Andrei as your guide. He's knowledgeable and moves quickly through the forest. After two hours, he stops. 'Listen,' he whispers. You hear flapping wings overhead. GIANT BATS are circling!",
                effect: { gold: -10 },
                options: [
                    { text: "Fight the giant bats", goto: 80, combat: "giant_bats" },
                    { text: "Hide and wait for them to pass", goto: 81, test: { type: "skill", difficulty: 9 } },
                    { text: "Use fire to scare them", goto: 82, test: { type: "item", item: "lantern" } }
                ]
            },
            45: {
                text: "WEREWOLF PACK attacks! Three werewolves with glowing eyes! Skill 9, Stamina 18 total.",
                combat: {
                    enemy: "werewolf_pack",
                    skill: 9,
                    stamina: 18,
                    damage: "2d6+2",
                    weakness: "silver",
                    loot: ["wolf_pelts", "silver_amulet"],
                    escape: 6
                }
            },
            46: {
                text: "You load your weapon with silver bullets. The werewolves hesitate, smelling the silver. You fire, hitting the lead werewolf! It howls in pain and retreats. The others follow. Viktor is impressed. 'You know your business! Here, take this extra ammunition.' He gives you 10 silver bullets.",
                effect: { item: "silver_bullets_extra" },
                options: [
                    { text: "Continue your quest in the morning", goto: 83, test: null }
                ]
            },
            47: {
                text: "You retreat to the guard tower with Viktor. The werewolves can't reach you there. They howl in frustration but eventually leave. At dawn, Viktor pays you the promised 20 gold. 'You're a smart one. Survival beats bravery any day.'",
                effect: { gold: 20 },
                options: [
                    { text: "Head to the forest", goto: 5, test: null }
                ]
            },
            48: {
                text: "You're lucky! You manage to slip past the guards and escape into the forest. But you hear shouts behind you - the villagers will remember your betrayal.",
                options: [
                    { text: "Continue your quest", goto: 5, test: null }
                ]
            },
            49: {
                text: "ANGRY VILLAGERS surround you! Viktor leads them with a pitchfork. Skill 8, Stamina 15.",
                combat: {
                    enemy: "angry_villagers",
                    skill: 8,
                    stamina: 15,
                    damage: "2d6+1",
                    loot: ["villager_gear"],
                    escape: 5
                }
            },
            50: {
                text: "You return the money and apologize. Viktor accepts grudgingly. 'Get out of my village and don't come back.' You're banished but alive.",
                effect: { gold: -20 },
                options: [
                    { text: "Leave for the forest", goto: 5, test: null }
                ]
            },
            51: {
                text: "Viktor lends you his silvered sword. 'This blade has been in my family for generations. It's killed many night creatures. Return it when your quest is done.' The sword feels perfectly balanced in your hand.",
                effect: { item: "silvered_sword" },
                options: [
                    { text: "Begin guard duty", goto: 22, test: null },
                    { text: "Take the sword and leave immediately", goto: 84, test: { type: "luck", difficulty: 14 } }
                ]
            },
            52: {
                text: "You buy the holy water. 'Blessed by the Archbishop himself,' the man says. 'It'll burn any undead creature.' You now have an extra vial of holy water.",
                effect: { item: "holy_water2", gold: -5 },
                options: [
                    { text: "Accept guard job", goto: 9, test: null },
                    { text: "Head to the forest", goto: 5, test: null }
                ]
            },
            53: {
                text: "'Dracula's weaknesses?' the man thinks. 'Sunlight, of course. Holy symbols repel him. Garlic makes him weak. A wooden stake through the heart kills him. But getting close enough... that's the hard part.'",
                options: [
                    { text: "Buy holy water", goto: 52, test: { type: "gold", amount: 5 } },
                    { text: "Ask about the castle layout", goto: 85, test: null },
                    { text: "Leave for the forest", goto: 5, test: null }
                ]
            },
            54: {
                text: "The drinking contest is intense! You and the village champion drink mug after mug. Finally, he slumps over the table unconscious. You win! The villagers cheer and give you 10 gold as prize.",
                effect: { stamina: -4, gold: 10 },
                options: [
                    { text: "Take a room for the night", goto: 4, test: null },
                    { text: "Head out immediately", goto: 5, test: null }
                ]
            },
            55: {
                text: "You forfeit after three mugs. The villagers laugh good-naturedly. 'Not bad for an outsider!' one says. You've made some friends in the village.",
                options: [
                    { text: "Take a room", goto: 4, test: null },
                    { text: "Ask about the castle", goto: 2, test: null }
                ]
            },
            56: {
                text: "WOLF PAIR attacks! Two hungry forest wolves. Skill 7, Stamina 12 total.",
                combat: {
                    enemy: "wolf_pair",
                    skill: 7,
                    stamina: 12,
                    damage: "2d6",
                    loot: ["wolf_teeth", "meat"],
                    escape: 4
                }
            },
            57: {
                text: "You quickly light a torch from your lantern. The wolves fear the fire and back away, allowing you to escape. You continue along the stream path.",
                options: [
                    { text: "Continue your journey", goto: 34, test: null }
                ]
            },
            58: {
                text: "You jump into the stream and swim downstream. The wolves can't follow. You emerge cold and wet on the opposite bank. Lose 1 Stamina from the cold.",
                effect: { stamina: -1 },
                options: [
                    { text: "Continue your journey", goto: 86, test: null }
                ]
            },
            59: {
                text: "FOREST BANDITS attack! Three desperate men armed with knives and clubs. Skill 8, Stamina 15 total.",
                combat: {
                    enemy: "forest_bandits",
                    skill: 8,
                    stamina: 15,
                    damage: "2d6+1",
                    loot: ["bandit_gold", "rusty_knife"],
                    escape: 5
                }
            },
            60: {
                text: "You pay the bandits 10 gold. 'Smart move,' the leader says. 'Safe travels.' They let you pass. You continue along the path, poorer but unharmed.",
                effect: { gold: -10 },
                options: [
                    { text: "Continue", goto: 87, test: null }
                ]
            },
            61: {
                text: "'I'm heading to the castle to kill Dracula,' you say. 'Help me, and there will be reward enough for all.' The bandits laugh. 'Dracula? You're either brave or mad.' But they respect your courage and let you pass.",
                options: [
                    { text: "Continue your journey", goto: 87, test: null }
                ]
            },
            62: {
                text: "You turn and run! The bandits give chase but you're faster. You lose them in the thick forest. When you stop to catch your breath, you realize you're lost.",
                options: [
                    { text: "Try to find your way", goto: 88, test: { type: "skill", difficulty: 10 } },
                    { text: "Climb a tree to get bearings", goto: 89, test: null }
                ]
            },
            63: {
                text: "You're lucky! The bones are just from a deer killed by wolves. No immediate danger. You continue along the path.",
                options: [
                    { text: "Continue", goto: 34, test: null }
                ]
            },
            64: {
                text: "You slip! Rocks tumble down the mountain as you fall 10 feet. You land hard, losing 3 Stamina. If you survive, you decide to take the stream path instead.",
                effect: { stamina: -3 },
                options: [
                    { text: "Take the stream path", goto: 16, test: null }
                ]
            },
            65: {
                text: "Your climbing gear saves you! You secure yourself and continue climbing safely. You reach the top of the ridge.",
                options: [
                    { text: "Continue toward the castle", goto: 66, test: null }
                ]
            },
            66: {
                text: "You continue toward the castle. As night falls, you reach the mountain pass that leads to Castle Dracula. The massive structure looms ahead, silhouetted against the blood-red moon. A single bridge leads to the main gate, guarded by two stone gargoyles that seem to watch you. Do you:",
                options: [
                    { text: "Approach the main gate directly", goto: 90, test: null },
                    { text: "Look for a secret entrance", goto: 91, test: { type: "skill", difficulty: 11 } },
                    { text: "Wait until daylight to approach", goto: 92, test: null },
                    { text: "Circle around to the back of the castle", goto: 93, test: { type: "skill", difficulty: 10 } }
                ]
            },
            67: {
                text: "You make camp for the night. The mountain air is cold. As you sleep, you have nightmares of fanged creatures and blood. You wake feeling drained. Lose 2 Stamina.",
                effect: { stamina: -2 },
                options: [
                    { text: "Continue to the castle", goto: 66, test: null }
                ]
            },
            68: {
                text: "You take the ancient book. As you touch it, a ghostly figure appears! 'I am Brother Marcus, a vampire hunter from ages past. This book contains knowledge of Dracula's weaknesses. Take it and use it well.' The ghost vanishes. You now have the Hunter's Tome.",
                effect: { item: "hunters_tome" },
                options: [
                    { text: "Continue along the hidden path", goto: 71, test: null }
                ]
            },
            69: {
                text: "You leave the book untouched and continue. The hidden path leads safely through the forest and up into the mountains. You've avoided many dangers.",
                options: [
                    { text: "Continue toward the castle", goto: 94, test: null }
                ]
            },
            70: {
                text: "You investigate the altar. Beneath it, you find a hidden compartment containing a silver cross and three silver arrows. These will be useful against undead!",
                effect: { items: ["silver_cross2", "silver_arrows"] },
                options: [
                    { text: "Continue along the hidden path", goto: 71, test: null }
                ]
            },
            71: {
                text: "The hidden path leads you safely through the forest and up into the mountains. You encounter no dangers along the way. As you reach the mountain pass, you see Castle Dracula ahead.",
                options: [
                    { text: "Approach the castle", goto: 66, test: null }
                ]
            },
            72: {
                text: "Old Gregor leads you to a hidden cave entrance. 'This leads to the catacombs beneath the castle,' he whispers. 'It's dangerous, but it's your best chance to enter unseen. Good luck, hunter. I'll wait here for three days. If you don't return...' He doesn't finish the sentence.",
                options: [
                    { text: "Enter the catacombs", goto: 95, test: null },
                    { text: "Ask Gregor to come with you", goto: 96, test: null },
                    { text: "Thank him and find your own way", goto: 66, test: null }
                ]
            },
            73: {
                text: "'Thank you for your help, Gregor,' you say. 'I'll continue alone from here.' The old man nods. 'May God protect you.' You continue toward the castle.",
                options: [
                    { text: "Approach the castle", goto: 66, test: null }
                ]
            },
            74: {
                text: "'The castle's defenses,' Gregor says. 'The main gate is guarded day and night by vampire spawn. The walls are too high to climb. Inside, there are traps, secret passages, and of course, Dracula's brides and minions. Your best chance is surprise.'",
                options: [
                    { text: "Follow him to the secret entrance", goto: 72, test: null },
                    { text: "Go your own way", goto: 66, test: null }
                ]
            },
            75: {
                text: "You fight the wolves to save Gregor's dog! WOLF PACK with dog defends. Skill 8, Stamina 14.",
                combat: {
                    enemy: "wolf_pack_dog",
                    skill: 8,
                    stamina: 14,
                    damage: "2d6+1",
                    loot: ["saved_dog"],
                    escape: 4
                }
            },
            76: {
                text: "You shout and wave your arms, trying to scare the wolves away. Test your Skill to intimidate them.",
                options: [
                    { text: "Test Skill to scare wolves", goto: 97, test: { type: "skill", difficulty: 11 } },
                    { text: "Attack them instead", goto: 75, combat: "wolf_pack_dog" }
                ]
            },
            77: {
                text: "You throw some of your provisions to distract the wolves. They go for the food, allowing you to grab the dog and escape! You return to Gregor with his beloved pet.",
                effect: { item: "saved_dog" },
                options: [
                    { text: "Return to Gregor", goto: 98, test: null }
                ]
            },
            78: {
                text: "You drop your weapon and apologize. 'Wise choice,' Gregor says. 'Anger clouds judgment. I will guide you, not because you threatened me, but because the world needs hunters with both courage and wisdom.'",
                options: [
                    { text: "Follow him gratefully", goto: 72, test: null }
                ]
            },
            79: {
                text: "OLD GREGOR reveals himself! He's not human! Skill 12, Stamina 16. He moves with supernatural speed!",
                combat: {
                    enemy: "old_gregor",
                    skill: 12,
                    stamina: 16,
                    damage: "2d6+3",
                    special: "vampire",
                    loot: ["ancient_amulet"],
                    escape: 8
                }
            },
            80: {
                text: "GIANT BATS attack! These are no ordinary bats - they're the size of eagles with sharp fangs! Skill 7, Stamina 12.",
                combat: {
                    enemy: "giant_bats",
                    skill: 7,
                    stamina: 12,
                    damage: "2d6",
                    special: "flying",
                    loot: ["bat_wings"],
                    escape: 5
                }
            },
            81: {
                text: "You and Andrei hide under some thick bushes. The bats fly overhead but don't see you. After they pass, you continue safely.",
                options: [
                    { text: "Continue toward the castle", goto: 99, test: null }
                ]
            },
            82: {
                text: "You light your lantern and wave it around. The bats fear the fire and fly away. Andrei is impressed. 'Good thinking!'",
                options: [
                    { text: "Continue toward the castle", goto: 99, test: null }
                ]
            },
            83: {
                text: "After the werewolf attack, Viktor gives you the promised 20 gold. 'You earned it,' he says. 'Now go kill Dracula and free us from this curse.' At dawn, you head for the forest.",
                effect: { gold: 20 },
                options: [
                    { text: "Head to the forest", goto: 5, test: null }
                ]
            },
            84: {
                text: "You take Viktor's silvered sword and sneak out of the village. It feels wrong to betray his trust, but the sword could mean the difference between life and death against Dracula. You reach the forest unseen.",
                options: [
                    { text: "Continue your quest", goto: 5, test: null }
                ]
            },
            85: {
                text: "'The castle has four towers,' the man continues. 'The west tower is where Dracula's brides stay. The east tower has the library. The north tower is the highest - they say Dracula sleeps in the crypt beneath it. The south tower is collapsed.'",
                options: [
                    { text: "Buy holy water", goto: 52, test: { type: "gold", amount: 5 } },
                    { text: "Accept guard job", goto: 9, test: null },
                    { text: "Head to the forest", goto: 5, test: null }
                ]
            },
            86: {
                text: "You emerge from the stream on the opposite bank. You're wet and cold but alive. The forest path continues ahead.",
                options: [
                    { text: "Continue along the path", goto: 34, test: null }
                ]
            },
            87: {
                text: "You continue along the forest path. As night falls, you reach the foothills of the Carpathian Mountains. Castle Dracula is visible in the distance, silhouetted against the rising moon.",
                options: [
                    { text: "Continue toward the castle", goto: 66, test: null }
                ]
            },
            88: {
                text: "You try to find your way but the forest looks the same in every direction. You're hopelessly lost. After hours of wandering, you stumble upon a clearing with a small hut. An old woman sits outside, stirring a cauldron.",
                options: [
                    { text: "Approach the woman", goto: 100, test: null },
                    { text: "Avoid her and keep trying to find your way", goto: 101, test: { type: "luck", difficulty: 9 } }
                ]
            },
            89: {
                text: "You climb a tall tree to get your bearings. From the top, you can see the mountains to the north and smoke from the village to the south. You orient yourself and continue toward the mountains.",
                options: [
                    { text: "Continue toward the castle", goto: 66, test: null }
                ]
            },
            90: {
                text: "You approach the main gate boldly. As you cross the bridge, the stone gargoyles come to life! 'Who dares approach the master's domain?' one hisses. They're GUARDIAN GARGOYLES!",
                options: [
                    { text: "Fight the gargoyles", goto: 102, combat: "guardian_gargoyles" },
                    { text: "Try to reason with them", goto: 103, test: { type: "skill", difficulty: 13 } },
                    { text: "Use a holy symbol if you have one", goto: 104, test: { type: "item", item: "holy_symbol" } },
                    { text: "Retreat and find another way", goto: 91, test: null }
                ]
            },
            91: {
                text: "You search for a secret entrance. Circling the castle walls, you find a drainage grate that's loose. It leads to the castle sewers. The smell is terrible, but it's a way inside.",
                options: [
                    { text: "Enter through the sewers", goto: 105, test: null },
                    { text: "Keep looking for a better entrance", goto: 106, test: { type: "skill", difficulty: 12 } }
                ]
            },
            92: {
                text: "You wait until daylight to approach. Vampires are weakest during the day. At dawn, you cross the bridge. The gargoyles are inert stone again. The main gate is locked but unguarded. Do you:",
                options: [
                    { text: "Try to pick the lock", goto: 107, test: { type: "skill", difficulty: 11 } },
                    { text: "Break down the gate", goto: 108, test: { type: "stamina", difficulty: 16 } },
                    { text: "Look for another entrance", goto: 91, test: null }
                ]
            },
            93: {
                text: "You circle around to the back of the castle. Here, the walls have crumbled in places. You find a section where you could climb up to a window. Test your Skill to climb.",
                options: [
                    { text: "Test Skill to climb the wall", goto: 109, test: { type: "skill", difficulty: 10 } },
                    { text: "Use climbing gear if you have it", goto: 110, test: { type: "item", item: "climbing_gear" } },
                    { text: "Go back to the front", goto: 90, test: null }
                ]
            },
            94: {
                text: "You continue toward the castle. The hidden path has brought you safely through the mountains. You now stand before Castle Dracula. The main gate is ahead, guarded by stone gargoyles.",
                options: [
                    { text: "Approach the main gate", goto: 90, test: null },
                    { text: "Look for another entrance", goto: 91, test: null }
                ]
            },
            95: {
                text: "You enter the catacombs. The air is cold and damp. Torches line the walls, burning with eerie blue flames. The tunnels twist and turn. You come to a junction with three passages. Which do you take?",
                options: [
                    { text: "Left passage (smells of earth)", goto: 111, test: null },
                    { text: "Center passage (echoes with dripping water)", goto: 112, test: null },
                    { text: "Right passage (feels warmer)", goto: 113, test: null },
                    { text: "Mark your path and explore systematically", goto: 114, test: { type: "skill", difficulty: 10 } }
                ]
            },
            96: {
                text: "'Come with me, Gregor,' you say. 'Your knowledge could save my life.' The old man shakes his head. 'My hunting days are over. But take this.' He gives you a small silver whistle. 'Blow it if you're in dire need. It summons help of a kind.'",
                effect: { item: "silver_whistle" },
                options: [
                    { text: "Enter the catacombs alone", goto: 95, test: null }
                ]
            },
            97: {
                text: "You succeed in scaring the wolves away! They run off into the forest. The dog, Rex, runs to you gratefully. You return him to Old Gregor.",
                effect: { item: "saved_dog" },
                options: [
                    { text: "Return to Gregor", goto: 98, test: null }
                ]
            },
            98: {
                text: "You return Rex to Old Gregor. The old man weeps with joy. 'Thank you, hunter! As promised, I'll guide you to the castle. And take this - it belonged to my son, also a vampire hunter.' He gives you a silver-inlaid dagger.",
                effect: { item: "silver_inlaid_dagger" },
                options: [
                    { text: "Follow Gregor to the castle", goto: 72, test: null }
                ]
            },
            99: {
                text: "Andrei leads you safely to the mountain pass. 'There it is,' he says, pointing to Castle Dracula. 'I can go no further. Good luck, hunter. May God be with you.' He returns to the village.",
                options: [
                    { text: "Approach the castle", goto: 66, test: null }
                ]
            },
            100: {
                text: "'Lost, are you?' the old woman cackles. 'I can help you find your way... for a price. I need wolfsbane from the north ridge. Bring it to me, and I'll give you directions and a protective charm.'",
                options: [
                    { text: "Accept her quest", goto: 115, test: null },
                    { text: "Refuse and try to find your own way", goto: 101, test: { type: "skill", difficulty: 9 } },
                    { text: "Threaten her for directions", goto: 116, test: { type: "skill", difficulty: 10 } }
                ]
            },
            101: {
                text: "You wander for hours more. Finally, as night falls, you stumble upon a familiar landmark - the stream with the stone bridge! You've found your way back to the main path.",
                options: [
                    { text: "Continue along the stream path", goto: 34, test: null }
                ]
            },
            102: {
                text: "GUARDIAN GARGOYLES attack! Two stone creatures come to life! Skill 10, Stamina 16.",
                combat: {
                    enemy: "guardian_gargoyles",
                    skill: 10,
                    stamina: 16,
                    damage: "2d6+2",
                    special: "stone_skin",
                    loot: ["gargoyle_shard"],
                    escape: 6
                }
            },
            103: {
                text: "'I come to end Dracula's reign of terror,' you declare. The gargoyles consider this. 'Many have tried. All have failed. But... you have courage. We will let you pass. The master is in the north tower crypt.'",
                options: [
                    { text: "Enter the castle", goto: 117, test: null }
                ]
            },
            104: {
                text: "You hold up your holy symbol. The gargoyles hiss and retreat. 'The symbol of the cross! Pass, then, but know the master awaits you.' They return to stone.",
                options: [
                    { text: "Enter the castle", goto: 117, test: null }
                ]
            },
            105: {
                text: "You squeeze through the drainage grate into the castle sewers. The stench is overwhelming. You wade through knee-deep water. Suddenly, something brushes against your leg! A SEWER CREATURE attacks!",
                options: [
                    { text: "Fight the sewer creature", goto: 118, combat: "sewer_creature" },
                    { text: "Try to avoid it and move quickly", goto: 119, test: { type: "skill", difficulty: 9 } },
                    { text: "Use a light to scare it", goto: 120, test: { type: "item", item: "lantern" } }
                ]
            },
            106: {
                text: "You keep looking and find a servant's entrance near the kitchens. The door is unlocked! You slip inside silently. You're in the castle!",
                options: [
                    { text: "Explore the kitchens", goto: 121, test: null },
                    { text: "Head toward the main hall", goto: 122, test: null },
                    { text: "Look for stairs going down", goto: 123, test: null }
                ]
            },
            107: {
                text: "You try to pick the massive lock. It's ancient but well-made. Test your Skill.",
                options: [
                    { text: "Test Skill to pick the lock", goto: 124, test: { type: "skill", difficulty: 11 } },
                    { text: "Use thieves' tools if you have them", goto: 125, test: { type: "item", item: "thieves_tools" } },
                    { text: "Try another approach", goto: 91, test: null }
                ]
            },
            108: {
                text: "You put your shoulder to the gate and push with all your might. The ancient wood groans but holds. Test your Stamina to break it down.",
                options: [
                    { text: "Test Stamina to break gate", goto: 126, test: { type: "stamina", difficulty: 16 } },
                    { text: "Give up and try another way", goto: 91, test: null }
                ]
            },
            109: {
                text: "You climb the crumbling wall. Stones come loose in your hands! Test your Skill to avoid falling.",
                options: [
                    { text: "Test Skill to climb safely", goto: 127, test: { type: "skill", difficulty: 10 } },
                    { text: "Use rope to secure yourself", goto: 128, test: { type: "item", item: "rope" } }
                ]
            },
            110: {
                text: "You use your climbing gear to scale the wall safely. You reach a second-story window and climb inside. You're in a dusty bedroom.",
                options: [
                    { text: "Explore the bedroom", goto: 129, test: null },
                    { text: "Head out into the hallway", goto: 130, test: null }
                ]
            },
            111: {
                text: "You take the left passage. It leads to a burial chamber filled with ancient coffins. One coffin lid slowly opens... A VAMPIRE RISES!",
                options: [
                    { text: "Fight the vampire", goto: 131, combat: "ancient_vampire" },
                    { text: "Use holy water", goto: 132, test: { type: "item", item: "holy_water" } },
                    { text: "Run back the way you came", goto: 133, test: { type: "skill", difficulty: 11 } }
                ]
            },
            112: {
                text: "You take the center passage. It leads to an underground stream. A boat is tied to a small dock. A sign says 'To the castle dungeon.' Do you:",
                options: [
                    { text: "Take the boat", goto: 134, test: null },
                    { text: "Continue on foot along the stream", goto: 135, test: null },
                    { text: "Go back and try another passage", goto: 95, test: null }
                ]
            },
            113: {
                text: "You take the right passage. It grows warmer as you go. You reach a door with a red-hot handle. The door is locked. Do you:",
                options: [
                    { text: "Try to open it anyway", goto: 136, test: { type: "stamina", difficulty: 14 } },
                    { text: "Look for another way around", goto: 137, test: { type: "skill", difficulty: 10 } },
                    { text: "Go back", goto: 95, test: null }
                ]
            },
            114: {
                text: "You mark your path with chalk and explore systematically. You find a map carved into the wall showing the catacombs! Now you can navigate safely. The map shows a direct route to the castle dungeon.",
                effect: { item: "catacomb_map" },
                options: [
                    { text: "Follow the map to the dungeon", goto: 138, test: null }
                ]
            },
            115: {
                text: "You accept the old woman's quest. She directs you to the north ridge where wolfsbane grows. The climb is difficult. Test your Skill to reach it.",
                options: [
                    { text: "Test Skill to climb the ridge", goto: 139, test: { type: "skill", difficulty: 10 } },
                    { text: "Use climbing gear", goto: 140, test: { type: "item", item: "climbing_gear" } }
                ]
            },
            116: {
                text: "You threaten the old woman. She laughs. 'Foolish child!' She throws a powder in your face. You fall unconscious. When you wake, you're back at the village tavern with a headache and no memory of how you got there.",
                effect: { stamina: -3 },
                options: [
                    { text: "Start over", goto: 1, test: null }
                ]
            },
            117: {
                text: "You enter the castle's main hall. It's vast and empty, lit by torches. Staircases lead up and down. Portraits of pale, aristocratic figures line the walls. Their eyes seem to follow you. Do you:",
                options: [
                    { text: "Go upstairs", goto: 141, test: null },
                    { text: "Go downstairs", goto: 142, test: null },
                    { text: "Search the main hall", goto: 143, test: null },
                    { text: "Follow the sound of music", goto: 144, test: null }
                ]
            },
            118: {
                text: "SEWER CREATURE attacks! A slimy, eel-like monster! Skill 8, Stamina 10.",
                combat: {
                    enemy: "sewer_creature",
                    skill: 8,
                    stamina: 10,
                    damage: "2d6+1",
                    special: "slimy",
                    loot: ["monster_gland"],
                    escape: 4
                }
            },
            119: {
                text: "You move quickly through the water, avoiding the creature. You reach a ladder leading up to a trapdoor. You climb up and find yourself in the castle pantry.",
                options: [
                    { text: "Explore the pantry", goto: 145, test: null }
                ]
            },
            120: {
                text: "You light your lantern. The creature hates the light and retreats into the shadows. You proceed safely to a ladder leading up.",
                options: [
                    { text: "Climb the ladder", goto: 145, test: null }
                ]
            },
            121: {
                text: "The kitchens are empty but recently used. A fire smolders in the hearth. A door leads to a pantry, another to a hallway. On a table, you find a silver knife. Take it?",
                options: [
                    { text: "Take the silver knife", goto: 146, test: null },
                    { text: "Leave it and go to the hallway", goto: 147, test: null },
                    { text: "Check the pantry", goto: 145, test: null }
                ]
            },
            122: {
                text: "You head toward the main hall. As you approach, you hear voices. Peering around a corner, you see two VAMPIRE BRIDES talking. 'The master awaits his new guest,' one says. 'The hunter has entered the castle.'",
                options: [
                    { text: "Attack the vampire brides", goto: 148, combat: "vampire_brides" },
                    { text: "Listen to their conversation", goto: 149, test: { type: "skill", difficulty: 9 } },
                    { text: "Sneak past them", goto: 150, test: { type: "skill", difficulty: 11 } }
                ]
            },
            123: {
                text: "You look for stairs going down. You find a spiral staircase descending into darkness. Torches in iron sconces provide dim light. You descend to the castle dungeon.",
                options: [
                    { text: "Explore the dungeon", goto: 151, test: null }
                ]
            },
            124: {
                text: "You successfully pick the lock! The massive gate creaks open. You enter the castle courtyard. Ahead lies the main keep.",
                options: [
                    { text: "Enter the main keep", goto: 117, test: null }
                ]
            },
            125: {
                text: "Your thieves' tools make quick work of the lock. The gate opens. You enter the castle courtyard.",
                options: [
                    { text: "Enter the main keep", goto: 117, test: null }
                ]
            },
            126: {
                text: "With a mighty heave, you break the gate! It splinters inward. You've made a tremendous noise - every creature in the castle now knows you're here. But you're inside.",
                options: [
                    { text: "Enter the main keep", goto: 152, test: null }
                ]
            },
            127: {
                text: "You climb carefully, testing each handhold. You reach the window and climb inside. You're in a dusty bedroom.",
                options: [
                    { text: "Explore the bedroom", goto: 129, test: null }
                ]
            },
            128: {
                text: "You secure yourself with rope and climb safely. You reach the window and enter a bedroom.",
                options: [
                    { text: "Explore the bedroom", goto: 129, test: null }
                ]
            },
            129: {
                text: "The bedroom is lavish but covered in dust. A four-poster bed with velvet curtains dominates the room. A writing desk holds a journal. Do you:",
                options: [
                    { text: "Read the journal", goto: 153, test: null },
                    { text: "Search the room for useful items", goto: 154, test: { type: "skill", difficulty: 9 } },
                    { text: "Leave the room", goto: 130, test: null }
                ]
            },
            130: {
                text: "You enter a hallway lined with portraits. The eyes in the paintings seem to follow you. At the end of the hall, a staircase leads down. You also see a door marked 'Library.'",
                options: [
                    { text: "Go downstairs", goto: 142, test: null },
                    { text: "Enter the library", goto: 155, test: null },
                    { text: "Continue down the hallway", goto: 156, test: null }
                ]
            },
            131: {
                text: "ANCIENT VAMPIRE attacks! This one is older and stronger than the minions. Skill 11, Stamina 14.",
                combat: {
                    enemy: "ancient_vampire",
                    skill: 11,
                    stamina: 14,
                    damage: "2d6+2",
                    special: "blood_drain",
                    loot: ["vampire_ring", "ancient_key"],
                    escape: 6
                }
            },
            132: {
                text: "You throw holy water at the vampire. It screams and dissolves into dust! On the coffin, you find a silver ring and a key.",
                effect: { items: ["vampire_ring", "ancient_key"] },
                options: [
                    { text: "Continue through the catacombs", goto: 157, test: null }
                ]
            },
            133: {
                text: "You run back to the junction. The vampire doesn't follow - it can't leave its coffin until full dark. You're safe for now.",
                options: [
                    { text: "Try another passage", goto: 95, test: null }
                ]
            },
            134: {
                text: "You take the boat. It drifts silently down the underground stream. After ten minutes, you reach a dock in the castle dungeon. You tie up the boat and climb out.",
                options: [
                    { text: "Explore the dungeon", goto: 151, test: null }
                ]
            },
            135: {
                text: "You follow the stream on foot. The path is slippery. Test your Skill to avoid falling in.",
                options: [
                    { text: "Test Skill to navigate safely", goto: 158, test: { type: "skill", difficulty: 9 } },
                    { text: "Go back and take the boat", goto: 134, test: null }
                ]
            },
            136: {
                text: "You grab the red-hot handle! The pain is excruciating. Lose 4 Stamina. The door opens, revealing a room filled with molten metal and strange machinery. A fire elemental guards the room!",
                effect: { stamina: -4 },
                options: [
                    { text: "Fight the fire elemental", goto: 159, combat: "fire_elemental" },
                    { text: "Close the door and go back", goto: 95, test: null }
                ]
            },
            137: {
                text: "You find a hidden panel beside the door. It opens to reveal a bypass corridor. You slip through and avoid the hot room entirely.",
                options: [
                    { text: "Continue through the catacombs", goto: 157, test: null }
                ]
            },
            138: {
                text: "Following the map, you navigate the catacombs safely. You reach a secret door that leads directly into the castle dungeon. You open it quietly.",
                options: [
                    { text: "Enter the dungeon", goto: 151, test: null }
                ]
            },
            139: {
                text: "You climb the north ridge and find the wolfsbane. You gather some and return to the old woman. 'Well done,' she says. She gives you directions to the castle and a protective charm.",
                effect: { items: ["wolfsbane", "protective_charm"] },
                options: [
                    { text: "Continue to the castle", goto: 66, test: null }
                ]
            },
            140: {
                text: "With your climbing gear, you easily reach the wolfsbane. You return to the old woman who rewards you as promised.",
                effect: { items: ["wolfsbane", "protective_charm"] },
                options: [
                    { text: "Continue to the castle", goto: 66, test: null }
                ]
            },
            141: {
                text: "You go upstairs. The upper floors are quieter. You find a hallway with several doors. One door has a symbol of a bat, another a wolf, and a third a crescent moon.",
                options: [
                    { text: "Enter the bat door", goto: 160, test: null },
                    { text: "Enter the wolf door", goto: 161, test: null },
                    { text: "Enter the moon door", goto: 162, test: null },
                    { text: "Go back downstairs", goto: 142, test: null }
                ]
            },
            142: {
                text: "You go downstairs. The air grows colder. You're in the castle's lower levels. You see three passages: one leads to the dungeon (you hear moaning), one to the catacombs (smells of earth and decay), and one to a wine cellar (smells of wine and damp).",
                options: [
                    { text: "Go to the dungeon", goto: 151, test: null },
                    { text: "Go to the catacombs", goto: 163, test: null },
                    { text: "Go to the wine cellar", goto: 164, test: null },
                    { text: "Go back upstairs", goto: 141, test: null }
                ]
            },
            143: {
                text: "You search the main hall. Behind a tapestry, you find a hidden door! It leads to a secret passage. Do you:",
                options: [
                    { text: "Enter the secret passage", goto: 165, test: null },
                    { text: "Leave it and go upstairs", goto: 141, test: null },
                    { text: "Leave it and go downstairs", goto: 142, test: null }
                ]
            },
            144: {
                text: "You follow the sound of eerie music. It leads you to a grand ballroom. Three VAMPIRE BRIDES are dancing to music from a ghostly orchestra. They haven't noticed you yet.",
                options: [
                    { text: "Attack the brides", goto: 148, combat: "vampire_brides" },
                    { text: "Sneak past them", goto: 166, test: { type: "skill", difficulty: 12 } },
                    { text: "Try to speak with them", goto: 167, test: null }
                ]
            },
            145: {
                text: "The pantry is stocked with food and wine - all untouched by human hands for years, yet still fresh. Vampire magic preserves it. You find a bottle of 'Garlic Wine' - useful against vampires!",
                effect: { item: "garlic_wine" },
                options: [
                    { text: "Leave the pantry", goto: 147, test: null }
                ]
            },
            146: {
                text: "You take the silver knife. It's finely made and will be effective against werewolves and vampires.",
                effect: { item: "silver_knife" },
                options: [
                    { text: "Go to the hallway", goto: 147, test: null }
                ]
            },
            147: {
                text: "You enter a hallway. To the left, stairs lead up. To the right, stairs lead down. Ahead, you hear faint music.",
                options: [
                    { text: "Go upstairs", goto: 141, test: null },
                    { text: "Go downstairs", goto: 142, test: null },
                    { text: "Follow the music", goto: 144, test: null }
                ]
            },
            148: {
                text: "VAMPIRE BRIDES attack! Three of Dracula's consorts. Skill 10, Stamina 18.",
                combat: {
                    enemy: "vampire_brides",
                    skill: 10,
                    stamina: 18,
                    damage: "2d6+2",
                    special: "charm",
                    loot: ["bridal_jewelry", "crypt_key"],
                    escape: 7
                }
            },
            149: {
                text: "You listen to the vampire brides' conversation. 'The master grows impatient,' one says. 'The hunter should have arrived by now.' 'Perhaps he's already in the castle,' another replies. 'We should check the lower levels.' They head downstairs, leaving the main hall empty.",
                options: [
                    { text: "Go upstairs while they're gone", goto: 141, test: null },
                    { text: "Follow them downstairs", goto: 168, test: { type: "skill", difficulty: 10 } }
                ]
            },
            150: {
                text: "You sneak past the vampire brides silently. They continue their conversation, unaware of your presence. You reach the stairs going up.",
                options: [
                    { text: "Go upstairs", goto: 141, test: null }
                ]
            },
            151: {
                text: "The dungeon is dark and foul-smelling. Prisoners moan in cells. Most are dead or dying. At the end of the dungeon, a heavy iron door bears the inscription: 'Here lies the Master's resting place.' This must be Dracula's crypt! The door is locked with three locks.",
                options: [
                    { text: "Try to pick the locks", goto: 169, test: { type: "skill", difficulty: 13 } },
                    { text: "Search for keys", goto: 170, test: null },
                    { text: "Break down the door", goto: 171, test: { type: "stamina", difficulty: 18 } },
                    { text: "Go back", goto: 142, test: null }
                ]
            },
            152: {
                text: "You enter the main keep. Your noisy entrance has alerted everyone. VAMPIRE MINIONS pour into the hall from all directions! You're surrounded!",
                options: [
                    { text: "Fight the vampire minions", goto: 172, combat: "vampire_swarm" },
                    { text: "Try to fight your way to the stairs", goto: 173, test: { type: "skill", difficulty: 14 } },
                    { text: "Use holy water to clear a path", goto: 174, test: { type: "item", item: "holy_water" } }
                ]
            },
            153: {
                text: "The journal belongs to a previous guest of the castle. The last entry reads: 'He has promised me immortality. Tonight I join him. I fear what I will become, but the alternative is death. God forgive me.' The journal is of no practical use but chills you to the bone.",
                options: [
                    { text: "Search the room", goto: 154, test: { type: "skill", difficulty: 9 } },
                    { text: "Leave the room", goto: 130, test: null }
                ]
            },
            154: {
                text: "You search the room thoroughly. Under the mattress, you find a silver crucifix and a vial of clear liquid labeled 'Holy Water.'",
                effect: { items: ["silver_crucifix2", "holy_water3"] },
                options: [
                    { text: "Leave the room", goto: 130, test: null }
                ]
            },
            155: {
                text: "The library is vast, with shelves reaching to the ceiling. Thousands of books fill the room. On a central table, a single book lies open. It's written in Latin but you recognize the word 'Dracula' repeated. Do you:",
                options: [
                    { text: "Study the open book", goto: 175, test: { type: "skill", difficulty: 12 } },
                    { text: "Search for useful books", goto: 176, test: { type: "skill", difficulty: 10 } },
                    { text: "Leave the library", goto: 130, test: null }
                ]
            },
            156: {
                text: "You continue down the hallway. It ends at a balcony overlooking the main hall below. You can see the vampire brides from here. A door to your right is marked 'Observatory.'",
                options: [
                    { text: "Enter the observatory", goto: 177, test: null },
                    { text: "Go back", goto: 130, test: null }
                ]
            },
            157: {
                text: "You continue through the catacombs and find a staircase leading up. It emerges in the castle dungeon, near Dracula's crypt!",
                options: [
                    { text: "Approach the crypt", goto: 151, test: null }
                ]
            },
            158: {
                text: "You slip on the wet stones and fall into the cold water! You're soaked and lose 2 Stamina from the shock. But you eventually reach the dungeon dock.",
                effect: { stamina: -2 },
                options: [
                    { text: "Climb out at the dungeon", goto: 151, test: null }
                ]
            },
            159: {
                text: "FIRE ELEMENTAL attacks! A creature of living flame! Skill 12, Stamina 12.",
                combat: {
                    enemy: "fire_elemental",
                    skill: 12,
                    stamina: 12,
                    damage: "2d6+3",
                    special: "fire",
                    loot: ["fire_crystal"],
                    escape: 5
                }
            },
            160: {
                text: "You enter the bat room. It's a study filled with taxidermied bats and books on vampirism. On the desk, you find a map of the castle with the crypt marked. You also find a silver letter opener.",
                effect: { items: ["castle_map_detailed", "silver_letter_opener"] },
                options: [
                    { text: "Leave the room", goto: 141, test: null }
                ]
            },
            161: {
                text: "You enter the wolf room. It's a trophy room with wolf pelts and werewolf memorabilia. A silver-tipped spear hangs on the wall. Take it?",
                options: [
                    { text: "Take the silver-tipped spear", goto: 178, test: null },
                    { text: "Leave it and exit", goto: 141, test: null }
                ]
            },
            162: {
                text: "You enter the moon room. It's an alchemy laboratory. Potions bubble on tables. Three vials are labeled: Healing, Strength, and Truth. Which do you drink?",
                options: [
                    { text: "Drink Healing (restores Stamina)", goto: 179, test: null },
                    { text: "Drink Strength (+2 Skill temporarily)", goto: 180, test: null },
                    { text: "Drink Truth (reveals secrets)", goto: 181, test: null },
                    { text: "Don't drink any", goto: 141, test: null }
                ]
            },
            163: {
                text: "You enter the catacombs from inside the castle. The air is cold and smells of earth. You see coffins lining the walls. Some are open and empty. A noise comes from ahead - something's moving in the darkness!",
                options: [
                    { text: "Investigate the noise", goto: 182, test: null },
                    { text: "Go back", goto: 142, test: null },
                    { text: "Search the coffins", goto: 183, test: { type: "luck", difficulty: 10 } }
                ]
            },
            164: {
                text: "The wine cellar is filled with barrels and bottles. Most are normal wine, but some are blood-red and labeled in a language you don't recognize. In a corner, you find a trapdoor. It leads down to the catacombs.",
                options: [
                    { text: "Enter the catacombs via trapdoor", goto: 163, test: null },
                    { text: "Take some normal wine", goto: 184, test: null },
                    { text: "Go back", goto: 142, test: null }
                ]
            },
            165: {
                text: "The secret passage is narrow and dark. It leads to a hidden room behind the main hall. The room contains a chest. The chest is locked but not trapped.",
                options: [
                    { text: "Try to open the chest", goto: 185, test: { type: "skill", difficulty: 10 } },
                    { text: "Leave it and go back", goto: 117, test: null }
                ]
            },
            166: {
                text: "You sneak past the dancing vampire brides. They're so engrossed in their dance they don't notice you. You reach a door at the far end of the ballroom.",
                options: [
                    { text: "Open the door", goto: 186, test: null }
                ]
            },
            167: {
                text: "'Greetings, ladies,' you say. The music stops. The brides turn to you with hungry smiles. 'A visitor!' one exclaims. 'The master will be pleased.' They approach you, not with hostility but with curiosity.",
                options: [
                    { text: "Ask them to take you to Dracula", goto: 187, test: null },
                    { text: "Attack them while they're close", goto: 148, combat: "vampire_brides" },
                    { text: "Try to charm them", goto: 188, test: { type: "skill", difficulty: 13 } }
                ]
            },
            168: {
                text: "You follow the vampire brides downstairs silently. They go to the dungeon and stand before Dracula's crypt. 'He sleeps,' one whispers. 'We must not disturb him.' They leave after a few minutes. Now's your chance!",
                options: [
                    { text: "Approach the crypt", goto: 151, test: null }
                ]
            },
            169: {
                text: "You attempt to pick the three locks. They're complex and ancient. Test your Skill.",
                options: [
                    { text: "Test Skill to pick locks", goto: 189, test: { type: "skill", difficulty: 13 } },
                    { text: "Use keys if you have them", goto: 190, test: { type: "item", item: "crypt_key" } }
                ]
            },
            170: {
                text: "You search the dungeon for keys. In the jailer's desk, you find one silver key. The other two must be elsewhere in the castle.",
                effect: { item: "silver_key2" },
                options: [
                    { text: "Search for the other keys", goto: 191, test: null },
                    { text: "Try to pick the remaining locks", goto: 192, test: { type: "skill", difficulty: 11 } }
                ]
            },
            171: {
                text: "You put your shoulder to the heavy iron door and push with all your might. It doesn't budge. This door was built to withstand an army. You'll need another way.",
                options: [
                    { text: "Try another approach", goto: 151, test: null }
                ]
            },
            172: {
                text: "VAMPIRE SWARM attacks! Six vampire minions surround you! Skill 9, Stamina 24.",
                combat: {
                    enemy: "vampire_swarm",
                    skill: 9,
                    stamina: 24,
                    damage: "2d6+1",
                    special: "overwhelm",
                    loot: ["mass_vampire_dust"],
                    escape: 8
                }
            },
            173: {
                text: "You fight your way toward the stairs, taking blows but moving forward. Lose 4 Stamina, but you reach the stairs and escape upstairs!",
                effect: { stamina: -4 },
                options: [
                    { text: "You're on the upper floor", goto: 141, test: null }
                ]
            },
            174: {
                text: "You throw holy water at the vampires in front of you. They scream and fall back, clearing a path to the stairs. You run up before they can recover.",
                options: [
                    { text: "You're on the upper floor", goto: 141, test: null }
                ]
            },
            175: {
                text: "You study the book. Your Latin is good enough to understand it's a history of the Dracula family. The last page describes a ritual to permanently kill a vampire: 'The heart must be pierced with wood from the ash tree that grows in the castle courtyard, then the body burned in sunlight.' This is valuable knowledge!",
                effect: { item: "vampire_knowledge" },
                options: [
                    { text: "Leave the library", goto: 130, test: null }
                ]
            },
            176: {
                text: "You search for useful books. You find 'Bestiary of Night Creatures' which gives you +1 Skill against undead. You also find a book with a silver cross bookmark - take it.",
                effect: { skill: 1, item: "silver_cross_bookmark" },
                options: [
                    { text: "Leave the library", goto: 130, test: null }
                ]
            },
            177: {
                text: "The observatory has a large telescope pointed at the moon. Star charts cover the walls. On a table, you find an astrolabe made of silver. This could be valuable. Take it?",
                options: [
                    { text: "Take the silver astrolabe", goto: 193, test: null },
                    { text: "Leave it and go back", goto: 156, test: null }
                ]
            },
            178: {
                text: "You take the silver-tipped spear. It's heavy but well-balanced. +2 Skill against were-creatures.",
                effect: { item: "silver_tipped_spear" },
                options: [
                    { text: "Leave the room", goto: 141, test: null }
                ]
            },
            179: {
                text: "You drink the Healing potion. It restores 6 Stamina! You feel rejuvenated.",
                effect: { stamina: 6 },
                options: [
                    { text: "Leave the laboratory", goto: 141, test: null }
                ]
            },
            180: {
                text: "You drink the Strength potion. You feel power surge through your muscles! Gain +2 Skill for the next three combats.",
                effect: { skill: 2 },
                options: [
                    { text: "Leave the laboratory", goto: 141, test: null }
                ]
            },
            181: {
                text: "You drink the Truth potion. Your vision shifts - you can now see hidden doors and traps! You notice a secret compartment in the laboratory wall. Inside, you find a wooden stake made of ash wood - perfect for killing vampires!",
                effect: { item: "ash_wood_stake" },
                options: [
                    { text: "Leave the laboratory", goto: 141, test: null }
                ]
            },
            182: {
                text: "You investigate the noise. It's a GHOUL feeding on a recent corpse. It hasn't noticed you yet.",
                options: [
                    { text: "Attack the ghoul", goto: 194, combat: "catacomb_ghoul" },
                    { text: "Sneak past it", goto: 195, test: { type: "skill", difficulty: 9 } },
                    { text: "Go back", goto: 163, test: null }
                ]
            },
            183: {
                text: "You search the coffins. Most contain only dust or bones. But in one, you find a silver medallion and a journal. The journal describes a secret passage from the catacombs to Dracula's crypt!",
                effect: { items: ["silver_medallion", "secret_passage_info"] },
                options: [
                    { text: "Follow the secret passage", goto: 196, test: null }
                ]
            },
            184: {
                text: "You take a bottle of normal wine. It might be useful for bartering or distracting guards.",
                effect: { item: "wine_bottle" },
                options: [
                    { text: "Enter the catacombs", goto: 163, test: null },
                    { text: "Go back", goto: 142, test: null }
                ]
            },
            185: {
                text: "You open the chest! Inside, you find a complete vampire hunter's kit: wooden stakes, holy water, garlic, and a silvered sword! This is exactly what you need!",
                effect: { items: ["wooden_stakes", "holy_water_kit", "garlic_bundle", "silvered_sword2"] },
                options: [
                    { text: "Return to the main hall", goto: 117, test: null }
                ]
            },
            186: {
                text: "You open the door. It leads to a spiral staircase going up. You climb to the highest tower. At the top, you find a room with a large coffin in the center. This must be Dracula's resting place! But it's guarded by his most loyal servant: IGOOR, THE VAMPIRE CHAMPION!",
                options: [
                    { text: "Fight Igor", goto: 197, combat: "igor_vampire_champion" },
                    { text: "Try to sneak past him to the coffin", goto: 198, test: { type: "skill", difficulty: 14 } },
                    { text: "Use holy items to repel him", goto: 199, test: { type: "item", item: "holy_symbol" } }
                ]
            },
            187: {
                text: "'Take me to your master,' you demand. The brides laugh. 'So eager to die?' one says. 'Very well. Follow us.' They lead you through the castle to the highest tower. There, in a room with a large coffin, stands DRACULA himself! He's awake and expecting you!",
                options: [
                    { text: "Face Dracula", goto: 200, combat: "dracula_final" },
                    { text: "Attack now while he's confident", goto: 201, test: null },
                    { text: "Try to use the element of surprise", goto: 202, test: { type: "skill", difficulty: 13 } }
                ]
            },
            188: {
                text: "You attempt to charm the vampire brides. 'Ladies, I mean you no harm. I seek only an audience with your master.' They giggle. 'You're brave, hunter. We'll take you to him.' They lead you to Dracula.",
                options: [
                    { text: "Face Dracula", goto: 200, combat: "dracula_final" }
                ]
            },
            189: {
                text: "You successfully pick the first two locks but the third is beyond your skill. You need a key for the final lock.",
                options: [
                    { text: "Search for the final key", goto: 191, test: null }
                ]
            },
            190: {
                text: "You use your keys to open the crypt door! It creaks open, revealing a stone staircase leading down into darkness. The air grows colder as you descend. At the bottom, you find DRACULA'S COFFIN! He's sleeping! This is your chance!",
                options: [
                    { text: "Stake Dracula in his sleep", goto: 203, test: { type: "skill", difficulty: 12 } },
                    { text: "Wake him and fight honorably", goto: 200, combat: "dracula_final" },
                    { text: "Prepare traps first", goto: 204, test: { type: "skill", difficulty: 11 } }
                ]
            },
            191: {
                text: "You search the castle for the crypt keys. The first key you already have. The second is with the vampire brides (you saw it on one's necklace). The third is in Dracula's study. You'll have to retrieve them.",
                options: [
                    { text: "Go find the brides' key", goto: 205, test: null },
                    { text: "Find Dracula's study", goto: 206, test: null },
                    { text: "Forget the keys and try another way", goto: 207, test: null }
                ]
            },
            192: {
                text: "With one key already, you only need to pick two locks. Test your Skill.",
                options: [
                    { text: "Test Skill to pick two locks", goto: 208, test: { type: "skill", difficulty: 11 } },
                    { text: "Find the other keys instead", goto: 191, test: null }
                ]
            },
            193: {
                text: "You take the silver astrolabe. It's heavy but could be valuable.",
                effect: { item: "silver_astrolabe" },
                options: [
                    { text: "Go back", goto: 156, test: null }
                ]
            },
            194: {
                text: "CATACOMB GHOUL attacks! Skill 8, Stamina 10.",
                combat: {
                    enemy: "catacomb_ghoul",
                    skill: 8,
                    stamina: 10,
                    damage: "2d6+1",
                    weakness: "holy",
                    loot: ["ghoul_claw"],
                    escape: 4
                }
            },
            195: {
                text: "You sneak past the ghoul. It's too engrossed in its meal to notice you. You continue deeper into the catacombs.",
                options: [
                    { text: "Continue", goto: 209, test: null }
                ]
            },
            196: {
                text: "Following the journal's directions, you find the secret passage. It leads directly to Dracula's crypt, bypassing all locks! You enter quietly. Dracula sleeps in his coffin!",
                options: [
                    { text: "Stake Dracula in his sleep", goto: 203, test: { type: "skill", difficulty: 12 } },
                    { text: "Wake him for a fair fight", goto: 200, combat: "dracula_final" }
                ]
            },
            197: {
                text: "IGOR, VAMPIRE CHAMPION attacks! Dracula's most powerful servant. Skill 13, Stamina 20.",
                combat: {
                    enemy: "igor_vampire_champion",
                    skill: 13,
                    stamina: 20,
                    damage: "2d6+3",
                    special: "master_swordsman",
                    loot: ["igor_sword", "crypt_master_key"],
                    escape: 8
                }
            },
            198: {
                text: "You try to sneak past Igor to reach Dracula's coffin. He's vigilant but you might succeed. Test your Skill.",
                options: [
                    { text: "Test Skill to sneak past Igor", goto: 210, test: { type: "skill", difficulty: 14 } },
                    { text: "Fight him instead", goto: 197, combat: "igor_vampire_champion" }
                ]
            },
            199: {
                text: "You hold up your holy symbol. Igor hisses but doesn't retreat. 'Your trinkets don't work on me, hunter. I served the Church before I served the Master.' He attacks anyway!",
                options: [
                    { text: "Fight Igor", goto: 197, combat: "igor_vampire_champion" }
                ]
            },
            200: {
                text: "COUNT DRACULA rises from his coffin! 'So, the hunter has finally arrived,' he says in a voice like velvet and grave dirt. 'I have been expecting you.' The final battle begins!",
                combat: {
                    enemy: "dracula_final",
                    skill: 15,
                    stamina: 25,
                    damage: "2d6+4",
                    special: "vampire_lord",
                    loot: ["dracula_ring", "castle_deed"],
                    escape: 0
                }
            },
            201: {
                text: "You attack Dracula without warning! He's surprised! You get a free strike before the battle begins.",
                options: [
                    { text: "Strike with wooden stake", goto: 211, test: { type: "item", item: "wooden_stake" } },
                    { text: "Strike with silver weapon", goto: 212, test: { type: "item", item: "silvered_sword" } },
                    { text: "Throw holy water", goto: 213, test: { type: "item", item: "holy_water" } }
                ]
            },
            202: {
                text: "You pretend to surrender, then attack when Dracula least expects it! Test your Skill for a surprise attack.",
                options: [
                    { text: "Test Skill for surprise attack", goto: 214, test: { type: "skill", difficulty: 13 } },
                    { text: "Face him directly", goto: 200, combat: "dracula_final" }
                ]
            },
            203: {
                text: "You approach Dracula's sleeping form. He looks peaceful, almost human. You raise your wooden stake over his heart... Test your Skill to strike true.",
                options: [
                    { text: "Test Skill to stake Dracula", goto: 215, test: { type: "skill", difficulty: 12 } },
                    { text: "Hesitate and wake him", goto: 200, combat: "dracula_final" }
                ]
            },
            204: {
                text: "You set traps around the coffin - garlic circles, holy water sprinklers, silver chains. When Dracula rises, he'll be weakened. Then you fight!",
                options: [
                    { text: "Wake Dracula and fight", goto: 216, combat: "dracula_weakened" }
                ]
            },
            205: {
                text: "You find the vampire brides in the ballroom again. One wears a key on a necklace. How to get it?",
                options: [
                    { text: "Fight them for it", goto: 148, combat: "vampire_brides" },
                    { text: "Try to steal it", goto: 217, test: { type: "skill", difficulty: 13 } },
                    { text: "Ask for it", goto: 218, test: null }
                ]
            },
            206: {
                text: "You find Dracula's study. It's filled with books and maps. On the desk, you find the third crypt key! But the study is guarded by a SPECTRAL GUARDIAN!",
                options: [
                    { text: "Fight the spectral guardian", goto: 219, combat: "spectral_guardian" },
                    { text: "Try to grab the key and run", goto: 220, test: { type: "skill", difficulty: 12 } }
                ]
            },
            207: {
                text: "You give up on the keys. There must be another way into the crypt. You remember the catacombs might connect...",
                options: [
                    { text: "Go to the catacombs", goto: 163, test: null }
                ]
            },
            208: {
                text: "You successfully pick the remaining two locks! The crypt door opens! You descend to find Dracula sleeping in his coffin.",
                options: [
                    { text: "Stake Dracula in his sleep", goto: 203, test: { type: "skill", difficulty: 12 } }
                ]
            },
            209: {
                text: "You continue deeper into the catacombs. You find a secret door that leads directly to Dracula's crypt! You open it quietly...",
                options: [
                    { text: "Enter the crypt", goto: 221, test: null }
                ]
            },
            210: {
                text: "You succeed in sneaking past Igor! He doesn't notice you as you approach Dracula's coffin. The Count sleeps within.",
                options: [
                    { text: "Stake Dracula", goto: 203, test: { type: "skill", difficulty: 12 } }
                ]
            },
            211: {
                text: "You drive your wooden stake toward Dracula's heart! But he moves at the last second! The stake grazes his shoulder. He's wounded but not killed. Now he's angry!",
                effect: { enemyStamina: -5 },
                options: [
                    { text: "Continue the fight", goto: 200, combat: "dracula_final" }
                ]
            },
            212: {
                text: "You strike Dracula with your silver weapon! He screams as the blessed metal burns him. He's wounded!",
                effect: { enemyStamina: -8 },
                options: [
                    { text: "Continue the fight", goto: 200, combat: "dracula_final" }
                ]
            },
            213: {
                text: "You throw holy water at Dracula! It burns him like acid! He's seriously wounded!",
                effect: { enemyStamina: -10 },
                options: [
                    { text: "Continue the fight", goto: 200, combat: "dracula_final" }
                ]
            },
            214: {
                text: "Your surprise attack succeeds! You strike Dracula before he can defend himself!",
                effect: { enemyStamina: -6 },
                options: [
                    { text: "Continue the fight", goto: 200, combat: "dracula_final" }
                ]
            },
            215: {
                text: "You drive the wooden stake deep into Dracula's heart! He awakens with a scream, then turns to dust! You've done it! You've killed Dracula!",
                options: [
                    { text: "Claim your victory", goto: 222, test: null }
                ]
            },
            216: {
                text: "DRACULA (WEAKENED) fights! Your traps have weakened him. Skill 13, Stamina 20.",
                combat: {
                    enemy: "dracula_weakened",
                    skill: 13,
                    stamina: 20,
                    damage: "2d6+3",
                    special: "weakened",
                    loot: ["dracula_ring", "castle_deed"],
                    escape: 0
                }
            },
            217: {
                text: "You attempt to steal the key from the vampire bride's necklace. Test your Skill.",
                options: [
                    { text: "Test Skill to steal key", goto: 223, test: { type: "skill", difficulty: 13 } },
                    { text: "Fight them instead", goto: 148, combat: "vampire_brides" }
                ]
            },
            218: {
                text: "'I need that key to reach your master,' you say. The brides laugh. 'You think we would help you kill our beloved?' They attack!",
                options: [
                    { text: "Fight the brides", goto: 148, combat: "vampire_brides" }
                ]
            },
            219: {
                text: "SPECTRAL GUARDIAN attacks! A ghostly knight guards Dracula's study. Skill 11, Stamina 15.",
                combat: {
                    enemy: "spectral_guardian",
                    skill: 11,
                    stamina: 15,
                    damage: "2d6+2",
                    special: "incorporeal",
                    loot: ["ghostly_key", "ancient_sword"],
                    escape: 6
                }
            },
            220: {
                text: "You grab the key and run! The spectral guardian gives chase but you're faster. You escape with the key!",
                effect: { item: "study_key" },
                options: [
                    { text: "Return to the crypt", goto: 151, test: null }
                ]
            },
            221: {
                text: "You enter Dracula's crypt through the secret door. He sleeps in his coffin. This is your chance!",
                options: [
                    { text: "Stake Dracula in his sleep", goto: 203, test: { type: "skill", difficulty: 12 } },
                    { text: "Wake him for a fair fight", goto: 200, combat: "dracula_final" }
                ]
            },
            222: {
                text: "With Dracula destroyed, his minions turn to dust. The castle begins to crumble. You grab what treasures you can carry and escape as the sun rises. You return to the village a hero. The curse is lifted!",
                victory: true
            },
            223: {
                text: "You successfully steal the key! The bride doesn't notice until you're already gone. You have the second key!",
                effect: { item: "brides_key" },
                options: [
                    { text: "Return to the crypt", goto: 151, test: null }
                ]
            }
        };

        // ENEMIES
        const enemies = {
            vampire_minion: {
                name: "VAMPIRE MINION",
                description: "A pale creature with fangs and claws.",
                skill: 8,
                stamina: 10,
                damage: "2d6+1",
                weakness: "holy",
                loot: ["vampire_dust", "gold_coins"],
                escape: 4
            },
            ghoul: {
                name: "GHOUL",
                description: "A rotting undead creature.",
                skill: 7,
                stamina: 8,
                damage: "2d6",
                weakness: "holy",
                loot: ["rotten_cloth"],
                escape: 3
            },
            werewolf_pack: {
                name: "WEREWOLF PACK",
                description: "Three wolf-like creatures with glowing eyes.",
                skill: 9,
                stamina: 18,
                damage: "2d6+2",
                weakness: "silver",
                loot: ["wolf_pelts", "silver_amulet"],
                escape: 6
            },
            angry_villagers: {
                name: "ANGRY VILLAGERS",
                description: "Viktor and several villagers armed with farm tools.",
                skill: 8,
                stamina: 15,
                damage: "2d6+1",
                loot: ["villager_gear"],
                escape: 5
            },
            wolf_pair: {
                name: "WOLF PAIR",
                description: "Two hungry forest wolves.",
                skill: 7,
                stamina: 12,
                damage: "2d6",
                loot: ["wolf_teeth", "meat"],
                escape: 4
            },
            forest_bandits: {
                name: "FOREST BANDITS",
                description: "Three desperate men armed with knives and clubs.",
                skill: 8,
                stamina: 15,
                damage: "2d6+1",
                loot: ["bandit_gold", "rusty_knife"],
                escape: 5
            },
            wolf_pack_dog: {
                name: "WOLF PACK (with dog)",
                description: "Wolves cornering Old Gregor's dog.",
                skill: 8,
                stamina: 14,
                damage: "2d6+1",
                loot: ["saved_dog"],
                escape: 4
            },
            old_gregor: {
                name: "OLD GREGOR (revealed)",
                description: "Not human - moves with supernatural speed!",
                skill: 12,
                stamina: 16,
                damage: "2d6+3",
                special: "vampire",
                loot: ["ancient_amulet"],
                escape: 8
            },
            giant_bats: {
                name: "GIANT BATS",
                description: "Bats the size of eagles with sharp fangs.",
                skill: 7,
                stamina: 12,
                damage: "2d6",
                special: "flying",
                loot: ["bat_wings"],
                escape: 5
            },
            guardian_gargoyles: {
                name: "GUARDIAN GARGOYLES",
                description: "Two stone creatures come to life!",
                skill: 10,
                stamina: 16,
                damage: "2d6+2",
                special: "stone_skin",
                loot: ["gargoyle_shard"],
                escape: 6
            },
            sewer_creature: {
                name: "SEWER CREATURE",
                description: "A slimy, eel-like monster.",
                skill: 8,
                stamina: 10,
                damage: "2d6+1",
                special: "slimy",
                loot: ["monster_gland"],
                escape: 4
            },
            vampire_brides: {
                name: "VAMPIRE BRIDES",
                description: "Three of Dracula's consorts.",
                skill: 10,
                stamina: 18,
                damage: "2d6+2",
                special: "charm",
                loot: ["bridal_jewelry", "crypt_key"],
                escape: 7
            },
            ancient_vampire: {
                name: "ANCIENT VAMPIRE",
                description: "Older and stronger than minions.",
                skill: 11,
                stamina: 14,
                damage: "2d6+2",
                special: "blood_drain",
                loot: ["vampire_ring", "ancient_key"],
                escape: 6
            },
            fire_elemental: {
                name: "FIRE ELEMENTAL",
                description: "A creature of living flame!",
                skill: 12,
                stamina: 12,
                damage: "2d6+3",
                special: "fire",
                loot: ["fire_crystal"],
                escape: 5
            },
            catacomb_ghoul: {
                name: "CATACOMB GHOUL",
                description: "A ghoul feeding in the catacombs.",
                skill: 8,
                stamina: 10,
                damage: "2d6+1",
                weakness: "holy",
                loot: ["ghoul_claw"],
                escape: 4
            },
            igor_vampire_champion: {
                name: "IGOR, VAMPIRE CHAMPION",
                description: "Dracula's most powerful servant.",
                skill: 13,
                stamina: 20,
                damage: "2d6+3",
                special: "master_swordsman",
                loot: ["igor_sword", "crypt_master_key"],
                escape: 8
            },
            dracula_final: {
                name: "COUNT DRACULA",
                description: "The vampire lord himself!",
                skill: 15,
                stamina: 25,
                damage: "2d6+4",
                special: "vampire_lord",
                loot: ["dracula_ring", "castle_deed"],
                escape: 0
            },
            dracula_weakened: {
                name: "DRACULA (WEAKENED)",
                description: "Weakened by your traps.",
                skill: 13,
                stamina: 20,
                damage: "2d6+3",
                special: "weakened",
                loot: ["dracula_ring", "castle_deed"],
                escape: 0
            },
            vampire_swarm: {
                name: "VAMPIRE SWARM",
                description: "Six vampire minions surround you!",
                skill: 9,
                stamina: 24,
                damage: "2d6+1",
                special: "overwhelm",
                loot: ["mass_vampire_dust"],
                escape: 8
            },
            spectral_guardian: {
                name: "SPECTRAL GUARDIAN",
                description: "A ghostly knight.",
                skill: 11,
                stamina: 15,
                damage: "2d6+2",
                special: "incorporeal",
                loot: ["ghostly_key", "ancient_sword"],
                escape: 6
            }
        };

        // ITEMS
        const items = {
            silver_dagger: {
                name: "Silver Dagger",
                description: "+1 Skill vs undead. Effective against werewolves.",
                type: "weapon",
                bonus: 1,
                slots: 1
            },
            silver_dagger2: {
                name: "Silver Dagger (found)",
                description: "Another silver dagger. Useful backup.",
                type: "weapon",
                bonus: 1,
                slots: 1
            },
            holy_water: {
                name: "Holy Water",
                description: "3 uses. Does 4 damage to undead.",
                type: "consumable",
                uses: 3,
                slots: 1
            },
            holy_water2: {
                name: "Holy Water (bought)",
                description: "Extra holy water.",
                type: "consumable",
                uses: 3,
                slots: 1
            },
            holy_water3: {
                name: "Holy Water (found)",
                description: "Another vial of holy water.",
                type: "consumable",
                uses: 3,
                slots: 1
            },
            holy_water_kit: {
                name: "Holy Water Kit",
                description: "Multiple vials of holy water.",
                type: "consumable",
                uses: 5,
                slots: 2
            },
            garlic_charm: {
                name: "Garlic Charm",
                description: "Protects against vampires.",
                type: "special",
                slots: 1
            },
            healing_potion: {
                name: "Healing Potion",
                description: "Restores 4 Stamina when drunk.",
                type: "consumable",
                effect: 4,
                slots: 1
            },
            lantern: {
                name: "Brass Lantern",
                description: "Lights dark areas. Can blind enemies.",
                type: "tool",
                slots: 2
            },
            wooden_stake: {
                name: "Wooden Stake",
                description: "Kills vampires if driven through heart.",
                type: "weapon",
                slots: 1
            },
            wooden_stakes: {
                name: "Wooden Stakes",
                description: "Multiple stakes for vampire hunting.",
                type: "weapon",
                slots: 2
            },
            silver_bullets: {
                name: "Silver Bullets",
                description: "6 rounds for a firearm.",
                type: "ammo",
                slots: 1
            },
            silver_bullets_extra: {
                name: "Silver Bullets (extra)",
                description: "10 extra silver bullets.",
                type: "ammo",
                slots: 1
            },
            holy_symbol: {
                name: "Holy Symbol",
                description: "Repels undead.",
                type: "special",
                slots: 1
            },
            castle_map: {
                name: "Castle Map",
                description: "Shows paths to the castle.",
                type: "tool",
                slots: 1
            },
            castle_map_detailed: {
                name: "Detailed Castle Map",
                description: "Shows castle layout including crypt.",
                type: "tool",
                slots: 1
            },
            silver_cross: {
                name: "Silver Cross",
                description: "Holy symbol that burns undead.",
                type: "special",
                slots: 1
            },
            silver_cross2: {
                name: "Silver Cross (found)",
                description: "Another silver cross.",
                type: "special",
                slots: 1
            },
            silver_cross_bookmark: {
                name: "Silver Cross Bookmark",
                description: "Useful as holy symbol.",
                type: "special",
                slots: 1
            },
            gold_pouch: {
                name: "Gold Pouch",
                description: "Contains 15 gold coins.",
                type: "treasure",
                slots: 1
            },
            bandit_gold: {
                name: "Bandit Gold",
                description: "10 gold coins taken from bandits.",
                type: "treasure",
                slots: 1
            },
            saved_dog: {
                name: "Saved Dog",
                description: "Old Gregor's dog, Rex.",
                type: "special",
                slots: 0
            },
            silvered_sword: {
                name: "Silvered Sword",
                description: "Viktor's family heirloom. +2 Skill.",
                type: "weapon",
                bonus: 2,
                slots: 2
            },
            silvered_sword2: {
                name: "Silvered Sword (found)",
                description: "Another silvered sword.",
                type: "weapon",
                bonus: 2,
                slots: 2
            },
            garlic_infusion: {
                name: "Garlic Infusion",
                description: "Drink to repel vampires for a night.",
                type: "consumable",
                slots: 1
            },
            garlic_wine: {
                name: "Garlic Wine",
                description: "Wine infused with garlic. Hurts vampires.",
                type: "consumable",
                slots: 1
            },
            garlic_bundle: {
                name: "Garlic Bundle",
                description: "Fresh garlic cloves.",
                type: "consumable",
                slots: 1
            },
            climbing_gear: {
                name: "Climbing Gear",
                description: "Rope, pitons, and harness.",
                type: "tool",
                slots: 2
            },
            rope: {
                name: "Rope",
                description: "50 feet of strong rope.",
                type: "tool",
                slots: 2
            },
            hunters_tome: {
                name: "Hunter's Tome",
                description: "Book of vampire knowledge.",
                type: "book",
                slots: 2
            },
            vampire_knowledge: {
                name: "Vampire Knowledge",
                description: "Know Dracula's weaknesses.",
                type: "special",
                slots: 0
            },
            silver_whistle: {
                name: "Silver Whistle",
                description: "Summons help when blown.",
                type: "special",
                slots: 1
            },
            silver_inlaid_dagger: {
                name: "Silver-Inlaid Dagger",
                description: "Beautiful and effective. +1 Skill.",
                type: "weapon",
                bonus: 1,
                slots: 1
            },
            wolfsbane: {
                name: "Wolfsbane",
                description: "Herb that repels werewolves.",
                type: "consumable",
                slots: 1
            },
            protective_charm: {
                name: "Protective Charm",
                description: "Offers some protection against evil.",
                type: "special",
                slots: 1
            },
            silver_knife: {
                name: "Silver Knife",
                description: "From the castle kitchen. +1 Skill.",
                type: "weapon",
                bonus: 1,
                slots: 1
            },
            wine_bottle: {
                name: "Wine Bottle",
                description: "Could be useful for distraction.",
                type: "consumable",
                slots: 1
            },
            silver_letter_opener: {
                name: "Silver Letter Opener",
                description: "Small but effective. +0 Skill.",
                type: "weapon",
                bonus: 0,
                slots: 1
            },
            silver_tipped_spear: {
                name: "Silver-Tipped Spear",
                description: "+2 Skill vs were-creatures.",
                type: "weapon",
                bonus: 2,
                slots: 2
            },
            ash_wood_stake: {
                name: "Ash Wood Stake",
                description: "Perfect for killing vampires.",
                type: "weapon",
                slots: 1
            },
            catacomb_map: {
                name: "Catacomb Map",
                description: "Shows safe path through catacombs.",
                type: "tool",
                slots: 1
            },
            secret_passage_info: {
                name: "Secret Passage Info",
                description: "Directions to secret entrance to crypt.",
                type: "tool",
                slots: 1
            },
            silver_medallion: {
                name: "Silver Medallion",
                description: "Ancient silver medallion.",
                type: "treasure",
                slots: 1
            },
            silver_astrolabe: {
                name: "Silver Astrolabe",
                description: "Ancient astronomical tool.",
                type: "treasure",
                slots: 2
            },
            silver_key2: {
                name: "Silver Key",
                description: "Opens one crypt lock.",
                type: "key",
                slots: 1
            },
            crypt_key: {
                name: "Crypt Key",
                description: "From vampire bride. Opens crypt.",
                type: "key",
                slots: 1
            },
            study_key: {
                name: "Study Key",
                description: "From Dracula's study.",
                type: "key",
                slots: 1
            },
            brides_key: {
                name: "Bride's Key",
                description: "Stolen from vampire bride.",
                type: "key",
                slots: 1
            },
            ancient_key: {
                name: "Ancient Key",
                description: "From ancient vampire.",
                type: "key",
                slots: 1
            },
            crypt_master_key: {
                name: "Crypt Master Key",
                description: "From Igor. Opens all crypt locks.",
                type: "key",
                slots: 1
            },
            ghostly_key: {
                name: "Ghostly Key",
                description: "From spectral guardian.",
                type: "key",
                slots: 1
            },
            // Loot items
            vampire_dust: {
                name: "Vampire Dust",
                description: "Remains of a destroyed vampire.",
                type: "junk",
                slots: 1
            },
            mass_vampire_dust: {
                name: "Mass Vampire Dust",
                description: "Lots of vampire remains.",
                type: "junk",
                slots: 1
            },
            gold_coins: {
                name: "Gold Coins",
                description: "10 gold coins.",
                type: "treasure",
                slots: 1
            },
            rotten_cloth: {
                name: "Rotten Cloth",
                description: "From a ghoul. Worthless.",
                type: "junk",
                slots: 1
            },
            wolf_pelts: {
                name: "Wolf Pelts",
                description: "Can be sold for 5 gold.",
                type: "treasure",
                slots: 2
            },
            silver_amulet: {
                name: "Silver Amulet",
                description: "Worth 10 gold.",
                type: "treasure",
                slots: 1
            },
            villager_gear: {
                name: "Villager Gear",
                description: "Simple tools and clothes.",
                type: "junk",
                slots: 1
            },
            wolf_teeth: {
                name: "Wolf Teeth",
                description: "Can be made into necklace.",
                type: "treasure",
                slots: 1
            },
            meat: {
                name: "Meat",
                description: "Wolf meat. Could be eaten.",
                type: "consumable",
                effect: 2,
                slots: 1
            },
            rusty_knife: {
                name: "Rusty Knife",
                description: "Poor condition. -1 Skill.",
                type: "weapon",
                bonus: -1,
                slots: 1
            },
            ancient_amulet: {
                name: "Ancient Amulet",
                description: "From Old Gregor. Magical?",
                type: "treasure",
                slots: 1
            },
            bat_wings: {
                name: "Bat Wings",
                description: "From giant bats. Alchemical ingredient.",
                type: "junk",
                slots: 1
            },
            gargoyle_shard: {
                name: "Gargoyle Shard",
                description: "Piece of stone creature.",
                type: "junk",
                slots: 1
            },
            monster_gland: {
                name: "Monster Gland",
                description: "From sewer creature. Gross.",
                type: "junk",
                slots: 1
            },
            bridal_jewelry: {
                name: "Bridal Jewelry",
                description: "Worth 20 gold.",
                type: "treasure",
                slots: 1
            },
            vampire_ring: {
                name: "Vampire Ring",
                description: "Ancient ring. Worth 15 gold.",
                type: "treasure",
                slots: 1
            },
            fire_crystal: {
                name: "Fire Crystal",
                description: "Glows with inner fire.",
                type: "treasure",
                slots: 1
            },
            ghoul_claw: {
                name: "Ghoul Claw",
                description: "Diseased claw. Dangerous.",
                type: "junk",
                slots: 1
            },
            igor_sword: {
                name: "Igor's Sword",
                description: "Masterwork sword. +3 Skill.",
                type: "weapon",
                bonus: 3,
                slots: 2
            },
            dracula_ring: {
                name: "Dracula's Ring",
                description: "Proof of your victory. Priceless.",
                type: "treasure",
                slots: 1
            },
            castle_deed: {
                name: "Castle Deed",
                description: "Legal ownership of Castle Dracula.",
                type: "treasure",
                slots: 1
            },
            ancient_sword: {
                name: "Ancient Sword",
                description: "From spectral guardian. +2 Skill.",
                type: "weapon",
                bonus: 2,
                slots: 2
            },
            thieves_tools: {
                name: "Thieves' Tools",
                description: "For picking locks.",
                type: "tool",
                slots: 1
            },
            provisions: {
                name: "Provisions",
                description: "Food and water.",
                type: "consumable",
                effect: 2,
                slots: 1
            }
        };

        // Initialize Game
        function initGame() {
            document.getElementById('start-btn').addEventListener('click', showCharacterScreen);
            document.getElementById('rules-btn').addEventListener('click', showRulesScreen);
            
            console.log("Dracula's Rise initialized with " + Object.keys(sections).length + " sections!");
        }

        // Game Functions
        function showStartScreen() {
            hideAllScreens();
            document.getElementById('start-screen').classList.add('active');
            gameState.screen = 'start';
        }
        
        function showRulesScreen() {
            hideAllScreens();
            document.getElementById('rules-screen').classList.add('active');
            gameState.screen = 'rules';
        }
        
        function showCharacterScreen() {
            hideAllScreens();
            document.getElementById('character-screen').classList.add('active');
            gameState.screen = 'character';
            
            gameState.selectedEquipment = [];
            document.getElementById('selected-equipment').innerHTML = "";
            updateBeginButtonState();
        }
        
        function hideAllScreens() {
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => {
                screen.classList.remove('active');
            });
        }
        
        function rollStat(stat) {
            const dice1 = Math.floor(Math.random() * 6) + 1;
            const dice2 = Math.floor(Math.random() * 6) + 1;
            const total = dice1 + dice2;
            
            let baseValue = 0;
            if (stat === 'stamina') {
                baseValue = total + 12;
            } else {
                baseValue = total + 6;
            }
            
            document.getElementById(`${stat}-roll`).textContent = `${dice1}+${dice2} = ${total} + ${baseValue - total} = ${baseValue}`;
            
            gameState.stats[`initial${stat.charAt(0).toUpperCase() + stat.slice(1)}`] = baseValue;
            gameState.stats[stat] = baseValue;
            
            if (stat === 'stamina') {
                gameState.stats.maxStamina = baseValue;
            }
            
            document.getElementById(`${stat}-value`).textContent = baseValue;
            
            updateBonusPoints();
            updateBeginButtonState();
        }
        
        function adjustStat(stat, change) {
            if (change > 0 && gameState.bonusPoints <= 0) return;
            
            let minValue = 6;
            if (stat === 'stamina') minValue = 12;
            
            if (change < 0 && gameState.stats[stat] <= minValue) return;
            
            let maxValue = 18;
            if (stat === 'stamina') maxValue = 24;
            
            if (change > 0 && gameState.stats[stat] >= maxValue) return;
            
            gameState.stats[stat] += change;
            gameState.bonusPoints -= change;
            
            if (stat === 'stamina') {
                gameState.stats.maxStamina = gameState.stats.stamina;
            }
            
            document.getElementById(`${stat}-value`).textContent = gameState.stats[stat];
            document.getElementById('bonus-points').textContent = gameState.bonusPoints;
            
            updateBeginButtonState();
        }
        
        function updateBonusPoints() {
            let usedPoints = 0;
            usedPoints += Math.max(0, gameState.stats.stamina - (gameState.stats.initialStamina || 0));
            usedPoints += Math.max(0, gameState.stats.skill - (gameState.stats.initialSkill || 0));
            usedPoints += Math.max(0, gameState.stats.luck - (gameState.stats.initialLuck || 0));
            
            gameState.bonusPoints = 6 - usedPoints;
            document.getElementById('bonus-points').textContent = gameState.bonusPoints;
        }
        
        function selectEquipment(itemId) {
            if (gameState.selectedEquipment.length >= 3 && !gameState.selectedEquipment.includes(itemId)) {
                alert("You can only select 3 starting items!");
                return;
            }
            
            if (gameState.selectedEquipment.includes(itemId)) {
                const index = gameState.selectedEquipment.indexOf(itemId);
                gameState.selectedEquipment.splice(index, 1);
            } else {
                gameState.selectedEquipment.push(itemId);
            }
            
            const equipmentDiv = document.getElementById('selected-equipment');
            equipmentDiv.innerHTML = "";
            
            gameState.selectedEquipment.forEach(itemId => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'item';
                itemDiv.textContent = items[itemId].name;
                equipmentDiv.appendChild(itemDiv);
            });
            
            updateBeginButtonState();
        }
        
        function updateBeginButtonState() {
            const beginBtn = document.getElementById('begin-btn');
            const isValid = 
                gameState.stats.stamina >= 12 &&
                gameState.stats.skill >= 6 &&
                gameState.stats.luck >= 6 &&
                gameState.selectedEquipment.length === 3 &&
                gameState.bonusPoints === 0;
            
            beginBtn.disabled = !isValid;
        }
        
        function startGame() {
            if (gameState.stats.stamina < 12) {
                alert("Minimum Stamina not met: Need at least 12!");
                return;
            }
            
            if (gameState.stats.skill < 6) {
                alert("Minimum Skill not met: Need at least 6!");
                return;
            }
            
            if (gameState.stats.luck < 6) {
                alert("Minimum Luck not met: Need at least 6!");
                return;
            }
            
            if (gameState.selectedEquipment.length !== 3) {
                alert("You must select exactly 3 starting items!");
                return;
            }
            
            if (gameState.bonusPoints !== 0) {
                alert("You must use all 6 bonus points!");
                return;
            }
            
            gameState.inventory = [...gameState.selectedEquipment];
            
            document.getElementById('current-stamina').textContent = gameState.stats.stamina;
            document.getElementById('current-skill').textContent = gameState.stats.skill;
            document.getElementById('current-luck').textContent = gameState.stats.luck;
            document.getElementById('current-gold').textContent = gameState.stats.gold;
            document.getElementById('current-section').textContent = gameState.currentSection;
            
            updateStaminaBar();
            updateInventoryCount();
            
            hideAllScreens();
            document.getElementById('game-screen').classList.add('active');
            gameState.screen = 'game';
            
            showSection(1);
        }
        
        function showSection(sectionNumber) {
            gameState.savedSection = sectionNumber;
            gameState.currentSection = sectionNumber;
            gameState.visitedSections.push(sectionNumber);
            
            const section = sections[sectionNumber];
            if (!section) {
                handleEnding(sectionNumber);
                return;
            }
            
            if (section.victory) {
                showVictory("You have defeated Dracula and lifted the curse!");
                return;
            }
            
            document.getElementById('current-section').textContent = sectionNumber;
            
            let html = `<p><span class="section-number">${sectionNumber}.</span> ${section.text}</p>`;
            
            if (section.effect) {
                applyEffect(section.effect);
            }
            
            if (section.combat) {
                document.getElementById('game-text').innerHTML = html;
                startCombat(section.combat);
                return;
            }
            
            document.getElementById('game-text').innerHTML = html;
            
            const buttonContainer = document.getElementById('action-buttons');
            buttonContainer.innerHTML = "";
            
            if (section.options) {
                section.options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.textContent = option.text;
                    
                    if (option.test) {
                        button.onclick = () => handleTest(option.test, option.goto);
                    } else if (option.combat) {
                        button.onclick = () => {
                            document.getElementById('game-text').innerHTML = html;
                            startCombat(option.combat);
                        };
                    } else {
                        button.onclick = () => showSection(option.goto);
                    }
                    
                    buttonContainer.appendChild(button);
                });
            }
            
            const inventoryButton = document.createElement('button');
            inventoryButton.textContent = "CHECK INVENTORY";
            inventoryButton.onclick = showInventory;
            buttonContainer.appendChild(inventoryButton);
            
            const diceButton = document.createElement('button');
            diceButton.textContent = "ROLL DICE";
            diceButton.onclick = rollDice;
            buttonContainer.appendChild(diceButton);
        }
        
        function applyEffect(effect) {
            let message = "";
            
            if (effect.stamina) {
                gameState.stats.stamina += effect.stamina;
                gameState.stats.stamina = Math.min(gameState.stats.stamina, gameState.stats.maxStamina);
                if (gameState.stats.stamina <= 0) {
                    gameOver("Your Stamina has reached 0!");
                    return;
                }
                updateStaminaBar();
                message += ` Stamina ${effect.stamina > 0 ? '+' : ''}${effect.stamina}.`;
            }
            
            if (effect.skill) {
                gameState.stats.skill += effect.skill;
                document.getElementById('current-skill').textContent = gameState.stats.skill;
                message += ` Skill ${effect.skill > 0 ? '+' : ''}${effect.skill}.`;
            }
            
            if (effect.luck) {
                gameState.stats.luck += effect.luck;
                document.getElementById('current-luck').textContent = gameState.stats.luck;
                message += ` Luck ${effect.luck > 0 ? '+' : ''}${effect.luck}.`;
            }
            
            if (effect.gold) {
                gameState.stats.gold += effect.gold;
                if (gameState.stats.gold < 0) gameState.stats.gold = 0;
                document.getElementById('current-gold').textContent = gameState.stats.gold;
                message += ` Gold ${effect.gold > 0 ? '+' : ''}${effect.gold}.`;
            }
            
            if (effect.item) {
                if (!gameState.inventory.includes(effect.item)) {
                    gameState.inventory.push(effect.item);
                    updateInventoryCount();
                    message += ` Added ${items[effect.item].name} to inventory.`;
                }
            }
            
            if (effect.items) {
                effect.items.forEach(itemId => {
                    if (!gameState.inventory.includes(itemId)) {
                        gameState.inventory.push(itemId);
                        updateInventoryCount();
                        message += ` Added ${items[itemId].name} to inventory.`;
                    }
                });
            }
            
            if (effect.enemyStamina) {
                gameState.combat.enemyStamina += effect.enemyStamina;
                message += ` Enemy Stamina ${effect.enemyStamina > 0 ? '+' : ''}${effect.enemyStamina}.`;
            }
            
            if (message) {
                const gameText = document.getElementById('game-text');
                if (effect.stamina > 0 || effect.skill > 0 || effect.luck > 0) {
                    gameText.innerHTML += `<p class="outcome-good">${message}</p>`;
                } else if (effect.stamina < 0 || effect.gold < 0) {
                    gameText.innerHTML += `<p class="outcome-bad">${message}</p>`;
                } else {
                    gameText.innerHTML += `<p>${message}</p>`;
                }
            }
        }
        
        function handleTest(test, successGoto) {
            let html = document.getElementById('game-text').innerHTML;
            
            if (test.type === "skill") {
                html += `<div class="skill-check">`;
                html += `<p>Testing Skill (${gameState.stats.skill})...</p>`;
                
                const dice1 = Math.floor(Math.random() * 6) + 1;
                const dice2 = Math.floor(Math.random() * 6) + 1;
                const total = dice1 + dice2;
                
                html += `<p>Roll: ${dice1} + ${dice2} = <strong>${total}</strong></p>`;
                
                let success = false;
                if (test.target) {
                    const target = typeof test.target === 'function' ? test.target() : test.target;
                    success = total <= target;
                    html += `<p>Need ${total} ≤ ${target}: ${success ? 'SUCCESS!' : 'FAILURE!'}</p>`;
                } else if (test.difficulty) {
                    const checkTotal = total + gameState.stats.skill;
                    success = checkTotal >= test.difficulty;
                    html += `<p>${total} + Skill ${gameState.stats.skill} = ${checkTotal} vs ${test.difficulty}: ${success ? 'SUCCESS!' : 'FAILURE!'}</p>`;
                }
                
                if (success) {
                    html += `<p class="skill-success">You succeeded!</p>`;
                    document.getElementById('game-text').innerHTML = html;
                    setTimeout(() => showSection(successGoto), 1500);
                } else {
                    html += `<p class="skill-failure">You failed!</p>`;
                    document.getElementById('game-text').innerHTML = html;
                    
                    const failureButton = document.createElement('button');
                    failureButton.textContent = "CONTINUE";
                    failureButton.onclick = () => showSection(successGoto + 1);
                    document.getElementById('action-buttons').innerHTML = "";
                    document.getElementById('action-buttons').appendChild(failureButton);
                }
                
            } else if (test.type === "luck") {
                html += `<div class="skill-check">`;
                html += `<p>Testing Luck (${gameState.stats.luck})...</p>`;
                
                const dice1 = Math.floor(Math.random() * 6) + 1;
                const dice2 = Math.floor(Math.random() * 6) + 1;
                const total = dice1 + dice2;
                
                html += `<p>Roll: ${dice1} + ${dice2} = <strong>${total}</strong></p>`;
                
                let success = false;
                if (test.target) {
                    success = total >= test.target;
                    html += `<p>Need ${total} ≥ ${test.target}: ${success ? 'LUCKY!' : 'UNLUCKY!'}</p>`;
                } else {
                    success = total <= gameState.stats.luck;
                    html += `<p>Need ${total} ≤ ${gameState.stats.luck}: ${success ? 'LUCKY!' : 'UNLUCKY!'}</p>`;
                }
                
                gameState.stats.luck--;
                document.getElementById('current-luck').textContent = gameState.stats.luck;
                html += `<p>Your Luck is now ${gameState.stats.luck}</p>`;
                
                if (success) {
                    html += `<p class="skill-success">You are lucky!</p>`;
                    document.getElementById('game-text').innerHTML = html;
                    setTimeout(() => showSection(successGoto), 1500);
                } else {
                    html += `<p class="skill-failure">You are unlucky!</p>`;
                    document.getElementById('game-text').innerHTML = html;
                    
                    const failureButton = document.createElement('button');
                    failureButton.textContent = "CONTINUE";
                    failureButton.onclick = () => showSection(successGoto + 1);
                    document.getElementById('action-buttons').innerHTML = "";
                    document.getElementById('action-buttons').appendChild(failureButton);
                }
                
            } else if (test.type === "item") {
                const hasItem = gameState.inventory.includes(test.item);
                if (hasItem) {
                    html += `<p class="outcome-good">You use the ${items[test.item].name}!</p>`;
                    document.getElementById('game-text').innerHTML = html;
                    setTimeout(() => showSection(successGoto), 1000);
                } else {
                    html += `<p class="outcome-bad">You don't have the required item!</p>`;
                    document.getElementById('game-text').innerHTML = html;
                    
                    const failureButton = document.createElement('button');
                    failureButton.textContent = "CONTINUE";
                    failureButton.onclick = () => showSection(successGoto + 10);
                    document.getElementById('action-buttons').innerHTML = "";
                    document.getElementById('action-buttons').appendChild(failureButton);
                }
            } else if (test.type === "gold") {
                if (gameState.stats.gold >= test.amount) {
                    gameState.stats.gold -= test.amount;
                    document.getElementById('current-gold').textContent = gameState.stats.gold;
                    html += `<p class="outcome-good">You pay ${test.amount} gold.</p>`;
                    document.getElementById('game-text').innerHTML = html;
                    setTimeout(() => showSection(successGoto), 1000);
                } else {
                    html += `<p class="outcome-bad">You don't have enough gold!</p>`;
                    document.getElementById('game-text').innerHTML = html;
                    
                    const failureButton = document.createElement('button');
                    failureButton.textContent = "CONTINUE";
                    failureButton.onclick = () => showSection(successGoto + 5);
                    document.getElementById('action-buttons').innerHTML = "";
                    document.getElementById('action-buttons').appendChild(failureButton);
                }
            } else if (test.type === "stamina") {
                html += `<div class="skill-check">`;
                html += `<p>Testing Stamina (${gameState.stats.stamina})...</p>`;
                
                const dice1 = Math.floor(Math.random() * 6) + 1;
                const dice2 = Math.floor(Math.random() * 6) + 1;
                const total = dice1 + dice2;
                
                html += `<p>Roll: ${dice1} + ${dice2} = <strong>${total}</strong></p>`;
                
                const checkTotal = total + gameState.stats.stamina;
                const success = checkTotal >= test.difficulty;
                html += `<p>${total} + Stamina ${gameState.stats.stamina} = ${checkTotal} vs ${test.difficulty}: ${success ? 'SUCCESS!' : 'FAILURE!'}</p>`;
                
                if (success) {
                    html += `<p class="skill-success">You succeeded!</p>`;
                    document.getElementById('game-text').innerHTML = html;
                    setTimeout(() => showSection(successGoto), 1500);
                } else {
                    html += `<p class="skill-failure">You failed!</p>`;
                    document.getElementById('game-text').innerHTML = html;
                    
                    const failureButton = document.createElement('button');
                    failureButton.textContent = "CONTINUE";
                    failureButton.onclick = () => showSection(successGoto + 1);
                    document.getElementById('action-buttons').innerHTML = "";
                    document.getElementById('action-buttons').appendChild(failureButton);
                }
            }
        }
        
        function startCombat(combatData) {
            gameState.combat.active = true;
            gameState.combat.enemy = combatData.enemy || combatData;
            gameState.combat.round = 1;
            
            const enemy = enemies[gameState.combat.enemy];
            
            hideAllScreens();
            document.getElementById('combat-screen').classList.add('active');
            gameState.screen = 'combat';
            
            let html = `<p class="game-over">COMBAT!</p>`;
            html += `<p>You face a ${enemy.name}: ${enemy.description}</p>`;
            html += `<p>Enemy Skill: ${enemy.skill}, Stamina: ${enemy.stamina}</p>`;
            
            if (enemy.weakness) {
                html += `<p class="warning">Weakness: ${enemy.weakness}</p>`;
            }
            
            if (enemy.special) {
                html += `<p class="warning">Special: ${enemy.special}</p>`;
            }
            
            document.getElementById('combat-text').innerHTML = html;
            
            gameState.combat.enemyStamina = enemy.stamina;
            document.getElementById('combat-player-stamina').textContent = gameState.stats.stamina;
            document.getElementById('combat-enemy-stamina').textContent = enemy.stamina;
            
            updateCombatBars();
            showCombatActions();
        }
        
        function showCombatActions() {
            const actionsDiv = document.getElementById('combat-actions');
            actionsDiv.innerHTML = "";
            
            const attackButton = document.createElement('button');
            attackButton.textContent = "ATTACK";
            attackButton.className = 'combat-option';
            attackButton.onclick = combatRound;
            actionsDiv.appendChild(attackButton);
            
            const enemy = enemies[gameState.combat.enemy];
            
            if (enemy.weakness === "holy" && hasItem('holy_water')) {
                const holyButton = document.createElement('button');
                holyButton.textContent = "USE HOLY WATER (4 damage)";
                holyButton.onclick = useHolyWater;
                actionsDiv.appendChild(holyButton);
            }
            
            if (enemy.weakness === "silver" && hasItem('silver_dagger')) {
                const silverButton = document.createElement('button');
                silverButton.textContent = "USE SILVER WEAPON (extra damage)";
                silverButton.onclick = useSilverWeapon;
                actionsDiv.appendChild(silverButton);
            }
            
            if (gameState.combat.enemy === "dracula_final" && hasItem('wooden_stake')) {
                const stakeButton = document.createElement('button');
                stakeButton.textContent = "USE WOODEN STAKE (instant kill if successful)";
                stakeButton.onclick = useWoodenStake;
                actionsDiv.appendChild(stakeButton);
            }
            
            const fleeButton = document.createElement('button');
            fleeButton.textContent = "ATTEMPT TO FLEE";
            fleeButton.onclick = attemptFlee;
            actionsDiv.appendChild(fleeButton);
        }
        
        function combatRound() {
            const enemy = enemies[gameState.combat.enemy];
            let html = document.getElementById('combat-text').innerHTML;
            
            html += `<h3>ROUND ${gameState.combat.round}</h3>`;
            
            const playerRoll1 = Math.floor(Math.random() * 6) + 1;
            const playerRoll2 = Math.floor(Math.random() * 6) + 1;
            const playerAttack = playerRoll1 + playerRoll2 + gameState.stats.skill + gameState.stats.skillBonus;
            
            html += `<p>You attack... Roll: ${playerRoll1} + ${playerRoll2} + Skill ${gameState.stats.skill} = <strong>${playerAttack}</strong></p>`;
            
            const enemyRoll1 = Math.floor(Math.random() * 6) + 1;
            const enemyRoll2 = Math.floor(Math.random() * 6) + 1;
            const enemyAttack = enemyRoll1 + enemyRoll2 + enemy.skill;
            
            html += `<p>${enemy.name} attacks... Roll: ${enemyRoll1} + ${enemyRoll2} + Skill ${enemy.skill} = <strong>${enemyAttack}</strong></p>`;
            
            if (playerAttack > enemyAttack) {
                let damage = 0;
                if (enemy.weakness === "silver" && hasItem('silver_dagger')) {
                    damage = 4;
                    html += `<p class="outcome-good">Your silver weapon strikes true! Damage: ${damage}</p>`;
                } else {
                    damage = Math.floor(Math.random() * 6) + 1 + 2;
                    html += `<p class="outcome-good">You hit for ${damage} damage!</p>`;
                }
                
                gameState.combat.enemyStamina -= damage;
                
            } else if (enemyAttack > playerAttack) {
                let damage = 0;
                if (enemy.special === 'holy_water' && Math.random() > 0.7) {
                    damage = 4;
                    html += `<p class="outcome-bad">${enemy.name} uses holy water! Damage: ${damage}</p>`;
                } else {
                    damage = Math.floor(Math.random() * 6) + 1 + 2;
                    html += `<p class="outcome-bad">${enemy.name} hits for ${damage} damage!</p>`;
                }
                
                gameState.stats.stamina -= damage;
                
            } else {
                html += `<p>Your attacks clash! No damage this round.</p>`;
            }
            
            gameState.combat.round++;
            
            document.getElementById('combat-text').innerHTML = html;
            updateCombatBars();
            setTimeout(() => checkCombatEnd(), 1000);
        }
        
        function useHolyWater() {
            const holyIndex = gameState.inventory.indexOf('holy_water');
            if (holyIndex === -1) return;
            
            let html = document.getElementById('combat-text').innerHTML;
            html += `<p class="skill-success">You throw holy water! 4 damage!</p>`;
            
            gameState.combat.enemyStamina -= 4;
            gameState.inventory.splice(holyIndex, 1);
            updateInventoryCount();
            
            document.getElementById('combat-text').innerHTML = html;
            updateCombatBars();
            setTimeout(() => checkCombatEnd(), 1000);
        }
        
        function useSilverWeapon() {
            if (!hasItem('silver_dagger') && !hasItem('silvered_sword')) return;
            
            let html = document.getElementById('combat-text').innerHTML;
            html += `<p class="skill-success">Silver weapon strikes true! 4 damage!</p>`;
            
            gameState.combat.enemyStamina -= 4;
            document.getElementById('combat-text').innerHTML = html;
            updateCombatBars();
            setTimeout(() => checkCombatEnd(), 1000);
        }
        
        function useWoodenStake() {
            if (!hasItem('wooden_stake') && !hasItem('ash_wood_stake')) return;
            
            let html = document.getElementById('combat-text').innerHTML;
            html += `<p>You attempt to stake the vampire through the heart!</p>`;
            
            const dice1 = Math.floor(Math.random() * 6) + 1;
            const dice2 = Math.floor(Math.random() * 6) + 1;
            const total = dice1 + dice2;
            
            html += `<p>Roll: ${dice1} + ${dice2} = ${total}. Need ≤ Skill ${gameState.stats.skill}.</p>`;
            
            if (total <= gameState.stats.skill) {
                html += `<p class="victory">You drive the stake through Dracula's heart! He turns to dust!</p>`;
                document.getElementById('combat-text').innerHTML = html;
                
                setTimeout(() => {
                    showVictory("You have defeated Dracula with a wooden stake through the heart!");
                }, 2000);
            } else {
                html += `<p class="outcome-bad">You miss the heart! Dracula is enraged!</p>`;
                document.getElementById('combat-text').innerHTML = html;
                
                setTimeout(() => {
                    combatRound();
                }, 1000);
            }
        }
        
        function attemptFlee() {
            const enemy = enemies[gameState.combat.enemy];
            let html = document.getElementById('combat-text').innerHTML;
            html += `<p>You attempt to flee...</p>`;
            
            const dice1 = Math.floor(Math.random() * 6) + 1;
            const dice2 = Math.floor(Math.random() * 6) + 1;
            const total = dice1 + dice2;
            
            html += `<p>Roll: ${dice1} + ${dice2} = ${total}. Need ≤ Skill ${gameState.stats.skill}.</p>`;
            
            if (total <= gameState.stats.skill) {
                html += `<p class="outcome-good">You escape!</p>`;
                document.getElementById('combat-text').innerHTML = html;
                
                setTimeout(() => {
                    endCombat(false);
                    showSection(gameState.currentSection + 1);
                }, 1500);
            } else {
                html += `<p class="outcome-bad">You fail to escape!</p>`;
                document.getElementById('combat-text').innerHTML = html;
                
                setTimeout(() => {
                    const damage = Math.floor(Math.random() * 6) + 1 + 2;
                    
                    html += `<p>${enemy.name} attacks as you flee! ${damage} damage!</p>`;
                    gameState.stats.stamina -= damage;
                    
                    document.getElementById('combat-text').innerHTML = html;
                    updateCombatBars();
                    
                    if (gameState.stats.stamina <= 0) {
                        gameOver("You were defeated in combat!");
                    } else {
                        setTimeout(() => checkCombatEnd(), 1000);
                    }
                }, 1000);
            }
        }
        
        function updateCombatBars() {
            const playerPercent = (gameState.stats.stamina / gameState.stats.maxStamina) * 100;
            document.getElementById('player-combat-bar').style.width = `${playerPercent}%`;
            document.getElementById('combat-player-stamina').textContent = gameState.stats.stamina;
            
            const enemy = enemies[gameState.combat.enemy];
            const enemyPercent = (gameState.combat.enemyStamina / enemy.stamina) * 100;
            document.getElementById('enemy-combat-bar').style.width = `${enemyPercent}%`;
            document.getElementById('combat-enemy-stamina').textContent = gameState.combat.enemyStamina;
            
            document.getElementById('current-stamina').textContent = gameState.stats.stamina;
            updateStaminaBar();
        }
        
        function checkCombatEnd() {
            if (gameState.stats.stamina <= 0) {
                gameOver("You were defeated in combat!");
                return;
            }
            
            if (gameState.combat.enemyStamina <= 0) {
                const enemy = enemies[gameState.combat.enemy];
                let html = document.getElementById('combat-text').innerHTML;
                html += `<p class="victory">You defeated the ${enemy.name}!</p>`;
                
                if (enemy.loot && enemy.loot.length > 0) {
                    html += `<p class="outcome-good">You find: ${enemy.loot.map(item => items[item].name).join(', ')}</p>`;
                    enemy.loot.forEach(item => {
                        if (!gameState.inventory.includes(item)) {
                            gameState.inventory.push(item);
                        }
                    });
                    updateInventoryCount();
                }
                
                document.getElementById('combat-text').innerHTML = html;
                
                setTimeout(() => {
                    endCombat(true);
                    showSection(gameState.currentSection + 1);
                }, 2000);
            } else {
                showCombatActions();
            }
        }
        
        function endCombat(victory) {
            gameState.combat.active = false;
            
            if (!victory && gameState.stats.stamina <= 0) return;
            
            hideAllScreens();
            document.getElementById('game-screen').classList.add('active');
            gameState.screen = 'game';
        }
        
        function hasItem(itemId) {
            return gameState.inventory.includes(itemId);
        }
        
        function showInventory() {
            hideAllScreens();
            document.getElementById('inventory-screen').classList.add('active');
            gameState.screen = 'inventory';
            
            document.getElementById('total-items').textContent = gameState.inventory.length;
            
            const inventoryDiv = document.getElementById('inventory-items');
            inventoryDiv.innerHTML = "";
            
            if (gameState.inventory.length === 0) {
                inventoryDiv.innerHTML = "<p>Your inventory is empty.</p>";
            } else {
                gameState.inventory.forEach(itemId => {
                    if (items[itemId]) {
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'item';
                        itemDiv.innerHTML = `<strong>${items[itemId].name}</strong><br>${items[itemId].description}`;
                        inventoryDiv.appendChild(itemDiv);
                    }
                });
            }
            
            const weaponDiv = document.getElementById('equipped-weapons');
            weaponDiv.innerHTML = "";
            
            if (gameState.equippedWeapon) {
                const weapon = items[gameState.equippedWeapon];
                weaponDiv.innerHTML = `<div class="item item-rare"><strong>${weapon.name}</strong><br>${weapon.description}</div>`;
            } else {
                weaponDiv.innerHTML = "<p>No weapon equipped.</p>";
            }
            
            const specialDiv = document.getElementById('special-items');
            specialDiv.innerHTML = "";
            
            const specialItems = gameState.inventory.filter(itemId => 
                items[itemId] && (items[itemId].type === 'special' || items[itemId].type === 'key')
            );
            
            if (specialItems.length === 0) {
                specialDiv.innerHTML = "<p>No special items.</p>";
            } else {
                specialItems.forEach(itemId => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'item';
                    itemDiv.innerHTML = `<strong>${items[itemId].name}</strong><br>${items[itemId].description}`;
                    specialDiv.appendChild(itemDiv);
                });
            }
            
            const provisionsDiv = document.getElementById('provisions');
            provisionsDiv.innerHTML = "";
            
            const healingItems = gameState.inventory.filter(itemId => 
                items[itemId] && items[itemId].type === 'consumable' && (itemId.includes('healing') || itemId === 'meat' || itemId === 'provisions')
            );
            
            if (healingItems.length === 0) {
                provisionsDiv.innerHTML = "<p>No healing items.</p>";
            } else {
                healingItems.forEach(itemId => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'item';
                    itemDiv.innerHTML = `<strong>${items[itemId].name}</strong><br>${items[itemId].description}`;
                    provisionsDiv.appendChild(itemDiv);
                });
            }
        }
        
        function useHealing() {
            const healingItems = gameState.inventory.filter(itemId => 
                items[itemId] && items[itemId].type === 'consumable' && (itemId.includes('healing') || itemId === 'meat' || itemId === 'provisions')
            );
            
            if (healingItems.length === 0) {
                alert("No healing items available!");
                return;
            }
            
            // Use first healing item
            const healingItem = healingItems[0];
            const healAmount = items[healingItem].effect || 2;
            
            gameState.stats.stamina = Math.min(gameState.stats.maxStamina, gameState.stats.stamina + healAmount);
            
            const index = gameState.inventory.indexOf(healingItem);
            gameState.inventory.splice(index, 1);
            
            updateStaminaBar();
            updateInventoryCount();
            showInventory();
            
            alert(`Used ${items[healingItem].name}! Restored ${healAmount} Stamina.`);
        }
        
        function useHealingItem() {
            useHealing();
            showGameScreen();
        }
        
        function showGameScreen() {
            hideAllScreens();
            document.getElementById('game-screen').classList.add('active');
            gameState.screen = 'game';
        }
        
        function rollDice() {
            const dice1 = Math.floor(Math.random() * 6) + 1;
            const dice2 = Math.floor(Math.random() * 6) + 1;
            const total = dice1 + dice2;
            
            const diceResults = document.getElementById('dice-results');
            diceResults.style.display = 'block';
            diceResults.innerHTML = `
                <div class="dice-roller">
                    <h3>DICE ROLL</h3>
                    <p>Rolled: ${dice1} and ${dice2}</p>
                    <p class="dice-result">Total: ${total}</p>
                    <p>2D6 = ${total}</p>
                </div>
            `;
            
            diceResults.scrollIntoView({ behavior: 'smooth' });
            
            setTimeout(() => {
                diceResults.style.display = 'none';
            }, 5000);
        }
        
        function testLuck() {
            if (gameState.stats.luck <= 0) {
                alert("Your Luck is 0! You cannot test Luck!");
                return;
            }
            
            const dice1 = Math.floor(Math.random() * 6) + 1;
            const dice2 = Math.floor(Math.random() * 6) + 1;
            const total = dice1 + dice2;
            
            const isLucky = total <= gameState.stats.luck;
            
            gameState.stats.luck--;
            document.getElementById('current-luck').textContent = gameState.stats.luck;
            
            let message = `You roll: ${dice1} + ${dice2} = ${total}\n`;
            message += `Your Luck is ${gameState.stats.luck + 1}\n`;
            message += `Need ${total} ≤ ${gameState.stats.luck + 1}\n\n`;
            message += isLucky ? 
                "You are LUCKY! Good fortune favors you!" : 
                "You are UNLUCKY! Misfortune strikes!";
            
            alert(message);
            document.getElementById('luck-test').textContent = isLucky ? "Lucky!" : "Unlucky!";
        }
        
        function updateStaminaBar() {
            const staminaPercent = (gameState.stats.stamina / gameState.stats.maxStamina) * 100;
            document.getElementById('stamina-bar').style.width = `${staminaPercent}%`;
            document.getElementById('current-stamina').textContent = gameState.stats.stamina;
        }
        
        function updateInventoryCount() {
            document.getElementById('inventory-count').textContent = gameState.inventory.length;
        }
        
        function handleEnding(sectionNumber) {
            if (sectionNumber >= 200) {
                showVictory("Congratulations! You have completed your adventure!");
            } else {
                gameOver("Your adventure has reached a dead end at section " + sectionNumber);
            }
        }
        
        function showVictory(message) {
            hideAllScreens();
            document.getElementById('victory-screen').classList.add('active');
            
            let victoryText = "<p class='victory'>VICTORY!</p>";
            victoryText += `<p>${message}</p>`;
            victoryText += "<p>You have defeated Count Dracula and lifted the curse from Transylvania!</p>";
            victoryText += `<p>Final Stats: Stamina ${gameState.stats.stamina}, Skill ${gameState.stats.skill}, Luck ${gameState.stats.luck}, Gold ${gameState.stats.gold}</p>`;
            victoryText += `<p>Sections visited: ${gameState.visitedSections.length}</p>`;
            victoryText += `<p>Items collected: ${gameState.inventory.length}</p>`;
            victoryText += "<p>The villagers will sing songs of your bravery for generations to come!</p>";
            
            document.getElementById('victory-text').innerHTML = victoryText;
        }
        
        function gameOver(reason) {
            hideAllScreens();
            document.getElementById('gameover-screen').classList.add('active');
            
            let html = `<p class="game-over">GAME OVER</p>`;
            html += `<p>${reason}</p>`;
            html += `<p>You reached section ${gameState.currentSection}</p>`;
            html += `<p>Final Stamina: ${gameState.stats.stamina}</p>`;
            html += `<p>Final Skill: ${gameState.stats.skill}</p>`;
            html += `<p>Final Luck: ${gameState.stats.luck}</p>`;
            html += `<p>Final Gold: ${gameState.stats.gold}</p>`;
            html += `<p>Items collected: ${gameState.inventory.length}</p>`;
            
            document.getElementById('gameover-text').innerHTML = html;
        }
        
        function continueFromGameOver() {
            gameState.stats.stamina = Math.max(1, gameState.stats.stamina);
            updateStaminaBar();
            hideAllScreens();
            document.getElementById('game-screen').classList.add('active');
            showSection(gameState.savedSection);
        }
        
        function continueFromVictory() {
            hideAllScreens();
            document.getElementById('game-screen').classList.add('active');
            showSection(gameState.savedSection);
        }
        
        function restartGame() {
            gameState.screen = 'start';
            gameState.stats = {
                initialStamina: 0,
                stamina: 0,
                maxStamina: 0,
                initialSkill: 0,
                skill: 0,
                skillBonus: 0,
                initialLuck: 0,
                luck: 0,
                gold: 10
            };
            gameState.inventory = [];
            gameState.equippedWeapon = null;
            gameState.armor = null;
            gameState.currentSection = 1;
            gameState.visitedSections = [];
            gameState.combat = {
                active: false,
                enemy: null,
                enemyStamina: 0,
                round: 1,
                playerRoll: 0,
                enemyRoll: 0
            };
            gameState.dice = {
                value1: 0,
                value2: 0,
                total: 0
            };
            gameState.gameOver = false;
            gameState.victory = false;
            gameState.bonusPoints = 6;
            gameState.selectedEquipment = [];
            
            document.getElementById('stamina-roll').textContent = '--';
            document.getElementById('skill-roll').textContent = '--';
            document.getElementById('luck-roll').textContent = '--';
            document.getElementById('stamina-value').textContent = '0';
            document.getElementById('skill-value').textContent = '0';
            document.getElementById('luck-value').textContent = '0';
            document.getElementById('bonus-points').textContent = '6';
            document.getElementById('selected-equipment').innerHTML = '';
            
            hideAllScreens();
            document.getElementById('start-screen').classList.add('active');
        }
        
        // Initialize the game when page loads
        window.onload = initGame;
    </script>
</body>
</html>
