<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retro Text Adventure - CRPG</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=VT323&display=swap">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'VT323', monospace;
            background-color: #000;
            color: #0f0;
            line-height: 1.4;
            padding: 20px;
            height: 100vh;
            overflow: hidden;
        }

        #game-container {
            max-width: 1000px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            height: 95vh;
            border: 1px solid #0f0;
            background-color: #000;
            padding: 10px;
            position: relative;
        }

        #game-header {
            text-align: center;
            padding: 10px;
            border-bottom: 1px solid #0f0;
            margin-bottom: 10px;
        }

        h1 {
            font-size: 2.5rem;
            letter-spacing: 2px;
            color: #0f0;
            text-shadow: 0 0 5px #0f0;
        }

        #game-content {
            display: flex;
            flex: 1;
            gap: 15px;
            overflow: hidden;
        }

        #game-text {
            flex: 3;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #0f0;
            height: 100%;
            background-color: #111;
        }

        #game-text p {
            margin-bottom: 10px;
            font-size: 1.2rem;
            animation: fadeIn 0.3s ease-in;
        }

        #game-text p:last-child {
            margin-bottom: 0;
        }

        #game-text strong {
            color: #fff;
        }

        #game-text em {
            color: #ff0;
        }

        #game-ui {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        #party-panel {
            border: 1px solid #0f0;
            padding: 10px;
            flex: 2;
            background-color: #111;
            overflow-y: auto;
        }

        #input-panel {
            border: 1px solid #0f0;
            padding: 10px;
            flex: 1;
            background-color: #111;
            display: flex;
            flex-direction: column;
        }

        #stats-panel {
            border: 1px solid #0f0;
            padding: 10px;
            flex: 1;
            background-color: #111;
            overflow-y: auto;
        }

        .panel-title {
            color: #0f0;
            text-align: center;
            margin-bottom: 10px;
            font-size: 1.3rem;
            text-transform: uppercase;
        }

        #user-input {
            background-color: #000;
            border: 1px solid #0f0;
            color: #0f0;
            font-family: 'VT323', monospace;
            font-size: 1.2rem;
            padding: 8px;
            margin-bottom: 10px;
            width: 100%;
        }

        #submit-btn {
            background-color: #000;
            border: 1px solid #0f0;
            color: #0f0;
            font-family: 'VT323', monospace;
            font-size: 1.2rem;
            padding: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        #submit-btn:hover {
            background-color: #0f0;
            color: #000;
        }

        #command-list {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #aaa;
        }

        .character {
            margin-bottom: 10px;
            padding: 5px;
            border-bottom: 1px dashed #333;
        }

        .character-name {
            color: #0ff;
            font-weight: bold;
        }

        .character-class {
            color: #f0f;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .stat-name {
            color: #0f0;
        }

        .stat-value {
            color: #fff;
        }

        .location {
            color: #ff0;
            font-weight: bold;
        }

        .npc {
            color: #0ff;
        }

        .item {
            color: #f90;
        }

        .enemy {
            color: #f00;
        }

        .quest {
            color: #ff0;
        }

        .error {
            color: #f00;
        }

        .success {
            color: #0f0;
        }

        .gold {
            color: #ff0;
        }

        .health {
            color: #f00;
        }

        .mana {
            color: #00f;
        }

        .class-option {
            padding: 5px;
            margin: 5px 0;
            border: 1px solid #0f0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .class-option:hover {
            background-color: #0f0;
            color: #000;
        }

        .selected {
            background-color: #0f0;
            color: #000;
        }

        .blink {
            animation: blink 1s infinite;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #000;
        }

        ::-webkit-scrollbar-thumb {
            background: #0f0;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #0c0;
        }

        #game-footer {
            text-align: center;
            padding: 10px;
            border-top: 1px solid #0f0;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #0a0;
        }
        
        .command-suggestion {
            color: #0a0;
            cursor: pointer;
            text-decoration: underline;
        }
        
        .command-suggestion:hover {
            color: #0f0;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="game-header">
            <h1>RETRO TEXT ADVENTURE</h1>
            <p>AN 80s-STYLE CRPG EXPERIENCE</p>
        </div>
        
        <div id="game-content">
            <div id="game-text">
                <p>Welcome to <strong>RETRO TEXT ADVENTURE</strong>, a classic computer role-playing game experience!</p>
                <p>In this game, you will assemble a party of adventurers, explore dangerous lands, complete quests, and battle foes.</p>
                <p>Type <strong>HELP</strong> at any time for a list of commands.</p>
                <p class="blink">>> <strong>PRESS ANY KEY TO BEGIN</strong></p>
            </div>
            
            <div id="game-ui">
                <div id="party-panel">
                    <div class="panel-title">PARTY MEMBERS</div>
                    <div id="party-display">
                        <p>No party members yet.</p>
                    </div>
                </div>
                
                <div id="input-panel">
                    <div class="panel-title">COMMANDS</div>
                    <input type="text" id="user-input" placeholder="Type command here..." autocomplete="off">
                    <button id="submit-btn">EXECUTE</button>
                    <div id="command-list">
                        <p>Common: <span class="command-suggestion" onclick="document.getElementById('user-input').value='help'; processCommand()">HELP</span>, <span class="command-suggestion" onclick="document.getElementById('user-input').value='look'; processCommand()">LOOK</span>, <span class="command-suggestion" onclick="document.getElementById('user-input').value='travel'; processCommand()">TRAVEL</span>, <span class="command-suggestion" onclick="document.getElementById('user-input').value='rest'; processCommand()">REST</span>, <span class="command-suggestion" onclick="document.getElementById('user-input').value='status'; processCommand()">STATUS</span></p>
                        <p>Village: <span class="command-suggestion" onclick="document.getElementById('user-input').value='shop'; processCommand()">SHOP</span>, <span class="command-suggestion" onclick="document.getElementById('user-input').value='inn'; processCommand()">INN</span>, <span class="command-suggestion" onclick="document.getElementById('user-input').value='talk'; processCommand()">TALK</span>, <span class="command-suggestion" onclick="document.getElementById('user-input').value='quest'; processCommand()">QUEST</span></p>
                    </div>
                </div>
                
                <div id="stats-panel">
                    <div class="panel-title">GAME STATS</div>
                    <div id="stats-display">
                        <div class="stat-item">
                            <span class="stat-name">Location:</span>
                            <span class="stat-value" id="location-value">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-name">Gold:</span>
                            <span class="stat-value gold" id="gold-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-name">Day:</span>
                            <span class="stat-value" id="day-value">1</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-name">Quest:</span>
                            <span class="stat-value" id="quest-value">None</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="game-footer">
            <p>Inspired by Ultima, Wizardry, Might & Magic, and Baldur's Gate | Use arrow keys for command history</p>
        </div>
    </div>

    <script>
        // Game state
        const gameState = {
            // Party
            party: [],
            maxPartySize: 3,
            
            // Game world
            location: 'start',
            day: 1,
            gold: 50,
            currentQuest: null,
            questCompleted: false,
            
            // World locations
            locations: {
                start: {
                    name: 'The Adventurers Guild',
                    description: 'You stand in the Adventurers Guild, where brave souls gather to form parties and seek fortune.',
                    type: 'safe',
                    connections: ['rivertown']
                },
                rivertown: {
                    name: 'Rivertown',
                    description: 'A small village built alongside a rushing river. The locals seem friendly but wary of strangers.',
                    type: 'village',
                    connections: ['start', 'deepwood', 'traderspath'],
                    shops: ['weapons', 'items', 'inn'],
                    npcs: ['elder', 'merchant', 'guard']
                },
                deepwood: {
                    name: 'Deepwood Forest',
                    description: 'A dense, ancient forest with twisted trees and strange sounds echoing from the shadows.',
                    type: 'wilderness',
                    connections: ['rivertown', 'moonhills'],
                    danger: 3,
                    encounters: ['goblin', 'wolf', 'bandit']
                },
                moonhills: {
                    name: 'Moon Hills',
                    description: 'Rolling hills under an ever-present moon. Strange standing stones dot the landscape.',
                    type: 'wilderness',
                    connections: ['deepwood', 'darkmarsh', 'stonetower'],
                    danger: 4,
                    encounters: ['bandit', 'skeleton', 'ghost']
                },
                darkmarsh: {
                    name: 'Darkmarsh',
                    description: 'A foul-smelling swamp with murky waters and grasping roots. The air is thick with insects.',
                    type: 'wilderness',
                    connections: ['moonhills', 'shadowfen'],
                    danger: 5,
                    encounters: ['ghost', 'skeleton', 'zombie']
                },
                shadowfen: {
                    name: 'Shadowfen Village',
                    description: 'A gloomy village built on stilts above the marsh. The inhabitants are suspicious and secretive.',
                    type: 'village',
                    connections: ['darkmarsh'],
                    shops: ['items', 'inn', 'magic'],
                    npcs: ['witch', 'hunter', 'hermit']
                },
                stonetower: {
                    name: "Wizard's Stone Tower",
                    description: 'A tall stone tower that pierces the clouds. Arcane energy crackles in the air.',
                    type: 'special',
                    connections: ['moonhills'],
                    shops: ['magic'],
                    npcs: ['wizard']
                },
                traderspath: {
                    name: "Trader's Path",
                    description: 'A well-traveled road between settlements, but still dangerous for the unprepared.',
                    type: 'wilderness',
                    connections: ['rivertown', 'frostpeak'],
                    danger: 2,
                    encounters: ['bandit', 'wolf']
                },
                frostpeak: {
                    name: 'Frostpeak Mountains',
                    description: 'Snow-capped peaks where icy winds howl through narrow passes.',
                    type: 'wilderness',
                    connections: ['traderspath', 'dwarffort'],
                    danger: 6,
                    encounters: ['troll', 'yet', 'goblin']
                },
                dwarffort: {
                    name: 'Dwarven Fortress',
                    description: 'An imposing fortress carved into the mountain stone. The sounds of industry echo from within.',
                    type: 'village',
                    connections: ['frostpeak'],
                    shops: ['weapons', 'inn'],
                    npcs: ['dwarfking', 'smith', 'miner']
                }
            },
            
            // Character classes
            classes: [
                { id: 'warrior', name: 'Warrior', hp: 30, mp: 5, attack: 8, defense: 8, skills: ['Slash', 'Shield Bash'] },
                { id: 'wizard', name: 'Wizard', hp: 15, mp: 25, attack: 4, defense: 3, skills: ['Fireball', 'Magic Missile'] },
                { id: 'rogue', name: 'Rogue', hp: 20, mp: 10, attack: 7, defense: 5, skills: ['Backstab', 'Pick Lock'] },
                { id: 'necromancer', name: 'Necromancer', hp: 18, mp: 22, attack: 5, defense: 4, skills: ['Raise Dead', 'Drain Life'] },
                { id: 'thief', name: 'Thief', hp: 18, mp: 8, attack: 6, defense: 4, skills: ['Steal', 'Trap Disarm'] },
                { id: 'priest', name: 'Priest', hp: 22, mp: 20, attack: 3, defense: 6, skills: ['Heal', 'Turn Undead'] },
                { id: 'sorcerer', name: 'Sorcerer', hp: 16, mp: 24, attack: 5, defense: 3, skills: ['Lightning Bolt', 'Charm'] },
                { id: 'healer', name: 'Healer', hp: 20, mp: 18, attack: 2, defense: 5, skills: ['Cure Wounds', 'Restore'] }
            ],
            
            // Items
            items: {
                weapons: [
                    { name: 'Dagger', cost: 10, attack: 2 },
                    { name: 'Short Sword', cost: 25, attack: 4 },
                    { name: 'Long Sword', cost: 50, attack: 6 },
                    { name: 'Battle Axe', cost: 75, attack: 8 },
                    { name: 'Staff', cost: 20, attack: 1, mp: 5 },
                    { name: 'Mystic Wand', cost: 100, attack: 3, mp: 10 }
                ],
                armor: [
                    { name: 'Leather Armor', cost: 30, defense: 2 },
                    { name: 'Chainmail', cost: 70, defense: 4 },
                    { name: 'Plate Armor', cost: 150, defense: 6 },
                    { name: 'Robe', cost: 25, defense: 1, mp: 3 }
                ],
                potions: [
                    { name: 'Healing Potion', cost: 15, effect: 'heal', value: 10 },
                    { name: 'Mana Potion', cost: 20, effect: 'mana', value: 10 },
                    { name: 'Antidote', cost: 10, effect: 'cure', value: 0 }
                ]
            },
            
            // Quests
            quests: [
                {
                    id: 'goblinmenace',
                    name: 'Goblin Menace',
                    description: 'Clear the goblins from Deepwood Forest.',
                    location: 'deepwood',
                    reward: 50,
                    required: 'defeat goblin',
                    status: 'available'
                },
                {
                    id: 'missingminer',
                    name: 'Missing Miner',
                    description: 'Find the missing dwarf miner in the Frostpeak Mountains.',
                    location: 'frostpeak',
                    reward: 75,
                    required: 'find miner',
                    status: 'available'
                },
                {
                    id: 'wizardsrequest',
                    name: "Wizard's Request",
                    description: 'Retrieve the ancient tome from the Darkmarsh for the wizard.',
                    location: 'darkmarsh',
                    reward: 100,
                    required: 'retrieve tome',
                    status: 'available'
                }
            ],
            
            // Gameplay
            gamePhase: 'start', // start, partyCreation, playing
            commandHistory: [],
            historyIndex: -1,
            
            // Shop context
            shopContext: null
        };

        // DOM elements
        const gameText = document.getElementById('game-text');
        const userInput = document.getElementById('user-input');
        const submitBtn = document.getElementById('submit-btn');
        const partyDisplay = document.getElementById('party-display');
        const locationValue = document.getElementById('location-value');
        const goldValue = document.getElementById('gold-value');
        const dayValue = document.getElementById('day-value');
        const questValue = document.getElementById('quest-value');

        // Initialize game
        function initGame() {
            gameText.innerHTML = '';
            addText("RETRO TEXT ADVENTURE");
            addText("====================");
            addText("");
            addText("In the tradition of classic 80s CRPGs like Ultima, Wizardry, and Might & Magic.");
            addText("");
            addText("Type <strong>START</strong> to begin your adventure.");
            addText("Type <strong>HELP</strong> for a list of commands at any time.");
            
            // Set up event listeners
            submitBtn.addEventListener('click', processCommand);
            userInput.addEventListener('keyup', function(event) {
                if (event.key === 'Enter') {
                    processCommand();
                } else if (event.key === 'ArrowUp') {
                    // Navigate command history up
                    if (gameState.commandHistory.length > 0) {
                        if (gameState.historyIndex < gameState.commandHistory.length - 1) {
                            gameState.historyIndex++;
                        }
                        userInput.value = gameState.commandHistory[gameState.commandHistory.length - 1 - gameState.historyIndex];
                    }
                } else if (event.key === 'ArrowDown') {
                    // Navigate command history down
                    if (gameState.historyIndex > 0) {
                        gameState.historyIndex--;
                        userInput.value = gameState.commandHistory[gameState.commandHistory.length - 1 - gameState.historyIndex];
                    } else {
                        gameState.historyIndex = -1;
                        userInput.value = '';
                    }
                }
            });
            
            document.addEventListener('keydown', function(event) {
                if (gameState.gamePhase === 'start' && event.key !== 'Enter') {
                    addText("");
                    addText("You have entered the Adventurers Guild.");
                    addText("The Guildmaster approaches you.");
                    addText("");
                    addText("<em>'Welcome, adventurer! I see you seek fortune and glory.'</em>");
                    addText("<em>'First, you must assemble your party. Choose 1 to 3 companions from our roster.'</em>");
                    addText("");
                    addText("Type <strong>CREATE PARTY</strong> to begin.");
                    
                    gameState.gamePhase = 'partyCreation';
                    updateStats();
                    userInput.focus();
                }
            });
            
            updateStats();
        }

        // Add text to game display
        function addText(text) {
            const p = document.createElement('p');
            p.innerHTML = text;
            gameText.appendChild(p);
            gameText.scrollTop = gameText.scrollHeight;
        }

        // Process player command
        function processCommand() {
            const command = userInput.value.trim().toLowerCase();
            userInput.value = '';
            
            if (!command) return;
            
            // Add to command history
            gameState.commandHistory.push(command);
            gameState.historyIndex = -1;
            
            addText(`<strong>>></strong> ${command}`);
            
            // Process based on game phase
            switch(gameState.gamePhase) {
                case 'start':
                    handleStartPhase(command);
                    break;
                case 'partyCreation':
                    handlePartyCreation(command);
                    break;
                case 'playing':
                    handlePlayingPhase(command);
                    break;
            }
        }

        // Handle start phase commands
        function handleStartPhase(command) {
            if (command === 'start') {
                addText("");
                addText("You have entered the Adventurers Guild.");
                addText("The Guildmaster approaches you.");
                addText("");
                addText("<em>'Welcome, adventurer! I see you seek fortune and glory.'</em>");
                addText("<em>'First, you must assemble your party. Choose 1 to 3 companions from our roster.'</em>");
                addText("");
                addText("Type <strong>CREATE PARTY</strong> to begin.");
                
                gameState.gamePhase = 'partyCreation';
            } else {
                addText(`Type <strong>START</strong> to begin your adventure.`);
            }
        }

        // Handle party creation commands
        function handlePartyCreation(command) {
            if (command === 'create party' || command === 'create') {
                showClassSelection();
            } else if (command.startsWith('add ')) {
                const className = command.substring(4);
                addPartyMember(className);
            } else if (command === 'done') {
                if (gameState.party.length === 0) {
                    addText("<span class='error'>You need at least one party member to begin!</span>");
                    showClassSelection();
                } else {
                    startGame();
                }
            } else if (command === 'list classes') {
                showClassSelection();
            } else if (command === 'help') {
                addText("<strong>Party Creation Commands:</strong>");
                addText("CREATE PARTY - Show available classes");
                addText("ADD [class] - Add a character of that class to your party");
                addText("LIST CLASSES - Show available classes again");
                addText("DONE - Finish party creation and begin adventure");
                addText("");
                addText("<strong>Available Classes:</strong> Warrior, Wizard, Rogue, Necromancer, Thief, Priest, Sorcerer, Healer");
            } else {
                addText("<span class='error'>Unknown command. Type HELP for available commands.</span>");
            }
        }

        // Show class selection
        function showClassSelection() {
            addText("");
            addText("<strong>Available Adventurers:</strong>");
            
            gameState.classes.forEach(cls => {
                addText(`<span class='class-option' onclick="document.getElementById('user-input').value='add ${cls.id}'; processCommand()">${cls.name}</span> - HP: ${cls.hp}, MP: ${cls.mp}, Attack: ${cls.attack}, Defense: ${cls.defense}, Skills: ${cls.skills.join(', ')}`);
            });
            
            addText("");
            addText(`Your party has <strong>${gameState.party.length}/${gameState.maxPartySize}</strong> members.`);
            addText("Type <strong>ADD [class]</strong> to add a character (e.g. ADD warrior)");
            addText("Type <strong>DONE</strong> when your party is complete.");
        }

        // Add a party member
        function addPartyMember(className) {
            if (gameState.party.length >= gameState.maxPartySize) {
                addText(`<span class='error'>Your party is full (max ${gameState.maxPartySize}). Type DONE to continue.</span>`);
                return;
            }
            
            const classData = gameState.classes.find(c => c.id === className || c.name.toLowerCase() === className);
            
            if (!classData) {
                addText(`<span class='error'>Unknown class: ${className}. Type LIST CLASSES to see available classes.</span>`);
                return;
            }
            
            // Create character
            const charId = gameState.party.length + 1;
            const character = {
                id: charId,
                name: `${classData.name} ${charId}`,
                class: classData.name,
                hp: classData.hp,
                maxHp: classData.hp,
                mp: classData.mp,
                maxMp: classData.mp,
                attack: classData.attack,
                defense: classData.defense,
                skills: [...classData.skills],
                weapon: 'None',
                armor: 'None'
            };
            
            gameState.party.push(character);
            updatePartyDisplay();
            
            addText(`<span class='success'>Added ${character.name} to your party.</span>`);
            addText(`Your party now has <strong>${gameState.party.length}/${gameState.maxPartySize}</strong> members.`);
            
            if (gameState.party.length >= gameState.maxPartySize) {
                addText("<span class='blink'>Your party is full! Type DONE to begin your adventure.</span>");
            }
        }

        // Start the game proper
        function startGame() {
            gameState.gamePhase = 'playing';
            gameState.location = 'start';
            
            addText("");
            addText("<span class='success'>Your party is assembled! The adventure begins...</span>");
            addText("");
            addText("The Guildmaster nods approvingly at your party.");
            addText("<em>'Excellent choices! Now, the real challenge begins.'</em>");
            addText("<em>'You should start by traveling to Rivertown. Just type TRAVEL RIVERTOWN.'</em>");
            addText("");
            addText("You are at the <span class='location'>Adventurers Guild</span>.");
            addText("Type <strong>LOOK</strong> to examine your surroundings.");
            addText("Type <strong>HELP</strong> for a list of commands.");
            
            updateStats();
        }

        // Handle playing phase commands - FIXED VERSION
        function handlePlayingPhase(command) {
            const parts = command.split(' ');
            const cmd = parts[0];
            const arg = parts.slice(1).join(' ');
            
            // Check if we're in shop context
            if (gameState.shopContext) {
                // If in shop context, treat the command as a shop action
                if (cmd === 'back' || cmd === 'exit') {
                    gameState.shopContext = null;
                    addText("You leave the shop.");
                    return;
                } else if (cmd === 'buy') {
                    buyItem(arg || command);
                    return;
                } else if (cmd === 'look' || cmd === 'list') {
                    // Show shop items again
                    showShopItems(gameState.shopContext);
                    return;
                } else {
                    // Try to buy with just the item name
                    buyItem(command);
                    return;
                }
            }
            
            // Normal command processing
            switch(cmd) {
                case 'help':
                    showHelp();
                    break;
                case 'look':
                    lookAround();
                    break;
                case 'travel':
                    travel(arg);
                    break;
                case 'status':
                    showStatus();
                    break;
                case 'party':
                    showParty();
                    break;
                case 'shop':
                    visitShop(arg);
                    break;
                case 'buy':
                    buyItem(arg);
                    break;
                case 'inn':
                    visitInn();
                    break;
                case 'rest':
                    rest();
                    break;
                case 'talk':
                    talkTo(arg);
                    break;
                case 'quest':
                    checkQuests();
                    break;
                case 'accept':
                    acceptQuest(arg);
                    break;
                case 'gold':
                    addText(`You have <span class='gold'>${gameState.gold} gold</span>.`);
                    break;
                case 'map':
                    showMap();
                    break;
                case 'attack':
                    randomEncounter();
                    break;
                // Handle direct shop type commands
                case 'weapons':
                case 'items':
                case 'magic':
                    // Check if current location has this shop
                    const loc = gameState.locations[gameState.location];
                    if (loc.shops && loc.shops.includes(cmd)) {
                        visitShop(cmd);
                    } else {
                        addText(`<span class='error'>There is no ${cmd} shop here.</span>`);
                    }
                    break;
                default:
                    addText("<span class='error'>Unknown command. Type HELP for available commands.</span>");
            }
        }

        // Show help
        function showHelp() {
            addText("<strong>Available Commands:</strong>");
            addText("<strong>HELP</strong> - Show this help message");
            addText("<strong>LOOK</strong> - Examine your surroundings");
            addText("<strong>TRAVEL [location]</strong> - Travel to another location");
            addText("<strong>STATUS</strong> - Show party status");
            addText("<strong>PARTY</strong> - Show detailed party information");
            addText("<strong>SHOP [type]</strong> - Visit a shop (weapons, items, magic)");
            addText("<strong>BUY [item]</strong> - Purchase an item");
            addText("<strong>INN</strong> - Visit the inn to rest");
            addText("<strong>REST</strong> - Rest to recover HP/MP");
            addText("<strong>TALK [npc]</strong> - Talk to an NPC");
            addText("<strong>QUEST</strong> - Check available quests");
            addText("<strong>ACCEPT [quest]</strong> - Accept a quest");
            addText("<strong>GOLD</strong> - Check your gold");
            addText("<strong>MAP</strong> - Show world map");
            addText("<strong>ATTACK</strong> - Trigger a random encounter (dangerous!)");
            addText("");
            addText("<strong>In shops:</strong> Type <strong>BUY [item]</strong> to purchase, <strong>LIST</strong> to see items again, <strong>BACK</strong> to leave shop.");
        }

        // Look around current location
        function lookAround() {
            const loc = gameState.locations[gameState.location];
            addText(`You are at <span class='location'>${loc.name}</span>.`);
            addText(loc.description);
            
            if (loc.connections) {
                addText("<strong>Connections:</strong> " + loc.connections.map(c => gameState.locations[c].name).join(', '));
            }
            
            if (loc.shops) {
                addText("<strong>Shops:</strong> " + loc.shops.map(s => {
                    if (s === 'weapons') return 'Weapon Shop';
                    if (s === 'items') return 'Item Shop';
                    if (s === 'magic') return 'Magic Shop';
                    if (s === 'inn') return 'Inn';
                    return s;
                }).join(', '));
            }
            
            if (loc.npcs) {
                addText("<strong>NPCs:</strong> " + loc.npcs.map(n => {
                    if (n === 'elder') return 'Village Elder';
                    if (n === 'merchant') return 'Merchant';
                    if (n === 'guard') return 'Town Guard';
                    if (n === 'witch') return 'Swamp Witch';
                    if (n === 'hunter') return 'Marsh Hunter';
                    if (n === 'hermit') return 'Hermit';
                    if (n === 'wizard') return 'Archmage';
                    if (n === 'dwarfking') return 'Dwarf King';
                    if (n === 'smith') return 'Blacksmith';
                    if (n === 'miner') return 'Miner';
                    return n;
                }).join(', '));
            }
            
            if (loc.type === 'wilderness') {
                addText(`<span class='error'>This area is dangerous! Enemies may appear at any time.</span>`);
            }
        }

        // Travel to a location
        function travel(locationName) {
            if (!locationName) {
                addText("Travel where? Type TRAVEL [location].");
                if (gameState.location === 'start') {
                    addText("From here you can travel to: <strong>RIVERTOWN</strong>");
                } else {
                    const loc = gameState.locations[gameState.location];
                    addText("From here you can travel to: " + loc.connections.map(c => `<strong>${gameState.locations[c].name.toUpperCase().replace(' ', '')}</strong>`).join(', '));
                }
                return;
            }
            
            // Find location by name or partial match
            const currentLoc = gameState.locations[gameState.location];
            const targetLocKey = currentLoc.connections.find(conn => 
                gameState.locations[conn].name.toLowerCase().includes(locationName.toLowerCase()) ||
                conn.toLowerCase().includes(locationName.toLowerCase())
            );
            
            if (!targetLocKey) {
                addText(`<span class='error'>You cannot travel to ${locationName} from here.</span>`);
                addText("Available destinations: " + currentLoc.connections.map(c => gameState.locations[c].name).join(', '));
                return;
            }
            
            const targetLoc = gameState.locations[targetLocKey];
            
            // Check if it's wilderness travel
            if (currentLoc.type === 'wilderness' || targetLoc.type === 'wilderness') {
                addText(`You journey from ${currentLoc.name} to ${targetLoc.name}...`);
                
                // Chance of random encounter
                const encounterChance = targetLoc.danger ? targetLoc.danger * 0.2 : 0.3;
                if (Math.random() < encounterChance) {
                    addText("<span class='enemy'>Ambush! Enemies attack!</span>");
                    randomEncounter();
                } else {
                    addText("The journey passes without incident.");
                }
                
                // Increase day counter for travel
                gameState.day++;
            }
            
            gameState.location = targetLocKey;
            addText(`You arrive at <span class='location'>${targetLoc.name}</span>.`);
            
            // Clear shop context when changing locations
            gameState.shopContext = null;
            
            // Describe location
            lookAround();
            
            // Update stats
            updateStats();
        }

        // Random encounter
        function randomEncounter() {
            const loc = gameState.locations[gameState.location];
            
            if (loc.type !== 'wilderness') {
                addText("<span class='error'>There are no enemies here.</span>");
                return;
            }
            
            const enemies = ['Goblin', 'Wolf', 'Bandit', 'Skeleton', 'Zombie', 'Ghost', 'Troll', 'Yeti'];
            const enemy = enemies[Math.floor(Math.random() * enemies.length)];
            
            addText(`<span class='enemy'>A wild ${enemy} appears!</span>`);
            
            // Simple combat resolution
            const partyAttack = gameState.party.reduce((sum, char) => sum + char.attack, 0);
            const partyDefense = gameState.party.reduce((sum, char) => sum + char.defense, 0);
            
            const enemyPower = loc.danger * 5;
            
            if (partyAttack > enemyPower * 0.7) {
                const goldGained = Math.floor(Math.random() * 20 * loc.danger) + 5;
                gameState.gold += goldGained;
                
                addText(`<span class='success'>Your party defeats the ${enemy}!</span>`);
                addText(`You find <span class='gold'>${goldGained} gold</span> on the body.`);
                
                // Check if this completes a quest
                if (gameState.currentQuest && gameState.currentQuest.required === `defeat ${enemy.toLowerCase()}`) {
                    completeQuest();
                }
            } else {
                const damage = Math.floor(enemyPower / 3);
                
                addText(`<span class='error'>The ${enemy} wounds your party!</span>`);
                addText(`Each party member takes <span class='health'>${damage} damage</span>.`);
                
                // Apply damage to all party members
                gameState.party.forEach(char => {
                    char.hp = Math.max(1, char.hp - damage);
                });
                
                updatePartyDisplay();
                
                addText("You manage to escape, but you're badly hurt.");
                addText("Visit an <strong>INN</strong> to rest and recover.");
            }
        }

        // Show party status
        function showStatus() {
            addText("<strong>Party Status:</strong>");
            
            gameState.party.forEach(char => {
                const hpPercent = Math.floor((char.hp / char.maxHp) * 100);
                const mpPercent = char.maxMp > 0 ? Math.floor((char.mp / char.maxMp) * 100) : 0;
                
                addText(`${char.name} - <span class='health'>HP: ${char.hp}/${char.maxHp} (${hpPercent}%)</span>, <span class='mana'>MP: ${char.mp}/${char.maxMp} (${mpPercent}%)</span>`);
            });
            
            addText(`<span class='gold'>Gold: ${gameState.gold}</span>`);
            addText(`Day: ${gameState.day}`);
            
            if (gameState.currentQuest) {
                addText(`<span class='quest'>Current Quest: ${gameState.currentQuest.name}</span>`);
            }
        }

        // Show party details
        function showParty() {
            addText("<strong>Party Details:</strong>");
            
            gameState.party.forEach(char => {
                addText(`<strong>${char.name}</strong> the ${char.class}`);
                addText(`  HP: ${char.hp}/${char.maxHp}, MP: ${char.mp}/${char.maxMp}`);
                addText(`  Attack: ${char.attack}, Defense: ${char.defense}`);
                addText(`  Weapon: ${char.weapon}, Armor: ${char.armor}`);
                addText(`  Skills: ${char.skills.join(', ')}`);
                addText("");
            });
        }

        // Visit a shop
        function visitShop(shopType) {
            const loc = gameState.locations[gameState.location];
            
            if (!loc.shops || loc.shops.length === 0) {
                addText("<span class='error'>There are no shops here.</span>");
                return;
            }
            
            if (!shopType) {
                addText("Which shop? Available: " + loc.shops.map(s => {
                    if (s === 'weapons') return 'WEAPONS';
                    if (s === 'items') return 'ITEMS';
                    if (s === 'magic') return 'MAGIC';
                    if (s === 'inn') return 'INN';
                    return s.toUpperCase();
                }).join(', '));
                addText("Type <strong>SHOP [type]</strong> or just type the shop name (e.g., <strong>WEAPONS</strong>).");
                return;
            }
            
            if (shopType === 'inn') {
                visitInn();
                return;
            }
            
            if (!loc.shops.includes(shopType)) {
                addText(`<span class='error'>There is no ${shopType} shop here.</span>`);
                return;
            }
            
            // Set shop context
            gameState.shopContext = shopType;
            
            addText(`<strong>${shopType.charAt(0).toUpperCase() + shopType.slice(1)} Shop</strong>`);
            addText(`You have <span class='gold'>${gameState.gold} gold</span>.`);
            addText("");
            
            showShopItems(shopType);
        }
        
        // Show shop items
        function showShopItems(shopType) {
            if (shopType === 'weapons') {
                addText("<strong>Weapons for sale:</strong>");
                gameState.items.weapons.forEach(item => {
                    addText(`  <span class='item'>${item.name}</span> - <span class='gold'>${item.cost} gold</span> (Attack: +${item.attack}${item.mp ? `, MP: +${item.mp}` : ''})`);
                });
                addText("");
                addText("Type <strong>BUY [item name]</strong> to purchase.");
                addText("Type <strong>BACK</strong> or <strong>EXIT</strong> to leave the shop.");
            } else if (shopType === 'items') {
                addText("<strong>Items for sale:</strong>");
                gameState.items.armor.forEach(item => {
                    addText(`  <span class='item'>${item.name}</span> - <span class='gold'>${item.cost} gold</span> (Defense: +${item.defense}${item.mp ? `, MP: +${item.mp}` : ''})`);
                });
                addText("");
                gameState.items.potions.forEach(item => {
                    addText(`  <span class='item'>${item.name}</span> - <span class='gold'>${item.cost} gold</span> (${item.effect === 'heal' ? 'Restores 10 HP' : item.effect === 'mana' ? 'Restores 10 MP' : 'Cures poison'})`);
                });
                addText("");
                addText("Type <strong>BUY [item name]</strong> to purchase.");
                addText("Type <strong>BACK</strong> or <strong>EXIT</strong> to leave the shop.");
            } else if (shopType === 'magic') {
                addText("<strong>Magic items for sale:</strong>");
                addText("  <span class='item'>Mystic Wand</span> - <span class='gold'>100 gold</span> (Attack: +3, MP: +10)");
                addText("  <span class='item'>Robe</span> - <span class='gold'>25 gold</span> (Defense: +1, MP: +3)");
                addText("  <span class='item'>Mana Potion</span> - <span class='gold'>20 gold</span> (Restores 10 MP)");
                addText("");
                addText("Type <strong>BUY [item name]</strong> to purchase.");
                addText("Type <strong>BACK</strong> or <strong>EXIT</strong> to leave the shop.");
            }
        }

        // Buy an item
        function buyItem(itemName) {
            if (!itemName) {
                addText("Buy what? Type BUY [item name] or just type the item name.");
                return;
            }
            
            // Check if we're in a shop context
            if (!gameState.shopContext) {
                addText("<span class='error'>You're not in a shop. Visit a shop first with SHOP command.</span>");
                return;
            }
            
            // Find item based on shop type
            let item = null;
            let category = null;
            
            // Check weapons
            if (gameState.shopContext === 'weapons' || gameState.shopContext === 'magic') {
                item = gameState.items.weapons.find(i => i.name.toLowerCase().includes(itemName.toLowerCase()));
                if (item) category = 'weapon';
                
                // Check magic shop items
                if (!item && gameState.shopContext === 'magic') {
                    if (itemName.toLowerCase().includes('mystic wand')) {
                        item = { name: 'Mystic Wand', cost: 100, attack: 3, mp: 10 };
                        category = 'weapon';
                    } else if (itemName.toLowerCase().includes('robe')) {
                        item = { name: 'Robe', cost: 25, defense: 1, mp: 3 };
                        category = 'armor';
                    } else if (itemName.toLowerCase().includes('mana potion')) {
                        item = { name: 'Mana Potion', cost: 20, effect: 'mana', value: 10 };
                        category = 'potion';
                    }
                }
            }
            
            // Check armor (in items shop)
            if (!item && gameState.shopContext === 'items') {
                item = gameState.items.armor.find(i => i.name.toLowerCase().includes(itemName.toLowerCase()));
                if (item) category = 'armor';
            }
            
            // Check potions (in items shop)
            if (!item && gameState.shopContext === 'items') {
                item = gameState.items.potions.find(i => i.name.toLowerCase().includes(itemName.toLowerCase()));
                if (item) category = 'potion';
            }
            
            if (!item) {
                addText(`<span class='error'>No item named '${itemName}' available in this shop.</span>`);
                // Show shop items again
                showShopItems(gameState.shopContext);
                return;
            }
            
            // Check gold
            if (gameState.gold < item.cost) {
                addText(`<span class='error'>You need ${item.cost} gold to buy ${item.name}, but you only have ${gameState.gold} gold.</span>`);
                return;
            }
            
            // Purchase item
            gameState.gold -= item.cost;
            
            if (category === 'potion') {
                addText(`<span class='success'>You bought a ${item.name} for ${item.cost} gold.</span>`);
                addText("Potions are consumed automatically when needed.");
            } else {
                // Equip to first party member who can use it
                let equipped = false;
                
                for (const char of gameState.party) {
                    if (category === 'weapon' && !equipped) {
                        const oldWeapon = char.weapon;
                        char.weapon = item.name;
                        char.attack += item.attack;
                        if (item.mp) char.maxMp += item.mp;
                        addText(`<span class='success'>${char.name} equips ${item.name} (replacing ${oldWeapon}) for ${item.cost} gold.</span>`);
                        equipped = true;
                    } else if (category === 'armor' && !equipped) {
                        const oldArmor = char.armor;
                        char.armor = item.name;
                        char.defense += item.defense;
                        if (item.mp) char.maxMp += item.mp;
                        addText(`<span class='success'>${char.name} equips ${item.name} (replacing ${oldArmor}) for ${item.cost} gold.</span>`);
                        equipped = true;
                    }
                }
                
                if (!equipped) {
                    addText(`<span class='error'>No party member can equip this item.</span>`);
                    gameState.gold += item.cost; // Refund
                }
            }
            
            updatePartyDisplay();
            updateStats();
            
            // Show remaining gold
            addText(`You have <span class='gold'>${gameState.gold} gold</span> remaining.`);
        }

        // Visit inn
        function visitInn() {
            const loc = gameState.locations[gameState.location];
            
            if (!loc.shops || !loc.shops.includes('inn')) {
                addText("<span class='error'>There is no inn here.</span>");
                return;
            }
            
            const cost = 10;
            
            addText(`<strong>Welcome to the inn!</strong>`);
            addText(`A night's rest costs <span class='gold'>${cost} gold</span>.`);
            addText("Type <strong>REST</strong> to stay the night and recover your party.");
            addText(`You have <span class='gold'>${gameState.gold} gold</span>.`);
        }

        // Rest at inn
        function rest() {
            const loc = gameState.locations[gameState.location];
            
            if (!loc.shops || !loc.shops.includes('inn')) {
                addText("<span class='error'>You cannot rest here. Find an inn.</span>");
                return;
            }
            
            const cost = 10;
            
            if (gameState.gold < cost) {
                addText(`<span class='error'>You need ${cost} gold to rest at the inn, but you only have ${gameState.gold} gold.</span>`);
                return;
            }
            
            gameState.gold -= cost;
            gameState.day++;
            
            // Fully heal party
            gameState.party.forEach(char => {
                char.hp = char.maxHp;
                char.mp = char.maxMp;
            });
            
            addText(`<span class='success'>You rest at the inn for ${cost} gold.</span>`);
            addText("Your party is fully healed!");
            addText(`A new day dawns. It is now day ${gameState.day}.`);
            
            updatePartyDisplay();
            updateStats();
        }

        // Talk to NPC
        function talkTo(npcName) {
            if (!npcName) {
                addText("Talk to whom? Type TALK [npc name].");
                return;
            }
            
            const loc = gameState.locations[gameState.location];
            
            if (!loc.npcs || loc.npcs.length === 0) {
                addText("<span class='error'>There are no NPCs here to talk to.</span>");
                return;
            }
            
            // Find NPC
            const npc = loc.npcs.find(n => {
                const npcMap = {
                    'elder': 'village elder',
                    'merchant': 'merchant',
                    'guard': 'town guard',
                    'witch': 'swamp witch',
                    'hunter': 'marsh hunter',
                    'hermit': 'hermit',
                    'wizard': 'archmage',
                    'dwarfking': 'dwarf king',
                    'smith': 'blacksmith',
                    'miner': 'miner'
                };
                
                const npcDisplayName = npcMap[n] || n;
                return npcDisplayName.includes(npcName.toLowerCase()) || n.includes(npcName.toLowerCase());
            });
            
            if (!npc) {
                addText(`<span class='error'>There is no '${npcName}' here. Available NPCs: ${loc.npcs.map(n => {
                    if (n === 'elder') return 'Village Elder';
                    if (n === 'merchant') return 'Merchant';
                    if (n === 'guard') return 'Town Guard';
                    if (n === 'witch') return 'Swamp Witch';
                    if (n === 'hunter') return 'Marsh Hunter';
                    if (n === 'hermit') return 'Hermit';
                    if (n === 'wizard') return 'Archmage';
                    if (n === 'dwarfking') return 'Dwarf King';
                    if (n === 'smith') return 'Blacksmith';
                    if (n === 'miner') return 'Miner';
                    return n;
                }).join(', ')}</span>`);
                return;
            }
            
            // NPC dialogue
            const dialogues = {
                elder: [
                    "<em>'Welcome to our village, travelers. We've been having trouble with goblins in the forest.'</em>",
                    "<em>'If you clear them out, we would reward you handsomely.'</em>"
                ],
                merchant: [
                    "<em>'I have the finest goods in all the land! Visit my shop if you need supplies.'</em>"
                ],
                guard: [
                    "<em>'Stay safe out there. The roads are dangerous these days.'</em>"
                ],
                witch: [
                    "<em>'The swamp holds many secrets... and many dangers.'</em>",
                    "<em>'I seek an ancient tome lost in the marsh. Bring it to me and I'll reward you.'</em>"
                ],
                hunter: [
                    "<em>'I've seen strange creatures deeper in the swamp. Take care if you go that way.'</em>"
                ],
                hermit: [
                    "<em>'Leave me alone! I have no business with outsiders.'</em>"
                ],
                wizard: [
                    "<em>'Ah, adventurers! I have a task for those brave enough.'</em>",
                    "<em>'Retrieve the Tome of Ages from the Darkmarsh and I shall grant you powerful magic.'</em>"
                ],
                dwarfking: [
                    "<em>'Greetings, surface-dwellers. One of our miners is missing in the mountains.'</em>",
                    "<em>'Find him and bring him back, and the dwarves will be in your debt.'</em>"
                ],
                smith: [
                    "<em>'I forge the finest weapons this side of the mountains. Check my wares!'</em>"
                ],
                miner: [
                    "<em>'I heard there's valuable ore in the deepest caves, but it's too dangerous for me.'</em>"
                ]
            };
            
            const npcDisplayName = {
                elder: 'Village Elder',
                merchant: 'Merchant',
                guard: 'Town Guard',
                witch: 'Swamp Witch',
                hunter: 'Marsh Hunter',
                hermit: 'Hermit',
                wizard: 'Archmage',
                dwarfking: 'Dwarf King',
                smith: 'Blacksmith',
                miner: 'Miner'
            }[npc] || npc;
            
            addText(`You talk to <span class='npc'>${npcDisplayName}</span>:`);
            
            if (dialogues[npc]) {
                dialogues[npc].forEach(line => addText(line));
                
                // Hint about quests
                if (npc === 'elder' && !gameState.currentQuest) {
                    addText("<span class='quest'>Quest available: GOBLIN MENACE (type QUEST to learn more)</span>");
                } else if (npc === 'wizard' && !gameState.currentQuest) {
                    addText("<span class='quest'>Quest available: WIZARD'S REQUEST (type QUEST to learn more)</span>");
                } else if (npc === 'dwarfking' && !gameState.currentQuest) {
                    addText("<span class='quest'>Quest available: MISSING MINER (type QUEST to learn more)</span>");
                }
            } else {
                addText("<em>'I have nothing to say to you.'</em>");
            }
        }

        // Check available quests
        function checkQuests() {
            const loc = gameState.locations[gameState.location];
            
            addText("<strong>Available Quests:</strong>");
            
            const availableQuests = gameState.quests.filter(q => q.status === 'available');
            
            if (availableQuests.length === 0) {
                addText("No quests available at this time.");
                return;
            }
            
            availableQuests.forEach(quest => {
                addText(`<span class='quest'>${quest.name}</span>: ${quest.description}`);
                addText(`  Location: ${gameState.locations[quest.location].name}`);
                addText(`  Reward: <span class='gold'>${quest.reward} gold</span>`);
                addText(`  Type <strong>ACCEPT ${quest.name.toUpperCase().replace(' ', '')}</strong> to accept this quest.`);
                addText("");
            });
            
            if (gameState.currentQuest) {
                addText("");
                addText("<strong>Current Quest:</strong>");
                addText(`${gameState.currentQuest.name}: ${gameState.currentQuest.description}`);
            }
        }

        // Accept a quest
        function acceptQuest(questName) {
            if (!questName) {
                addText("Accept which quest? Type ACCEPT [quest name].");
                return;
            }
            
            if (gameState.currentQuest) {
                addText(`<span class='error'>You already have an active quest: ${gameState.currentQuest.name}. Complete it first.</span>`);
                return;
            }
            
            // Find quest
            const quest = gameState.quests.find(q => 
                q.name.toLowerCase().includes(questName.toLowerCase()) ||
                q.id.toLowerCase().includes(questName.toLowerCase())
            );
            
            if (!quest) {
                addText(`<span class='error'>No quest named '${questName}'. Type QUEST to see available quests.</span>`);
                return;
            }
            
            if (quest.status !== 'available') {
                addText(`<span class='error'>This quest is not available.</span>`);
                return;
            }
            
            gameState.currentQuest = quest;
            quest.status = 'active';
            
            addText(`<span class='success'>Quest accepted: ${quest.name}!</span>`);
            addText(`${quest.description}`);
            addText(`Travel to <span class='location'>${gameState.locations[quest.location].name}</span> to complete it.`);
            
            updateStats();
        }

        // Complete current quest
        function completeQuest() {
            if (!gameState.currentQuest) return;
            
            const reward = gameState.currentQuest.reward;
            gameState.gold += reward;
            
            addText(`<span class='success'>Quest completed: ${gameState.currentQuest.name}!</span>`);
            addText(`You receive <span class='gold'>${reward} gold</span> as reward.`);
            
            // Mark quest as completed
            const quest = gameState.quests.find(q => q.id === gameState.currentQuest.id);
            if (quest) quest.status = 'completed';
            
            gameState.currentQuest = null;
            gameState.questCompleted = true;
            
            updateStats();
        }

        // Show world map
        function showMap() {
            addText("<strong>World Map:</strong>");
            addText("  [Start] --> Rivertown");
            addText("  Rivertown --> Deepwood Forest --> Moon Hills");
            addText("  Moon Hills --> Darkmarsh --> Shadowfen Village");
            addText("  Moon Hills --> Stone Tower");
            addText("  Rivertown --> Trader's Path --> Frostpeak Mountains");
            addText("  Frostpeak Mountains --> Dwarven Fortress");
            addText("");
            addText("Your location: <span class='location'>" + gameState.locations[gameState.location].name + "</span>");
        }

        // Update party display
        function updatePartyDisplay() {
            partyDisplay.innerHTML = "";
            
            if (gameState.party.length === 0) {
                partyDisplay.innerHTML = "<p>No party members yet.</p>";
                return;
            }
            
            gameState.party.forEach(char => {
                const charDiv = document.createElement('div');
                charDiv.className = 'character';
                
                const hpPercent = Math.floor((char.hp / char.maxHp) * 100);
                const mpPercent = char.maxMp > 0 ? Math.floor((char.mp / char.maxMp) * 100) : 0;
                
                charDiv.innerHTML = `
                    <div class="character-name">${char.name}</div>
                    <div class="character-class">${char.class}</div>
                    <div class="health">HP: ${char.hp}/${char.maxHp} (${hpPercent}%)</div>
                    <div class="mana">MP: ${char.mp}/${char.maxMp} (${mpPercent}%)</div>
                    <div>Weapon: ${char.weapon}</div>
                    <div>Armor: ${char.armor}</div>
                `;
                
                partyDisplay.appendChild(charDiv);
            });
        }

        // Update game stats display
        function updateStats() {
            locationValue.textContent = gameState.locations[gameState.location].name;
            goldValue.textContent = gameState.gold;
            dayValue.textContent = gameState.day;
            questValue.textContent = gameState.currentQuest ? gameState.currentQuest.name : "None";
        }

        // Initialize the game when page loads
        window.onload = initGame;
    </script>
</body>
</html>
