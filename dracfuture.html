<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Cyber Vampire: Neon Nights</title>
<style>
:root {
  --blood-red: #ff003c;
  --neon-purple: #b967ff;
  --neon-blue: #00f3ff;
  --cyber-yellow: #ffd300;
  --dark-bg: #0a0a14;
  --panel-bg: rgba(10, 10, 30, 0.9);
  --text-color: #e0e0ff;
  --grid-color: rgba(0, 243, 255, 0.15);
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  font-family: 'Rajdhani', sans-serif;
}

body {
  margin: 0;
  padding: 0;
  background-color: var(--dark-bg);
  color: var(--text-color);
  touch-action: manipulation;
  overflow: hidden;
  height: 100vh;
  user-select: none;
  -webkit-user-select: none;
  background-image: 
    linear-gradient(to bottom, rgba(10, 10, 30, 0.9), rgba(5, 5, 15, 0.95)),
    url('https://images.unsplash.com/photo-1535223289827-42f1e9919769?q=80');
  background-size: cover;
  background-position: center;
  position: relative;
  line-height: 1.5;
}

/* Scanlines effect */
body::after {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    repeating-linear-gradient(
      0deg,
      rgba(0, 243, 255, 0.05),
      rgba(0, 243, 255, 0.05) 1px,
      transparent 1px,
      transparent 2px
    );
  pointer-events: none;
  z-index: 100;
}

/* Grid overlay */
body::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    linear-gradient(90deg, var(--grid-color) 1px, transparent 1px),
    linear-gradient(0deg, var(--grid-color) 1px, transparent 1px);
  background-size: 20px 20px;
  pointer-events: none;
  z-index: 1;
}

/* Particle Effects */
.particle {
  position: absolute;
  background-color: var(--neon-blue);
  border-radius: 50%;
  pointer-events: none;
  z-index: 10;
}

.damage-number {
  position: absolute;
  color: var(--blood-red);
  font-weight: bold;
  font-size: 1.5em;
  text-shadow: 0 0 5px rgba(255, 0, 60, 0.7);
  pointer-events: none;
  z-index: 20;
  animation: floatUp 1s forwards;
  font-family: 'Orbitron', sans-serif;
}

@keyframes floatUp {
  0% { transform: translateY(0); opacity: 1; }
  100% { transform: translateY(-50px); opacity: 0; }
}

/* Game Container */
#game-container {
  width: 100%;
  height: 100vh;
  display: flex;
  flex-direction: column;
  position: relative;
  z-index: 2;
  background-color: rgba(5, 5, 15, 0.7);
  border: 1px solid var(--neon-purple);
  box-shadow: 0 0 20px rgba(185, 103, 255, 0.3);
  overflow: hidden;
}

/* Header Section */
#header {
  background: linear-gradient(to bottom, rgba(30, 10, 40, 0.8), rgba(15, 5, 25, 0.9));
  padding: 12px 10px;
  border-bottom: 1px solid var(--neon-purple);
  text-align: center;
  font-size: 1.1em;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: relative;
  font-family: 'Orbitron', sans-serif;
  text-shadow: 0 0 5px rgba(185, 103, 255, 0.7);
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.7);
  z-index: 5;
  letter-spacing: 1px;
}

#equipped-weapon {
  font-size: 0.8em;
  color: var(--neon-blue);
  font-style: italic;
}

#transformation-status {
  font-size: 0.9em;
  color: var(--neon-purple);
  margin-left: 50px;
  text-transform: uppercase;
  letter-spacing: 1px;
  text-shadow: 0 0 3px rgba(185, 103, 255, 0.5);
}

/* Day/Night Display */
#time-container {
  display: flex;
  align-items: center;
  gap: 8px;
}

#time-indicator {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  background: var(--cyber-yellow);
  position: relative;
  border: 1px solid var(--neon-blue);
  box-shadow: 0 0 10px rgba(255, 211, 0, 0.5);
}

#day-night-indicator {
  font-size: 0.85em;
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* Enemy Stats */
#enemy-stats {
  background: linear-gradient(to bottom, rgba(30, 10, 40, 0.8), rgba(15, 5, 25, 0.9));
  padding: 12px 10px;
  border-bottom: 1px solid var(--neon-purple);
  font-size: 0.95em;
  text-align: center;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.7);
  position: relative;
}

.enemy-health-container {
  flex: 1;
}

#enemy-stats .enemy-name {
  font-weight: bold;
  font-size: 14px;
  color: var(--neon-blue);
  text-shadow: 0 0 3px var(--neon-blue);
  font-family: 'Orbitron', sans-serif;
  letter-spacing: 1px;
  text-transform: uppercase;
}

#enemy-stats .enemy-hp {
  color: var(--neon-blue);
  font-size: 12px;
  text-shadow: 0 0 3px var(--neon-blue);
}

#enemy-stats .enemy-dmg {
  color: var(--blood-red);
  margin-right: 100px;
  font-size: 12px;
  text-shadow: 0 0 3px var(--blood-red);
}

#enemy-hp-bar {
  height: 8px;
  background-color: rgba(30, 10, 40, 0.7);
  margin-top: 5px;
  border-radius: 5px;
  overflow: hidden;
  border: 1px solid var(--neon-purple);
}

#enemy-hp-fill {
  height: 100%;
  background: linear-gradient(to right, var(--blood-red), #ff0055);
  width: 100%;
  transition: width 0.3s;
  box-shadow: 0 0 5px rgba(255, 0, 60, 0.7);
}

/* Enemy Weakness Indicator */
.enemy-weakness {
  position: absolute;
  top: -15px;
  right: 10px;
  font-size: 0.7em;
  padding: 3px 8px;
  border-radius: 3px;
  background-color: rgba(30, 10, 40, 0.9);
  border: 1px solid var(--neon-purple);
  color: var(--neon-blue);
  text-transform: uppercase;
  letter-spacing: 1px;
  font-family: 'Orbitron', sans-serif;
}

/* Main Display */
#main-display {
  flex: 1;
  padding: 15px;
  background-color: rgba(10, 5, 20, 0.8);
  border-bottom: 1px solid var(--neon-purple);
  overflow-y: auto;
  font-size: 1.1em;
  border-left: 1px solid rgba(0, 243, 255, 0.1);
  border-right: 1px solid rgba(0, 243, 255, 0.1);
  box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
  position: relative;
}

#combat-log {
  height: 100%;
  overflow-y: auto;
  padding-right: 5px;
}

.combat-entry {
  margin-bottom: 10px;
  animation: fadeIn 0.3s;
  padding: 8px;
  border-left: 2px solid transparent;
  transition: all 0.2s;
  border-radius: 3px;
  background: rgba(20, 10, 40, 0.3);
  border: 1px solid rgba(185, 103, 255, 0.1);
}

.combat-entry:hover {
  background-color: rgba(30, 15, 50, 0.5);
  border-left: 2px solid var(--neon-purple);
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(5px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Message Types */
.player-action {
  color: var(--neon-blue);
}

.enemy-action {
  color: var(--blood-red);
}

.system-message {
  color: var(--cyber-yellow);
  font-style: italic;
}

.loot-message {
  color: var(--neon-purple);
}

.transformation-message {
  color: var(--neon-purple);
  font-weight: bold;
}

.critical-hit {
  color: #ff6b6b;
  font-weight: bold;
  animation: pulse 0.5s infinite alternate;
}

@keyframes pulse {
  from { text-shadow: 0 0 5px #ff6b6b; }
  to { text-shadow: 0 0 10px #ff6b6b, 0 0 20px #ff6b6b; }
}

.dodge-message {
  color: var(--neon-blue);
  font-weight: bold;
}

.curse-message {
  color: var(--neon-purple);
  font-weight: bold;
}

.xp-message {
  color: var(--neon-blue);
}

.level-up-message {
  color: var(--cyber-yellow);
  font-weight: bold;
  animation: glow 1s infinite alternate;
  text-shadow: 0 0 5px var(--cyber-yellow);
}

@keyframes glow {
  from { text-shadow: 0 0 5px var(--cyber-yellow); }
  to { text-shadow: 0 0 10px var(--cyber-yellow), 0 0 20px var(--cyber-yellow); }
}

/* Stats Panel */
#stats-panel {
  display: flex;
  justify-content: space-between;
  background: linear-gradient(to bottom, rgba(30, 10, 40, 0.8), rgba(15, 5, 25, 0.9));
  padding: 12px 10px;
  border-bottom: 1px solid var(--neon-purple);
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.7);
}

.stat-box {
  text-align: center;
  flex: 1;
  position: relative;
  padding: 5px;
  border-right: 1px solid rgba(185, 103, 255, 0.2);
}

.stat-box:last-child {
  border-right: none;
}

.stat-box:hover .stat-tooltip {
  display: block;
}

.stat-tooltip {
  display: none;
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background-color: rgba(30, 10, 40, 0.95);
  padding: 5px;
  border-radius: 3px;
  font-size: 0.8em;
  white-space: nowrap;
  z-index: 100;
  border: 1px solid var(--neon-purple);
  color: var(--text-color);
  min-width: 120px;
}

.stat-value {
  font-weight: bold;
  font-size: 1.2em;
  color: var(--neon-blue);
  text-shadow: 0 0 3px rgba(0, 243, 255, 0.5);
  font-family: 'Orbitron', sans-serif;
}

/* Health and Bloodlust Bars */
#hp-bar, #bloodlust-bar {
  height: 8px;
  background-color: rgba(30, 10, 40, 0.7);
  margin-top: 5px;
  border-radius: 5px;
  overflow: hidden;
  border: 1px solid var(--neon-purple);
}

#hp-fill {
  height: 100%;
  background: linear-gradient(to right, #006400, #00cc00);
  width: 100%;
  transition: width 0.3s;
  box-shadow: 0 0 5px rgba(0, 204, 0, 0.7);
}

#bloodlust-fill {
  height: 100%;
  background: linear-gradient(to right, #8b0000, var(--blood-red));
  width: 100%;
  transition: width 0.3s;
  box-shadow: 0 0 5px rgba(255, 0, 60, 0.7);
}

/* Controls */
#controls {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 10px;
  padding: 15px;
  background: linear-gradient(to bottom, rgba(30, 10, 40, 0.8), rgba(15, 5, 25, 0.9));
  border-top: 1px solid var(--neon-purple);
  box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.7);
  position: relative;
}

button {
  padding: 14px;
  border: none;
  border-radius: 4px;
  background: linear-gradient(to bottom, #2a1a3a, #1a0f25);
  color: var(--text-color);
  font-family: 'Rajdhani', sans-serif;
  font-size: 1em;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
  overflow: hidden;
  border: 1px solid var(--neon-purple);
  text-shadow: 0 0 3px rgba(0, 0, 0, 0.7);
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
  letter-spacing: 1px;
}

button::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(to bottom, rgba(185, 103, 255, 0.1), rgba(185, 103, 255, 0.05));
  opacity: 0;
  transition: opacity 0.2s;
}

button:hover::before {
  opacity: 1;
}

button:active {
  transform: translateY(2px);
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
}

button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  background: linear-gradient(to bottom, #2a2a3a, #1a1a2a);
}

/* Special Ability Button */
#special-ability {
  background: linear-gradient(to bottom, #8b0000, #5a0000);
  grid-column: span 3;
  font-weight: bold;
  letter-spacing: 1px;
  text-transform: uppercase;
  font-family: 'Orbitron', sans-serif;
}

#special-ability.available {
  background: linear-gradient(to bottom, var(--blood-red), #b3003a);
  color: white;
  animation: pulse 2s infinite;
  text-shadow: none;
}

@keyframes pulse {
  0% { box-shadow: 0 0 0 0 rgba(255, 0, 60, 0.7); }
  70% { box-shadow: 0 0 0 10px rgba(255, 0, 60, 0); }
  100% { box-shadow: 0 0 0 0 rgba(255, 0, 60, 0); }
}

/* Floating Action Buttons */
.floating-btn {
  position: absolute;
  bottom: 90px;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: linear-gradient(to bottom, #2a1a3a, #1a0f25);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5em;
  z-index: 5;
  transition: transform 0.2s;
  border: 1px solid var(--neon-purple);
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
  cursor: pointer;
}

.floating-btn:hover {
  transform: scale(1.1);
  background: linear-gradient(to bottom, #3a2a4a, #2a1f35);
}

#inventory-btn {
  right: 10px;
}

#crafting-btn {
  right: 70px;
}

#skills-btn {
  right: 130px;
}

.floating-btn::after {
  content: attr(data-count);
  position: absolute;
  top: -5px;
  right: -5px;
  background: linear-gradient(to bottom, var(--blood-red), #b3003a);
  color: white;
  border-radius: 50%;
  width: 20px;
  height: 20px;
  font-size: 0.7em;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid var(--neon-purple);
}

/* Game Over Screen */
#game-over {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.9);
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 20;
  text-align: center;
  background-image: 
    linear-gradient(to bottom, rgba(0, 0, 0, 0.9), rgba(5, 0, 10, 0.95)),
    url('https://images.unsplash.com/photo-1535223289827-42f1e9919769?q=80');
  background-size: cover;
  background-position: center;
  background-blend-mode: multiply;
}

#game-over h1 {
  color: var(--blood-red);
  font-size: 3em;
  margin-bottom: 20px;
  text-shadow: 0 0 10px #ff003c;
  animation: pulse-red 1.5s infinite;
  font-family: 'Orbitron', sans-serif;
  letter-spacing: 3px;
  text-transform: uppercase;
}

@keyframes pulse-red {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

#death-message {
  font-size: 1.2em;
  margin-bottom: 30px;
  max-width: 80%;
  color: var(--text-color);
  font-style: italic;
  text-shadow: 0 0 5px rgba(0, 0, 0, 0.7);
  padding: 0 20px;
}

#stats-summary {
  margin-bottom: 30px;
  background-color: rgba(30, 10, 40, 0.8);
  padding: 15px;
  border-radius: 5px;
  width: 80%;
  max-width: 400px;
  border: 2px solid var(--neon-purple);
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.7);
}

#stats-summary div {
  margin-bottom: 8px;
  color: var(--text-color);
  font-size: 1.1em;
}

#stats-summary span {
  color: var(--neon-blue);
  font-weight: bold;
}

#restart-btn {
  padding: 15px 30px;
  font-size: 1.2em;
  background: linear-gradient(to bottom, var(--blood-red), #b3003a);
  border: none;
  border-radius: 5px;
  color: white;
  cursor: pointer;
  transition: all 0.2s;
  font-family: 'Orbitron', sans-serif;
  border: 1px solid var(--neon-purple);
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
  text-transform: uppercase;
  letter-spacing: 1px;
}

#restart-btn:hover {
  background: linear-gradient(to bottom, #ff0055, #cc0044);
  transform: scale(1.05);
}

/* Combo Display */
#combo-display {
  position: absolute;
  top: 10px;
  right: 60px;
  background: linear-gradient(to bottom, #2a1a3a, #1a0f25);
  padding: 5px 15px;
  border-radius: 15px;
  font-size: 0.9em;
  display: none;
  z-index: 5;
  border: 1px solid var(--neon-purple);
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
  color: var(--neon-blue);
  font-weight: bold;
  font-family: 'Orbitron', sans-serif;
}

.combo-active {
  animation: comboPulse 0.5s infinite alternate;
}

@keyframes comboPulse {
  from { box-shadow: 0 0 5px rgba(0, 243, 255, 0.5); }
  to { box-shadow: 0 0 15px rgba(0, 243, 255, 0.8); }
}

/* Animations */
.enemy-attack-animation {
  animation: enemyAttack 0.3s;
}

@keyframes enemyAttack {
  0% { transform: translateX(0); }
  50% { transform: translateX(-10px); }
  100% { transform: translateX(0); }
}

.player-attack-animation {
  animation: playerAttack 0.3s;
}

@keyframes playerAttack {
  0% { transform: translateX(0); }
  50% { transform: translateX(10px); }
  100% { transform: translateX(0); }
}

/* Scrollbar styling */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(20, 10, 40, 0.5);
}

::-webkit-scrollbar-thumb {
  background: var(--neon-purple);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: #a050ff;
}

/* Responsive adjustments */
@media (max-width: 600px) {
  #header {
    font-size: 0.95em;
    padding: 10px 5px;
  }

  .stat-value {
    font-size: 1em;
  }

  #main-display {
    font-size: 1em;
    padding: 10px;
  }

  button {
    padding: 12px;
    font-size: 0.9em;
  }
  
  #combo-display {
    right: 50px;
    font-size: 0.8em;
    padding: 5px 10px;
  }
  
  .floating-btn {
    width: 45px;
    height: 45px;
    font-size: 1.3em;
    bottom: 80px;
  }
  
  #inventory-btn {
    right: 10px;
  }
  
  #crafting-btn {
    right: 60px;
  }
  
  #skills-btn {
    right: 110px;
  }
  
  #controls {
    padding: 12px;
    gap: 8px;
  }
  
  #stats-panel {
    padding: 10px 5px;
  }
  
  .stat-box {
    padding: 3px;
  }
}
</style>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
<div id="game-container">
<!-- Header -->
<div id="header">
  <span id="transformation-status">Vampire</span>
  <span id="equipped-weapon">Equipped: Energy Claws</span>
  <div id="time-container">
    <div id="time-indicator"></div>
    <span id="day-night-indicator">Night</span>
  </div>
</div>

<!-- Stats Panel -->
<div id="stats-panel">
  <div class="stat-box">
    <div>District</div>
    <div class="stat-value" id="district">1</div>
    <div class="stat-tooltip">Current city district</div>
  </div>
  <div class="stat-box">
    <div>Level</div>
    <div class="stat-value" id="level">1</div>
    <div class="stat-tooltip">Your character level</div>
  </div>
  <div class="stat-box">
    <div>HP</div>
    <div class="stat-value" id="hp">25/25</div>
    <div id="hp-bar"><div id="hp-fill"></div></div>
    <div class="stat-tooltip">Vitality</div>
  </div>
  <div class="stat-box">
    <div>Bloodlust</div>
    <div class="stat-value" id="bloodlust">0/100</div>
    <div id="bloodlust-bar"><div id="bloodlust-fill"></div></div>
    <div class="stat-tooltip">Build Bloodlust for special attacks</div>
  </div>
  <div class="stat-box">
    <div>Kills</div>
    <div class="stat-value" id="kills">0</div>
    <div class="stat-tooltip">Total enemies defeated</div>
  </div>
</div>

<!-- Enemy Stats -->
<div id="enemy-stats">
  <div class="enemy-health-container">
    <div id="enemy-name" class="enemy-name">Security Bot</div>
    <div id="enemy-hp" class="enemy-hp">HP: 15/15</div>
    <div id="enemy-hp-bar"><div id="enemy-hp-fill"></div></div>
  </div>
  <div id="enemy-dmg" class="enemy-dmg">DMG: 2-4</div>
  <div id="enemy-weakness" class="enemy-weakness" style="display: none;">Weak: EMP</div>
</div>

<!-- Main Display -->
<div id="main-display">
  <div id="combat-log">
    <div class="system-message combat-entry">Neo-Tokyo, 2087. The eternal rain washes neon blood from the streets.</div>
    <div class="system-message combat-entry">You awaken as darkness falls over the city. Hunger stirs within.</div>
    <div class="combat-entry">A security bot patrols the alley ahead!</div>
  </div>
</div>

<!-- Controls -->
<div id="controls">
  <button id="attack-btn">Attack</button>
  <button id="drain-btn">Drain</button>
  <button id="shadow-btn">Shadow</button>
  <button id="special-ability">Blood Frenzy (0/100)</button>
</div>

<!-- Floating Action Buttons -->
<button id="inventory-btn" class="floating-btn" data-count="3">⚡</button>
<button id="crafting-btn" class="floating-btn">🛠️</button>
<button id="skills-btn" class="floating-btn">🧠</button>

<!-- Game Over Screen -->
<div id="game-over">
  <h1>SYSTEM FAILURE</h1>
  <div id="death-message">The hunters finally cornered you as dawn broke over the neon skyline.</div>
  <div id="stats-summary">
    <div>District Reached: <span id="final-district">1</span></div>
    <div>Level Achieved: <span id="final-level">1</span></div>
    <div>Enemies Eliminated: <span id="final-kills">0</span></div>
    <div>Highest Combo: <span id="final-combo">0</span>x</div>
  </div>
  <button id="restart-btn">Reboot System</button>
</div>
</div>

<script>
// Game State
const gameState = {
  district: 1,
  level: 1,
  xp: 0,
  maxXp: 100,
  baseMinDmg: 0,
  baseMaxDmg: 0,
  maxHp: 25,
  currentHp: 25,
  bloodlust: 0,
  maxBloodlust: 100,
  isNight: true,
  equippedWeapon: { name: "Energy Claws", minDmg: 5, maxDmg: 10, durability: Infinity },
  inventory: [
    { name: "Blood Vial", description: "Restores 10 HP", type: "consumable", rarity: "common" },
    { name: "EMP Grenade", type: "consumable", description: "Stuns mechanical enemies", rarity: "uncommon" },
    { name: "Plasma Dagger", type: "weapon", minDmg: 6, maxDmg: 12, durability: 15, description: "6-12 DMG, 15 uses", rarity: "uncommon" }
  ],
  enemiesDefeated: 0,
  gameActive: true,
  currentCombo: 0,
  highestCombo: 0,
  lastAction: null,
  currentEnemy: null
};

// Enemy Types
const enemies = [
  { name: "Security Bot", hp: 15, minDmg: 2, maxDmg: 4, xp: 10, weakness: "EMP" },
  { name: "Corporate Guard", hp: 22, minDmg: 4, maxDmg: 6, xp: 20, weakness: null },
  { name: "Cyborg Hunter", hp: 30, minDmg: 6, maxDmg: 8, xp: 30, weakness: "EMP" },
  { name: "Android Enforcer", hp: 40, minDmg: 8, maxDmg: 12, xp: 40, weakness: "EMP" },
  { name: "Psychic Investigator", hp: 35, minDmg: 7, maxDmg: 10, xp: 35, weakness: null },
  { name: "Boss: Hunter-Killer", hp: 80, minDmg: 12, maxDmg: 18, xp: 100, weakness: "EMP" }
];

// DOM elements
const combatLog = document.getElementById('combat-log');
const districtDisplay = document.getElementById('district');
const levelDisplay = document.getElementById('level');
const hpDisplay = document.getElementById('hp');
const hpFill = document.getElementById('hp-fill');
const bloodlustDisplay = document.getElementById('bloodlust');
const bloodlustFill = document.getElementById('bloodlust-fill');
const killsDisplay = document.getElementById('kills');
const attackBtn = document.getElementById('attack-btn');
const drainBtn = document.getElementById('drain-btn');
const shadowBtn = document.getElementById('shadow-btn');
const specialBtn = document.getElementById('special-ability');
const inventoryBtn = document.getElementById('inventory-btn');
const craftingBtn = document.getElementById('crafting-btn');
const skillsBtn = document.getElementById('skills-btn');
const gameOverPanel = document.getElementById('game-over');
const deathMessage = document.getElementById('death-message');
const restartBtn = document.getElementById('restart-btn');
const timeIndicator = document.getElementById('time-indicator');
const dayNightIndicator = document.getElementById('day-night-indicator');
const equippedWeaponDisplay = document.getElementById('equipped-weapon');
const enemyNameDisplay = document.getElementById('enemy-name');
const enemyHpDisplay = document.getElementById('enemy-hp');
const enemyHpFill = document.getElementById('enemy-hp-fill');
const enemyDmgDisplay = document.getElementById('enemy-dmg');
const enemyWeaknessDisplay = document.getElementById('enemy-weakness');
const transformationStatusDisplay = document.getElementById('transformation-status');
const finalDistrictDisplay = document.getElementById('final-district');
const finalLevelDisplay = document.getElementById('final-level');
const finalKillsDisplay = document.getElementById('final-kills');
const finalComboDisplay = document.getElementById('final-combo');

// Create particles for visual effects
function createParticles(x, y, color, count = 10) {
  for (let i = 0; i < count; i++) {
    const particle = document.createElement('div');
    particle.className = 'particle';
    particle.style.backgroundColor = color;
    particle.style.width = `${Math.random() * 5 + 2}px`;
    particle.style.height = particle.style.width;
    particle.style.left = `${x}px`;
    particle.style.top = `${y}px`;
    
    const angle = Math.random() * Math.PI * 2;
    const velocity = Math.random() * 5 + 2;
    const lifetime = Math.random() * 1000 + 500;
    
    document.body.appendChild(particle);
    
    const startTime = Date.now();
    
    function update() {
      const elapsed = Date.now() - startTime;
      const progress = elapsed / lifetime;
      
      if (progress >= 1) {
        document.body.removeChild(particle);
        return;
      }
      
      particle.style.opacity = 1 - progress;
      particle.style.transform = `translate(${Math.cos(angle) * velocity * progress * 50}px, ${Math.sin(angle) * velocity * progress * 50}px)`;
      
      requestAnimationFrame(update);
    }
    
    requestAnimationFrame(update);
  }
}

// Show damage numbers
function showDamageNumber(x, y, damage, isCritical = false) {
  const damageNumber = document.createElement('div');
  damageNumber.className = 'damage-number';
  damageNumber.textContent = damage;
  damageNumber.style.left = `${x}px`;
  damageNumber.style.top = `${y}px`;
  if (isCritical) {
    damageNumber.style.color = 'var(--cyber-yellow)';
    damageNumber.style.fontSize = '2em';
  }
  
  document.body.appendChild(damageNumber);
  
  setTimeout(() => {
    document.body.removeChild(damageNumber);
  }, 1000);
}

// Initialize game
function initGame() {
  gameState.district = 1;
  gameState.level = 1;
  gameState.xp = 0;
  gameState.maxXp = 100;
  gameState.baseMinDmg = 0;
  gameState.baseMaxDmg = 0;
  gameState.maxHp = 25;
  gameState.currentHp = gameState.maxHp;
  gameState.bloodlust = 0;
  gameState.isNight = true;
  gameState.equippedWeapon = { name: "Energy Claws", minDmg: 5, maxDmg: 10, durability: Infinity };
  gameState.inventory = [
    { name: "Blood Vial", description: "Restores 10 HP", type: "consumable", rarity: "common" },
    { name: "EMP Grenade", type: "consumable", description: "Stuns mechanical enemies", rarity: "uncommon" },
    { name: "Plasma Dagger", type: "weapon", minDmg: 6, maxDmg: 12, durability: 15, description: "6-12 DMG, 15 uses", rarity: "uncommon" }
  ];
  gameState.enemiesDefeated = 0;
  gameState.gameActive = true;
  gameState.currentCombo = 0;
  gameState.highestCombo = 0;
  gameState.lastAction = null;

  updateDisplays();
  generateEnemy();
  gameOverPanel.style.display = 'none';

  combatLog.innerHTML = `
    <div class="system-message combat-entry">Neo-Tokyo, 2087. The eternal rain washes neon blood from the streets.</div>
    <div class="system-message combat-entry">You awaken as darkness falls over the city. Hunger stirs within.</div>
    <div class="system-message combat-entry">Survive the night. Feed without being detected. Avoid daylight at all costs.</div>
  `;

  addLogEntry(`A security bot patrols the alley ahead!`, 'system');
}

// Update all displays
function updateDisplays() {
  districtDisplay.textContent = gameState.district;
  levelDisplay.textContent = gameState.level;
  hpDisplay.textContent = `${gameState.currentHp}/${gameState.maxHp}`;
  hpFill.style.width = `${(gameState.currentHp / gameState.maxHp) * 100}%`;
  bloodlustDisplay.textContent = `${gameState.bloodlust}/${gameState.maxBloodlust}`;
  bloodlustFill.style.width = `${(gameState.bloodlust / gameState.maxBloodlust) * 100}%`;
  killsDisplay.textContent = gameState.enemiesDefeated;
  specialBtn.textContent = `Blood Frenzy (${gameState.bloodlust}/${gameState.maxBloodlust})`;
  equippedWeaponDisplay.textContent = `Equipped: ${gameState.equippedWeapon.name}`;
  transformationStatusDisplay.textContent = gameState.isNight ? "Vampire" : "Day Walker";
  inventoryBtn.setAttribute('data-count', gameState.inventory.length);
  dayNightIndicator.textContent = gameState.isNight ? "Night" : "Day";

  // Update time indicator
  if (gameState.isNight) {
    timeIndicator.style.background = 'var(--neon-purple)';
    timeIndicator.style.boxShadow = '0 0 10px rgba(185, 103, 255, 0.5)';
  } else {
    timeIndicator.style.background = 'var(--cyber-yellow)';
    timeIndicator.style.boxShadow = '0 0 10px rgba(255, 211, 0, 0.5)';
  }

  if (gameState.currentEnemy) {
    enemyNameDisplay.textContent = gameState.currentEnemy.name;
    enemyHpDisplay.textContent = `HP: ${Math.max(0, gameState.currentEnemy.currentHp)}/${gameState.currentEnemy.hp}`;
    enemyHpFill.style.width = `${(gameState.currentEnemy.currentHp / gameState.currentEnemy.hp) * 100}%`;
    enemyDmgDisplay.textContent = `DMG: ${gameState.currentEnemy.minDmg}-${gameState.currentEnemy.maxDmg}`;
    
    // Show enemy weakness if known
    if (gameState.level >= 2 || gameState.enemiesDefeated > 5) {
      if (gameState.currentEnemy.weakness) {
        enemyWeaknessDisplay.style.display = 'block';
        enemyWeaknessDisplay.textContent = `Weak: ${gameState.currentEnemy.weakness}`;
      } else {
        enemyWeaknessDisplay.style.display = 'none';
      }
    } else {
      enemyWeaknessDisplay.style.display = 'none';
    }
  }

  if (gameState.bloodlust >= gameState.maxBloodlust) {
    specialBtn.classList.add('available');
  } else {
    specialBtn.classList.remove('available');
  }
}

// Add entry to combat log
function addLogEntry(text, type = 'normal') {
  const entry = document.createElement('div');
  entry.className = 'combat-entry';

  if (type === 'player') {
    entry.classList.add('player-action');
  } else if (type === 'enemy') {
    entry.classList.add('enemy-action');
  } else if (type === 'system') {
    entry.classList.add('system-message');
  } else if (type === 'loot') {
    entry.classList.add('loot-message');
  } else if (type === 'critical') {
    entry.classList.add('critical-hit');
  }

  entry.textContent = text;
  combatLog.appendChild(entry);
  combatLog.scrollTop = combatLog.scrollHeight;
}

// Generate a new enemy
function generateEnemy() {
  // Boss every 5 districts
  if (gameState.district % 5 === 0) {
    gameState.currentEnemy = {...enemies[5]};
    addLogEntry(`A Hunter-Killer unit has been dispatched to eliminate you!`, 'system');
  } else {
    // Scale enemy level with district progression
    let enemyLevel = Math.min(Math.floor(gameState.district / 2), enemies.length - 2);
    gameState.currentEnemy = {...enemies[enemyLevel]};
  }

  // Scale enemy stats with district progression
  const districtScale = 1 + (gameState.district * 0.05);
  gameState.currentEnemy.hp = Math.floor(gameState.currentEnemy.hp * districtScale);
  gameState.currentEnemy.minDmg = Math.floor(gameState.currentEnemy.minDmg * districtScale);
  gameState.currentEnemy.maxDmg = Math.floor(gameState.currentEnemy.maxDmg * districtScale);
  gameState.currentEnemy.currentHp = gameState.currentEnemy.hp;

  // Reset combo when new enemy appears
  gameState.currentCombo = 0;
  updateDisplays();
}

// Player attack
function playerAttack() {
  if (!gameState.gameActive || !gameState.currentEnemy) return;

  // Add attack animation
  const controls = document.getElementById('controls');
  controls.classList.add('player-attack-animation');
  setTimeout(() => {
    controls.classList.remove('player-attack-animation');
  }, 300);

  // Combo system
  let comboMultiplier = 1;
  if (gameState.lastAction === 'attack') {
    gameState.currentCombo++;
    gameState.highestCombo = Math.max(gameState.highestCombo, gameState.currentCombo);

    if (gameState.currentCombo >= 3) {
      comboMultiplier = 1 + (gameState.currentCombo * 0.05);
      addLogEntry(`Combo x${gameState.currentCombo}! Damage increased!`, 'system');
    }
  } else {
    gameState.currentCombo = 1;
  }
  gameState.lastAction = 'attack';

  let damage = Math.floor(Math.random() * (gameState.equippedWeapon.maxDmg - gameState.equippedWeapon.minDmg + 1)) + gameState.equippedWeapon.minDmg;
  damage += Math.floor(gameState.baseMinDmg + (gameState.baseMaxDmg - gameState.baseMinDmg) * Math.random());
  
  // Critical hit chance
  const isCritical = Math.random() < 0.2;

  if (isCritical) {
    damage = Math.floor(damage * 1.5);
  }

  // Check enemy weakness
  if (gameState.currentEnemy.weakness === "EMP" && gameState.equippedWeapon.name === "EMP Grenade") {
    damage = Math.floor(damage * 1.5);
    addLogEntry(`The ${gameState.currentEnemy.name} is weak to EMP attacks!`, 'player');
  }

  gameState.currentEnemy.currentHp -= damage;

  // Show damage number
  const enemyRect = document.getElementById('enemy-stats').getBoundingClientRect();
  showDamageNumber(
    enemyRect.left + enemyRect.width / 2,
    enemyRect.top + enemyRect.height / 2,
    damage,
    isCritical
  );

  // Create particles
  createParticles(
    enemyRect.left + enemyRect.width / 2,
    enemyRect.top + enemyRect.height / 2,
    '#ff003c'
  );

  addLogEntry(
    `You strike the ${gameState.currentEnemy.name} with ${gameState.equippedWeapon.name} for ${damage} damage${isCritical ? " (CRITICAL)" : ""}!`,
    isCritical ? 'critical' : 'player'
  );

  // Gain bloodlust
  gameState.bloodlust = Math.min(gameState.bloodlust + 10, gameState.maxBloodlust);
  updateDisplays();

  if (gameState.currentEnemy.currentHp <= 0) {
    enemyDefeated();
  } else {
    setTimeout(enemyTurn, 1000);
  }
}

// Player blood drain
function playerDrain() {
  if (!gameState.gameActive || !gameState.currentEnemy) return;

  // Add animation
  const controls = document.getElementById('controls');
  controls.classList.add('player-attack-animation');
  setTimeout(() => {
    controls.classList.remove('player-attack-animation');
  }, 300);

  // Reset combo
  gameState.currentCombo = 0;
  gameState.lastAction = 'drain';

  let damage = Math.floor(Math.random() * 4) + 3;
  gameState.currentEnemy.currentHp -= damage;

  // Heal player
  const healAmount = Math.min(damage, gameState.maxHp - gameState.currentHp);
  gameState.currentHp += healAmount;

  // Show damage number
  const enemyRect = document.getElementById('enemy-stats').getBoundingClientRect();
  showDamageNumber(
    enemyRect.left + enemyRect.width / 2,
    enemyRect.top + enemyRect.height / 2,
    damage
  );

  // Create blood particles
  createParticles(
    enemyRect.left + enemyRect.width / 2,
    enemyRect.top + enemyRect.height / 2,
    '#ff003c',
    15
  );

  addLogEntry(
    `You drain life from the ${gameState.currentEnemy.name} for ${damage} damage and heal ${healAmount} HP!`,
    'player'
  );

  // Gain bloodlust
  gameState.bloodlust = Math.min(gameState.bloodlust + 5, gameState.maxBloodlust);
  updateDisplays();

  if (gameState.currentEnemy.currentHp <= 0) {
    enemyDefeated();
  } else {
    setTimeout(enemyTurn, 1000);
  }
}

// Player shadow step
function playerShadow() {
  if (!gameState.gameActive || !gameState.currentEnemy) return;

  // Reset combo
  gameState.currentCombo = 0;
  gameState.lastAction = 'shadow';

  // 70% chance to dodge next attack
  if (Math.random() < 0.7) {
    addLogEntry(`You vanish into shadows, preparing to dodge the next attack!`, 'player');
    gameState.shadowDodge = true;
  } else {
    addLogEntry(`You attempt to vanish but fail to fully conceal yourself!`, 'player');
  }

  // Gain bloodlust
  gameState.bloodlust = Math.min(gameState.bloodlust + 5, gameState.maxBloodlust);
  updateDisplays();

  setTimeout(enemyTurn, 1000);
}

// Special ability - Blood Frenzy
function bloodFrenzy() {
  if (!gameState.gameActive || !gameState.currentEnemy || gameState.bloodlust < gameState.maxBloodlust) return;

  gameState.bloodlust = 0;
  
  // Add attack animation
  const controls = document.getElementById('controls');
  controls.classList.add('player-attack-animation');
  setTimeout(() => {
    controls.classList.remove('player-attack-animation');
  }, 300);

  // Combo system
  let comboMultiplier = 1;
  if (gameState.lastAction === 'attack') {
    gameState.currentCombo++;
    gameState.highestCombo = Math.max(gameState.highestCombo, gameState.currentCombo);

    if (gameState.currentCombo >= 3) {
      comboMultiplier = 1 + (gameState.currentCombo * 0.05);
      addLogEntry(`Combo x${gameState.currentCombo}! Damage increased!`, 'system');
    }
  } else {
    gameState.currentCombo = 1;
  }
  gameState.lastAction = 'attack';

  let damage = Math.floor(Math.random() * 16) + 15;
  damage += Math.floor(gameState.baseMinDmg + (gameState.baseMaxDmg - gameState.baseMinDmg) * Math.random());
  damage = Math.floor(damage * comboMultiplier);

  gameState.currentEnemy.currentHp -= damage;

  // Show damage number
  const enemyRect = document.getElementById('enemy-stats').getBoundingClientRect();
  showDamageNumber(
    enemyRect.left + enemyRect.width / 2,
    enemyRect.top + enemyRect.height / 2,
    damage,
    true
  );

  // Create frenzy particles
  createParticles(
    enemyRect.left + enemyRect.width / 2,
    enemyRect.top + enemyRect.height / 2,
    '#ff003c',
    20
  );

  addLogEntry(`You enter a BLOOD FRENZY and tear into the ${gameState.currentEnemy.name} for ${damage} damage!`, 'player');
  addLogEntry("The taste of blood drives you wild!", 'system');

  updateDisplays();

  if (gameState.currentEnemy.currentHp <= 0) {
    enemyDefeated();
  } else {
    setTimeout(enemyTurn, 1000);
  }
}

// Enemy turn
function enemyTurn() {
  if (!gameState.gameActive || !gameState.currentEnemy) return;

  // Check for dodge from shadow step
  if (gameState.shadowDodge) {
    addLogEntry(`The ${gameState.currentEnemy.name}'s attack passes through your shadow form!`, 'system');
    gameState.shadowDodge = false;
    updateDisplays();
    return;
  }

  // Add enemy attack animation
  const enemyStats = document.getElementById('enemy-stats');
  enemyStats.classList.add('enemy-attack-animation');
  setTimeout(() => {
    enemyStats.classList.remove('enemy-attack-animation');
  }, 300);

  // Player dodge chance (15%)
  if (Math.random() < 0.15) {
    addLogEntry(`You dodge the ${gameState.currentEnemy.name}'s attack!`, 'dodge');
    updateDisplays();
    return;
  }

  let damage = Math.floor(Math.random() * (gameState.currentEnemy.maxDmg - gameState.currentEnemy.minDmg + 1)) + gameState.currentEnemy.minDmg;
  gameState.currentHp -= damage;

  // Show damage number on player
  const playerRect = document.getElementById('stats-panel').getBoundingClientRect();
  showDamageNumber(
    playerRect.left + playerRect.width / 2,
    playerRect.top + playerRect.height / 2,
    damage
  );

  addLogEntry(`The ${gameState.currentEnemy.name} attacks you for ${damage} damage!`, 'enemy');

  updateDisplays();

  if (gameState.currentHp <= 0) {
    gameOver();
  }
}

// Enemy defeated
function enemyDefeated() {
  addLogEntry(`You have destroyed the ${gameState.currentEnemy.name}!`, 'player');
  gameState.enemiesDefeated++;
  gameState.xp += gameState.currentEnemy.xp;
  addLogEntry(`You gain ${gameState.currentEnemy.xp} XP!`, 'system');

  if (gameState.xp >= gameState.maxXp) {
    gameState.level++;
    gameState.xp -= gameState.maxXp;
    gameState.maxXp = Math.floor(gameState.maxXp * 1.2);
    gameState.maxHp += 5;
    gameState.currentHp = gameState.maxHp;
    gameState.baseMinDmg += 1;
    gameState.baseMaxDmg += 1;
    addLogEntry(`You level up to Level ${gameState.level}! Max HP increased to ${gameState.maxHp}, base damage increased!`, 'level-up');
  }

  // Loot drop
  if (Math.random() < 0.6 && gameState.inventory.length < 10) {
    const lootItems = [
      { name: "Blood Vial", description: "Restores 10 HP", type: "consumable", rarity: "common" },
      { name: "Energy Cell", description: "Restores 25 Bloodlust", type: "consumable", rarity: "uncommon" },
      { name: "EMP Grenade", type: "consumable", description: "Stuns mechanical enemies", rarity: "uncommon" },
      { name: "Neural Implant", type: "trinket", description: "Increases critical chance", rarity: "rare" },
      { name: "Plasma Dagger", type: "weapon", minDmg: 6, maxDmg: 12, durability: 15, description: "6-12 DMG, 15 uses", rarity: "uncommon" },
      { name: "Vibro-Blade", type: "weapon", minDmg: 8, maxDmg: 14, durability: 12, description: "8-14 DMG, 12 uses", rarity: "rare" }
    ];

    const loot = lootItems[Math.floor(Math.random() * lootItems.length)];
    gameState.inventory.push(loot);
    addLogEntry(`You found a ${loot.name}!`, 'loot');
  } else if (gameState.inventory.length >= 10) {
    addLogEntry("Your inventory is full! Discard items to make space.", 'system');
  }

  // Increase max HP every 3 districts
  if (gameState.district % 3 === 0) {
    gameState.maxHp += 3;
    gameState.currentHp = Math.min(gameState.currentHp + 3, gameState.maxHp);
    addLogEntry(`Your resilience grows! Max HP increased to ${gameState.maxHp}!`, 'system');
  }

  setTimeout(nextDistrict, 1500);
}

// Move to next district
function nextDistrict() {
  gameState.district++;
  
  // Advance time (each district is 1 hour)
  if (gameState.district % 6 === 0) {
    gameState.isNight = !gameState.isNight;
    if (!gameState.isNight) {
      addLogEntry("Dawn approaches! Your powers weaken in daylight.", 'system');
      gameState.baseMinDmg = Math.max(0, gameState.baseMinDmg - 2);
      gameState.baseMaxDmg = Math.max(0, gameState.baseMaxDmg - 2);
    } else {
      addLogEntry("Night falls! Your vampiric powers return.", 'system');
      gameState.baseMinDmg += 2;
      gameState.baseMaxDmg += 2;
    }
  }

  generateEnemy();
  addLogEntry(`You enter District ${gameState.district}. A ${gameState.currentEnemy.name} approaches!`, 'system');
  updateDisplays();
}

// Game over
function gameOver() {
  gameState.gameActive = false;

  const deathMessages = [
    "The hunters finally cornered you as dawn broke over the neon skyline.",
    "A silver-tipped round pierced your heart, ending your immortal existence.",
    "You succumbed to your wounds in the pouring acid rain.",
    "The corporate death squad overwhelmed your defenses.",
    "Your body disintegrated in the first rays of morning sunlight."
  ];

  deathMessage.textContent = deathMessages[Math.floor(Math.random() * deathMessages.length)];

  // Update final stats
  finalDistrictDisplay.textContent = gameState.district;
  finalLevelDisplay.textContent = gameState.level;
  finalKillsDisplay.textContent = gameState.enemiesDefeated;
  finalComboDisplay.textContent = gameState.highestCombo;

  gameOverPanel.style.display = 'flex';
}

// Event listeners
attackBtn.addEventListener('click', playerAttack);
drainBtn.addEventListener('click', playerDrain);
shadowBtn.addEventListener('click', playerShadow);
specialBtn.addEventListener('click', bloodFrenzy);
restartBtn.addEventListener('click', initGame);

// Start the game
initGame();
</script>
</body>
</html>
