<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>Lawn Plus</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            color: #333;
        }

        #game-container {
            max-width: 500px;
            margin: 0 auto;
            padding: 10px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        header {
            background-color: #4CAF50;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        #stats-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .stat {
            font-size: 0.9em;
        }

        #status-bars {
            margin-top: 10px;
        }

        .status-bar {
            margin-bottom: 5px;
        }

        progress {
            width: 70%;
            height: 15px;
        }

        .screen {
            padding: 10px;
        }

        .hidden {
            display: none;
        }

        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px 0;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            font-size: 1em;
        }

        button:hover {
            background-color: #45a049;
        }

        #email-list {
            margin-bottom: 10px;
        }

        .email-item {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            cursor: pointer;
        }

        .email-item:hover {
            background-color: #f0f0f0;
        }

        .email-item.unread {
            font-weight: bold;
        }

        #schedule-display {
            margin-bottom: 10px;
        }

        .schedule-slot {
            padding: 5px;
            border-bottom: 1px solid #ddd;
        }

        .schedule-slot.booked {
            background-color: #e6ffe6;
        }

        .shop-item {
            padding: 10px;
            border: 1px solid #ddd;
            margin-bottom: 5px;
            border-radius: 5px;
        }

        .shop-item button {
            width: auto;
            float: right;
        }

        #notification-area {
            position: fixed;
            bottom: 10px;
            right: 10px;
            max-width: 300px;
        }

        .notification {
            background-color: #333;
            color: white;
            padding: 10px;
            margin-bottom: 5px;
            border-radius: 5px;
            opacity: 0.9;
        }

        @media (max-width: 500px) {
            progress {
                width: 60%;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <header>
            <div id="game-header">
                <h1>Lawn Plus</h1>
                <div id="stats-bar">
                    <div class="stat"><span>Day:</span> <span id="day-display">Mon</span></div>
                    <div class="stat"><span>Time:</span> <span id="time-display">8:00 AM</span></div>
                    <div class="stat"><span>Money:</span> $<span id="money-display">500</span></div>
                </div>
                <div id="status-bars">
                    <div class="status-bar"><span>Energy:</span> <progress id="energy-bar" value="100" max="100"></progress></div>
                    <div class="status-bar"><span>Stress:</span> <progress id="stress-bar" value="20" max="100"></progress></div>
                    <div class="status-bar"><span>Reputation:</span> <progress id="rep-bar" value="50" max="100"></progress></div>
                </div>
            </div>
        </header>

        <main>
            <div id="main-menu" class="screen">
                <button id="check-email-btn">Check Email</button>
                <button id="schedule-btn">View Schedule</button>
                <button id="shop-btn">Equipment Shop</button>
                <button id="start-day-btn">Start Work Day</button>
                <button id="next-day-btn">Advance to Next Day</button>
            </div>

            <div id="email-screen" class="screen hidden">
                <h2>Inbox</h2>
                <div id="email-list"></div>
                <button id="back-from-email">Back</button>
            </div>

            <div id="email-detail-screen" class="screen hidden">
                <h2>Email</h2>
                <div id="email-content"></div>
                <div id="email-actions"></div>
                <button id="back-from-detail">Back to Inbox</button>
            </div>

            <div id="schedule-screen" class="screen hidden">
                <h2>Schedule</h2>
                <div id="schedule-display"></div>
                <button id="back-from-schedule">Back</button>
            </div>

            <div id="shop-screen" class="screen hidden">
                <h2>Equipment Shop</h2>
                <div id="shop-items">
                    <h3>Mowers</h3>
                    <div class="shop-category" id="mowers"></div>
                    <h3>Trimmers</h3>
                    <div class="shop-category" id="trimmers"></div>
                    <h3>Blowers</h3>
                    <div class="shop-category" id="blowers"></div>
                    <h3>Supplies</h3>
                    <div class="shop-category" id="supplies"></div>
                </div>
                <button id="back-from-shop">Back</button>
            </div>

            <div id="work-screen" class="screen hidden">
                <h2>Work Day - <span id="work-day">Monday</span></h2>
                <div id="current-job-display">
                    <h3>Current Job: <span id="current-job-name">None</span></h3>
                    <div>Progress: <progress id="job-progress" value="0" max="100"></progress></div>
                    <div>Time Remaining: <span id="time-remaining">0</span> minutes</div>
                    <div id="job-details"></div>
                </div>
                <div id="equipment-status">
                    <h3>Equipment Status</h3>
                    <div>Mower: <span id="mower-status">100%</span></div>
                    <div>Trimmer: <span id="trimmer-status">100%</span></div>
                    <div>Blower: <span id="blower-status">100%</span></div>
                    <div>Petrol: <span id="petrol-status">100%</span></div>
                </div>
                <button id="use-energy-drink">Use Energy Drink (0 left)</button>
                <button id="end-work-day">End Work Day</button>
            </div>

            <div id="notification-area"></div>
        </main>
    </div>
    <script>
        // Game State
        const gameState = {
            day: 0, // 0-4 (Mon-Fri)
            week: 1,
            time: 8, // 8AM-5PM (8-17)
            money: 500,
            stress: 20,
            energy: 100,
            reputation: 50,
            equipment: {
                mower: '18inch',
                trimmer: 'cheap',
                blower: 'cheap',
                petrol: 100,
                trimmerCord: 100,
                mowerBelt: 100,
                energyDrinks: 0
            },
            customers: [],
            scheduledJobs: [[],[],[],[],[]], // 5 days
            emails: [],
            weather: 'sunny',
            completedJobs: 0,
            failedJobs: 0,
            currentJob: null,
            workTimer: null,
            workDayActive: false,
            currentJobIndex: 0
        };

        // Equipment Stats
        const equipmentStats = {
            mower: {
                '18inch': { name: '18" Push Mower', speed: 1, stress: 3, price: 0 },
                '21inch': { name: '21" Self-Propelled', speed: 1.5, stress: 2, price: 300 },
                'zeroturn': { name: 'Zero-Turn Mower', speed: 2.5, stress: 1, price: 2000 }
            },
            trimmer: {
                'cheap': { name: 'Basic Trimmer', speed: 1, stress: 2, price: 0 },
                'mid': { name: 'Professional Trimmer', speed: 1.5, stress: 1, price: 200 },
                'top': { name: 'Commercial Trimmer', speed: 2, stress: 0.5, price: 500 }
            },
            blower: {
                'cheap': { name: 'Basic Blower', speed: 1, stress: 2, price: 0 },
                'mid': { name: 'Professional Blower', speed: 1.5, stress: 1, price: 150 },
                'top': { name: 'Commercial Blower', speed: 2, stress: 0.5, price: 400 }
            }
        };

        // Job Types
        const jobTypes = {
            small: { name: 'Small Lawn', baseTime: 30, basePay: 35, reputation: 1 },
            medium: { name: 'Medium Lawn', baseTime: 45, basePay: 45, reputation: 2 },
            large: { name: 'Large Lawn', baseTime: 60, basePay: 65, reputation: 3 },
            xlarge: { name: 'Extra Large Lawn', baseTime: 90, basePay: 100, reputation: 5 }
        };

        // Weather Effects
        const weatherEffects = {
            sunny: { name: 'Sunny', workModifier: 1, stressModifier: 0 },
            rain: { name: 'Rain', workModifier: 0.3, stressModifier: 20 },
            cloudy: { name: 'Cloudy', workModifier: 0.9, stressModifier: -5 },
            hot: { name: 'Hot', workModifier: 0.8, stressModifier: 15 }
        };

        // Customer Names
        const customerNames = [
            'Smith', 'Johnson', 'Williams', 'Brown', 'Jones', 
            'Miller', 'Davis', 'Garcia', 'Rodriguez', 'Wilson'
        ];

        // Days of Week
        const daysOfWeek = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];

        // DOM Elements
        const elements = {
            dayDisplay: document.getElementById('day-display'),
            timeDisplay: document.getElementById('time-display'),
            moneyDisplay: document.getElementById('money-display'),
            energyBar: document.getElementById('energy-bar'),
            stressBar: document.getElementById('stress-bar'),
            repBar: document.getElementById('rep-bar'),
            
            screens: {
                main: document.getElementById('main-menu'),
                email: document.getElementById('email-screen'),
                emailDetail: document.getElementById('email-detail-screen'),
                schedule: document.getElementById('schedule-screen'),
                shop: document.getElementById('shop-screen'),
                work: document.getElementById('work-screen')
            },
            
            buttons: {
                checkEmail: document.getElementById('check-email-btn'),
                schedule: document.getElementById('schedule-btn'),
                shop: document.getElementById('shop-btn'),
                startDay: document.getElementById('start-day-btn'),
                nextDay: document.getElementById('next-day-btn'),
                backFromEmail: document.getElementById('back-from-email'),
                backFromDetail: document.getElementById('back-from-detail'),
                backFromSchedule: document.getElementById('back-from-schedule'),
                backFromShop: document.getElementById('back-from-shop'),
                endWorkDay: document.getElementById('end-work-day'),
                useEnergyDrink: document.getElementById('use-energy-drink')
            },
            
            emailList: document.getElementById('email-list'),
            emailContent: document.getElementById('email-content'),
            emailActions: document.getElementById('email-actions'),
            scheduleDisplay: document.getElementById('schedule-display'),
            
            workDay: document.getElementById('work-day'),
            currentJobName: document.getElementById('current-job-name'),
            jobProgress: document.getElementById('job-progress'),
            timeRemaining: document.getElementById('time-remaining'),
            jobDetails: document.getElementById('job-details'),
            
            mowerStatus: document.getElementById('mower-status'),
            trimmerStatus: document.getElementById('trimmer-status'),
            blowerStatus: document.getElementById('blower-status'),
            petrolStatus: document.getElementById('petrol-status'),
            
            notificationArea: document.getElementById('notification-area')
        };

        // Initialize the game
        function initGame() {
            updateUI();
            generateInitialEmails();
            
            // Set up event listeners
            elements.buttons.checkEmail.addEventListener('click', () => showScreen('email'));
            elements.buttons.schedule.addEventListener('click', () => showScreen('schedule'));
            elements.buttons.shop.addEventListener('click', () => showScreen('shop'));
            elements.buttons.startDay.addEventListener('click', startWorkDay);
            elements.buttons.nextDay.addEventListener('click', advanceDay);
            
            elements.buttons.backFromEmail.addEventListener('click', () => showScreen('main'));
            elements.buttons.backFromDetail.addEventListener('click', () => showScreen('email'));
            elements.buttons.backFromSchedule.addEventListener('click', () => showScreen('main'));
            elements.buttons.backFromShop.addEventListener('click', () => showScreen('main'));
            elements.buttons.endWorkDay.addEventListener('click', endWorkDay);
            elements.buttons.useEnergyDrink.addEventListener('click', useEnergyDrink);
            
            // Set up shop items
            setupShop();
        }

        // Show a specific screen
        function showScreen(screenName) {
            // Hide all screens first
            for (const screen in elements.screens) {
                elements.screens[screen].classList.add('hidden');
            }
            
            // Show the requested screen
            elements.screens[screenName].classList.remove('hidden');
            
            // Update screen-specific content
            if (screenName === 'email') {
                updateEmailList();
            } else if (screenName === 'schedule') {
                updateScheduleDisplay();
            } else if (screenName === 'work') {
                updateWorkScreen();
            }
        }

        // Update the main UI elements
        function updateUI() {
            // Update day and time
            elements.dayDisplay.textContent = daysOfWeek[gameState.day];
            elements.timeDisplay.textContent = formatTime(gameState.time);
            
            // Update stats
            elements.moneyDisplay.textContent = gameState.money;
            elements.energyBar.value = gameState.energy;
            elements.stressBar.value = gameState.stress;
            elements.repBar.value = gameState.reputation;
            
            // Update work day button text
            elements.buttons.startDay.textContent = gameState.workDayActive ? 
                'Return to Work Day' : 'Start Work Day';
            
            // Update energy drink button
            elements.buttons.useEnergyDrink.textContent = 
                `Use Energy Drink (${gameState.equipment.energyDrinks} left)`;
            
            // Enable/disable next day button
            elements.buttons.nextDay.disabled = gameState.workDayActive;
        }

        // Format time (8 -> 8:00 AM, 13 -> 1:00 PM)
        function formatTime(hour) {
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour % 12 || 12;
            return `${displayHour}:00 ${ampm}`;
        }

        // Generate initial emails
        function generateInitialEmails() {
            for (let i = 0; i < 3; i++) {
                generateNewEmail();
            }
        }

        // Generate a new random email
        function generateNewEmail() {
            const types = ['jobRequest', 'complaint', 'steveOffer'];
            const weights = [0.7, 0.2, 0.1];
            const type = weightedRandom(types, weights);
            
            let email;
            switch (type) {
                case 'jobRequest':
                    email = generateJobRequest();
                    break;
                case 'complaint':
                    email = generateComplaint();
                    break;
                case 'steveOffer':
                    email = generateSteveOffer();
                    break;
            }
            
            gameState.emails.push(email);
            showNotification(`New email from ${email.from}`);
        }

        // Generate a job request email
        function generateJobRequest() {
            const customerName = randomCustomerName();
            const jobType = randomProperty(jobTypes);
            const size = jobType.name;
            const pay = jobType.basePay;
            
            return {
                id: Date.now(),
                from: customerName,
                subject: `Lawn mowing request (${size})`,
                type: 'jobRequest',
                read: false,
                jobType: jobType,
                customer: customerName,
                pay: pay,
                content: `Hi there,\n\nI'd like to schedule a ${size.toLowerCase()} lawn mowing service. ` +
                         `Would you be available this week? I can pay $${pay}.\n\nThanks,\n${customerName}`
            };
        }

        // Generate a complaint email
        function generateComplaint() {
            const customerName = randomCustomerName();
            const issues = [
                "You missed some spots last time",
                "The lawn wasn't trimmed properly",
                "You left clippings all over my driveway",
                "You were late for the appointment",
                "The job wasn't worth what I paid"
            ];
            const issue = issues[Math.floor(Math.random() * issues.length)];
            
            return {
                id: Date.now(),
                from: customerName,
                subject: 'Complaint about service',
                type: 'complaint',
                read: false,
                customer: customerName,
                content: `Hi,\n\nI'm not happy with your service. ${issue}. ` +
                         `Please fix this or I'll have to find another lawn service.\n\n${customerName}`
            };
        }

        // Generate an email from Steve with special offers
        function generateSteveOffer() {
            const offers = [
                { item: 'energyDrinks', quantity: 3, price: 20, desc: '3 energy drinks' },
                { item: 'petrol', amount: 50, price: 30, desc: '50% petrol refill' },
                { item: 'mowerBelt', amount: 50, price: 25, desc: 'mower belt replacement' },
                { item: 'trimmerCord', amount: 50, price: 20, desc: 'trimmer cord replacement' }
            ];
            const offer = offers[Math.floor(Math.random() * offers.length)];
            
            return {
                id: Date.now(),
                from: 'Steve',
                subject: 'Special offer just for you!',
                type: 'steveOffer',
                read: false,
                offer: offer,
                content: `Hey buddy,\n\nI've got a great deal for you today - ${offer.desc} for just $${offer.price}. ` +
                         `Let me know if you're interested!\n\nSteve`
            };
        }

        // Update the email list display
        function updateEmailList() {
            elements.emailList.innerHTML = '';
            
            gameState.emails.forEach(email => {
                const emailElement = document.createElement('div');
                emailElement.className = `email-item ${email.read ? '' : 'unread'}`;
                emailElement.innerHTML = `
                    <strong>${email.from}</strong><br>
                    ${email.subject}
                `;
                emailElement.addEventListener('click', () => showEmailDetail(email.id));
                elements.emailList.appendChild(emailElement);
            });
        }

        // Show email detail
        function showEmailDetail(emailId) {
            const email = gameState.emails.find(e => e.id === emailId);
            if (!email) return;
            
            email.read = true;
            elements.emailContent.textContent = email.content;
            elements.emailActions.innerHTML = '';
            
            switch (email.type) {
                case 'jobRequest':
                    const acceptBtn = document.createElement('button');
                    acceptBtn.textContent = 'Accept Job ($' + email.pay + ')';
                    acceptBtn.addEventListener('click', () => {
                        acceptJob(email);
                        showScreen('schedule');
                    });
                    
                    const rejectBtn = document.createElement('button');
                    rejectBtn.textContent = 'Reject';
                    rejectBtn.addEventListener('click', () => {
                        gameState.emails = gameState.emails.filter(e => e.id !== email.id);
                        showScreen('email');
                    });
                    
                    elements.emailActions.appendChild(acceptBtn);
                    elements.emailActions.appendChild(rejectBtn);
                    break;
                    
                case 'complaint':
                    const fixBtn = document.createElement('button');
                    fixBtn.textContent = 'Offer to Fix (Cost: $20)';
                    fixBtn.addEventListener('click', () => {
                        if (gameState.money >= 20) {
                            gameState.money -= 20;
                            gameState.reputation += 5;
                            gameState.emails = gameState.emails.filter(e => e.id !== email.id);
                            showNotification(`You resolved ${email.from}'s complaint. Reputation +5`);
                            showScreen('email');
                            updateUI();
                        } else {
                            showNotification("Not enough money to fix this complaint");
                        }
                    });
                    
                    const ignoreBtn = document.createElement('button');
                    ignoreBtn.textContent = 'Ignore';
                    ignoreBtn.addEventListener('click', () => {
                        gameState.reputation -= 5;
                        gameState.emails = gameState.emails.filter(e => e.id !== email.id);
                        showNotification(`You ignored ${email.from}'s complaint. Reputation -5`);
                        showScreen('email');
                        updateUI();
                    });
                    
                    elements.emailActions.appendChild(fixBtn);
                    elements.emailActions.appendChild(ignoreBtn);
                    break;
                    
                case 'steveOffer':
                    const buyBtn = document.createElement('button');
                    buyBtn.textContent = 'Buy (' + email.offer.desc + ' for $' + email.offer.price + ')';
                    buyBtn.addEventListener('click', () => {
                        if (gameState.money >= email.offer.price) {
                            gameState.money -= email.offer.price;
                            
                            if (email.offer.item === 'energyDrinks') {
                                gameState.equipment.energyDrinks += email.offer.quantity;
                            } else if (email.offer.item === 'petrol') {
                                gameState.equipment.petrol = Math.min(100, gameState.equipment.petrol + email.offer.amount);
                            } else if (email.offer.item === 'mowerBelt') {
                                gameState.equipment.mowerBelt = Math.min(100, gameState.equipment.mowerBelt + email.offer.amount);
                            } else if (email.offer.item === 'trimmerCord') {
                                gameState.equipment.trimmerCord = Math.min(100, gameState.equipment.trimmerCord + email.offer.amount);
                            }
                            
                            gameState.emails = gameState.emails.filter(e => e.id !== email.id);
                            showNotification(`Purchased ${email.offer.desc} from Steve`);
                            showScreen('email');
                            updateUI();
                        } else {
                            showNotification("Not enough money for this offer");
                        }
                    });
                    
                    const declineBtn = document.createElement('button');
                    declineBtn.textContent = 'Decline';
                    declineBtn.addEventListener('click', () => {
                        gameState.emails = gameState.emails.filter(e => e.id !== email.id);
                        showScreen('email');
                    });
                    
                    elements.emailActions.appendChild(buyBtn);
                    elements.emailActions.appendChild(declineBtn);
                    break;
            }
            
            showScreen('emailDetail');
        }

        // Accept a job from an email
        function acceptJob(email) {
            // Create a job object
            const job = {
                id: Date.now(),
                customer: email.customer,
                type: email.jobType,
                pay: email.pay,
                scheduled: false
            };
            
            // Add to jobs list
            gameState.customers.push(job);
            
            // Remove the email
            gameState.emails = gameState.emails.filter(e => e.id !== email.id);
            
            showNotification(`Accepted job from ${email.customer}. Now schedule it!`);
        }

        // Update the schedule display
        function updateScheduleDisplay() {
            elements.scheduleDisplay.innerHTML = '';
            
            // Show all days with time slots
            for (let day = 0; day < 5; day++) {
                const dayElement = document.createElement('div');
                dayElement.innerHTML = `<h3>${daysOfWeek[day]}</h3>`;
                
                // Show all time slots (8AM-5PM)
                for (let hour = 8; hour <= 17; hour++) {
                    const slotElement = document.createElement('div');
                    slotElement.className = 'schedule-slot';
                    
                    // Check if this slot is booked
                    const job = gameState.scheduledJobs[day].find(j => j.time === hour);
                    
                    if (job) {
                        slotElement.classList.add('booked');
                        slotElement.innerHTML = `${formatTime(hour)} - ${job.customer} (${job.type.name})`;
                    } else {
                        slotElement.innerHTML = `${formatTime(hour)} - Available`;
                        slotElement.addEventListener('click', () => showScheduleJobDialog(day, hour));
                    }
                    
                    dayElement.appendChild(slotElement);
                }
                
                elements.scheduleDisplay.appendChild(dayElement);
            }
        }

        // Show dialog to schedule a job
        function showScheduleJobDialog(day, hour) {
            // Get unscheduled jobs
            const unscheduledJobs = gameState.customers.filter(job => !job.scheduled);
            
            if (unscheduledJobs.length === 0) {
                showNotification("No jobs to schedule");
                return;
            }
            
            // Create a dialog
            const dialog = document.createElement('div');
            dialog.className = 'notification';
            dialog.innerHTML = `<h3>Schedule Job at ${formatTime(hour)} on ${daysOfWeek[day]}</h3>`;
            
            // Add job options
            unscheduledJobs.forEach(job => {
                const jobBtn = document.createElement('button');
                jobBtn.textContent = `${job.customer} - ${job.type.name} ($${job.pay})`;
                jobBtn.addEventListener('click', () => {
                    scheduleJob(job.id, day, hour);
                    elements.notificationArea.removeChild(dialog);
                });
                dialog.appendChild(jobBtn);
            });
            
            // Add cancel button
            const cancelBtn = document.createElement('button');
            cancelBtn.textContent = 'Cancel';
            cancelBtn.addEventListener('click', () => {
                elements.notificationArea.removeChild(dialog);
            });
            dialog.appendChild(cancelBtn);
            
            elements.notificationArea.appendChild(dialog);
        }

        // Schedule a job
        function scheduleJob(jobId, day, hour) {
            const jobIndex = gameState.customers.findIndex(j => j.id === jobId);
            if (jobIndex === -1) return;
            
            const job = gameState.customers[jobIndex];
            job.scheduled = true;
            job.day = day;
            job.time = hour;
            
            // Add to scheduled jobs
            gameState.scheduledJobs[day].push(job);
            
            // Remove from customers list
            gameState.customers.splice(jobIndex, 1);
            
            showNotification(`Scheduled job for ${job.customer} on ${daysOfWeek[day]} at ${formatTime(hour)}`);
            updateScheduleDisplay();
        }

        // Set up the shop
        function setupShop() {
            // Mowers
            const mowersDiv = document.getElementById('mowers');
            mowersDiv.innerHTML = '';
            for (const mower in equipmentStats.mower) {
                const item = equipmentStats.mower[mower];
                if (item.price === 0) continue; // Skip already owned
                
                const itemDiv = document.createElement('div');
                itemDiv.className = 'shop-item';
                itemDiv.innerHTML = `
                    <strong>${item.name}</strong><br>
                    Speed: ${item.speed}x, Stress: ${item.stress}<br>
                    Price: $${item.price}
                `;
                
                const buyBtn = document.createElement('button');
                buyBtn.textContent = 'Buy';
                buyBtn.addEventListener('click', () => buyEquipment('mower', mower, item.price));
                
                itemDiv.appendChild(buyBtn);
                mowersDiv.appendChild(itemDiv);
            }
            
            // Trimmers
            const trimmersDiv = document.getElementById('trimmers');
            trimmersDiv.innerHTML = '';
            for (const trimmer in equipmentStats.trimmer) {
                const item = equipmentStats.trimmer[trimmer];
                if (item.price === 0) continue;
                
                const itemDiv = document.createElement('div');
                itemDiv.className = 'shop-item';
                itemDiv.innerHTML = `
                    <strong>${item.name}</strong><br>
                    Speed: ${item.speed}x, Stress: ${item.stress}<br>
                    Price: $${item.price}
                `;
                
                const buyBtn = document.createElement('button');
                buyBtn.textContent = 'Buy';
                buyBtn.addEventListener('click', () => buyEquipment('trimmer', trimmer, item.price));
                
                itemDiv.appendChild(buyBtn);
                trimmersDiv.appendChild(itemDiv);
            }
            
            // Blowers
            const blowersDiv = document.getElementById('blowers');
            blowersDiv.innerHTML = '';
            for (const blower in equipmentStats.blower) {
                const item = equipmentStats.blower[blower];
                if (item.price === 0) continue;
                
                const itemDiv = document.createElement('div');
                itemDiv.className = 'shop-item';
                itemDiv.innerHTML = `
                    <strong>${item.name}</strong><br>
                    Speed: ${item.speed}x, Stress: ${item.stress}<br>
                    Price: $${item.price}
                `;
                
                const buyBtn = document.createElement('button');
                buyBtn.textContent = 'Buy';
                buyBtn.addEventListener('click', () => buyEquipment('blower', blower, item.price));
                
                itemDiv.appendChild(buyBtn);
                blowersDiv.appendChild(itemDiv);
            }
            
            // Supplies
            const suppliesDiv = document.getElementById('supplies');
            suppliesDiv.innerHTML = '';
            
            // Petrol
            const petrolDiv = document.createElement('div');
            petrolDiv.className = 'shop-item';
            petrolDiv.innerHTML = `
                <strong>Petrol Refill</strong><br>
                Restores petrol to 100%<br>
                Price: $50
            `;
            
            const petrolBtn = document.createElement('button');
            petrolBtn.textContent = 'Buy';
            petrolBtn.addEventListener('click', () => {
                if (gameState.money >= 50) {
                    gameState.money -= 50;
                    gameState.equipment.petrol = 100;
                    showNotification("Petrol refilled to 100%");
                    updateUI();
                } else {
                    showNotification("Not enough money");
                }
            });
            petrolDiv.appendChild(petrolBtn);
            suppliesDiv.appendChild(petrolDiv);
            
            // Energy Drinks
            const energyDiv = document.createElement('div');
            energyDiv.className = 'shop-item';
            energyDiv.innerHTML = `
                <strong>Energy Drink (3-pack)</strong><br>
                Restores 50 energy each<br>
                Price: $30
            `;
            
            const energyBtn = document.createElement('button');
            energyBtn.textContent = 'Buy';
            energyBtn.addEventListener('click', () => {
                if (gameState.money >= 30) {
                    gameState.money -= 30;
                    gameState.equipment.energyDrinks += 3;
                    showNotification("Bought 3 energy drinks");
                    updateUI();
                } else {
                    showNotification("Not enough money");
                }
            });
            energyDiv.appendChild(energyBtn);
            suppliesDiv.appendChild(energyDiv);
        }

        // Buy equipment
        function buyEquipment(type, model, price) {
            if (gameState.money >= price) {
                gameState.money -= price;
                gameState.equipment[type] = model;
                showNotification(`Purchased ${equipmentStats[type][model].name}`);
                updateUI();
                setupShop(); // Refresh shop
            } else {
                showNotification("Not enough money");
            }
        }

        // Start the work day
        function startWorkDay() {
            if (gameState.scheduledJobs[gameState.day].length === 0) {
                showNotification("No jobs scheduled for today");
                return;
            }
            
            gameState.workDayActive = true;
            gameState.currentJobIndex = 0;
            startNextJob();
            showScreen('work');
            updateUI();
        }

        // Start the next job
        function startNextJob() {
            // Check if we've completed all jobs
            if (gameState.currentJobIndex >= gameState.scheduledJobs[gameState.day].length) {
                endWorkDay();
                return;
            }
            
            // Get the next job
            gameState.currentJob = gameState.scheduledJobs[gameState.day][gameState.currentJobIndex];
            
            // Calculate job time based on equipment and weather
            const mowerSpeed = equipmentStats.mower[gameState.equipment.mower].speed;
            const weatherMod = weatherEffects[gameState.weather].workModifier;
            const jobTime = Math.round(gameState.currentJob.type.baseTime / mowerSpeed / weatherMod);
            
            gameState.currentJob.timeRemaining = jobTime;
            gameState.currentJob.progress = 0;
            
            // Start work timer
            if (gameState.workTimer) {
                clearInterval(gameState.workTimer);
            }
            
            gameState.workTimer = setInterval(workOnJob, 1000);
            updateWorkScreen();
        }

        // Work on the current job
        function workOnJob() {
            if (!gameState.currentJob) return;
            
            // Get equipment and weather modifiers
            const mowerSpeed = equipmentStats.mower[gameState.equipment.mower].speed;
            const weatherMod = weatherEffects[gameState.weather].workModifier;
            const totalJobTime = Math.round(gameState.currentJob.type.baseTime / mowerSpeed / weatherMod);
            
            // Check if job is complete
            if (gameState.currentJob.timeRemaining <= 0) {
                completeJob();
                return;
            }
            
            // Reduce time remaining
            gameState.currentJob.timeRemaining--;
            gameState.currentJob.progress = 
                ((totalJobTime - gameState.currentJob.timeRemaining) / totalJobTime) * 100;
            
            // Reduce equipment condition
            gameState.equipment.petrol = Math.max(0, gameState.equipment.petrol - 0.5);
            gameState.equipment.mowerBelt = Math.max(0, gameState.equipment.mowerBelt - 0.2);
            gameState.equipment.trimmerCord = Math.max(0, gameState.equipment.trimmerCord - 0.1);
            
            // Reduce energy and increase stress
            gameState.energy = Math.max(0, gameState.energy - 0.5);
            gameState.stress = Math.min(100, gameState.stress + 0.3);
            
            // Check for equipment failure
            if (gameState.equipment.petrol <= 0) {
                showNotification("Out of petrol! Job failed");
                failJob();
                return;
            }
            
            if (gameState.equipment.mowerBelt <= 0) {
                showNotification("Mower belt broke! Job failed");
                failJob();
                return;
            }
            
            // Update UI
            updateWorkScreen();
            updateUI();
        }

        // Complete the current job
        function completeJob() {
            clearInterval(gameState.workTimer);
            
            // Pay the player
            gameState.money += gameState.currentJob.pay;
            gameState.completedJobs++;
            gameState.reputation = Math.min(100, gameState.reputation + gameState.currentJob.type.reputation);
            
            showNotification(`Completed job for ${gameState.currentJob.customer}. Earned $${gameState.currentJob.pay}`);
            
            // Move to next job
            gameState.currentJobIndex++;
            startNextJob();
        }

        // Fail the current job
        function failJob() {
            clearInterval(gameState.workTimer);
            
            gameState.failedJobs++;
            gameState.reputation = Math.max(0, gameState.reputation - 5);
            gameState.stress = Math.min(100, gameState.stress + 10);
            
            // Move to next job
            gameState.currentJobIndex++;
            startNextJob();
        }

        // Update the work screen
        function updateWorkScreen() {
            if (!gameState.currentJob) return;
            
            elements.workDay.textContent = daysOfWeek[gameState.day];
            elements.currentJobName.textContent = `${gameState.currentJob.customer} - ${gameState.currentJob.type.name}`;
            elements.jobProgress.value = gameState.currentJob.progress;
            elements.timeRemaining.textContent = gameState.currentJob.timeRemaining;
            
            elements.jobDetails.innerHTML = `
                Pay: $${gameState.currentJob.pay}<br>
                Weather: ${weatherEffects[gameState.weather].name}<br>
                Equipment: ${equipmentStats.mower[gameState.equipment.mower].name}
            `;
            
            // Update equipment status
            elements.mowerStatus.textContent = `${Math.round(gameState.equipment.mowerBelt)}%`;
            elements.trimmerStatus.textContent = `${Math.round(gameState.equipment.trimmerCord)}%`;
            elements.blowerStatus.textContent = '100%'; // Blower doesn't degrade in this version
            elements.petrolStatus.textContent = `${Math.round(gameState.equipment.petrol)}%`;
        }

        // End the work day
        function endWorkDay() {
            if (gameState.workTimer) {
                clearInterval(gameState.workTimer);
            }
            
            gameState.workDayActive = false;
            gameState.currentJob = null;
            
            // Randomly change weather
            const weatherTypes = Object.keys(weatherEffects);
            gameState.weather = weatherTypes[Math.floor(Math.random() * weatherTypes.length)];
            
            // Generate new emails
            if (Math.random() < 0.7) {
                generateNewEmail();
            }
            
            showScreen('main');
            updateUI();
            showNotification("Work day ended");
        }

        // Use an energy drink
        function useEnergyDrink() {
            if (gameState.equipment.energyDrinks > 0) {
                gameState.equipment.energyDrinks--;
                gameState.energy = Math.min(100, gameState.energy + 50);
                showNotification("Energy drink used! +50 energy");
                updateUI();
            } else {
                showNotification("No energy drinks left");
            }
        }

        // Advance to the next day
        function advanceDay() {
            gameState.day++;
            
            // Check if week is over
            if (gameState.day >= 5) {
                gameState.day = 0;
                gameState.week++;
                payWeeklyExpenses();
            }
            
            // Randomly generate new emails
            if (Math.random() < 0.5) {
                generateNewEmail();
            }
            
            updateUI();
            showNotification(`It's now ${daysOfWeek[gameState.day]}`);
        }

        // Pay weekly expenses
        function payWeeklyExpenses() {
            const expenses = 100; // Base weekly expenses
            gameState.money -= expenses;
            showNotification(`Paid weekly expenses: $${expenses}`);
            
            // Check for game over
            if (gameState.money < 0) {
                showNotification("Game Over - You ran out of money!");
                // Could add restart logic here
            }
        }

        // Show a notification
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            
            elements.notificationArea.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }

        // Helper function to get random property from object
        function randomProperty(obj) {
            const keys = Object.keys(obj);
            return obj[keys[Math.floor(Math.random() * keys.length)]];
        }

        // Helper function to get random customer name
        function randomCustomerName() {
            return customerNames[Math.floor(Math.random() * customerNames.length)];
        }

        // Helper function for weighted random selection
        function weightedRandom(items, weights) {
            let totalWeight = weights.reduce((a, b) => a + b, 0);
            let random = Math.random() * totalWeight;
            let weightSum = 0;
            
            for (let i = 0; i < items.length; i++) {
                weightSum += weights[i];
                if (random <= weightSum) return items[i];
            }
            
            return items[0];
        }

        // Initialize the game when the page loads
        window.addEventListener('load', initGame);
    </script>
</body>
</html>
