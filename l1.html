<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CHAMBERS OF FEAR - Level 1: The Entrance</title>
    <style>
        /* Retro 80s DOS computer style - Green/Yellow/White/Black theme */
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background-color: #000;
            color: #0f0;
            margin: 0;
            padding: 10px;
            line-height: 1.5;
            max-width: 100%;
            overflow-x: hidden;
            min-height: 100vh;
            background-image: 
                linear-gradient(rgba(0, 20, 0, 0.3) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 20, 0, 0.3) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .container {
            max-width: 700px;
            margin: 0 auto;
            padding: 15px;
            border: 2px solid #0f0;
            background-color: #000;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.4);
            position: relative;
            min-height: calc(100vh - 40px);
            overflow: hidden;
        }
        
        /* Scanline effect for authentic CRT monitor feel */
        .container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                transparent 50%,
                rgba(0, 20, 0, 0.1) 50%
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 2;
        }
        
        .header {
            text-align: center;
            border-bottom: 2px dashed #0f0;
            padding-bottom: 15px;
            margin-bottom: 20px;
            position: relative;
        }
        
        h1 {
            color: #ff0;
            text-shadow: 0 0 5px #ff0;
            font-size: 32px;
            margin: 10px 0;
            letter-spacing: 3px;
            text-transform: uppercase;
            font-weight: bold;
        }
        
        h2 {
            color: #fff;
            border-bottom: 1px solid #0f0;
            padding-bottom: 5px;
            margin-top: 25px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .screen {
            display: none;
            position: relative;
            z-index: 1;
        }
        
        .active-screen {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Level Progress Indicator */
        .level-progress {
            display: flex;
            justify-content: space-between;
            background-color: #111;
            border: 1px solid #0f0;
            padding: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .level-number {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #333;
            font-weight: bold;
            color: #888;
        }
        
        .level-number.current {
            background-color: #0f0;
            color: #000;
            border-color: #ff0;
            box-shadow: 0 0 8px #0f0;
        }
        
        .level-number.completed {
            background-color: #220;
            color: #ff0;
            border-color: #ff0;
        }
        
        /* Stats Bar */
        .stats-bar {
            background-color: #111;
            border: 1px solid #0f0;
            padding: 10px;
            margin: 15px 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            font-size: 14px;
        }
        
        .stat-item {
            margin: 5px 10px;
        }
        
        .stat-label {
            color: #fff;
        }
        
        .stat-value {
            color: #ff0;
            font-weight: bold;
            font-size: 16px;
        }
        
        /* Inventory */
        .inventory-container {
            background-color: #111;
            border: 1px solid #0f0;
            padding: 10px;
            margin: 15px 0;
        }
        
        .inventory-title {
            color: #ff0;
            margin-bottom: 10px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .inventory {
            min-height: 60px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .inventory-item {
            display: inline-block;
            background-color: #222;
            border: 1px solid #0f0;
            padding: 8px 12px;
            color: #fff;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .inventory-item:hover {
            background-color: #333;
            border-color: #ff0;
            transform: translateY(-2px);
        }
        
        .inventory-item.equipped::after {
            content: "âœ“";
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #ff0;
            color: #000;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Story Text Area */
        .story-text {
            background-color: #111;
            border: 1px solid #0f0;
            padding: 15px;
            margin: 20px 0;
            min-height: 200px;
            overflow-y: auto;
            max-height: 350px;
            font-size: 16px;
            line-height: 1.6;
        }
        
        /* Choice Buttons */
        .choice-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        
        .choice-btn {
            background-color: #222;
            color: #0f0;
            border: 2px solid #0f0;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .choice-btn:hover, .choice-btn:active {
            background-color: #333;
            color: #ff0;
            border-color: #ff0;
            box-shadow: 0 0 10px rgba(255, 255, 0, 0.3);
        }
        
        .choice-btn::after {
            content: ">";
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #0f0;
            font-weight: bold;
        }
        
        .choice-btn:hover::after {
            color: #ff0;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-top: 20px;
            gap: 10px;
        }
        
        .action-btn {
            background-color: #222;
            color: #0f0;
            border: 2px solid #0f0;
            padding: 10px 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            cursor: pointer;
            flex-grow: 1;
            text-align: center;
            transition: all 0.2s;
        }
        
        .action-btn:hover, .action-btn:active {
            background-color: #333;
            color: #ff0;
            border-color: #ff0;
        }
        
        /* Dice Roll Display */
        .dice-roll {
            background-color: #112211;
            border: 1px solid #0f0;
            padding: 10px;
            margin: 10px 0;
            text-align: center;
            color: #ff0;
            font-weight: bold;
        }
        
        /* Combat Display */
        .combat-log {
            background-color: #221100;
            border: 1px solid #ff0;
            padding: 10px;
            margin: 10px 0;
            color: #ff0;
        }
        
        /* Special Text Styles */
        .game-over {
            color: #f00;
            font-weight: bold;
            text-align: center;
            font-size: 24px;
            margin: 20px;
            text-shadow: 0 0 5px #f00;
        }
        
        .success {
            color: #0f0;
            font-weight: bold;
        }
        
        .damage {
            color: #f00;
            font-weight: bold;
        }
        
        .enemy {
            color: #ff9900;
            font-weight: bold;
        }
        
        .gold {
            color: #ff0;
            font-weight: bold;
        }
        
        .item {
            color: #0ff;
            font-weight: bold;
        }
        
        /* Next Level Button */
        .next-level {
            text-align: center;
            margin-top: 20px;
            padding: 20px;
        }
        
        .next-level-btn {
            background-color: #113311;
            color: #0f0;
            border: 2px solid #0f0;
            padding: 15px 30px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .next-level-btn:hover, .next-level-btn:active {
            background-color: #0f0;
            color: #000;
            border-color: #ff0;
            box-shadow: 0 0 15px #0f0;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            color: #888;
            font-size: 12px;
            margin-top: 20px;
            border-top: 1px solid #333;
            padding-top: 10px;
        }
        
        /* Blinking cursor effect */
        .blinking-cursor {
            display: inline-block;
            width: 10px;
            height: 20px;
            background-color: #0f0;
            vertical-align: middle;
            margin-left: 5px;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        /* Sound Toggle */
        .sound-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #111;
            border: 1px solid #0f0;
            color: #0f0;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
            z-index: 10;
        }
        
        .sound-toggle:hover {
            background: #222;
        }
        
        /* Responsive Design */
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .stats-bar {
                font-size: 12px;
            }
            
            .choice-btn {
                padding: 12px;
                font-size: 14px;
            }
            
            .level-number {
                width: 25px;
                height: 25px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sound Toggle -->
        <div class="sound-toggle" onclick="toggleSound()">
            SOUND: <span id="sound-status">ON</span>
        </div>
        
        <div class="header">
            <h1>CHAMBERS OF FEAR</h1>
            <h2>LEVEL 1: THE ENTRANCE</h2>
        </div>
        
        <!-- Level Progress Indicator -->
        <div class="level-progress">
            <div class="level-number current">1</div>
            <div class="level-number">2</div>
            <div class="level-number">3</div>
            <div class="level-number">4</div>
            <div class="level-number">5</div>
            <div class="level-number">6</div>
            <div class="level-number">7</div>
            <div class="level-number">8</div>
            <div class="level-number">9</div>
            <div class="level-number">10</div>
        </div>
        
        <!-- Character Creation Screen -->
        <div id="screen-creation" class="screen active-screen">
            <h2>CHARACTER CREATION</h2>
            <div class="story-text">
                <p>Welcome to CHAMBERS OF FEAR, a text-based adventure of terror and treasure!</p>
                <p>Before you enter the first chamber, you must create your character. Choose your class wisely:</p>
                <p><span class="enemy">WARRIOR</span>: +3 Skill, +6 Stamina, +0 Luck</p>
                <p><span class="enemy">SCOUT</span>: +4 Skill, +3 Stamina, +2 Luck</p>
                <p><span class="enemy">MYSTIC</span>: +2 Skill, +3 Stamina, +4 Luck</p>
                <p>After selecting your class, you will roll dice for your base attributes.</p>
            </div>
            
            <div class="choice-buttons">
                <button class="choice-btn" onclick="selectClass('warrior')">SELECT WARRIOR</button>
                <button class="choice-btn" onclick="selectClass('scout')">SELECT SCOUT</button>
                <button class="choice-btn" onclick="selectClass('mystic')">SELECT MYSTIC</button>
            </div>
            
            <div id="dice-roll-section" style="display: none;">
                <h2>ATTRIBUTE ROLLS</h2>
                <div class="story-text">
                    <p>You have chosen the path of a <span id="selected-class" class="enemy"></span>.</p>
                    <p>Now roll the dice for your attributes:</p>
                    <p><strong>Skill:</strong> 2 dice + class bonus (determines combat ability)</p>
                    <p><strong>Stamina:</strong> 2 dice + class bonus (your health)</p>
                    <p><strong>Luck:</strong> 2 dice + class bonus (helps in dangerous situations)</p>
                    <div id="dice-results"></div>
                </div>
                
                <div class="action-buttons">
                    <button class="action-btn" onclick="rollCharacterStats()">ROLL DICE</button>
                    <button class="action-btn" onclick="confirmStats()" id="confirm-btn" disabled>BEGIN ADVENTURE</button>
                </div>
            </div>
        </div>
        
        <!-- Game Screen -->
        <div id="screen-game" class="screen">
            <div class="stats-bar">
                <div class="stat-item"><span class="stat-label">SKILL:</span> <span id="stat-skill" class="stat-value">0</span></div>
                <div class="stat-item"><span class="stat-label">STAMINA:</span> <span id="stat-stamina" class="stat-value">0</span>/<span id="stat-maxstamina" class="stat-value">0</span></div>
                <div class="stat-item"><span class="stat-label">LUCK:</span> <span id="stat-luck" class="stat-value">0</span></div>
                <div class="stat-item"><span class="stat-label">GOLD:</span> <span id="stat-gold" class="stat-value">0</span></div>
            </div>
            
            <div class="inventory-container">
                <div class="inventory-title">
                    <span>INVENTORY</span>
                    <span id="inventory-count">ITEMS: 0/10</span>
                </div>
                <div class="inventory" id="inventory">
                    <!-- Inventory items will be added here -->
                </div>
            </div>
            
            <h2>CHAMBER 1: THE ENTRANCE</h2>
            <div class="story-text" id="story-text">
                <!-- Story content will be inserted here -->
            </div>
            
            <div class="choice-buttons" id="choice-buttons">
                <!-- Choice buttons will be inserted here -->
            </div>
            
            <div class="action-buttons">
                <button class="action-btn" onclick="useLuck()">TEST LUCK</button>
                <button class="action-btn" onclick="useItem()">USE ITEM</button>
                <button class="action-btn" onclick="saveGame()">SAVE GAME</button>
                <button class="action-btn" onclick="loadGame()">LOAD GAME</button>
            </div>
        </div>
        
        <!-- Next Level Screen -->
        <div id="screen-next" class="screen">
            <h2>LEVEL COMPLETE!</h2>
            <div class="story-text">
                <p>You have survived the Entrance Chamber of the Chambers of Fear!</p>
                <p>You find a large stone door with an intricate locking mechanism. As you approach, the door rumbles open, revealing a dark corridor leading deeper into the complex.</p>
                <p>Your journey continues into Chamber 2... All your stats, gold, and inventory will carry over.</p>
                <div class="stats-bar">
                    <div class="stat-item"><span class="stat-label">SKILL:</span> <span id="next-stat-skill" class="stat-value">0</span></div>
                    <div class="stat-item"><span class="stat-label">STAMINA:</span> <span id="next-stat-stamina" class="stat-value">0</span></div>
                    <div class="stat-item"><span class="stat-label">LUCK:</span> <span id="next-stat-luck" class="stat-value">0</span></div>
                    <div class="stat-item"><span class="stat-label">GOLD:</span> <span id="next-stat-gold" class="stat-value">0</span></div>
                </div>
            </div>
            
            <div class="next-level">
                <button class="next-level-btn" onclick="goToNextLevel()">CONTINUE TO CHAMBER 2</button>
            </div>
        </div>
        
        <div class="footer">
            CHAMBERS OF FEAR - A Retro Gamebook Adventure<br>
            Level 1: The Entrance
        </div>
    </div>

    <script>
        // Sound System
        let soundEnabled = true;
        let audioContext;
        
        // Simple beep generator using Web Audio API
        function playBeep(frequency, duration, type = 'square') {
            if (!soundEnabled) return;
            
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = type;
                
                // Volume envelope
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            } catch (e) {
                console.log("Web Audio not supported:", e);
            }
        }
        
        // Sound effects using the beep generator
        function playSound(type) {
            if (!soundEnabled) return;
            
            switch(type) {
                case 'click':
                    playBeep(800, 0.1, 'square');
                    break;
                case 'roll':
                    // Multiple beeps for dice roll
                    playBeep(400, 0.05, 'sine');
                    setTimeout(() => playBeep(600, 0.05, 'sine'), 50);
                    setTimeout(() => playBeep(300, 0.1, 'sine'), 100);
                    break;
                case 'combat':
                    playBeep(1200, 0.05, 'sawtooth');
                    break;
                case 'item':
                    playBeep(600, 0.2, 'triangle');
                    break;
                case 'success':
                    playBeep(1000, 0.15, 'sine');
                    setTimeout(() => playBeep(1200, 0.15, 'sine'), 150);
                    break;
                case 'failure':
                    playBeep(300, 0.3, 'sawtooth');
                    break;
                case 'damage':
                    playBeep(200, 0.2, 'square');
                    break;
                case 'level':
                    // Ascending beeps for level completion
                    playBeep(500, 0.1, 'sine');
                    setTimeout(() => playBeep(700, 0.1, 'sine'), 100);
                    setTimeout(() => playBeep(900, 0.1, 'sine'), 200);
                    setTimeout(() => playBeep(1100, 0.2, 'sine'), 300);
                    break;
            }
        }
        
        // Toggle sound on/off
        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('sound-status').textContent = soundEnabled ? 'ON' : 'OFF';
            
            // Play a test sound when turning on
            if (soundEnabled) {
                playSound('click');
            }
        }
        
        // Game state object - will be saved to localStorage
        const gameState = {
            playerClass: '',
            skill: 0,
            maxStamina: 0,
            stamina: 0,
            luck: 0,
            gold: 0,
            inventory: [],
            equippedWeapon: 'Rusty Dagger',
            equippedArmor: 'Leather Tunic',
            currentSection: 1,
            gameComplete: false,
            level: 1,
            // Persistent items that will carry through all levels
            persistentItems: []
        };
        
        // Combat state
        let combatState = {
            active: false,
            enemyName: '',
            enemyStamina: 0,
            enemyCurrentStamina: 0,
            enemySkill: 0,
            nextSection: 0,
            round: 1
        };
        
        // Game story sections for Level 1
        const storySections = {
            1: {
                text: "You stand before the entrance to the Chambers of Fear. The stone archway is ancient, covered in moss and strange carvings. Cold air flows from within, carrying a faint scent of decay. Two torches flank the entrance, flickering with green flames. What will you do?",
                choices: [
                    {text: "Enter the chamber cautiously", nextSection: 2, skillCheck: false},
                    {text: "Examine the carvings on the archway", nextSection: 3, skillCheck: false},
                    {text: "Take one of the green-flamed torches", nextSection: 4, skillCheck: false}
                ]
            },
            2: {
                text: "You step inside the chamber. The air grows colder. The room is circular with stone walls, and a single door on the opposite side. In the center lies a skeletal corpse clutching a chest. Water drips from the ceiling, echoing in the silence.",
                choices: [
                    {text: "Search the corpse and chest", nextSection: 5, skillCheck: false},
                    {text: "Inspect the far door", nextSection: 6, skillCheck: false},
                    {text: "Look for hidden passages", nextSection: 7, skillCheck: true, checkType: 'skill', difficulty: 12}
                ]
            },
            3: {
                text: "The carvings depict ancient warriors battling tentacled horrors. One carving shows a warrior holding a glowing amulet. As you examine it, you notice a hidden compartment in the stone!",
                choices: [
                    {text: "Reach into the compartment", nextSection: 8, skillCheck: false},
                    {text: "Ignore it and enter the chamber", nextSection: 2, skillCheck: false}
                ]
            },
            4: {
                text: "You pull a torch from its bracket. The green flame burns without consuming the wood. It emits an eerie light that seems to push back the shadows more effectively than normal fire. This could be useful in dark places.",
                choices: [
                    {text: "Enter the chamber with the torch", nextSection: 9, skillCheck: false}
                ],
                action: function() {
                    addToInventory('Green Torch');
                    return "You acquire a <span class='item'>Green Torch</span>!";
                }
            },
            5: {
                text: "You approach the corpse. Its skeletal fingers clutch a small iron chest. The chest is not locked.",
                choices: [
                    {text: "Open the chest", nextSection: 10, skillCheck: false},
                    {text: "Search the corpse's clothing", nextSection: 11, skillCheck: false},
                    {text: "Leave it and check the door", nextSection: 6, skillCheck: false}
                ]
            },
            6: {
                text: "The door is made of dark wood reinforced with iron bands. There's no visible handle or lock, but there's a strange slot in the center. It seems to require some kind of key or object to open.",
                choices: [
                    {text: "Try to force the door open", nextSection: 12, skillCheck: true, checkType: 'skill', difficulty: 14},
                    {text: "Return to search the room more thoroughly", nextSection: 5, skillCheck: false},
                    {text: "Examine the slot more carefully", nextSection: 13, skillCheck: false}
                ]
            },
            7: {
                text: "You search the walls for hidden passages...",
                choices: [
                    {text: "Continue", nextSection: 14, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        gameState.gold += 25;
                        addToInventory('Silver Key');
                        updateStatsDisplay();
                        playSound('success');
                        return "You find a loose stone! Behind it is a small cache containing <span class='gold'>25 Gold</span> and a <span class='item'>Silver Key</span>!";
                    } else {
                        playSound('failure');
                        return "You search the walls thoroughly but find nothing of interest.";
                    }
                }
            },
            8: {
                text: "You reach into the hidden compartment. Your fingers brush against cold metal. You pull out a strange medallion with a glowing green gem at its center.",
                choices: [
                    {text: "Take the medallion and enter the chamber", nextSection: 15, skillCheck: false}
                ],
                action: function() {
                    addToInventory('Glowing Medallion');
                    playSound('item');
                    return "You acquire a <span class='item'>Glowing Medallion</span>!";
                }
            },
            9: {
                text: "Holding the green torch aloft, you enter the chamber. The unnatural light reveals details that would be hidden in darkness. You notice footprints in the dust leading to the north wall, and a symbol above the door that glows faintly in response to your torch.",
                choices: [
                    {text: "Follow the footprints", nextSection: 16, skillCheck: false},
                    {text: "Examine the glowing symbol", nextSection: 17, skillCheck: false},
                    {text: "Search the center of the room", nextSection: 5, skillCheck: false}
                ]
            },
            10: {
                text: "You open the chest. Inside you find a pouch of coins and a weathered journal.",
                choices: [
                    {text: "Take the contents", nextSection: 18, skillCheck: false},
                    {text: "Read the journal first", nextSection: 19, skillCheck: false}
                ]
            },
            11: {
                text: "You search the tattered remains of the corpse's clothing. In a hidden pocket, you find a small vial of liquid and a folded map.",
                choices: [
                    {text: "Take the items", nextSection: 20, skillCheck: false}
                ]
            },
            12: {
                text: "You try to force the door open...",
                choices: [
                    {text: "Continue", nextSection: 21, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "With great effort, you force the door open! It swings inward with a loud groan.";
                    } else {
                        const damage = rollDice(1, 4);
                        gameState.stamina -= damage;
                        updateStatsDisplay();
                        playSound('damage');
                        
                        if (gameState.stamina <= 0) {
                            return "The door doesn't budge, and you strain yourself badly, taking " + damage + " damage! You collapse from exhaustion.";
                        } else {
                            return "The door is too strong! You strain yourself and take " + damage + " damage.";
                        }
                    }
                }
            },
            13: {
                text: "The slot is shaped like a crescent moon. It looks like it would accept some kind of key or amulet.",
                choices: [
                    {text: "Try the Silver Key if you have it", nextSection: 22, skillCheck: false, requirement: 'Silver Key'},
                    {text: "Try the Glowing Medallion if you have it", nextSection: 23, skillCheck: false, requirement: 'Glowing Medallion'},
                    {text: "Return to searching the room", nextSection: 5, skillCheck: false}
                ]
            },
            14: {
                text: "", // Will be filled by action
                choices: [
                    {text: "Continue", nextSection: 5, skillCheck: false}
                ]
            },
            15: {
                text: "You enter the chamber with the medallion. As you step inside, the medallion's glow intensifies, illuminating the entire room. The skeletal corpse in the center seems almost to recoil from the light.",
                choices: [
                    {text: "Approach the corpse", nextSection: 24, skillCheck: false},
                    {text: "Head straight for the door", nextSection: 25, skillCheck: false}
                ]
            },
            16: {
                text: "The footprints lead to the north wall. Upon closer inspection, you notice a section of the wall is actually a cleverly disguised door. It's slightly ajar.",
                choices: [
                    {text: "Enter the hidden door", nextSection: 26, skillCheck: false},
                    {text: "Return to the main room", nextSection: 5, skillCheck: false}
                ]
            },
            17: {
                text: "The symbol above the door glows brighter as you approach with the green torch. It's a protective ward meant to keep something contained. The journal from the chest might mention it.",
                choices: [
                    {text: "Continue examining the room", nextSection: 5, skillCheck: false}
                ]
            },
            18: {
                text: "You take the pouch and journal. The pouch contains 30 gold coins. The journal's pages are brittle with age.",
                choices: [
                    {text: "Read the journal now", nextSection: 27, skillCheck: false},
                    {text: "Continue exploring", nextSection: 6, skillCheck: false}
                ],
                action: function() {
                    gameState.gold += 30;
                    addToInventory('Ancient Journal');
                    updateStatsDisplay();
                    playSound('item');
                    return "You acquire <span class='gold'>30 Gold</span> and an <span class='item'>Ancient Journal</span>!";
                }
            },
            19: {
                text: "You open the journal and read the last entry: 'The seal must not be broken. The thing in the dark stirs. I have failed. The key is hidden in the wall. May the next soul to find this be more fortunate than I.'",
                choices: [
                    {text: "Take the journal and gold", nextSection: 28, skillCheck: false}
                ],
                action: function() {
                    gameState.gold += 30;
                    addToInventory('Ancient Journal');
                    updateStatsDisplay();
                    playSound('item');
                    return "You take the journal and <span class='gold'>30 Gold</span>. The journal mentions a key hidden in the wall.";
                }
            },
            20: {
                text: "You take the vial and map. The vial contains a red liquid that glows faintly. The map shows the layout of the first three chambers.",
                choices: [
                    {text: "Drink the vial", nextSection: 29, skillCheck: false},
                    {text: "Study the map", nextSection: 30, skillCheck: false},
                    {text: "Put them away and continue", nextSection: 6, skillCheck: false}
                ],
                action: function() {
                    addToInventory('Mysterious Vial');
                    addToInventory('Chamber Map');
                    playSound('item');
                    return "You acquire a <span class='item'>Mysterious Vial</span> and a <span class='item'>Chamber Map</span>!";
                }
            },
            21: {
                text: "", // Will be filled by action
                choices: [
                    {text: "Continue", nextSection: 100, skillCheck: false}
                ]
            },
            22: {
                text: "You insert the Silver Key into the slot. It fits perfectly! With a satisfying click, the door unlocks and swings open.",
                choices: [
                    {text: "Proceed through the door", nextSection: 100, skillCheck: false}
                ],
                action: function() {
                    // Remove the key from inventory since it's used
                    removeFromInventory('Silver Key');
                    playSound('success');
                    return "The <span class='item'>Silver Key</span> unlocks the door!";
                }
            },
            23: {
                text: "You place the Glowing Medallion into the crescent-shaped slot. It fits perfectly! The medallion glows brightly, and the door silently swings open.",
                choices: [
                    {text: "Proceed through the door", nextSection: 100, skillCheck: false}
                ],
                action: function() {
                    // Remove the medallion from inventory since it's used
                    removeFromInventory('Glowing Medallion');
                    playSound('success');
                    return "The <span class='item'>Glowing Medallion</span> unlocks the door!";
                }
            },
            24: {
                text: "As you approach with the glowing medallion, the skeletal corpse suddenly animates! It rises, clutching a rusted sword. You must defend yourself!",
                choices: [
                    {text: "Fight the animated skeleton", nextSection: 31, skillCheck: false}
                ]
            },
            25: {
                text: "Ignoring the corpse, you head straight for the door. The slot glows in response to your medallion, and the door opens without you even touching it.",
                choices: [
                    {text: "Proceed through the door", nextSection: 100, skillCheck: false}
                ]
            },
            26: {
                text: "You enter the hidden door and find a small alcove. Inside is a wooden chest and a skeleton slumped against the wall. This must be the remains of the journal's author.",
                choices: [
                    {text: "Open the chest", nextSection: 32, skillCheck: false},
                    {text: "Search the skeleton", nextSection: 33, skillCheck: false}
                ]
            },
            27: {
                text: "You skim through the journal. The author was an adventurer named Alric who came here seeking treasure. The last few entries become increasingly panicked, warning of a 'shadow creature' that guards the chambers. He mentions hiding a silver key behind a loose stone in the wall.",
                choices: [
                    {text: "Continue exploring", nextSection: 6, skillCheck: false}
                ]
            },
            28: {
                text: "With the journal's clue in mind, you know to look for a loose stone in the wall. The key must be hidden there.",
                choices: [
                    {text: "Search the walls for a loose stone", nextSection: 7, skillCheck: true, checkType: 'skill', difficulty: 10},
                    {text: "Continue to the door", nextSection: 6, skillCheck: false}
                ]
            },
            29: {
                text: "You drink the mysterious red liquid. It tastes sweet and warm. You feel energy coursing through your veins!",
                choices: [
                    {text: "Continue", nextSection: 6, skillCheck: false}
                ],
                action: function() {
                    removeFromInventory('Mysterious Vial');
                    const healAmount = rollDice(2, 6);
                    const oldStamina = gameState.stamina;
                    gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + healAmount);
                    const actualHeal = gameState.stamina - oldStamina;
                    updateStatsDisplay();
                    playSound('item');
                    return "You drink the <span class='item'>Mysterious Vial</span> and restore " + actualHeal + " Stamina!";
                }
            },
            30: {
                text: "The map shows the layout of the first three chambers. You're currently in Chamber 1. The map indicates a hidden alcove in the north wall of this chamber, and shows that Chamber 2 contains a pit trap near the entrance.",
                choices: [
                    {text: "Continue exploring", nextSection: 6, skillCheck: false}
                ],
                action: function() {
                    return "The <span class='item'>Chamber Map</span> will be useful in future chambers!";
                }
            },
            31: {
                text: "The skeleton attacks with its rusted sword! Prepare for combat!",
                choices: [
                    {text: "Begin the battle!", nextSection: 310, skillCheck: false}
                ]
            },
            310: {
                text: "You face the Animated Skeleton! Roll for initiative!",
                choices: [
                    {text: "Attack!", nextSection: 311, skillCheck: false}
                ],
                action: function() {
                    // Initialize combat for Animated Skeleton
                    combatState.active = true;
                    combatState.enemyName = "Animated Skeleton";
                    combatState.enemyStamina = 10;
                    combatState.enemyCurrentStamina = 10;
                    combatState.enemySkill = 7;
                    combatState.nextSection = 34;
                    combatState.round = 1;
                    
                    playSound('combat');
                    return "<span class='enemy'>Animated Skeleton</span>: Stamina " + combatState.enemyCurrentStamina + ", Skill " + combatState.enemySkill;
                }
            },
            32: {
                text: "You open the chest. Inside you find a finely crafted sword and a bag of gems!",
                choices: [
                    {text: "Take the treasure", nextSection: 35, skillCheck: false}
                ],
                action: function() {
                    gameState.gold += 50;
                    gameState.equippedWeapon = 'Steel Longsword';
                    updateStatsDisplay();
                    updateInventoryDisplay();
                    playSound('item');
                    return "You acquire a <span class='item'>Steel Longsword</span> and <span class='gold'>50 Gold</span> worth of gems!";
                }
            },
            33: {
                text: "You search the skeleton and find a silver ring on its finger and a scroll case tucked in its ribcage.",
                choices: [
                    {text: "Take the items", nextSection: 36, skillCheck: false}
                ],
                action: function() {
                    addToInventory('Silver Ring');
                    addToInventory('Scroll of Protection');
                    playSound('item');
                    return "You acquire a <span class='item'>Silver Ring</span> and a <span class='item'>Scroll of Protection</span>!";
                }
            },
            34: {
                text: "", // Will be filled by combat results
                choices: [
                    {text: "Continue", nextSection: 37, skillCheck: false}
                ]
            },
            35: {
                text: "With your new sword and wealth, you return to the main chamber. The door awaits.",
                choices: [
                    {text: "Approach the door", nextSection: 6, skillCheck: false}
                ]
            },
            36: {
                text: "With your newfound items, you return to the main chamber. The door awaits.",
                choices: [
                    {text: "Approach the door", nextSection: 6, skillCheck: false}
                ]
            },
            37: {
                text: "After defeating the skeleton, you find that it was guarding a small iron key on a chain around its neck.",
                choices: [
                    {text: "Take the key and continue to the door", nextSection: 38, skillCheck: false}
                ],
                action: function() {
                    addToInventory('Iron Key');
                    playSound('item');
                    return "You find an <span class='item'>Iron Key</span> on the skeleton's neck!";
                }
            },
            38: {
                text: "You approach the door with the iron key. The slot is shaped differently than the key you have, but as you try it, the key transforms in your hand to fit the lock! The door opens.",
                choices: [
                    {text: "Proceed through the door", nextSection: 100, skillCheck: false}
                ],
                action: function() {
                    removeFromInventory('Iron Key');
                    playSound('success');
                    return "The <span class='item'>Iron Key</span> magically transforms to unlock the door!";
                }
            },
            // Combat sections
            311: {
                text: "", // Will be filled by combat round
                choices: [
                    {text: "Continue the fight!", nextSection: 312, skillCheck: false}
                ]
            },
            312: {
                text: "", // Will be filled by combat round
                choices: [
                    {text: "Continue the fight!", nextSection: 311, skillCheck: false}
                ]
            },
            100: {
                text: "Congratulations! You have survived the Entrance Chamber of the Chambers of Fear. The door leads to a dark corridor descending deeper into the complex. You can now continue your journey to Chamber 2.",
                choices: [],
                action: function() {
                    gameState.gameComplete = true;
                    showScreen('screen-next');
                    document.getElementById('next-stat-skill').textContent = gameState.skill;
                    document.getElementById('next-stat-stamina').textContent = gameState.stamina;
                    document.getElementById('next-stat-luck').textContent = gameState.luck;
                    document.getElementById('next-stat-gold').textContent = gameState.gold;
                    playSound('level');
                    
                    // Save completed level state
                    gameState.level = 2;
                    saveGame();
                    
                    return "";
                }
            }
        };
        
        // Initialize game
        function initGame() {
            // Check for saved game
            const savedGame = localStorage.getItem('chambersOfFearGameState');
            if (savedGame) {
                const savedState = JSON.parse(savedGame);
                
                // Only load if saved level is 1 (this page)
                if (savedState.level === 1) {
                    Object.assign(gameState, savedState);
                    
                    updateStatsDisplay();
                    updateInventoryDisplay();
                    showScreen('screen-game');
                    loadSection(gameState.currentSection);
                    return;
                }
            }
            
            // Otherwise start with character creation
            showScreen('screen-creation');
        }
        
        // Show specific screen
        function showScreen(screenId) {
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => {
                screen.classList.remove('active-screen');
            });
            document.getElementById(screenId).classList.add('active-screen');
        }
        
        // Select character class
        function selectClass(className) {
            playSound('click');
            gameState.playerClass = className;
            document.getElementById('selected-class').textContent = className.toUpperCase();
            document.getElementById('dice-roll-section').style.display = 'block';
        }
        
        // Roll dice for character stats
        function rollCharacterStats() {
            playSound('roll');
            
            const skillRoll = rollDice(2, 6);
            const staminaRoll = rollDice(2, 6);
            const luckRoll = rollDice(2, 6);
            
            // Apply class bonuses
            let skillBonus = 0, staminaBonus = 0, luckBonus = 0;
            
            switch(gameState.playerClass) {
                case 'warrior':
                    skillBonus = 3;
                    staminaBonus = 6;
                    luckBonus = 0;
                    break;
                case 'scout':
                    skillBonus = 4;
                    staminaBonus = 3;
                    luckBonus = 2;
                    break;
                case 'mystic':
                    skillBonus = 2;
                    staminaBonus = 3;
                    luckBonus = 4;
                    break;
            }
            
            gameState.skill = skillRoll + skillBonus;
            gameState.maxStamina = staminaRoll + staminaBonus;
            gameState.stamina = gameState.maxStamina;
            gameState.luck = luckRoll + luckBonus;
            gameState.gold = 10; // Starting gold
            
            // Starting equipment
            gameState.inventory = ['Rusty Dagger', 'Leather Tunic', 'Healing Herb'];
            gameState.equippedWeapon = 'Rusty Dagger';
            gameState.equippedArmor = 'Leather Tunic';
            
            document.getElementById('dice-results').innerHTML = `
                <div class="dice-roll">Skill Roll: ${skillRoll} + ${skillBonus} = <span class="stat-value">${gameState.skill}</span></div>
                <div class="dice-roll">Stamina Roll: ${staminaRoll} + ${staminaBonus} = <span class="stat-value">${gameState.maxStamina}</span></div>
                <div class="dice-roll">Luck Roll: ${luckRoll} + ${luckBonus} = <span class="stat-value">${gameState.luck}</span></div>
            `;
            
            document.getElementById('confirm-btn').disabled = false;
        }
        
        // Confirm stats and start game
        function confirmStats() {
            playSound('click');
            updateStatsDisplay();
            updateInventoryDisplay();
            showScreen('screen-game');
            loadSection(1);
        }
        
        // Update stats display
        function updateStatsDisplay() {
            document.getElementById('stat-skill').textContent = gameState.skill;
            document.getElementById('stat-stamina').textContent = gameState.stamina;
            document.getElementById('stat-maxstamina').textContent = gameState.maxStamina;
            document.getElementById('stat-luck').textContent = gameState.luck;
            document.getElementById('stat-gold').textContent = gameState.gold;
        }
        
        // Add item to inventory
        function addToInventory(item) {
            if (!gameState.inventory.includes(item)) {
                gameState.inventory.push(item);
                updateInventoryDisplay();
            }
        }
        
        // Remove item from inventory
        function removeFromInventory(item) {
            const index = gameState.inventory.indexOf(item);
            if (index !== -1) {
                gameState.inventory.splice(index, 1);
                updateInventoryDisplay();
            }
        }
        
        // Update inventory display
        function updateInventoryDisplay() {
            const inventoryDiv = document.getElementById('inventory');
            inventoryDiv.innerHTML = '';
            
            // Add equipped weapon and armor first
            const equippedWeapon = document.createElement('div');
            equippedWeapon.className = 'inventory-item equipped';
            equippedWeapon.textContent = gameState.equippedWeapon;
            equippedWeapon.onclick = () => {
                playSound('click');
                document.getElementById('story-text').innerHTML += 
                    `<div class="dice-roll">Currently equipped: <span class='item'>${gameState.equippedWeapon}</span></div>`;
            };
            inventoryDiv.appendChild(equippedWeapon);
            
            const equippedArmor = document.createElement('div');
            equippedArmor.className = 'inventory-item equipped';
            equippedArmor.textContent = gameState.equippedArmor;
            equippedArmor.onclick = () => {
                playSound('click');
                document.getElementById('story-text').innerHTML += 
                    `<div class="dice-roll">Currently equipped: <span class='item'>${gameState.equippedArmor}</span></div>`;
            };
            inventoryDiv.appendChild(equippedArmor);
            
            // Add other inventory items
            gameState.inventory.forEach(item => {
                // Skip if it's the equipped weapon or armor
                if (item !== gameState.equippedWeapon && item !== gameState.equippedArmor) {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'inventory-item';
                    itemElement.textContent = item;
                    itemElement.onclick = () => {
                        useInventoryItem(item);
                    };
                    inventoryDiv.appendChild(itemElement);
                }
            });
            
            // Update inventory count
            const totalItems = gameState.inventory.length + 2; // +2 for equipped items
            document.getElementById('inventory-count').textContent = `ITEMS: ${totalItems}/10`;
        }
        
        // Use inventory item
        function useInventoryItem(item) {
            playSound('click');
            let message = "";
            
            if (item === 'Healing Herb') {
                const healAmount = rollDice(1, 6);
                const oldStamina = gameState.stamina;
                gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + healAmount);
                const actualHeal = gameState.stamina - oldStamina;
                removeFromInventory('Healing Herb');
                playSound('item');
                message = `You use the <span class='item'>Healing Herb</span> and restore ${actualHeal} Stamina!`;
                updateStatsDisplay();
            } else if (item === 'Green Torch') {
                message = "The <span class='item'>Green Torch</span> casts an eerie light. It might reveal hidden secrets in dark places.";
            } else if (item === 'Ancient Journal') {
                message = "The <span class='item'>Ancient Journal</span> contains warnings about the chambers. It mentions a key hidden behind a loose stone.";
            } else if (item === 'Chamber Map') {
                message = "The <span class='item'>Chamber Map</span> shows the layout of the first three chambers. Chamber 2 has a pit trap near the entrance.";
            } else if (item === 'Scroll of Protection') {
                gameState.luck += 2;
                removeFromInventory('Scroll of Protection');
                playSound('item');
                message = "You read the <span class='item'>Scroll of Protection</span>. You feel luckier! Luck +2";
                updateStatsDisplay();
            } else if (item === 'Silver Ring') {
                message = "The <span class='item'>Silver Ring</span> is engraved with protective runes. It might have magical properties.";
            } else {
                message = `You examine the <span class='item'>${item}</span>.`;
            }
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${message}</div>`;
        }
        
        // Use item from action button
        function useItem() {
            playSound('click');
            if (gameState.inventory.length === 0 && 
                gameState.equippedWeapon === 'Rusty Dagger' && 
                gameState.equippedArmor === 'Leather Tunic') {
                document.getElementById('story-text').innerHTML += 
                    `<div class="dice-roll">You have no usable items in your inventory.</div>`;
                return;
            }
            
            let itemText = "<div class='dice-roll'><strong>Select an item to use:</strong><br>";
            
            // Show equipped items
            itemText += `<br><strong>Equipped:</strong><br>`;
            itemText += `<button onclick="useInventoryItem('${gameState.equippedWeapon}')" class="action-btn" style="margin: 5px;">${gameState.equippedWeapon}</button> `;
            itemText += `<button onclick="useInventoryItem('${gameState.equippedArmor}')" class="action-btn" style="margin: 5px;">${gameState.equippedArmor}</button>`;
            
            // Show inventory items
            const usableItems = gameState.inventory.filter(item => 
                item !== gameState.equippedWeapon && item !== gameState.equippedArmor);
            
            if (usableItems.length > 0) {
                itemText += `<br><br><strong>Inventory:</strong><br>`;
                usableItems.forEach(item => {
                    itemText += `<button onclick="useInventoryItem('${item}')" class="action-btn" style="margin: 5px;">${item}</button> `;
                });
            }
            
            itemText += `<br><br><button onclick="document.getElementById('story-text').innerHTML += '<div class=dice-roll>Item use cancelled.</div>'" class="action-btn">Cancel</button>`;
            itemText += "</div>";
            
            document.getElementById('story-text').innerHTML += itemText;
        }
        
        // Load story section
        function loadSection(sectionId) {
            playSound('click');
            gameState.currentSection = sectionId;
            const section = storySections[sectionId];
            
            if (!section) {
                document.getElementById('story-text').innerHTML = "<p class='game-over'>Error: Story section not found!</p>";
                return;
            }
            
            let storyText = section.text;
            
            // Check if this is a combat round section
            const isCombatRound = (sectionId === 311 || sectionId === 312);
            
            if (isCombatRound && combatState.active) {
                // Execute combat round
                const combatResult = executeCombatRound();
                storyText = combatResult;
                
                // Check if combat is over
                if (!combatState.active) {
                    // Combat ended
                    const goldReward = Math.floor(Math.random() * 20) + 10;
                    gameState.gold += goldReward;
                    updateStatsDisplay();
                    
                    storyText += `<br><span class="success">You defeated the ${combatState.enemyName}!</span>`;
                    storyText += `<br>You find <span class="gold">${goldReward} Gold</span> on the remains.`;
                    
                    // Clear choice buttons - combat is over
                    document.getElementById('choice-buttons').innerHTML = '';
                    
                    // Auto-continue to next section after combat
                    setTimeout(() => {
                        loadSection(combatState.nextSection);
                    }, 2000);
                }
            }
            
            // Execute any section action
            if (section.action) {
                const actionResult = section.action();
                if (actionResult) {
                    storyText += "<br><br>" + actionResult;
                }
            }
            
            document.getElementById('story-text').innerHTML = "<p>" + storyText + "</p><div class='blinking-cursor'></div>";
            
            // Only show choice buttons if not in an ended combat
            if (!isCombatRound || combatState.active) {
                const choiceButtons = document.getElementById('choice-buttons');
                choiceButtons.innerHTML = '';
                
                // Filter choices based on requirements
                const availableChoices = section.choices.filter(choice => {
                    if (!choice.requirement) return true;
                    return gameState.inventory.includes(choice.requirement) || 
                           gameState.equippedWeapon === choice.requirement ||
                           gameState.equippedArmor === choice.requirement;
                });
                
                // If no choices available (and not a special section), provide a default
                if (availableChoices.length === 0 && section.choices.length > 0) {
                    const button = document.createElement('button');
                    button.className = 'choice-btn';
                    button.textContent = "Continue exploring the chamber";
                    button.onclick = function() {
                        loadSection(5); // Go back to searching the room
                    };
                    choiceButtons.appendChild(button);
                } else {
                    availableChoices.forEach(choice => {
                        const button = document.createElement('button');
                        button.className = 'choice-btn';
                        button.textContent = choice.text;
                        button.onclick = function() {
                            if (choice.skillCheck) {
                                performSkillCheck(choice.checkType, choice.difficulty, choice.nextSection);
                            } else {
                                loadSection(choice.nextSection);
                            }
                        };
                        choiceButtons.appendChild(button);
                    });
                }
            }
            
            // Save game progress
            saveGame();
        }
        
        // Execute one round of combat
        function executeCombatRound() {
            combatState.round++;
            
            // Roll dice for both combatants
            const playerRoll = rollDice(2, 6);
            const enemyRoll = rollDice(2, 6);
            
            // Add skill to dice rolls
            const playerTotal = playerRoll + gameState.skill;
            const enemyTotal = enemyRoll + combatState.enemySkill;
            
            let resultText = `<div class="combat-log"><span class="enemy">ROUND ${combatState.round}: ${combatState.enemyName}</span><br>`;
            resultText += `Your Stamina: ${gameState.stamina}, Enemy Stamina: ${combatState.enemyCurrentStamina}<br>`;
            resultText += `You roll ${playerRoll} + Skill ${gameState.skill} = <strong>${playerTotal}</strong><br>`;
            resultText += `Enemy rolls ${enemyRoll} + Skill ${combatState.enemySkill} = <strong>${enemyTotal}</strong><br>`;
            
            if (playerTotal > enemyTotal) {
                // Player hits enemy
                let damage = 0;
                if (gameState.equippedWeapon === 'Rusty Dagger') damage = rollDice(1, 6);
                else if (gameState.equippedWeapon === 'Steel Longsword') damage = rollDice(2, 6);
                else damage = rollDice(1, 6); // Default
                
                combatState.enemyCurrentStamina -= damage;
                resultText += `<span class="success">You hit for ${damage} damage!</span><br>`;
                playSound('combat');
                
                if (combatState.enemyCurrentStamina <= 0) {
                    combatState.active = false;
                    resultText += `</div>`;
                    return resultText;
                }
                
            } else if (playerTotal < enemyTotal) {
                // Enemy hits player
                const enemyDamage = rollDice(1, 6);
                gameState.stamina -= enemyDamage;
                resultText += `<span class="damage">The ${combatState.enemyName} hits you for ${enemyDamage} damage!</span>`;
                playSound('damage');
                
                // Check if player died
                if (gameState.stamina <= 0) {
                    combatState.active = false;
                    resultText += `<br><span class="game-over">You have been defeated! Game Over.</span>`;
                    resultText += `</div>`;
                    
                    setTimeout(() => {
                        localStorage.removeItem('chambersOfFearGameState');
                        location.reload();
                    }, 3000);
                    
                    return resultText;
                }
            } else {
                // Tie - no damage dealt
                resultText += "The attacks are evenly matched! No damage dealt this round.";
            }
            
            resultText += `</div>`;
            updateStatsDisplay();
            
            return resultText;
        }
        
        // Perform skill check
        function performSkillCheck(checkType, difficulty, nextSection) {
            playSound('roll');
            const diceRoll = rollDice(2, 6);
            let statValue = gameState[checkType];
            let success = diceRoll <= statValue;
            
            // Store result globally for section actions to use
            window.checkResult = success;
            
            let resultText = `You roll ${diceRoll}. Your ${checkType.toUpperCase()} is ${statValue}. `;
            resultText += success ? 
                `<span class="success">Success!</span>` : 
                `<span class="damage">Failure!</span>`;
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${resultText}</div>`;
            
            if (success) {
                playSound('success');
            } else {
                playSound('failure');
            }
            
            // Continue to next section after a brief delay
            setTimeout(() => {
                loadSection(nextSection);
            }, 1500);
        }
        
        // Use Luck
        function useLuck() {
            playSound('click');
            if (gameState.luck <= 0) {
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">You have no Luck left!</div>`;
                return;
            }
            
            const diceRoll = rollDice(2, 6);
            const success = diceRoll <= gameState.luck;
            
            gameState.luck -= 1;
            updateStatsDisplay();
            
            let resultText = `You test your Luck... Roll: ${diceRoll}, Luck: ${gameState.luck + 1}. `;
            resultText += success ? 
                `<span class="success">Lucky!</span> Something good happens.` : 
                `<span class="damage">Unlucky!</span> Something bad happens.`;
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${resultText}</div>`;
            
            if (success) {
                playSound('success');
            } else {
                playSound('failure');
            }
            
            // Apply Luck effect
            if (success) {
                // Good effect
                const goodEffects = [
                    "You find 5 Gold on the ground!",
                    "You feel a surge of energy! Restore 3 Stamina.",
                    "You spot a hidden path that might be useful."
                ];
                const effect = goodEffects[Math.floor(Math.random() * goodEffects.length)];
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">${effect}</div>`;
                
                if (effect.includes("Gold")) {
                    gameState.gold += 5;
                } else if (effect.includes("Stamina")) {
                    gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + 3);
                }
            } else {
                // Bad effect
                const badEffects = [
                    "You trip and take 2 damage!",
                    "You drop 3 Gold!",
                    "You feel weaker. Lose 1 Skill until next rest."
                ];
                const effect = badEffects[Math.floor(Math.random() * badEffects.length)];
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">${effect}</div>`;
                
                if (effect.includes("damage")) {
                    gameState.stamina -= 2;
                    playSound('damage');
                } else if (effect.includes("Gold")) {
                    gameState.gold = Math.max(0, gameState.gold - 3);
                } else if (effect.includes("Skill")) {
                    gameState.skill = Math.max(1, gameState.skill - 1);
                }
            }
            
            updateStatsDisplay();
            updateInventoryDisplay();
        }
        
        // Save game
        function saveGame() {
            playSound('click');
            localStorage.setItem('chambersOfFearGameState', JSON.stringify(gameState));
            document.getElementById('story-text').innerHTML += `<div class="dice-roll"><span class="success">Game saved!</span></div>`;
        }
        
        // Load game
        function loadGame() {
            playSound('click');
            const savedGame = localStorage.getItem('chambersOfFearGameState');
            if (savedGame) {
                const savedState = JSON.parse(savedGame);
                
                // Only load if saved level is 1 (this page)
                if (savedState.level === 1) {
                    Object.assign(gameState, savedState);
                    
                    updateStatsDisplay();
                    updateInventoryDisplay();
                    showScreen('screen-game');
                    loadSection(gameState.currentSection);
                    
                    document.getElementById('story-text').innerHTML += `<div class="dice-roll"><span class="success">Game loaded!</span></div>`;
                } else {
                    document.getElementById('story-text').innerHTML += `<div class="dice-roll">No saved game found for Level 1.</div>`;
                }
            } else {
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">No saved game found.</div>`;
            }
        }
        
        // Go to next level
        function goToNextLevel() {
            playSound('click');
            // Save game state for level 2 with updated level
            gameState.level = 2;
            localStorage.setItem('chambersOfFearGameState', JSON.stringify(gameState));
            // Redirect to level 2
            window.location.href = 'l2.html';
        }
        
        // Utility function to roll dice
        function rollDice(num, sides) {
            let total = 0;
            for (let i = 0; i < num; i++) {
                total += Math.floor(Math.random() * sides) + 1;
            }
            return total;
        }
        
        // Initialize on load
        window.onload = initGame;
        
        // Add click sound to all buttons
        document.addEventListener('DOMContentLoaded', function() {
            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => {
                button.addEventListener('click', function() {
                    playSound('click');
                });
            });
        });
    </script>
</body>
</html>
