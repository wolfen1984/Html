<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soul Binder's Legacy - Necromancer RPG</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }
        
        body {
            background-color: #0a0a14;
            color: #8a2be8;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(138, 43, 232, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(75, 0, 130, 0.1) 0%, transparent 20%);
        }
        
        #game-container {
            width: 100%;
            max-width: 500px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            border: 2px solid #8a2be8;
            background-color: #0f0f1a;
            position: relative;
            box-shadow: 0 0 20px rgba(138, 43, 232, 0.5);
        }
        
        .screen {
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            padding: 10px;
            overflow-y: auto;
        }
        
        .active {
            display: flex;
        }
        
        h1, h2, h3 {
            color: #8a2be8;
            text-align: center;
            margin: 10px 0;
            text-transform: uppercase;
            text-shadow: 0 0 10px rgba(138, 43, 232, 0.7);
        }
        
        .button {
            background-color: #0f0f1a;
            color: #8a2be8;
            border: 1px solid #8a2be8;
            padding: 10px;
            margin: 5px 0;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .button:hover {
            background-color: #8a2be8;
            color: #0f0f1a;
            box-shadow: 0 0 10px rgba(138, 43, 232, 0.7);
        }
        
        .button:active {
            transform: scale(0.98);
        }
        
        .button.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            border-bottom: 1px dashed #8a2be8;
            padding-bottom: 10px;
        }
        
        .log {
            border: 1px solid #8a2be8;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            margin: 10px 0;
            font-size: 14px;
            background-color: rgba(15, 15, 26, 0.8);
        }
        
        .log-entry {
            margin: 5px 0;
        }
        
        .inventory-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
        }
        
        .item {
            border: 1px solid #8a2be8;
            padding: 8px;
            cursor: pointer;
            position: relative;
            background-color: rgba(15, 15, 26, 0.8);
        }
        
        .item-stats {
            font-size: 12px;
            margin-top: 5px;
        }
        
        .equipment-slots {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
        }
        
        .equipment-slot {
            border: 1px solid #8a2be8;
            padding: 8px;
            min-height: 60px;
            background-color: rgba(15, 15, 26, 0.8);
        }
        
        .equipment-stats {
            font-size: 12px;
            margin-top: 5px;
        }
        
        .enemy {
            text-align: center;
            margin: 20px 0;
            font-size: 24px;
            position: relative;
        }
        
        .battle-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .spell-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 5px;
            margin: 10px 0;
        }
        
        .spell-item {
            border: 1px solid #8a2be8;
            padding: 8px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            background-color: rgba(15, 15, 26, 0.8);
        }
        
        .spell-info {
            flex: 1;
        }
        
        .spell-cost {
            color: #00ffff;
            margin-left: 10px;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #000;
            border: 1px solid #8a2be8;
            margin: 5px 0;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: #8a2be8;
            width: 0%;
            transition: width 0.3s;
        }
        
        .souls-bar {
            background-color: #4b0082;
        }
        
        .class-select {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        
        .class-option {
            border: 1px solid #8a2be8;
            padding: 15px;
            cursor: pointer;
            background-color: rgba(15, 15, 26, 0.8);
        }
        
        .class-option:hover {
            background-color: #8a2be8;
            color: #0f0f1a;
        }
        
        .minion-display {
            display: flex;
            justify-content: space-around;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        
        .minion-slot {
            border: 1px solid #8a2be8;
            padding: 5px;
            margin: 5px;
            min-width: 80px;
            text-align: center;
            background-color: rgba(15, 15, 26, 0.8);
        }
        
        .minion-health {
            font-size: 10px;
            color: #ff5555;
        }
        
        .soul-counter {
            color: #00ffff;
            font-weight: bold;
        }
        
        .necromancy-button {
            background: linear-gradient(45deg, #4b0082, #8a2be8);
            color: white;
            border: 1px solid #00ffff;
        }
        
        .floating-text {
            position: absolute;
            font-weight: bold;
            pointer-events: none;
            z-index: 100;
            animation: floatUp 1s ease-out forwards;
        }
        
        .damage-text {
            color: #ff5555;
        }
        
        .heal-text {
            color: #55ff55;
        }
        
        .soul-text {
            color: #00ffff;
        }
        
        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-30px); opacity: 0; }
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .rarity-common { color: #fff; }
        .rarity-uncommon { color: #1eff00; }
        .rarity-rare { color: #0070dd; }
        .rarity-epic { color: #a335ee; }
        .rarity-legendary { color: #ff8000; }
        
        .tooltip {
            position: absolute;
            background: #0f0f1a;
            border: 1px solid #8a2be8;
            padding: 8px;
            z-index: 1000;
            max-width: 250px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .tooltip.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- Start Screen -->
        <div id="start-screen" class="screen active">
            <h1>SOUL BINDER'S LEGACY</h1>
            <h3>Necromancer RPG</h3>
            <div style="margin: 40px 0; text-align: center;">
                <p>In the shadowed halls of the forgotten necropolis,</p>
                <p>you awaken to the call of ancient powers.</p>
                <p>Master the arts of death and command the fallen.</p>
            </div>
            <div class="button" id="start-button">BEGIN DARK JOURNEY</div>
            <div class="button" id="load-button">CONTINUE LEGACY</div>
        </div>
        
        <!-- Class Selection Screen -->
        <div id="class-screen" class="screen">
            <h1>CHOOSE YOUR PATH</h1>
            <div class="class-select">
                <div class="class-option" data-class="soulbinder">
                    <h3>SOUL BINDER</h3>
                    <p>Master of soul manipulation</p>
                    <p>Commands powerful spirits</p>
                    <p>Starts with Soul Bolt and Soul Shield</p>
                </div>
                <div class="class-option" data-class="boneweaver">
                    <h3>BONE WEAVER</h3>
                    <p>Creator of undead minions</p>
                    <p>Can raise skeletal warriors</p>
                    <p>Starts with Raise Skeleton and Bone Armor</p>
                </div>
                <div class="class-option" data-class="plaguemaster">
                    <h3>PLAGUE MASTER</h3>
                    <p>Wielder of decay and disease</p>
                    <p>Poisons and curses enemies</p>
                    <p>Starts with Plague Bolt and Decaying Touch</p>
                </div>
            </div>
        </div>
        
        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <h2>NECROPOLIS OF SOULS</h2>
            <div class="stats">
                <div>
                    <div>Level: <span id="player-level">1</span></div>
                    <div>HP: <span id="player-hp">100</span>/<span id="player-max-hp">100</span></div>
                    <div>Mana: <span id="player-mp">80</span>/<span id="player-max-mp">80</span></div>
                </div>
                <div>
                    <div>Souls: <span id="player-souls" class="soul-counter">0</span></div>
                    <div>EXP: <span id="player-exp">0</span>/<span id="player-exp-needed">100</span></div>
                </div>
            </div>
            
            <div class="progress-bar">
                <div id="exp-bar" class="progress-fill" style="width: 0%"></div>
            </div>
            <div class="progress-bar">
                <div id="souls-bar" class="progress-fill souls-bar" style="width: 0%"></div>
            </div>
            
            <h3>ACTIVE MINIONS</h3>
            <div class="minion-display" id="minion-display">
                <!-- Minions will appear here -->
                <div class="minion-slot">Empty</div>
                <div class="minion-slot">Empty</div>
            </div>
            
            <div class="button necromancy-button" id="explore-button">EXPLORE NECROPOLIS</div>
            <div class="button" id="inventory-button">DARK ARTIFACTS</div>
            <div class="button" id="spells-button">NECROMANTIC ARTS</div>
            <div class="button" id="raise-button">RAISE THE DEAD</div>
            <div class="button" id="rituals-button">DARK RITUALS</div>
            <div class="button" id="save-button">BIND SOUL</div>
            
            <div class="log" id="game-log">
                <div class="log-entry">You stand amidst ancient tombs, the air thick with spiritual energy...</div>
            </div>
        </div>
        
        <!-- Battle Screen -->
        <div id="battle-screen" class="screen">
            <h2>BATTLE IN THE SHADOWS</h2>
            <div class="stats">
                <div>
                    <div>HP: <span id="battle-player-hp">100</span>/<span id="battle-player-max-hp">100</span></div>
                    <div>Mana: <span id="battle-player-mp">80</span>/<span id="battle-player-max-mp">80</span></div>
                </div>
                <div>
                    <div>Souls: <span id="battle-player-souls" class="soul-counter">0</span></div>
                    <div><span id="enemy-name">Spectral Apparition</span> HP: <span id="enemy-hp">50</span>/<span id="enemy-max-hp">50</span></div>
                </div>
            </div>
            
            <h3>YOUR MINIONS</h3>
            <div class="minion-display" id="battle-minion-display">
                <!-- Battle minions will appear here -->
            </div>
            
            <div class="enemy" id="enemy-display">[ENEMY]</div>
            
            <div class="log" id="battle-log">
                <div class="log-entry">A hostile spirit manifests before you!</div>
            </div>
            
            <div class="battle-actions">
                <div class="button" id="attack-button">DARK BOLT</div>
                <div class="button" id="spell-button">NECROMANCY</div>
                <div class="button" id="minion-button">COMMAND MINIONS</div>
                <div class="button" id="soul-button">HARVEST SOUL</div>
            </div>
        </div>
        
        <!-- Spell Selection Screen -->
        <div id="spell-select-screen" class="screen">
            <h2>NECROMANTIC ARTS</h2>
            <div class="stats">
                <div>Mana: <span id="spell-select-mp">80</span>/<span id="spell-select-max-mp">80</span></div>
                <div>Souls: <span id="spell-select-souls" class="soul-counter">0</span></div>
            </div>
            <div id="spell-select-list" class="spell-list">
                <!-- Spells will be added here dynamically -->
            </div>
            <div class="button" id="back-from-spell-select">BACK</div>
        </div>
        
        <!-- Minion Command Screen -->
        <div id="minion-command-screen" class="screen">
            <h2>COMMAND YOUR MINIONS</h2>
            <div id="minion-command-list" class="spell-list">
                <!-- Minion commands will be added here -->
            </div>
            <div class="button" id="back-from-minion-command">BACK</div>
        </div>
        
        <!-- Raise Dead Screen -->
        <div id="raise-screen" class="screen">
            <h2>RAISE THE DEAD</h2>
            <div class="stats">
                <div>Souls: <span id="raise-souls" class="soul-counter">0</span></div>
                <div>Remains: <span id="player-remains">0</span></div>
            </div>
            <div id="raise-options" class="spell-list">
                <!-- Raise options will be added here -->
            </div>
            <div class="button" id="back-from-raise">BACK</div>
        </div>
        
        <!-- Inventory Screen -->
        <div id="inventory-screen" class="screen">
            <h2>DARK ARTIFACTS</h2>
            <div class="inventory-grid" id="inventory-items">
                <!-- Items will be added here dynamically -->
            </div>
            <div class="button" id="back-from-inventory">BACK</div>
        </div>
        
        <!-- Rituals Screen -->
        <div id="rituals-screen" class="screen">
            <h2>DARK RITUALS</h2>
            <div id="rituals-list" class="spell-list">
                <!-- Rituals will be added here -->
            </div>
            <div class="button" id="back-from-rituals">BACK</div>
        </div>
        
        <!-- Loot Screen -->
        <div id="loot-screen" class="screen">
            <h2>VICTORY!</h2>
            <div class="log">
                <div class="log-entry">You have defeated your enemy!</div>
                <div class="log-entry">You gained <span id="exp-gained">0</span> experience!</div>
                <div class="log-entry">You collected <span id="souls-gained">0</span> souls!</div>
                <div class="log-entry">You found:</div>
                <div id="loot-items">
                    <!-- Loot items will be added here -->
                </div>
            </div>
            <div class="button" id="take-loot">CONTINUE</div>
        </div>
    </div>

    <script>
        // Game State
        const gameState = {
            currentScreen: 'start',
            player: {
                class: null,
                level: 1,
                exp: 0,
                expNeeded: 100,
                hp: 100,
                maxHp: 100,
                mp: 80,
                maxMp: 80,
                souls: 0,
                maxSouls: 100,
                strength: 8,
                defense: 6,
                magic: 12,
                intelligence: 14,
                remains: 5,
                equipment: {
                    head: null,
                    chest: null,
                    hands: null,
                    mainhand: null,
                    offhand: null
                },
                inventory: [],
                spells: [],
                minions: [],
                statusEffects: [],
                skillPoints: 0,
                skills: []
            },
            currentEnemy: null,
            battleLog: [],
            gameLog: [],
            enemyMaxHp: 0
        };

        // Necromancer Classes
        const classes = {
            soulbinder: {
                name: "Soul Binder",
                hp: 90,
                mp: 100,
                souls: 0,
                maxSouls: 120,
                strength: 6,
                defense: 8,
                magic: 16,
                intelligence: 16,
                startingItems: ['soul_crystal', 'tattered_robe', 'soul_shard'],
                startingSpells: ['soul_bolt', 'soul_shield']
            },
            boneweaver: {
                name: "Bone Weaver",
                hp: 110,
                mp: 70,
                souls: 0,
                maxSouls: 80,
                strength: 10,
                defense: 12,
                magic: 14,
                intelligence: 12,
                startingItems: ['bone_staff', 'bone_armor', 'skeleton_hand'],
                startingSpells: ['raise_skeleton', 'bone_armor']
            },
            plaguemaster: {
                name: "Plague Master",
                hp: 100,
                mp: 90,
                souls: 0,
                maxSouls: 100,
                strength: 8,
                defense: 10,
                magic: 15,
                intelligence: 14,
                startingItems: ['plague_dagger', 'rotten_robe', 'vial_of_poison'],
                startingSpells: ['plague_bolt', 'decaying_touch']
            }
        };

        // Necromancy Spells
        const spells = {
            // Soul Binder Spells
            soul_bolt: { 
                name: "Soul Bolt", 
                cost: 5, 
                damage: { min: 12, max: 18 },
                type: "attack",
                description: "Launch a bolt of pure soul energy",
                classReq: "soulbinder"
            },
            soul_shield: { 
                name: "Soul Shield", 
                cost: 10, 
                power: 15, 
                type: "defense",
                description: "Create a protective barrier of soul energy",
                duration: 3,
                classReq: "soulbinder"
            },
            soul_harvest: {
                name: "Soul Harvest",
                cost: 8,
                damage: { min: 8, max: 12 },
                type: "attack",
                description: "Damage enemy and collect their soul energy",
                soulGain: 5,
                classReq: "soulbinder",
                levelReq: 3
            },
            
            // Bone Weaver Spells
            raise_skeleton: { 
                name: "Raise Skeleton", 
                cost: 15, 
                souls: 10,
                type: "minion",
                description: "Raise a skeleton warrior from remains",
                minion: "skeleton_warrior",
                classReq: "boneweaver"
            },
            bone_armor: { 
                name: "Bone Armor", 
                cost: 12, 
                power: 20, 
                type: "defense",
                description: "Surround yourself with protective bones",
                duration: 4,
                classReq: "boneweaver"
            },
            bone_spear: {
                name: "Bone Spear",
                cost: 10,
                damage: { min: 15, max: 22 },
                type: "attack",
                description: "Launch a sharpened bone at your enemy",
                classReq: "boneweaver",
                levelReq: 3
            },
            
            // Plague Master Spells
            plague_bolt: { 
                name: "Plague Bolt", 
                cost: 7, 
                damage: { min: 10, max: 15 },
                type: "attack",
                description: "Inflict disease upon your enemy",
                effect: { type: "poison", damage: 3, duration: 3, chance: 0.7 },
                classReq: "plaguemaster"
            },
            decaying_touch: { 
                name: "Decaying Touch", 
                cost: 12, 
                damage: { min: 8, max: 12 },
                type: "attack",
                description: "Weaken enemy defenses with decay",
                effect: { type: "defense_down", value: 5, duration: 3, chance: 0.8 },
                classReq: "plaguemaster"
            },
            corpse_explosion: {
                name: "Corpse Explosion",
                cost: 20,
                souls: 15,
                type: "attack",
                description: "Cause a fallen minion to explode",
                damage: { min: 25, max: 35 },
                classReq: "plaguemaster",
                levelReq: 5
            }
        };

        // Minions
        const minions = {
            skeleton_warrior: {
                name: "Skeleton Warrior",
                hp: 30,
                attack: 8,
                defense: 5,
                cost: 10, // souls cost
                remains: 1,
                abilities: ["basic_attack"],
                description: "A basic undead soldier"
            },
            spectral_archer: {
                name: "Spectral Archer",
                hp: 25,
                attack: 12,
                defense: 3,
                cost: 15,
                remains: 1,
                abilities: ["ranged_attack"],
                description: "A ghostly archer that attacks from distance",
                levelReq: 3
            },
            zombie_brute: {
                name: "Zombie Brute",
                hp: 50,
                attack: 10,
                defense: 8,
                cost: 20,
                remains: 2,
                abilities: ["heavy_attack"],
                description: "A slow but durable undead tank",
                levelReq: 5
            }
        };

        // Items
        const items = {
            // Soul Binder Items
            soul_crystal: { 
                name: "Soul Crystal", 
                type: "weapon", 
                slot: "mainhand", 
                damage: { min: 5, max: 8 },
                magic: 5,
                intelligence: 3,
                value: 20,
                rarity: "uncommon"
            },
            tattered_robe: { 
                name: "Tattered Robe", 
                type: "armor", 
                slot: "chest", 
                defense: 3, 
                magic: 3,
                value: 15,
                rarity: "common"
            },
            soul_shard: { 
                name: "Soul Shard", 
                type: "consumable", 
                effect: "restore_souls", 
                power: 20, 
                value: 10,
                rarity: "common"
            },
            
            // Bone Weaver Items
            bone_staff: { 
                name: "Bone Staff", 
                type: "weapon", 
                slot: "mainhand", 
                damage: { min: 8, max: 12 },
                strength: 2,
                magic: 3,
                value: 25,
                rarity: "uncommon"
            },
            bone_armor: { 
                name: "Bone Armor", 
                type: "armor", 
                slot: "chest", 
                defense: 8,
                value: 30,
                rarity: "uncommon"
            },
            skeleton_hand: { 
                name: "Skeleton Hand", 
                type: "consumable", 
                effect: "create_remains", 
                power: 1, 
                value: 5,
                rarity: "common"
            },
            
            // Plague Master Items
            plague_dagger: { 
                name: "Plague Dagger", 
                type: "weapon", 
                slot: "mainhand", 
                damage: { min: 6, max: 10 },
                agility: 3,
                effect: { type: "poison", damage: 2, duration: 2, chance: 0.3 },
                value: 22,
                rarity: "uncommon"
            },
            rotten_robe: { 
                name: "Rotten Robe", 
                type: "armor", 
                slot: "chest", 
                defense: 4, 
                magic: 2,
                value: 18,
                rarity: "common"
            },
            vial_of_poison: { 
                name: "Vial of Poison", 
                type: "consumable", 
                effect: "apply_poison", 
                power: 5, 
                duration: 3,
                value: 12,
                rarity: "common"
            },
            
            // General Items
            health_potion: { 
                name: "Health Potion", 
                type: "consumable", 
                effect: "heal", 
                power: 30, 
                value: 10,
                rarity: "common"
            },
            mana_potion: { 
                name: "Mana Potion", 
                type: "consumable", 
                effect: "restore_mana", 
                power: 25, 
                value: 10,
                rarity: "common"
            },
            ancient_skull: {
                name: "Ancient Skull",
                type: "artifact",
                effect: "soul_boost",
                power: 10,
                value: 50,
                rarity: "rare"
            }
        };

        // Enemies
        const enemies = {
            level1: [
                { 
                    name: "Spectral Apparition", 
                    hp: 40, 
                    attack: 10, 
                    defense: 3, 
                    exp: 25, 
                    souls: 8,
                    loot: [
                        { id: 'soul_shard', chance: 0.6 }
                    ]
                },
                { 
                    name: "Grave Robber", 
                    hp: 50, 
                    attack: 12, 
                    defense: 5, 
                    exp: 30, 
                    souls: 5,
                    loot: [
                        { id: 'health_potion', chance: 0.7 }
                    ]
                },
                { 
                    name: "Cursed Guardian", 
                    hp: 45, 
                    attack: 14, 
                    defense: 6, 
                    exp: 35, 
                    souls: 10,
                    loot: [
                        { id: 'skeleton_hand', chance: 0.5 }
                    ]
                }
            ],
            level2: [
                { 
                    name: "Wraith", 
                    hp: 70, 
                    attack: 16, 
                    defense: 4, 
                    exp: 45, 
                    souls: 15,
                    loot: [
                        { id: 'soul_shard', chance: 0.8 },
                        { id: 'vial_of_poison', chance: 0.4 }
                    ]
                },
                { 
                    name: "Necrotic Abomination", 
                    hp: 90, 
                    attack: 18, 
                    defense: 8, 
                    exp: 60, 
                    souls: 12,
                    loot: [
                        { id: 'bone_armor', chance: 0.3 }
                    ]
                }
            ],
            bosses: [
                {
                    name: "Lich King",
                    hp: 150,
                    attack: 25,
                    defense: 12,
                    exp: 150,
                    souls: 50,
                    isBoss: true,
                    loot: [
                        { id: 'ancient_skull', chance: 1.0 }
                    ]
                }
            ]
        };

        // DOM Elements
        const screens = {
            start: document.getElementById('start-screen'),
            class: document.getElementById('class-screen'),
            game: document.getElementById('game-screen'),
            battle: document.getElementById('battle-screen'),
            spellSelect: document.getElementById('spell-select-screen'),
            minionCommand: document.getElementById('minion-command-screen'),
            raise: document.getElementById('raise-screen'),
            inventory: document.getElementById('inventory-screen'),
            rituals: document.getElementById('rituals-screen'),
            loot: document.getElementById('loot-screen')
        };

        // Initialize game
        function initGame() {
            // Set up event listeners
            document.getElementById('start-button').addEventListener('click', () => {
                showClassSelection();
            });
            
            document.getElementById('load-button').addEventListener('click', () => {
                // For simplicity, we'll just start a new game
                showClassSelection();
            });
            
            const classOptions = document.querySelectorAll('.class-option');
            classOptions.forEach(option => {
                option.addEventListener('click', () => {
                    selectClass(option.dataset.class);
                });
            });
            
            document.getElementById('explore-button').addEventListener('click', () => {
                startBattle();
            });
            
            document.getElementById('inventory-button').addEventListener('click', () => {
                showInventory();
            });
            
            document.getElementById('spells-button').addEventListener('click', () => {
                showSpellSelection();
            });
            
            document.getElementById('raise-button').addEventListener('click', () => {
                showRaiseScreen();
            });
            
            document.getElementById('rituals-button').addEventListener('click', () => {
                showRitualsScreen();
            });
            
            document.getElementById('save-button').addEventListener('click', () => {
                saveGame();
                addToGameLog("Your progress has been preserved in the soul ledger.");
            });
            
            // Battle buttons
            document.getElementById('attack-button').addEventListener('click', playerAttack);
            document.getElementById('spell-button').addEventListener('click', () => {
                showSpellSelection();
            });
            document.getElementById('minion-button').addEventListener('click', () => {
                showMinionCommand();
            });
            document.getElementById('soul-button').addEventListener('click', harvestSoul);
            
            // Back buttons
            document.getElementById('back-from-spell-select').addEventListener('click', () => {
                showBattleScreen();
            });
            
            document.getElementById('back-from-minion-command').addEventListener('click', () => {
                showBattleScreen();
            });
            
            document.getElementById('back-from-raise').addEventListener('click', () => {
                showGameScreen();
            });
            
            document.getElementById('back-from-inventory').addEventListener('click', () => {
                showGameScreen();
            });
            
            document.getElementById('back-from-rituals').addEventListener('click', () => {
                showGameScreen();
            });
            
            document.getElementById('take-loot').addEventListener('click', () => {
                takeLoot();
            });
            
            // Initialize game log
            addToGameLog("You stand amidst ancient tombs, the air thick with spiritual energy...");
        }

        // Screen management
        function showScreen(screenName) {
            // Hide all screens
            Object.values(screens).forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Show the requested screen
            screens[screenName].classList.add('active');
            gameState.currentScreen = screenName;
        }

        function showClassSelection() {
            showScreen('class');
        }

        function selectClass(className) {
            gameState.player.class = className;
            const classData = classes[className];
            
            // Set player stats based on class
            gameState.player.maxHp = classData.hp;
            gameState.player.hp = classData.hp;
            gameState.player.maxMp = classData.mp;
            gameState.player.mp = classData.mp;
            gameState.player.maxSouls = classData.maxSouls;
            gameState.player.souls = classData.souls;
            gameState.player.strength = classData.strength;
            gameState.player.defense = classData.defense;
            gameState.player.magic = classData.magic;
            gameState.player.intelligence = classData.intelligence;
            
            // Add starting items
            classData.startingItems.forEach(itemId => {
                gameState.player.inventory.push(itemId);
            });
            
            // Add starting spells
            classData.startingSpells.forEach(spellId => {
                gameState.player.spells.push(spellId);
            });
            
            // Equip starting items
            if (className === 'soulbinder') {
                equipItem('soul_crystal', 'mainhand');
                equipItem('tattered_robe', 'chest');
            } else if (className === 'boneweaver') {
                equipItem('bone_staff', 'mainhand');
                equipItem('bone_armor', 'chest');
            } else if (className === 'plaguemaster') {
                equipItem('plague_dagger', 'mainhand');
                equipItem('rotten_robe', 'chest');
            }
            
            // Update UI
            updatePlayerStats();
            showGameScreen();
            
            addToGameLog(`You have embraced the path of the ${classData.name}.`);
            addToGameLog("The dead whisper secrets to you as you explore the necropolis...");
        }

        function showGameScreen() {
            showScreen('game');
            updatePlayerStats();
            updateMinionDisplay();
        }

        function showBattleScreen() {
            showScreen('battle');
            updateBattleStats();
            updateBattleMinionDisplay();
        }

        function showSpellSelection() {
            showScreen('spellSelect');
            updateSpellSelectionDisplay();
        }

        function showMinionCommand() {
            showScreen('minionCommand');
            updateMinionCommandDisplay();
        }

        function showRaiseScreen() {
            showScreen('raise');
            updateRaiseDisplay();
        }

        function showInventory() {
            showScreen('inventory');
            updateInventoryDisplay();
        }

        function showRitualsScreen() {
            showScreen('rituals');
            updateRitualsDisplay();
        }

        // Battle system
        function startBattle() {
            // Determine enemy based on player level
            let enemyPool;
            if (gameState.player.level <= 2) {
                enemyPool = enemies.level1;
            } else if (gameState.player.level <= 4) {
                enemyPool = enemies.level2;
            } else {
                // Chance for boss encounter at higher levels
                if (Math.random() < 0.2) {
                    enemyPool = enemies.bosses;
                } else {
                    enemyPool = enemies.level2;
                }
            }
            
            // Select random enemy
            const randomIndex = Math.floor(Math.random() * enemyPool.length);
            gameState.currentEnemy = { ...enemyPool[randomIndex] };
            gameState.enemyMaxHp = gameState.currentEnemy.hp;
            
            // Reset battle log
            gameState.battleLog = [];
            addToBattleLog(`A ${gameState.currentEnemy.name} appears from the shadows!`);
            
            // Update battle UI
            updateBattleStats();
            
            // Display enemy
            const enemyDisplay = document.getElementById('enemy-display');
            enemyDisplay.textContent = `[${gameState.currentEnemy.name.toUpperCase()}]`;
            
            showScreen('battle');
        }

        function playerAttack() {
            if (!gameState.currentEnemy) return;
            
            // Calculate player damage
            const playerMagic = gameState.player.magic;
            const weapon = gameState.player.equipment.mainhand ? items[gameState.player.equipment.mainhand] : null;
            const baseDamage = weapon ? 
                Math.floor(Math.random() * (weapon.damage.max - weapon.damage.min + 1)) + weapon.damage.min :
                5;
                
            const magicBonus = Math.floor(playerMagic / 4);
            let damage = baseDamage + magicBonus;
            
            // Apply enemy defense
            const enemyDefense = gameState.currentEnemy.defense;
            damage = Math.max(1, damage - Math.floor(enemyDefense / 2));
            
            // Apply damage
            gameState.currentEnemy.hp -= damage;
            
            // Display attack result
            addToBattleLog(`You strike the ${gameState.currentEnemy.name} with dark energy for ${damage} damage!`);
            
            // Show floating damage number
            showFloatingText(damage, document.getElementById('enemy-display'), 'damage-text');
            
            updateEnemyHP();
            
            if (gameState.currentEnemy.hp <= 0) {
                enemyDefeated();
                return;
            }
            
            // Enemy attacks back
            enemyAttack();
        }

        function enemyAttack() {
            if (!gameState.currentEnemy) return;
            
            // Calculate enemy damage
            const enemyAttack = gameState.currentEnemy.attack;
            const baseDamage = Math.floor(Math.random() * 5) + enemyAttack - 2;
            
            // Apply player defense
            const playerDefense = gameState.player.defense;
            let damage = Math.max(1, baseDamage - Math.floor(playerDefense / 2));
            
            // Minions can absorb damage
            if (gameState.player.minions.length > 0) {
                const minion = gameState.player.minions[0];
                if (minion.hp > damage) {
                    minion.hp -= damage;
                    addToBattleLog(`Your ${minion.name} takes the blow for you!`);
                    updateBattleMinionDisplay();
                    return;
                } else {
                    damage -= minion.hp;
                    addToBattleLog(`Your ${minion.name} is destroyed!`);
                    gameState.player.minions.shift();
                    updateBattleMinionDisplay();
                }
            }
            
            // Apply damage to player
            gameState.player.hp -= damage;
            
            // Display attack result
            addToBattleLog(`The ${gameState.currentEnemy.name} attacks you for ${damage} damage!`);
            
            updatePlayerHP();
            
            if (gameState.player.hp <= 0) {
                playerDefeated();
            }
        }

        function castSpell(spellId) {
            const spell = spells[spellId];
            
            // Check if player has enough MP
            if (gameState.player.mp < spell.cost) {
                addToBattleLog(`Not enough mana to cast ${spell.name}!`);
                showBattleScreen();
                return;
            }
            
            // Deduct MP cost
            gameState.player.mp -= spell.cost;
            updatePlayerMP();
            
            if (spell.type === 'attack') {
                const minDamage = spell.damage.min + Math.floor(gameState.player.magic / 3);
                const maxDamage = spell.damage.max + Math.floor(gameState.player.magic / 2);
                let damage = Math.floor(Math.random() * (maxDamage - minDamage + 1)) + minDamage;
                
                gameState.currentEnemy.hp -= damage;
                
                addToBattleLog(`You cast ${spell.name} for ${damage} damage!`);
                
                // Show floating damage number
                showFloatingText(damage, document.getElementById('enemy-display'), 'damage-text');
                
                updateEnemyHP();
                
                if (gameState.currentEnemy.hp <= 0) {
                    enemyDefeated();
                    return;
                }
            } else if (spell.type === 'defense') {
                // For simplicity, we'll just heal the player
                const healAmount = spell.power;
                gameState.player.hp = Math.min(gameState.player.maxHp, gameState.player.hp + healAmount);
                addToBattleLog(`You cast ${spell.name} and restore ${healAmount} HP!`);
                
                // Show floating heal number
                showFloatingText(healAmount, document.getElementById('battle-player-hp').parentElement, 'heal-text');
                
                updatePlayerHP();
            } else if (spell.type === 'minion') {
                // Check if we have enough souls and remains
                if (gameState.player.souls < spell.souls) {
                    addToBattleLog(`Not enough souls to summon!`);
                    showBattleScreen();
                    return;
                }
                
                if (gameState.player.remains < minions[spell.minion].remains) {
                    addToBattleLog(`Not enough remains to summon a ${minions[spell.minion].name}!`);
                    showBattleScreen();
                    return;
                }
                
                // Summon the minion
                gameState.player.souls -= spell.souls;
                gameState.player.remains -= minions[spell.minion].remains;
                
                const newMinion = {
                    ...minions[spell.minion],
                    id: Date.now(), // Simple unique ID
                    maxHp: minions[spell.minion].hp
                };
                
                gameState.player.minions.push(newMinion);
                addToBattleLog(`You summon a ${newMinion.name}!`);
                
                updatePlayerSouls();
                updateBattleMinionDisplay();
            }
            
            // Enemy attacks back
            enemyAttack();
            
            showBattleScreen();
        }

        function commandMinion(minionIndex, command) {
            const minion = gameState.player.minions[minionIndex];
            
            if (command === 'attack') {
                const damage = minion.attack;
                gameState.currentEnemy.hp -= damage;
                
                addToBattleLog(`Your ${minion.name} attacks for ${damage} damage!`);
                
                // Show floating damage number
                showFloatingText(damage, document.getElementById('enemy-display'), 'damage-text');
                
                updateEnemyHP();
                
                if (gameState.currentEnemy.hp <= 0) {
                    enemyDefeated();
                    return;
                }
            }
            
            // Enemy attacks back
            enemyAttack();
            
            showBattleScreen();
        }

        function harvestSoul() {
            if (!gameState.currentEnemy) return;
            
            const soulsGained = 5 + Math.floor(gameState.player.intelligence / 5);
            gameState.player.souls = Math.min(gameState.player.maxSouls, gameState.player.souls + soulsGained);
            
            addToBattleLog(`You harvest ${soulsGained} souls from the ${gameState.currentEnemy.name}!`);
            
            // Show floating soul number
            showFloatingText(soulsGained, document.getElementById('battle-player-souls').parentElement, 'soul-text');
            
            updatePlayerSouls();
            
            // Enemy attacks back
            enemyAttack();
        }

        function enemyDefeated() {
            addToBattleLog(`You defeated the ${gameState.currentEnemy.name}!`);
            
            // Calculate experience gained
            const expGained = gameState.currentEnemy.exp;
            gameState.player.exp += expGained;
            
            // Gain souls
            const soulsGained = gameState.currentEnemy.souls;
            gameState.player.souls = Math.min(gameState.player.maxSouls, gameState.player.souls + soulsGained);
            
            // Check for level up
            if (gameState.player.exp >= gameState.player.expNeeded) {
                levelUp();
            }
            
            // Collect loot
            const loot = [];
            gameState.currentEnemy.loot.forEach(lootItem => {
                if (Math.random() < lootItem.chance) {
                    loot.push(lootItem.id);
                }
            });
            
            // Add loot to inventory
            loot.forEach(itemId => {
                gameState.player.inventory.push(itemId);
            });
            
            // Display loot screen
            document.getElementById('exp-gained').textContent = expGained;
            document.getElementById('souls-gained').textContent = soulsGained;
            
            const lootItemsElement = document.getElementById('loot-items');
            lootItemsElement.innerHTML = '';
            
            loot.forEach(itemId => {
                const itemElement = document.createElement('div');
                itemElement.className = `log-entry loot-item rarity-${items[itemId].rarity}`;
                itemElement.textContent = items[itemId].name;
                lootItemsElement.appendChild(itemElement);
            });
            
            showScreen('loot');
        }

        function playerDefeated() {
            addToBattleLog("You have been defeated...");
            addToBattleLog("Dark energy revives you at the cost of some souls.");
            
            // Reset player HP to 50%
            gameState.player.hp = Math.floor(gameState.player.maxHp / 2);
            gameState.player.mp = Math.floor(gameState.player.maxMp / 2);
            
            // Lose some souls
            const soulsLost = Math.floor(gameState.player.souls * 0.3);
            gameState.player.souls -= soulsLost;
            
            // Lose all minions
            gameState.player.minions = [];
            
            setTimeout(() => {
                addToGameLog(`You were defeated and lost ${soulsLost} souls.`);
                showGameScreen();
                updatePlayerStats();
            }, 2000);
        }

        function takeLoot() {
            showGameScreen();
            updatePlayerStats();
            addToGameLog("You continue exploring the necropolis...");
        }

        // Level system
        function levelUp() {
            gameState.player.level++;
            gameState.player.exp -= gameState.player.expNeeded;
            gameState.player.expNeeded = Math.floor(gameState.player.expNeeded * 1.5);
            
            // Increase stats based on class
            const classData = classes[gameState.player.class];
            
            gameState.player.maxHp += 15;
            gameState.player.hp = gameState.player.maxHp;
            gameState.player.maxMp += 10;
            gameState.player.mp = gameState.player.maxMp;
            gameState.player.maxSouls += 20;
            gameState.player.magic += 2;
            gameState.player.intelligence += 2;
            
            // Grant skill point every 3 levels
            if (gameState.player.level % 3 === 0) {
                gameState.player.skillPoints++;
                addToGameLog("You gained a skill point!");
            }
            
            addToGameLog(`You reached level ${gameState.player.level}!`);
            addToGameLog("Your necromantic powers have grown!");
            
            updatePlayerStats();
        }

        // Minion system
        function raiseMinion(minionType) {
            const minion = minions[minionType];
            
            if (gameState.player.souls < minion.cost) {
                addToGameLog(`Not enough souls to raise a ${minion.name}!`);
                return;
            }
            
            if (gameState.player.remains < minion.remains) {
                addToGameLog(`Not enough remains to raise a ${minion.name}!`);
                return;
            }
            
            if (gameState.player.minions.length >= 2) {
                addToGameLog("You can only control 2 minions at once!");
                return;
            }
            
            // Raise the minion
            gameState.player.souls -= minion.cost;
            gameState.player.remains -= minion.remains;
            
            const newMinion = {
                ...minion,
                id: Date.now(), // Simple unique ID
                maxHp: minion.hp
            };
            
            gameState.player.minions.push(newMinion);
            addToGameLog(`You raise a ${newMinion.name} from the remains!`);
            
            updatePlayerStats();
            updateMinionDisplay();
            showGameScreen();
        }

        // Rituals
        function performRitual(ritualId) {
            // For simplicity, we'll implement one ritual
            if (ritualId === 'soul_infusion' && gameState.player.souls >= 50) {
                gameState.player.souls -= 50;
                gameState.player.maxHp += 20;
                gameState.player.hp = gameState.player.maxHp;
                addToGameLog("You perform the Soul Infusion ritual, permanently increasing your vitality!");
                updatePlayerStats();
                showGameScreen();
            } else {
                addToGameLog("You don't have enough souls for this ritual!");
            }
        }

        // Inventory system
        function updateInventoryDisplay() {
            const inventoryElement = document.getElementById('inventory-items');
            inventoryElement.innerHTML = '';
            
            // Group items by type for display
            const itemCounts = {};
            gameState.player.inventory.forEach(itemId => {
                itemCounts[itemId] = (itemCounts[itemId] || 0) + 1;
            });
            
            Object.keys(itemCounts).forEach(itemId => {
                const itemElement = document.createElement('div');
                itemElement.className = `item rarity-${items[itemId].rarity}`;
                
                const itemName = document.createElement('div');
                itemName.textContent = `${items[itemId].name} (x${itemCounts[itemId]})`;
                
                const itemStats = document.createElement('div');
                itemStats.className = 'item-stats';
                itemStats.innerHTML = getItemStatsDisplay(itemId);
                
                itemElement.appendChild(itemName);
                itemElement.appendChild(itemStats);
                
                // Add click event to equip/use item
                itemElement.addEventListener('click', () => {
                    if (items[itemId].type === 'consumable') {
                        useItem(itemId);
                    } else {
                        equipItem(itemId, items[itemId].slot);
                    }
                });
                
                inventoryElement.appendChild(itemElement);
            });
        }

        function equipItem(itemId, slot) {
            // If slot is already occupied, unequip current item
            if (gameState.player.equipment[slot]) {
                gameState.player.inventory.push(gameState.player.equipment[slot]);
            }
            
            // Remove item from inventory
            const itemIndex = gameState.player.inventory.indexOf(itemId);
            if (itemIndex !== -1) {
                gameState.player.inventory.splice(itemIndex, 1);
            }
            
            // Equip new item
            gameState.player.equipment[slot] = itemId;
            
            // Update stats
            updatePlayerStats();
            updateInventoryDisplay();
            
            addToGameLog(`You equip ${items[itemId].name}.`);
        }

        function useItem(itemId) {
            const item = items[itemId];
            
            if (item.type === 'consumable') {
                if (item.effect === 'heal') {
                    gameState.player.hp = Math.min(gameState.player.maxHp, gameState.player.hp + item.power);
                    addToGameLog(`You use ${item.name} and restore ${item.power} HP.`);
                } else if (item.effect === 'restore_mana') {
                    gameState.player.mp = Math.min(gameState.player.maxMp, gameState.player.mp + item.power);
                    addToGameLog(`You use ${item.name} and restore ${item.power} MP.`);
                } else if (item.effect === 'restore_souls') {
                    gameState.player.souls = Math.min(gameState.player.maxSouls, gameState.player.souls + item.power);
                    addToGameLog(`You use ${item.name} and restore ${item.power} souls.`);
                } else if (item.effect === 'create_remains') {
                    gameState.player.remains += item.power;
                    addToGameLog(`You use ${item.name} and gain ${item.power} remains.`);
                }
                
                // Remove item from inventory
                const itemIndex = gameState.player.inventory.indexOf(itemId);
                if (itemIndex !== -1) {
                    gameState.player.inventory.splice(itemIndex, 1);
                }
                
                updatePlayerStats();
                updateInventoryDisplay();
            }
        }

        function getItemStatsDisplay(itemId) {
            const item = items[itemId];
            let statsHTML = '';
            
            if (item.type === 'weapon') {
                statsHTML = `DMG: ${item.damage.min}-${item.damage.max}`;
                if (item.magic) statsHTML += ` | MAG: ${item.magic}`;
                if (item.strength) statsHTML += ` | STR: ${item.strength}`;
            } else if (item.type === 'armor') {
                statsHTML = `DEF: ${item.defense}`;
                if (item.magic) statsHTML += ` | MAG: ${item.magic}`;
            } else if (item.type === 'consumable') {
                if (item.effect === 'heal') {
                    statsHTML = `Heals: ${item.power} HP`;
                } else if (item.effect === 'restore_mana') {
                    statsHTML = `Restores: ${item.power} MP`;
                } else if (item.effect === 'restore_souls') {
                    statsHTML = `Restores: ${item.power} Souls`;
                } else if (item.effect === 'create_remains') {
                    statsHTML = `Creates: ${item.power} Remains`;
                }
            }
            
            return statsHTML;
        }

        // Display updates
        function updateSpellSelectionDisplay() {
            document.getElementById('spell-select-mp').textContent = gameState.player.mp;
            document.getElementById('spell-select-max-mp').textContent = gameState.player.maxMp;
            document.getElementById('spell-select-souls').textContent = gameState.player.souls;
            
            const spellSelectElement = document.getElementById('spell-select-list');
            spellSelectElement.innerHTML = '';
            
            gameState.player.spells.forEach(spellId => {
                const spell = spells[spellId];
                const spellElement = document.createElement('div');
                spellElement.className = 'spell-item';
                
                // Disable if not enough MP
                if (gameState.player.mp < spell.cost) {
                    spellElement.classList.add('disabled');
                }
                
                // Disable if not enough souls for minion spells
                if (spell.type === 'minion' && gameState.player.souls < spell.souls) {
                    spellElement.classList.add('disabled');
                }
                
                const spellInfo = document.createElement('div');
                spellInfo.className = 'spell-info';
                spellInfo.innerHTML = `
                    <strong>${spell.name}</strong><br>
                    <small>${spell.description}</small>
                `;
                
                const spellCost = document.createElement('div');
                spellCost.className = 'spell-cost';
                if (spell.type === 'minion') {
                    spellCost.textContent = `${spell.cost} MP, ${spell.souls} Souls`;
                } else {
                    spellCost.textContent = `${spell.cost} MP`;
                }
                
                spellElement.appendChild(spellInfo);
                spellElement.appendChild(spellCost);
                
                // Add click event to cast spell
                if (gameState.player.mp >= spell.cost) {
                    if (spell.type !== 'minion' || gameState.player.souls >= spell.souls) {
                        spellElement.addEventListener('click', () => {
                            castSpell(spellId);
                        });
                    }
                }
                
                spellSelectElement.appendChild(spellElement);
            });
        }

        function updateMinionCommandDisplay() {
            const minionCommandElement = document.getElementById('minion-command-list');
            minionCommandElement.innerHTML = '';
            
            if (gameState.player.minions.length === 0) {
                minionCommandElement.innerHTML = '<div>You have no minions to command.</div>';
                return;
            }
            
            gameState.player.minions.forEach((minion, index) => {
                const minionElement = document.createElement('div');
                minionElement.className = 'spell-item';
                
                const minionInfo = document.createElement('div');
                minionInfo.className = 'spell-info';
                minionInfo.innerHTML = `
                    <strong>${minion.name}</strong><br>
                    <small>HP: ${minion.hp}/${minion.maxHp} | ATK: ${minion.attack}</small>
                `;
                
                const attackButton = document.createElement('div');
                attackButton.className = 'button';
                attackButton.textContent = 'ATTACK';
                attackButton.addEventListener('click', () => {
                    commandMinion(index, 'attack');
                });
                
                minionElement.appendChild(minionInfo);
                minionElement.appendChild(attackButton);
                
                minionCommandElement.appendChild(minionElement);
            });
        }

        function updateRaiseDisplay() {
            document.getElementById('raise-souls').textContent = gameState.player.souls;
            document.getElementById('player-remains').textContent = gameState.player.remains;
            
            const raiseOptionsElement = document.getElementById('raise-options');
            raiseOptionsElement.innerHTML = '';
            
            Object.keys(minions).forEach(minionType => {
                const minion = minions[minionType];
                const minionElement = document.createElement('div');
                minionElement.className = 'spell-item';
                
                // Check if player meets requirements
                const canRaise = gameState.player.souls >= minion.cost && 
                                gameState.player.remains >= minion.remains &&
                                gameState.player.minions.length < 2;
                
                if (!canRaise) {
                    minionElement.classList.add('disabled');
                }
                
                const minionInfo = document.createElement('div');
                minionInfo.className = 'spell-info';
                minionInfo.innerHTML = `
                    <strong>${minion.name}</strong><br>
                    <small>${minion.description}</small><br>
                    <small>HP: ${minion.hp} | ATK: ${minion.attack} | DEF: ${minion.defense}</small>
                `;
                
                const minionCost = document.createElement('div');
                minionCost.className = 'spell-cost';
                minionCost.textContent = `${minion.cost} Souls, ${minion.remains} Remains`;
                
                const raiseButton = document.createElement('div');
                raiseButton.className = 'button';
                raiseButton.textContent = 'RAISE';
                if (canRaise) {
                    raiseButton.addEventListener('click', () => {
                        raiseMinion(minionType);
                    });
                }
                
                minionElement.appendChild(minionInfo);
                minionElement.appendChild(minionCost);
                minionElement.appendChild(raiseButton);
                
                raiseOptionsElement.appendChild(minionElement);
            });
        }

        function updateRitualsDisplay() {
            const ritualsElement = document.getElementById('rituals-list');
            ritualsElement.innerHTML = '';
            
            // Soul Infusion ritual
            const ritualElement = document.createElement('div');
            ritualElement.className = 'spell-item';
            
            const ritualInfo = document.createElement('div');
            ritualInfo.className = 'spell-info';
            ritualInfo.innerHTML = `
                <strong>Soul Infusion</strong><br>
                <small>Permanently infuse your body with soul energy, increasing your maximum health.</small>
            `;
            
            const ritualCost = document.createElement('div');
            ritualCost.className = 'spell-cost';
            ritualCost.textContent = '50 Souls';
            
            const performButton = document.createElement('div');
            performButton.className = 'button';
            performButton.textContent = 'PERFORM';
            if (gameState.player.souls >= 50) {
                performButton.addEventListener('click', () => {
                    performRitual('soul_infusion');
                });
            } else {
                performButton.classList.add('disabled');
            }
            
            ritualElement.appendChild(ritualInfo);
            ritualElement.appendChild(ritualCost);
            ritualElement.appendChild(performButton);
            
            ritualsElement.appendChild(ritualElement);
        }

        function updateMinionDisplay() {
            const minionDisplay = document.getElementById('minion-display');
            minionDisplay.innerHTML = '';
            
            if (gameState.player.minions.length === 0) {
                minionDisplay.innerHTML = '<div class="minion-slot">Empty</div><div class="minion-slot">Empty</div>';
                return;
            }
            
            gameState.player.minions.forEach(minion => {
                const minionElement = document.createElement('div');
                minionElement.className = 'minion-slot';
                minionElement.innerHTML = `
                    ${minion.name}<br>
                    <span class="minion-health">HP: ${minion.hp}/${minion.maxHp}</span>
                `;
                minionDisplay.appendChild(minionElement);
            });
            
            // Fill empty slots
            for (let i = gameState.player.minions.length; i < 2; i++) {
                const emptySlot = document.createElement('div');
                emptySlot.className = 'minion-slot';
                emptySlot.textContent = 'Empty';
                minionDisplay.appendChild(emptySlot);
            }
        }

        function updateBattleMinionDisplay() {
            const minionDisplay = document.getElementById('battle-minion-display');
            minionDisplay.innerHTML = '';
            
            if (gameState.player.minions.length === 0) {
                minionDisplay.innerHTML = '<div class="minion-slot">No Minions</div>';
                return;
            }
            
            gameState.player.minions.forEach(minion => {
                const minionElement = document.createElement('div');
                minionElement.className = 'minion-slot';
                minionElement.innerHTML = `
                    ${minion.name}<br>
                    <span class="minion-health">HP: ${minion.hp}/${minion.maxHp}</span>
                `;
                minionDisplay.appendChild(minionElement);
            });
        }

        // UI updates
        function updatePlayerStats() {
            document.getElementById('player-level').textContent = gameState.player.level;
            document.getElementById('player-hp').textContent = gameState.player.hp;
            document.getElementById('player-max-hp').textContent = gameState.player.maxHp;
            document.getElementById('player-mp').textContent = gameState.player.mp;
            document.getElementById('player-max-mp').textContent = gameState.player.maxMp;
            document.getElementById('player-souls').textContent = gameState.player.souls;
            document.getElementById('player-exp').textContent = gameState.player.exp;
            document.getElementById('player-exp-needed').textContent = gameState.player.expNeeded;
            
            // Update exp bar
            const expPercent = (gameState.player.exp / gameState.player.expNeeded) * 100;
            document.getElementById('exp-bar').style.width = `${expPercent}%`;
            
            // Update souls bar
            const soulsPercent = (gameState.player.souls / gameState.player.maxSouls) * 100;
            document.getElementById('souls-bar').style.width = `${soulsPercent}%`;
        }

        function updateBattleStats() {
            document.getElementById('enemy-name').textContent = gameState.currentEnemy.name;
            document.getElementById('enemy-hp').textContent = gameState.currentEnemy.hp;
            document.getElementById('enemy-max-hp').textContent = gameState.enemyMaxHp;
            document.getElementById('battle-player-hp').textContent = gameState.player.hp;
            document.getElementById('battle-player-max-hp').textContent = gameState.player.maxHp;
            document.getElementById('battle-player-mp').textContent = gameState.player.mp;
            document.getElementById('battle-player-max-mp').textContent = gameState.player.maxMp;
            document.getElementById('battle-player-souls').textContent = gameState.player.souls;
        }

        function updatePlayerHP() {
            document.getElementById('player-hp').textContent = gameState.player.hp;
            document.getElementById('battle-player-hp').textContent = gameState.player.hp;
        }

        function updatePlayerMP() {
            document.getElementById('player-mp').textContent = gameState.player.mp;
            document.getElementById('battle-player-mp').textContent = gameState.player.mp;
            document.getElementById('spell-select-mp').textContent = gameState.player.mp;
        }

        function updatePlayerSouls() {
            document.getElementById('player-souls').textContent = gameState.player.souls;
            document.getElementById('battle-player-souls').textContent = gameState.player.souls;
            document.getElementById('spell-select-souls').textContent = gameState.player.souls;
            document.getElementById('raise-souls').textContent = gameState.player.souls;
            
            // Update souls bar
            const soulsPercent = (gameState.player.souls / gameState.player.maxSouls) * 100;
            document.getElementById('souls-bar').style.width = `${soulsPercent}%`;
        }

        function updateEnemyHP() {
            document.getElementById('enemy-hp').textContent = Math.max(0, gameState.currentEnemy.hp);
        }

        function addToBattleLog(message) {
            const logElement = document.getElementById('battle-log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = message;
            logElement.appendChild(entry);
            logElement.scrollTop = logElement.scrollHeight;
        }

        function addToGameLog(message) {
            const logElement = document.getElementById('game-log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = message;
            logElement.appendChild(entry);
            logElement.scrollTop = logElement.scrollHeight;
        }

        function showFloatingText(value, parentElement, className) {
            const floatingText = document.createElement('div');
            floatingText.className = `floating-text ${className}`;
            floatingText.textContent = value;
            floatingText.style.left = `${Math.random() * 50 + 25}%`;
            floatingText.style.top = '50%';
            
            parentElement.appendChild(floatingText);
            
            // Remove after animation
            setTimeout(() => {
                floatingText.remove();
            }, 1000);
        }

        // Save system (simplified)
        function saveGame() {
            localStorage.setItem('necromancerSave', JSON.stringify(gameState));
        }

        function loadGame() {
            const saveData = localStorage.getItem('necromancerSave');
            if (saveData) {
                const data = JSON.parse(saveData);
                Object.assign(gameState, data);
                updatePlayerStats();
                showGameScreen();
                addToGameLog("Your dark legacy has been restored...");
            }
        }

        // Initialize the game when the page loads
        window.addEventListener('load', initGame);
    </script>
</body>
</html>
