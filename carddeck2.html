<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>D&D Card Collector</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #1a1a1a;
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            color: #e0e0e0;
            height: 100vh;
            overflow: hidden;
            touch-action: manipulation;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        #game-container {
            width: 100%;
            max-width: 500px;
            height: 100%;
            position: relative;
            display: flex;
            flex-direction: column;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }
        
        #header {
            text-align: center;
            padding: 10px;
            background-color: rgba(42, 42, 42, 0.9);
            border-radius: 10px;
            margin-bottom: 10px;
            border: 2px solid #5e3b1f;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }
        
        h1 {
            font-size: 24px;
            color: #d4af37;
            text-shadow: 1px 1px 2px #000;
        }
        
        #stats {
            display: flex;
            justify-content: space-around;
            margin-top: 5px;
            font-size: 16px;
        }
        
     #collection-container {
    flex-grow: 1;
    overflow-y: auto;
    background-color: rgba(42, 42, 42, 0.9);
    border-radius: 10px;
    padding: 10px;
    margin-bottom: 10px;
    border: 2px solid #5e3b1f;
    box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
    position: relative;
    height: calc(100% - 60px);
    min-height: 0; /* This is crucial for proper flexbox behavior */
}
        
        #collection {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .card {
            background: linear-gradient(135deg, #5e3b1f 0%, #8b5a2b 100%);
            border-radius: 8px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 2px solid #d4af37;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s;
            position: relative;
        }
        
        .card.selected {
            border: 2px solid #ff0000;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.7);
        }
        
        .card:active {
            transform: scale(0.95);
        }
        
        .card-image {
            width: 100%;
            height: 100px;
            background-color: #3a3a3a;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 8px;
            overflow: hidden;
            position: relative;
        }
        
        .card-image img {
            max-width: 100%;
            max-height: 100%;
        }
        
        .card-name {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 5px;
            color: #fff;
            text-align: center;
        }
        
        .card-rarity {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-bottom: 5px;
        }
        
        .common {
            background-color: #a0a0a0;
            color: #000;
        }
        
        .uncommon {
            background-color: #2e8b57;
            color: #fff;
        }
        
        .rare {
            background-color: #4169e1;
            color: #fff;
        }
        
        .epic {
            background-color: #9370db;
            color: #fff;
        }
        
        .legendary {
            background-color: #ff8c00;
            color: #fff;
        }
        
        .mythic {
            background: linear-gradient(135deg, #ff0000 0%, #ff8c00 100%);
            color: #fff;
            animation: mythic-glow 2s infinite alternate;
        }
        
        @keyframes mythic-glow {
            0% { box-shadow: 0 0 5px rgba(255, 0, 0, 0.5); }
            100% { box-shadow: 0 0 20px rgba(255, 0, 0, 0.9); }
        }
        
      #actions {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    gap: 10px;
    position: relative; /* Add this */
    z-index: 1; /* Ensure it stays above other content */
}
        
        button {
            background: linear-gradient(135deg, #5e3b1f 0%, #8b5a2b 100%);
            color: #d4af37;
            border: none;
            border-radius: 8px;
            padding: 12px 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s;
            flex: 1;
            border: 1px solid #d4af37;
            text-shadow: 1px 1px 1px #000;
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        button:active:not(:disabled) {
            transform: scale(0.95);
        }
        
        #open-pack {
            background: linear-gradient(135deg, #8b0000 0%, #b22222 100%);
        }
        
        #gold {
            color: #d4af37;
            font-weight: bold;
        }
        
        #cards-count {
            color: #4CAF50;
            font-weight: bold;
        }
        
        #modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        
        #modal-content {
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            border: 3px solid #d4af37;
            text-align: center;
            position: relative;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        #close-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: #d4af37;
            font-size: 20px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
        }
        
        #close-modal:hover {
            background-color: rgba(212, 175, 55, 0.2);
        }
        
        #new-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        
        .new-card {
            animation: glow 1.5s infinite alternate;
        }
        
        @keyframes glow {
            from {
                box-shadow: 0 0 5px rgba(212, 175, 55, 0.5);
            }
            to {
                box-shadow: 0 0 20px rgba(212, 175, 55, 0.8);
            }
        }
        
        #sell-card {
            background: linear-gradient(135deg, #2e8b57 0%, #3cb371 100%);
        }
        
        #upgrade-pack {
            background: linear-gradient(135deg, #4169e1 0%, #1e90ff 100%);
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #2a2a2a;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #5e3b1f;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #8b5a2b;
        }
        
        .progress-container {
            width: 100%;
            background-color: #333;
            border-radius: 5px;
            margin: 10px 0;
            height: 20px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #d4af37, #f1c40f);
            border-radius: 5px;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #000;
            font-weight: bold;
        }
        
        .tab-container {
            display: flex;
            margin-bottom: 10px;
            background-color: rgba(42, 42, 42, 0.7);
            border-radius: 8px;
            padding: 5px;
            overflow-x: auto;
            scrollbar-width: none; /* Firefox */
        }
        
        .tab-container::-webkit-scrollbar {
            display: none; /* Chrome/Safari */
        }
        
        .tab {
            flex: 1;
            padding: 8px;
            text-align: center;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.2s;
            min-width: 100px;
        }
        
        .tab.active {
            background-color: #5e3b1f;
            font-weight: bold;
        }
        
        .achievement {
            display: flex;
            align-items: center;
            background-color: rgba(42, 42, 42, 0.7);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
        }
        
        .achievement-icon {
            font-size: 24px;
            margin-right: 10px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #5e3b1f;
            border-radius: 50%;
        }
        
        .achievement-info {
            flex: 1;
        }
        
        .achievement-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .achievement-description {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 5px;
        }
        
        .achievement-progress {
            font-size: 12px;
            color: #aaa;
        }
        
        .achievement-reward {
            font-size: 12px;
            color: #d4af37;
            font-weight: bold;
        }
        
        .achievement.completed {
            border-left: 5px solid #d4af37;
        }
        
        .achievement.completed .achievement-title {
            color: #d4af37;
        }
        
        .card-count {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: rgba(0, 0, 0, 0.7);
            color: #fff;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        #shop-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .shop-item {
            background-color: rgba(42, 42, 42, 0.7);
            border-radius: 8px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .shop-item h3 {
            margin-bottom: 5px;
            color: #d4af37;
            text-align: center;
        }
        
        .shop-item p {
            font-size: 12px;
            text-align: center;
            margin-bottom: 5px;
        }
        
        .shop-item button {
            margin-top: 10px;
            width: 100%;
            padding: 8px;
            font-size: 14px;
        }
        
        .floating-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(46, 139, 87, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            z-index: 200;
            animation: float-up 2s forwards;
        }
        
        @keyframes float-up {
            0% { opacity: 0; top: 50px; }
            10% { opacity: 1; top: 20px; }
            90% { opacity: 1; top: 20px; }
            100% { opacity: 0; top: 0; }
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.9);
            color: #fff;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 300;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            max-width: 200px;
            text-align: center;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 5px;
        }
        
        .card:hover .tooltip {
            opacity: 1;
        }
        
       .tab-content {
    display: none;
    width: 100%;
    height: 100%;
    overflow-y: auto;
    position: relative;
}

.tab-content.active {
    display: block;
}
        
        #daily-reward-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 200;
            display: none;
            justify-content: center;
            align-items: center;
        }
        
        #daily-reward-content {
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            border: 3px solid #d4af37;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        #daily-reward-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: #d4af37;
            font-size: 20px;
            cursor: pointer;
        }
        
        #daily-reward-button {
            margin-top: 20px;
            padding: 15px 30px;
            font-size: 18px;
            background: linear-gradient(135deg, #d4af37, #f1c40f);
            color: #000;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .daily-reward-calendar {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
    margin: 15px 0;
    width: 100%;
    padding: 0 5px;
}
        
        .calendar-day {
    padding: 8px 5px;
    border-radius: 5px;
    background-color: rgba(94, 59, 31, 0.3);
    text-align: center;
    box-sizing: border-box;
    min-width: 0; /* Prevent overflow */
    word-break: break-word; /* Handle long text */
}

.calendar-day.reward {
    background-color: rgba(212, 175, 55, 0.3);
    border: 1px solid #d4af37;
}

.calendar-day.today {
    background-color: rgba(212, 175, 55, 0.7);
    font-weight: bold;
}

.calendar-day.claimed {
    background-color: rgba(46, 139, 87, 0.7);
}

.daily-reward-amount {
    font-size: 12px;
    color: #d4af37;
    font-weight: bold;
    margin-top: 3px;
}
        
        .daily-reward-amount {
            font-size: 12px;
            color: #d4af37;
            font-weight: bold;
        }
        
        #deck-builder-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        #deck-builder-collections {
            display: flex;
            flex: 1;
            gap: 10px;
        }
        
        #all-cards, #current-deck {
            flex: 1;
            background-color: rgba(42, 42, 42, 0.5);
            border-radius: 8px;
            padding: 10px;
            overflow-y: auto;
        }
        
        #all-cards h3, #current-deck h3 {
            text-align: center;
            margin-bottom: 10px;
            color: #d4af37;
        }
        
        .deck-card {
            background-color: rgba(94, 59, 31, 0.3);
            border-radius: 5px;
            padding: 8px;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .deck-card-name {
            flex: 1;
        }
        
        .deck-card-actions button {
            padding: 3px 6px;
            font-size: 12px;
            margin-left: 5px;
            min-width: auto;
        }
        
        #deck-save {
            margin-top: 10px;
            width: 100%;
        }
        
        #quest-log {
            overflow-y: auto;
            height: 100%;
        }
        
        .quest {
            background-color: rgba(42, 42, 42, 0.7);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
        }
        
        .quest-title {
            font-weight: bold;
            color: #d4af37;
            margin-bottom: 5px;
        }
        
        .quest-description {
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .quest-reward {
            font-size: 12px;
            color: #4CAF50;
        }
        
        .quest.completed {
            border-left: 5px solid #4CAF50;
        }
        
        #combat-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        #combat-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        #player-stats, #enemy-stats {
            background-color: rgba(42, 42, 42, 0.7);
            border-radius: 8px;
            padding: 10px;
            flex: 1;
        }
        
        #player-stats {
            margin-right: 5px;
        }
        
        #enemy-stats {
            margin-left: 5px;
        }
        
        #combat-log {
            flex: 1;
            background-color: rgba(42, 42, 42, 0.5);
            border-radius: 8px;
            padding: 10px;
            overflow-y: auto;
            margin-bottom: 10px;
        }
        
        #combat-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .combat-message {
            margin-bottom: 5px;
        }
        
        .player-message {
            color: #4169e1;
        }
        
        .enemy-message {
            color: #b22222;
        }
        
        .system-message {
            color: #d4af37;
        }
        
        #settings-container {
            overflow-y: auto;
            height: 100%;
        }
        
        .setting-option {
            background-color: rgba(42, 42, 42, 0.7);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
        }
        
        .setting-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .setting-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        #reset-game {
            background: linear-gradient(135deg, #b22222, #8b0000);
            margin-top: 20px;
            width: 100%;
        }
        
        .stat-display {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .stat-name {
            font-weight: bold;
        }
        
        /* New styles for card fusion */
        #fusion-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            padding: 10px;
        }
        
        #fusion-slots {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .fusion-slot {
            width: 80px;
            height: 120px;
            background-color: rgba(94, 59, 31, 0.5);
            border: 2px dashed #d4af37;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
        }
        
        .fusion-slot.filled {
            background-color: rgba(94, 59, 31, 0.8);
            border: 2px solid #d4af37;
        }
        
        #fusion-result {
            width: 100px;
            height: 150px;
            background-color: rgba(42, 42, 42, 0.7);
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 32px;
            margin: 10px 0;
        }
        
        #fusion-button {
            width: 80%;
            padding: 12px;
            font-size: 16px;
        }
        
        /* Weekly rewards */
        .weekly-reward {
            background-color: rgba(42, 42, 42, 0.7);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .weekly-reward-title {
            font-weight: bold;
            color: #d4af37;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .weekly-progress {
            height: 20px;
            background-color: #333;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .weekly-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4169e1, #1e90ff);
            border-radius: 10px;
            transition: width 0.3s;
        }
        
        /* Combat animations */
        @keyframes attack-animation {
            0% { transform: translateX(0); }
            50% { transform: translateX(20px); }
            100% { transform: translateX(0); }
        }
        
        @keyframes damage-animation {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .attack-animation {
            animation: attack-animation 0.3s ease-in-out;
        }
        
        .damage-animation {
            animation: damage-animation 0.3s ease-in-out;
        }
        
        /* Elemental types */
        .fire { color: #ff4500; }
        .water { color: #1e90ff; }
        .earth { color: #8b4513; }
        .air { color: #87ceeb; }
        .holy { color: #ffd700; }
        .dark { color: #8b008b; }
        
        /* Status effects */
        .status-poison { color: #32cd32; }
        .status-stun { color: #a9a9a9; }
        .status-burn { color: #ff4500; }
        .status-freeze { color: #00bfff; }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="header">
            <h1>D&D Card Collector</h1>
            <div id="stats">
                <div>Gold: <span id="gold">100</span></div>
                <div>Cards: <span id="cards-count">0</span></div>
                <div>Level: <span id="player-level">1</span></div>
            </div>
            <div class="progress-container">
                <div class="progress-bar" id="xp-bar" style="width: 0%">0/100</div>
            </div>
        </div>
        
        <div class="tab-container">
            <div class="tab active" data-tab="collection">Collection</div>
            <div class="tab" data-tab="shop">Shop</div>
            <div class="tab" data-tab="deck">Deck</div>
            <div class="tab" data-tab="fusion">Fusion</div>
            <div class="tab" data-tab="quests">Quests</div>
            <div class="tab" data-tab="combat">Combat</div>
            <div class="tab" data-tab="achievements">Achievements</div>
            <div class="tab" data-tab="daily">Daily</div>
            <div class="tab" data-tab="settings">Settings</div>
        </div>
        
        <div id="collection-container">
            <div id="collection-tab" class="tab-content active">
                <div id="collection"></div>
            </div>
            
            <div id="shop-tab" class="tab-content">
                <div id="shop-items">
                    <div class="shop-item">
                        <h3>Starter Pack</h3>
                        <p>5 random cards (guaranteed rare)</p>
                        <p>Price: 50 gold</p>
                        <button id="buy-starter-pack">Buy</button>
                    </div>
                    <div class="shop-item">
                        <h3>Adventurer Pack</h3>
                        <p>5 random cards (guaranteed epic)</p>
                        <p>Price: 150 gold</p>
                        <button id="buy-adventurer-pack">Buy</button>
                    </div>
                    <div class="shop-item">
                        <h3>Dragon Pack</h3>
                        <p>5 random cards (guaranteed legendary)</p>
                        <p>Price: 500 gold</p>
                        <button id="buy-dragon-pack">Buy</button>
                    </div>
                    <div class="shop-item">
                        <h3>Gold Bundle</h3>
                        <p>+200 gold</p>
                        <p>Price: $0.00 (demo)</p>
                        <button id="buy-gold-bundle" disabled>Buy</button>
                    </div>
                </div>
            </div>
            
            <div id="deck-tab" class="tab-content">
                <div id="deck-builder-container">
                    <h3 style="text-align: center;">Deck Builder</h3>
                    <div id="deck-builder-collections">
                        <div id="all-cards">
                            <h3>Your Collection</h3>
                            <div id="all-cards-list"></div>
                        </div>
                        <div id="current-deck">
                            <h3>Current Deck (<span id="deck-count">0</span>/30)</h3>
                            <div id="current-deck-list"></div>
                        </div>
                    </div>
                    <button id="deck-save">Save Deck</button>
                </div>
            </div>
            
            <div id="fusion-tab" class="tab-content">
                <div id="fusion-container">
                    <h3>Card Fusion</h3>
                    <p>Combine duplicate cards to create higher rarity versions</p>
                    
                    <div id="fusion-slots">
                        <div class="fusion-slot" id="fusion-slot-1">+</div>
                        <div class="fusion-slot" id="fusion-slot-2">+</div>
                    </div>
                    
                    <div id="fusion-result">?</div>
                    
                    <button id="fusion-button" disabled>Fuse Cards</button>
                    
                    <div style="margin-top: 20px;">
                        <h4>Fusion Requirements:</h4>
                        <p>2 Common ‚Üí 1 Uncommon</p>
                        <p>3 Uncommon ‚Üí 1 Rare</p>
                        <p>4 Rare ‚Üí 1 Epic</p>
                        <p>5 Epic ‚Üí 1 Legendary</p>
                    </div>
                </div>
            </div>
            
            <div id="quests-tab" class="tab-content">
                <div id="quest-log">
                    <h3 style="text-align: center;">Quest Log</h3>
                    <div id="active-quests"></div>
                    
                    <div class="weekly-reward">
                        <div class="weekly-reward-title">Weekly Challenge</div>
                        <div id="weekly-challenge-description">Defeat 5 enemies this week</div>
                        <div class="weekly-progress">
                            <div class="weekly-progress-bar" id="weekly-progress-bar" style="width: 0%"></div>
                        </div>
                        <div id="weekly-progress-text">0/5 completed</div>
                        <button id="claim-weekly" disabled>Claim Reward</button>
                    </div>
                </div>
            </div>
            
            <div id="combat-tab" class="tab-content">
                <div id="combat-container">
                    <h3 style="text-align: center;">Combat Arena</h3>
                    <div id="combat-info">
                        <div id="player-stats">
                            <h4>Your Stats</h4>
                            <div class="stat-display"><span class="stat-name">Health:</span> <span id="player-health">100</span>/100</div>
                            <div class="stat-display"><span class="stat-name">Attack:</span> <span id="player-attack">10</span></div>
                            <div class="stat-display"><span class="stat-name">Defense:</span> <span id="player-defense">5</span></div>
                            <div class="stat-display"><span class="stat-name">Element:</span> <span id="player-element">None</span></div>
                        </div>
                        <div id="enemy-stats">
                            <h4>Enemy Stats</h4>
                            <div class="stat-display"><span class="stat-name">Health:</span> <span id="enemy-health">50</span>/50</div>
                            <div class="stat-display"><span class="stat-name">Attack:</span> <span id="enemy-attack">8</span></div>
                            <div class="stat-display"><span class="stat-name">Defense:</span> <span id="enemy-defense">3</span></div>
                            <div class="stat-display"><span class="stat-name">Element:</span> <span id="enemy-element">None</span></div>
                        </div>
                    </div>
                    <div id="combat-log">
                        <div class="combat-message system-message">Enter the arena to begin combat!</div>
                    </div>
                    <div id="combat-actions">
                        <button id="start-combat">Start Combat</button>
                        <button id="attack-button" disabled>Attack</button>
                        <button id="defend-button" disabled>Defend</button>
                        <button id="use-item-button" disabled>Use Item</button>
                        <button id="special-attack-button" disabled>Special</button>
                    </div>
                </div>
            </div>
            
            <div id="achievements-tab" class="tab-content">
                <div id="achievements-list"></div>
            </div>
            
            <div id="daily-tab" class="tab-content">
                <h3 style="text-align: center; margin-bottom: 10px;">Daily Rewards</h3>
                <p style="text-align: center; margin-bottom: 15px;">Come back each day to claim your reward!</p>
                <button id="claim-daily" style="width: 100%; margin-bottom: 15px;">Claim Daily Reward</button>
                <div class="daily-reward-calendar" id="daily-calendar"></div>
                
                <div class="weekly-reward">
                    <div class="weekly-reward-title">Weekly Bonus</div>
                    <p>Login 5 days this week for a special reward!</p>
                    <div class="weekly-progress">
                        <div class="weekly-progress-bar" id="weekly-login-bar" style="width: 0%"></div>
                    </div>
                    <div id="weekly-login-text">0/5 days logged in</div>
                    <button id="claim-weekly-login" disabled>Claim Reward</button>
                </div>
            </div>
            
            <div id="settings-tab" class="tab-content">
                <div id="settings-container">
                    <h3 style="text-align: center;">Game Settings</h3>
                    <div class="setting-option">
                        <div class="setting-title">Sound Effects</div>
                        <div class="setting-controls">
                            <span>Off</span>
                            <input type="range" id="sound-volume" min="0" max="100" value="50">
                            <span>On</span>
                        </div>
                    </div>
                    <div class="setting-option">
                        <div class="setting-title">Music</div>
                        <div class="setting-controls">
                            <span>Off</span>
                            <input type="range" id="music-volume" min="0" max="100" value="30">
                            <span>On</span>
                        </div>
                    </div>
                    <div class="setting-option">
                        <div class="setting-title">Vibration</div>
                        <div class="setting-controls">
                            <button id="vibration-toggle">Enabled</button>
                        </div>
                    </div>
                    <button id="reset-game">Reset Game Progress</button>
                </div>
            </div>
        </div>
        
        <div id="actions">
            <button id="open-pack">Open Pack (50g)</button>
            <button id="sell-card">Sell Card</button>
            <button id="upgrade-pack">Upgrade (100g)</button>
        </div>
    </div>
    
    <div id="modal">
        <div id="modal-content">
            <button id="close-modal">√ó</button>
            <h2>New Cards!</h2>
            <div id="new-cards"></div>
            <button id="add-to-collection">Add to Collection</button>
        </div>
    </div>
    
    <div id="daily-reward-container">
        <div id="daily-reward-content">
            <button id="daily-reward-close">√ó</button>
            <h2>Daily Reward!</h2>
            <p id="daily-reward-message">Come back tomorrow for another reward!</p>
            <div class="daily-reward-calendar" id="daily-reward-calendar"></div>
            <button id="daily-reward-button">Claim Reward</button>
        </div>
    </div>
    
    <script>
        // Enhanced Game data
        const gameData = {
            gold: 100,
            cards: [],
            selectedCard: null,
            newCards: [],
            playerLevel: 1,
            xp: 0,
            xpToNextLevel: 100,
            achievements: [
                { id: 1, name: "First Collection", description: "Collect 10 cards", reward: 50, completed: false, progress: 0, target: 10, icon: "üì¶" },
                { id: 2, name: "Novice Collector", description: "Collect 25 cards", reward: 100, completed: false, progress: 0, target: 25, icon: "üõçÔ∏è" },
                { id: 3, name: "Seasoned Adventurer", description: "Collect 50 cards", reward: 200, completed: false, progress: 0, target: 50, icon: "üèÜ" },
                { id: 4, name: "Legendary Hoarder", description: "Collect 100 cards", reward: 500, completed: false, progress: 0, target: 100, icon: "üêâ" },
                { id: 5, name: "Common Sight", description: "Collect 20 common cards", reward: 50, completed: false, progress: 0, target: 20, icon: "üîÑ" },
                { id: 6, name: "Rare Find", description: "Collect 10 rare cards", reward: 150, completed: false, progress: 0, target: 10, icon: "üîç" },
                { id: 7, name: "Epic Quest", description: "Collect 5 epic cards", reward: 250, completed: false, progress: 0, target: 5, icon: "‚öîÔ∏è" },
                { id: 8, name: "Legendary Hero", description: "Collect 3 legendary cards", reward: 500, completed: false, progress: 0, target: 3, icon: "üëë" },
                { id: 9, name: "Mythic Destiny", description: "Collect a mythic card", reward: 1000, completed: false, progress: 0, target: 1, icon: "‚ú®" },
                { id: 10, name: "Gold Digger", description: "Earn 1000 gold", reward: 200, completed: false, progress: 0, target: 1000, icon: "üí∞" },
                { id: 11, name: "Daily Adventurer", description: "Claim 7 daily rewards", reward: 150, completed: false, progress: 0, target: 7, icon: "üìÖ" },
                { id: 12, name: "Pack Master", description: "Open 20 packs", reward: 200, completed: false, progress: 0, target: 20, icon: "üéÅ" },
                { id: 13, name: "Deck Builder", description: "Create your first deck", reward: 100, completed: false, progress: 0, target: 1, icon: "üÉè" },
                { id: 14, name: "Quest Complete", description: "Complete 5 quests", reward: 200, completed: false, progress: 0, target: 5, icon: "‚úÖ" },
                { id: 15, name: "Monster Slayer", description: "Defeat 10 enemies", reward: 300, completed: false, progress: 0, target: 10, icon: "üëπ" },
                { id: 16, name: "Card Fusionist", description: "Fuse 10 cards", reward: 200, completed: false, progress: 0, target: 10, icon: "üß™" },
                { id: 17, name: "Weekly Champion", description: "Complete 5 weekly challenges", reward: 500, completed: false, progress: 0, target: 5, icon: "üèÖ" }
            ],
            packType: "starter", // starter, adventurer, dragon
            totalCardsCollected: 0,
            totalGoldEarned: 0,
            packsOpened: 0,
            dailyRewards: {
                lastClaimed: null,
                streak: 0,
                claimedDays: [],
                weeklyLoginDays: 0,
                lastWeeklyReset: null
            },
            dailyRewardAmounts: [50, 75, 100, 125, 150, 200, 300],
            weeklyChallenges: {
                currentChallenge: "defeat_enemies",
                progress: 0,
                target: 5,
                reward: 200,
                completed: false,
                lastReset: null
            },
            deck: [],
            currentDeck: [],
            quests: [
                { id: 1, name: "First Steps", description: "Open your first pack of cards", reward: 50, completed: false },
                { id: 2, name: "Novice Collector", description: "Collect 15 cards", reward: 100, completed: false, target: 15 },
                { id: 3, name: "Gold Accumulator", description: "Earn 500 gold", reward: 150, completed: false, target: 500 },
                { id: 4, name: "Rare Hunter", description: "Collect 5 rare cards", reward: 200, completed: false, target: 5, rarity: "rare" },
                { id: 5, name: "Daily Grind", description: "Claim 3 daily rewards", reward: 150, completed: false, target: 3 },
                { id: 6, name: "Deck Builder", description: "Create a deck of 20 cards", reward: 200, completed: false, target: 20 },
                { id: 7, name: "First Blood", description: "Defeat your first enemy", reward: 100, completed: false },
                { id: 8, name: "Fusion Expert", description: "Fuse your first card", reward: 150, completed: false },
                { id: 9, name: "Weekly Warrior", description: "Complete your first weekly challenge", reward: 200, completed: false }
            ],
            activeQuests: [],
            completedQuests: [],
            combatStats: {
                playerHealth: 100,
                playerMaxHealth: 100,
                playerAttack: 10,
                playerDefense: 5,
                playerElement: null,
                enemyHealth: 0,
                enemyMaxHealth: 0,
                enemyAttack: 0,
                enemyDefense: 0,
                enemyElement: null,
                inCombat: false,
                currentEnemy: null,
                specialAttackCharges: 0,
                statusEffects: {
                    enemy: [],
                    player: []
                }
            },
            enemies: [
                { id: 1, name: "Goblin", health: 30, maxHealth: 30, attack: 5, defense: 2, reward: 25, element: "earth" },
                { id: 2, name: "Orc", health: 50, maxHealth: 50, attack: 8, defense: 3, reward: 40, element: "earth" },
                { id: 3, name: "Fire Elemental", health: 45, maxHealth: 45, attack: 10, defense: 1, reward: 35, element: "fire" },
                { id: 4, name: "Water Nymph", health: 40, maxHealth: 40, attack: 7, defense: 4, reward: 30, element: "water" },
                { id: 5, name: "Troll", health: 80, maxHealth: 80, attack: 12, defense: 5, reward: 60, element: "earth" },
                { id: 6, name: "Dark Knight", health: 70, maxHealth: 70, attack: 15, defense: 8, reward: 80, element: "dark" },
                { id: 7, name: "Dragon", health: 120, maxHealth: 120, attack: 18, defense: 8, reward: 100, element: "fire" },
                { id: 8, name: "Angel", health: 90, maxHealth: 90, attack: 14, defense: 6, reward: 90, element: "holy" }
            ],
            settings: {
                soundVolume: 50,
                musicVolume: 30,
                vibration: true
            },
            stats: {
                enemiesDefeated: 0,
                questsCompleted: 0,
                decksCreated: 0,
                cardsFused: 0,
                weeklyChallengesCompleted: 0
            },
            fusion: {
                slot1: null,
                slot2: null
            },
            elementAdvantages: {
                fire: { strongAgainst: "earth", weakAgainst: "water" },
                water: { strongAgainst: "fire", weakAgainst: "air" },
                earth: { strongAgainst: "air", weakAgainst: "fire" },
                air: { strongAgainst: "water", weakAgainst: "earth" },
                holy: { strongAgainst: "dark", weakAgainst: null },
                dark: { strongAgainst: "holy", weakAgainst: null }
            }
        };
        
        // Expanded card database with elements and fusion info
        const cardDatabase = [
            // Common cards (40%)
            { id: 1, name: "Health Potion", rarity: "common", image: "üç∂", value: 5, description: "Restores a small amount of health", type: "item", effect: "heal", power: 10 },
            { id: 2, name: "Rusty Sword", rarity: "common", image: "‚öîÔ∏è", value: 8, description: "A basic weapon that has seen better days", type: "weapon", attack: 3, element: "earth" },
            { id: 3, name: "Wooden Shield", rarity: "common", image: "üõ°Ô∏è", value: 7, description: "Provides minimal protection", type: "armor", defense: 2 },
            { id: 4, name: "Leather Armor", rarity: "common", image: "üß•", value: 10, description: "Light armor offering basic defense", type: "armor", defense: 3 },
            { id: 5, name: "Torch", rarity: "common", image: "üî•", value: 3, description: "Lights up dark dungeons", type: "item", element: "fire" },
            { id: 6, name: "Rope", rarity: "common", image: "üß∂", value: 4, description: "50 feet of sturdy rope", type: "item" },
            { id: 7, name: "Iron Dagger", rarity: "common", image: "üó°Ô∏è", value: 6, description: "A simple but reliable weapon", type: "weapon", attack: 4, element: "earth" },
            { id: 8, name: "Healing Herb", rarity: "common", image: "üåø", value: 4, description: "Natural remedy for minor wounds", type: "item", effect: "heal", power: 5 },
            { id: 9, name: "Thieves' Tools", rarity: "common", image: "üîß", value: 12, description: "Essential for any rogue", type: "item" },
            { id: 10, name: "Holy Symbol", rarity: "common", image: "‚úùÔ∏è", value: 8, description: "Focus for divine magic", type: "item", element: "holy" },
            
            // Uncommon cards (30%)
            { id: 11, name: "Steel Sword", rarity: "uncommon", image: "‚öîÔ∏è", value: 20, description: "Well-crafted weapon for adventurers", type: "weapon", attack: 6, element: "earth" },
            { id: 12, name: "Chainmail", rarity: "uncommon", image: "ü•ã", value: 25, description: "Flexible metal armor", type: "armor", defense: 5 },
            { id: 13, name: "Magic Scroll", rarity: "uncommon", image: "üìú", value: 30, description: "Contains a single spell", type: "item", effect: "random", element: "air" },
            { id: 14, name: "Silver Amulet", rarity: "uncommon", image: "üìø", value: 22, description: "Protects against evil forces", type: "armor", defense: 2, special: "evilProtection", element: "holy" },
            { id: 15, name: "Composite Bow", rarity: "uncommon", image: "üèπ", value: 28, description: "Powerful ranged weapon", type: "weapon", attack: 7, element: "air" },
            { id: 16, name: "Wizard's Staff", rarity: "uncommon", image: "ü™Ñ", value: 35, description: "Channel arcane energies", type: "weapon", attack: 5, special: "magicBoost", element: "air" },
            { id: 17, name: "Potion of Strength", rarity: "uncommon", image: "üß™", value: 25, description: "Temporarily increases power", type: "item", effect: "buff", power: 5, duration: 3 },
            { id: 18, name: "Elven Cloak", rarity: "uncommon", image: "üß•", value: 30, description: "Helps blend with surroundings", type: "armor", defense: 3, special: "stealth", element: "air" },
            { id: 19, name: "Dwarven Ale", rarity: "uncommon", image: "üç∫", value: 15, description: "Restores stamina and courage", type: "item", effect: "heal", power: 15 },
            { id: 20, name: "Ring of Protection", rarity: "uncommon", image: "üíç", value: 40, description: "+1 to armor class", type: "armor", defense: 4 },
            
            // Rare cards (20%)
            { id: 21, name: "Dragon Slayer", rarity: "rare", image: "‚öîÔ∏è", value: 60, description: "Deals extra damage to dragons", type: "weapon", attack: 10, special: "dragonSlayer", element: "holy" },
            { id: 22, name: "Plate Armor", rarity: "rare", image: "üõ°Ô∏è", value: 70, description: "Heavy but protective", type: "armor", defense: 8 },
            { id: 23, name: "Ring of Power", rarity: "rare", image: "üíç", value: 80, description: "Enhances magical abilities", type: "item", effect: "magicBoost", power: 10, element: "air" },
            { id: 24, name: "Elven Bow", rarity: "rare", image: "üèπ", value: 75, description: "Never misses its mark", type: "weapon", attack: 12, special: "alwaysHit", element: "air" },
            { id: 25, name: "Tome of Wisdom", rarity: "rare", image: "üìñ", value: 90, description: "Increases knowledge and insight", type: "item", effect: "xpBoost", power: 20 },
            { id: 26, name: "Potion of Invisibility", rarity: "rare", image: "üß™", value: 100, description: "Makes you unseen for a short time", type: "item", effect: "invisibility", duration: 2 },
            { id: 27, name: "Boots of Speed", rarity: "rare", image: "üë¢", value: 85, description: "Doubles movement speed", type: "armor", defense: 2, special: "speed" },
            { id: 28, name: "Amulet of Health", rarity: "rare", image: "üìø", value: 95, description: "Increases constitution", type: "armor", defense: 3, special: "healthBoost", power: 20 },
            { id: 29, name: "Wand of Fireballs", rarity: "rare", image: "ü™Ñ", value: 110, description: "Cast fireball once per day", type: "weapon", attack: 15, special: "fireball", element: "fire" },
            { id: 30, name: "Bag of Holding", rarity: "rare", image: "üëú", value: 120, description: "Holds more than it should", type: "item", special: "extraStorage" },
            
            // Epic cards (8%)
            { id: 31, name: "Vorpal Sword", rarity: "epic", image: "‚öîÔ∏è", value: 150, description: "Decapitates enemies on critical hits", type: "weapon", attack: 18, special: "vorpal", element: "dark" },
            { id: 32, name: "Dragon Scale Armor", rarity: "epic", image: "ü•ã", value: 200, description: "Made from an actual dragon's scales", type: "armor", defense: 12, special: "fireResistance", element: "fire" },
            { id: 33, name: "Staff of the Archmage", rarity: "epic", image: "ü™Ñ", value: 250, description: "Contains immense arcane power", type: "weapon", attack: 20, special: "archmage", element: "air" },
            { id: 34, name: "Cloak of Invisibility", rarity: "epic", image: "üß•", value: 180, description: "Renders wearer invisible", type: "armor", defense: 5, special: "permanentInvisibility" },
            { id: 35, name: "Ring of Three Wishes", rarity: "epic", image: "üíç", value: 300, description: "Grants three powerful wishes", type: "item", effect: "wish", charges: 3 },
            { id: 36, name: "Deck of Many Things", rarity: "epic", image: "üÉè", value: 500, description: "Random powerful effects", type: "item", effect: "randomEffects", charges: 5 },
            { id: 37, name: "Hammer of Thunderbolts", rarity: "epic", image: "üî®", value: 220, description: "Summons thunder with each strike", type: "weapon", attack: 22, special: "thunder", element: "air" },
            { id: 38, name: "Tome of Clear Thought", rarity: "epic", image: "üìñ", value: 280, description: "Permanently increases intelligence", type: "item", effect: "permStatBoost", stat: "intelligence" },
            
            // Legendary cards (2%)
            { id: 39, name: "Holy Avenger", rarity: "legendary", image: "‚öîÔ∏è", value: 500, description: "Sacred weapon that smites evil", type: "weapon", attack: 30, special: "holyAvenger", element: "holy" },
            { id: 40, name: "Armor of the Gods", rarity: "legendary", image: "üõ°Ô∏è", value: 600, description: "Divine protection", type: "armor", defense: 20, special: "divineProtection", element: "holy" },
            { id: 41, name: "Orb of Dragonkind", rarity: "legendary", image: "üîÆ", value: 1000, description: "Controls dragons", type: "item", effect: "controlDragons", element: "fire" },
            { id: 42, name: "Wand of Orcus", rarity: "legendary", image: "ü™Ñ", value: 800, description: "Weapon of the demon prince", type: "weapon", attack: 35, special: "necromancy", element: "dark" },
            { id: 43, name: "Sword of Kas", rarity: "legendary", image: "‚öîÔ∏è", value: 750, description: "Sentient evil weapon", type: "weapon", attack: 32, special: "sentientEvil", element: "dark" },
            { id: 44, name: "Hand of Vecna", rarity: "legendary", image: "‚úã", value: 1500, description: "Artifact of immense power", type: "item", effect: "godlikePowers", element: "dark" },
            
            // Mythic card (0.1%)
            { id: 45, name: "The Deck of Fate", rarity: "mythic", image: "üé¥", value: 5000, description: "Alters reality itself", type: "item", effect: "realityAlteration", special: true }
        ];
        
        // DOM elements
        const goldElement = document.getElementById('gold');
        const cardsCountElement = document.getElementById('cards-count');
        const playerLevelElement = document.getElementById('player-level');
        const xpBarElement = document.getElementById('xp-bar');
        const collectionElement = document.getElementById('collection');
        const openPackButton = document.getElementById('open-pack');
        const sellCardButton = document.getElementById('sell-card');
        const upgradePackButton = document.getElementById('upgrade-pack');
        const modal = document.getElementById('modal');
        const closeModalButton = document.getElementById('close-modal');
        const newCardsElement = document.getElementById('new-cards');
        const addToCollectionButton = document.getElementById('add-to-collection');
        const achievementsListElement = document.getElementById('achievements-list');
        const tabElements = document.querySelectorAll('.tab');
        const tabContentElements = document.querySelectorAll('.tab-content');
        const buyStarterPackButton = document.getElementById('buy-starter-pack');
        const buyAdventurerPackButton = document.getElementById('buy-adventurer-pack');
        const buyDragonPackButton = document.getElementById('buy-dragon-pack');
        const claimDailyButton = document.getElementById('claim-daily');
        const dailyRewardContainer = document.getElementById('daily-reward-container');
        const dailyRewardButton = document.getElementById('daily-reward-button');
        const dailyRewardMessage = document.getElementById('daily-reward-message');
        const dailyCalendar = document.getElementById('daily-calendar');
        const dailyRewardCalendar = document.getElementById('daily-reward-calendar');
        const allCardsList = document.getElementById('all-cards-list');
        const currentDeckList = document.getElementById('current-deck-list');
        const deckCountElement = document.getElementById('deck-count');
        const deckSaveButton = document.getElementById('deck-save');
        const activeQuestsElement = document.getElementById('active-quests');
        const playerHealthElement = document.getElementById('player-health');
        const playerAttackElement = document.getElementById('player-attack');
        const playerDefenseElement = document.getElementById('player-defense');
        const playerElementElement = document.getElementById('player-element');
        const enemyHealthElement = document.getElementById('enemy-health');
        const enemyAttackElement = document.getElementById('enemy-attack');
        const enemyDefenseElement = document.getElementById('enemy-defense');
        const enemyElementElement = document.getElementById('enemy-element');
        const combatLogElement = document.getElementById('combat-log');
        const startCombatButton = document.getElementById('start-combat');
        const attackButton = document.getElementById('attack-button');
        const defendButton = document.getElementById('defend-button');
        const useItemButton = document.getElementById('use-item-button');
        const specialAttackButton = document.getElementById('special-attack-button');
        const soundVolumeSlider = document.getElementById('sound-volume');
        const musicVolumeSlider = document.getElementById('music-volume');
        const vibrationToggleButton = document.getElementById('vibration-toggle');
        const resetGameButton = document.getElementById('reset-game');
        const fusionSlot1 = document.getElementById('fusion-slot-1');
        const fusionSlot2 = document.getElementById('fusion-slot-2');
        const fusionResult = document.getElementById('fusion-result');
        const fusionButton = document.getElementById('fusion-button');
        const weeklyChallengeDescription = document.getElementById('weekly-challenge-description');
        const weeklyProgressBar = document.getElementById('weekly-progress-bar');
        const weeklyProgressText = document.getElementById('weekly-progress-text');
        const claimWeeklyButton = document.getElementById('claim-weekly');
        const weeklyLoginBar = document.getElementById('weekly-login-bar');
        const weeklyLoginText = document.getElementById('weekly-login-text');
        const claimWeeklyLoginButton = document.getElementById('claim-weekly-login');
        
        // Initialize game
        function initGame() {
            // Add this at the start of initGame() to force reset
localStorage.removeItem('dndCardCollectorSave'); 
            // Load saved game if available
            const savedGame = localStorage.getItem('dndCardCollectorSave');
            if (savedGame) {
                try {
                    const parsedData = JSON.parse(savedGame);
                    Object.assign(gameData, parsedData);
                    showNotification("Game loaded successfully!");
                } catch (e) {
                    console.error("Failed to load game", e);
                }
            }
            
            // Check if weekly reset is needed
            checkWeeklyReset();
            
            // Initialize active quests if empty
            if (gameData.activeQuests.length === 0) {
                gameData.activeQuests = gameData.quests.filter(q => q.id <= 3); // Start with first 3 quests
            }
            
            updateStats();
            renderCollection();
            renderAchievements();
            renderDailyCalendar();
            renderDeckBuilder();
            renderQuests();
            updateCombatUI();
            loadSettings();
            updateWeeklyChallengeUI();
            updateWeeklyLoginUI();
            
            // Event listeners
            openPackButton.addEventListener('click', openPack);
            sellCardButton.addEventListener('click', sellSelectedCard);
            closeModalButton.addEventListener('click', closeModal);
            addToCollectionButton.addEventListener('click', addNewCardsToCollection);
            upgradePackButton.addEventListener('click', upgradePack);
            
            // Tab switching
            tabElements.forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab));
            });
            
            // Shop buttons
            buyStarterPackButton.addEventListener('click', () => buyPack('starter'));
            buyAdventurerPackButton.addEventListener('click', () => buyPack('adventurer'));
            buyDragonPackButton.addEventListener('click', () => buyPack('dragon'));
            
            // Daily reward
            claimDailyButton.addEventListener('click', showDailyReward);
            dailyRewardButton.addEventListener('click', claimDailyReward);
            document.getElementById('daily-reward-close').addEventListener('click', () => {
                dailyRewardContainer.style.display = 'none';
            });
            
            // Deck builder
            deckSaveButton.addEventListener('click', saveDeck);
            
            // Combat
            startCombatButton.addEventListener('click', startCombat);
            attackButton.addEventListener('click', playerAttack);
            defendButton.addEventListener('click', playerDefend);
            useItemButton.addEventListener('click', useItem);
            specialAttackButton.addEventListener('click', specialAttack);
            
            // Settings
            soundVolumeSlider.addEventListener('input', updateSoundVolume);
            musicVolumeSlider.addEventListener('input', updateMusicVolume);
            vibrationToggleButton.addEventListener('click', toggleVibration);
            resetGameButton.addEventListener('click', resetGame);
            
            // Fusion
            fusionSlot1.addEventListener('click', () => selectCardForFusion(1));
            fusionSlot2.addEventListener('click', () => selectCardForFusion(2));
            fusionButton.addEventListener('click', fuseCards);
            
            // Weekly rewards
            claimWeeklyButton.addEventListener('click', claimWeeklyReward);
            claimWeeklyLoginButton.addEventListener('click', claimWeeklyLoginReward);
            
            // Check for daily reward on startup
            checkDailyReward();
            
            // Auto-save every 30 seconds
            setInterval(saveGame, 30000);
        }
        
        // Save game to localStorage
        function saveGame() {
            localStorage.setItem('dndCardCollectorSave', JSON.stringify(gameData));
        }
        
        // Switch between tabs
        function switchTab(tabName) {
            tabElements.forEach(tab => {
                if (tab.dataset.tab === tabName) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            tabContentElements.forEach(content => {
                if (content.id === `${tabName}-tab`) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
            
            // Special rendering for certain tabs
            if (tabName === 'deck') {
                renderDeckBuilder();
            } else if (tabName === 'combat') {
                updateCombatUI();
            } else if (tabName === 'fusion') {
                updateFusionUI();
            }
        }
        
        // Show floating notification
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'floating-notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 2000);
        }
        
        // Update game stats display
        function updateStats() {
            goldElement.textContent = gameData.gold;
            cardsCountElement.textContent = gameData.cards.length;
            playerLevelElement.textContent = gameData.playerLevel;
            xpBarElement.textContent = `${gameData.xp}/${gameData.xpToNextLevel}`;
            xpBarElement.style.width = `${(gameData.xp / gameData.xpToNextLevel) * 100}%`;
            
            // Update button states
            openPackButton.disabled = gameData.gold < 50;
            upgradePackButton.disabled = gameData.gold < 100;
            buyStarterPackButton.disabled = gameData.gold < 50;
            buyAdventurerPackButton.disabled = gameData.gold < 150;
            buyDragonPackButton.disabled = gameData.gold < 500;
        }
        
        // Render collection
        function renderCollection() {
            collectionElement.innerHTML = '';
            
            if (gameData.cards.length === 0) {
                collectionElement.innerHTML = '<p style="grid-column: 1 / -1; text-align: center;">Your collection is empty. Open a pack to get started!</p>';
                return;
            }
            
            // Group cards by type and count duplicates
            const cardCounts = {};
            gameData.cards.forEach(card => {
                const key = `${card.id}`;
                cardCounts[key] = (cardCounts[key] || 0) + 1;
            });
            
            // Create unique card list
            const uniqueCards = [];
            const seenIds = new Set();
            gameData.cards.forEach(card => {
                if (!seenIds.has(card.id)) {
                    seenIds.add(card.id);
                    uniqueCards.push(card);
                }
            });
            
            // Sort by rarity (legendary first) then by name
            uniqueCards.sort((a, b) => {
                const rarityOrder = { mythic: 0, legendary: 1, epic: 2, rare: 3, uncommon: 4, common: 5 };
                if (rarityOrder[a.rarity] !== rarityOrder[b.rarity]) {
                    return rarityOrder[a.rarity] - rarityOrder[b.rarity];
                }
                return a.name.localeCompare(b.name);
            });
            
            uniqueCards.forEach(card => {
                const count = cardCounts[`${card.id}`];
                const cardElement = document.createElement('div');
                cardElement.className = `card ${gameData.selectedCard === card.id ? 'selected' : ''}`;
                cardElement.dataset.cardId = card.id;
                
                // Add element class if card has one
                const elementClass = card.element ? ` ${card.element}` : '';
                
                cardElement.innerHTML = `
                    <div class="card-image${elementClass}">${card.image}</div>
                    <div class="card-name">${card.name}</div>
                    <div class="card-rarity ${card.rarity}">${card.rarity}</div>
                    <div class="card-value">Value: ${card.value}g</div>
                    ${count > 1 ? `<div class="card-count">${count}</div>` : ''}
                    <div class="tooltip">${card.description}</div>
                `;
                
                cardElement.addEventListener('click', () => selectCard(card.id));
                collectionElement.appendChild(cardElement);
            });
        }
        
        // Select a card
        function selectCard(cardId) {
            gameData.selectedCard = gameData.selectedCard === cardId ? null : cardId;
            renderCollection();
        }
        
        // Sell selected card
        function sellSelectedCard() {
            if (gameData.selectedCard === null) {
                showNotification("Please select a card to sell!");
                return;
            }
            
            // Find first instance of the selected card
            const index = gameData.cards.findIndex(card => card.id === gameData.selectedCard);
            if (index === -1) return;
            
            const card = gameData.cards[index];
            gameData.gold += card.value;
            gameData.totalGoldEarned += card.value;
            gameData.cards.splice(index, 1);
            gameData.selectedCard = null;
            
            // Add XP
            addXp(5);
            
            updateStats();
            renderCollection();
            checkAchievements();
            checkQuests();
            showNotification(`Sold ${card.name} for ${card.value}g!`);
            saveGame();
        }
        
        // Add XP and check for level up
        function addXp(amount) {
            gameData.xp += amount;
            
            if (gameData.xp >= gameData.xpToNextLevel) {
                gameData.xp -= gameData.xpToNextLevel;
                gameData.playerLevel++;
                gameData.xpToNextLevel = Math.floor(gameData.xpToNextLevel * 1.2);
                showNotification(`Level Up! Now level ${gameData.playerLevel}`);
            }
            
            updateStats();
        }
        
        // Open a pack of cards
        function openPack() {
            if (gameData.gold < 50) {
                showNotification("Not enough gold to open a pack!");
                return;
            }
            
            gameData.gold -= 50;
            gameData.packsOpened++;
            updateStats();
            
            generatePack(gameData.packType);
            checkAchievements();
            checkQuests();
        }
        
        // Buy a specific pack type from the shop
        function buyPack(packType) {
            let cost = 0;
            
            switch (packType) {
                case 'starter':
                    cost = 50;
                    break;
                case 'adventurer':
                    cost = 150;
                    break;
                case 'dragon':
                    cost = 500;
                    break;
            }
            
            if (gameData.gold < cost) {
                showNotification(`Not enough gold for this pack!`);
                return;
            }
            
            gameData.gold -= cost;
            gameData.packsOpened++;
            updateStats();
            
            generatePack(packType);
            checkAchievements();
            checkQuests();
        }
        
        // Generate a pack of cards based on type
        function generatePack(packType) {
            // Clear previous new cards
            gameData.newCards = [];
            newCardsElement.innerHTML = '';
            
            // Generate 5 new cards with rarity distribution based on pack type
            for (let i = 0; i < 5; i++) {
                let rarity;
                let rarityRoll = Math.random();
                
                // Different odds based on pack type
                switch (packType) {
                    case 'starter':
                        if (i === 4) { // Guaranteed rare for last card in starter pack
                            rarity = "rare";
                        } else if (rarityRoll < 0.6) {
                            rarity = "common";
                        } else if (rarityRoll < 0.9) {
                            rarity = "uncommon";
                        } else {
                            rarity = "rare";
                        }
                        break;
                        
                    case 'adventurer':
                        if (i === 4) { // Guaranteed epic for last card in adventurer pack
                            rarity = "epic";
                        } else if (rarityRoll < 0.5) {
                            rarity = "common";
                        } else if (rarityRoll < 0.8) {
                            rarity = "uncommon";
                        } else if (rarityRoll < 0.95) {
                            rarity = "rare";
                        } else {
                            rarity = "epic";
                        }
                        break;
                        
                    case 'dragon':
                        if (i === 4) { // Guaranteed legendary for last card in dragon pack
                            rarity = "legendary";
                        } else if (rarityRoll < 0.4) {
                            rarity = "uncommon";
                        } else if (rarityRoll < 0.7) {
                            rarity = "rare";
                        } else if (rarityRoll < 0.95) {
                            rarity = "epic";
                        } else {
                            // 0.5% chance for mythic card in dragon pack
                            rarity = Math.random() < 0.005 ? "mythic" : "legendary";
                        }
                        break;
                }
                
                // Filter cards by rarity and pick one randomly
                let cardsOfRarity = cardDatabase.filter(card => card.rarity === rarity);
                
                // If mythic and no cards available (shouldn't happen), default to legendary
                if (cardsOfRarity.length === 0 && rarity === "mythic") {
                    cardsOfRarity = cardDatabase.filter(card => card.rarity === "legendary");
                }
                
                const randomCard = {...cardsOfRarity[Math.floor(Math.random() * cardsOfRarity.length)]};
                
                gameData.newCards.push(randomCard);
                
                // Display the new card
                const cardElement = document.createElement('div');
                cardElement.className = `card new-card ${rarity}`;
                
                // Add element class if card has one
                const elementClass = randomCard.element ? ` ${randomCard.element}` : '';
                
                cardElement.innerHTML = `
                    <div class="card-image${elementClass}">${randomCard.image}</div>
                    <div class="card-name">${randomCard.name}</div>
                    <div class="card-rarity ${rarity}">${rarity}</div>
                    <div class="card-value">Value: ${randomCard.value}g</div>
                    <div class="tooltip">${randomCard.description}</div>
                `;
                
                newCardsElement.appendChild(cardElement);
            }
            
            // Show the modal
            modal.style.display = 'flex';
        }
        
        // Upgrade pack quality
        function upgradePack() {
            if (gameData.gold < 100) {
                showNotification("Not enough gold to upgrade!");
                return;
            }
            
            switch (gameData.packType) {
                case "starter":
                    gameData.packType = "adventurer";
                    showNotification("Pack upgraded to Adventurer! Better chances for rare cards.");
                    break;
                case "adventurer":
                    gameData.packType = "dragon";
                    showNotification("Pack upgraded to Dragon! Chance for legendary cards.");
                    break;
                case "dragon":
                    showNotification("Your pack is already at maximum quality!");
                    return;
            }
            
            gameData.gold -= 100;
            updateStats();
            saveGame();
        }
        
        // Close modal
        function closeModal() {
            modal.style.display = 'none';
        }
        
        // Add new cards to collection
        function addNewCardsToCollection() {
            gameData.cards.push(...gameData.newCards);
            gameData.totalCardsCollected += gameData.newCards.length;
            
            // Add XP based on cards received
            const xpGain = gameData.newCards.reduce((sum, card) => {
                const rarityXp = {
                    common: 1,
                    uncommon: 2,
                    rare: 5,
                    epic: 10,
                    legendary: 20,
                    mythic: 50
                };
                return sum + rarityXp[card.rarity];
            }, 0);
            
            addXp(xpGain);
            
            // Check for mythic card
            const hasMythic = gameData.newCards.some(card => card.rarity === "mythic");
            if (hasMythic) {
                showNotification("INCREDIBLE! You found a MYTHIC card!");
            }
            
            gameData.newCards = [];
            closeModal();
            updateStats();
            renderCollection();
            checkAchievements();
            checkQuests();
            saveGame();
        }
        
        // Render achievements
        function renderAchievements() {
            achievementsListElement.innerHTML = '';
            
            gameData.achievements.forEach(achievement => {
                const achievementElement = document.createElement('div');
                achievementElement.className = `achievement ${achievement.completed ? 'completed' : ''}`;
                
                const progress = Math.min(achievement.progress, achievement.target);
                const percentage = Math.floor((progress / achievement.target) * 100);
                
                achievementElement.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <div class="achievement-info">
                        <div class="achievement-title">${achievement.name}</div>
                        <div class="achievement-description">${achievement.description}</div>
                        <div class="achievement-progress">${progress}/${achievement.target} (${percentage}%)</div>
                        ${achievement.completed ? `<div class="achievement-reward">Reward: ${achievement.reward}g</div>` : ''}
                    </div>
                `;
                
                achievementsListElement.appendChild(achievementElement);
            });
        }
        
        // Check achievement progress
        function checkAchievements() {
            // Count cards by rarity
            const rarityCounts = {
                common: 0,
                uncommon: 0,
                rare: 0,
                epic: 0,
                legendary: 0,
                mythic: 0
            };
            
            gameData.cards.forEach(card => {
                rarityCounts[card.rarity]++;
            });
            
            // Update achievements
            gameData.achievements.forEach(achievement => {
                if (achievement.completed) return;
                
                switch (achievement.id) {
                    case 1: // First Collection
                    case 2: // Novice Collector
                    case 3: // Seasoned Adventurer
                    case 4: // Legendary Hoarder
                        achievement.progress = gameData.totalCardsCollected;
                        break;
                    case 5: // Common Sight
                        achievement.progress = rarityCounts.common;
                        break;
                    case 6: // Rare Find
                        achievement.progress = rarityCounts.rare;
                        break;
                    case 7: // Epic Quest
                        achievement.progress = rarityCounts.epic;
                        break;
                    case 8: // Legendary Hero
                        achievement.progress = rarityCounts.legendary;
                        break;
                    case 9: // Mythic Destiny
                        achievement.progress = rarityCounts.mythic;
                        break;
                    case 10: // Gold Digger
                        achievement.progress = gameData.totalGoldEarned;
                        break;
                    case 11: // Daily Adventurer
                        achievement.progress = gameData.dailyRewards.claimedDays.length;
                        break;
                    case 12: // Pack Master
                        achievement.progress = gameData.packsOpened;
                        break;
                    case 13: // Deck Builder
                        achievement.progress = gameData.stats.decksCreated > 0 ? 1 : 0;
                        break;
                    case 14: // Quest Complete
                        achievement.progress = gameData.stats.questsCompleted;
                        break;
                    case 15: // Monster Slayer
                        achievement.progress = gameData.stats.enemiesDefeated;
                        break;
                    case 16: // Card Fusionist
                        achievement.progress = gameData.stats.cardsFused;
                        break;
                    case 17: // Weekly Champion
                        achievement.progress = gameData.stats.weeklyChallengesCompleted;
                        break;
                }
                
                if (achievement.progress >= achievement.target) {
                    achievement.completed = true;
                    gameData.gold += achievement.reward;
                    showNotification(`Achievement unlocked: ${achievement.name}! +${achievement.reward}g`);
                    updateStats();
                    saveGame();
                }
            });
            
            renderAchievements();
        }
        
        // Daily reward functions
        function checkDailyReward() {
            const today = new Date().toDateString();
            const lastClaimed = gameData.dailyRewards.lastClaimed ? new Date(gameData.dailyRewards.lastClaimed).toDateString() : null;
            
            // If already claimed today
            if (lastClaimed === today) {
                return;
            }
            
            // Check if streak continues (claimed yesterday)
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toDateString();
            
            if (lastClaimed === yesterdayStr) {
                // Continue streak
            } else {
                // Reset streak
                gameData.dailyRewards.streak = 0;
            }
            
            // Show reward after a short delay
            setTimeout(() => {
                showDailyReward();
            }, 1000);
        }
        
        function showDailyReward() {
            const today = new Date().toDateString();
            const lastClaimed = gameData.dailyRewards.lastClaimed ? new Date(gameData.dailyRewards.lastClaimed).toDateString() : null;
            
            // If already claimed today
            if (lastClaimed === today) {
                dailyRewardMessage.textContent = "You've already claimed your reward today. Come back tomorrow!";
                dailyRewardButton.style.display = 'none';
            } else {
                const dayIndex = gameData.dailyRewards.streak % 7;
                const rewardAmount = gameData.dailyRewardAmounts[dayIndex];
                dailyRewardMessage.textContent = `Today's reward: ${rewardAmount}g (Day ${gameData.dailyRewards.streak + 1} of 7)`;
                dailyRewardButton.style.display = 'block';
            }
            
            renderDailyRewardCalendar();
            dailyRewardContainer.style.display = 'flex';
        }
        
        function claimDailyReward() {
            const today = new Date();
            const todayStr = today.toDateString();
            const lastClaimed = gameData.dailyRewards.lastClaimed ? new Date(gameData.dailyRewards.lastClaimed).toDateString() : null;
            
            // If already claimed today
            if (lastClaimed === todayStr) {
                return;
            }
            
            // Check if streak continues (claimed yesterday)
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toDateString();
            
            if (lastClaimed === yesterdayStr) {
                // Continue streak
                gameData.dailyRewards.streak++;
            } else {
                // New streak
                gameData.dailyRewards.streak = 1;
            }
            
            // Calculate reward
            const dayIndex = (gameData.dailyRewards.streak - 1) % 7;
            const rewardAmount = gameData.dailyRewardAmounts[dayIndex];
            
            // Give reward
            gameData.gold += rewardAmount;
            gameData.totalGoldEarned += rewardAmount;
            gameData.dailyRewards.lastClaimed = today.toString();
            
            // Mark day as claimed
            const dateStr = today.toLocaleDateString();
            if (!gameData.dailyRewards.claimedDays.includes(dateStr)) {
                gameData.dailyRewards.claimedDays.push(dateStr);
                gameData.dailyRewards.weeklyLoginDays++;
                updateWeeklyLoginUI();
            }
            
            showNotification(`Daily reward claimed: +${rewardAmount}g! (Streak: ${gameData.dailyRewards.streak})`);
            updateStats();
            renderDailyCalendar();
            dailyRewardContainer.style.display = 'none';
            checkAchievements();
            checkQuests();
            saveGame();
        }
        
        function renderDailyCalendar() {
            dailyCalendar.innerHTML = '';
            for (let i = 0; i < 7; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day reward';
                
                if (i < gameData.dailyRewards.streak % 7) {
                    dayElement.classList.add('claimed');
                } else if (i === gameData.dailyRewards.streak % 7) {
                    dayElement.classList.add('today');
                }
                
                dayElement.innerHTML = `
                    <div>Day ${i + 1}</div>
                    <div class="daily-reward-amount">${gameData.dailyRewardAmounts[i]}g</div>
                `;
                
                dailyCalendar.appendChild(dayElement);
            }
        }
        
        function renderDailyRewardCalendar() {
            dailyRewardCalendar.innerHTML = '';
            for (let i = 0; i < 7; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day reward';
                
                if (i < gameData.dailyRewards.streak % 7) {
                    dayElement.classList.add('claimed');
                } else if (i === gameData.dailyRewards.streak % 7) {
                    dayElement.classList.add('today');
                }
                
                dayElement.innerHTML = `
                    <div>Day ${i + 1}</div>
                    <div class="daily-reward-amount">${gameData.dailyRewardAmounts[i]}g</div>
                `;
                
                dailyRewardCalendar.appendChild(dayElement);
            }
        }
        
        // Weekly challenge functions
        function checkWeeklyReset() {
            const now = new Date();
            const lastReset = gameData.weeklyChallenges.lastReset ? new Date(gameData.weeklyChallenges.lastReset) : null;
            
            // Reset weekly challenge if it's a new week
            if (!lastReset || now.getDay() === 1 && (now - lastReset) > 86400000) {
                resetWeeklyChallenge();
            }
            
            // Reset weekly login if it's a new week
            const lastLoginReset = gameData.dailyRewards.lastWeeklyReset ? new Date(gameData.dailyRewards.lastWeeklyReset) : null;
            if (!lastLoginReset || now.getDay() === 1 && (now - lastLoginReset) > 86400000) {
                gameData.dailyRewards.weeklyLoginDays = 0;
                gameData.dailyRewards.lastWeeklyReset = now.toString();
                updateWeeklyLoginUI();
            }
        }
        
        function resetWeeklyChallenge() {
            const challenges = [
                { type: "defeat_enemies", description: "Defeat 5 enemies this week", target: 5, reward: 200 },
                { type: "open_packs", description: "Open 3 packs this week", target: 3, reward: 150 },
                { type: "fuse_cards", description: "Fuse 2 cards this week", target: 2, reward: 250 }
            ];
            
            const randomChallenge = challenges[Math.floor(Math.random() * challenges.length)];
            
            gameData.weeklyChallenges = {
                currentChallenge: randomChallenge.type,
                progress: 0,
                target: randomChallenge.target,
                reward: randomChallenge.reward,
                completed: false,
                lastReset: new Date().toString()
            };
            
            updateWeeklyChallengeUI();
            saveGame();
        }
        
        function updateWeeklyChallengeUI() {
            weeklyChallengeDescription.textContent = gameData.weeklyChallenges.description || 
                getWeeklyChallengeDescription(gameData.weeklyChallenges.currentChallenge);
            
            const progressPercentage = (gameData.weeklyChallenges.progress / gameData.weeklyChallenges.target) * 100;
            weeklyProgressBar.style.width = `${progressPercentage}%`;
            weeklyProgressText.textContent = `${gameData.weeklyChallenges.progress}/${gameData.weeklyChallenges.target} completed`;
            
            claimWeeklyButton.disabled = !gameData.weeklyChallenges.completed;
        }
        
        function getWeeklyChallengeDescription(type) {
            switch (type) {
                case "defeat_enemies":
                    return `Defeat ${gameData.weeklyChallenges.target} enemies this week`;
                case "open_packs":
                    return `Open ${gameData.weeklyChallenges.target} packs this week`;
                case "fuse_cards":
                    return `Fuse ${gameData.weeklyChallenges.target} cards this week`;
                default:
                    return "Complete the weekly challenge";
            }
        }
        
        function updateWeeklyChallengeProgress(type, amount = 1) {
            if (gameData.weeklyChallenges.currentChallenge === type && !gameData.weeklyChallenges.completed) {
                gameData.weeklyChallenges.progress += amount;
                
                if (gameData.weeklyChallenges.progress >= gameData.weeklyChallenges.target) {
                    gameData.weeklyChallenges.completed = true;
                    showNotification("Weekly challenge completed! Claim your reward.");
                }
                
                updateWeeklyChallengeUI();
                saveGame();
            }
        }
        
        function claimWeeklyReward() {
            if (!gameData.weeklyChallenges.completed) return;
            
            gameData.gold += gameData.weeklyChallenges.reward;
            gameData.totalGoldEarned += gameData.weeklyChallenges.reward;
            gameData.stats.weeklyChallengesCompleted++;
            
            showNotification(`Weekly challenge reward claimed: +${gameData.weeklyChallenges.reward}g!`);
            
            // Reset the challenge
            resetWeeklyChallenge();
            
            updateStats();
            checkAchievements();
            checkQuests();
            saveGame();
        }
        
        function updateWeeklyLoginUI() {
            const progressPercentage = (gameData.dailyRewards.weeklyLoginDays / 5) * 100;
            weeklyLoginBar.style.width = `${progressPercentage}%`;
            weeklyLoginText.textContent = `${gameData.dailyRewards.weeklyLoginDays}/5 days logged in`;
            
            claimWeeklyLoginButton.disabled = gameData.dailyRewards.weeklyLoginDays < 5;
        }
        
        function claimWeeklyLoginReward() {
            if (gameData.dailyRewards.weeklyLoginDays < 5) return;
            
            const reward = 300;
            gameData.gold += reward;
            gameData.totalGoldEarned += reward;
            
            showNotification(`Weekly login reward claimed: +${reward}g!`);
            
            gameData.dailyRewards.weeklyLoginDays = 0;
            updateWeeklyLoginUI();
            
            updateStats();
            saveGame();
        }
        
        // Deck builder functions
        function renderDeckBuilder() {
            allCardsList.innerHTML = '';
            currentDeckList.innerHTML = '';
            
            // Group cards by type and count duplicates
            const cardCounts = {};
            gameData.cards.forEach(card => {
                const key = `${card.id}`;
                cardCounts[key] = (cardCounts[key] || 0) + 1;
            });
            
            // Create unique card list
            const uniqueCards = [];
            const seenIds = new Set();
            gameData.cards.forEach(card => {
                if (!seenIds.has(card.id)) {
                    seenIds.add(card.id);
                    uniqueCards.push(card);
                }
            });
            
            // Sort by name
            uniqueCards.sort((a, b) => a.name.localeCompare(b.name));
            
            // Render all cards
            uniqueCards.forEach(card => {
                const count = cardCounts[`${card.id}`];
                const inDeckCount = gameData.currentDeck.filter(c => c.id === card.id).length;
                const availableCount = count - inDeckCount;
                
                if (availableCount > 0) {
                    const cardElement = document.createElement('div');
                    cardElement.className = 'deck-card';
                    cardElement.innerHTML = `
                        <div class="deck-card-name">${card.name} (${availableCount})</div>
                        <div class="deck-card-actions">
                            <button class="add-to-deck" data-card-id="${card.id}">+</button>
                        </div>
                    `;
                    
                    cardElement.querySelector('.add-to-deck').addEventListener('click', () => addToDeck(card.id));
                    allCardsList.appendChild(cardElement);
                }
            });
            
            // Render current deck
            const deckCardCounts = {};
            gameData.currentDeck.forEach(card => {
                const key = `${card.id}`;
                deckCardCounts[key] = (deckCardCounts[key] || 0) + 1;
            });
            
            const uniqueDeckCards = [];
            const seenDeckIds = new Set();
            gameData.currentDeck.forEach(card => {
                if (!seenDeckIds.has(card.id)) {
                    seenDeckIds.add(card.id);
                    uniqueDeckCards.push(card);
                }
            });
            
            uniqueDeckCards.forEach(card => {
                const count = deckCardCounts[`${card.id}`];
                const cardElement = document.createElement('div');
                cardElement.className = 'deck-card';
                cardElement.innerHTML = `
                    <div class="deck-card-name">${card.name} (${count})</div>
                    <div class="deck-card-actions">
                        <button class="remove-from-deck" data-card-id="${card.id}">-</button>
                    </div>
                `;
                
                cardElement.querySelector('.remove-from-deck').addEventListener('click', () => removeFromDeck(card.id));
                currentDeckList.appendChild(cardElement);
            });
            
            deckCountElement.textContent = gameData.currentDeck.length;
        }
        
        function addToDeck(cardId) {
            // Find the card in the collection
            const cardIndex = gameData.cards.findIndex(c => c.id === cardId);
            if (cardIndex === -1) return;
            
            // Check how many are already in deck
            const inDeckCount = gameData.currentDeck.filter(c => c.id === cardId).length;
            const totalCount = gameData.cards.filter(c => c.id === cardId).length;
            
            if (inDeckCount >= totalCount) {
                showNotification("You don't have any more copies of this card!");
                return;
            }
            
            if (gameData.currentDeck.length >= 30) {
                showNotification("Your deck is full (30 cards maximum)");
                return;
            }
            
            const card = gameData.cards[cardIndex];
            gameData.currentDeck.push({...card});
            renderDeckBuilder();
        }
        
        function removeFromDeck(cardId) {
            // Find the last instance of this card in the deck
            const cardIndex = gameData.currentDeck.findIndex(c => c.id === cardId);
            if (cardIndex === -1) return;
            
            gameData.currentDeck.splice(cardIndex, 1);
            renderDeckBuilder();
        }
        
        function saveDeck() {
            if (gameData.currentDeck.length < 20) {
                showNotification("Your deck must have at least 20 cards");
                return;
            }
            
            gameData.deck = [...gameData.currentDeck];
            gameData.stats.decksCreated++;
            showNotification("Deck saved successfully!");
            checkAchievements();
            checkQuests();
            saveGame();
        }
        
        // Card fusion functions
        function selectCardForFusion(slot) {
            if (gameData.selectedCard === null) {
                showNotification("Please select a card from your collection first!");
                return;
            }
            
            // Find the card in the collection
            const card = gameData.cards.find(c => c.id === gameData.selectedCard);
            if (!card) return;
            
            // Check if we have enough copies (need at least 2 for common, 3 for uncommon, etc.)
            const count = gameData.cards.filter(c => c.id === gameData.selectedCard).length;
            const required = getFusionRequirements(card.rarity).required;
            
            if (count < required) {
                showNotification(`You need at least ${required} copies of this card to fuse!`);
                return;
            }
            
            // Assign to slot
            if (slot === 1) {
                gameData.fusion.slot1 = card;
            } else {
                gameData.fusion.slot2 = card;
            }
            
            gameData.selectedCard = null;
            updateFusionUI();
            renderCollection();
        }
        
        function updateFusionUI() {
            // Clear slots
            fusionSlot1.innerHTML = '+';
            fusionSlot1.className = 'fusion-slot';
            fusionSlot2.innerHTML = '+';
            fusionSlot2.className = 'fusion-slot';
            fusionResult.innerHTML = '?';
            fusionResult.className = '';
            fusionButton.disabled = true;
            
            // Update slot 1
            if (gameData.fusion.slot1) {
                fusionSlot1.innerHTML = gameData.fusion.slot1.image;
                fusionSlot1.className = `fusion-slot filled ${gameData.fusion.slot1.rarity}`;
                
                // Add element class if card has one
                if (gameData.fusion.slot1.element) {
                    fusionSlot1.classList.add(gameData.fusion.slot1.element);
                }
            }
            
            // Update slot 2
            if (gameData.fusion.slot2) {
                fusionSlot2.innerHTML = gameData.fusion.slot2.image;
                fusionSlot2.className = `fusion-slot filled ${gameData.fusion.slot2.rarity}`;
                
                // Add element class if card has one
                if (gameData.fusion.slot2.element) {
                    fusionSlot2.classList.add(gameData.fusion.slot2.element);
                }
            }
            
            // Check if fusion is possible
            if (gameData.fusion.slot1 && gameData.fusion.slot2) {
                if (gameData.fusion.slot1.id === gameData.fusion.slot2.id) {
                    const requirements = getFusionRequirements(gameData.fusion.slot1.rarity);
                    
                    // Check if we have enough cards
                    const count = gameData.cards.filter(c => c.id === gameData.fusion.slot1.id).length;
                    if (count >= requirements.required) {
                        fusionResult.innerHTML = requirements.result.image;
                        fusionResult.className = requirements.result.rarity;
                        
                        // Add element class if card has one
                        if (requirements.result.element) {
                            fusionResult.classList.add(requirements.result.element);
                        }
                        
                        fusionButton.disabled = false;
                    }
                } else {
                    fusionResult.innerHTML = 'X';
                    fusionResult.className = '';
                }
            }
        }
        
        function getFusionRequirements(rarity) {
            const resultRarity = {
                common: "uncommon",
                uncommon: "rare",
                rare: "epic",
                epic: "legendary",
                legendary: "mythic"
            }[rarity] || "common";
            
            const required = {
                common: 2,
                uncommon: 3,
                rare: 4,
                epic: 5,
                legendary: 5
            }[rarity] || 2;
            
            // Find a random card of the result rarity
            const possibleResults = cardDatabase.filter(card => card.rarity === resultRarity);
            const resultCard = possibleResults[Math.floor(Math.random() * possibleResults.length)];
            
            return {
                required,
                result: resultCard || cardDatabase[0]
            };
        }
        
        function fuseCards() {
            if (!gameData.fusion.slot1 || !gameData.fusion.slot2 || gameData.fusion.slot1.id !== gameData.fusion.slot2.id) {
                return;
            }
            
            const card = gameData.fusion.slot1;
            const requirements = getFusionRequirements(card.rarity);
            
            // Check if we still have enough cards (in case collection changed)
            const count = gameData.cards.filter(c => c.id === card.id).length;
            if (count < requirements.required) {
                showNotification(`You no longer have enough copies to fuse!`);
                updateFusionUI();
                return;
            }
            
            // Remove the required number of cards
            let removed = 0;
            for (let i = gameData.cards.length - 1; i >= 0 && removed < requirements.required; i--) {
                if (gameData.cards[i].id === card.id) {
                    gameData.cards.splice(i, 1);
                    removed++;
                }
            }
            
            // Add the new card
            gameData.cards.push(requirements.result);
            gameData.totalCardsCollected++;
            gameData.stats.cardsFused++;
            
            // Clear fusion slots
            gameData.fusion.slot1 = null;
            gameData.fusion.slot2 = null;
            
            showNotification(`Fused ${requirements.required} ${card.rarity} cards into a ${requirements.result.rarity} ${requirements.result.name}!`);
            
            updateStats();
            renderCollection();
            updateFusionUI();
            checkAchievements();
            checkQuests();
            updateWeeklyChallengeProgress("fuse_cards");
            saveGame();
        }
        
        // Quest functions
        function renderQuests() {
            activeQuestsElement.innerHTML = '';
            
            gameData.activeQuests.forEach(quest => {
                const questElement = document.createElement('div');
                questElement.className = `quest ${quest.completed ? 'completed' : ''}`;
                
                let progressText = '';
                if (quest.target) {
                    const progress = getQuestProgress(quest);
                    progressText = ` (${progress}/${quest.target})`;
                }
                
                questElement.innerHTML = `
                    <div class="quest-title">${quest.name}</div>
                    <div class="quest-description">${quest.description}${progressText}</div>
                    <div class="quest-reward">Reward: ${quest.reward}g</div>
                `;
                
                activeQuestsElement.appendChild(questElement);
            });
        }
        
        function getQuestProgress(quest) {
            switch (quest.id) {
                case 2: // Novice Collector
                    return gameData.totalCardsCollected;
                case 3: // Gold Accumulator
                    return gameData.totalGoldEarned;
                case 4: // Rare Hunter
                    return gameData.cards.filter(c => c.rarity === "rare").length;
                case 5: // Daily Grind
                    return gameData.dailyRewards.claimedDays.length;
                case 6: // Deck Builder
                    return gameData.currentDeck.length;
                case 7: // First Blood
                    return gameData.stats.enemiesDefeated;
                case 8: // Fusion Expert
                    return gameData.stats.cardsFused;
                case 9: // Weekly Warrior
                    return gameData.stats.weeklyChallengesCompleted;
                default:
                    return 0;
            }
        }
        
        function checkQuests() {
            gameData.activeQuests.forEach(quest => {
                if (quest.completed) return;
                
                let isComplete = false;
                
                switch (quest.id) {
                    case 1: // First Steps
                        isComplete = gameData.packsOpened > 0;
                        break;
                    case 2: // Novice Collector
                        isComplete = gameData.totalCardsCollected >= quest.target;
                        break;
                    case 3: // Gold Accumulator
                        isComplete = gameData.totalGoldEarned >= quest.target;
                        break;
                    case 4: // Rare Hunter
                        isComplete = gameData.cards.filter(c => c.rarity === "rare").length >= quest.target;
                        break;
                    case 5: // Daily Grind
                        isComplete = gameData.dailyRewards.claimedDays.length >= quest.target;
                        break;
                    case 6: // Deck Builder
                        isComplete = gameData.currentDeck.length >= quest.target;
                        break;
                    case 7: // First Blood
                        isComplete = gameData.stats.enemiesDefeated > 0;
                        break;
                    case 8: // Fusion Expert
                        isComplete = gameData.stats.cardsFused > 0;
                        break;
                    case 9: // Weekly Warrior
                        isComplete = gameData.stats.weeklyChallengesCompleted > 0;
                        break;
                }
                
                if (isComplete) {
                    quest.completed = true;
                    gameData.gold += quest.reward;
                    gameData.stats.questsCompleted++;
                    
                    // Move to completed quests
                    gameData.completedQuests.push(quest);
                    gameData.activeQuests = gameData.activeQuests.filter(q => q.id !== quest.id);
                    
                    // Add new quest if available
                    const nextQuest = gameData.quests.find(q => q.id === quest.id + 1);
                    if (nextQuest && !gameData.activeQuests.some(q => q.id === nextQuest.id) && 
                        !gameData.completedQuests.some(q => q.id === nextQuest.id)) {
                        gameData.activeQuests.push(nextQuest);
                    }
                    
                    showNotification(`Quest completed: ${quest.name}! +${quest.reward}g`);
                    updateStats();
                    checkAchievements();
                }
            });
            
            renderQuests();
            saveGame();
        }
        
        // Combat functions
        function updateCombatUI() {
            playerHealthElement.textContent = `${gameData.combatStats.playerHealth}/${gameData.combatStats.playerMaxHealth}`;
            playerAttackElement.textContent = gameData.combatStats.playerAttack;
            playerDefenseElement.textContent = gameData.combatStats.playerDefense;
            playerElementElement.textContent = gameData.combatStats.playerElement || "None";
            playerElementElement.className = gameData.combatStats.playerElement || "";
            
            if (gameData.combatStats.inCombat) {
                enemyHealthElement.textContent = `${gameData.combatStats.enemyHealth}/${gameData.combatStats.enemyMaxHealth}`;
                enemyAttackElement.textContent = gameData.combatStats.enemyAttack;
                enemyDefenseElement.textContent = gameData.combatStats.enemyDefense;
                enemyElementElement.textContent = gameData.combatStats.enemyElement || "None";
                enemyElementElement.className = gameData.combatStats.enemyElement || "";
                
                startCombatButton.disabled = true;
                attackButton.disabled = false;
                defendButton.disabled = false;
                useItemButton.disabled = false;
                specialAttackButton.disabled = gameData.combatStats.specialAttackCharges <= 0;
                
                // Update special attack button text
                specialAttackButton.textContent = `Special (${gameData.combatStats.specialAttackCharges})`;
            } else {
                enemyHealthElement.textContent = "0/0";
                enemyAttackElement.textContent = "0";
                enemyDefenseElement.textContent = "0";
                enemyElementElement.textContent = "None";
                enemyElementElement.className = "";
                
                startCombatButton.disabled = false;
                attackButton.disabled = true;
                defendButton.disabled = true;
                useItemButton.disabled = true;
                specialAttackButton.disabled = true;
            }
        }
        
        function startCombat() {
            if (gameData.combatStats.inCombat) return;
            
            // Select random enemy
            const enemy = {...gameData.enemies[Math.floor(Math.random() * gameData.enemies.length)]};
            gameData.combatStats.currentEnemy = enemy;
            gameData.combatStats.enemyHealth = enemy.health;
            gameData.combatStats.enemyMaxHealth = enemy.health;
            gameData.combatStats.enemyAttack = enemy.attack;
            gameData.combatStats.enemyDefense = enemy.defense;
            gameData.combatStats.enemyElement = enemy.element;
            gameData.combatStats.inCombat = true;
            
            // Reset player stats (could be modified by previous combat)
            gameData.combatStats.playerAttack = 10;
            gameData.combatStats.playerDefense = 5;
            gameData.combatStats.playerElement = null;
            gameData.combatStats.specialAttackCharges = 0;
            gameData.combatStats.statusEffects = { enemy: [], player: [] };
            
            // Apply deck bonuses if deck exists
            if (gameData.deck.length > 0) {
                gameData.deck.forEach(card => {
                    if (card.type === "weapon") {
                        gameData.combatStats.playerAttack += card.attack;
                        
                        // Set player element if weapon has one
                        if (card.element && !gameData.combatStats.playerElement) {
                            gameData.combatStats.playerElement = card.element;
                        }
                    } else if (card.type === "armor") {
                        gameData.combatStats.playerDefense += card.defense;
                    }
                });
                
                // Count special cards to determine special attack charges
                const specialCards = gameData.deck.filter(card => card.special);
                gameData.combatStats.specialAttackCharges = Math.min(3, Math.floor(specialCards.length / 5));
            }
            
            combatLogElement.innerHTML = '';
            addCombatMessage(`A wild ${enemy.name} appears!`, "system");
            updateCombatUI();
        }
        
        function playerAttack() {
            if (!gameData.combatStats.inCombat) return;
            
            let damage = Math.max(1, gameData.combatStats.playerAttack - gameData.combatStats.enemyDefense);
            
            // Apply elemental advantage if applicable
            if (gameData.combatStats.playerElement && gameData.combatStats.enemyElement) {
                const playerElement = gameData.combatStats.playerElement;
                const enemyElement = gameData.combatStats.enemyElement;
                
                if (gameData.elementAdvantages[playerElement].strongAgainst === enemyElement) {
                    damage = Math.floor(damage * 1.5);
                    addCombatMessage(`Your ${playerElement} attack is strong against ${enemyElement}!`, "player");
                } else if (gameData.elementAdvantages[playerElement].weakAgainst === enemyElement) {
                    damage = Math.floor(damage * 0.75);
                    addCombatMessage(`Your ${playerElement} attack is weak against ${enemyElement}!`, "player");
                }
            }
            
            // Apply status effects
            if (gameData.combatStats.statusEffects.enemy.includes("stun")) {
                damage = Math.floor(damage * 1.2);
                addCombatMessage("Enemy is stunned and takes extra damage!", "system");
            }
            
            gameData.combatStats.enemyHealth -= damage;
            
            // Add attack animation
            const playerStats = document.getElementById('player-stats');
            playerStats.classList.add('attack-animation');
            setTimeout(() => {
                playerStats.classList.remove('attack-animation');
                
                // Add damage animation to enemy
                const enemyStats = document.getElementById('enemy-stats');
                enemyStats.classList.add('damage-animation');
                setTimeout(() => enemyStats.classList.remove('damage-animation'), 300);
            }, 300);
            
            addCombatMessage(`You attack for ${damage} damage!`, "player");
            
            if (gameData.combatStats.enemyHealth <= 0) {
                enemyDefeated();
            } else {
                enemyTurn();
            }
            
            updateCombatUI();
        }
        
        function specialAttack() {
            if (!gameData.combatStats.inCombat || gameData.combatStats.specialAttackCharges <= 0) return;
            
            let damage = Math.max(1, Math.floor(gameData.combatStats.playerAttack * 1.5) - gameData.combatStats.enemyDefense);
            
            // Apply elemental advantage if applicable
            if (gameData.combatStats.playerElement && gameData.combatStats.enemyElement) {
                const playerElement = gameData.combatStats.playerElement;
                const enemyElement = gameData.combatStats.enemyElement;
                
                if (gameData.elementAdvantages[playerElement].strongAgainst === enemyElement) {
                    damage = Math.floor(damage * 1.5);
                    addCombatMessage(`Your ${playerElement} special attack is strong against ${enemyElement}!`, "player");
                } else if (gameData.elementAdvantages[playerElement].weakAgainst === enemyElement) {
                    damage = Math.floor(damage * 0.75);
                    addCombatMessage(`Your ${playerElement} special attack is weak against ${enemyElement}!`, "player");
                }
            }
            
            // Apply status effects
            if (gameData.combatStats.statusEffects.enemy.includes("stun")) {
                damage = Math.floor(damage * 1.3);
                addCombatMessage("Enemy is stunned and takes extra damage!", "system");
            }
            
            gameData.combatStats.enemyHealth -= damage;
            gameData.combatStats.specialAttackCharges--;
            
            // Add special effect based on element
            if (gameData.combatStats.playerElement) {
                switch (gameData.combatStats.playerElement) {
                    case "fire":
                        gameData.combatStats.statusEffects.enemy.push("burn");
                        addCombatMessage("Enemy is burning!", "system");
                        break;
                    case "water":
                        gameData.combatStats.statusEffects.enemy.push("freeze");
                        addCombatMessage("Enemy is frozen and will take extra damage next turn!", "system");
                        break;
                    case "earth":
                        gameData.combatStats.playerDefense += 2;
                        addCombatMessage("Your defense increased!", "system");
                        break;
                    case "air":
                        gameData.combatStats.statusEffects.enemy.push("stun");
                        addCombatMessage("Enemy is stunned!", "system");
                        break;
                    case "holy":
                        gameData.combatStats.playerHealth = Math.min(
                            gameData.combatStats.playerMaxHealth,
                            gameData.combatStats.playerHealth + 10
                        );
                        addCombatMessage("You healed 10 health!", "system");
                        break;
                    case "dark":
                        gameData.combatStats.enemyAttack = Math.max(1, gameData.combatStats.enemyAttack - 2);
                        addCombatMessage("Enemy attack decreased!", "system");
                        break;
                }
            }
            
            // Add attack animation
            const playerStats = document.getElementById('player-stats');
            playerStats.classList.add('attack-animation');
            setTimeout(() => {
                playerStats.classList.remove('attack-animation');
                
                // Add damage animation to enemy
                const enemyStats = document.getElementById('enemy-stats');
                enemyStats.classList.add('damage-animation');
                setTimeout(() => enemyStats.classList.remove('damage-animation'), 300);
            }, 300);
            
            addCombatMessage(`You unleash a special attack for ${damage} damage!`, "player");
            
            if (gameData.combatStats.enemyHealth <= 0) {
                enemyDefeated();
            } else {
                enemyTurn();
            }
            
            updateCombatUI();
        }
        
        function playerDefend() {
            if (!gameData.combatStats.inCombat) return;
            
            gameData.combatStats.playerDefense += 3;
            addCombatMessage("You brace for impact, increasing your defense!", "player");
            enemyTurn();
            updateCombatUI();
        }
        
        function useItem() {
            if (!gameData.combatStats.inCombat) return;
            
            // For now just heal - could expand to use actual items from inventory
            const healAmount = 20;
            gameData.combatStats.playerHealth = Math.min(
                gameData.combatStats.playerMaxHealth, 
                gameData.combatStats.playerHealth + healAmount
            );
            
            addCombatMessage(`You use a healing item and recover ${healAmount} health!`, "player");
            enemyTurn();
            updateCombatUI();
        }
        
        function enemyTurn() {
            if (!gameData.combatStats.inCombat) return;
            
            let damage = Math.max(1, gameData.combatStats.enemyAttack - gameData.combatStats.playerDefense);
            
            // Apply status effects
            if (gameData.combatStats.statusEffects.enemy.includes("freeze")) {
                damage = Math.floor(damage * 1.25);
                addCombatMessage("Enemy is frozen and takes extra damage!", "system");
                gameData.combatStats.statusEffects.enemy = gameData.combatStats.statusEffects.enemy.filter(e => e !== "freeze");
            }
            
            if (gameData.combatStats.statusEffects.enemy.includes("burn")) {
                const burnDamage = Math.floor(gameData.combatStats.enemyMaxHealth * 0.05);
                gameData.combatStats.enemyHealth -= burnDamage;
                addCombatMessage(`Enemy takes ${burnDamage} burn damage!`, "system");
            }
            
            if (gameData.combatStats.statusEffects.enemy.includes("stun")) {
                addCombatMessage("Enemy is stunned and can't attack!", "system");
                gameData.combatStats.statusEffects.enemy = gameData.combatStats.statusEffects.enemy.filter(e => e !== "stun");
                return;
            }
            
            gameData.combatStats.playerHealth -= damage;
            
            // Add attack animation
            const enemyStats = document.getElementById('enemy-stats');
            enemyStats.classList.add('attack-animation');
            setTimeout(() => {
                enemyStats.classList.remove('attack-animation');
                
                // Add damage animation to player
                const playerStats = document.getElementById('player-stats');
                playerStats.classList.add('damage-animation');
                setTimeout(() => playerStats.classList.remove('damage-animation'), 300);
            }, 300);
            
            addCombatMessage(`The ${gameData.combatStats.currentEnemy.name} attacks for ${damage} damage!`, "enemy");
            
            if (gameData.combatStats.playerHealth <= 0) {
                playerDefeated();
            }
            
            updateCombatUI();
        }
        
        function enemyDefeated() {
            const enemy = gameData.combatStats.currentEnemy;
            const reward = enemy.reward;
            
            gameData.gold += reward;
            gameData.totalGoldEarned += reward;
            gameData.stats.enemiesDefeated++;
            
            addCombatMessage(`You defeated the ${enemy.name} and earned ${reward} gold!`, "system");
            gameData.combatStats.inCombat = false;
            
            updateStats();
            checkAchievements();
            checkQuests();
            updateWeeklyChallengeProgress("defeat_enemies");
            saveGame();
        }
        
        function playerDefeated() {
            const enemy = gameData.combatStats.currentEnemy;
            
            addCombatMessage(`You were defeated by the ${enemy.name}!`, "system");
            gameData.combatStats.inCombat = false;
            
            // Reset player health
            gameData.combatStats.playerHealth = gameData.combatStats.playerMaxHealth;
            
            saveGame();
        }
        
        function addCombatMessage(message, type) {
            const messageElement = document.createElement('div');
            messageElement.className = `combat-message ${type}-message`;
            messageElement.textContent = message;
            combatLogElement.appendChild(messageElement);
            combatLogElement.scrollTop = combatLogElement.scrollHeight;
        }
        
        // Settings functions
        function loadSettings() {
            soundVolumeSlider.value = gameData.settings.soundVolume;
            musicVolumeSlider.value = gameData.settings.musicVolume;
            vibrationToggleButton.textContent = gameData.settings.vibration ? "Enabled" : "Disabled";
        }
        
        function updateSoundVolume() {
            gameData.settings.soundVolume = soundVolumeSlider.value;
            saveGame();
        }
        
        function updateMusicVolume() {
            gameData.settings.musicVolume = musicVolumeSlider.value;
            saveGame();
        }
        
        function toggleVibration() {
            gameData.settings.vibration = !gameData.settings.vibration;
            vibrationToggleButton.textContent = gameData.settings.vibration ? "Enabled" : "Disabled";
            saveGame();
        }
        
        function resetGame() {
            if (confirm("Are you sure you want to reset all game progress? This cannot be undone!")) {
                localStorage.removeItem('dndCardCollectorSave');
                location.reload();
            }
        }
        
        // Start the game
        initGame();
    </script>
</body>
</html>
