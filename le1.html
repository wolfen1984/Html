<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dracula's Last Rise - Level 1: Journey to the Tavern</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Dark Red/Black color scheme for Dracula theme */
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Source Code Pro', 'Courier New', monospace;
            background-color: #000;
            color: #fff;
            margin: 0;
            padding: 10px;
            line-height: 1.5;
            max-width: 100%;
            overflow-x: hidden;
            min-height: 100vh;
            background-image: 
                linear-gradient(rgba(80, 0, 0, 0.15) 1px, transparent 1px),
                linear-gradient(90deg, rgba(80, 0, 0, 0.15) 1px, transparent 1px);
            background-size: 30px 30px;
        }
        
        .container {
            max-width: 700px;
            margin: 0 auto;
            padding: 15px;
            border: 3px solid #8b0000;
            background-color: #000;
            box-shadow: 0 0 30px rgba(139, 0, 0, 0.5);
            position: relative;
            min-height: calc(100vh - 40px);
            overflow: hidden;
        }
        
        /* Scanline effect for authentic CRT monitor feel */
        .container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                transparent 50%,
                rgba(80, 0, 0, 0.1) 50%
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 2;
        }
        
        .header {
            text-align: center;
            border-bottom: 2px dashed #8b0000;
            padding-bottom: 15px;
            margin-bottom: 20px;
            position: relative;
        }
        
        h1 {
            font-family: 'Press Start 2P', 'Courier New', monospace;
            color: #8b0000;
            text-shadow: 0 0 8px #8b0000;
            font-size: 32px;
            margin: 10px 0;
            letter-spacing: 2px;
            text-transform: uppercase;
            font-weight: normal;
        }
        
        h2 {
            font-family: 'Press Start 2P', 'Courier New', monospace;
            color: #fff;
            border-bottom: 1px solid #8b0000;
            padding-bottom: 5px;
            margin-top: 25px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 20px;
            font-weight: normal;
        }
        
        .screen {
            display: none;
            position: relative;
            z-index: 1;
        }
        
        .active-screen {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Level Progress Indicator */
        .level-progress {
            display: flex;
            justify-content: space-between;
            background-color: #111;
            border: 1px solid #8b0000;
            padding: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .level-number {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #333;
            font-weight: bold;
            color: #888;
            background-color: #222;
            font-family: 'Press Start 2P', 'Courier New', monospace;
            font-size: 12px;
        }
        
        .level-number.current {
            background-color: #8b0000;
            color: #000;
            border-color: #8b0000;
            box-shadow: 0 0 12px #8b0000;
            text-shadow: 0 0 2px #000;
            font-weight: bold;
        }
        
        /* Stats Bar */
        .stats-bar {
            background-color: #111;
            border: 1px solid #8b0000;
            padding: 10px;
            margin: 15px 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            font-size: 14px;
        }
        
        .stat-item {
            margin: 5px 10px;
        }
        
        .stat-label {
            color: #fff;
        }
        
        .stat-value {
            color: #8b0000;
            font-weight: bold;
            font-size: 16px;
        }
        
        /* Inventory */
        .inventory-container {
            background-color: #111;
            border: 1px solid #8b0000;
            padding: 10px;
            margin: 15px 0;
        }
        
        .inventory-title {
            color: #8b0000;
            margin-bottom: 10px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'Press Start 2P', 'Courier New', monospace;
            font-size: 14px;
        }
        
        .inventory {
            min-height: 60px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .inventory-item {
            display: inline-block;
            background-color: #222;
            border: 1px solid #8b0000;
            padding: 8px 12px;
            color: #fff;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .inventory-item:hover {
            background-color: #333;
            border-color: #ff4d4d;
            transform: translateY(-2px);
        }
        
        .inventory-item.equipped::after {
            content: "E";
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #8b0000;
            color: #000;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-family: 'Press Start 2P', 'Courier New', monospace;
        }
        
        /* Story Text Area */
        .story-text {
            background-color: #000;
            border: 1px solid #8b0000;
            padding: 15px;
            margin: 20px 0;
            min-height: 200px;
            overflow-y: auto;
            max-height: 350px;
            font-size: 16px;
            line-height: 1.6;
            color: #fff;
        }
        
        /* Choice Buttons */
        .choice-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        
        .choice-btn {
            background-color: #222;
            color: #fff;
            border: 2px solid #8b0000;
            padding: 15px;
            font-family: 'Source Code Pro', 'Courier New', monospace;
            font-size: 16px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .choice-btn:hover, .choice-btn:active {
            background-color: #333;
            color: #ff4d4d;
            border-color: #ff4d4d;
            box-shadow: 0 0 10px rgba(255, 77, 77, 0.3);
        }
        
        .choice-btn::after {
            content: ">";
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #8b0000;
            font-weight: bold;
        }
        
        .choice-btn:hover::after {
            color: #ff4d4d;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-top: 20px;
            gap: 10px;
        }
        
        .action-btn {
            background-color: #222;
            color: #fff;
            border: 2px solid #8b0000;
            padding: 10px 15px;
            font-family: 'Source Code Pro', 'Courier New', monospace;
            font-size: 14px;
            cursor: pointer;
            flex-grow: 1;
            text-align: center;
            transition: all 0.2s;
        }
        
        .action-btn:hover, .action-btn:active {
            background-color: #333;
            color: #ff4d4d;
            border-color: #ff4d4d;
        }
        
        /* Dice Roll Display */
        .dice-roll {
            background-color: #330000;
            border: 1px solid #8b0000;
            padding: 10px;
            margin: 10px 0;
            text-align: center;
            color: #8b0000;
            font-weight: bold;
        }
        
        /* Combat Display */
        .combat-log {
            background-color: #550000;
            border: 1px solid #ff0000;
            padding: 10px;
            margin: 10px 0;
            color: #8b0000;
            font-weight: bold;
        }
        
        /* Special Text Styles */
        .game-over {
            color: #f66;
            font-weight: bold;
            text-align: center;
            font-size: 24px;
            margin: 20px;
            text-shadow: 0 0 5px #f66;
            font-family: 'Press Start 2P', 'Courier New', monospace;
        }
        
        .victory {
            color: #8b0000;
            font-weight: bold;
            text-align: center;
            font-size: 24px;
            margin: 20px;
            text-shadow: 0 0 8px #8b0000;
            font-family: 'Press Start 2P', 'Courier New', monospace;
        }
        
        .success {
            color: #6f6;
            font-weight: bold;
        }
        
        .damage {
            color: #f66;
            font-weight: bold;
        }
        
        .enemy {
            color: #fa6;
            font-weight: bold;
        }
        
        .gold {
            color: #ffd700;
            font-weight: bold;
        }
        
        .item {
            color: #8ff;
            font-weight: bold;
        }
        
        .vampire {
            color: #f66;
            font-weight: bold;
            text-shadow: 0 0 3px #f66;
        }
        
        .npc {
            color: #6f9;
            font-weight: bold;
        }
        
        .tavern {
            color: #ff9900;
            font-weight: bold;
        }
        
        .werewolf {
            color: #fa6;
            font-weight: bold;
        }
        
        .ghoul {
            color: #8f8;
            font-weight: bold;
        }
        
        .peasant {
            color: #9cf;
            font-weight: bold;
        }
        
        .merchant {
            color: #ffd700;
            font-weight: bold;
        }
        
        /* Level Complete Screen */
        .level-complete {
            text-align: center;
            margin-top: 20px;
            padding: 20px;
        }
        
        .next-level-btn {
            background-color: #222;
            color: #fff;
            border: 3px solid #8b0000;
            padding: 15px 30px;
            font-family: 'Press Start 2P', 'Courier New', monospace;
            fontSize: 16px;
            cursor: pointer;
            font-weight: normal;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .next-level-btn:hover, .next-level-btn:active {
            background-color: #8b0000;
            color: #000;
            border-color: #ff4d4d;
            box-shadow: 0 0 20px #8b0000;
        }
        
        /* Blood Animation */
        .blood-animation {
            text-align: center;
            margin: 15px 0;
            padding: 15px;
            background-color: #330000;
            border: 1px solid #ff0040;
            animation: pulse-red 2s infinite;
        }
        
        @keyframes pulse-red {
            0% { border-color: #ff0040; }
            50% { border-color: #ff6666; }
            100% { border-color: #ff0040; }
        }
        
        /* Footer */
        .footer {
            text-align: center;
            color: #888;
            font-size: 12px;
            margin-top: 20px;
            border-top: 1px solid #333;
            padding-top: 10px;
            font-family: 'Source Code Pro', 'Courier New', monospace;
        }
        
        /* Blinking cursor effect */
        .blinking-cursor {
            display: inline-block;
            width: 10px;
            height: 20px;
            background-color: #8b0000;
            vertical-align: middle;
            margin-left: 5px;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        /* Sound Toggle */
        .sound-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #111;
            border: 1px solid #8b0000;
            color: #fff;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
            z-index: 10;
            font-family: 'Source Code Pro', 'Courier New', monospace;
        }
        
        .sound-toggle:hover {
            background: #222;
            color: #ff4d4d;
        }
        
        /* Character Creation */
        .character-class {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        
        .class-btn {
            background-color: #222;
            color: #fff;
            border: 2px solid #8b0000;
            padding: 15px;
            font-family: 'Source Code Pro', 'Courier New', monospace;
            font-size: 16px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
        }
        
        .class-btn:hover {
            background-color: #333;
            color: #ff4d4d;
            border-color: #ff4d4d;
        }
        
        .class-stats {
            background-color: #111;
            border: 1px solid #8b0000;
            padding: 10px;
            margin: 10px 0;
            font-size: 14px;
        }
        
        /* Responsive Design */
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            h2 {
                font-size: 16px;
            }
            
            .stats-bar {
                font-size: 12px;
            }
            
            .choice-btn {
                padding: 12px;
                font-size: 14px;
            }
            
            .level-number {
                width: 25px;
                height: 25px;
                font-size: 10px;
            }
            
            .inventory-title {
                font-size: 12px;
            }
            
            .next-level-btn {
                font-size: 14px;
                padding: 12px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sound Toggle -->
        <div class="sound-toggle" onclick="toggleSound()">
            SOUND: <span id="sound-status">ON</span>
        </div>
        
        <div class="header">
            <h1>DRACULA'S LAST RISE</h1>
            <h2>LEVEL 1: JOURNEY TO THE TAVERN</h2>
        </div>
        
        <!-- Level Progress Indicator -->
        <div class="level-progress">
            <div class="level-number current">1</div>
            <div class="level-number">2</div>
            <div class="level-number">3</div>
            <div class="level-number">4</div>
            <div class="level-number">5</div>
            <div class="level-number">6</div>
            <div class="level-number">7</div>
            <div class="level-number">8</div>
            <div class="level-number">9</div>
            <div class="level-number">10</div>
        </div>
        
        <!-- Character Creation Screen -->
        <div id="screen-character" class="screen active-screen">
            <h2>CHOOSE YOUR HERO</h2>
            <div class="story-text">
                <p>Darkness has fallen upon the land. Villagers whisper of strange disappearances, of wolves with glowing red eyes, and of an ancient evil stirring in the mountains.</p>
                <p>You have come to Transylvania seeking answers. The locals speak of a tavern where information can be found, but the journey is dangerous. Choose your path wisely.</p>
                
                <div class="character-class">
                    <button class="class-btn" onclick="selectClass('hunter')">
                        <strong>VAMPIRE HUNTER</strong><br>
                        <small>Skilled in tracking and slaying the undead. Starts with silver weapons.</small>
                    </button>
                    
                    <button class="class-btn" onclick="selectClass('warrior')">
                        <strong>MERCENARY WARRIOR</strong><br>
                        <small>A seasoned fighter with strength and resilience. Starts with better armor.</small>
                    </button>
                    
                    <button class="class-btn" onclick="selectClass('scholar')">
                        <strong>OCCULT SCHOLAR</strong><br>
                        <small>Knowledgeable about dark arts and weaknesses. Starts with protective charms.</small>
                    </button>
                    
                    <button class="class-btn" onclick="selectClass('rogue')">
                        <strong>ROGUE SCOUT</strong><br>
                        <small>Quick and stealthy. Good at avoiding danger and finding hidden paths.</small>
                    </button>
                </div>
                
                <div class="class-stats" id="class-stats-display">
                    Select a class to see starting stats...
                </div>
            </div>
        </div>
        
        <!-- Game Screen -->
        <div id="screen-game" class="screen">
            <div class="stats-bar">
                <div class="stat-item"><span class="stat-label">STRENGTH:</span> <span id="stat-strength" class="stat-value">0</span></div>
                <div class="stat-item"><span class="stat-label">HEALTH:</span> <span id="stat-health" class="stat-value">0</span>/<span id="stat-maxhealth" class="stat-value">0</span></div>
                <div class="stat-item"><span class="stat-label">AGILITY:</span> <span id="stat-agility" class="stat-value">0</span></div>
                <div class="stat-item"><span class="stat-label">GOLD:</span> <span id="stat-gold" class="stat-value">0</span></div>
            </div>
            
            <div class="inventory-container">
                <div class="inventory-title">
                    <span>INVENTORY</span>
                    <span id="inventory-count">ITEMS: 0/10</span>
                </div>
                <div class="inventory" id="inventory">
                    <!-- Inventory items will be added here -->
                </div>
            </div>
            
            <h2>JOURNEY TO THE TAVERN</h2>
            <div class="story-text" id="story-text">
                <!-- Story content will be inserted here -->
            </div>
            
            <div class="choice-buttons" id="choice-buttons">
                <!-- Choice buttons will be inserted here -->
            </div>
            
            <div class="action-buttons">
                <button class="action-btn" onclick="useAgility()">USE AGILITY</button>
                <button class="action-btn" onclick="useItem()">USE ITEM</button>
                <button class="action-btn" onclick="saveGame()">SAVE GAME</button>
                <button class="action-btn" onclick="loadGame()">LOAD GAME</button>
            </div>
        </div>
        
        <!-- Level Complete Screen -->
        <div id="screen-complete" class="screen">
            <h2>LEVEL COMPLETE!</h2>
            <div class="story-text">
                <p class="victory">YOU REACHED THE BLACK RAVEN TAVERN!</p>
                <div class="blood-animation">
                    <p>After your perilous journey, you finally arrive at the tavern. The warm glow from its windows promises safety and information.</p>
                    <p>But this is only the beginning. From here, you must enter the dark woodlands where the true danger lies...</p>
                </div>
                
                <div class="stats-bar">
                    <div class="stat-item"><span class="stat-label">STRENGTH:</span> <span id="complete-stat-strength" class="stat-value">0</span></div>
                    <div class="stat-item"><span class="stat-label">HEALTH:</span> <span id="complete-stat-health" class="stat-value">0</span>/<span id="complete-stat-maxhealth" class="stat-value">0</span></div>
                    <div class="stat-item"><span class="stat-label">AGILITY:</span> <span id="complete-stat-agility" class="stat-value">0</span></div>
                    <div class="stat-item"><span class="stat-label">GOLD:</span> <span id="complete-stat-gold" class="stat-value">0</span></div>
                </div>
                
                <div style="margin-top: 15px; padding: 10px; background-color: #330000; border: 1px solid #8b0000;">
                    <h3 style="color: #8b0000; margin-top: 0;">INVENTORY:</h3>
                    <div id="complete-inventory-display"></div>
                </div>
            </div>
            
            <div class="level-complete">
                <button class="next-level-btn" onclick="goToNextLevel()">CONTINUE TO LEVEL 2: ENTERING THE WOODLANDS</button>
            </div>
        </div>
        
        <div class="footer">
            DRACULA'S LAST RISE - A Gothic Horror Adventure<br>
            Level 1: Journey to the Tavern
        </div>
    </div>

    <script>
        // Sound System
        let soundEnabled = true;
        let audioContext;
        
        // Simple beep generator using Web Audio API
        function playBeep(frequency, duration, type = 'square') {
            if (!soundEnabled) return;
            
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = type;
                
                // Volume envelope
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            } catch (e) {
                console.log("Web Audio not supported:", e);
            }
        }
        
        // Sound effects for Dracula theme
        function playSound(type) {
            if (!soundEnabled) return;
            
            switch(type) {
                case 'click':
                    playBeep(800, 0.1, 'square');
                    break;
                case 'roll':
                    playBeep(400, 0.05, 'sine');
                    setTimeout(() => playBeep(600, 0.05, 'sine'), 50);
                    setTimeout(() => playBeep(300, 0.1, 'sine'), 100);
                    break;
                case 'combat':
                    playBeep(1200, 0.05, 'sawtooth');
                    break;
                case 'item':
                    playBeep(600, 0.2, 'triangle');
                    break;
                case 'success':
                    playBeep(1000, 0.15, 'sine');
                    setTimeout(() => playBeep(1200, 0.15, 'sine'), 150);
                    break;
                case 'failure':
                    playBeep(300, 0.3, 'sawtooth');
                    break;
                case 'damage':
                    playBeep(200, 0.2, 'square');
                    break;
                case 'levelup':
                    playBeep(500, 0.1, 'sine');
                    setTimeout(() => playBeep(700, 0.1, 'sine'), 100);
                    setTimeout(() => playBeep(900, 0.2, 'sine'), 200);
                    break;
                case 'vampire':
                    playBeep(150, 0.5, 'sawtooth');
                    break;
                case 'werewolf':
                    playBeep(80, 0.4, 'square');
                    setTimeout(() => playBeep(60, 0.4, 'square'), 400);
                    break;
                case 'wolf':
                    playBeep(200, 0.3, 'sawtooth');
                    setTimeout(() => playBeep(180, 0.3, 'sawtooth'), 300);
                    break;
                case 'ghoul':
                    playBeep(300, 0.8, 'sine');
                    setTimeout(() => playBeep(250, 0.6, 'sine'), 800);
                    break;
                case 'gold':
                    playBeep(1000, 0.1, 'sine');
                    for(let i = 0; i < 5; i++) {
                        setTimeout(() => playBeep(800 + i*100, 0.1, 'sine'), 100 + i*100);
                    }
                    break;
                case 'tavern':
                    playBeep(600, 0.2, 'triangle');
                    setTimeout(() => playBeep(700, 0.2, 'triangle'), 200);
                    setTimeout(() => playBeep(500, 0.3, 'triangle'), 400);
                    break;
            }
        }
        
        // Toggle sound on/off
        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('sound-status').textContent = soundEnabled ? 'ON' : 'OFF';
            
            if (soundEnabled) {
                playSound('click');
            }
        }
        
        // Game state object
        const gameState = {
            playerClass: '',
            strength: 0,
            maxHealth: 0,
            health: 0,
            agility: 0,
            gold: 0,
            inventory: [],
            equippedWeapon: 'None',
            equippedArmor: 'None',
            currentSection: 1,
            levelComplete: false,
            level: 1,
            // Level 1 specific flags
            pathTaken: '',
            merchantMet: false,
            wolfEncountered: false,
            ghoulEncountered: false,
            helpedPeasant: false,
            foundHiddenPath: false,
            tavernReached: false
        };
        
        // Combat state
        let combatState = {
            active: false,
            enemyName: '',
            enemyHealth: 0,
            enemyCurrentHealth: 0,
            enemyStrength: 0,
            enemyDamageDice: 1,
            enemyDamageSides: 6,
            nextSection: 0,
            round: 1,
            isGroup: false,
            groupCount: 0
        };
        
        // Character classes with starting stats and items
        const characterClasses = {
            hunter: {
                name: "Vampire Hunter",
                strength: 14,
                maxHealth: 30,
                health: 30,
                agility: 16,
                gold: 20,
                inventory: ['Silver Dagger', 'Holy Symbol', 'Garlic'],
                equippedWeapon: 'Silver Dagger',
                equippedArmor: 'Leather Armor',
                description: "Trained in hunting the undead. Your silver weapons are effective against supernatural creatures."
            },
            warrior: {
                name: "Mercenary Warrior",
                strength: 18,
                maxHealth: 40,
                health: 40,
                agility: 10,
                gold: 30,
                inventory: ['Iron Sword', 'Healing Potion'],
                equippedWeapon: 'Iron Sword',
                equippedArmor: 'Chainmail',
                description: "A powerful fighter with high strength and health. Your combat skills are unmatched."
            },
            scholar: {
                name: "Occult Scholar",
                strength: 10,
                maxHealth: 25,
                health: 25,
                agility: 12,
                gold: 50,
                inventory: ['Ancient Tome', 'Protective Charm', 'Healing Potion', 'Garlic'],
                equippedWeapon: 'Walking Staff',
                equippedArmor: 'Scholar Robes',
                description: "Knowledgeable about dark creatures. Your items provide protection and information."
            },
            rogue: {
                name: "Rogue Scout",
                strength: 12,
                maxHealth: 28,
                health: 28,
                agility: 18,
                gold: 40,
                inventory: ['Dagger', 'Lockpicks', 'Smoke Bomb'],
                equippedWeapon: 'Dagger',
                equippedArmor: 'Leather Armor',
                description: "Quick and stealthy. Your agility helps avoid dangers and find hidden paths."
            }
        };
        
        // Display class stats when hovering/selecting
        function selectClass(className) {
            playSound('click');
            const classInfo = characterClasses[className];
            
            document.getElementById('class-stats-display').innerHTML = `
                <strong>${classInfo.name}</strong><br>
                <strong>Strength:</strong> ${classInfo.strength}<br>
                <strong>Health:</strong> ${classInfo.health}/${classInfo.maxHealth}<br>
                <strong>Agility:</strong> ${classInfo.agility}<br>
                <strong>Gold:</strong> ${classInfo.gold}<br>
                <strong>Starting Items:</strong> ${classInfo.inventory.join(', ')}<br>
                <strong>Description:</strong> ${classInfo.description}<br><br>
                <button class="choice-btn" onclick="confirmClass('${className}')">SELECT THIS CLASS</button>
            `;
        }
        
        // Confirm class selection
        function confirmClass(className) {
            playSound('click');
            const classInfo = characterClasses[className];
            
            // Set game state from selected class
            gameState.playerClass = className;
            gameState.strength = classInfo.strength;
            gameState.maxHealth = classInfo.maxHealth;
            gameState.health = classInfo.health;
            gameState.agility = classInfo.agility;
            gameState.gold = classInfo.gold;
            gameState.inventory = [...classInfo.inventory];
            gameState.equippedWeapon = classInfo.equippedWeapon;
            gameState.equippedArmor = classInfo.equippedArmor;
            
            // Start the game
            startGame();
        }
        
        function startGame() {
            playSound('levelup');
            updateStatsDisplay();
            updateInventoryDisplay();
            showScreen('screen-game');
            loadSection(1);
        }
        
        // Show specific screen
        function showScreen(screenId) {
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => {
                screen.classList.remove('active-screen');
            });
            document.getElementById(screenId).classList.add('active-screen');
        }
        
        // Update stats display
        function updateStatsDisplay() {
            document.getElementById('stat-strength').textContent = gameState.strength;
            document.getElementById('stat-health').textContent = gameState.health;
            document.getElementById('stat-maxhealth').textContent = gameState.maxHealth;
            document.getElementById('stat-agility').textContent = gameState.agility;
            document.getElementById('stat-gold').textContent = gameState.gold;
        }
        
        // Add item to inventory
        function addToInventory(item) {
            if (!gameState.inventory.includes(item) && item !== gameState.equippedWeapon && item !== gameState.equippedArmor) {
                if (gameState.inventory.length < 8) { // 10 total - 2 equipped
                    gameState.inventory.push(item);
                    updateInventoryDisplay();
                    return true;
                } else {
                    return false; // Inventory full
                }
            }
            return true;
        }
        
        // Remove item from inventory
        function removeFromInventory(item) {
            const index = gameState.inventory.indexOf(item);
            if (index !== -1) {
                gameState.inventory.splice(index, 1);
                updateInventoryDisplay();
            }
        }
        
        // Update inventory display
        function updateInventoryDisplay() {
            const inventoryDiv = document.getElementById('inventory');
            inventoryDiv.innerHTML = '';
            
            // Add equipped weapon and armor first
            if (gameState.equippedWeapon !== 'None') {
                const equippedWeapon = document.createElement('div');
                equippedWeapon.className = 'inventory-item equipped';
                equippedWeapon.textContent = gameState.equippedWeapon;
                equippedWeapon.onclick = () => {
                    playSound('click');
                    document.getElementById('story-text').innerHTML += 
                        `<div class="dice-roll">Currently equipped: <span class='item'>${gameState.equippedWeapon}</span></div>`;
                };
                inventoryDiv.appendChild(equippedWeapon);
            }
            
            if (gameState.equippedArmor !== 'None') {
                const equippedArmor = document.createElement('div');
                equippedArmor.className = 'inventory-item equipped';
                equippedArmor.textContent = gameState.equippedArmor;
                equippedArmor.onclick = () => {
                    playSound('click');
                    document.getElementById('story-text').innerHTML += 
                        `<div class="dice-roll">Currently equipped: <span class='item'>${gameState.equippedArmor}</span></div>`;
                };
                inventoryDiv.appendChild(equippedArmor);
            }
            
            // Add other inventory items
            gameState.inventory.forEach(item => {
                // Skip if it's the equipped weapon or armor
                if (item !== gameState.equippedWeapon && item !== gameState.equippedArmor) {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'inventory-item';
                    itemElement.textContent = item;
                    itemElement.onclick = () => {
                        useInventoryItem(item);
                    };
                    inventoryDiv.appendChild(itemElement);
                }
            });
            
            // Update inventory count
            const equippedCount = (gameState.equippedWeapon !== 'None' ? 1 : 0) + (gameState.equippedArmor !== 'None' ? 1 : 0);
            const totalItems = gameState.inventory.length + equippedCount;
            document.getElementById('inventory-count').textContent = `ITEMS: ${totalItems}/10`;
        }
        
        // Use inventory item
        function useInventoryItem(item) {
            playSound('click');
            let message = "";
            let effectApplied = false;
            
            if (item === 'Healing Potion' || item === 'Mountain Herbs' || item === 'Tavern Ale') {
                const healAmount = item === 'Mountain Herbs' ? rollDice(2, 6) + 5 : 
                                 item === 'Tavern Ale' ? rollDice(1, 6) + 3 : rollDice(2, 6);
                const oldHealth = gameState.health;
                gameState.health = Math.min(gameState.maxHealth, gameState.health + healAmount);
                const actualHeal = gameState.health - oldHealth;
                removeFromInventory(item);
                playSound('item');
                message = `You use the <span class='item'>${item}</span> and restore ${actualHeal} Health!`;
                updateStatsDisplay();
                effectApplied = true;
            } else if (item === 'Silver Dagger' || item === 'Iron Sword' || item === 'Walking Staff' || item === 'Dagger') {
                gameState.equippedWeapon = item;
                updateInventoryDisplay();
                message = `You equip the <span class='item'>${item}</span>.`;
                effectApplied = true;
            } else if (item === 'Leather Armor' || item === 'Chainmail' || item === 'Scholar Robes') {
                gameState.equippedArmor = item;
                updateInventoryDisplay();
                message = `You wear the <span class='item'>${item}</span>.`;
                effectApplied = true;
            } else if (item === 'Holy Symbol') {
                message = "The <span class='item'>Holy Symbol</span> glows faintly. It may protect against evil.";
            } else if (item === 'Garlic') {
                message = "The <span class='item'>Garlic</span> has a strong smell. Vampires are said to dislike it.";
            } else if (item === 'Ancient Tome') {
                message = "The <span class='item'>Ancient Tome</span> contains knowledge of supernatural creatures.";
            } else if (item === 'Protective Charm') {
                message = "The <span class='item'>Protective Charm</span> feels warm. It may offer some protection.";
            } else if (item === 'Lockpicks') {
                message = "The <span class='item'>Lockpicks</span> could be useful for opening locked doors or chests.";
            } else if (item === 'Smoke Bomb') {
                if (combatState.active) {
                    removeFromInventory(item);
                    playSound('item');
                    message = `You use the <span class='item'>Smoke Bomb</span> to escape from combat!`;
                    combatState.active = false;
                    // Return to previous section or specific section
                    loadSection(combatState.escapeSection || 1);
                    effectApplied = true;
                } else {
                    message = "The <span class='item'>Smoke Bomb</span> could help you escape from dangerous situations.";
                }
            } else if (item === 'Wolfsbane') {
                if (combatState.active && combatState.enemyName.includes('Wolf')) {
                    const damage = rollDice(3, 6) + 10;
                    combatState.enemyCurrentHealth -= damage;
                    removeFromInventory(item);
                    playSound('combat');
                    message = `You use <span class='item'>Wolfsbane</span> on the ${combatState.enemyName}! It deals ${damage} damage!`;
                    effectApplied = true;
                } else {
                    message = "<span class='item'>Wolfsbane</span> is toxic to wolves and werewolves.";
                }
            } else {
                message = `You examine the <span class='item'>${item}</span>.`;
            }
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${message}</div>`;
            
            // If in combat and used a damaging item, continue combat
            if (effectApplied && combatState.active && (item === 'Wolfsbane')) {
                // Check if enemy defeated
                if (combatState.enemyCurrentHealth <= 0) {
                    endCombatVictory();
                } else {
                    // Enemy still alive, their turn
                    setTimeout(() => {
                        enemyAttack();
                    }, 1500);
                }
            }
        }
        
        // Use item from action button
        function useItem() {
            playSound('click');
            if (gameState.inventory.length === 0 && 
                gameState.equippedWeapon === 'None' && 
                gameState.equippedArmor === 'None') {
                document.getElementById('story-text').innerHTML += 
                    `<div class="dice-roll">You have no usable items in your inventory.</div>`;
                return;
            }
            
            let itemText = "<div class='dice-roll'><strong>Select an item to use:</strong><br>";
            
            // Show equipped items
            if (gameState.equippedWeapon !== 'None' || gameState.equippedArmor !== 'None') {
                itemText += `<br><strong>Equipped:</strong><br>`;
                if (gameState.equippedWeapon !== 'None') {
                    itemText += `<button onclick="useInventoryItem('${gameState.equippedWeapon}')" class="action-btn" style="margin: 5px;">${gameState.equippedWeapon}</button> `;
                }
                if (gameState.equippedArmor !== 'None') {
                    itemText += `<button onclick="useInventoryItem('${gameState.equippedArmor}')" class="action-btn" style="margin: 5px;">${gameState.equippedArmor}</button>`;
                }
            }
            
            // Show inventory items
            const usableItems = gameState.inventory.filter(item => 
                item !== gameState.equippedWeapon && item !== gameState.equippedArmor);
            
            if (usableItems.length > 0) {
                itemText += `<br><br><strong>Inventory:</strong><br>`;
                usableItems.forEach(item => {
                    itemText += `<button onclick="useInventoryItem('${item}')" class="action-btn" style="margin: 5px;">${item}</button> `;
                });
            }
            
            itemText += `<br><br><button onclick="document.getElementById('story-text').innerHTML += '<div class=dice-roll>Item use cancelled.</div>'" class="action-btn">Cancel</button>`;
            itemText += "</div>";
            
            document.getElementById('story-text').innerHTML += itemText;
        }
        
        // Game story sections for Level 1
        const storySections = {
            1: {
                text: "You stand at the edge of a Transylvanian village as dusk falls. The Black Raven Tavern lies three miles through the dark forest. Villagers hurry inside their homes, casting fearful glances toward the woods. The air grows cold, and a fog begins to roll in from the mountains.",
                choices: [
                    {text: "Take the main road (fastest but most exposed)", nextSection: 2, skillCheck: false},
                    {text: "Take the forest path (hidden but dangerous)", nextSection: 3, skillCheck: false},
                    {text: "Check your equipment before leaving", nextSection: 4, skillCheck: false},
                    {text: "Ask a villager for advice", nextSection: 5, skillCheck: false}
                ],
                action: function() {
                    playSound('click');
                    return "Night is falling quickly. You need to reach the tavern before the creatures of the night emerge.";
                }
            },
            2: {
                text: "You take the main road. The moonlight barely penetrates the thick fog. In the distance, you hear the howl of a wolf. The road is deserted, but you see a broken cart ahead with supplies scattered around it.",
                choices: [
                    {text: "Investigate the broken cart", nextSection: 6, skillCheck: false},
                    {text: "Ignore it and continue quickly", nextSection: 7, skillCheck: false},
                    {text: "Hide and watch for danger", nextSection: 8, skillCheck: true, checkType: 'agility', difficulty: 14},
                    {text: "Return and take the forest path instead", nextSection: 3, skillCheck: false}
                ],
                action: function() {
                    gameState.pathTaken = 'main road';
                    playSound('wolf');
                    return "The howling grows closer. Something is out there...";
                }
            },
            3: {
                text: "You slip into the dark forest. The trees are dense, blocking most of the moonlight. Strange sounds echo through the woods. You come to a fork in the path.",
                choices: [
                    {text: "Take the left path (looks more traveled)", nextSection: 9, skillCheck: false},
                    {text: "Take the right path (overgrown but quiet)", nextSection: 10, skillCheck: false},
                    {text: "Try to find a hidden trail", nextSection: 11, skillCheck: true, checkType: 'agility', difficulty: 16},
                    {text: "Return to the main road", nextSection: 2, skillCheck: false}
                ],
                action: function() {
                    gameState.pathTaken = 'forest path';
                    return "The forest feels alive with unseen eyes watching you.";
                }
            },
            4: {
                text: "You check your equipment. Everything seems in order. The night grows darker, and you must decide your path.",
                choices: [
                    {text: "Take the main road", nextSection: 2, skillCheck: false},
                    {text: "Take the forest path", nextSection: 3, skillCheck: false}
                ],
                action: function() {
                    updateInventoryDisplay();
                    return "Your inventory is ready. Choose your path wisely.";
                }
            },
            5: {
                text: "You approach an old villager hurrying inside his home. 'The tavern? You're mad to go there at night! But if you must... avoid the main road. Something took my neighbor there just last night.' He hands you a small pouch before slamming his door.",
                choices: [
                    {text: "Take the forest path (as suggested)", nextSection: 3, skillCheck: false},
                    {text: "Risk the main road anyway", nextSection: 2, skillCheck: false},
                    {text: "Open the pouch", nextSection: 12, skillCheck: false}
                ],
                action: function() {
                    const goldFound = rollDice(1, 10);
                    gameState.gold += goldFound;
                    updateStatsDisplay();
                    playSound('gold');
                    return `The villager gave you <span class='gold'>${goldFound} Gold</span> and warning.`;
                }
            },
            6: {
                text: "You approach the broken cart. Supplies are scattered everywhere - food, tools, and a locked chest. Suddenly, two glowing eyes appear from behind the cart! A large wolf emerges, growling hungrily.",
                choices: [
                    {text: "Fight the wolf", nextSection: 13, skillCheck: false},
                    {text: "Try to scare it away with fire", nextSection: 14, skillCheck: false},
                    {text: "Use Wolfsbane if you have it", nextSection: 15, skillCheck: false, requirement: function() { 
                        return gameState.inventory.includes('Wolfsbane');
                    }},
                    {text: "Run back toward the village", nextSection: 16, skillCheck: true, checkType: 'agility', difficulty: 15}
                ],
                action: function() {
                    gameState.wolfEncountered = true;
                    playSound('wolf');
                    return "<span class='enemy'>Hungry Wolf</span> blocks your path, saliva dripping from its fangs!";
                }
            },
            7: {
                text: "You hurry past the broken cart, trying to make as little noise as possible. As you pass, you notice something shiny among the debris.",
                choices: [
                    {text: "Stop to grab the shiny object", nextSection: 17, skillCheck: true, checkType: 'agility', difficulty: 13},
                    {text: "Keep moving, it's not worth the risk", nextSection: 18, skillCheck: false}
                ],
                action: function() {
                    return "The howling seems to be getting closer. You need to move quickly.";
                }
            },
            8: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 19, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        gameState.foundHiddenPath = true;
                        return "You spot a hidden side path that bypasses the dangerous area completely!";
                    } else {
                        playSound('failure');
                        const damage = rollDice(1, 6);
                        gameState.health -= damage;
                        updateStatsDisplay();
                        return "You trip while trying to hide, making noise and scraping your leg for " + damage + " damage!";
                    }
                }
            },
            9: {
                text: "The left path is more traveled but eerily quiet. You notice strange symbols carved into some trees. Ahead, you see a hunched figure digging near a grave.",
                choices: [
                    {text: "Approach the figure cautiously", nextSection: 20, skillCheck: false},
                    {text: "Sneak past quietly", nextSection: 21, skillCheck: true, checkType: 'agility', difficulty: 16},
                    {text: "Return and take the right path", nextSection: 10, skillCheck: false}
                ],
                action: function() {
                    playSound('ghoul');
                    return "The figure doesn't seem human. Its movements are jerky and unnatural.";
                }
            },
            10: {
                text: "The right path is overgrown and difficult to navigate. You push through thick bushes and stumble upon a small clearing with a stone altar. There's a chest sitting on the altar.",
                choices: [
                    {text: "Open the chest", nextSection: 22, skillCheck: false},
                    {text: "Investigate the altar", nextSection: 23, skillCheck: false},
                    {text: "Leave it alone and continue", nextSection: 24, skillCheck: false}
                ],
                action: function() {
                    return "The altar looks ancient and sinister. This might be a trap.";
                }
            },
            11: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 25, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        gameState.foundHiddenPath = true;
                        const goldFound = rollDice(3, 10);
                        gameState.gold += goldFound;
                        updateStatsDisplay();
                        return "You find a hidden hunter's trail! Along the path, you discover a discarded pouch with <span class='gold'>" + goldFound + " Gold</span>.";
                    } else {
                        playSound('failure');
                        const damage = rollDice(1, 8);
                        gameState.health -= damage;
                        updateStatsDisplay();
                        return "You fall into a hidden pit, taking " + damage + " damage!";
                    }
                }
            },
            12: {
                text: "You open the pouch. Inside you find some gold and a small silver cross.",
                choices: [
                    {text: "Take the forest path", nextSection: 3, skillCheck: false},
                    {text: "Risk the main road", nextSection: 2, skillCheck: false}
                ],
                action: function() {
                    addToInventory('Silver Cross');
                    playSound('item');
                    return "You acquire a <span class='item'>Silver Cross</span>. It might offer protection against evil.";
                }
            },
            13: {
                text: "The wolf snarls and leaps at you!",
                choices: [
                    {text: "Fight the wolf", nextSection: 26, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Hungry Wolf";
                    combatState.enemyHealth = 25;
                    combatState.enemyCurrentHealth = 25;
                    combatState.enemyStrength = 12;
                    combatState.enemyDamageDice = 2;
                    combatState.enemyDamageSides = 6;
                    combatState.nextSection = 27;
                    combatState.round = 1;
                    combatState.isGroup = false;
                    combatState.escapeSection = 16;
                    
                    playSound('wolf');
                    return "<span class='enemy'>Hungry Wolf</span>: Health " + combatState.enemyCurrentHealth + ", Strength " + combatState.enemyStrength;
                }
            },
            14: {
                text: "You try to light a torch or find something to make fire. The wolf hesitates, wary of the flame.",
                choices: [
                    {text: "Use the fire to drive it away", nextSection: 28, skillCheck: true, checkType: 'strength', difficulty: 13},
                    {text: "Attack while it's distracted", nextSection: 29, skillCheck: false},
                    {text: "Use Wolfsbane if you have it", nextSection: 15, skillCheck: false}
                ],
                action: function() {
                    playSound('item');
                    return "The wolf backs away from the fire, but it's still dangerous.";
                }
            },
            15: {
                text: "You take out the Wolfsbane. The wolf recognizes the plant and whimpers, backing away.",
                choices: [
                    {text: "Throw the Wolfsbane at the wolf", nextSection: 30, skillCheck: false},
                    {text: "Use it to safely pass", nextSection: 31, skillCheck: false}
                ],
                action: function() {
                    playSound('item');
                    return "The wolf clearly fears the Wolfsbane. This could be your chance.";
                }
            },
            16: {
                text: "You turn and run back toward the village. The wolf gives chase but eventually gives up. You're safe but have lost valuable time.",
                choices: [
                    {text: "Take the forest path instead", nextSection: 3, skillCheck: false},
                    {text: "Wait and try the road again", nextSection: 32, skillCheck: false}
                ],
                action: function() {
                    playSound('success');
                    return "You escape the wolf but night is growing darker. You need another route.";
                }
            },
            17: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 33, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        const itemFound = Math.random() > 0.5 ? 'Healing Potion' : 'Iron Dagger';
                        addToInventory(itemFound);
                        return "You quickly grab the shiny object! It's a <span class='item'>" + itemFound + "</span>!";
                    } else {
                        playSound('failure');
                        // Wolf attack
                        combatState.active = true;
                        combatState.enemyName = "Surprised Wolf";
                        combatState.enemyHealth = 20;
                        combatState.enemyCurrentHealth = 20;
                        combatState.enemyStrength = 11;
                        combatState.enemyDamageDice = 2;
                        combatState.enemyDamageSides = 4;
                        combatState.nextSection = 34;
                        combatState.round = 1;
                        combatState.isGroup = false;
                        
                        return "A wolf was hiding nearby! It attacks!<br><br><span class='enemy'>Surprised Wolf</span>: Health " + combatState.enemyCurrentHealth + ", Strength " + combatState.enemyStrength;
                    }
                }
            },
            18: {
                text: "You resist temptation and continue down the road. The fog grows thicker, making it hard to see. In the distance, you spot lights - it must be the tavern!",
                choices: [
                    {text: "Hurry toward the lights", nextSection: 35, skillCheck: false},
                    {text: "Approach cautiously", nextSection: 36, skillCheck: false}
                ],
                action: function() {
                    playSound('tavern');
                    return "The tavern lights beckon through the fog. You're almost there!";
                }
            },
            19: {
                text: "After your attempt to hide, you continue down the road.",
                choices: [
                    {text: "Continue toward the tavern", nextSection: 35, skillCheck: false}
                ]
            },
            20: {
                text: "As you approach, the figure turns. It's a ghoul - pale skin, sunken eyes, and claw-like hands. It hisses and drops the bone it was holding.",
                choices: [
                    {text: "Fight the ghoul", nextSection: 37, skillCheck: false},
                    {text: "Show holy symbol if you have one", nextSection: 38, skillCheck: false, requirement: function() { 
                        return gameState.inventory.includes('Holy Symbol') || gameState.inventory.includes('Silver Cross');
                    }},
                    {text: "Throw garlic if you have it", nextSection: 39, skillCheck: false, requirement: 'Garlic'},
                    {text: "Run past it", nextSection: 40, skillCheck: true, checkType: 'agility', difficulty: 17}
                ],
                action: function() {
                    gameState.ghoulEncountered = true;
                    playSound('ghoul');
                    return "<span class='ghoul'>Graveyard Ghoul</span>: 'Fresh meat...' it whispers.";
                }
            },
            21: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 41, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You successfully sneak past the ghoul without it noticing!";
                    } else {
                        playSound('failure');
                        // Ghoul notices you
                        combatState.active = true;
                        combatState.enemyName = "Alerted Ghoul";
                        combatState.enemyHealth = 30;
                        combatState.enemyCurrentHealth = 30;
                        combatState.enemyStrength = 14;
                        combatState.enemyDamageDice = 2;
                        combatState.enemyDamageSides = 8;
                        combatState.nextSection = 42;
                        combatState.round = 1;
                        combatState.isGroup = false;
                        
                        return "The ghoul hears you! It attacks!<br><br><span class='ghoul'>Alerted Ghoul</span>: Health " + combatState.enemyCurrentHealth + ", Strength " + combatState.enemyStrength;
                    }
                }
            },
            22: {
                text: "You approach the chest on the altar. As you touch it, the ground shakes slightly. This might be trapped.",
                choices: [
                    {text: "Open it anyway", nextSection: 43, skillCheck: false},
                    {text: "Check for traps first", nextSection: 44, skillCheck: true, checkType: 'agility', difficulty: 15},
                    {text: "Leave it and continue", nextSection: 24, skillCheck: false}
                ],
                action: function() {
                    return "Ancient altars often have protective magic or curses.";
                }
            },
            23: {
                text: "You examine the altar. Strange runes are carved into the stone. They seem to be warnings or protections. You notice a small offering left at the base.",
                choices: [
                    {text: "Take the offering", nextSection: 45, skillCheck: false},
                    {text: "Open the chest", nextSection: 22, skillCheck: false},
                    {text: "Leave quickly", nextSection: 24, skillCheck: false}
                ],
                action: function() {
                    playSound('item');
                    return "The runes appear to be protective symbols against evil spirits.";
                }
            },
            24: {
                text: "You decide not to risk it and continue through the forest. The path becomes clearer, and you can see torchlight ahead - the tavern!",
                choices: [
                    {text: "Approach the tavern", nextSection: 46, skillCheck: false}
                ],
                action: function() {
                    playSound('tavern');
                    return "Safety is within reach! The Black Raven Tavern stands ahead.";
                }
            },
            25: {
                text: "After finding or failing to find the hidden path, you continue through the forest.",
                choices: [
                    {text: "Continue toward the tavern", nextSection: 46, skillCheck: false}
                ]
            },
            26: {
                text: "",
                choices: [
                    {text: "Continue the fight!", nextSection: 47, skillCheck: false}
                ]
            },
            27: {
                text: "With the wolf defeated, you can search the broken cart safely.",
                choices: [
                    {text: "Search the cart for supplies", nextSection: 48, skillCheck: false},
                    {text: "Continue toward the tavern", nextSection: 35, skillCheck: false}
                ],
                action: function() {
                    const goldFound = rollDice(2, 10);
                    gameState.gold += goldFound;
                    updateStatsDisplay();
                    playSound('gold');
                    return "You defeat the wolf! Searching its body, you find <span class='gold'>" + goldFound + " Gold</span> in a small pouch around its neck (likely from a previous victim).";
                }
            },
            28: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 49, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        const goldFound = rollDice(2, 8);
                        gameState.gold += goldFound;
                        updateStatsDisplay();
                        return "You successfully drive the wolf away with fire! Searching the cart, you find <span class='gold'>" + goldFound + " Gold</span> and a <span class='item'>Healing Potion</span>!";
                    } else {
                        playSound('failure');
                        // Wolf attacks
                        combatState.active = true;
                        combatState.enemyName = "Angry Wolf";
                        combatState.enemyHealth = 22;
                        combatState.enemyCurrentHealth = 22;
                        combatState.enemyStrength = 13;
                        combatState.enemyDamageDice = 2;
                        combatState.enemyDamageSides = 6;
                        combatState.nextSection = 50;
                        combatState.round = 1;
                        combatState.isGroup = false;
                        
                        return "The wolf isn't scared! It attacks!<br><br><span class='enemy'>Angry Wolf</span>: Health " + combatState.enemyCurrentHealth + ", Strength " + combatState.enemyStrength;
                    }
                }
            },
            29: {
                text: "You attack the wolf while it's wary of the fire!",
                choices: [
                    {text: "Continue the attack", nextSection: 51, skillCheck: false}
                ],
                action: function() {
                    // Surprise advantage
                    const surpriseDamage = rollDice(2, 6);
                    
                    combatState.active = true;
                    combatState.enemyName = "Distracted Wolf";
                    combatState.enemyHealth = 25 - surpriseDamage;
                    combatState.enemyCurrentHealth = 25 - surpriseDamage;
                    combatState.enemyStrength = 11; // Lower due to distraction
                    combatState.enemyDamageDice = 2;
                    combatState.enemyDamageSides = 4;
                    combatState.nextSection = 52;
                    combatState.round = 1;
                    combatState.isGroup = false;
                    
                    playSound('combat');
                    return "You strike while it's distracted for " + surpriseDamage + " damage!<br><br><span class='enemy'>Distracted Wolf</span>: Health " + combatState.enemyCurrentHealth + ", Strength " + combatState.enemyStrength;
                }
            },
            30: {
                text: "You throw the Wolfsbane at the wolf. It yelps in pain as the plant makes contact!",
                choices: [
                    {text: "Finish it off", nextSection: 53, skillCheck: false}
                ],
                action: function() {
                    removeFromInventory('Wolfsbane');
                    const damage = rollDice(3, 6) + 5;
                    const goldFound = rollDice(2, 10);
                    gameState.gold += goldFound;
                    updateStatsDisplay();
                    playSound('combat');
                    return "The Wolfsbane deals " + damage + " damage to the wolf! It collapses. You find <span class='gold'>" + goldFound + " Gold</span> in the cart.";
                }
            },
            31: {
                text: "You hold the Wolfsbane in front of you as you pass. The wolf whimpers and backs away, allowing you to pass safely.",
                choices: [
                    {text: "Search the cart", nextSection: 48, skillCheck: false},
                    {text: "Continue toward the tavern", nextSection: 35, skillCheck: false}
                ],
                action: function() {
                    removeFromInventory('Wolfsbane');
                    playSound('success');
                    return "The Wolfsbane keeps the wolf at bay. You pass safely.";
                }
            },
            32: {
                text: "You wait hidden for a while, then cautiously return to the road. The wolf seems to have moved on. You continue your journey.",
                choices: [
                    {text: "Continue toward the tavern", nextSection: 35, skillCheck: false}
                ],
                action: function() {
                    return "The road is clear now. You hurry toward the tavern lights.";
                }
            },
            33: {
                text: "After grabbing the item (or being attacked), you continue down the road.",
                choices: [
                    {text: "Continue toward the tavern", nextSection: 35, skillCheck: false}
                ]
            },
            34: {
                text: "After dealing with the surprised wolf, you continue.",
                choices: [
                    {text: "Continue toward the tavern", nextSection: 35, skillCheck: false}
                ],
                action: function() {
                    const goldFound = rollDice(1, 10);
                    gameState.gold += goldFound;
                    updateStatsDisplay();
                    playSound('gold');
                    return "You defeat the wolf! You find <span class='gold'>" + goldFound + " Gold</span> nearby.";
                }
            },
            35: {
                text: "You hurry toward the tavern lights. As you get closer, you can hear faint music and voices. The Black Raven Tavern stands before you, its sign creaking in the wind.",
                choices: [
                    {text: "Enter the tavern", nextSection: 54, skillCheck: false},
                    {text: "Look around outside first", nextSection: 55, skillCheck: false}
                ],
                action: function() {
                    playSound('tavern');
                    return "You've reached the tavern! Warm light spills from its windows, a welcome sight in the dark night.";
                }
            },
            36: {
                text: "You approach the tavern cautiously, checking for any danger. Everything seems quiet. The tavern looks safe and welcoming.",
                choices: [
                    {text: "Enter the tavern", nextSection: 54, skillCheck: false}
                ],
                action: function() {
                    playSound('tavern');
                    return "No immediate danger is visible. The tavern awaits.";
                }
            },
            37: {
                text: "The ghoul hisses and attacks with its claws!",
                choices: [
                    {text: "Fight the ghoul", nextSection: 56, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Graveyard Ghoul";
                    combatState.enemyHealth = 30;
                    combatState.enemyCurrentHealth = 30;
                    combatState.enemyStrength = 14;
                    combatState.enemyDamageDice = 2;
                    combatState.enemyDamageSides = 8;
                    combatState.nextSection = 57;
                    combatState.round = 1;
                    combatState.isGroup = false;
                    combatState.escapeSection = 40;
                    
                    playSound('ghoul');
                    return "<span class='ghoul'>Graveyard Ghoul</span>: Health " + combatState.enemyCurrentHealth + ", Strength " + combatState.enemyStrength;
                }
            },
            38: {
                text: "You show your holy symbol to the ghoul. It shrieks and covers its eyes!",
                choices: [
                    {text: "Attack while it's vulnerable", nextSection: 58, skillCheck: false},
                    {text: "Use this chance to escape", nextSection: 59, skillCheck: false}
                ],
                action: function() {
                    playSound('success');
                    return "The holy symbol glows with faint light, causing the ghoul great pain!";
                }
            },
            39: {
                text: "You throw garlic at the ghoul. It recoils from the smell!",
                choices: [
                    {text: "Attack while it's distracted", nextSection: 60, skillCheck: false}
                ],
                action: function() {
                    removeFromInventory('Garlic');
                    const damage = rollDice(2, 6) + 3;
                    playSound('combat');
                    return "The garlic burns the ghoul for " + damage + " damage! It's weakened.";
                }
            },
            40: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 61, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You successfully run past the ghoul! It's too slow to catch you.";
                    } else {
                        playSound('failure');
                        const damage = rollDice(1, 8);
                        gameState.health -= damage;
                        updateStatsDisplay();
                        return "The ghoul swipes at you as you run, dealing " + damage + " damage!";
                    }
                }
            },
            41: {
                text: "After sneaking past (or being caught by) the ghoul, you continue through the forest.",
                choices: [
                    {text: "Continue toward the tavern", nextSection: 46, skillCheck: false}
                ]
            },
            42: {
                text: "After dealing with the ghoul, you continue through the forest.",
                choices: [
                    {text: "Continue toward the tavern", nextSection: 46, skillCheck: false}
                ],
                action: function() {
                    const goldFound = rollDice(3, 10);
                    gameState.gold += goldFound;
                    updateStatsDisplay();
                    playSound('gold');
                    return "You defeat the ghoul! Searching the grave it was digging, you find <span class='gold'>" + goldFound + " Gold</span>.";
                }
            },
            43: {
                text: "You open the chest. Inside, you find treasure! But as you take it, the ground shakes violently!",
                choices: [
                    {text: "Grab the treasure and run", nextSection: 62, skillCheck: true, checkType: 'agility', difficulty: 14},
                    {text: "Leave the treasure and run", nextSection: 63, skillCheck: false}
                ],
                action: function() {
                    const goldFound = rollDice(5, 20);
                    const itemFound = 'Ancient Coin';
                    playSound('item');
                    return "The chest contains <span class='gold'>" + goldFound + " Gold</span> and an <span class='item'>" + itemFound + "</span>!";
                }
            },
            44: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 64, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        const goldFound = rollDice(5, 20);
                        const itemFound = 'Ancient Coin';
                        gameState.gold += goldFound;
                        addToInventory(itemFound);
                        updateStatsDisplay();
                        return "You successfully disarm the trap! You safely take <span class='gold'>" + goldFound + " Gold</span> and an <span class='item'>" + itemFound + "</span>!";
                    } else {
                        playSound('failure');
                        const damage = rollDice(2, 10);
                        gameState.health -= damage;
                        updateStatsDisplay();
                        return "You trigger the trap! Poison darts shoot out, dealing " + damage + " damage!";
                    }
                }
            },
            45: {
                text: "You take the offering from the altar. It's a small bag of herbs and coins.",
                choices: [
                    {text: "Open the chest", nextSection: 22, skillCheck: false},
                    {text: "Leave the area", nextSection: 24, skillCheck: false}
                ],
                action: function() {
                    const goldFound = rollDice(2, 10);
                    gameState.gold += goldFound;
                    addToInventory('Mountain Herbs');
                    updateStatsDisplay();
                    playSound('gold');
                    return "You take <span class='gold'>" + goldFound + " Gold</span> and <span class='item'>Mountain Herbs</span> (can be used for healing).";
                }
            },
            46: {
                text: "You emerge from the forest to see the Black Raven Tavern ahead. Warm light and the sound of music promise safety and information.",
                choices: [
                    {text: "Enter the tavern", nextSection: 54, skillCheck: false},
                    {text: "Look around outside first", nextSection: 55, skillCheck: false}
                ],
                action: function() {
                    playSound('tavern');
                    return "The tavern stands as a beacon of civilization in the dark wilderness.";
                }
            },
            47: {
                text: "",
                choices: [
                    {text: "Continue the fight!", nextSection: 26, skillCheck: false}
                ]
            },
            48: {
                text: "You search the broken cart thoroughly.",
                choices: [
                    {text: "Continue toward the tavern", nextSection: 35, skillCheck: false}
                ],
                action: function() {
                    const itemFound = Math.random() > 0.5 ? 'Healing Potion' : 'Iron Dagger';
                    const goldFound = rollDice(3, 10);
                    gameState.gold += goldFound;
                    if (addToInventory(itemFound)) {
                        playSound('item');
                        return "You find <span class='gold'>" + goldFound + " Gold</span> and a <span class='item'>" + itemFound + "</span>!";
                    } else {
                        playSound('gold');
                        return "You find <span class='gold'>" + goldFound + " Gold</span>, but your inventory is full!";
                    }
                }
            },
            49: {
                text: "After driving the wolf away, you continue down the road.",
                choices: [
                    {text: "Continue toward the tavern", nextSection: 35, skillCheck: false}
                ]
            },
            50: {
                text: "After fighting the angry wolf, you continue.",
                choices: [
                    {text: "Continue toward the tavern", nextSection: 35, skillCheck: false}
                ],
                action: function() {
                    const goldFound = rollDice(2, 8);
                    gameState.gold += goldFound;
                    updateStatsDisplay();
                    playSound('gold');
                    return "You defeat the wolf! You find <span class='gold'>" + goldFound + " Gold</span> in the cart.";
                }
            },
            51: {
                text: "",
                choices: [
                    {text: "Continue the fight!", nextSection: 29, skillCheck: false}
                ]
            },
            52: {
                text: "After defeating the distracted wolf, you search the cart.",
                choices: [
                    {text: "Continue toward the tavern", nextSection: 35, skillCheck: false}
                ],
                action: function() {
                    const goldFound = rollDice(3, 10);
                    gameState.gold += goldFound;
                    updateStatsDisplay();
                    playSound('gold');
                    return "You defeat the wolf! Searching the cart, you find <span class='gold'>" + goldFound + " Gold</span>.";
                }
            },
            53: {
                text: "After using Wolfsbane on the wolf, you continue.",
                choices: [
                    {text: "Continue toward the tavern", nextSection: 35, skillCheck: false}
                ]
            },
            54: {
                text: "You enter the Black Raven Tavern. The warm air smells of ale, smoke, and roasted meat. Patrons glance at you but quickly return to their drinks. A burly bartender nods at you. 'You made it. Not many do at this hour.'",
                choices: [
                    {text: "Ask about the disappearances", nextSection: 65, skillCheck: false},
                    {text: "Get a drink and listen to conversations", nextSection: 66, skillCheck: false},
                    {text: "Rent a room for the night", nextSection: 67, skillCheck: false},
                    {text: "Show your completed level", nextSection: 68, skillCheck: false}
                ],
                action: function() {
                    gameState.tavernReached = true;
                    playSound('tavern');
                    return "<span class='tavern'>The Black Raven Tavern</span> is crowded with travelers and locals. This is where your real journey begins.";
                }
            },
            55: {
                text: "You circle the tavern, checking for anything unusual. Behind the building, you find a merchant packing up his wagon for the night.",
                choices: [
                    {text: "Talk to the merchant", nextSection: 69, skillCheck: false},
                    {text: "Enter the tavern", nextSection: 54, skillCheck: false}
                ],
                action: function() {
                    gameState.merchantMet = true;
                    playSound('item');
                    return "<span class='merchant'>Traveling Merchant</span>: 'Almost closing up! Need anything before I go?'";
                }
            },
            56: {
                text: "",
                choices: [
                    {text: "Continue the fight!", nextSection: 70, skillCheck: false}
                ]
            },
            57: {
                text: "With the ghoul defeated, you can search the grave it was digging.",
                choices: [
                    {text: "Search the grave", nextSection: 71, skillCheck: false},
                    {text: "Continue toward the tavern", nextSection: 46, skillCheck: false}
                ],
                action: function() {
                    const goldFound = rollDice(4, 10);
                    gameState.gold += goldFound;
                    updateStatsDisplay();
                    playSound('gold');
                    return "You defeat the ghoul! Searching the grave, you find <span class='gold'>" + goldFound + " Gold</span> buried with the body.";
                }
            },
            58: {
                text: "You attack the vulnerable ghoul while it's blinded by your holy symbol!",
                choices: [
                    {text: "Finish it off", nextSection: 72, skillCheck: false}
                ],
                action: function() {
                    const damage = rollDice(3, 8) + 5;
                    const goldFound = rollDice(3, 10);
                    gameState.gold += goldFound;
                    updateStatsDisplay();
                    playSound('combat');
                    return "Your attack deals " + damage + " damage to the vulnerable ghoul! It collapses. You find <span class='gold'>" + goldFound + " Gold</span> in the grave.";
                }
            },
            59: {
                text: "You use the ghoul's distraction to escape past it.",
                choices: [
                    {text: "Continue toward the tavern", nextSection: 46, skillCheck: false}
                ],
                action: function() {
                    playSound('success');
                    return "You successfully escape while the ghoul is blinded!";
                }
            },
            60: {
                text: "You attack the ghoul while it's recoiling from the garlic!",
                choices: [
                    {text: "Finish it off", nextSection: 73, skillCheck: false}
                ],
                action: function() {
                    const damage = rollDice(2, 8) + 3;
                    const goldFound = rollDice(3, 10);
                    gameState.gold += goldFound;
                    updateStatsDisplay();
                    playSound('combat');
                    return "Your attack deals " + damage + " damage! The ghoul collapses. You find <span class='gold'>" + goldFound + " Gold</span> in the grave.";
                }
            },
            61: {
                text: "After running from the ghoul, you continue through the forest.",
                choices: [
                    {text: "Continue toward the tavern", nextSection: 46, skillCheck: false}
                ]
            },
            62: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 74, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        const goldFound = rollDice(5, 20);
                        const itemFound = 'Ancient Coin';
                        gameState.gold += goldFound;
                        addToInventory(itemFound);
                        updateStatsDisplay();
                        return "You grab the treasure and run just as spikes shoot from the ground! You escape with <span class='gold'>" + goldFound + " Gold</span> and an <span class='item'>" + itemFound + "</span>!";
                    } else {
                        playSound('failure');
                        const damage = rollDice(3, 10);
                        gameState.health -= damage;
                        updateStatsDisplay();
                        const goldFound = rollDice(3, 10);
                        gameState.gold += goldFound;
                        return "Spikes shoot from the ground, dealing " + damage + " damage! You still manage to grab <span class='gold'>" + goldFound + " Gold</span> before running.";
                    }
                }
            },
            63: {
                text: "You wisely leave the treasure and back away from the altar.",
                choices: [
                    {text: "Continue toward the tavern", nextSection: 46, skillCheck: false}
                ],
                action: function() {
                    playSound('success');
                    return "You escape the area safely. Sometimes discretion is the better part of valor.";
                }
            },
            64: {
                text: "After dealing with the altar chest, you continue.",
                choices: [
                    {text: "Continue toward the tavern", nextSection: 46, skillCheck: false}
                ]
            },
            65: {
                text: "The bartender leans in. 'People disappear from the road to the next village. Some say it's wolves. Others say... something worse. Old Gregor in the corner might know more. He's the only one who's seen it and lived.'",
                choices: [
                    {text: "Talk to Old Gregor", nextSection: 75, skillCheck: false},
                    {text: "Get a drink", nextSection: 66, skillCheck: false},
                    {text: "Rent a room", nextSection: 67, skillCheck: false}
                ],
                action: function() {
                    return "<span class='tavern'>Bartender</span>: 'Buy a drink if you want to stay. We don't give information for free.'";
                }
            },
            66: {
                text: "You buy an ale and listen to the conversations around you. You catch snippets: '...found torn to pieces...' '...glowing red eyes in the woods...' '...the old castle on the hill...' One patron mentions seeing a carriage with black drapes heading toward the mountain pass.",
                choices: [
                    {text: "Ask about the disappearances", nextSection: 65, skillCheck: false},
                    {text: "Rent a room", nextSection: 67, skillCheck: false},
                    {text: "Approach Old Gregor", nextSection: 75, skillCheck: false}
                ],
                action: function() {
                    const goldCost = 5;
                    if (gameState.gold >= goldCost) {
                        gameState.gold -= goldCost;
                        addToInventory('Tavern Ale');
                        updateStatsDisplay();
                        playSound('item');
                        return "You spend <span class='gold'>5 Gold</span> on ale and listen carefully. You learn about strange occurrences in the woodlands.";
                    } else {
                        return "You don't have enough gold for a drink. The bartender scowls at you.";
                    }
                }
            },
            67: {
                text: "'A room will cost you 10 gold for the night,' says the bartender. 'Includes a lock on the door and breakfast.'",
                choices: [
                    {text: "Pay for a room (10 Gold)", nextSection: 76, skillCheck: false, requirement: function() { return gameState.gold >= 10; }},
                    {text: "Sleep in the common room (free)", nextSection: 77, skillCheck: false},
                    {text: "Ask about the disappearances", nextSection: 65, skillCheck: false}
                ],
                action: function() {
                    return "A safe night's rest could restore your health for the journey ahead.";
                }
            },
            68: {
                text: "You have successfully reached the Black Raven Tavern! Your journey through the dangerous night has prepared you for what lies ahead.",
                choices: [
                    {text: "Complete Level 1", nextSection: 78, skillCheck: false}
                ],
                action: function() {
                    playSound('levelup');
                    return "<span class='victory'>LEVEL 1 COMPLETE!</span> You've survived the journey and gathered information. The real adventure begins tomorrow when you enter the woodlands.";
                }
            },
            69: {
                text: "'Ah, a traveler! I have some last items for sale before I leave this accursed place,' says the merchant. 'Things that might help against... what's out there.'",
                choices: [
                    {text: "Buy Wolfsbane (15 Gold)", nextSection: 79, skillCheck: false, requirement: function() { return gameState.gold >= 15; }},
                    {text: "Buy Healing Potion (20 Gold)", nextSection: 80, skillCheck: false, requirement: function() { return gameState.gold >= 20; }},
                    {text: "Buy Iron Sword (30 Gold)", nextSection: 81, skillCheck: false, requirement: function() { return gameState.gold >= 30; }},
                    {text: "Enter the tavern", nextSection: 54, skillCheck: false}
                ],
                action: function() {
                    return "<span class='merchant'>Merchant</span>: 'I'm heading east at first light. This area is getting too dangerous.'";
                }
            },
            70: {
                text: "",
                choices: [
                    {text: "Continue the fight!", nextSection: 56, skillCheck: false}
                ]
            },
            71: {
                text: "After searching the grave, you continue toward the tavern.",
                choices: [
                    {text: "Continue toward the tavern", nextSection: 46, skillCheck: false}
                ]
            },
            72: {
                text: "After defeating the ghoul with holy symbol, you continue.",
                choices: [
                    {text: "Continue toward the tavern", nextSection: 46, skillCheck: false}
                ]
            },
            73: {
                text: "After defeating the ghoul with garlic, you continue.",
                choices: [
                    {text: "Continue toward the tavern", nextSection: 46, skillCheck: false}
                ]
            },
            74: {
                text: "After the altar incident, you continue.",
                choices: [
                    {text: "Continue toward the tavern", nextSection: 46, skillCheck: false}
                ]
            },
            75: {
                text: "Old Gregor is a grizzled hunter with a scar across his face. He eyes you suspiciously. 'You're asking about the disappearances? I saw it once... a creature, tall and pale, moving faster than any man. It took my brother on the road to Castle Dracula. I'll tell you more if you buy me a drink.'",
                choices: [
                    {text: "Buy Gregor a drink (5 Gold)", nextSection: 82, skillCheck: false, requirement: function() { return gameState.gold >= 5; }},
                    {text: "Return to the bartender", nextSection: 65, skillCheck: false}
                ],
                action: function() {
                    return "<span class='npc'>Old Gregor</span>: 'The old castle on the mountain... something has awakened there. Something ancient and hungry.'";
                }
            },
            76: {
                text: "You pay for a room and get a good night's sleep. Your health is restored.",
                choices: [
                    {text: "Complete Level 1", nextSection: 78, skillCheck: false}
                ],
                action: function() {
                    gameState.gold -= 10;
                    gameState.health = gameState.maxHealth;
                    updateStatsDisplay();
                    playSound('item');
                    return "You spend <span class='gold'>10 Gold</span> for a safe room. A full night's rest restores all your health!";
                }
            },
            77: {
                text: "You sleep in the common room. It's not comfortable, but it's safe. You regain some health.",
                choices: [
                    {text: "Complete Level 1", nextSection: 78, skillCheck: false}
                ],
                action: function() {
                    const healAmount = rollDice(2, 8);
                    const oldHealth = gameState.health;
                    gameState.health = Math.min(gameState.maxHealth, gameState.health + healAmount);
                    const actualHeal = gameState.health - oldHealth;
                    updateStatsDisplay();
                    playSound('item');
                    return "You get some rest in the common room, restoring " + actualHeal + " Health.";
                }
            },
            78: {
                text: "",
                choices: [
                    {text: "View Level Complete Screen", nextSection: 83, skillCheck: false}
                ],
                action: function() {
                    gameState.levelComplete = true;
                    saveGame();
                    return "Congratulations! You have completed Level 1: Journey to the Tavern.";
                }
            },
            79: {
                text: "You buy Wolfsbane from the merchant.",
                choices: [
                    {text: "Buy something else", nextSection: 69, skillCheck: false},
                    {text: "Enter the tavern", nextSection: 54, skillCheck: false}
                ],
                action: function() {
                    gameState.gold -= 15;
                    addToInventory('Wolfsbane');
                    updateStatsDisplay();
                    playSound('item');
                    return "You buy <span class='item'>Wolfsbane</span> for <span class='gold'>15 Gold</span>. It's effective against wolves and werewolves.";
                }
            },
            80: {
                text: "You buy a Healing Potion from the merchant.",
                choices: [
                    {text: "Buy something else", nextSection: 69, skillCheck: false},
                    {text: "Enter the tavern", nextSection: 54, skillCheck: false}
                ],
                action: function() {
                    gameState.gold -= 20;
                    addToInventory('Healing Potion');
                    updateStatsDisplay();
                    playSound('item');
                    return "You buy a <span class='item'>Healing Potion</span> for <span class='gold'>20 Gold</span>.";
                }
            },
            81: {
                text: "You buy an Iron Sword from the merchant.",
                choices: [
                    {text: "Buy something else", nextSection: 69, skillCheck: false},
                    {text: "Enter the tavern", nextSection: 54, skillCheck: false}
                ],
                action: function() {
                    gameState.gold -= 30;
                    addToInventory('Iron Sword');
                    updateStatsDisplay();
                    playSound('item');
                    return "You buy an <span class='item'>Iron Sword</span> for <span class='gold'>30 Gold</span>. A good weapon for the journey ahead.";
                }
            },
            82: {
                text: "Gregor drinks deeply. 'The creature... it came from Castle Dracula. The castle was abandoned for centuries, but recently... lights have been seen in its windows at night. Strange black carriages arrive and never leave. If you're going there, you'll need more than steel.'",
                choices: [
                    {text: "Ask what else you need", nextSection: 84, skillCheck: false},
                    {text: "Thank him and complete the level", nextSection: 78, skillCheck: false}
                ],
                action: function() {
                    gameState.gold -= 5;
                    updateStatsDisplay();
                    playSound('item');
                    return "<span class='npc'>Old Gregor</span>: 'You need silver, garlic, holy symbols... and courage. Lots of courage. Now leave me be.'";
                }
            },
            83: {
                text: "",
                choices: [],
                action: function() {
                    showLevelCompleteScreen();
                    return "";
                }
            },
            84: {
                text: "Gregor finishes his drink. 'That's all I'll say. Now go, before you attract its attention here.'",
                choices: [
                    {text: "Complete Level 1", nextSection: 78, skillCheck: false}
                ],
                action: function() {
                    return "Gregor refuses to say more, clearly frightened. You've learned what you can for now.";
                }
            }
        };
        
        // Load story section
        function loadSection(sectionId) {
            playSound('click');
            gameState.currentSection = sectionId;
            const section = storySections[sectionId];
            
            if (!section) {
                document.getElementById('story-text').innerHTML = "<p class='game-over'>Error: Story section not found!</p>";
                return;
            }
            
            let storyText = section.text;
            
            // Execute any section action
            if (section.action) {
                const actionResult = section.action();
                if (actionResult) {
                    storyText += "<br><br>" + actionResult;
                }
            }
            
            document.getElementById('story-text').innerHTML = "<p>" + storyText + "</p><div class='blinking-cursor'></div>";
            
            // Only show choice buttons if not in combat
            if (!combatState.active) {
                const choiceButtons = document.getElementById('choice-buttons');
                choiceButtons.innerHTML = '';
                
                // Filter choices based on requirements
                const availableChoices = section.choices.filter(choice => {
                    if (!choice.requirement) return true;
                    if (typeof choice.requirement === 'function') {
                        return choice.requirement();
                    }
                    return gameState.inventory.includes(choice.requirement) || 
                           gameState.equippedWeapon === choice.requirement ||
                           gameState.equippedArmor === choice.requirement;
                });
                
                // If no choices available (and not a special section), provide a default
                if (availableChoices.length === 0 && section.choices.length > 0) {
                    const button = document.createElement('button');
                    button.className = 'choice-btn';
                    button.textContent = "Continue";
                    button.onclick = function() {
                        loadSection(1); // Go back to start
                    };
                    choiceButtons.appendChild(button);
                } else {
                    availableChoices.forEach(choice => {
                        const button = document.createElement('button');
                        button.className = 'choice-btn';
                        button.textContent = choice.text;
                        button.onclick = function() {
                            if (choice.skillCheck) {
                                performSkillCheck(choice.checkType, choice.difficulty, choice.nextSection);
                            } else {
                                loadSection(choice.nextSection);
                            }
                        };
                        choiceButtons.appendChild(button);
                    });
                }
            }
            
            // Save game progress
            saveGame();
        }
        
        // Execute one round of combat
        function executeCombatRound() {
            combatState.round++;
            
            // Roll dice for both combatants
            const playerRoll = rollDice(2, 6);
            const enemyRoll = rollDice(2, 6);
            
            // Add strength to dice rolls
            const playerTotal = playerRoll + gameState.strength;
            const enemyTotal = enemyRoll + combatState.enemyStrength;
            
            let resultText = `<div class="combat-log"><span class="enemy">ROUND ${combatState.round}: ${combatState.enemyName}</span><br>`;
            resultText += `Your Health: ${gameState.health}/${gameState.maxHealth}, Enemy Health: ${combatState.enemyCurrentHealth}<br>`;
            resultText += `You roll ${playerRoll} + Strength ${gameState.strength} = <strong>${playerTotal}</strong><br>`;
            resultText += `Enemy rolls ${enemyRoll} + Strength ${combatState.enemyStrength} = <strong>${enemyTotal}</strong><br>`;
            
            if (playerTotal > enemyTotal) {
                // Player hits enemy
                let damage = 0;
                let weaponType = gameState.equippedWeapon;
                
                // Special weapon bonuses
                if (weaponType.includes('Silver')) {
                    // Silver weapons deal extra damage to supernatural
                    damage = rollDice(2, 6) + 3;
                    if (combatState.enemyName.includes('Wolf') || combatState.enemyName.includes('Ghoul')) {
                        damage += 5; // Extra vs supernatural
                        resultText += `<span class="item">Your ${weaponType} is especially effective!</span><br>`;
                    }
                } else if (weaponType.includes('Sword') || weaponType.includes('Dagger')) {
                    damage = rollDice(2, 6);
                } else if (weaponType === 'Walking Staff') {
                    damage = rollDice(1, 6) + 1;
                } else {
                    damage = rollDice(1, 6);
                }
                
                // Special enemy vulnerabilities
                if (combatState.enemyName.includes('Ghoul') && 
                    (gameState.inventory.includes('Holy Symbol') || gameState.inventory.includes('Silver Cross'))) {
                    damage += 3;
                    resultText += `<span class="item">Your holy item weakens the ghoul!</span><br>`;
                }
                
                combatState.enemyCurrentHealth -= damage;
                resultText += `<span class="success">You hit for ${damage} damage!</span><br>`;
                playSound('combat');
                
                if (combatState.enemyCurrentHealth <= 0) {
                    combatState.active = false;
                    resultText += `</div>`;
                    return resultText;
                }
                
            } else if (playerTotal < enemyTotal) {
                // Enemy hits player
                let enemyDamage = rollDice(combatState.enemyDamageDice, combatState.enemyDamageSides);
                
                // Armor protection
                let finalDamage = enemyDamage;
                if (gameState.equippedArmor === 'Chainmail') {
                    finalDamage = Math.max(1, Math.floor(enemyDamage * 0.7)); // 30% damage reduction
                    resultText += `<span class="item">Your chainmail absorbs some damage!</span><br>`;
                } else if (gameState.equippedArmor === 'Leather Armor') {
                    finalDamage = Math.max(1, Math.floor(enemyDamage * 0.8)); // 20% damage reduction
                    resultText += `<span class="item">Your leather armor helps!</span><br>`;
                } else if (gameState.equippedArmor === 'Scholar Robes') {
                    finalDamage = Math.max(1, Math.floor(enemyDamage * 0.9)); // 10% damage reduction
                }
                
                gameState.health -= finalDamage;
                resultText += `<span class="damage">The ${combatState.enemyName} hits you for ${finalDamage} damage!</span>`;
                playSound('damage');
                
                // Check if player died
                if (gameState.health <= 0) {
                    combatState.active = false;
                    resultText += `<br><span class="game-over">You have been defeated! Game Over.</span>`;
                    resultText += `</div>`;
                    
                    setTimeout(() => {
                        localStorage.removeItem('draculaGameState');
                        showScreen('screen-character');
                    }, 3000);
                    
                    return resultText;
                }
            } else {
                // Tie - no damage dealt
                resultText += "The attacks are evenly matched! No damage dealt this round.";
            }
            
            resultText += `</div>`;
            updateStatsDisplay();
            
            return resultText;
        }
        
        // Enemy attack (for when player uses item in combat)
        function enemyAttack() {
            const combatResult = executeCombatRound();
            document.getElementById('story-text').innerHTML += combatResult;
            
            // Check if combat is over
            if (!combatState.active) {
                endCombatVictory();
            }
        }
        
        // End combat with victory
        function endCombatVictory() {
            let goldReward = 0;
            
            if (combatState.enemyName.includes('Wolf')) {
                goldReward = Math.floor(Math.random() * 15) + 5;
            } else if (combatState.enemyName.includes('Ghoul')) {
                goldReward = Math.floor(Math.random() * 25) + 10;
            }
            
            gameState.gold += goldReward;
            updateStatsDisplay();
            
            document.getElementById('story-text').innerHTML += `<br><span class="success">You defeated the ${combatState.enemyName}!</span>`;
            
            if (goldReward > 0) {
                document.getElementById('story-text').innerHTML += `<br>You find <span class="gold">${goldReward} Gold</span>.`;
            }
            
            // Clear choice buttons - combat is over
            document.getElementById('choice-buttons').innerHTML = '';
            
            // Auto-continue to next section after combat
            setTimeout(() => {
                loadSection(combatState.nextSection);
            }, 2000);
        }
        
        // Show level complete screen
        function showLevelCompleteScreen() {
            // Update complete screen stats
            document.getElementById('complete-stat-strength').textContent = gameState.strength;
            document.getElementById('complete-stat-health').textContent = gameState.health;
            document.getElementById('complete-stat-maxhealth').textContent = gameState.maxHealth;
            document.getElementById('complete-stat-agility').textContent = gameState.agility;
            document.getElementById('complete-stat-gold').textContent = gameState.gold;
            
            // Display inventory
            const inventoryDisplay = document.getElementById('complete-inventory-display');
            inventoryDisplay.innerHTML = '';
            
            // Show equipped items
            const equippedDiv = document.createElement('div');
            equippedDiv.innerHTML = `<strong>Equipped:</strong> ${gameState.equippedWeapon}, ${gameState.equippedArmor}`;
            inventoryDisplay.appendChild(equippedDiv);
            
            // Show other inventory
            if (gameState.inventory.length > 0) {
                const invDiv = document.createElement('div');
                invDiv.innerHTML = `<strong>Inventory:</strong> ${gameState.inventory.join(', ')}`;
                inventoryDisplay.appendChild(invDiv);
            }
            
            // Show path taken
            const pathDiv = document.createElement('div');
            pathDiv.innerHTML = `<strong>Path Taken:</strong> ${gameState.pathTaken || 'Unknown'}`;
            inventoryDisplay.appendChild(pathDiv);
            
            // Show encounters
            let encounters = [];
            if (gameState.wolfEncountered) encounters.push("Wolf");
            if (gameState.ghoulEncountered) encounters.push("Ghoul");
            if (gameState.merchantMet) encounters.push("Merchant");
            if (gameState.helpedPeasant) encounters.push("Helped Peasant");
            if (gameState.foundHiddenPath) encounters.push("Found Hidden Path");
            
            const encountersDiv = document.createElement('div');
            encountersDiv.innerHTML = `<strong>Encounters:</strong> ${encounters.join(', ') || 'None'}`;
            inventoryDisplay.appendChild(encountersDiv);
            
            playSound('levelup');
            showScreen('screen-complete');
            
            // Save completed game state
            saveGame();
        }
        
        // Go to next level
        function goToNextLevel() {
            playSound('levelup');
            // Save game state for level 2
            gameState.level = 2;
            gameState.currentSection = 1; // Reset for level 2
            gameState.levelComplete = false;
            saveGame();
            
            // Redirect to level 2
            window.location.href = 'le2.html';
        }
        
        // Perform skill check
        function performSkillCheck(checkType, difficulty, nextSection) {
            playSound('roll');
            const diceRoll = rollDice(2, 6);
            let statValue = gameState[checkType];
            let success = diceRoll <= statValue;
            
            // Store result globally for section actions to use
            window.checkResult = success;
            
            let resultText = `You roll ${diceRoll}. Your ${checkType.toUpperCase()} is ${statValue}. `;
            resultText += success ? 
                `<span class="success">Success!</span>` : 
                `<span class="damage">Failure!</span>`;
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${resultText}</div>`;
            
            if (success) {
                playSound('success');
            } else {
                playSound('failure');
            }
            
            // Continue to next section after a brief delay
            setTimeout(() => {
                loadSection(nextSection);
            }, 1500);
        }
        
        // Use Agility
        function useAgility() {
            playSound('click');
            if (gameState.agility <= 0) {
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">You have no Agility!</div>`;
                return;
            }
            
            const diceRoll = rollDice(2, 6);
            const success = diceRoll <= gameState.agility;
            
            let resultText = `You use your agility... Roll: ${diceRoll}, Agility: ${gameState.agility}. `;
            resultText += success ? 
                `<span class="success">Agile!</span> You move with grace and speed.` : 
                `<span class="damage">Clumsy!</span> You fumble.`;
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${resultText}</div>`;
            
            if (success) {
                playSound('success');
                // Good effect
                const goodEffects = [
                    "You dodge an attack!",
                    "You move silently past an enemy.",
                    "You climb a difficult obstacle.",
                    "You slip through a narrow passage."
                ];
                const effect = goodEffects[Math.floor(Math.random() * goodEffects.length)];
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">${effect}</div>`;
            } else {
                playSound('failure');
                // Bad effect
                const badEffects = [
                    "You trip and take 5 damage!",
                    "You make noise and alert nearby enemies.",
                    "You get tangled in something.",
                    "You knock something over, making noise."
                ];
                const effect = badEffects[Math.floor(Math.random() * badEffects.length)];
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">${effect}</div>`;
                
                if (effect.includes("damage")) {
                    gameState.health -= 5;
                    updateStatsDisplay();
                    playSound('damage');
                }
            }
        }
        
        // Save game
        function saveGame() {
            playSound('click');
            localStorage.setItem('draculaGameState', JSON.stringify(gameState));
            document.getElementById('story-text').innerHTML += `<div class="dice-roll"><span class="success">Game saved!</span></div>`;
        }
        
        // Load game
        function loadGame() {
            playSound('click');
            const savedGame = localStorage.getItem('draculaGameState');
            if (savedGame) {
                const savedState = JSON.parse(savedGame);
                
                // Only load if saved level is 1 (this page)
                if (savedState.level === 1) {
                    Object.assign(gameState, savedState);
                    
                    // Check if character was already created
                    if (gameState.playerClass) {
                        updateStatsDisplay();
                        updateInventoryDisplay();
                        showScreen('screen-game');
                        loadSection(gameState.currentSection);
                        
                        document.getElementById('story-text').innerHTML += `<div class="dice-roll"><span class="success">Game loaded!</span></div>`;
                    } else {
                        showScreen('screen-character');
                    }
                } else {
                    document.getElementById('story-text').innerHTML += `<div class="dice-roll">No saved game found for Level 1.</div>`;
                }
            } else {
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">No saved game found.</div>`;
            }
        }
        
        // Utility function to roll dice
        function rollDice(num, sides) {
            let total = 0;
            for (let i = 0; i < num; i++) {
                total += Math.floor(Math.random() * sides) + 1;
            }
            return total;
        }
        
        // Initialize on load
        window.onload = function() {
            // Check for saved game
            const savedGame = localStorage.getItem('draculaGameState');
            if (savedGame) {
                const savedState = JSON.parse(savedGame);
                if (savedState.playerClass) {
                    // Load existing game
                    Object.assign(gameState, savedState);
                    updateStatsDisplay();
                    updateInventoryDisplay();
                    showScreen('screen-game');
                    loadSection(gameState.currentSection);
                } else {
                    // Show character creation
                    showScreen('screen-character');
                }
            } else {
                // Show character creation for new game
                showScreen('screen-character');
            }
        };
        
        // Add click sound to all buttons
        document.addEventListener('DOMContentLoaded', function() {
            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => {
                button.addEventListener('click', function() {
                    playSound('click');
                });
            });
        });
    </script>
</body>
</html>
