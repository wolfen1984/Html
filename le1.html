<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dracula's Last Rise - Level 1: Journey to the Tavern</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Retro DOS computer style - Blood Red/Black theme */
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Source Code Pro', 'Courier New', monospace;
            background-color: #000;
            color: #fff;
            margin: 0;
            padding: 10px;
            line-height: 1.5;
            max-width: 100%;
            overflow-x: hidden;
            min-height: 100vh;
            background-image: 
                linear-gradient(rgba(120, 0, 0, 0.15) 1px, transparent 1px),
                linear-gradient(90deg, rgba(120, 0, 0, 0.15) 1px, transparent 1px);
            background-size: 30px 30px;
        }
        
        .container {
            max-width: 700px;
            margin: 0 auto;
            padding: 15px;
            border: 3px solid #cc0000;
            background-color: #000;
            box-shadow: 0 0 30px rgba(204, 0, 0, 0.5);
            position: relative;
            min-height: calc(100vh - 40px);
            overflow: hidden;
        }
        
        /* Scanline effect for authentic CRT monitor feel */
        .container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                transparent 50%,
                rgba(120, 0, 0, 0.1) 50%
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 2;
        }
        
        .header {
            text-align: center;
            border-bottom: 2px dashed #cc0000;
            padding-bottom: 15px;
            margin-bottom: 20px;
            position: relative;
        }
        
        h1 {
            font-family: 'Press Start 2P', 'Courier New', monospace;
            color: #cc0000;
            text-shadow: 0 0 8px #cc0000;
            font-size: 32px;
            margin: 10px 0;
            letter-spacing: 2px;
            text-transform: uppercase;
            font-weight: normal;
        }
        
        h2 {
            font-family: 'Press Start 2P', 'Courier New', monospace;
            color: #fff;
            border-bottom: 1px solid #cc0000;
            padding-bottom: 5px;
            margin-top: 25px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 20px;
            font-weight: normal;
        }
        
        .screen {
            display: none;
            position: relative;
            z-index: 1;
        }
        
        .active-screen {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Level Progress Indicator */
        .level-progress {
            display: flex;
            justify-content: space-between;
            background-color: #111;
            border: 1px solid #cc0000;
            padding: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .level-number {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #333;
            font-weight: bold;
            color: #888;
            background-color: #222;
            font-family: 'Press Start 2P', 'Courier New', monospace;
            font-size: 12px;
        }
        
        .level-number.completed {
            background-color: #220000;
            color: #cc8888;
            border-color: #cc8888;
        }
        
        .level-number.current {
            background-color: #cc0000;
            color: #000;
            border-color: #cc0000;
            box-shadow: 0 0 12px #cc0000;
            text-shadow: 0 0 2px #000;
            font-weight: bold;
        }
        
        /* Stats Bar */
        .stats-bar {
            background-color: #111;
            border: 1px solid #cc0000;
            padding: 10px;
            margin: 15px 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            font-size: 14px;
        }
        
        .stat-item {
            margin: 5px 10px;
        }
        
        .stat-label {
            color: #fff;
        }
        
        .stat-value {
            color: #cc0000;
            font-weight: bold;
            font-size: 16px;
        }
        
        /* Inventory */
        .inventory-container {
            background-color: #111;
            border: 1px solid #cc0000;
            padding: 10px;
            margin: 15px 0;
        }
        
        .inventory-title {
            color: #cc0000;
            margin-bottom: 10px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'Press Start 2P', 'Courier New', monospace;
            font-size: 14px;
        }
        
        .inventory {
            min-height: 60px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .inventory-item {
            display: inline-block;
            background-color: #222;
            border: 1px solid #cc0000;
            padding: 8px 12px;
            color: #fff;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .inventory-item:hover {
            background-color: #333;
            border-color: #ff4444;
            transform: translateY(-2px);
        }
        
        .inventory-item.equipped::after {
            content: "E";
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #cc0000;
            color: #000;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-family: 'Press Start 2P', 'Courier New', monospace;
        }
        
        /* Story Text Area */
        .story-text {
            background-color: #000;
            border: 1px solid #cc0000;
            padding: 15px;
            margin: 20px 0;
            min-height: 200px;
            overflow-y: auto;
            max-height: 350px;
            font-size: 16px;
            line-height: 1.6;
            color: #fff;
        }
        
        /* Choice Buttons */
        .choice-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        
        .choice-btn {
            background-color: #222;
            color: #fff;
            border: 2px solid #cc0000;
            padding: 15px;
            font-family: 'Source Code Pro', 'Courier New', monospace;
            font-size: 16px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .choice-btn:hover, .choice-btn:active {
            background-color: #333;
            color: #ff4444;
            border-color: #ff4444;
            box-shadow: 0 0 10px rgba(255, 68, 68, 0.3);
        }
        
        .choice-btn::after {
            content: ">";
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #cc0000;
            font-weight: bold;
        }
        
        .choice-btn:hover::after {
            color: #ff4444;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-top: 20px;
            gap: 10px;
        }
        
        .action-btn {
            background-color: #222;
            color: #fff;
            border: 2px solid #cc0000;
            padding: 10px 15px;
            font-family: 'Source Code Pro', 'Courier New', monospace;
            font-size: 14px;
            cursor: pointer;
            flex-grow: 1;
            text-align: center;
            transition: all 0.2s;
        }
        
        .action-btn:hover, .action-btn:active {
            background-color: #333;
            color: #ff4444;
            border-color: #ff4444;
        }
        
        /* Dice Roll Display */
        .dice-roll {
            background-color: #330000;
            border: 1px solid #cc0000;
            padding: 10px;
            margin: 10px 0;
            text-align: center;
            color: #cc0000;
            font-weight: bold;
        }
        
        /* Combat Display */
        .combat-log {
            background-color: #550000;
            border: 1px solid #ff0000;
            padding: 10px;
            margin: 10px 0;
            color: #cc0000;
            font-weight: bold;
        }
        
        /* Special Text Styles */
        .game-over {
            color: #f66;
            font-weight: bold;
            text-align: center;
            font-size: 24px;
            margin: 20px;
            text-shadow: 0 0 5px #f66;
            font-family: 'Press Start 2P', 'Courier New', monospace;
        }
        
        .victory {
            color: #cc0000;
            font-weight: bold;
            text-align: center;
            font-size: 24px;
            margin: 20px;
            text-shadow: 0 0 8px #cc0000;
            font-family: 'Press Start 2P', 'Courier New', monospace;
        }
        
        .success {
            color: #6f6;
            font-weight: bold;
        }
        
        .damage {
            color: #f66;
            font-weight: bold;
        }
        
        .enemy {
            color: #fa6;
            font-weight: bold;
        }
        
        .gold {
            color: #ffd700;
            font-weight: bold;
        }
        
        .item {
            color: #8ff;
            font-weight: bold;
        }
        
        .vampire {
            color: #f66;
            font-weight: bold;
            text-shadow: 0 0 3px #f66;
        }
        
        .npc {
            color: #6f9;
            font-weight: bold;
        }
        
        .tavern {
            color: #fa6;
            font-weight: bold;
        }
        
        .traveler {
            color: #9cf;
            font-weight: bold;
        }
        
        .bandit {
            color: #f84;
            font-weight: bold;
        }
        
        /* Character Selection */
        .character-select {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 15px;
            margin: 20px 0;
        }
        
        .character-option {
            background-color: #111;
            border: 2px solid #cc0000;
            padding: 15px;
            flex: 1;
            min-width: 150px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .character-option:hover {
            background-color: #222;
            border-color: #ff4444;
            transform: translateY(-5px);
        }
        
        .character-name {
            color: #cc0000;
            font-family: 'Press Start 2P', 'Courier New', monospace;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .character-stats {
            font-size: 12px;
            text-align: left;
            margin-top: 10px;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            color: #888;
            font-size: 12px;
            margin-top: 20px;
            border-top: 1px solid #333;
            padding-top: 10px;
            font-family: 'Source Code Pro', 'Courier New', monospace;
        }
        
        /* Blinking cursor effect */
        .blinking-cursor {
            display: inline-block;
            width: 10px;
            height: 20px;
            background-color: #cc0000;
            vertical-align: middle;
            margin-left: 5px;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        /* Sound Toggle */
        .sound-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #111;
            border: 1px solid #cc0000;
            color: #fff;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
            z-index: 10;
            font-family: 'Source Code Pro', 'Courier New', monospace;
        }
        
        .sound-toggle:hover {
            background: #222;
            color: #ff4444;
        }
        
        /* New Game Button */
        .new-game-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #111;
            border: 1px solid #cc0000;
            color: #fff;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
            z-index: 10;
            font-family: 'Source Code Pro', 'Courier New', monospace;
        }
        
        .new-game-btn:hover {
            background: #222;
            color: #ff4444;
        }
        
        /* Responsive Design */
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            h2 {
                font-size: 16px;
            }
            
            .stats-bar {
                font-size: 12px;
            }
            
            .choice-btn {
                padding: 12px;
                font-size: 14px;
            }
            
            .level-number {
                width: 25px;
                height: 25px;
                font-size: 10px;
            }
            
            .inventory-title {
                font-size: 12px;
            }
            
            .character-select {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sound Toggle -->
        <div class="sound-toggle" onclick="toggleSound()">
            SOUND: <span id="sound-status">ON</span>
        </div>
        
        <!-- New Game Button -->
        <div class="new-game-btn" onclick="newGame()">
            NEW GAME
        </div>
        
        <div class="header">
            <h1>DRACULA'S LAST RISE</h1>
            <h2>LEVEL 1: JOURNEY TO THE TAVERN</h2>
        </div>
        
        <!-- Level Progress Indicator -->
        <div class="level-progress">
            <div class="level-number current">1</div>
            <div class="level-number">2</div>
            <div class="level-number">3</div>
            <div class="level-number">4</div>
            <div class="level-number">5</div>
            <div class="level-number">6</div>
            <div class="level-number">7</div>
            <div class="level-number">8</div>
            <div class="level-number">9</div>
            <div class="level-number">10</div>
        </div>
        
        <!-- Character Selection Screen -->
        <div id="screen-character" class="screen active-screen">
            <h2>CHOOSE YOUR CHARACTER</h2>
            <div class="story-text">
                <p>The night grows darker as rumors spread of Dracula's return. Villagers whisper of disappearances in the nearby woods, and travelers speak of a shadow that moves against the wind.</p>
                <p>You have heard that the <span class="tavern">"Blood Moon Tavern"</span> is where information can be found about these dark happenings. The journey will be perilous, but you must reach the tavern before midnight.</p>
                <p>Choose your path wisely, hunter of the night. Your skills will determine your survival.</p>
            </div>
            
            <div class="character-select">
                <div class="character-option" onclick="selectCharacter('warrior')">
                    <div class="character-name">THE WARRIOR</div>
                    <p>A seasoned fighter with strength and endurance.</p>
                    <div class="character-stats">
                        <div><strong>Strength:</strong> 18</div>
                        <div><strong>Health:</strong> 60/60</div>
                        <div><strong>Agility:</strong> 12</div>
                        <div><strong>Starting Item:</strong> Steel Sword</div>
                    </div>
                </div>
                
                <div class="character-option" onclick="selectCharacter('hunter')">
                    <div class="character-name">THE HUNTER</div>
                    <p>A skilled tracker with speed and precision.</p>
                    <div class="character-stats">
                        <div><strong>Strength:</strong> 14</div>
                        <div><strong>Health:</strong> 50/50</div>
                        <div><strong>Agility:</strong> 18</div>
                        <div><strong>Starting Item:</strong> Silver Dagger</div>
                    </div>
                </div>
                
                <div class="character-option" onclick="selectCharacter('scholar')">
                    <div class="character-name">THE SCHOLAR</div>
                    <p>A knowledgeable researcher with cunning and wisdom.</p>
                    <div class="character-stats">
                        <div><strong>Strength:</strong> 12</div>
                        <div><strong>Health:</strong> 45/45</div>
                        <div><strong>Agility:</strong> 16</div>
                        <div><strong>Starting Item:</strong> Ancient Tome</div>
                    </div>
                </div>
            </div>
            
            <div class="choice-buttons" style="margin-top: 30px;">
                <button class="choice-btn" onclick="startGame()">BEGIN YOUR JOURNEY</button>
            </div>
        </div>
        
        <!-- Game Screen -->
        <div id="screen-game" class="screen">
            <div class="stats-bar">
                <div class="stat-item"><span class="stat-label">STRENGTH:</span> <span id="stat-strength" class="stat-value">0</span></div>
                <div class="stat-item"><span class="stat-label">HEALTH:</span> <span id="stat-health" class="stat-value">0</span>/<span id="stat-maxhealth" class="stat-value">0</span></div>
                <div class="stat-item"><span class="stat-label">AGILITY:</span> <span id="stat-agility" class="stat-value">0</span></div>
                <div class="stat-item"><span class="stat-label">GOLD:</span> <span id="stat-gold" class="stat-value">0</span></div>
            </div>
            
            <div class="inventory-container">
                <div class="inventory-title">
                    <span>INVENTORY</span>
                    <span id="inventory-count">ITEMS: 0/10</span>
                </div>
                <div class="inventory" id="inventory">
                    <!-- Inventory items will be added here -->
                </div>
            </div>
            
            <h2>JOURNEY TO THE TAVERN</h2>
            <div class="story-text" id="story-text">
                <!-- Story content will be inserted here -->
            </div>
            
            <div class="choice-buttons" id="choice-buttons">
                <!-- Choice buttons will be inserted here -->
            </div>
            
            <div class="action-buttons">
                <button class="action-btn" onclick="useAgility()">USE AGILITY</button>
                <button class="action-btn" onclick="useItem()">USE ITEM</button>
                <button class="action-btn" onclick="saveGame()">SAVE GAME</button>
                <button class="action-btn" onclick="loadGame()">LOAD GAME</button>
            </div>
        </div>
        
        <!-- Level Complete Screen -->
        <div id="screen-complete" class="screen">
            <h2>TAVERN REACHED!</h2>
            <div class="story-text">
                <p class="victory">YOU HAVE COMPLETED LEVEL 1!</p>
                <div style="margin-top: 15px; padding: 10px; background-color: #330000; border: 1px solid #cc0000;">
                    <p>You arrive at the <span class="tavern">Blood Moon Tavern</span> just as the clock strikes midnight. The place is eerily quiet, with only a few patrons huddled in dark corners.</p>
                    <p>The bartender eyes you warily as you enter. "You're the one they sent for, aren't you? The hunter," he says, wiping a glass with a dirty rag. "There's talk in the woods. Strange things. People disappearing."</p>
                    <p>He leans closer, lowering his voice. "They say Dracula's minions are gathering in the woodlands. If you want to stop this, that's where you'll need to go next."</p>
                </div>
                
                <div class="stats-bar">
                    <div class="stat-item"><span class="stat-label">FINAL STRENGTH:</span> <span id="complete-stat-strength" class="stat-value">0</span></div>
                    <div class="stat-item"><span class="stat-label">FINAL HEALTH:</span> <span id="complete-stat-health" class="stat-value">0</span></div>
                    <div class="stat-item"><span class="stat-label">FINAL AGILITY:</span> <span id="complete-stat-agility" class="stat-value">0</span></div>
                    <div class="stat-item"><span class="stat-label">FINAL GOLD:</span> <span id="complete-stat-gold" class="stat-value">0</span></div>
                </div>
                
                <div style="margin-top: 15px; padding: 10px; background-color: #003322; border: 1px solid #00ff88;">
                    <h3 style="color: #00ff88; margin-top: 0;">YOUR PROGRESS:</h3>
                    <p>You've survived the journey to the tavern and learned valuable information about Dracula's activities. The real hunt begins now.</p>
                    <p>The woodlands await - a place of shadow and danger, where Dracula's minions gather under the blood moon.</p>
                </div>
            </div>
            
            <div class="choice-buttons">
                <button class="choice-btn" onclick="goToNextLevel()">CONTINUE TO LEVEL 2: THE WOODLANDS</button>
            </div>
        </div>
        
        <div class="footer">
            DRACULA'S LAST RISE - A Gothic Horror Adventure<br>
            Level 1: Journey to the Tavern
        </div>
    </div>

    <script>
        // Sound System
        let soundEnabled = true;
        let audioContext;
        
        // Simple beep generator using Web Audio API
        function playBeep(frequency, duration, type = 'square') {
            if (!soundEnabled) return;
            
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = type;
                
                // Volume envelope
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            } catch (e) {
                console.log("Web Audio not supported:", e);
            }
        }
        
        // Sound effects for level 1
        function playSound(type) {
            if (!soundEnabled) return;
            
            switch(type) {
                case 'click':
                    playBeep(800, 0.1, 'square');
                    break;
                case 'roll':
                    playBeep(400, 0.05, 'sine');
                    setTimeout(() => playBeep(600, 0.05, 'sine'), 50);
                    setTimeout(() => playBeep(300, 0.1, 'sine'), 100);
                    break;
                case 'combat':
                    playBeep(1200, 0.05, 'sawtooth');
                    break;
                case 'item':
                    playBeep(600, 0.2, 'triangle');
                    break;
                case 'success':
                    playBeep(1000, 0.15, 'sine');
                    setTimeout(() => playBeep(1200, 0.15, 'sine'), 150);
                    break;
                case 'failure':
                    playBeep(300, 0.3, 'sawtooth');
                    break;
                case 'damage':
                    playBeep(200, 0.2, 'square');
                    break;
                case 'victory':
                    playBeep(500, 0.1, 'sine');
                    setTimeout(() => playBeep(700, 0.1, 'sine'), 100);
                    setTimeout(() => playBeep(900, 0.1, 'sine'), 200);
                    setTimeout(() => playBeep(1100, 0.2, 'sine'), 300);
                    setTimeout(() => playBeep(1300, 0.3, 'sine'), 500);
                    break;
                case 'gold':
                    playBeep(1000, 0.1, 'sine');
                    for(let i = 0; i < 5; i++) {
                        setTimeout(() => playBeep(800 + i*100, 0.1, 'sine'), 100 + i*100);
                    }
                    break;
                case 'tavern':
                    playBeep(300, 0.2, 'sine');
                    setTimeout(() => playBeep(400, 0.2, 'sine'), 200);
                    setTimeout(() => playBeep(500, 0.2, 'sine'), 400);
                    break;
                case 'wolf':
                    playBeep(80, 0.4, 'square');
                    setTimeout(() => playBeep(60, 0.4, 'square'), 400);
                    break;
                case 'bandit':
                    playBeep(200, 0.3, 'sawtooth');
                    setTimeout(() => playBeep(180, 0.3, 'sawtooth'), 300);
                    break;
            }
        }
        
        // Toggle sound on/off
        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('sound-status').textContent = soundEnabled ? 'ON' : 'OFF';
            
            if (soundEnabled) {
                playSound('click');
            }
        }
        
        // New Game function
        function newGame() {
            playSound('click');
            if (confirm("Start a new game? This will erase your current progress.")) {
                localStorage.removeItem('draculaGameState');
                window.location.reload();
            }
        }
        
        // Game state object
        const gameState = {
            playerClass: '',
            strength: 0,
            maxHealth: 0,
            health: 0,
            agility: 0,
            gold: 15, // Starting gold
            inventory: [],
            equippedWeapon: 'Rusty Dagger',
            equippedArmor: 'Traveler Cloak',
            currentSection: 1,
            gameComplete: false,
            level: 1,
            // Level 1 specific flags
            travelerHelped: false,
            banditFought: false,
            wolfEncountered: false,
            herbsCollected: false,
            // Special items
            hasSilverWeapon: false,
            hasHealingHerbs: false,
            hasTorch: false
        };
        
        // Combat state
        let combatState = {
            active: false,
            enemyName: '',
            enemyHealth: 0,
            enemyCurrentHealth: 0,
            enemyStrength: 0,
            enemyDamageDice: 1,
            enemyDamageSides: 6,
            nextSection: 0,
            round: 1,
            isGroup: false,
            groupCount: 0
        };
        
        // Character selection
        function selectCharacter(characterClass) {
            playSound('click');
            
            // Reset game state
            gameState.playerClass = characterClass;
            gameState.inventory = [];
            
            // Set stats based on character class
            if (characterClass === 'warrior') {
                gameState.strength = 18;
                gameState.maxHealth = 60;
                gameState.health = 60;
                gameState.agility = 12;
                gameState.equippedWeapon = 'Steel Sword';
                gameState.equippedArmor = 'Leather Armor';
                addToInventory('Health Potion');
            } 
            else if (characterClass === 'hunter') {
                gameState.strength = 14;
                gameState.maxHealth = 50;
                gameState.health = 50;
                gameState.agility = 18;
                gameState.equippedWeapon = 'Silver Dagger';
                gameState.equippedArmor = 'Hunter Cloak';
                gameState.hasSilverWeapon = true;
                addToInventory('Smoke Bomb');
            }
            else if (characterClass === 'scholar') {
                gameState.strength = 12;
                gameState.maxHealth = 45;
                gameState.health = 45;
                gameState.agility = 16;
                gameState.equippedWeapon = 'Walking Stick';
                gameState.equippedArmor = 'Scholar Robes';
                addToInventory('Ancient Tome');
                addToInventory('Healing Herbs');
                gameState.hasHealingHerbs = true;
            }
            
            // Add starting items
            addToInventory('Torch');
            gameState.hasTorch = true;
            
            // Update character selection display
            const characters = document.querySelectorAll('.character-option');
            characters.forEach(char => {
                char.style.borderColor = '#cc0000';
                char.style.backgroundColor = '#111';
            });
            
            // Highlight selected character
            event.currentTarget.style.borderColor = '#ff4444';
            event.currentTarget.style.backgroundColor = '#222';
            
            // Enable start button
            document.querySelector('#screen-character .choice-btn').disabled = false;
        }
        
        // Initialize game
        function initGame() {
            // Load game state from localStorage
            const savedGame = localStorage.getItem('draculaGameState');
            if (savedGame) {
                const savedState = JSON.parse(savedGame);
                
                // Only load if saved level is 1
                if (savedState.level === 1) {
                    Object.assign(gameState, savedState);
                    
                    // If game was already completed, show complete screen
                    if (gameState.gameComplete) {
                        showCompleteScreen();
                        return;
                    }
                    
                    // Otherwise, continue the game
                    showScreen('screen-game');
                    updateStatsDisplay();
                    updateInventoryDisplay();
                    loadSection(gameState.currentSection);
                    return;
                }
            }
            
            // No saved game or wrong level - show character selection
            showScreen('screen-character');
        }
        
        function startGame() {
            playSound('click');
            
            // Check if character is selected
            if (!gameState.playerClass) {
                alert("Please select a character first!");
                return;
            }
            
            updateStatsDisplay();
            updateInventoryDisplay();
            showScreen('screen-game');
            loadSection(1);
        }
        
        // Show specific screen
        function showScreen(screenId) {
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => {
                screen.classList.remove('active-screen');
            });
            document.getElementById(screenId).classList.add('active-screen');
        }
        
        // Update stats display
        function updateStatsDisplay() {
            document.getElementById('stat-strength').textContent = gameState.strength;
            document.getElementById('stat-health').textContent = gameState.health;
            document.getElementById('stat-maxhealth').textContent = gameState.maxHealth;
            document.getElementById('stat-agility').textContent = gameState.agility;
            document.getElementById('stat-gold').textContent = gameState.gold;
        }
        
        // Add item to inventory
        function addToInventory(item) {
            if (!gameState.inventory.includes(item) && item !== gameState.equippedWeapon && item !== gameState.equippedArmor) {
                gameState.inventory.push(item);
                updateInventoryDisplay();
            }
        }
        
        // Remove item from inventory
        function removeFromInventory(item) {
            const index = gameState.inventory.indexOf(item);
            if (index !== -1) {
                gameState.inventory.splice(index, 1);
                updateInventoryDisplay();
            }
        }
        
        // Update inventory display
        function updateInventoryDisplay() {
            const inventoryDiv = document.getElementById('inventory');
            inventoryDiv.innerHTML = '';
            
            // Add equipped weapon and armor first
            const equippedWeapon = document.createElement('div');
            equippedWeapon.className = 'inventory-item equipped';
            equippedWeapon.textContent = gameState.equippedWeapon;
            equippedWeapon.onclick = () => {
                playSound('click');
                document.getElementById('story-text').innerHTML += 
                    `<div class="dice-roll">Currently equipped: <span class='item'>${gameState.equippedWeapon}</span></div>`;
            };
            inventoryDiv.appendChild(equippedWeapon);
            
            const equippedArmor = document.createElement('div');
            equippedArmor.className = 'inventory-item equipped';
            equippedArmor.textContent = gameState.equippedArmor;
            equippedArmor.onclick = () => {
                playSound('click');
                document.getElementById('story-text').innerHTML += 
                    `<div class="dice-roll">Currently equipped: <span class='item'>${gameState.equippedArmor}</span></div>`;
            };
            inventoryDiv.appendChild(equippedArmor);
            
            // Add other inventory items
            gameState.inventory.forEach(item => {
                // Skip if it's the equipped weapon or armor
                if (item !== gameState.equippedWeapon && item !== gameState.equippedArmor) {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'inventory-item';
                    itemElement.textContent = item;
                    itemElement.onclick = () => {
                        useInventoryItem(item);
                    };
                    inventoryDiv.appendChild(itemElement);
                }
            });
            
            // Update inventory count
            const totalItems = gameState.inventory.length + 2; // +2 for equipped items
            document.getElementById('inventory-count').textContent = `ITEMS: ${totalItems}/10`;
        }
        
        // Use inventory item
        function useInventoryItem(item) {
            playSound('click');
            let message = "";
            
            if (item === 'Health Potion') {
                const healAmount = rollDice(2, 6) + 5;
                const oldHealth = gameState.health;
                gameState.health = Math.min(gameState.maxHealth, gameState.health + healAmount);
                const actualHeal = gameState.health - oldHealth;
                removeFromInventory(item);
                playSound('item');
                message = `You drink the <span class='item'>Health Potion</span> and restore ${actualHeal} Health!`;
                updateStatsDisplay();
            } else if (item === 'Healing Herbs') {
                const healAmount = rollDice(1, 6) + 2;
                const oldHealth = gameState.health;
                gameState.health = Math.min(gameState.maxHealth, gameState.health + healAmount);
                const actualHeal = gameState.health - oldHealth;
                removeFromInventory(item);
                playSound('item');
                message = `You use the <span class='item'>Healing Herbs</span> and restore ${actualHeal} Health!`;
                updateStatsDisplay();
            } else if (item === 'Smoke Bomb') {
                if (combatState.active) {
                    // Escape combat
                    message = `You throw a <span class='item'>Smoke Bomb</span> and escape from combat!`;
                    combatState.active = false;
                    removeFromInventory(item);
                    loadSection(combatState.nextSection + 1); // Go to next section after escape
                } else {
                    message = "The <span class='item'>Smoke Bomb</span> can be used to escape from combat.";
                }
            } else if (item === 'Ancient Tome') {
                message = "The <span class='item'>Ancient Tome</span> contains knowledge about vampires and their weaknesses.";
                if (!gameState.inventory.includes('Silver Amulet')) {
                    message += " You find a silver amulet tucked between its pages!";
                    addToInventory('Silver Amulet');
                }
            } else if (item === 'Torch') {
                message = "The <span class='item'>Torch</span> illuminates your path and can scare away wild animals.";
            } else if (item === 'Silver Amulet') {
                message = "The <span class='item'>Silver Amulet</span> feels warm to the touch. It might offer protection against dark creatures.";
            } else if (item === 'Bandit Loot') {
                const goldFound = rollDice(2, 10);
                gameState.gold += goldFound;
                removeFromInventory(item);
                updateStatsDisplay();
                playSound('gold');
                message = `You take <span class='gold'>${goldFound} Gold</span> from the bandit loot!`;
            } else {
                message = `You examine the <span class='item'>${item}</span>.`;
            }
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${message}</div>`;
        }
        
        // Use item from action button
        function useItem() {
            playSound('click');
            if (gameState.inventory.length === 0) {
                document.getElementById('story-text').innerHTML += 
                    `<div class="dice-roll">You have no usable items in your inventory.</div>`;
                return;
            }
            
            let itemText = "<div class='dice-roll'><strong>Select an item to use:</strong><br>";
            
            // Show equipped items
            itemText += `<br><strong>Equipped:</strong><br>`;
            itemText += `<button onclick="useInventoryItem('${gameState.equippedWeapon}')" class="action-btn" style="margin: 5px;">${gameState.equippedWeapon}</button> `;
            itemText += `<button onclick="useInventoryItem('${gameState.equippedArmor}')" class="action-btn" style="margin: 5px;">${gameState.equippedArmor}</button>`;
            
            // Show inventory items
            const usableItems = gameState.inventory.filter(item => 
                item !== gameState.equippedWeapon && item !== gameState.equippedArmor);
            
            if (usableItems.length > 0) {
                itemText += `<br><br><strong>Inventory:</strong><br>`;
                usableItems.forEach(item => {
                    itemText += `<button onclick="useInventoryItem('${item}')" class="action-btn" style="margin: 5px;">${item}</button> `;
                });
            }
            
            itemText += `<br><br><button onclick="document.getElementById('story-text').innerHTML += '<div class=dice-roll>Item use cancelled.</div>'" class="action-btn">Cancel</button>`;
            itemText += "</div>";
            
            document.getElementById('story-text').innerHTML += itemText;
        }
        
        // Game story sections for Level 1
        const storySections = {
            1: {
                text: "The sun sets behind the mountains as you begin your journey to the Blood Moon Tavern. The path is old and overgrown, shadows lengthening with each passing minute. A cold wind whispers through the trees, carrying with it the scent of damp earth and distant woodsmoke.",
                choices: [
                    {text: "Take the main road (safer but longer)", nextSection: 2, skillCheck: false},
                    {text: "Cut through the forest (shorter but dangerous)", nextSection: 3, skillCheck: false},
                    {text: "Check your equipment before proceeding", nextSection: 4, skillCheck: false}
                ]
            },
            2: {
                text: "You stick to the main road. The packed dirt path is well-traveled, but you see no other travelers tonight. The moon rises, casting an eerie silver light. In the distance, you hear the howl of a wolf.",
                choices: [
                    {text: "Continue on the road", nextSection: 5, skillCheck: false},
                    {text: "Investigate the howling", nextSection: 6, skillCheck: true, checkType: 'agility', difficulty: 14},
                    {text: "Light your torch for better visibility", nextSection: 7, skillCheck: false, requirement: function() { return gameState.hasTorch; }}
                ]
            },
            3: {
                text: "You leave the road and enter the forest. The trees are dense here, blocking most of the moonlight. Twigs snap underfoot, and you can feel eyes watching you from the darkness.",
                choices: [
                    {text: "Press forward through the dense woods", nextSection: 8, skillCheck: true, checkType: 'agility', difficulty: 15},
                    {text: "Light your torch", nextSection: 9, skillCheck: false, requirement: function() { return gameState.hasTorch; }},
                    {text: "Return to the main road", nextSection: 1, skillCheck: false}
                ]
            },
            4: {
                text: "You take a moment to check your equipment. Everything seems in order, but you have a feeling you'll need all your wits about you tonight.",
                choices: [
                    {text: "Take the main road", nextSection: 2, skillCheck: false},
                    {text: "Cut through the forest", nextSection: 3, skillCheck: false}
                ],
                action: function() {
                    return "The night is young, but danger lurks in every shadow. Choose your path carefully.";
                }
            },
            5: {
                text: "You continue along the road. After about an hour, you come across a wounded traveler sitting by the roadside. He clutches his side, his clothes stained with blood.",
                choices: [
                    {text: "Approach and offer help", nextSection: 10, skillCheck: false},
                    {text: "Keep your distance and ask what happened", nextSection: 11, skillCheck: false},
                    {text: "Ignore him and continue walking", nextSection: 12, skillCheck: false}
                ]
            },
            6: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 13, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        gameState.wolfEncountered = true;
                        return "You move quietly toward the sound and spot a lone wolf feeding on a deer carcass. It hasn't noticed you. You can slip away safely.";
                    } else {
                        playSound('wolf');
                        gameState.wolfEncountered = true;
                        return "You stumble in the dark, making noise. The wolf notices you and growls, baring its teeth. It's preparing to attack!";
                    }
                }
            },
            7: {
                text: "You light your torch. The flame pushes back the darkness, revealing the path ahead. The howling seems to move away from the light.",
                choices: [
                    {text: "Continue on the road with torch lit", nextSection: 5, skillCheck: false},
                    {text: "Investigate the howling with torch in hand", nextSection: 14, skillCheck: false}
                ],
                action: function() {
                    playSound('item');
                    return "The torchlight comforts you, but also makes you more visible to anything lurking in the darkness.";
                }
            },
            8: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 15, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You move silently through the forest, avoiding obstacles and dangerous terrain. You make good progress toward the tavern.";
                    } else {
                        const damage = rollDice(1, 6);
                        gameState.health -= damage;
                        updateStatsDisplay();
                        playSound('damage');
                        return "You trip over a hidden root and fall, scraping your leg for " + damage + " damage. The noise might have alerted something nearby.";
                    }
                }
            },
            9: {
                text: "You light your torch. The forest comes alive in the flickering light - strange shadows dance between the trees, but at least you can see where you're going.",
                choices: [
                    {text: "Press forward with torch lit", nextSection: 16, skillCheck: false},
                    {text: "Search for useful herbs while illuminated", nextSection: 17, skillCheck: true, checkType: 'agility', difficulty: 14}
                ],
                action: function() {
                    playSound('item');
                    return "The torchlight reveals details of the forest floor you would have missed in the dark.";
                }
            },
            10: {
                text: "You approach the wounded traveler. 'Thank goodness you're here,' he gasps. 'Bandits... they attacked me... took everything.' He gestures weakly toward a satchel. 'Take my herbs... they might help you.'",
                choices: [
                    {text: "Take the healing herbs", nextSection: 18, skillCheck: false},
                    {text: "Offer to escort him to safety", nextSection: 19, skillCheck: false},
                    {text: "Ask about the bandits", nextSection: 20, skillCheck: false}
                ],
                action: function() {
                    gameState.travelerHelped = true;
                    playSound('item');
                    return "<span class='traveler'>Wounded Traveler</span>: 'Be careful on the road ahead. The bandits are still out there.'";
                }
            },
            11: {
                text: "You keep your distance. 'What happened to you?' you ask. The man coughs weakly. 'Bandits... they came out of nowhere. Took my gold... left me for dead.'",
                choices: [
                    {text: "Offer help", nextSection: 10, skillCheck: false},
                    {text: "Ask about the bandits' location", nextSection: 21, skillCheck: false},
                    {text: "Continue on your way", nextSection: 12, skillCheck: false}
                ],
                action: function() {
                    return "<span class='traveler'>Wounded Traveler</span>: 'There were three of them... armed with clubs and daggers.'";
                }
            },
            12: {
                text: "You ignore the wounded man and continue walking. His pleas fade into the night behind you. You feel a pang of guilt, but you have your own mission to complete.",
                choices: [
                    {text: "Continue toward the tavern", nextSection: 22, skillCheck: false}
                ],
                action: function() {
                    return "The road seems longer now, and the night colder. You quicken your pace, eager to reach the tavern.";
                }
            },
            13: {
                text: "After the wolf encounter, you return to the road and continue your journey.",
                choices: [
                    {text: "Continue toward the tavern", nextSection: 5, skillCheck: false}
                ]
            },
            14: {
                text: "With your torch held high, you move toward the howling. The light reveals a wolf that immediately backs away from the flame, disappearing into the woods.",
                choices: [
                    {text: "Continue toward the tavern", nextSection: 5, skillCheck: false}
                ],
                action: function() {
                    playSound('success');
                    return "The torch protected you from the wolf. Animals fear fire, a fact that might save your life tonight.";
                }
            },
            15: {
                text: "After navigating the forest, you emerge onto a smaller path that rejoins the main road. You've saved some time but taken risks.",
                choices: [
                    {text: "Continue toward the tavern", nextSection: 22, skillCheck: false}
                ]
            },
            16: {
                text: "With your torch lighting the way, you make steady progress through the forest. The light keeps most animals at bay, though you occasionally see glowing eyes reflecting from the darkness.",
                choices: [
                    {text: "Continue through the forest", nextSection: 23, skillCheck: false},
                    {text: "Return to the main road", nextSection: 1, skillCheck: false}
                ]
            },
            17: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 24, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        gameState.herbsCollected = true;
                        addToInventory('Healing Herbs');
                        gameState.hasHealingHerbs = true;
                        return "In the torchlight, you spot some moonwart herbs growing at the base of an old tree. These have healing properties!";
                    } else {
                        playSound('failure');
                        return "You search but find nothing useful. The forest seems to have been picked clean.";
                    }
                }
            },
            18: {
                text: "You take the healing herbs from the traveler's satchel. 'Thank you,' he whispers. 'May the gods protect you on your journey.'",
                choices: [
                    {text: "Continue toward the tavern", nextSection: 22, skillCheck: false}
                ],
                action: function() {
                    addToInventory('Healing Herbs');
                    gameState.hasHealingHerbs = true;
                    playSound('item');
                    return "You acquire <span class='item'>Healing Herbs</span>. The traveler closes his eyes, a peaceful expression on his face.";
                }
            },
            19: {
                text: "'I'll help you to safety,' you say. The man shakes his head weakly. 'No... it's too late for me. Go... reach the tavern... warn them about the bandits.'",
                choices: [
                    {text: "Take the healing herbs", nextSection: 18, skillCheck: false},
                    {text: "Ask about the bandits", nextSection: 20, skillCheck: false}
                ],
                action: function() {
                    return "<span class='traveler'>Wounded Traveler</span>: 'They're camped near the old bridge... half a mile east of here.'";
                }
            },
            20: {
                text: "'Tell me about the bandits,' you say. The traveler coughs. 'Three of them... led by a big brute with a scar... they've been robbing travelers for weeks.'",
                choices: [
                    {text: "Take the healing herbs", nextSection: 18, skillCheck: false},
                    {text: "Offer to escort him to safety", nextSection: 19, skillCheck: false}
                ],
                action: function() {
                    return "<span class='traveler'>Wounded Traveler</span>: 'They took my silver... said they were working for someone in the shadows.'";
                }
            },
            21: {
                text: "'Where are these bandits?' you ask. The man points east. 'Old bridge... half a mile... be careful.'",
                choices: [
                    {text: "Take the healing herbs", nextSection: 18, skillCheck: false},
                    {text: "Continue on your way", nextSection: 12, skillCheck: false}
                ],
                action: function() {
                    return "<span class='traveler'>Wounded Traveler</span>: 'Thank you... for stopping.'";
                }
            },
            22: {
                text: "You continue along the road. The moon is high in the sky now, bathing the landscape in pale light. You see the silhouette of a bridge ahead - the final landmark before the tavern.",
                choices: [
                    {text: "Approach the bridge cautiously", nextSection: 25, skillCheck: false},
                    {text: "Look for a way around the bridge", nextSection: 26, skillCheck: true, checkType: 'agility', difficulty: 16},
                    {text: "Check your equipment before proceeding", nextSection: 27, skillCheck: false}
                ]
            },
            23: {
                text: "You emerge from the forest near the old bridge. The tavern is just beyond it. You can see its lights in the distance.",
                choices: [
                    {text: "Approach the bridge cautiously", nextSection: 25, skillCheck: false},
                    {text: "Look for a way around the bridge", nextSection: 26, skillCheck: false}
                ]
            },
            24: {
                text: "After searching for herbs, you continue through the forest.",
                choices: [
                    {text: "Continue toward the tavern", nextSection: 23, skillCheck: false}
                ]
            },
            25: {
                text: "You approach the bridge cautiously. As you reach the midpoint, three figures step out from the shadows. 'Well, well, what do we have here?' says a large man with a scar across his face. 'Empty your pockets, traveler.'",
                choices: [
                    {text: "Fight the bandits", nextSection: 28, skillCheck: false},
                    {text: "Try to negotiate", nextSection: 29, skillCheck: false},
                    {text: "Run back the way you came", nextSection: 30, skillCheck: true, checkType: 'agility', difficulty: 16}
                ],
                action: function() {
                    playSound('bandit');
                    return "<span class='bandit'>Bandit Leader</span>: 'The night is dark and full of terrors... and we're the worst of them.'";
                }
            },
            26: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 31, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You find a narrow path that leads down to the riverbank. You're able to ford the shallow river and avoid the bridge entirely.";
                    } else {
                        playSound('failure');
                        return "You try to find another way but end up back at the bridge. The bandits spot you immediately.";
                        // Force bridge encounter
                        setTimeout(() => {
                            loadSection(25);
                        }, 1000);
                        return "";
                    }
                }
            },
            27: {
                text: "You take a moment to prepare yourself. The bridge is a known ambush point, and you need to be ready for anything.",
                choices: [
                    {text: "Approach the bridge", nextSection: 25, skillCheck: false},
                    {text: "Look for a way around", nextSection: 26, skillCheck: false}
                ],
                action: function() {
                    return "This might be your last chance to use any healing items or prepare for combat.";
                }
            },
            28: {
                text: "You draw your weapon. 'I don't think so,' you say. The bandits laugh and ready their own weapons.",
                choices: [
                    {text: "Attack the bandits", nextSection: 32, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Bandit Gang";
                    combatState.enemyHealth = 40;
                    combatState.enemyCurrentHealth = 40;
                    combatState.enemyStrength = 14;
                    combatState.enemyDamageDice = 2;
                    combatState.enemyDamageSides = 6;
                    combatState.nextSection = 33;
                    combatState.round = 0;
                    combatState.isGroup = true;
                    combatState.groupCount = 3;
                    
                    playSound('bandit');
                    return "<span class='bandit'>Bandit Gang</span>: Health " + combatState.enemyCurrentHealth + ", Strength " + combatState.enemyStrength;
                }
            },
            29: {
                text: "'I don't have much,' you say, showing your empty palms. 'Just enough for a drink at the tavern.' The bandit leader scowls. 'Then you won't miss it, will you?'",
                choices: [
                    {text: "Hand over your gold", nextSection: 34, skillCheck: false},
                    {text: "Attack while they're distracted", nextSection: 35, skillCheck: false},
                    {text: "Try to bluff your way past", nextSection: 36, skillCheck: true, checkType: 'agility', difficulty: 17}
                ],
                action: function() {
                    return "<span class='bandit'>Bandit Leader</span>: 'Make it quick. We haven't got all night.'";
                }
            },
            30: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 37, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You turn and run back the way you came. The bandits give chase but soon fall behind. You'll need to find another way to the tavern.";
                    } else {
                        const damage = rollDice(1, 8);
                        gameState.health -= damage;
                        updateStatsDisplay();
                        playSound('damage');
                        return "You try to run but one of the bandits trips you. You fall hard, taking " + damage + " damage. The bandits surround you, weapons drawn.";
                        // Force combat
                        setTimeout(() => {
                            loadSection(28);
                        }, 1500);
                        return "";
                    }
                }
            },
            31: {
                text: "You successfully avoid the bridge and continue toward the tavern. The lights grow brighter, and you can hear faint music in the distance.",
                choices: [
                    {text: "Approach the tavern", nextSection: 38, skillCheck: false}
                ],
                action: function() {
                    return "You've avoided danger and reached your destination. The Blood Moon Tavern stands before you.";
                }
            },
            32: {
                text: "",
                choices: [
                    {text: "Attack!", nextSection: 32, skillCheck: false}
                ],
                action: function() {
                    // Execute one round of combat
                    if (combatState.active) {
                        const combatResult = executeCombatRound();
                        
                        // Check if combat is over
                        if (combatState.enemyCurrentHealth <= 0) {
                            combatState.active = false;
                            // Automatically go to victory section after a short delay
                            setTimeout(() => {
                                loadSection(combatState.nextSection);
                            }, 1500);
                            return combatResult + "<br><br><span class='success'>You defeated the bandits!</span>";
                        } else if (gameState.health <= 0) {
                            combatState.active = false;
                            // Game over - will be handled in executeCombatRound
                            return combatResult;
                        }
                        
                        return combatResult;
                    }
                    return "Combat has ended.";
                }
            },
            33: {
                text: "With the bandits defeated, you search their bodies. They didn't have much, but you find some gold and a note mentioning 'deliveries to the old castle.'",
                choices: [
                    {text: "Continue to the tavern", nextSection: 38, skillCheck: false}
                ],
                action: function() {
                    gameState.banditFought = true;
                    const goldFound = rollDice(3, 10);
                    gameState.gold += goldFound;
                    addToInventory('Bandit Loot');
                    updateStatsDisplay();
                    playSound('gold');
                    return "You find <span class='gold'>" + goldFound + " Gold</span> and a mysterious note.";
                }
            },
            34: {
                text: "You hand over your gold pouch. The bandit leader weighs it in his hand. 'Not much, but it'll do. Get out of here before we change our minds.'",
                choices: [
                    {text: "Continue to the tavern", nextSection: 38, skillCheck: false}
                ],
                action: function() {
                    const goldLost = Math.floor(gameState.gold / 2);
                    gameState.gold -= goldLost;
                    updateStatsDisplay();
                    playSound('failure');
                    return "You lose <span class='gold'>" + goldLost + " Gold</span> to the bandits. They let you pass, laughing as you hurry across the bridge.";
                }
            },
            35: {
                text: "You attack while the bandits are counting your gold!",
                choices: [
                    {text: "Continue the attack", nextSection: 32, skillCheck: false}
                ],
                action: function() {
                    // Surprise round advantage
                    const surpriseDamage = rollDice(2, 8);
                    
                    combatState.active = true;
                    combatState.enemyName = "Surprised Bandits";
                    combatState.enemyHealth = 40 - surpriseDamage;
                    combatState.enemyCurrentHealth = 40 - surpriseDamage;
                    combatState.enemyStrength = 12; // Lower due to surprise
                    combatState.enemyDamageDice = 2;
                    combatState.enemyDamageSides = 5;
                    combatState.nextSection = 33;
                    combatState.round = 0;
                    combatState.isGroup = true;
                    combatState.groupCount = 3;
                    
                    playSound('combat');
                    return "You strike while they're distracted for " + surpriseDamage + " damage!<br><br><span class='bandit'>Surprised Bandits</span>: Health " + combatState.enemyCurrentHealth + ", Strength " + combatState.enemyStrength;
                }
            },
            36: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 39, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "'I'm expected at the tavern,' you say with confidence. 'The constable is meeting me there. You really want to explain why I'm late?' The bandits exchange glances and step aside. 'Move along then.'";
                    } else {
                        playSound('failure');
                        return "'That's the oldest trick in the book,' laughs the bandit leader. 'Now hand over your gold or we'll take it from your corpse.'";
                        // Force gold handover or combat
                        setTimeout(() => {
                            loadSection(29);
                        }, 1500);
                        return "";
                    }
                }
            },
            37: {
                text: "After escaping the bandits, you circle back and find another path to the tavern.",
                choices: [
                    {text: "Continue to the tavern", nextSection: 38, skillCheck: false}
                ]
            },
            38: {
                text: "You've reached the Blood Moon Tavern!",
                choices: [
                    {text: "Enter the tavern", nextSection: 40, skillCheck: false}
                ],
                action: function() {
                    playSound('tavern');
                    return "The tavern sign creaks in the wind, showing a crimson moon against a black background. Light spills from the windows, and you can hear murmured conversations inside.";
                }
            },
            39: {
                text: "After your encounter with the bandits, you continue to the tavern.",
                choices: [
                    {text: "Enter the tavern", nextSection: 40, skillCheck: false}
                ]
            },
            40: {
                text: "You push open the heavy oak door and enter the Blood Moon Tavern. The room falls silent as all eyes turn to you. A dozen patrons sit at rough-hewn tables, their faces shadowed and suspicious.",
                choices: [
                    {text: "Approach the bartender", nextSection: 41, skillCheck: false},
                    {text: "Find an empty table and observe", nextSection: 42, skillCheck: false},
                    {text: "Ask about the rumors of Dracula", nextSection: 43, skillCheck: false}
                ],
                action: function() {
                    return "The air is thick with smoke and tension. Something is wrong here - you can feel it.";
                }
            },
            41: {
                text: "The bartender is a burly man with a thick beard and watchful eyes. 'What'll it be?' he grunts, wiping a glass with a dirty rag.",
                choices: [
                    {text: "Ask for information about Dracula", nextSection: 44, skillCheck: false},
                    {text: "Order a drink", nextSection: 45, skillCheck: false},
                    {text: "Ask about a place to stay", nextSection: 46, skillCheck: false}
                ],
                action: function() {
                    return "He studies you carefully, as if measuring your worth.";
                }
            },
            42: {
                text: "You take a seat at a corner table. From here, you can observe the room. Most patrons seem like ordinary travelers, but a few have the pale complexion and sharp features you've heard associated with vampire thralls.",
                choices: [
                    {text: "Approach the bartender", nextSection: 41, skillCheck: false},
                    {text: "Listen to conversations", nextSection: 47, skillCheck: true, checkType: 'agility', difficulty: 15}
                ],
                action: function() {
                    return "The tavern is a place of secrets tonight. Everyone seems to be waiting for something.";
                }
            },
            43: {
                text: "You speak loudly, 'I've heard rumors of Dracula's return. Does anyone know anything?' The room goes completely silent. A man at the bar stands up and leaves without a word.",
                choices: [
                    {text: "Approach the bartender", nextSection: 41, skillCheck: false},
                    {text: "Leave the tavern and continue your journey", nextSection: 48, skillCheck: false}
                ],
                action: function() {
                    return "You've made yourself conspicuous. This could be dangerous.";
                }
            },
            44: {
                text: "'I need information about Dracula,' you say quietly. The bartender leans close. 'Not here. Not so loud. Meet me in the back room in ten minutes.' He slides a key across the counter.",
                choices: [
                    {text: "Take the key and wait", nextSection: 49, skillCheck: false}
                ],
                action: function() {
                    addToInventory('Back Room Key');
                    playSound('item');
                    return "He returns to cleaning glasses, his expression unreadable.";
                }
            },
            45: {
                text: "'Ale,' you say, placing a gold coin on the counter. The bartender pours a mug and takes your coin. 'You're the hunter, aren't you?' he says quietly. 'They've been expecting you.'",
                choices: [
                    {text: "Ask what he means", nextSection: 50, skillCheck: false},
                    {text: "Deny it", nextSection: 51, skillCheck: false}
                ],
                action: function() {
                    gameState.gold -= 1;
                    updateStatsDisplay();
                    return "The ale is bitter but refreshing after your journey.";
                }
            },
            46: {
                text: "'I need a room for the night,' you say. The bartender shakes his head. 'No rooms. Not tonight. Not for you.' His meaning is clear - you're not safe here.",
                choices: [
                    {text: "Ask for information instead", nextSection: 44, skillCheck: false},
                    {text: "Leave the tavern", nextSection: 48, skillCheck: false}
                ],
                action: function() {
                    return "His eyes dart toward the door, as if expecting someone.";
                }
            },
            47: {
                text: "",
                choices: [
                    {text: "Continue", nextSection: 52, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You overhear a whispered conversation: '...the master awakens... the woodlands are no longer safe... sacrifices at the old church...' This confirms your suspicions - Dracula's influence is spreading.";
                    } else {
                        playSound('failure');
                        return "The tavern is too noisy. You can't make out any specific conversations.";
                    }
                }
            },
            48: {
                text: "You decide to leave the tavern. The night air is cold, and you realize you're being watched from the shadows.",
                choices: [
                    {text: "Return to the tavern", nextSection: 40, skillCheck: false},
                    {text: "Complete Level 1", nextSection: 53, skillCheck: false}
                ],
                action: function() {
                    return "You've reached the tavern, but your investigation is just beginning. The real danger lies ahead.";
                }
            },
            49: {
                text: "You wait ten minutes, then use the key to enter the back room. The bartender is there, along with an older man with a worried expression. 'This is Gregor,' says the bartender. 'He's seen what's happening in the woodlands.'",
                choices: [
                    {text: "Ask Gregor about the woodlands", nextSection: 54, skillCheck: false},
                    {text: "Ask about Dracula specifically", nextSection: 55, skillCheck: false}
                ],
                action: function() {
                    removeFromInventory('Back Room Key');
                    return "Gregor looks at you with desperate eyes. 'You have to stop him,' he whispers.";
                }
            },
            50: {
                text: "'Who's expecting me?' you ask. The bartender glances around nervously. 'The ones who serve the darkness. They know a hunter when they see one. You should leave while you still can.'",
                choices: [
                    {text: "Ask for more information", nextSection: 56, skillCheck: false},
                    {text: "Take his advice and leave", nextSection: 48, skillCheck: false}
                ],
                action: function() {
                    return "He's genuinely afraid. Whatever is happening here is bigger than simple banditry.";
                }
            },
            51: {
                text: "'I'm just a traveler,' you say. The bartender snorts. 'Sure you are. And I'm the king of Transylvania. Be careful, traveler. The night has eyes.'",
                choices: [
                    {text: "Ask for information anyway", nextSection: 44, skillCheck: false},
                    {text: "Leave the tavern", nextSection: 48, skillCheck: false}
                ],
                action: function() {
                    return "He doesn't believe you, but he seems to respect your caution.";
                }
            },
            52: {
                text: "After listening to conversations, you decide on your next move.",
                choices: [
                    {text: "Approach the bartender", nextSection: 41, skillCheck: false},
                    {text: "Leave the tavern", nextSection: 48, skillCheck: false}
                ]
            },
            53: {
                text: "You've completed your journey to the tavern and gathered what information you could. The next step in your quest is clear: you must enter the woodlands to confront the growing darkness.",
                choices: [
                    {text: "Complete Level 1", nextSection: 57, skillCheck: false}
                ],
                action: function() {
                    gameState.gameComplete = true;
                    saveGame();
                    return "Your journey is far from over, but you've survived the first trial. The woodlands await...";
                }
            },
            54: {
                text: "'What's happening in the woodlands?' you ask. Gregor shudders. 'Creatures... things that shouldn't exist. They take people in the night. The trees themselves seem to be... watching.'",
                choices: [
                    {text: "Ask about Dracula", nextSection: 55, skillCheck: false},
                    {text: "Thank them and prepare to leave", nextSection: 53, skillCheck: false}
                ],
                action: function() {
                    return "<span class='npc'>Gregor</span>: 'There's an old church in the heart of the woodlands. That's where they gather. That's where you'll find answers.'";
                }
            },
            55: {
                text: "'Is Dracula behind this?' you ask. Both men go pale. 'Don't say that name here!' hisses the bartender. Gregor nods slowly. 'He awakens. His servants prepare the way. You must stop them before the blood moon reaches its zenith.'",
                choices: [
                    {text: "Ask about the woodlands", nextSection: 54, skillCheck: false},
                    {text: "Thank them and prepare to leave", nextSection: 53, skillCheck: false}
                ],
                action: function() {
                    return "<span class='npc'>The Bartender</span>: 'Take this.' He hands you a small silver vial. 'Holy water. It might help.'";
                }
            },
            56: {
                text: "'Tell me everything,' you say. The bartender leans closer. 'There's a cult. They worship the darkness. They've been kidnapping people from nearby villages. Taking them to the woodlands. To the old church.'",
                choices: [
                    {text: "Ask to speak in private", nextSection: 49, skillCheck: false},
                    {text: "Thank him and leave", nextSection: 53, skillCheck: false}
                ],
                action: function() {
                    return "<span class='npc'>The Bartender</span>: 'Be careful. They have spies everywhere.'";
                }
            },
            57: {
                text: "",
                choices: [
                    {text: "Complete Level 1", nextSection: 58, skillCheck: false}
                ],
                action: function() {
                    // Show complete screen
                    showCompleteScreen();
                    return "";
                }
            },
            58: {
                text: "",
                choices: []
            }
        };
        
        // Load story section
        function loadSection(sectionId) {
            playSound('click');
            gameState.currentSection = sectionId;
            const section = storySections[sectionId];
            
            if (!section) {
                document.getElementById('story-text').innerHTML = "<p class='game-over'>Error: Story section not found!</p>";
                return;
            }
            
            let storyText = section.text;
            
            // Execute any section action
            if (section.action) {
                const actionResult = section.action();
                if (actionResult) {
                    storyText += "<br><br>" + actionResult;
                }
            }
            
            document.getElementById('story-text').innerHTML = "<p>" + storyText + "</p><div class='blinking-cursor'></div>";
            
            // Clear choice buttons
            const choiceButtons = document.getElementById('choice-buttons');
            choiceButtons.innerHTML = '';
            
            // If in combat, show attack button
            if (combatState.active && sectionId === 32) {
                const attackButton = document.createElement('button');
                attackButton.className = 'choice-btn';
                attackButton.textContent = "Attack!";
                attackButton.onclick = function() {
                    loadSection(32); // Reload the same section to execute another combat round
                };
                choiceButtons.appendChild(attackButton);
                return;
            }
            
            // Filter choices based on requirements
            const availableChoices = section.choices.filter(choice => {
                if (!choice.requirement) return true;
                if (typeof choice.requirement === 'function') {
                    return choice.requirement();
                }
                return gameState.inventory.includes(choice.requirement) || 
                       gameState.equippedWeapon === choice.requirement ||
                       gameState.equippedArmor === choice.requirement;
            });
            
            // If no choices available (and not a special section), provide a default
            if (availableChoices.length === 0 && section.choices.length > 0) {
                const button = document.createElement('button');
                button.className = 'choice-btn';
                button.textContent = "Continue";
                button.onclick = function() {
                    loadSection(1); // Go back to start
                };
                choiceButtons.appendChild(button);
            } else {
                availableChoices.forEach(choice => {
                    const button = document.createElement('button');
                    button.className = 'choice-btn';
                    button.textContent = choice.text;
                    button.onclick = function() {
                        if (choice.skillCheck) {
                            performSkillCheck(choice.checkType, choice.difficulty, choice.nextSection);
                        } else {
                            loadSection(choice.nextSection);
                        }
                    };
                    choiceButtons.appendChild(button);
                });
            }
            
            // Save game progress
            saveGame();
        }
        
        // Execute one round of combat
        function executeCombatRound() {
            combatState.round++;
            
            // Roll dice for both combatants
            const playerRoll = rollDice(2, 6);
            const enemyRoll = rollDice(2, 6);
            
            // Add strength to dice rolls
            const playerTotal = playerRoll + gameState.strength;
            const enemyTotal = enemyRoll + combatState.enemyStrength;
            
            let resultText = `<div class="combat-log"><span class="enemy">ROUND ${combatState.round}: ${combatState.enemyName}</span><br>`;
            resultText += `Your Health: ${gameState.health}/${gameState.maxHealth}, Enemy Health: ${combatState.enemyCurrentHealth}<br>`;
            resultText += `You roll ${playerRoll} + Strength ${gameState.strength} = <strong>${playerTotal}</strong><br>`;
            resultText += `Enemy rolls ${enemyRoll} + Strength ${combatState.enemyStrength} = <strong>${enemyTotal}</strong><br>`;
            
            if (playerTotal > enemyTotal) {
                // Player hits enemy
                let damage = 0;
                let weaponType = gameState.equippedWeapon;
                
                // Weapon bonuses
                if (weaponType === 'Steel Sword') {
                    damage = rollDice(2, 8) + 3;
                } else if (weaponType === 'Silver Dagger') {
                    damage = rollDice(2, 6) + 2;
                } else if (weaponType === 'Walking Stick') {
                    damage = rollDice(1, 6) + 1;
                } else {
                    damage = rollDice(1, 6);
                }
                
                combatState.enemyCurrentHealth -= damage;
                resultText += `<span class="success">You hit for ${damage} damage!</span><br>`;
                playSound('combat');
                
            } else if (playerTotal < enemyTotal) {
                // Enemy hits player
                let enemyDamage = rollDice(combatState.enemyDamageDice, combatState.enemyDamageSides);
                
                // Group enemies attack together
                if (combatState.isGroup && combatState.groupCount > 1) {
                    enemyDamage += Math.floor(combatState.groupCount * 2); // Extra damage for group
                    resultText += `The enemies attack together!<br>`;
                }
                
                gameState.health -= enemyDamage;
                resultText += `<span class="damage">The ${combatState.enemyName} hits you for ${enemyDamage} damage!</span>`;
                playSound('damage');
                
            } else {
                // Tie - no damage dealt
                resultText += "The attacks are evenly matched! No damage dealt this round.";
            }
            
            resultText += `</div>`;
            updateStatsDisplay();
            
            return resultText;
        }
        
        // Show complete screen
        function showCompleteScreen() {
            // Update complete screen stats
            document.getElementById('complete-stat-strength').textContent = gameState.strength;
            document.getElementById('complete-stat-health').textContent = gameState.health;
            document.getElementById('complete-stat-agility').textContent = gameState.agility;
            document.getElementById('complete-stat-gold').textContent = gameState.gold;
            
            playSound('victory');
            showScreen('screen-complete');
            
            // Save completed game state
            saveGame();
        }
        
        // Go to next level
        function goToNextLevel() {
            playSound('click');
            // Save game state for level 2
            gameState.level = 2;
            gameState.currentSection = 1;
            saveGame();
            
            // Redirect to level 2
            window.location.href = 'le2.html';
        }
        
        // Perform skill check
        function performSkillCheck(checkType, difficulty, nextSection) {
            playSound('roll');
            const diceRoll = rollDice(2, 6);
            let statValue = gameState[checkType];
            let success = diceRoll <= statValue;
            
            // Store result globally for section actions to use
            window.checkResult = success;
            
            let resultText = `You roll ${diceRoll}. Your ${checkType.toUpperCase()} is ${statValue}. `;
            resultText += success ? 
                `<span class="success">Success!</span>` : 
                `<span class="damage">Failure!</span>`;
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${resultText}</div>`;
            
            if (success) {
                playSound('success');
            } else {
                playSound('failure');
            }
            
            // Continue to next section after a brief delay
            setTimeout(() => {
                loadSection(nextSection);
            }, 1500);
        }
        
        // Use Agility
        function useAgility() {
            playSound('click');
            if (gameState.agility <= 0) {
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">You have no Agility!</div>`;
                return;
            }
            
            const diceRoll = rollDice(2, 6);
            const success = diceRoll <= gameState.agility;
            
            let resultText = `You use your agility... Roll: ${diceRoll}, Agility: ${gameState.agility}. `;
            resultText += success ? 
                `<span class="success">Agile!</span> You move with grace and speed.` : 
                `<span class="damage">Clumsy!</span> You fumble.`;
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${resultText}</div>`;
            
            if (success) {
                playSound('success');
                // Good effect
                const goodEffects = [
                    "You dodge an attack!",
                    "You move silently past an enemy.",
                    "You climb a difficult obstacle.",
                    "You slip through a narrow passage."
                ];
                const effect = goodEffects[Math.floor(Math.random() * goodEffects.length)];
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">${effect}</div>`;
            } else {
                playSound('failure');
                // Bad effect
                const badEffects = [
                    "You trip and take 5 damage!",
                    "You make noise and alert nearby enemies.",
                    "You get tangled in something.",
                    "You knock something over, making noise."
                ];
                const effect = badEffects[Math.floor(Math.random() * badEffects.length)];
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">${effect}</div>`;
                
                if (effect.includes("damage")) {
                    gameState.health -= 5;
                    updateStatsDisplay();
                    playSound('damage');
                }
            }
        }
        
        // Save game
        function saveGame() {
            playSound('click');
            localStorage.setItem('draculaGameState', JSON.stringify(gameState));
            document.getElementById('story-text').innerHTML += `<div class="dice-roll"><span class="success">Game saved!</span></div>`;
        }
        
        // Load game
        function loadGame() {
            playSound('click');
            const savedGame = localStorage.getItem('draculaGameState');
            if (savedGame) {
                const savedState = JSON.parse(savedGame);
                
                // Only load if saved level is 1 (this page)
                if (savedState.level === 1) {
                    Object.assign(gameState, savedState);
                    
                    updateStatsDisplay();
                    updateInventoryDisplay();
                    showScreen('screen-game');
                    loadSection(gameState.currentSection);
                    
                    document.getElementById('story-text').innerHTML += `<div class="dice-roll"><span class="success">Game loaded!</span></div>`;
                } else {
                    document.getElementById('story-text').innerHTML += `<div class="dice-roll">No saved game found for Level 1.</div>`;
                }
            } else {
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">No saved game found.</div>`;
            }
        }
        
        // Utility function to roll dice
        function rollDice(num, sides) {
            let total = 0;
            for (let i = 0; i < num; i++) {
                total += Math.floor(Math.random() * sides) + 1;
            }
            return total;
        }
        
        // Initialize on load
        window.onload = initGame;
        
        // Add click sound to all buttons
        document.addEventListener('DOMContentLoaded', function() {
            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => {
                button.addEventListener('click', function() {
                    playSound('click');
                });
            });
        });
    </script>
</body>
</html>
