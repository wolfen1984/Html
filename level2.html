<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DreadWood: City of Shadows</title>
    <style>
        /* EXACT SAME STYLE as level1.html */
        body {
            font-family: 'Courier New', monospace;
            background-color: #0a0a2a;
            color: #33ff33;
            margin: 0;
            padding: 10px;
            line-height: 1.5;
            max-width: 100%;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 10px;
            border: 2px solid #33ff33;
            background-color: #000;
            box-shadow: 0 0 15px rgba(51, 255, 51, 0.5);
            position: relative;
            min-height: calc(100vh - 40px);
        }
        
        .header {
            text-align: center;
            border-bottom: 2px dashed #33ff33;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        h1 {
            color: #ff33ff;
            text-shadow: 0 0 5px #ff33ff;
            font-size: 28px;
            margin: 10px 0;
            letter-spacing: 2px;
        }
        
        h2 {
            color: #33ccff;
            border-bottom: 1px solid #33ccff;
            padding-bottom: 5px;
            margin-top: 25px;
        }
        
        .screen {
            display: none;
        }
        
        .active-screen {
            display: block;
        }
        
        .stats-bar {
            background-color: #111133;
            border: 1px solid #33ff33;
            padding: 10px;
            margin: 15px 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            font-size: 14px;
        }
        
        .stat-item {
            margin: 5px 10px;
        }
        
        .stat-value {
            color: #ffff33;
            font-weight: bold;
        }
        
        .inventory {
            background-color: #111122;
            border: 1px solid #ff33ff;
            padding: 10px;
            margin: 15px 0;
            min-height: 60px;
        }
        
        .inventory-item {
            display: inline-block;
            background-color: #222244;
            border: 1px solid #33ccff;
            padding: 5px 10px;
            margin: 5px;
            border-radius: 3px;
        }
        
        .story-text {
            background-color: #111111;
            border: 1px solid #33ff33;
            padding: 15px;
            margin: 20px 0;
            min-height: 150px;
            overflow-y: auto;
            max-height: 300px;
        }
        
        .choice-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        
        .choice-btn {
            background-color: #222244;
            color: #33ff33;
            border: 2px solid #33ff33;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
        }
        
        .choice-btn:hover, .choice-btn:active {
            background-color: #333366;
            color: #ffff33;
            border-color: #ffff33;
        }
        
        .action-buttons {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-top: 20px;
            gap: 10px;
        }
        
        .action-btn {
            background-color: #330033;
            color: #ff33ff;
            border: 2px solid #ff33ff;
            padding: 10px 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            cursor: pointer;
            flex-grow: 1;
            text-align: center;
        }
        
        .action-btn:hover, .action-btn:active {
            background-color: #550055;
            color: #ff99ff;
        }
        
        .dice-roll {
            background-color: #223322;
            border: 1px solid #33ff33;
            padding: 10px;
            margin: 10px 0;
            text-align: center;
            color: #ffff33;
        }
        
        .game-over {
            color: #ff3333;
            font-weight: bold;
            text-align: center;
            font-size: 24px;
            margin: 20px;
            text-shadow: 0 0 5px #ff3333;
        }
        
        .success {
            color: #33ff33;
            font-weight: bold;
        }
        
        .damage {
            color: #ff3333;
            font-weight: bold;
        }
        
        .enemy {
            color: #ff9933;
            font-weight: bold;
        }
        
        .next-level {
            text-align: center;
            margin-top: 20px;
            padding: 20px;
        }
        
        .next-level-btn {
            background-color: #003333;
            color: #33ff99;
            border: 2px solid #33ff99;
            padding: 15px 30px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .next-level-btn:hover, .next-level-btn:active {
            background-color: #005555;
            color: #99ffcc;
        }
        
        .retro-notice {
            text-align: center;
            color: #888888;
            font-size: 12px;
            margin-top: 20px;
            border-top: 1px solid #333333;
            padding-top: 10px;
        }
        
        .warning-dialog {
            background-color: #332222;
            border: 2px solid #ff3333;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .warning-text {
            color: #ff9933;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .dialog-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .dialog-btn {
            padding: 10px 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            cursor: pointer;
            border: 2px solid;
        }
        
        .dialog-btn-yes {
            background-color: #223322;
            color: #33ff33;
            border-color: #33ff33;
        }
        
        .dialog-btn-no {
            background-color: #332222;
            color: #ff3333;
            border-color: #ff3333;
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 5px;
            }
            
            h1 {
                font-size: 22px;
            }
            
            .stats-bar {
                font-size: 12px;
            }
            
            .choice-btn {
                padding: 10px;
                font-size: 14px;
            }
            
            .dialog-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>DREADWOOD</h1>
            <h2>CITY OF SHADOWS</h2>
            <div class="retro-notice">Level 2 - Your Adventure Continues</div>
        </div>
        
        <!-- Game Screen -->
        <div id="screen-game" class="screen active-screen">
            <div class="stats-bar">
                <div class="stat-item">SKILL: <span id="stat-skill" class="stat-value">0</span></div>
                <div class="stat-item">STAMINA: <span id="stat-stamina" class="stat-value">0</span>/<span id="stat-maxstamina" class="stat-value">0</span></div>
                <div class="stat-item">LUCK: <span id="stat-luck" class="stat-value">0</span></div>
                <div class="stat-item">GOLD: <span id="stat-gold" class="stat-value">0</span></div>
            </div>
            
            <h2>INVENTORY</h2>
            <div class="inventory" id="inventory">
                <!-- Inventory will be loaded from saved game -->
            </div>
            
            <h2>THE ADVENTURE</h2>
            <div class="story-text" id="story-text">
                <p>Welcome to the CITY OF SHADOWS. You have successfully crossed the Mountains of Doom and now stand before the ominous gates of this ancient, cursed city. The buildings loom like dark giants against the twilight sky. Your quest continues here...</p>
            </div>
            
            <div class="choice-buttons" id="choice-buttons">
                <button class="choice-btn" onclick="loadSection(1)">Enter the City Gates</button>
                <button class="choice-btn" onclick="loadSection(2)">Sneak through the Sewers</button>
                <button class="choice-btn" onclick="loadSection(3)">Search for Supplies Outside</button>
            </div>
            
            <div class="action-buttons">
                <button class="action-btn" onclick="useLuck()">TEST LUCK</button>
                <button class="action-btn" onclick="checkInventory()">INVENTORY</button>
                <button class="action-btn" onclick="saveGame()">SAVE GAME</button>
                <button class="action-btn" onclick="showNewGameWarning()">START NEW GAME</button>
            </div>
        </div>
        
        <!-- Warning Dialog for New Game -->
        <div id="warning-dialog" class="screen">
            <div class="warning-dialog">
                <div class="warning-text">WARNING: Starting a new game will delete ALL your current progress!</div>
                <p>Your current character, stats, inventory, and gold will be permanently erased.</p>
                <p>You will return to the beginning of the game to create a new character.</p>
                <div class="dialog-buttons">
                    <button class="dialog-btn dialog-btn-yes" onclick="startNewGame()">YES, START NEW GAME</button>
                    <button class="dialog-btn dialog-btn-no" onclick="cancelNewGame()">NO, KEEP MY CHARACTER</button>
                </div>
            </div>
        </div>
        
        <!-- Next Level Screen (for future expansion) -->
        <div id="screen-next" class="screen">
            <h2>VICTORY!</h2>
            <div class="story-text">
                <p>You have survived the CITY OF SHADOWS!</p>
                <p>Your journey continues to new horizons...</p>
                <p>All your stats, gold, and inventory will carry over to the next chapter.</p>
                <div class="stats-bar">
                    <div class="stat-item">SKILL: <span id="next-stat-skill" class="stat-value">0</span></div>
                    <div class="stat-item">STAMINA: <span id="next-stat-stamina" class="stat-value">0</span></div>
                    <div class="stat-item">LUCK: <span id="next-stat-luck" class="stat-value">0</span></div>
                    <div class="stat-item">GOLD: <span id="next-stat-gold" class="stat-value">0</span></div>
                </div>
            </div>
            
            <div class="next-level">
                <button class="next-level-btn" onclick="goToLevel3()">CONTINUE TO LEVEL 3</button>
            </div>
        </div>
        
        <div class="retro-notice">
            DREADWOOD - A Retro Gamebook Adventure<br>
            Level 2: City of Shadows
        </div>
    </div>

    <script>
        // Game state (loaded from localStorage)
        let gameState = JSON.parse(localStorage.getItem('dreadwoodGameState')) || {
            playerClass: 'warrior',
            skill: 10,
            maxStamina: 18,
            stamina: 18,
            luck: 10,
            gold: 20,
            inventory: ['Dagger', 'Leather Armor'],
            weapons: [{name: 'Dagger', damage: '1d6'}],
            armor: [{name: 'Leather Armor', defense: 1}],
            currentSection: 0
        };
        
        // Level 2 story sections
        const storySections = {
            0: {
                text: "Welcome to the CITY OF SHADOWS. You have successfully crossed the Mountains of Doom and now stand before the ominous gates of this ancient, cursed city. The buildings loom like dark giants against the twilight sky. Your quest continues here...",
                choices: [
                    {text: "Enter the City Gates", nextSection: 1, skillCheck: false},
                    {text: "Sneak through the Sewers", nextSection: 2, skillCheck: false},
                    {text: "Search for Supplies Outside", nextSection: 3, skillCheck: false}
                ]
            },
            1: {
                text: "You approach the massive iron gates of the city. Two shadowy guards block your path. 'Halt! None may enter without paying the toll of 10 Gold!' one of them growls.",
                choices: [
                    {text: "Pay the 10 Gold toll", nextSection: 4, skillCheck: false},
                    {text: "Try to intimidate the guards", nextSection: 5, skillCheck: true, checkType: 'skill', difficulty: 12},
                    {text: "Attack the guards", nextSection: 6, skillCheck: false}
                ]
            },
            2: {
                text: "You find a sewer entrance near the city walls. The smell is horrific, but it might provide unnoticed access. As you climb down, you hear skittering sounds in the darkness.",
                choices: [
                    {text: "Continue through the sewer", nextSection: 7, skillCheck: false},
                    {text: "Light a torch to see better", nextSection: 8, skillCheck: false},
                    {text: "Go back and try the main gate", nextSection: 1, skillCheck: false}
                ]
            },
            3: {
                text: "You search the area outside the city walls. In an abandoned caravan, you find a locked strongbox and some discarded supplies.",
                choices: [
                    {text: "Try to open the strongbox", nextSection: 9, skillCheck: true, checkType: 'skill', difficulty: 11},
                    {text: "Take the supplies and head to the gates", nextSection: 10, skillCheck: false},
                    {text: "Search more thoroughly", nextSection: 11, skillCheck: false}
                ]
            },
            4: {
                text: "You hand over 10 Gold to the guards. They nod grimly and swing open the massive gates. 'Watch your back in there, stranger. The City of Shadows eats the unwary.'",
                choices: [
                    {text: "Enter the city cautiously", nextSection: 12, skillCheck: false},
                    {text: "Ask the guards about the city", nextSection: 13, skillCheck: false}
                ],
                action: function() {
                    if (gameState.gold >= 10) {
                        gameState.gold -= 10;
                        updateStatsDisplay();
                        return "You pay 10 Gold and the guards let you pass.";
                    } else {
                        return "You don't have enough gold! The guards shove you away from the gate.";
                    }
                }
            },
            5: {
                text: "You attempt to intimidate the guards...",
                choices: [
                    {text: "Continue", nextSection: 14, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        return "The guards step back, intimidated by your presence. 'Very well, you may pass. But don't cause trouble.'";
                    } else {
                        return "The guards laugh at your attempt. 'Think you're tough? Prove it!' They draw their weapons.";
                    }
                }
            },
            6: {
                text: "You attack the city guards! Roll for combat!",
                choices: [
                    {text: "Roll for attack", nextSection: 15, skillCheck: false}
                ],
                action: function() {
                    return startCombat("City Guard", 12, 8);
                }
            },
            7: {
                text: "You wade through the foul-smelling sewer water. Suddenly, large rats emerge from the shadows, their eyes glowing red!",
                choices: [
                    {text: "Fight the sewer rats", nextSection: 16, skillCheck: false},
                    {text: "Try to scare them away with fire", nextSection: 17, skillCheck: false},
                    {text: "Run deeper into the sewer", nextSection: 18, skillCheck: false}
                ]
            },
            8: {
                text: "You light a torch. The sudden light reveals dozens of giant rats scuttling away from the flame. However, the light also attracts something else... a slithering shape moves in the water ahead.",
                choices: [
                    {text: "Advance cautiously", nextSection: 19, skillCheck: false},
                    {text: "Extinguish the torch and proceed in darkness", nextSection: 7, skillCheck: false},
                    {text: "Return to the surface", nextSection: 1, skillCheck: false}
                ]
            },
            9: {
                text: "You attempt to pick the lock on the strongbox...",
                choices: [
                    {text: "Continue", nextSection: 20, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        gameState.gold += 25;
                        updateStatsDisplay();
                        return "You successfully pick the lock! Inside you find 25 Gold and a mysterious silver key.";
                    } else {
                        return "The lock is too complex. You break your lockpick trying to open it.";
                    }
                }
            },
            10: {
                text: "You take the supplies (a healing potion restoring 4 Stamina) and head toward the city gates.",
                choices: [
                    {text: "Approach the gates", nextSection: 1, skillCheck: false}
                ],
                action: function() {
                    gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + 4);
                    updateStatsDisplay();
                    return "You drink the healing potion and restore 4 Stamina.";
                }
            },
            11: {
                text: "You search more thoroughly and find a hidden compartment in the caravan floor! Inside is a map of the city sewers and a silver dagger (+1 damage).",
                choices: [
                    {text: "Take the findings and head to the gates", nextSection: 1, skillCheck: false},
                    {text: "Take the findings and try the sewers", nextSection: 2, skillCheck: false}
                ],
                action: function() {
                    gameState.weapons.push({name: 'Silver Dagger', damage: '1d6+1'});
                    updateInventoryDisplay();
                    return "You find a Silver Dagger (+1 damage) and a sewer map! The dagger will be your new weapon.";
                }
            },
            12: {
                text: "You enter the city cautiously. The streets are narrow and winding, with buildings looming overhead. You hear strange whispers in the shadows.",
                choices: [
                    {text: "Follow the main street", nextSection: 21, skillCheck: false},
                    {text: "Take a side alley", nextSection: 22, skillCheck: false},
                    {text: "Look for an inn or tavern", nextSection: 23, skillCheck: false}
                ]
            },
            13: {
                text: "'What should I know about this city?' you ask the guards. The older one sighs. 'Avoid the Temple District after dark. Don't trust the merchants in the market. And whatever you do, stay out of the catacombs.'",
                choices: [
                    {text: "Thank them and enter", nextSection: 12, skillCheck: false},
                    {text: "Ask about the catacombs", nextSection: 24, skillCheck: false}
                ]
            }
        };
        
        // Initialize game
        function initGame() {
            updateStatsDisplay();
            updateInventoryDisplay();
            
            // If we have a current section from saved game, load it
            if (gameState.currentSection > 0) {
                loadSection(gameState.currentSection);
            } else {
                loadSection(0);
            }
        }
        
        // Show warning dialog for new game
        function showNewGameWarning() {
            // Show warning dialog
            document.getElementById('screen-game').classList.remove('active-screen');
            document.getElementById('warning-dialog').classList.add('active-screen');
        }
        
        // Cancel new game and return to game screen
        function cancelNewGame() {
            document.getElementById('warning-dialog').classList.remove('active-screen');
            document.getElementById('screen-game').classList.add('active-screen');
        }
        
        // Start new game - reset everything
        function startNewGame() {
            // Clear all saved game data
            localStorage.removeItem('dreadwoodGameState');
            
            // Reset game state to completely empty
            gameState = {
                playerClass: '',
                skill: 0,
                maxStamina: 0,
                stamina: 0,
                luck: 0,
                gold: 0,
                inventory: [],
                weapons: [],
                armor: [],
                currentSection: 0,
                gameComplete: false
            };
            
            // Redirect to level1.html to start fresh
            window.location.href = 'level1.html';
        }
        
        // Update stats display
        function updateStatsDisplay() {
            document.getElementById('stat-skill').textContent = gameState.skill;
            document.getElementById('stat-stamina').textContent = gameState.stamina;
            document.getElementById('stat-maxstamina').textContent = gameState.maxStamina;
            document.getElementById('stat-luck').textContent = gameState.luck;
            document.getElementById('stat-gold').textContent = gameState.gold;
        }
        
        // Update inventory display
        function updateInventoryDisplay() {
            const inventoryDiv = document.getElementById('inventory');
            inventoryDiv.innerHTML = '';
            
            // Show current weapon
            if (gameState.weapons && gameState.weapons.length > 0) {
                const weapon = gameState.weapons[gameState.weapons.length - 1];
                inventoryDiv.innerHTML += `<span class="inventory-item">${weapon.name} (${weapon.damage})</span>`;
            }
            
            // Show armor
            if (gameState.armor && gameState.armor.length > 0) {
                const armor = gameState.armor[0];
                inventoryDiv.innerHTML += `<span class="inventory-item">${armor.name} (${armor.defense} DEF)</span>`;
            }
            
            // Show gold
            inventoryDiv.innerHTML += `<span class="inventory-item">${gameState.gold} Gold</span>`;
            
            // Show other inventory items
            if (gameState.inventory) {
                gameState.inventory.forEach(item => {
                    if (item !== 'Dagger' && item !== 'Leather Armor') {
                        inventoryDiv.innerHTML += `<span class="inventory-item">${item}</span>`;
                    }
                });
            }
        }
        
        // Load story section
        function loadSection(sectionId) {
            gameState.currentSection = sectionId;
            const section = storySections[sectionId];
            
            if (!section) {
                // If section doesn't exist yet, show a placeholder
                document.getElementById('story-text').innerHTML = "<p>Your adventure in the City of Shadows continues... More content will be added in future updates!</p>";
                document.getElementById('choice-buttons').innerHTML = `
                    <button class="choice-btn" onclick="loadSection(0)">Return to City Entrance</button>
                `;
                return;
            }
            
            let storyText = section.text;
            
            // Execute any section action
            if (section.action) {
                const actionResult = section.action();
                if (actionResult) {
                    storyText += "<br><br>" + actionResult;
                }
            }
            
            document.getElementById('story-text').innerHTML = "<p>" + storyText + "</p>";
            
            // Clear and add choice buttons
            const choiceButtons = document.getElementById('choice-buttons');
            choiceButtons.innerHTML = '';
            
            section.choices.forEach(choice => {
                const button = document.createElement('button');
                button.className = 'choice-btn';
                button.textContent = choice.text;
                button.onclick = function() {
                    if (choice.skillCheck) {
                        performSkillCheck(choice.checkType, choice.difficulty, choice.nextSection);
                    } else {
                        loadSection(choice.nextSection);
                    }
                };
                choiceButtons.appendChild(button);
            });
            
            // Save game progress
            saveGame();
        }
        
        // Perform skill check
        function performSkillCheck(checkType, difficulty, nextSection) {
            const diceRoll = rollDiceHelper(2, 6);
            let statValue = gameState[checkType];
            let success = diceRoll <= statValue;
            
            // Store result globally for section actions to use
            window.checkResult = success;
            
            let resultText = `You roll ${diceRoll}. Your ${checkType.toUpperCase()} is ${statValue}. `;
            resultText += success ? 
                `<span class="success">Success!</span>` : 
                `<span class="damage">Failure!</span>`;
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${resultText}</div>`;
            
            // Continue to next section after a brief delay
            setTimeout(() => {
                loadSection(nextSection);
            }, 1500);
        }
        
        // Start combat (same as level1)
        function startCombat(enemyName, enemyStamina, enemySkill) {
            const playerAttack = rollDiceHelper(2, 6) + gameState.skill;
            const enemyAttack = rollDiceHelper(2, 6) + enemySkill;
            
            let resultText = `<span class="enemy">${enemyName}</span> (Skill: ${enemySkill}, Stamina: ${enemyStamina})<br>`;
            resultText += `You attack with ${playerAttack} vs enemy's ${enemyAttack}.<br>`;
            
            if (playerAttack > enemyAttack) {
                const damage = rollDiceHelper(1, 6);
                resultText += `<span class="success">You hit for ${damage} damage!</span>`;
                
                if (enemyStamina - damage <= 0) {
                    resultText += `<br><span class="success">You defeated the ${enemyName}!</span>`;
                    // Player gets some gold for victory
                    const goldReward = Math.floor(Math.random() * 20) + 5;
                    gameState.gold += goldReward;
                    resultText += `<br>You find ${goldReward} Gold on the body.`;
                }
            } else if (playerAttack < enemyAttack) {
                const damage = rollDiceHelper(1, 6);
                gameState.stamina -= damage;
                resultText += `<span class="damage">You are hit for ${damage} damage!</span>`;
                
                if (gameState.stamina <= 0) {
                    resultText += `<br><span class="game-over">You have been defeated! Game Over.</span>`;
                    // Reset game after delay
                    setTimeout(() => {
                        localStorage.removeItem('dreadwoodGameState');
                        location.reload();
                    }, 3000);
                }
            } else {
                resultText += "The attacks cancel each other out!";
            }
            
            updateStatsDisplay();
            
            // For combat result sections
            const combatResultSection = 100; // Use a section ID that doesn't conflict
            storySections[combatResultSection] = {
                text: resultText,
                choices: [
                    {text: "Continue", nextSection: 21, skillCheck: false}
                ]
            };
            
            return resultText;
        }
        
        // Use Luck (same as level1)
        function useLuck() {
            if (gameState.luck <= 0) {
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">You have no Luck left!</div>`;
                return;
            }
            
            const diceRoll = rollDiceHelper(2, 6);
            const success = diceRoll <= gameState.luck;
            
            gameState.luck -= 1;
            updateStatsDisplay();
            
            let resultText = `You test your Luck... Roll: ${diceRoll}, Luck: ${gameState.luck + 1}. `;
            resultText += success ? 
                `<span class="success">Lucky!</span> Something good happens.` : 
                `<span class="damage">Unlucky!</span> Something bad happens.`;
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${resultText}</div>`;
            
            // Apply Luck effect
            if (success) {
                // Good effect
                const goodEffects = [
                    "You find 5 Gold on the ground!",
                    "You feel a surge of energy! Restore 3 Stamina.",
                    "You spot a hidden path that might be useful."
                ];
                const effect = goodEffects[Math.floor(Math.random() * goodEffects.length)];
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">${effect}</div>`;
                
                if (effect.includes("Gold")) {
                    gameState.gold += 5;
                } else if (effect.includes("Stamina")) {
                    gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + 3);
                }
            } else {
                // Bad effect
                const badEffects = [
                    "You trip and take 2 damage!",
                    "You drop 3 Gold!",
                    "You feel weaker. Lose 1 Skill until next rest."
                ];
                const effect = badEffects[Math.floor(Math.random() * badEffects.length)];
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">${effect}</div>`;
                
                if (effect.includes("damage")) {
                    gameState.stamina -= 2;
                    if (gameState.stamina <= 0) {
                        document.getElementById('story-text').innerHTML += `<div class="game-over">You have been defeated! Game Over.</div>`;
                        setTimeout(() => {
                            localStorage.removeItem('dreadwoodGameState');
                            location.reload();
                        }, 3000);
                    }
                } else if (effect.includes("Gold")) {
                    gameState.gold = Math.max(0, gameState.gold - 3);
                } else if (effect.includes("Skill")) {
                    gameState.skill = Math.max(1, gameState.skill - 1);
                }
            }
            
            updateStatsDisplay();
            updateInventoryDisplay();
        }
        
        // Check inventory
        function checkInventory() {
            let inventoryText = "<h3>Your Inventory:</h3>";
            
            if (gameState.weapons && gameState.weapons.length > 0) {
                const weapon = gameState.weapons[gameState.weapons.length - 1];
                inventoryText += `<p><strong>Weapon:</strong> ${weapon.name} (${weapon.damage} damage)</p>`;
            }
            
            if (gameState.armor && gameState.armor.length > 0) {
                const armor = gameState.armor[0];
                inventoryText += `<p><strong>Armor:</strong> ${armor.name} (${armor.defense} DEF)</p>`;
            }
            
            inventoryText += `<p><strong>Gold:</strong> ${gameState.gold}</p>`;
            
            if (gameState.inventory && gameState.inventory.length > 0) {
                inventoryText += `<p><strong>Other Items:</strong> `;
                const otherItems = gameState.inventory.filter(item => 
                    item !== 'Dagger' && item !== 'Leather Armor' && 
                    !gameState.weapons.some(w => w.name === item) &&
                    !gameState.armor.some(a => a.name === item)
                );
                inventoryText += otherItems.join(', ') || 'None';
                inventoryText += `</p>`;
            }
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${inventoryText}</div>`;
        }
        
        // Save game
        function saveGame() {
            localStorage.setItem('dreadwoodGameState', JSON.stringify(gameState));
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">Game saved!</div>`;
        }
        
        // Go to next level (for future expansion)
        function goToLevel3() {
            saveGame();
            // In the future, this would go to level3.html
            alert("Level 3 coming soon! For now, your game has been saved.");
        }
        
        // Utility function to roll dice (same as level1)
        function rollDiceHelper(num, sides) {
            let total = 0;
            for (let i = 0; i < num; i++) {
                total += Math.floor(Math.random() * sides) + 1;
            }
            return total;
        }
        
        // Initialize on load
        window.onload = initGame;
    </script>
</body>
</html>
