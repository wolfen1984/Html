<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Castle of the Undead - Level 2</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'VT323', monospace;
            background-color: #000;
            color: #0f0;
            line-height: 1.2;
            height: 100vh;
            overflow: hidden;
            padding: 8px;
            position: relative;
            font-size: 18px;
            letter-spacing: 0.5px;
            text-shadow: 0 0 5px rgba(0, 255, 0, 0.7);
        }
        
        .screen {
            display: none;
            width: 100%;
            height: 100%;
            flex-direction: column;
            justify-content: flex-start;
        }
        
        .active {
            display: flex;
        }
        
        .game-header {
            padding: 8px 5px;
            border-bottom: 1px solid #0f0;
            display: flex;
            justify-content: space-between;
            font-size: 16px;
            background-color: #000;
            border: 1px solid #0f0;
            margin-bottom: 5px;
            padding: 5px 8px;
        }
        
        .game-title {
            color: #0f0;
            font-weight: normal;
            text-transform: uppercase;
        }
        
        .game-content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px;
            font-size: 18px;
            height: 60%;
            scroll-behavior: smooth;
            background-color: #000;
            border: 1px solid #0f0;
            margin-bottom: 5px;
            font-weight: normal;
        }
        
        .game-content p {
            margin-bottom: 8px;
            opacity: 0;
            animation: fadeIn 0.3s forwards;
            line-height: 1.3;
        }
        
        .input-line {
            display: flex;
            margin-top: 5px;
            align-items: center;
            background-color: #000;
            border: 1px solid #0f0;
            padding: 5px;
        }
        
        .prompt {
            margin-right: 8px;
            color: #0f0;
            font-weight: bold;
        }
        
        .game-input {
            flex-grow: 1;
            background: transparent;
            border: none;
            color: #0f0;
            font-family: 'VT323', monospace;
            font-size: 18px;
            outline: none;
            caret-color: #0f0;
            caret-shape: block;
            font-weight: normal;
        }
        
        .game-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
            padding: 10px 0;
            border-top: 1px dashed #333;
            height: 30%;
            overflow-y: auto;
        }
        
        .game-btn {
            background-color: #000;
            color: #0f0;
            border: 1px solid #0f0;
            padding: 10px 5px;
            font-family: 'VT323', monospace;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 0;
            text-align: center;
            font-weight: normal;
        }
        
        .game-btn:hover, .game-btn:active {
            background-color: #0f0;
            color: #000;
            box-shadow: 0 0 10px #0f0;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* CRT effect */
        body::after {
            content: " ";
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 2;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
            animation: flicker 0.15s infinite;
        }
        
        @keyframes flicker {
            0% { opacity: 0.97; }
            5% { opacity: 0.95; }
            10% { opacity: 0.97; }
            15% { opacity: 0.94; }
            20% { opacity: 0.99; }
            100% { opacity: 0.97; }
        }
        
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #000;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #0f0;
        }
        
        @keyframes blink-cursor {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        
        .game-input::placeholder {
            animation: blink-cursor 1s infinite;
            color: #0a0;
        }
        
        .game-header div {
            background-color: #000;
            padding: 2px 8px;
            border: 1px solid #0f0;
        }
        
        ::selection {
            background-color: #0f0;
            color: #000;
        }
    </style>
</head>
<body>
    <!-- Game Screen -->
    <div id="game-screen" class="screen active">
        <div class="game-header">
            <div class="game-title">CASTLE OF THE UNDEAD - LEVEL 2</div>
            <div>HEALTH: <span id="health">100</span> | GOLD: <span id="gold">0</span></div>
        </div>
        
        <div class="game-content" id="game-text">
            <p>> Loading Level 2: Castle Courtyard...</p>
            <p>> Game state restored from save...</p>
        </div>
        
        <div class="game-buttons" id="action-buttons">
            <!-- Buttons will be generated by JavaScript -->
        </div>
        
        <div class="input-line">
            <span class="prompt">&gt;</span>
            <input type="text" class="game-input" id="command-input" placeholder="Type command or use buttons..." autocomplete="off">
        </div>
    </div>
    
    <script>
        // ==============================================
        // GAME STATE
        // ==============================================
        
        let gameState = {
            location: 'castle_courtyard',
            health: 100,
            gold: 0,
            inventory: [],
            gameProgress: {
                level2Started: true,
                examinedFountain: false,
                examinedStatue: false,
                foundSecretDoor: false
            }
        };
        
        // ==============================================
        // GAME DATA FOR LEVEL 2
        // ==============================================
        
        const locations = {
            castle_courtyard: {
                name: "Castle Courtyard",
                description: "You stand in a dark, overgrown courtyard. The heavy gates slam shut behind you. A stone fountain stands in the center, filled with murky water. To the north, a grand staircase leads to the main hall. To the east, a collapsed corridor blocks your path. To the west, a mysterious statue of a knight guards a doorway. The air is cold and smells of damp earth.",
                items: ["silver_key"],
                npcs: [],
                objects: ["stone_fountain", "knight_statue", "grand_staircase", "collapsed_corridor"]
            }
        };
        
        const objects = {
            stone_fountain: {
                name: "Stone Fountain",
                description: "An ornate stone fountain with a cracked basin.",
                examine: "The fountain's water is stagnant and smells foul. At the bottom, you see something shiny - a silver key!"
            },
            knight_statue: {
                name: "Knight Statue",
                description: "A life-sized statue of a knight in full armor.",
                examine: "The statue holds a shield with a strange symbol. The eyes seem to follow you. There's a small inscription on the base: 'Only the worthy may pass.'"
            },
            grand_staircase: {
                name: "Grand Staircase",
                description: "A sweeping marble staircase leading to the main hall.",
                examine: "The stairs are covered in dust and cobwebs. You hear faint whispers from above..."
            },
            collapsed_corridor: {
                name: "Collapsed Corridor",
                description: "A hallway that has partially collapsed.",
                examine: "The corridor is completely blocked by fallen stones and debris. You'll need to find another way."
            }
        };
        
        const items = {
            silver_key: {
                name: "Silver Key",
                description: "A polished silver key with intricate designs.",
                usable: true
            },
            health_potion: {
                name: "Health Potion",
                description: "A small vial of red liquid. Restores 30 health.",
                usable: true
            }
        };
        
        // ==============================================
        // DOM ELEMENTS
        // ==============================================
        
        const gameScreen = document.getElementById('game-screen');
        const gameText = document.getElementById('game-text');
        const actionButtons = document.getElementById('action-buttons');
        const commandInput = document.getElementById('command-input');
        
        // ==============================================
        // GAME INITIALIZATION
        // ==============================================
        
        function init() {
            // Load saved game state
            loadGameState();
            
            // Start the game
            startGame();
            
            // Command input
            commandInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    processCommand(commandInput.value);
                    commandInput.value = '';
                }
            });
            
            // Update stats display
            updateStats();
        }
        
        function loadGameState() {
            const saved = localStorage.getItem('castleOfTheUndead_save');
            if (saved) {
                try {
                    const saveData = JSON.parse(saved);
                    
                    // Load stats from save
                    if (saveData.health !== undefined) gameState.health = saveData.health;
                    if (saveData.gold !== undefined) gameState.gold = saveData.gold;
                    if (saveData.inventory !== undefined) gameState.inventory = saveData.inventory;
                    
                    console.log('Level 2: Game state loaded:', saveData);
                    
                    // Add welcome message with loaded stats
                    addGameText(`> Health: ${gameState.health} | Gold: ${gameState.gold} | Items: ${gameState.inventory.length}`);
                    
                } catch (error) {
                    console.error('Error loading game state:', error);
                    addGameText("> Error loading saved game. Starting fresh...");
                }
            } else {
                addGameText("> No saved game found. Starting fresh...");
            }
        }
        
        function saveGameState() {
            const saveData = {
                health: gameState.health,
                gold: gameState.gold,
                inventory: gameState.inventory,
                gameProgress: gameState.gameProgress,
                currentLevel: 2
            };
            
            localStorage.setItem('castleOfTheUndead_save', JSON.stringify(saveData));
            console.log('Game state saved:', saveData);
            addGameText("> Game saved!");
        }
        
        function startGame() {
            addGameText("> Welcome to the Castle Courtyard!");
            addGameText("> The heavy gates close behind you with a loud thud.");
            addGameText("> You are now trapped inside the Castle of the Undead.");
            addGameText("");
            
            setTimeout(() => {
                describeLocation();
            }, 500);
        }
        
        // ==============================================
        // UTILITY FUNCTIONS
        // ==============================================
        
        function addGameText(text) {
            const p = document.createElement('p');
            p.textContent = text;
            gameText.appendChild(p);
            gameText.scrollTop = gameText.scrollHeight;
        }
        
        function updateStats() {
            document.getElementById('health').textContent = gameState.health;
            document.getElementById('gold').textContent = gameState.gold;
        }
        
        function createButton(text, action, className = '') {
            const button = document.createElement('button');
            button.textContent = text;
            button.className = `game-btn ${className}`;
            button.addEventListener('click', function(e) {
                if (action) action();
            });
            return button;
        }
        
        // ==============================================
        // GAME FLOW FUNCTIONS
        // ==============================================
        
        function describeLocation() {
            const location = locations[gameState.location];
            addGameText(`** ${location.name} **`);
            addGameText(location.description);
            updateActionButtons();
        }
        
        function updateActionButtons() {
            actionButtons.innerHTML = '';
            
            const location = locations[gameState.location];
            
            // Always show these buttons
            actionButtons.appendChild(createButton('LOOK', () => {
                addGameText(location.description);
            }));
            
            actionButtons.appendChild(createButton('INVENTORY', showInventory));
            
            // Show object examination buttons
            if (location.objects && location.objects.length > 0) {
                location.objects.forEach(objId => {
                    const obj = objects[objId];
                    actionButtons.appendChild(createButton(`EXAMINE ${obj.name}`, () => examineObject(objId)));
                });
            }
            
            // Show item pickup button if items exist
            if (location.items && location.items.length > 0 && !gameState.inventory.includes(location.items[0])) {
                actionButtons.appendChild(createButton(`TAKE ${items[location.items[0]].name}`, () => takeItem(location.items[0])));
            }
            
            // Special actions for Level 2
            actionButtons.appendChild(createButton('GO NORTH (Stairs)', () => {
                addGameText("You ascend the grand staircase to the main hall...");
                addGameText("> Level 3 coming soon!");
            }));
            
            actionButtons.appendChild(createButton('GO WEST (Statue)', () => {
                if (gameState.inventory.includes('silver_key')) {
                    addGameText("You use the silver key on the door behind the statue. It unlocks!");
                    addGameText("You enter a secret passage...");
                    addGameText("> Level 3 coming soon!");
                } else {
                    addGameText("The door behind the statue is locked. You need a key.");
                }
            }));
            
            actionButtons.appendChild(createButton('SAVE GAME', () => {
                saveGameState();
            }));
            
            actionButtons.appendChild(createButton('HELP', () => {
                addGameText("Commands: LOOK, EXAMINE [object], TAKE [item], USE [item], INVENTORY, GO [direction], SAVE.");
                addGameText("Explore the courtyard to find clues and items.");
            }));
        }
        
        // ==============================================
        // COMMAND PROCESSING
        // ==============================================
        
        function processCommand(command) {
            if (!command.trim()) return;
            
            addGameText(`> ${command}`);
            command = command.toLowerCase().trim();
            
            const parts = command.split(' ');
            const action = parts[0];
            const target = parts.slice(1).join(' ');
            
            switch(action) {
                case 'look':
                    addGameText(locations[gameState.location].description);
                    break;
                    
                case 'examine':
                    if (target) {
                        examineCommand(target);
                    } else {
                        addGameText("Examine what?");
                    }
                    break;
                    
                case 'take':
                    if (target.includes('key')) {
                        takeItem('silver_key');
                    } else {
                        addGameText("You can't take that.");
                    }
                    break;
                    
                case 'use':
                    if (target.includes('key')) {
                        if (gameState.inventory.includes('silver_key')) {
                            addGameText("You try the silver key on the door behind the statue. It fits perfectly!");
                            gameState.gameProgress.foundSecretDoor = true;
                        } else {
                            addGameText("You don't have that item.");
                        }
                    } else if (target.includes('potion')) {
                        useItem('health_potion');
                    } else {
                        addGameText("Use what?");
                    }
                    break;
                    
                case 'inventory':
                    showInventory();
                    break;
                    
                case 'go':
                case 'move':
                    if (target.includes('north') || target.includes('stairs')) {
                        addGameText("You ascend the grand staircase to the main hall...");
                        addGameText("> Level 3 coming soon!");
                    } else if (target.includes('west') || target.includes('statue')) {
                        if (gameState.inventory.includes('silver_key')) {
                            addGameText("You use the silver key on the door behind the statue. It unlocks!");
                            addGameText("You enter a secret passage...");
                            addGameText("> Level 3 coming soon!");
                        } else {
                            addGameText("The door behind the statue is locked. You need a key.");
                        }
                    } else if (target.includes('east')) {
                        addGameText("The corridor is completely collapsed. You can't go that way.");
                    } else {
                        addGameText("Go where?");
                    }
                    break;
                    
                case 'save':
                    saveGameState();
                    break;
                    
                case 'help':
                    addGameText("Commands: LOOK, EXAMINE [object], TAKE [item], USE [item], INVENTORY, GO [direction], SAVE.");
                    addGameText("Explore the courtyard to find clues and items.");
                    break;
                    
                default:
                    addGameText("I don't understand that command. Type HELP for assistance.");
            }
            
            updateActionButtons();
        }
        
        function examineCommand(target) {
            if (target.includes('fountain')) {
                examineObject('stone_fountain');
            } else if (target.includes('statue') || target.includes('knight')) {
                examineObject('knight_statue');
            } else if (target.includes('stair') || target.includes('stairs')) {
                examineObject('grand_staircase');
            } else if (target.includes('corridor') || target.includes('collapsed')) {
                examineObject('collapsed_corridor');
            } else {
                addGameText("You don't see that here.");
            }
        }
        
        // ==============================================
        // GAME OBJECT INTERACTIONS
        // ==============================================
        
        function examineObject(objId) {
            const obj = objects[objId];
            addGameText(`You examine the ${obj.name.toLowerCase()}:`);
            addGameText(obj.examine);
            
            // Update game progress
            if (objId === 'stone_fountain') gameState.gameProgress.examinedFountain = true;
            if (objId === 'knight_statue') gameState.gameProgress.examinedStatue = true;
            
            updateActionButtons();
        }
        
        function takeItem(itemId) {
            const location = locations[gameState.location];
            
            if (location.items && location.items.includes(itemId) && !gameState.inventory.includes(itemId)) {
                gameState.inventory.push(itemId);
                addGameText(`You take the ${items[itemId].name}.`);
                
                // Remove from location
                location.items = [];
                updateActionButtons();
            } else {
                addGameText("You can't take that.");
            }
        }
        
        function useItem(itemId) {
            if (gameState.inventory.includes(itemId)) {
                if (itemId === 'health_potion') {
                    gameState.health = Math.min(100, gameState.health + 30);
                    addGameText("You drink the health potion. You feel rejuvenated! Health +30");
                    removeFromInventory(itemId);
                    updateStats();
                }
            } else {
                addGameText("You don't have that item.");
            }
        }
        
        function showInventory() {
            addGameText("=== INVENTORY ===");
            if (gameState.inventory.length === 0) {
                addGameText("Your inventory is empty.");
            } else {
                gameState.inventory.forEach(itemId => {
                    const item = items[itemId];
                    addGameText(`- ${item.name}: ${item.description}`);
                });
            }
            addGameText("=================");
        }
        
        function removeFromInventory(itemId) {
            const index = gameState.inventory.indexOf(itemId);
            if (index > -1) {
                gameState.inventory.splice(index, 1);
            }
        }
        
        // ==============================================
        // INITIALIZE GAME
        // ==============================================
        
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
