<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vampires vs Werewolves - ASCII Edition</title>
<style>
    body {
        background-color: #000;
        color: #0f0;
        font-family: 'Courier New', monospace;
        margin: 0;
        padding: 20px;
        line-height: 1.4;
    }
    
    #game-container {
        max-width: 80ch;
        margin: 0 auto;
        border: 2px solid #0f0;
        padding: 20px;
        background-color: #000;
    }
    
    h1, h2, h3 {
        color: #0f0;
        text-align: center;
        border-bottom: 1px solid #0f0;
        padding-bottom: 5px;
    }
    
    h1 {
        font-size: 1.5em;
        margin-top: 0;
    }
    
    button {
        background-color: #000;
        color: #0f0;
        border: 1px solid #0f0;
        padding: 5px 10px;
        margin: 5px;
        font-family: 'Courier New', monospace;
        cursor: pointer;
    }
    
    button:hover {
        background-color: #0f0;
        color: #000;
    }
    
    button:active {
        background-color: #090;
    }
    
    .hidden {
        display: none;
    }
    
    .card {
        border: 1px solid #0f0;
        padding: 10px;
        margin: 5px;
        width: 30ch;
        display: inline-block;
        vertical-align: top;
    }
    
    .card h4 {
        margin-top: 0;
        color: #0f0;
    }
    
    .card p {
        margin-bottom: 5px;
    }
    
    .health-bar {
        width: 100%;
        height: 1em;
        border: 1px solid #0f0;
        margin: 5px 0;
    }
    
    .health-fill {
        height: 100%;
        background-color: #0f0;
    }
    
    .energy-orb {
        display: inline-block;
        width: 1em;
        height: 1em;
        border: 1px solid #0f0;
        margin-right: 3px;
    }
    
    .energy-orb.filled {
        background-color: #0f0;
    }
    
    #battle-log {
        height: 150px;
        overflow-y: auto;
        border: 1px solid #0f0;
        padding: 5px;
        margin: 10px 0;
    }
    
    #battle-log p {
        margin: 5px 0;
    }
    
    .common { color: #aaa; }
    .rare { color: #55f; }
    .epic { color: #f55; }
    .legendary { color: #ff5; }
    .ancient { color: #a5f; }
    
    .buff { color: #5f5; }
    .debuff { color: #f55; }
    .bleed { color: #a55; }
    .block { color: #55f; }
    
    .vampire { color: #f55; }
    .werewolf { color: #55f; }
    
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        display: none; /* Changed from flex to none */
        justify-content: center;
        align-items: center;
        z-index: 100;
    }
    
    .modal-content {
        background-color: #000;
        border: 2px solid #0f0;
        padding: 20px;
        max-width: 80%;
        max-height: 80%;
        overflow-y: auto;
    }
    
    .close-modal {
        float: right;
        margin: -10px -10px 0 0;
    }
    
    @media (max-width: 768px) {
        .card {
            width: 100%;
            display: block;
        }
    }
</style>
</head>
<body>
<div id="game-container">
    <h1>VAMPIRES vs WEREWOLVES - ASCII EDITION</h1>
    <h2>DECK BUILDER</h2>

    <!-- CLASS SELECTION -->
    <div id="class-selection">
        <p>Choose your faction:</p>
        <button class="vampire" onclick="chooseClass('Vampire')">VAMPIRE</button>
        <button class="werewolf" onclick="chooseClass('Werewolf')">WEREWOLF</button>
        
        <div style="margin: 20px 0;">
            <div style="text-align: left;">
                <h3>VAMPIRES</h3>
                <ul style="list-style-type: none; padding: 0;">
                    <li>+ Lifesteal abilities</li>
                    <li>+ Shadow magic</li>
                    <li>+ Lower health</li>
                    <li>+ Blood-based powers</li>
                </ul>
            </div>
            <div style="text-align: left;">
                <h3>WEREWOLVES</h3>
                <ul style="list-style-type: none; padding: 0;">
                    <li>+ Higher health</li>
                    <li>+ Stronger attacks</li>
                    <li>+ Pack tactics</li>
                    <li>+ Regeneration</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- PLAYER STATS -->
    <div id="stats" class="hidden">
        <h2 id="class-name"></h2>
        
        <div class="health-bar">
            <div class="health-fill" id="player-health-fill"></div>
        </div>
        <div id="player-health-text" style="text-align: center;"></div>
        
        <div style="margin: 10px 0;">
            <span style="color: #ff0;">GOLD: <span id="gold-display">0</span></span>
            <span style="margin-left: 20px; color: #0ff;">LEVEL: <span id="level-display">1</span></span>
        </div>
        
        <div id="status-effects" style="margin: 10px 0;"></div>
        
        <button class="vampire" onclick="startBattle()">START BATTLE</button>
        <button class="werewolf" onclick="enterShop()">ENTER SHOP</button>
        <button style="color: #ff0;" onclick="viewDeck()">VIEW DECK</button>
        
        <div id="deck-info" style="margin-top: 10px;">
            <p>DECK: <span id="deck-count">0</span> | DISCARD: <span id="discard-count">0</span></p>
            <p>NEXT ENEMY: <span id="next-enemy">Hunter</span></p>
        </div>
    </div>

    <!-- BATTLE SCREEN -->
    <div id="battle" class="hidden">
        <h2 id="battle-title"></h2>
        
        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
            <div style="text-align: left;">
                <h3>YOU</h3>
                <div class="health-bar">
                    <div class="health-fill" id="battle-player-health-fill"></div>
                </div>
                <div id="battle-player-health-text" style="text-align: center;"></div>
                <div id="battle-status-effects"></div>
            </div>
            
            <div style="text-align: right;">
                <h3 id="enemy-name">ENEMY</h3>
                <div class="health-bar">
                    <div class="health-fill" id="enemy-health-fill"></div>
                </div>
                <div id="enemy-health-text" style="text-align: center;"></div>
                <div id="enemy-status-effects"></div>
            </div>
        </div>
        
        <div class="energy-display" id="energy-display"></div>

        <div id="hand" style="margin: 10px 0;"></div>

        <div>
            <button class="vampire" onclick="endTurn()">END TURN</button>
            <button class="werewolf" onclick="toggleInventory()">INVENTORY (<span id="inventory-count">0</span>)</button>
            <button onclick="viewDiscard()">VIEW DISCARD</button>
        </div>

        <div id="inventory" class="hidden"></div>
        <div id="battle-log"></div>
    </div>

    <!-- REWARD SCREEN -->
    <div id="reward-screen" class="hidden">
        <h2>CHOOSE A REWARD:</h2>
        <div style="margin-bottom: 10px;">
            <button onclick="skipReward()">SKIP REWARD</button>
            <button onclick="getRandomCardReward()">RANDOM CARD (3 CHOICES)</button>
            <button onclick="getGoldReward()">TAKE <span id="gold-reward-amount">50</span> GOLD</button>
            <button onclick="getPotionReward()">RECEIVE POTIONS</button>
        </div>
        <div id="reward-cards"></div>
    </div>

    <!-- SHOP -->
    <div id="shop" class="hidden">
        <h2>SHOP - (GOLD: <span id="gold" style="color: #ff0;">0</span>)</h2>
        
        <div style="margin: 10px 0;">
            <button onclick="buyPotion()">HEALTH POTION (15 GOLD)</button>
            <button onclick="buyEnergyPotion()">ENERGY POTION (20 GOLD)</button>
            <button onclick="upgradeMaxHP()">UPGRADE MAX HP (25 GOLD)</button>
            <button onclick="upgradeEnergy()">UPGRADE MAX ENERGY (30 GOLD)</button>
            <button onclick="removeCard()">REMOVE CARD (25 GOLD)</button>
        </div>
        
        <h3>CARDS FOR SALE:</h3>
        <div id="shop-cards"></div>
        
        <button onclick="exitShop()">EXIT SHOP</button>
        <button onclick="rerollShop()">REROLL SHOP (10 GOLD)</button>
    </div>
</div>

<!-- DECK VIEW MODAL -->
<div id="deck-modal" class="modal-overlay">
    <div class="modal-content">
        <button class="close-modal" onclick="closeModal('deck-modal')">×</button>
        <h2>YOUR DECK (<span id="modal-deck-count">0</span> CARDS)</h2>
        <div id="modal-deck"></div>
    </div>
</div>

<!-- DISCARD VIEW MODAL -->
<div id="discard-modal" class="modal-overlay">
    <div class="modal-content">
        <button class="close-modal" onclick="closeModal('discard-modal')">×</button>
        <h2>DISCARD PILE (<span id="modal-discard-count">0</span> CARDS)</h2>
        <div id="modal-discard"></div>
    </div>
</div>

<script>
// Game State
let player = {
    class: "",
    maxHP: 0,
    hp: 0,
    inventory: [],
    deck: [],
    level: 1,
    xp: 0,
    maxEnergy: 2,
    buffs: []
};

let deck = [];
let hand = [];
let discard = [];
let energy = 0;
let gold = 50;
let buffedAttack = 0;
let block = 0;
let evadeNextAttack = false;
let enemyBleedStacks = 0;
let enemyBleedDamage = 0;
let shopRerollCost = 10;
let energyCarryover = 0;

// Card Database
const vampireCards = [
    {name:"BITE", cost:1, effect:"attack", value:8, rarity:"common", description:"Deal 8 damage", class:"Vampire"},
    {name:"BLOOD DRAIN", cost:2, effect:"lifesteal", value:6, rarity:"rare", description:"Deal 6 damage and heal for 6", class:"Vampire"},
    {name:"DARK MIST", cost:1, effect:"buff", value:3, rarity:"common", description:"Gain +3 attack next turn", class:"Vampire"},
    {name:"NIGHT SLASH", cost:2, effect:"attack", value:10, rarity:"epic", description:"Deal 10 damage", class:"Vampire"},
    {name:"VAMPIRIC TOUCH", cost:3, effect:"lifesteal", value:12, rarity:"epic", description:"Deal 12 damage and heal for 12", class:"Vampire"},
    {name:"SHADOW STEP", cost:1, effect:"evade", value:0, rarity:"rare", description:"Avoid next enemy attack", class:"Vampire"},
    {name:"BLOOD FRENZY", cost:2, effect:"multistrike", value:5, rarity:"rare", description:"Deal 5 damage twice", class:"Vampire"},
    {name:"MOONLIGHT", cost:0, effect:"heal", value:5, rarity:"common", description:"Heal 5 HP", class:"Vampire"},
    {name:"SANGUINE SHIELD", cost:2, effect:"block", value:8, rarity:"rare", description:"Gain 8 block", class:"Vampire"},
    {name:"HEMORRHAGE", cost:3, effect:"bleed", value:4, rarity:"epic", description:"Enemy takes 4 damage each turn for 3 turns", class:"Vampire"},
    {name:"BLOOD PACT", cost:1, effect:"sacrifice", value:5, rarity:"rare", description:"Lose 5 HP, draw 2 cards", class:"Vampire"},
    {name:"NOSFERATU'S KISS", cost:4, effect:"lifesteal", value:15, rarity:"legendary", description:"Deal 15 damage and heal for 15", class:"Vampire"},
    {name:"SHADOW VEIL", cost:2, effect:"evade", value:0, rarity:"epic", description:"Avoid next 2 enemy attacks", class:"Vampire"},
    {name:"CRIMSON RITUAL", cost:3, effect:"buff", value:5, rarity:"rare", description:"Gain +5 attack next 2 turns", class:"Vampire"},
    {name:"BLOOD MOON", cost:4, effect:"aoe", value:10, rarity:"legendary", description:"Deal 10 damage to all enemies", class:"Vampire"},
    {name:"ETERNAL THIRST", cost:2, effect:"lifesteal", value:8, rarity:"epic", description:"Deal 8 damage and heal for 8", class:"Vampire"},
    {name:"SOUL SIPHON", cost:3, effect:"drain", value:10, rarity:"ancient", description:"Deal 10 damage, heal for half", class:"Vampire"}
];

const werewolfCards = [
    {name:"CLAW SWIPE", cost:1, effect:"attack", value:7, rarity:"common", description:"Deal 7 damage", class:"Werewolf"},
    {name:"HOWL", cost:1, effect:"buff", value:4, rarity:"common", description:"Gain +4 attack next turn", class:"Werewolf"},
    {name:"REGENERATE", cost:2, effect:"heal", value:8, rarity:"rare", description:"Heal 8 HP", class:"Werewolf"},
    {name:"REND", cost:2, effect:"attack", value:12, rarity:"epic", description:"Deal 12 damage", class:"Werewolf"},
    {name:"SAVAGE STRIKE", cost:3, effect:"attack", value:18, rarity:"epic", description:"Deal 18 damage", class:"Werewolf"},
    {name:"PACK TACTICS", cost:1, effect:"draw", value:1, rarity:"rare", description:"Draw 1 card", class:"Werewolf"},
    {name:"FERAL ROAR", cost:2, effect:"buff", value:6, rarity:"rare", description:"Gain +6 attack next turn", class:"Werewolf"},
    {name:"POUNCE", cost:1, effect:"attack", value:5, rarity:"common", description:"Deal 5 damage", class:"Werewolf"},
    {name:"TOUGH HIDE", cost:2, effect:"block", value:10, rarity:"rare", description:"Gain 10 block", class:"Werewolf"},
    {name:"MOON FRENZY", cost:3, effect:"multistrike", value:8, rarity:"legendary", description:"Deal 8 damage three times", class:"Werewolf"},
    {name:"ALPHA HOWL", cost:2, effect:"buff", value:8, rarity:"epic", description:"Gain +8 attack next turn", class:"Werewolf"},
    {name:"LUNAR BLESSING", cost:3, effect:"heal", value:15, rarity:"epic", description:"Heal 15 HP", class:"Werewolf"},
    {name:"PACK LEADER", cost:2, effect:"draw", value:2, rarity:"rare", description:"Draw 2 cards", class:"Werewolf"},
    {name:"FURY SWIPES", cost:1, effect:"multistrike", value:4, rarity:"common", description:"Deal 4 damage twice", class:"Werewolf"},
    {name:"MOON'S WRATH", cost:4, effect:"attack", value:25, rarity:"legendary", description:"Deal 25 damage", class:"Werewolf"},
    {name:"PRIMAL ROAR", cost:3, effect:"aoe", value:12, rarity:"legendary", description:"Deal 12 damage to all enemies", class:"Werewolf"},
    {name:"ECLIPSE STRIKE", cost:5, effect:"attack", value:30, rarity:"ancient", description:"Deal 30 damage", class:"Werewolf"}
];

const neutralCards = [
    {name:"QUICK STRIKE", cost:0, effect:"attack", value:3, rarity:"common", description:"Deal 3 damage"},
    {name:"DEFEND", cost:1, effect:"block", value:5, rarity:"common", description:"Gain 5 block"},
    {name:"POWER UP", cost:1, effect:"energy", value:1, rarity:"rare", description:"Gain 1 energy"},
    {name:"SECOND WIND", cost:1, effect:"heal", value:4, rarity:"common", description:"Heal 4 HP"},
    {name:"PRECISION STRIKE", cost:2, effect:"attack", value:9, rarity:"rare", description:"Deal 9 damage"},
    {name:"ADRENALINE", cost:0, effect:"draw", value:1, rarity:"rare", description:"Draw 1 card"},
    {name:"COUNTER", cost:2, effect:"counter", value:6, rarity:"epic", description:"Deal 6 damage when attacked"},
    {name:"TAUNT", cost:1, effect:"taunt", value:0, rarity:"common", description:"Enemy is more likely to attack next turn"},
    {name:"DODGE", cost:1, effect:"evade", value:0, rarity:"rare", description:"50% chance to avoid next attack"},
    {name:"REJUVENATE", cost:2, effect:"heal", value:8, rarity:"rare", description:"Heal 8 HP"},
    {name:"DOUBLE STRIKE", cost:2, effect:"multistrike", value:5, rarity:"epic", description:"Deal 5 damage twice"},
    {name:"LAST STAND", cost:3, effect:"laststand", value:15, rarity:"legendary", description:"Deal 15 damage when below 25% HP"}
];

let enemies = [
    { name:"HUNTER", hp:40, maxHP:40, attack:6, ability:"buff", reward:15, description:"Gains strength each turn", avatar:"[H]" },
    { name:"PALADIN", hp:60, maxHP:60, attack:8, ability:"smite", reward:25, description:"Occasionally smites for massive damage", avatar:"[P]" },
    { name:"DEMON LORD", hp:100, maxHP:100, attack:12, ability:"fireball", reward:40, description:"Casts devastating fire spells", avatar:"[D]" },
    { name:"UNDEAD HORDE", hp:80, maxHP:80, attack:10, ability:"summon", reward:30, description:"Summons reinforcements", avatar:"[U]" },
    { name:"DARK SORCERER", hp:70, maxHP:70, attack:15, ability:"curse", reward:35, description:"Inflicts debilitating curses", avatar:"[S]" },
    { name:"DRAGON", hp:120, maxHP:120, attack:20, ability:"firebreath", reward:50, description:"Breathes fire every turn", avatar:"[DR]" },
    { name:"NECROMANCER", hp:90, maxHP:90, attack:12, ability:"raise", reward:45, description:"Raises fallen enemies", avatar:"[N]" },
    { name:"VAMPIRE HUNTER", hp:75, maxHP:75, attack:18, ability:"silver", reward:40, description:"Specialized against vampires", avatar:"[VH]" },
    { name:"WEREWOLF HUNTER", hp:85, maxHP:85, attack:16, ability:"silver", reward:40, description:"Specialized against werewolves", avatar:"[WH]" },
    { name:"ANCIENT LICH", hp:150, maxHP:150, attack:25, ability:"darkmagic", reward:75, description:"Master of dark arts", avatar:"[AL]" }
];

let currentEnemyIndex = 0;
let enemy = {};
let currentBattleEffects = [];
let enemyEffects = [];

// Initialize the game
window.onload = function() {
    // Hide all screens except class selection
    document.getElementById('class-selection').classList.remove('hidden');
    document.getElementById('stats').classList.add('hidden');
    document.getElementById('battle').classList.add('hidden');
    document.getElementById('reward-screen').classList.add('hidden');
    document.getElementById('shop').classList.add('hidden');
    
    // Ensure modals are hidden
    document.getElementById('deck-modal').style.display = 'none';
    document.getElementById('discard-modal').style.display = 'none';
};

// Game Functions
function chooseClass(chosenClass) {
    if (chosenClass === "Vampire") {
        player = { 
            class: "Vampire", 
            maxHP: 60,
            hp: 60,
            inventory: ["Health Potion", "Energy Potion"],
            deck: [
                getCardByName("BITE"),
                getCardByName("BLOOD DRAIN"),
                getCardByName("DARK MIST"),
                getCardByName("MOONLIGHT"),
                getCardByName("QUICK STRIKE"),
                getCardByName("DEFEND")
            ],
            level: 1,
            xp: 0,
            maxEnergy: 2
        };
    } else {
        player = { 
            class: "Werewolf", 
            maxHP: 70,
            hp: 70,
            inventory: ["Health Potion", "Energy Potion"],
            deck: [
                getCardByName("CLAW SWIPE"),
                getCardByName("HOWL"),
                getCardByName("REGENERATE"),
                getCardByName("POUNCE"),
                getCardByName("DEFEND"),
                getCardByName("QUICK STRIKE")
            ],
            level: 1,
            xp: 0,
            maxEnergy: 2
        };
    }

    deck = [...player.deck];
    shuffleDeck(deck);
    document.getElementById("class-selection").classList.add("hidden");
    document.getElementById("stats").classList.remove("hidden");
    document.getElementById("class-name").innerText = `YOU ARE A ${player.class.toUpperCase()}`;
    
    updatePlayerStats();
    updateDeckInfo();
    updateNextEnemy();
}

function getCardByName(name) {
    // Check vampire cards
    for (let card of vampireCards) {
        if (card.name === name) return {...card};
    }
    
    // Check werewolf cards
    for (let card of werewolfCards) {
        if (card.name === name) return {...card};
    }
    
    // Check neutral cards
    for (let card of neutralCards) {
        if (card.name === name) return {...card};
    }
    
    return null;
}

function shuffleDeck(deck) {
    for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
    }
}

function updatePlayerStats() {
    const healthPercent = (player.hp / player.maxHP) * 100;
    document.getElementById("player-health-fill").style.width = `${healthPercent}%`;
    document.getElementById("player-health-text").innerText = `${player.hp}/${player.maxHP}`;
    document.getElementById("battle-player-health-fill").style.width = `${healthPercent}%`;
    document.getElementById("battle-player-health-text").innerText = `${player.hp}/${player.maxHP}`;
    document.getElementById("gold-display").innerText = gold;
    document.getElementById("level-display").innerText = player.level;
    document.getElementById("inventory-count").innerText = player.inventory.length;
    
    // Update status effects
    updateStatusEffects();
}

function updateStatusEffects() {
    const effectsDiv = document.getElementById("status-effects");
    const battleEffectsDiv = document.getElementById("battle-status-effects");
    effectsDiv.innerHTML = "";
    battleEffectsDiv.innerHTML = "";
    
    if (buffedAttack > 0) {
        effectsDiv.innerHTML += `<span class="buff">+${buffedAttack} ATK</span> `;
        battleEffectsDiv.innerHTML += `<span class="buff">+${buffedAttack} ATK</span> `;
    }
    
    if (block > 0) {
        effectsDiv.innerHTML += `<span class="block">${block} BLK</span> `;
        battleEffectsDiv.innerHTML += `<span class="block">${block} BLK</span> `;
    }
    
    if (evadeNextAttack) {
        effectsDiv.innerHTML += `<span class="buff">EVADE</span> `;
        battleEffectsDiv.innerHTML += `<span class="buff">EVADE</span> `;
    }
}

function updateEnemyStatusEffects() {
    const effectsDiv = document.getElementById("enemy-status-effects");
    effectsDiv.innerHTML = "";
    
    if (enemyBleedStacks > 0) {
        effectsDiv.innerHTML += `<span class="bleed">BLEED (${enemyBleedStacks})</span> `;
    }
}

function updateDeckInfo() {
    document.getElementById("deck-count").innerText = deck.length;
    document.getElementById("discard-count").innerText = discard.length;
    document.getElementById("modal-deck-count").innerText = deck.length + hand.length;
    document.getElementById("modal-discard-count").innerText = discard.length;
}

function updateNextEnemy() {
    if (currentEnemyIndex < enemies.length) {
        document.getElementById("next-enemy").innerText = enemies[currentEnemyIndex].name;
    } else {
        document.getElementById("next-enemy").innerText = "FINAL BOSS";
    }
}

function startBattle() {
    enemy = {...enemies[currentEnemyIndex]};
    document.getElementById("stats").classList.add("hidden");
    document.getElementById("battle").classList.remove("hidden");
    document.getElementById("battle-title").innerText = `BATTLE ${currentEnemyIndex+1}: ${enemy.name}`;
    document.getElementById("enemy-name").innerText = enemy.name;
    
    // Reset battle state
    block = 0;
    evadeNextAttack = false;
    buffedAttack = 0;
    enemyBleedStacks = 0;
    enemyBleedDamage = 0;
    currentBattleEffects = [];
    enemyEffects = [];
    energyCarryover = 0;
    
    updateEnemyStats();
    energy = player.maxEnergy;
    updateEnergyDisplay();
    drawCards(5);
    renderInventory();
    log(`A WILD ${enemy.name} APPEARS! ${enemy.description}`);
}

function updateEnemyStats() {
    const healthPercent = (enemy.hp / enemy.maxHP) * 100;
    document.getElementById("enemy-health-fill").style.width = `${healthPercent}%`;
    document.getElementById("enemy-health-text").innerText = `${enemy.hp}/${enemy.maxHP}`;
    updateEnemyStatusEffects();
}

function updateEnergyDisplay() {
    let energyDiv = document.getElementById("energy-display");
    energyDiv.innerHTML = "ENERGY: ";
    for (let i = 0; i < player.maxEnergy; i++) {
        const orb = document.createElement("span");
        orb.className = "energy-orb" + (i < energy ? " filled" : "");
        energyDiv.appendChild(orb);
    }
}

function drawCards(amount = 5) {
    // If deck is empty, shuffle discard into deck
    if (deck.length === 0) {
        if (discard.length === 0) {
            log("NO CARDS LEFT TO DRAW!");
            return;
        }
        deck = [...discard];
        discard = [];
        shuffleDeck(deck);
        log("SHUFFLED DISCARD PILE INTO DECK!");
    }
    
    // Draw cards
    let cardsDrawn = 0;
    for (let i = 0; i < amount && deck.length > 0; i++) {
        let card = deck.shift();
        if (card) {
            hand.push(card);
            cardsDrawn++;
        }
    }
    
    if (cardsDrawn > 0) {
        log(`DREW ${cardsDrawn} CARD${cardsDrawn > 1 ? 'S' : ''}`);
    }
    
    renderHand();
    updateDeckInfo();
}

function renderHand() {
    let handDiv = document.getElementById("hand");
    handDiv.innerHTML = "";
    
    hand.forEach((card, index) => {
        const cardElement = document.createElement("div");
        cardElement.className = `card ${card.rarity}`;
        cardElement.onclick = () => playCard(index);
        
        const cardName = document.createElement("h4");
        cardName.textContent = card.name;
        
        const cardEffect = document.createElement("p");
        cardEffect.textContent = card.description;
        
        const cardCost = document.createElement("p");
        cardCost.textContent = `COST: ${card.cost}`;
        cardCost.style.color = "#0f0";
        
        cardElement.appendChild(cardName);
        cardElement.appendChild(cardEffect);
        cardElement.appendChild(cardCost);
        
        handDiv.appendChild(cardElement);
    });
}

function playCard(index) {
    if (index >= hand.length) return;
    
    let card = hand[index];
    if (energy < card.cost) {
        log("NOT ENOUGH ENERGY!");
        return;
    }
    
    energy -= card.cost;
    updateEnergyDisplay();

    // Card effects
    let effectApplied = false;
    
    if (card.effect === "attack") {
        const totalDamage = card.value + buffedAttack;
        enemy.hp -= totalDamage;
        log(`${card.name} DEALS ${totalDamage} DAMAGE!`);
        effectApplied = true;
    } 
    else if (card.effect === "lifesteal") {
        const totalDamage = card.value + buffedAttack;
        enemy.hp -= totalDamage;
        player.hp = Math.min(player.hp + totalDamage, player.maxHP);
        log(`${card.name} DRAINS ${totalDamage} HP!`);
        effectApplied = true;
    } 
    else if (card.effect === "buff") {
        buffedAttack += card.value;
        log(`${card.name} POWERS YOU UP (+${card.value} ATK NEXT TURN)!`);
        effectApplied = true;
    } 
    else if (card.effect === "heal") {
        player.hp = Math.min(player.hp + card.value, player.maxHP);
        log(`${card.name} HEALS ${card.value} HP`);
        effectApplied = true;
    }
    else if (card.effect === "evade") {
        evadeNextAttack = true;
        if (card.name === "SHADOW VEIL") {
            evadeNextAttack = 2;
        }
        log(`${card.name} - NEXT ENEMY ATTACK WILL MISS!`);
        effectApplied = true;
    }
    else if (card.effect === "multistrike") {
        const hits = card.name === "MOON FRENZY" ? 3 : 
                    card.name === "BLOOD FRENZY" ? 2 : 
                    card.name === "FURY SWIPES" ? 2 : 2;
        const totalDamage = (card.value + buffedAttack) * hits;
        enemy.hp -= totalDamage;
        log(`${card.name} HITS ${hits} TIMES FOR ${card.value + buffedAttack} DAMAGE EACH (${totalDamage} TOTAL)!`);
        effectApplied = true;
    }
    else if (card.effect === "block") {
        block += card.value;
        log(`${card.name} GIVES YOU ${card.value} BLOCK`);
        effectApplied = true;
    }
    else if (card.effect === "energy") {
        energy += card.value;
        updateEnergyDisplay();
        log(`${card.name} GIVES YOU ${card.value} ENERGY`);
        effectApplied = true;
    }
    else if (card.effect === "draw") {
        drawCards(card.value);
        log(`${card.name} LETS YOU DRAW ${card.value} CARD${card.value > 1 ? 'S' : ''}`);
        effectApplied = true;
    }
    else if (card.effect === "bleed") {
        enemyBleedStacks = 3;
        enemyBleedDamage = card.value;
        log(`${card.name} MAKES ENEMY BLEED FOR ${card.value} DAMAGE FOR 3 TURNS`);
        effectApplied = true;
    }
    else if (card.effect === "sacrifice") {
        player.hp -= card.value;
        drawCards(2);
        log(`${card.name} - LOSE ${card.value} HP TO DRAW 2 CARDS`);
        effectApplied = true;
    }
    else if (card.effect === "aoe") {
        enemy.hp -= card.value;
        log(`${card.name} DEALS ${card.value} DAMAGE TO ALL ENEMIES!`);
        effectApplied = true;
    }
    else if (card.effect === "drain") {
        const damage = card.value;
        enemy.hp -= damage;
        player.hp = Math.min(player.hp + Math.floor(damage/2), player.maxHP);
        log(`${card.name} DEALS ${damage} DAMAGE AND HEALS FOR ${Math.floor(damage/2)}`);
        effectApplied = true;
    }
    else if (card.effect === "laststand" && player.hp <= Math.floor(player.maxHP * 0.25)) {
        enemy.hp -= card.value;
        log(`${card.name} - LAST STAND DEALS ${card.value} DAMAGE!`);
        effectApplied = true;
    }
    
    if (effectApplied) {
        // Discard the card
        discard.push(card);
        hand.splice(index, 1);
        renderHand();
        updateDeckInfo();
        
        // Update stats displays
        updatePlayerStats();
        updateEnemyStats();

        // Win check
        if (enemy.hp <= 0) {
            enemy.hp = 0;
            updateEnemyStats();
            victory();
            return;
        }
    }
}

function enemyTurn() {
    // Apply bleed damage if active
    if (enemyBleedStacks > 0) {
        enemy.hp -= enemyBleedDamage;
        enemyBleedStacks--;
        log(`ENEMY BLEEDS FOR ${enemyBleedDamage} DAMAGE! (${enemyBleedStacks} TURNS LEFT)`);
        updateEnemyStats();
        
        if (enemy.hp <= 0) {
            enemy.hp = 0;
            updateEnemyStats();
            victory();
            return;
        }
    }
    
    if (evadeNextAttack) {
        if (typeof evadeNextAttack === 'number') {
            evadeNextAttack--;
            if (evadeNextAttack <= 0) {
                evadeNextAttack = false;
                log(`YOU EVADE THE ENEMY'S ATTACK! (NO MORE EVADES LEFT)`);
            } else {
                log(`YOU EVADE THE ENEMY'S ATTACK! (${evadeNextAttack} EVADES REMAINING)`);
            }
        } else {
            log(`YOU EVADE THE ENEMY'S ATTACK!`);
            evadeNextAttack = false;
        }
        return;
    }
    
    let damageTaken = 0;
    
    if (enemy.ability === "buff") {
        enemy.attack += 2;
        log(`${enemy.name} ENRAGES! ATTACK +2 (NOW ${enemy.attack})`);
    } 
    else if (enemy.ability === "smite" && Math.random() < 0.3) {
        const smiteDamage = enemy.attack + 5;
        damageTaken = Math.max(0, smiteDamage - block);
        block = Math.max(0, block - smiteDamage);
        player.hp -= damageTaken;
        log(`☄️ ${enemy.name} USES SMITE! DEALS ${smiteDamage} DAMAGE (${block > 0 ? `${block} BLOCKED` : ''})`);
    } 
    else if (enemy.ability === "fireball" && Math.random() < 0.4) {
        const fireDamage = 10;
        damageTaken = Math.max(0, fireDamage - block);
        block = Math.max(0, block - fireDamage);
        player.hp -= damageTaken;
        log(`🔥 ${enemy.name} CASTS FIREBALL! DEALS ${fireDamage} DAMAGE (${block > 0 ? `${block} BLOCKED` : ''})`);
    } 
    else if (enemy.ability === "summon" && Math.random() < 0.25) {
        enemy.hp += 10;
        log(`${enemy.name} SUMMONS REINFORCEMENTS! +10 HP`);
        updateEnemyStats();
    }
    else if (enemy.ability === "curse" && Math.random() < 0.3) {
        player.hp -= 5;
        log(`☠️ ${enemy.name} CURSES YOU! LOSE 5 HP`);
    }
    else if (enemy.ability === "firebreath") {
        const fireDamage = 8;
        damageTaken = Math.max(0, fireDamage - block);
        block = Math.max(0, block - fireDamage);
        player.hp -= damageTaken;
        log(`🔥 ${enemy.name} BREATHES FIRE! DEALS ${fireDamage} DAMAGE (${block > 0 ? `${block} BLOCKED` : ''})`);
    }
    else if (enemy.ability === "raise") {
        log(`${enemy.name} ATTEMPTS TO RAISE THE DEAD...`);
    }
    else if (enemy.ability === "silver") {
        const silverDamage = enemy.attack + 3;
        damageTaken = Math.max(0, silverDamage - block);
        block = Math.max(0, block - silverDamage);
        player.hp -= damageTaken;
        log(`⚔️ ${enemy.name} USES SILVER WEAPONS! DEALS ${silverDamage} DAMAGE (${block > 0 ? `${block} BLOCKED` : ''})`);
    }
    else if (enemy.ability === "darkmagic") {
        const magicDamage = 15;
        damageTaken = Math.max(0, magicDamage - block);
        block = Math.max(0, block - magicDamage);
        player.hp -= damageTaken;
        log(`☠️ ${enemy.name} CASTS DARK MAGIC! DEALS ${magicDamage} DAMAGE (${block > 0 ? `${block} BLOCKED` : ''})`);
    }
    else {
        // Normal attack
        damageTaken = Math.max(0, enemy.attack - block);
        block = Math.max(0, block - enemy.attack);
        player.hp -= damageTaken;
        log(`${enemy.name} ATTACKS FOR ${enemy.attack} DAMAGE (${block > 0 ? `${block} BLOCKED` : ''})`);
    }
    
    // Reset block after turn
    block = 0;
    
    updatePlayerStats();
    if (player.hp <= 0) {
        player.hp = 0;
        updatePlayerStats();
        endGame(false);
    }
}

function endTurn() {
    log("--- END OF TURN ---");
    
    // Apply buffed attack if any
    if (buffedAttack > 0) {
        log(`YOUR ATTACK BONUS FADES`);
        buffedAttack = 0;
    }
    
    // Track unused energy for next turn
    if (energy > 0) {
        energyCarryover = energy;
        log(`YOU HAVE ${energy} UNUSED ENERGY THAT WILL CARRY OVER TO NEXT TURN`);
    } else {
        energyCarryover = 0;
    }
    
    // Enemy turn
    if (enemy.hp > 0) {
        enemyTurn();
    }
    
    // Reset energy and draw cards
    energy = player.maxEnergy + energyCarryover;
    if (energy > player.maxEnergy + 10) {
        energy = player.maxEnergy + 10;
    }
    updateEnergyDisplay();
    discard.push(...hand);
    hand = [];
    drawCards(5);
    
    log("--- NEW TURN ---");
}

function toggleInventory() {
    document.getElementById("inventory").classList.toggle("hidden");
}

function renderInventory() {
    let invDiv = document.getElementById("inventory");
    invDiv.innerHTML = "<h3>INVENTORY</h3>";
    
    if (player.inventory.length === 0) {
        invDiv.innerHTML += "<p>YOUR INVENTORY IS EMPTY</p>";
        return;
    }
    
    player.inventory.forEach((item, index) => {
        const itemElement = document.createElement("div");
        itemElement.className = "card";
        itemElement.textContent = item;
        itemElement.onclick = () => useItem(index);
        invDiv.appendChild(itemElement);
    });
}

function useItem(index) {
    if (index >= player.inventory.length) return;
    
    let item = player.inventory[index];
    
    if (item === "Health Potion") {
        player.hp = Math.min(player.hp + 20, player.maxHP);
        log("USED HEALTH POTION! +20 HP");
    } 
    else if (item === "Energy Potion") {
        energy = player.maxEnergy;
        updateEnergyDisplay();
        log("USED ENERGY POTION! ENERGY RESTORED");
    }
    
    player.inventory.splice(index, 1);
    updatePlayerStats();
    renderInventory();
}

function victory() {
    const xpGain = 10 + currentEnemyIndex * 5;
    player.xp += xpGain;
    gold += enemy.reward;
    
    // Check for level up
    const xpNeeded = player.level * 20;
    if (player.xp >= xpNeeded) {
        player.level++;
        player.xp = 0;
        player.maxHP += 5;
        player.hp = player.maxHP;
        log(`LEVEL UP! YOU ARE NOW LEVEL ${player.level}! +5 MAX HP`);
    }
    
    log(`VICTORY! YOU DEFEATED ${enemy.name} AND EARNED ${enemy.reward} GOLD AND ${xpGain} XP!`);
    
    setTimeout(() => {
        currentEnemyIndex++;
        document.getElementById("battle").classList.add("hidden");
        
        if (currentEnemyIndex < enemies.length) {
            rewardScreen();
        } else {
            endGame(true);
        }
    }, 1500);
}

function rewardScreen() {
    document.getElementById("reward-screen").classList.remove("hidden");
    document.getElementById("gold-reward-amount").textContent = Math.floor(enemy.reward * 1.5);
    
    // Clear previous rewards
    document.getElementById("reward-cards").innerHTML = "";
    updatePlayerStats();
    updateNextEnemy();
}

function getRandomCardReward() {
    let rewardDiv = document.getElementById("reward-cards");
    rewardDiv.innerHTML = "";
    
    // Get all possible cards for the player's class
    let classCards = player.class === "Vampire" ? vampireCards : werewolfCards;
    let allCards = [...classCards, ...neutralCards];
    
    // Choose 3 random cards (with higher chance for better rarity)
    let rewards = [];
    for (let i = 0; i < 3; i++) {
        let rarityRoll = Math.random();
        let rarity;
        
        if (rarityRoll < 0.5) rarity = "common";
        else if (rarityRoll < 0.8) rarity = "rare";
        else if (rarityRoll < 0.95) rarity = "epic";
        else if (rarityRoll < 0.99) rarity = "legendary";
        else rarity = "ancient";
        
        // Filter cards by rarity and pick one randomly
        let eligibleCards = allCards.filter(card => card.rarity === rarity);
        if (eligibleCards.length === 0) {
            eligibleCards = allCards;
        }
        
        let card = {...eligibleCards[Math.floor(Math.random() * eligibleCards.length)]};
        rewards.push(card);
    }
    
    rewards.forEach(card => {
        const cardElement = document.createElement("div");
        cardElement.className = `card ${card.rarity}`;
        cardElement.onclick = () => chooseReward(card);
        
        const cardName = document.createElement("h4");
        cardName.textContent = card.name;
        
        const cardEffect = document.createElement("p");
        cardEffect.textContent = card.description;
        
        cardElement.appendChild(cardName);
        cardElement.appendChild(cardEffect);
        
        rewardDiv.appendChild(cardElement);
    });
}

function getGoldReward() {
    const goldAmount = Math.floor(enemy.reward * 1.5);
    gold += goldAmount;
    log(`YOU RECEIVED ${goldAmount} GOLD!`);
    document.getElementById("reward-screen").classList.add("hidden");
    document.getElementById("stats").classList.remove("hidden");
    updatePlayerStats();
}

function getPotionReward() {
    player.inventory.push("Health Potion", "Energy Potion");
    log(`YOU RECEIVED HEALTH POTION AND ENERGY POTION!`);
    document.getElementById("reward-screen").classList.add("hidden");
    document.getElementById("stats").classList.remove("hidden");
    updatePlayerStats();
}

function chooseReward(card) {
    deck.push({...card});
    log(`ADDED ${card.name} TO YOUR DECK!`);
    document.getElementById("reward-screen").classList.add("hidden");
    document.getElementById("stats").classList.remove("hidden");
    updatePlayerStats();
    updateDeckInfo();
}

function skipReward() {
    document.getElementById("reward-screen").classList.add("hidden");
    document.getElementById("stats").classList.remove("hidden");
}

function enterShop() {
    document.getElementById("stats").classList.add("hidden");
    document.getElementById("shop").classList.remove("hidden");
    document.getElementById("gold").innerText = gold;
    renderShop();
}

function renderShop() {
    let shopDiv = document.getElementById("shop-cards");
    shopDiv.innerHTML = "";
    
    // Get all possible cards for the player's class
    let classCards = player.class === "Vampire" ? vampireCards : werewolfCards;
    let allCards = [...classCards, ...neutralCards];
    
    // Select 6 random cards to offer (weighted by rarity)
    let shopOffers = [];
    for (let i = 0; i < 6; i++) {
        let rarityRoll = Math.random();
        let rarity;
        
        if (rarityRoll < 0.6) rarity = "common";
        else if (rarityRoll < 0.85) rarity = "rare";
        else if (rarityRoll < 0.97) rarity = "epic";
        else if (rarityRoll < 0.99) rarity = "legendary";
        else rarity = "ancient";
        
        // Filter cards by rarity and pick one randomly
        let eligibleCards = allCards.filter(card => card.rarity === rarity);
        if (eligibleCards.length === 0) {
            eligibleCards = allCards;
        }
        
        let card = {...eligibleCards[Math.floor(Math.random() * eligibleCards.length)]};
        shopOffers.push(card);
    }
    
    shopOffers.forEach(card => {
        const cardElement = document.createElement("div");
        cardElement.className = `card ${card.rarity}`;
        cardElement.onclick = () => buyCard(card);
        
        const cardName = document.createElement("h4");
        cardName.textContent = card.name;
        
        const cardEffect = document.createElement("p");
        cardEffect.textContent = card.description;
        
        const cardPrice = document.createElement("p");
        cardPrice.textContent = `${getCardCost(card)} GOLD`;
        cardPrice.style.color = "#ff0";
        
        cardElement.appendChild(cardName);
        cardElement.appendChild(cardEffect);
        cardElement.appendChild(cardPrice);
        
        shopDiv.appendChild(cardElement);
    });
}

function getCardCost(card) {
    switch(card.rarity) {
        case "common": return 20;
        case "rare": return 35;
        case "epic": return 60;
        case "legendary": return 100;
        case "ancient": return 150;
        default: return 25;
    }
}

function buyCard(card) {
    const cost = getCardCost(card);
    if (gold < cost) {
        alert(`NOT ENOUGH GOLD! NEED ${cost} GOLD.`);
        return;
    }
    
    deck.push({...card});
    gold -= cost;
    document.getElementById("gold").innerText = gold;
    updatePlayerStats();
    log(`PURCHASED ${card.name} FOR ${cost} GOLD!`);
    renderShop();
}

function buyPotion() {
    if (gold < 15) {
        alert("NOT ENOUGH GOLD! NEED 15 GOLD.");
        return;
    }
    
    player.inventory.push("Health Potion");
    gold -= 15;
    document.getElementById("gold").innerText = gold;
    updatePlayerStats();
    log(`PURCHASED HEALTH POTION FOR 15 GOLD!`);
}

function buyEnergyPotion() {
    if (gold < 20) {
        alert("NOT ENOUGH GOLD! NEED 20 GOLD.");
        return;
    }
    
    player.inventory.push("Energy Potion");
    gold -= 20;
    document.getElementById("gold").innerText = gold;
    updatePlayerStats();
    log(`PURCHASED ENERGY POTION FOR 20 GOLD!`);
}

function upgradeMaxHP() {
    if (gold < 25) {
        alert("NOT ENOUGH GOLD! NEED 25 GOLD.");
        return;
    }
    
    player.maxHP += 10;
    player.hp += 10;
    gold -= 25;
    document.getElementById("gold").innerText = gold;
    updatePlayerStats();
    log(`UPGRADED MAX HP BY 10 FOR 25 GOLD!`);
}

function upgradeEnergy() {
    if (gold < 30) {
        alert("NOT ENOUGH GOLD! NEED 30 GOLD.");
        return;
    }
    
    player.maxEnergy += 1;
    gold -= 30;
    document.getElementById("gold").innerText = gold;
    updatePlayerStats();
    log(`UPGRADED MAX ENERGY TO ${player.maxEnergy} FOR 30 GOLD!`);
}

function removeCard() {
    if (gold < 25) {
        alert("NOT ENOUGH GOLD! NEED 25 GOLD.");
        return;
    }
    
    if (deck.length + hand.length <= 5) {
        alert("YOUR DECK IS TOO SMALL TO REMOVE CARDS!");
        return;
    }
    
    showDeckForRemoval();
}

function showDeckForRemoval() {
    document.getElementById("deck-modal").style.display = 'flex';
    
    const modalDeck = document.getElementById("modal-deck");
    modalDeck.innerHTML = "";
    
    // Combine deck and hand for removal
    const allCards = [...deck, ...hand];
    
    if (allCards.length === 0) {
        modalDeck.innerHTML = "<p>NO CARDS TO REMOVE</p>";
        return;
    }
    
    allCards.forEach((card, index) => {
        const cardElement = document.createElement("div");
        cardElement.className = `card ${card.rarity}`;
        cardElement.onclick = () => removeCardFromDeck(index, card);
        
        const cardName = document.createElement("h4");
        cardName.textContent = card.name;
        
        const cardEffect = document.createElement("p");
        cardEffect.textContent = card.description;
        
        cardElement.appendChild(cardName);
        cardElement.appendChild(cardEffect);
        
        modalDeck.appendChild(cardElement);
    });
}

function removeCardFromDeck(index, card) {
    // Check if card is in hand or deck
    if (index < deck.length) {
        deck.splice(index, 1);
    } else {
        hand.splice(index - deck.length, 1);
    }
    
    gold -= 25;
    document.getElementById("gold").innerText = gold;
    updatePlayerStats();
    updateDeckInfo();
    log(`REMOVED ${card.name} FROM YOUR DECK FOR 25 GOLD`);
    closeModal("deck-modal");
}

function rerollShop() {
    if (gold < shopRerollCost) {
        alert(`NOT ENOUGH GOLD! NEED ${shopRerollCost} GOLD.`);
        return;
    }
    
    gold -= shopRerollCost;
    shopRerollCost += 5;
    document.getElementById("gold").innerText = gold;
    renderShop();
    log(`REROLLED SHOP FOR ${shopRerollCost-5} GOLD (NEXT REROLL: ${shopRerollCost} GOLD)`);
    updatePlayerStats();
}

function exitShop() {
    shopRerollCost = 10;
    document.getElementById("shop").classList.add("hidden");
    document.getElementById("stats").classList.remove("hidden");
}

function viewDeck() {
    document.getElementById("deck-modal").style.display = 'flex';
    
    const modalDeck = document.getElementById("modal-deck");
    modalDeck.innerHTML = "";
    
    // Combine deck and hand for viewing
    const allCards = [...deck, ...hand];
    
    if (allCards.length === 0) {
        modalDeck.innerHTML = "<p>YOUR DECK IS EMPTY</p>";
        return;
    }
    
    // Group cards by type
    const cardGroups = {
        attack: [],
        heal: [],
        buff: [],
        block: [],
        other: []
    };
    
    allCards.forEach(card => {
        if (card.effect === "attack" || card.effect === "lifesteal" || card.effect === "multistrike" || card.effect === "bleed") {
            cardGroups.attack.push(card);
        } else if (card.effect === "heal" || card.effect === "drain") {
            cardGroups.heal.push(card);
        } else if (card.effect === "buff") {
            cardGroups.buff.push(card);
        } else if (card.effect === "block") {
            cardGroups.block.push(card);
        } else {
            cardGroups.other.push(card);
        }
    });
    
    // Display by groups
    const groupNames = {
        attack: "ATTACK CARDS",
        heal: "HEALING CARDS",
        buff: "BUFF CARDS",
        block: "DEFENSE CARDS",
        other: "OTHER CARDS"
    };
    
    for (const [group, cards] of Object.entries(cardGroups)) {
        if (cards.length > 0) {
            const groupHeader = document.createElement("h3");
            groupHeader.textContent = groupNames[group];
            groupHeader.style.marginTop = "20px";
            groupHeader.style.color = "#aaa";
            modalDeck.appendChild(groupHeader);
            
            cards.forEach(card => {
                const cardElement = document.createElement("div");
                cardElement.className = `card ${card.rarity}`;
                
                const cardName = document.createElement("h4");
                cardName.textContent = card.name;
                
                const cardEffect = document.createElement("p");
                cardEffect.textContent = card.description;
                
                cardElement.appendChild(cardName);
                cardElement.appendChild(cardEffect);
                
                modalDeck.appendChild(cardElement);
            });
        }
    }
}

function viewDiscard() {
    document.getElementById("discard-modal").style.display = 'flex';
    
    const modalDiscard = document.getElementById("modal-discard");
    modalDiscard.innerHTML = "";
    
    if (discard.length === 0) {
        modalDiscard.innerHTML = "<p>YOUR DISCARD PILE IS EMPTY</p>";
        return;
    }
    
    discard.forEach(card => {
        const cardElement = document.createElement("div");
        cardElement.className = `card ${card.rarity}`;
        
        const cardName = document.createElement("h4");
        cardName.textContent = card.name;
        
        const cardEffect = document.createElement("p");
        cardEffect.textContent = card.description;
        
        cardElement.appendChild(cardName);
        cardElement.appendChild(cardEffect);
        
        modalDiscard.appendChild(cardElement);
    });
}

function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

function log(message) {
    let logDiv = document.getElementById("battle-log");
    logDiv.innerHTML += `<p>${message}</p>`;
    logDiv.scrollTop = logDiv.scrollHeight;
}

function endGame(victory) {
    if (victory) {
        alert(`CONGRATULATIONS! YOU DEFEATED ALL ENEMIES AND WON THE GAME WITH ${gold} GOLD AT LEVEL ${player.level}!`);
    } else {
        alert("GAME OVER - YOU WERE DEFEATED IN BATTLE");
    }
    location.reload();
}
</script>
</body>
</html>
