<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DreadWood: Swamp of Sorrows</title>
    <style>
        /* EXACT SAME STYLE as previous levels */
        body {
            font-family: 'Courier New', monospace;
            background-color: #0a0a2a;
            color: #33ff33;
            margin: 0;
            padding: 10px;
            line-height: 1.5;
            max-width: 100%;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 10px;
            border: 2px solid #33ff33;
            background-color: #000;
            box-shadow: 0 0 15px rgba(51, 255, 51, 0.5);
            position: relative;
            min-height: calc(100vh - 40px);
        }
        
        .header {
            text-align: center;
            border-bottom: 2px dashed #33ff33;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        h1 {
            color: #ff33ff;
            text-shadow: 0 0 5px #ff33ff;
            font-size: 28px;
            margin: 10px 0;
            letter-spacing: 2px;
        }
        
        h2 {
            color: #33ccff;
            border-bottom: 1px solid #33ccff;
            padding-bottom: 5px;
            margin-top: 25px;
        }
        
        .screen {
            display: none;
        }
        
        .active-screen {
            display: block;
        }
        
        .stats-bar {
            background-color: #111133;
            border: 1px solid #33ff33;
            padding: 10px;
            margin: 15px 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            font-size: 14px;
        }
        
        .stat-item {
            margin: 5px 10px;
        }
        
        .stat-value {
            color: #ffff33;
            font-weight: bold;
        }
        
        .inventory {
            background-color: #111122;
            border: 1px solid #ff33ff;
            padding: 10px;
            margin: 15px 0;
            min-height: 60px;
        }
        
        .inventory-item {
            display: inline-block;
            background-color: #222244;
            border: 1px solid #33ccff;
            padding: 5px 10px;
            margin: 5px;
            border-radius: 3px;
        }
        
        .story-text {
            background-color: #111111;
            border: 1px solid #33ff33;
            padding: 15px;
            margin: 20px 0;
            min-height: 150px;
            overflow-y: auto;
            max-height: 300px;
        }
        
        .choice-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        
        .choice-btn {
            background-color: #222244;
            color: #33ff33;
            border: 2px solid #33ff33;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
        }
        
        .choice-btn:hover, .choice-btn:active {
            background-color: #333366;
            color: #ffff33;
            border-color: #ffff33;
        }
        
        .action-buttons {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-top: 20px;
            gap: 10px;
        }
        
        .action-btn {
            background-color: #330033;
            color: #ff33ff;
            border: 2px solid #ff33ff;
            padding: 10px 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            cursor: pointer;
            flex-grow: 1;
            text-align: center;
        }
        
        .action-btn:hover, .action-btn:active {
            background-color: #550055;
            color: #ff99ff;
        }
        
        .dice-roll {
            background-color: #223322;
            border: 1px solid #33ff33;
            padding: 10px;
            margin: 10px 0;
            text-align: center;
            color: #ffff33;
        }
        
        .game-over {
            color: #ff3333;
            font-weight: bold;
            text-align: center;
            font-size: 24px;
            margin: 20px;
            text-shadow: 0 0 5px #ff3333;
        }
        
        .success {
            color: #33ff33;
            font-weight: bold;
        }
        
        .damage {
            color: #ff3333;
            font-weight: bold;
        }
        
        .enemy {
            color: #ff9933;
            font-weight: bold;
        }
        
        .next-level {
            text-align: center;
            margin-top: 20px;
            padding: 20px;
        }
        
        .next-level-btn {
            background-color: #003333;
            color: #33ff99;
            border: 2px solid #33ff99;
            padding: 15px 30px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .next-level-btn:hover, .next-level-btn:active {
            background-color: #005555;
            color: #99ffcc;
        }
        
        .retro-notice {
            text-align: center;
            color: #888888;
            font-size: 12px;
            margin-top: 20px;
            border-top: 1px solid #333333;
            padding-top: 10px;
        }
        
        .warning-dialog {
            background-color: #332222;
            border: 2px solid #ff3333;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .warning-text {
            color: #ff9933;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .dialog-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .dialog-btn {
            padding: 10px 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            cursor: pointer;
            border: 2px solid;
        }
        
        .dialog-btn-yes {
            background-color: #223322;
            color: #33ff33;
            border-color: #33ff33;
        }
        
        .dialog-btn-no {
            background-color: #332222;
            color: #ff3333;
            border-color: #ff3333;
        }
        
        .swamp-decoration {
            color: #33cc33;
            font-style: italic;
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 5px;
            }
            
            h1 {
                font-size: 22px;
            }
            
            .stats-bar {
                font-size: 12px;
            }
            
            .choice-btn {
                padding: 10px;
                font-size: 14px;
            }
            
            .dialog-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>DREADWOOD</h1>
            <h2>SWAMP OF SORROWS</h2>
            <div class="retro-notice">Level 3 - Your Adventure Continues</div>
        </div>
        
        <!-- Game Screen -->
        <div id="screen-game" class="screen active-screen">
            <div class="stats-bar">
                <div class="stat-item">SKILL: <span id="stat-skill" class="stat-value">0</span></div>
                <div class="stat-item">STAMINA: <span id="stat-stamina" class="stat-value">0</span>/<span id="stat-maxstamina" class="stat-value">0</span></div>
                <div class="stat-item">LUCK: <span id="stat-luck" class="stat-value">0</span></div>
                <div class="stat-item">GOLD: <span id="stat-gold" class="stat-value">0</span></div>
            </div>
            
            <h2>INVENTORY</h2>
            <div class="inventory" id="inventory">
                <!-- Inventory will be loaded from saved game -->
            </div>
            
            <h2>THE ADVENTURE</h2>
            <div class="story-text" id="story-text">
                <p>You stand at the edge of the <span class="swamp-decoration">SWAMP OF SORROWS</span>, a vast, mist-shrouded bog that reeks of decay and despair. The air is thick with mosquitoes and the distant croaking of unseen creatures. Before you stretches a treacherous path through the murky waters. Your journey through this foul place begins now...</p>
            </div>
            
            <div class="choice-buttons" id="choice-buttons">
                <button class="choice-btn" onclick="loadSection(1)">Follow the main path through the swamp</button>
                <button class="choice-btn" onclick="loadSection(2)">Take the left fork toward higher ground</button>
                <button class="choice-btn" onclick="loadSection(3)">Try to find a boat or raft</button>
            </div>
            
            <div class="action-buttons">
                <button class="action-btn" onclick="useLuck()">TEST LUCK</button>
                <button class="action-btn" onclick="checkInventory()">INVENTORY</button>
                <button class="action-btn" onclick="useItem()">USE ITEM</button>
                <button class="action-btn" onclick="saveGame()">SAVE GAME</button>
                <button class="action-btn" onclick="showNewGameWarning()">START NEW GAME</button>
            </div>
        </div>
        
        <!-- Warning Dialog for New Game -->
        <div id="warning-dialog" class="screen">
            <div class="warning-dialog">
                <div class="warning-text">WARNING: Starting a new game will delete ALL your current progress!</div>
                <p>Your current character, stats, inventory, and gold will be permanently erased.</p>
                <p>You will return to the beginning of the game to create a new character.</p>
                <div class="dialog-buttons">
                    <button class="dialog-btn dialog-btn-yes" onclick="startNewGame()">YES, START NEW GAME</button>
                    <button class="dialog-btn dialog-btn-no" onclick="cancelNewGame()">NO, KEEP MY CHARACTER</button>
                </div>
            </div>
        </div>
        
        <!-- Next Level Screen -->
        <div id="screen-next" class="screen">
            <h2>VICTORY!</h2>
            <div class="story-text">
                <p>You have survived the <span class="swamp-decoration">SWAMP OF SORROWS</span>!</p>
                <p>After navigating the treacherous bog and defeating its monstrous inhabitants, you emerge on the far side. Before you rises the ominous <span class="enemy">BLOODSTONE KEEP</span>, a fortress of dark stone that seems to bleed crimson in the fading light.</p>
                <p>Your journey continues... All your stats, gold, and inventory will carry over to the next chapter.</p>
                <div class="stats-bar">
                    <div class="stat-item">SKILL: <span id="next-stat-skill" class="stat-value">0</span></div>
                    <div class="stat-item">STAMINA: <span id="next-stat-stamina" class="stat-value">0</span></div>
                    <div class="stat-item">LUCK: <span id="next-stat-luck" class="stat-value">0</span></div>
                    <div class="stat-item">GOLD: <span id="next-stat-gold" class="stat-value">0</span></div>
                </div>
            </div>
            
            <div class="next-level">
                <button class="next-level-btn" onclick="goToNextLevel()">CONTINUE TO BLOODSTONE KEEP</button>
            </div>
        </div>
        
        <div class="retro-notice">
            DREADWOOD - A Retro Gamebook Adventure<br>
            Level 3: Swamp of Sorrows
        </div>
    </div>

    <script>
        // Game state (loaded from localStorage)
        let gameState = JSON.parse(localStorage.getItem('dreadwoodGameState')) || {
            playerClass: 'warrior',
            skill: 10,
            maxStamina: 18,
            stamina: 18,
            luck: 10,
            gold: 20,
            inventory: ['Dagger', 'Leather Armor'],
            weapons: [{name: 'Dagger', damage: '1d6'}],
            armor: [{name: 'Leather Armor', defense: 1}],
            currentWeaponIndex: 0,
            currentArmorIndex: 0,
            currentSection: 0,
            gameComplete: false
        };
        
        // Combat state
        let combatState = {
            active: false,
            enemyName: '',
            enemyStamina: 0,
            enemyCurrentStamina: 0,
            enemySkill: 0,
            nextSection: 0,
            round: 1
        };
        
        // Reset currentSection when starting a new level
        if (gameState.currentSection === 200 || gameState.gameComplete) {
            gameState.currentSection = 0;
            gameState.gameComplete = false;
        }
        
        // Ensure indices exist
        if (gameState.currentWeaponIndex === undefined) {
            gameState.currentWeaponIndex = gameState.weapons.length - 1;
        }
        if (gameState.currentArmorIndex === undefined) {
            gameState.currentArmorIndex = gameState.armor.length - 1;
        }
        
        // Level 3 story sections - SWAMP OF SORROWS (COMPLETE)
        const storySections = {
            0: {
                text: "You stand at the edge of the <span class='swamp-decoration'>SWAMP OF SORROWS</span>, a vast, mist-shrouded bog that reeks of decay and despair. The air is thick with mosquitoes and the distant croaking of unseen creatures. Before you stretches a treacherous path through the murky waters. Your journey through this foul place begins now...",
                choices: [
                    {text: "Follow the main path through the swamp", nextSection: 1, skillCheck: false},
                    {text: "Take the left fork toward higher ground", nextSection: 2, skillCheck: false},
                    {text: "Try to find a boat or raft", nextSection: 3, skillCheck: false}
                ]
            },
            1: {
                text: "You follow the main path, your boots sinking into the thick mud with each step. The mist grows thicker, reducing visibility to just a few feet. Suddenly, you hear a loud splash ahead!",
                choices: [
                    {text: "Draw your weapon and advance cautiously", nextSection: 4, skillCheck: false},
                    {text: "Hide behind a gnarled tree and wait", nextSection: 5, skillCheck: true, checkType: 'skill', difficulty: 10},
                    {text: "Call out to see who's there", nextSection: 6, skillCheck: false}
                ]
            },
            2: {
                text: "You take the left fork toward slightly higher ground. The path is less muddy but overgrown with thorny vines. You notice strange glowing mushrooms growing on a dead tree.",
                choices: [
                    {text: "Examine the glowing mushrooms", nextSection: 7, skillCheck: false},
                    {text: "Cut through the vines with your weapon", nextSection: 8, skillCheck: false},
                    {text: "Return to the main path", nextSection: 1, skillCheck: false}
                ]
            },
            3: {
                text: "You search along the swamp's edge and find a half-sunken canoe tied to a dead tree. It looks ancient but might still float.",
                choices: [
                    {text: "Take the canoe and paddle into the swamp", nextSection: 9, skillCheck: false},
                    {text: "Search the canoe for supplies first", nextSection: 10, skillCheck: true, checkType: 'luck', difficulty: 9},
                    {text: "Decide it's too risky and return to the path", nextSection: 1, skillCheck: false}
                ]
            },
            4: {
                text: "You draw your weapon and advance. Through the mist, you see a massive, slime-covered creature with tentacles emerging from the water! It's a SWAMP HORROR!",
                choices: [
                    {text: "Attack the creature", nextSection: 401, skillCheck: false},
                    {text: "Try to sneak around it", nextSection: 11, skillCheck: true, checkType: 'skill', difficulty: 12},
                    {text: "Throw something to distract it", nextSection: 12, skillCheck: false}
                ]
            },
            401: {
                text: "You face the Swamp Horror! Roll for the first attack!",
                choices: [
                    {text: "Attack!", nextSection: 402, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Swamp Horror";
                    combatState.enemyStamina = 14;
                    combatState.enemyCurrentStamina = 14;
                    combatState.enemySkill = 9;
                    combatState.nextSection = 13;
                    combatState.round = 1;
                    
                    return "Swamp Horror: Stamina " + combatState.enemyCurrentStamina + ", Skill " + combatState.enemySkill;
                }
            },
            5: {
                text: "You attempt to hide and wait...",
                choices: [
                    {text: "Continue", nextSection: 14, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        return "You successfully hide as a massive Swamp Horror lumbers past without noticing you. After it passes, you continue along the path.";
                    } else {
                        gameState.stamina -= 3;
                        updateStatsDisplay();
                        return "The Swamp Horror spots you! It lashes out with a tentacle! You take 3 damage.";
                    }
                }
            },
            6: {
                text: "You call out into the mist. A deep, gurgling voice replies, 'Who dares disturb my domain?' A massive shape emerges from the water!",
                choices: [
                    {text: "Apologize and try to talk your way out", nextSection: 15, skillCheck: true, checkType: 'luck', difficulty: 11},
                    {text: "Attack the creature", nextSection: 401, skillCheck: false},
                    {text: "Run back the way you came", nextSection: 16, skillCheck: false}
                ]
            },
            7: {
                text: "The glowing mushrooms pulse with a soft blue light. They seem magical in nature.",
                choices: [
                    {text: "Take some mushrooms", nextSection: 17, skillCheck: false},
                    {text: "Leave them and continue", nextSection: 18, skillCheck: false},
                    {text: "Eat one to see what happens", nextSection: 19, skillCheck: false}
                ]
            },
            8: {
                text: "You cut through the thorny vines, but they seem to bleed a dark red sap. As you clear a path, you uncover a stone marker with ancient runes.",
                choices: [
                    {text: "Examine the runes", nextSection: 20, skillCheck: true, checkType: 'skill', difficulty: 11},
                    {text: "Ignore it and continue", nextSection: 18, skillCheck: false},
                    {text: "Destroy the marker", nextSection: 21, skillCheck: false}
                ]
            },
            9: {
                text: "You bail water from the canoe and paddle into the swamp. The water is eerily calm. In the distance, you see what looks like a ruined temple emerging from the mist.",
                choices: [
                    {text: "Paddle toward the ruined temple", nextSection: 22, skillCheck: false},
                    {text: "Stay in the canoe and follow the waterway", nextSection: 23, skillCheck: false},
                    {text: "Return to shore", nextSection: 1, skillCheck: false}
                ]
            },
            10: {
                text: "You search the canoe...",
                choices: [
                    {text: "Continue", nextSection: 24, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        gameState.inventory.push("Waterproof Bag");
                        gameState.gold += 15;
                        updateInventoryDisplay();
                        updateStatsDisplay();
                        return "You find a waterproof bag containing 15 Gold and some dry rations!";
                    } else {
                        gameState.stamina -= 2;
                        updateStatsDisplay();
                        return "The canoe collapses as you search it, dumping you into the murky water. You scramble back to shore, soaked and lose 2 Stamina.";
                    }
                }
            },
            11: {
                text: "You attempt to sneak past the Swamp Horror...",
                choices: [
                    {text: "Continue", nextSection: 25, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        return "You successfully sneak past the Swamp Horror and continue deeper into the swamp.";
                    } else {
                        gameState.stamina -= 4;
                        updateStatsDisplay();
                        return "The Swamp Horror spots you and lashes out! You take 4 damage but manage to escape.";
                    }
                }
            },
            12: {
                text: "You throw a rock into the water to distract the creature. It works! The Swamp Horror moves toward the splash, giving you an opening.",
                choices: [
                    {text: "Sneak past while it's distracted", nextSection: 26, skillCheck: false},
                    {text: "Attack it from behind", nextSection: 401, skillCheck: false}
                ]
            },
            13: {
                text: "After defeating the Swamp Horror, you find something shiny in the mud where it was hiding.",
                choices: [
                    {text: "Examine the shiny object", nextSection: 27, skillCheck: false},
                    {text: "Continue along the path", nextSection: 28, skillCheck: false}
                ]
            },
            14: {
                text: window.checkResult ? 
                    "After the Swamp Horror passes, you continue along the path. The mist begins to clear slightly, revealing a fork ahead." : 
                    "You fight off the Swamp Horror's attack and continue along the path, wounded.",
                choices: [
                    {text: "Take the left fork", nextSection: 29, skillCheck: false},
                    {text: "Take the right fork", nextSection: 30, skillCheck: false},
                    {text: "Try to find another way", nextSection: 31, skillCheck: false}
                ]
            },
            15: {
                text: window.checkResult ? 
                    "'You have manners, at least,' the creature gurgles. 'Pass through, but beware the Will-o'-Wisps. They lead travelers to their doom.'" : 
                    "'Your words mean nothing!' the creature roars as it attacks!",
                choices: [
                    window.checkResult ? 
                        {text: "Thank the creature and continue", nextSection: 32, skillCheck: false} :
                        {text: "Fight for your life", nextSection: 401, skillCheck: false}
                ]
            },
            16: {
                text: "You run back the way you came, but the swamp seems to have shifted. You find yourself at a completely different location - an ancient stone bridge over a stagnant channel.",
                choices: [
                    {text: "Cross the bridge", nextSection: 33, skillCheck: false},
                    {text: "Follow the channel", nextSection: 34, skillCheck: false},
                    {text: "Rest and regain your bearings", nextSection: 35, skillCheck: false}
                ]
            },
            17: {
                text: "You carefully collect some of the glowing mushrooms. They pulse gently in your hand.",
                choices: [
                    {text: "Continue along the path", nextSection: 18, skillCheck: false}
                ],
                action: function() {
                    gameState.inventory.push("Glowing Swamp Mushrooms");
                    updateInventoryDisplay();
                    return "You collect some Glowing Swamp Mushrooms. They might be useful later.";
                }
            },
            18: {
                text: "You continue along the higher ground. The path winds through dead trees and patches of quicksand. You see strange lights dancing in the distance.",
                choices: [
                    {text: "Follow the strange lights", nextSection: 36, skillCheck: false},
                    {text: "Avoid the lights and stick to the path", nextSection: 37, skillCheck: false},
                    {text: "Investigate a nearby cave", nextSection: 38, skillCheck: false}
                ]
            },
            19: {
                text: "You eat one of the glowing mushrooms...",
                choices: [
                    {text: "Continue", nextSection: 39, skillCheck: false}
                ],
                action: function() {
                    const effect = rollDiceHelper(1, 6);
                    if (effect <= 2) {
                        gameState.stamina -= 5;
                        updateStatsDisplay();
                        return "The mushroom is poisonous! You lose 5 Stamina and feel very ill.";
                    } else if (effect <= 4) {
                        gameState.skill += 1;
                        updateStatsDisplay();
                        return "The mushroom has a strange energizing effect! Your Skill increases by 1!";
                    } else {
                        gameState.luck += 2;
                        updateStatsDisplay();
                        return "The mushroom makes you feel incredibly lucky! Your Luck increases by 2!";
                    }
                }
            },
            20: {
                text: window.checkResult ? 
                    "The runes are a warning: 'Beware the Sorrowful Ones who dwell beneath. They hunger for the living.' The marker also shows a safe path through pictograms." : 
                    "You can't decipher the ancient runes. They look like warnings, but you're not sure.",
                choices: [
                    {text: "Follow the safe path if deciphered", nextSection: window.checkResult ? 40 : 18, skillCheck: false},
                    {text: "Ignore it and continue", nextSection: 18, skillCheck: false}
                ]
            },
            21: {
                text: "You smash the stone marker. Suddenly, the ground trembles and ghostly wails echo through the swamp!",
                choices: [
                    {text: "Run!", nextSection: 41, skillCheck: false},
                    {text: "Stand your ground", nextSection: 42, skillCheck: false}
                ]
            },
            22: {
                text: "You paddle to the ruined temple. It's overgrown with swamp plants, but you can see an entrance. Strange carvings cover the stone walls.",
                choices: [
                    {text: "Enter the temple", nextSection: 43, skillCheck: false},
                    {text: "Search outside the temple first", nextSection: 44, skillCheck: false},
                    {text: "Leave and continue by canoe", nextSection: 23, skillCheck: false}
                ]
            },
            23: {
                text: "You follow the waterway. The canoe starts to take on water! You need to find solid ground soon.",
                choices: [
                    {text: "Bail water and keep going", nextSection: 45, skillCheck: true, checkType: 'skill', difficulty: 10},
                    {text: "Head for the nearest shore", nextSection: 46, skillCheck: false},
                    {text: "Abandon the canoe and swim", nextSection: 47, skillCheck: false}
                ]
            },
            24: {
                text: window.checkResult ? 
                    "With your newfound supplies, you decide what to do next." : 
                    "Soaked and frustrated, you decide what to do next.",
                choices: [
                    {text: "Take the canoe anyway", nextSection: 9, skillCheck: false},
                    {text: "Return to the main path", nextSection: 1, skillCheck: false}
                ]
            },
            25: {
                text: window.checkResult ? 
                    "You successfully sneak past and find the path continues to a murky pool with strange bubbles rising to the surface." : 
                    "You escape the Swamp Horror and find yourself at a murky pool.",
                choices: [
                    {text: "Investigate the bubbling pool", nextSection: 48, skillCheck: false},
                    {text: "Circle around the pool", nextSection: 49, skillCheck: false},
                    {text: "Wait and observe", nextSection: 50, skillCheck: false}
                ]
            },
            26: {
                text: "You sneak past the distracted Swamp Horror and continue deeper into the swamp. You come to an area with several large, bubbling mud pits.",
                choices: [
                    {text: "Try to cross the mud pits", nextSection: 51, skillCheck: true, checkType: 'skill', difficulty: 11},
                    {text: "Look for another way around", nextSection: 52, skillCheck: false},
                    {text: "Test the mud with a long stick", nextSection: 53, skillCheck: false}
                ]
            },
            27: {
                text: "You dig in the mud and find a rusted but still usable short sword and a waterlogged pouch containing 25 Gold!",
                choices: [
                    {text: "Take the items and continue", nextSection: 28, skillCheck: false}
                ],
                action: function() {
                    gameState.weapons.push({name: 'Rusted Short Sword', damage: '1d6+1'});
                    gameState.gold += 25;
                    updateInventoryDisplay();
                    updateStatsDisplay();
                    return "You find a Rusted Short Sword (1d6+1 damage) and 25 Gold!";
                }
            },
            28: {
                text: "The path continues through increasingly difficult terrain. The air grows colder, and you hear strange whispers on the wind.",
                choices: [
                    {text: "Follow the whispers", nextSection: 54, skillCheck: false},
                    {text: "Cover your ears and hurry forward", nextSection: 55, skillCheck: false},
                    {text: "Try to communicate with the whispers", nextSection: 56, skillCheck: true, checkType: 'luck', difficulty: 12}
                ]
            },
            29: {
                text: "The left fork leads to a clearing with a circle of standing stones. In the center lies a skeleton clutching a journal.",
                choices: [
                    {text: "Examine the skeleton and journal", nextSection: 57, skillCheck: false},
                    {text: "Stay at the edge of the clearing", nextSection: 58, skillCheck: false},
                    {text: "Leave quickly", nextSection: 59, skillCheck: false}
                ]
            },
            30: {
                text: "The right fork descends into a particularly foul-smelling area of the swamp. The water here is black and oily. You see movement beneath the surface.",
                choices: [
                    {text: "Continue carefully", nextSection: 60, skillCheck: false},
                    {text: "Throw something into the water to test it", nextSection: 61, skillCheck: false},
                    {text: "Go back and take the left fork", nextSection: 29, skillCheck: false}
                ]
            },
            31: {
                text: "You try to find another way and discover a hidden animal trail. It's narrow but seems passable.",
                choices: [
                    {text: "Follow the animal trail", nextSection: 62, skillCheck: false},
                    {text: "Return to the fork", nextSection: 63, skillCheck: false}
                ]
            },
            32: {
                text: "You continue deeper into the swamp, heeding the creature's warning. Soon you see the Will-o'-Wisps - eerie blue lights that dance just out of reach.",
                choices: [
                    {text: "Follow the Will-o'-Wisps", nextSection: 64, skillCheck: false},
                    {text: "Avoid them as warned", nextSection: 65, skillCheck: false},
                    {text: "Try to catch one", nextSection: 66, skillCheck: false}
                ]
            },
            33: {
                text: "You cross the ancient stone bridge. Midway across, ghostly figures rise from the water below! They are the SPECTERS OF THE SWAMP!",
                choices: [
                    {text: "Fight the specters", nextSection: 3301, skillCheck: false},
                    {text: "Run across the bridge", nextSection: 67, skillCheck: true, checkType: 'skill', difficulty: 13},
                    {text: "Jump into the water", nextSection: 68, skillCheck: false}
                ]
            },
            3301: {
                text: "You face the Specters of the Swamp! Roll for the first attack!",
                choices: [
                    {text: "Attack!", nextSection: 3302, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Swamp Specters";
                    combatState.enemyStamina = 12;
                    combatState.enemyCurrentStamina = 12;
                    combatState.enemySkill = 11;
                    combatState.nextSection = 69;
                    combatState.round = 1;
                    
                    return "Swamp Specters: Stamina " + combatState.enemyCurrentStamina + ", Skill " + combatState.enemySkill;
                }
            },
            34: {
                text: "You follow the stagnant channel. The water becomes increasingly foul, and you start to feel dizzy from the fumes.",
                choices: [
                    {text: "Continue despite the fumes", nextSection: 70, skillCheck: true, checkType: 'stamina', difficulty: 14},
                    {text: "Cover your mouth and press on", nextSection: 71, skillCheck: false},
                    {text: "Turn back", nextSection: 72, skillCheck: false}
                ]
            },
            35: {
                text: "You find a relatively dry spot to rest. As you catch your breath, you notice something moving in the water nearby.",
                choices: [
                    {text: "Investigate the movement", nextSection: 73, skillCheck: false},
                    {text: "Ignore it and continue resting", nextSection: 74, skillCheck: false},
                    {text: "Leave immediately", nextSection: 75, skillCheck: false}
                ]
            },
            36: {
                text: "You follow the strange lights. They lead you to a beautiful, calm pool with crystal clear water - a stark contrast to the rest of the swamp. A figure sits by the water's edge.",
                choices: [
                    {text: "Approach the figure", nextSection: 76, skillCheck: false},
                    {text: "Drink from the clear pool", nextSection: 77, skillCheck: false},
                    {text: "Leave quietly", nextSection: 78, skillCheck: false}
                ]
            },
            37: {
                text: "You avoid the strange lights and stick to the path. It's difficult going, but you make steady progress. You come across the wreck of a wagon half-sunk in the mud.",
                choices: [
                    {text: "Search the wagon wreck", nextSection: 79, skillCheck: false},
                    {text: "Continue past it", nextSection: 80, skillCheck: false},
                    {text: "Use the wagon for shelter", nextSection: 81, skillCheck: false}
                ]
            },
            38: {
                text: "You enter the cave. It's damp and dark, but there's a faint light coming from deeper inside. You hear dripping water and something else... a soft chanting.",
                choices: [
                    {text: "Move toward the light and chanting", nextSection: 82, skillCheck: false},
                    {text: "Call out to see who's there", nextSection: 83, skillCheck: false},
                    {text: "Leave the cave", nextSection: 84, skillCheck: false}
                ]
            },
            39: {
                text: "The effects of the mushroom wear off. You need to continue your journey.",
                choices: [
                    {text: "Continue along the path", nextSection: 18, skillCheck: false}
                ]
            },
            40: {
                text: "Following the safe path shown on the marker, you navigate through a particularly treacherous area with surprising ease. The path leads to solid ground and a clear view of the swamp's exit!",
                choices: [
                    {text: "Head toward the exit", nextSection: 85, skillCheck: false},
                    {text: "Search the area first", nextSection: 86, skillCheck: false}
                ]
            },
            41: {
                text: "You run as ghostly hands reach from the ground! One grabs your ankle, but you break free, losing 3 Stamina in the process.",
                choices: [
                    {text: "Keep running", nextSection: 87, skillCheck: false}
                ],
                action: function() {
                    gameState.stamina -= 3;
                    updateStatsDisplay();
                }
            },
            42: {
                text: "You stand your ground as spectral forms rise from the swamp. They are ANGRY SPIRITS seeking vengeance!",
                choices: [
                    {text: "Fight the spirits", nextSection: 4201, skillCheck: false},
                    {text: "Try to calm them", nextSection: 88, skillCheck: true, checkType: 'luck', difficulty: 14},
                    {text: "Flee", nextSection: 41, skillCheck: false}
                ]
            },
            4201: {
                text: "You face the Angry Swamp Spirits! Roll for the first attack!",
                choices: [
                    {text: "Attack!", nextSection: 4202, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Angry Swamp Spirits";
                    combatState.enemyStamina = 16;
                    combatState.enemyCurrentStamina = 16;
                    combatState.enemySkill = 10;
                    combatState.nextSection = 89;
                    combatState.round = 1;
                    
                    return "Angry Swamp Spirits: Stamina " + combatState.enemyCurrentStamina + ", Skill " + combatState.enemySkill;
                }
            },
            43: {
                text: "Inside the ruined temple, you find ancient murals depicting swamp rituals. At the altar lies a crystal that pulses with green light.",
                choices: [
                    {text: "Take the crystal", nextSection: 90, skillCheck: false},
                    {text: "Study the murals", nextSection: 91, skillCheck: true, checkType: 'skill', difficulty: 12},
                    {text: "Leave the temple", nextSection: 92, skillCheck: false}
                ]
            },
            44: {
                text: "Outside the temple, you find overgrown statues of swamp deities. One has a offering bowl at its feet that contains several gold coins.",
                choices: [
                    {text: "Take the gold", nextSection: 93, skillCheck: false},
                    {text: "Leave the offering", nextSection: 92, skillCheck: false},
                    {text: "Make your own offering", nextSection: 94, skillCheck: false}
                ]
            },
            45: {
                text: window.checkResult ? 
                    "You successfully bail water and keep the canoe afloat. You navigate to a solid island in the swamp." : 
                    "The canoe sinks! You swim to the nearest solid ground, losing 4 Stamina in the process.",
                choices: [
                    {text: "Explore the island", nextSection: 95, skillCheck: false}
                ],
                action: function() {
                    if (!window.checkResult) {
                        gameState.stamina -= 4;
                        updateStatsDisplay();
                    }
                }
            },
            46: {
                text: "You paddle to shore and abandon the canoe. The ground here is firm, and you can see a path leading away from the water.",
                choices: [
                    {text: "Follow the path", nextSection: 96, skillCheck: false}
                ]
            },
            47: {
                text: "You abandon the canoe and swim. The water is cold and filled with strange creatures that brush against your legs. You lose 5 Stamina but reach solid ground.",
                choices: [
                    {text: "Continue on foot", nextSection: 96, skillCheck: false}
                ],
                action: function() {
                    gameState.stamina -= 5;
                    updateStatsDisplay();
                }
            },
            48: {
                text: "You investigate the bubbling pool. As you lean over, a giant FROGHEMOTH emerges and tries to drag you in!",
                choices: [
                    {text: "Fight the Froghemoth", nextSection: 4801, skillCheck: false},
                    {text: "Try to escape its tongue", nextSection: 97, skillCheck: true, checkType: 'skill', difficulty: 11},
                    {text: "Cut its tongue with your weapon", nextSection: 98, skillCheck: false}
                ]
            },
            4801: {
                text: "You face the Giant Froghemoth! Roll for the first attack!",
                choices: [
                    {text: "Attack!", nextSection: 4802, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Giant Froghemoth";
                    combatState.enemyStamina = 18;
                    combatState.enemyCurrentStamina = 18;
                    combatState.enemySkill = 8;
                    combatState.nextSection = 99;
                    combatState.round = 1;
                    
                    return "Giant Froghemoth: Stamina " + combatState.enemyCurrentStamina + ", Skill " + combatState.enemySkill;
                }
            },
            49: {
                text: "You circle around the pool and find a hidden path that leads to a dry hillock. From here, you can see the far edge of the swamp!",
                choices: [
                    {text: "Head toward the edge of the swamp", nextSection: 100, skillCheck: false},
                    {text: "Rest on the hillock first", nextSection: 101, skillCheck: false}
                ]
            },
            50: {
                text: "You wait and observe. The bubbles stop, and the water grows still. A beautiful water lily floats to the surface with something shiny at its center.",
                choices: [
                    {text: "Retrieve the shiny object", nextSection: 102, skillCheck: false},
                    {text: "Leave it and move on", nextSection: 103, skillCheck: false}
                ]
            },
            51: {
                text: window.checkResult ? 
                    "You skillfully cross the mud pits, using solid-looking clumps as stepping stones." : 
                    "You misstep and sink into a mud pit! You lose 6 Stamina struggling free.",
                choices: [
                    {text: "Continue", nextSection: 104, skillCheck: false}
                ],
                action: function() {
                    if (!window.checkResult) {
                        gameState.stamina -= 6;
                        updateStatsDisplay();
                    }
                }
            },
            52: {
                text: "You find a longer but safer path around the mud pits. It takes extra time, but you avoid the danger.",
                choices: [
                    {text: "Continue", nextSection: 104, skillCheck: false}
                ]
            },
            53: {
                text: "You test the mud and discover which areas are solid. With careful testing, you navigate safely across.",
                choices: [
                    {text: "Continue", nextSection: 104, skillCheck: false}
                ]
            },
            54: {
                text: "The whispers lead you to a circle of ghostly figures. They are the SPIRITS OF LOST TRAVELERS. 'Join us,' they whisper. 'Rest here forever.'",
                choices: [
                    {text: "Fight the spirits", nextSection: 5401, skillCheck: false},
                    {text: "Try to reason with them", nextSection: 105, skillCheck: true, checkType: 'luck', difficulty: 13},
                    {text: "Flee", nextSection: 106, skillCheck: false}
                ]
            },
            5401: {
                text: "You face the Spirits of Lost Travelers! Roll for the first attack!",
                choices: [
                    {text: "Attack!", nextSection: 5402, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Lost Traveler Spirits";
                    combatState.enemyStamina = 10;
                    combatState.enemyCurrentStamina = 10;
                    combatState.enemySkill = 12;
                    combatState.nextSection = 107;
                    combatState.round = 1;
                    
                    return "Lost Traveler Spirits: Stamina " + combatState.enemyCurrentStamina + ", Skill " + combatState.enemySkill;
                }
            },
            55: {
                text: "You cover your ears and hurry forward. The whispers fade behind you. You emerge into a clearing with a single, massive dead tree.",
                choices: [
                    {text: "Examine the tree", nextSection: 108, skillCheck: false},
                    {text: "Rest against the tree", nextSection: 109, skillCheck: false},
                    {text: "Continue past it", nextSection: 110, skillCheck: false}
                ]
            },
            56: {
                text: window.checkResult ? 
                    "The whispers respond! 'Seek the Stone of Cleansing... it purifies the waters... find it beneath the weeping willow...'" : 
                    "The whispers grow angry at your attempt to communicate! They attack!",
                choices: [
                    window.checkResult ? 
                        {text: "Thank the spirits and continue", nextSection: 111, skillCheck: false} :
                        {text: "Fight the angry spirits", nextSection: 5401, skillCheck: false}
                ]
            },
            57: {
                text: "The skeleton holds a waterlogged journal. The last entry reads: 'The swamp shifts... paths change... follow the fireflies at dusk... they show the true way...' You also find a silver locket on the skeleton.",
                choices: [
                    {text: "Take the journal and locket", nextSection: 112, skillCheck: false},
                    {text: "Bury the skeleton", nextSection: 113, skillCheck: false},
                    {text: "Leave everything as is", nextSection: 59, skillCheck: false}
                ]
            },
            58: {
                text: "You stay at the edge of the clearing. The standing stones begin to glow with a faint blue light. A path of light appears between them, leading deeper into the swamp.",
                choices: [
                    {text: "Follow the path of light", nextSection: 114, skillCheck: false},
                    {text: "Leave the clearing", nextSection: 59, skillCheck: false}
                ]
            },
            59: {
                text: "You leave the clearing and continue through the swamp. Dusk is approaching, and fireflies begin to appear.",
                choices: [
                    {text: "Follow the fireflies", nextSection: 115, skillCheck: false},
                    {text: "Ignore them and find shelter", nextSection: 116, skillCheck: false},
                    {text: "Make camp for the night", nextSection: 117, skillCheck: false}
                ]
            },
            60: {
                text: "You continue carefully through the foul-smelling area. The movement beneath the water follows you. Suddenly, several GAS SPORES rise to the surface and release toxic fumes!",
                choices: [
                    {text: "Hold your breath and run", nextSection: 118, skillCheck: true, checkType: 'stamina', difficulty: 12},
                    {text: "Attack the gas spores", nextSection: 119, skillCheck: false},
                    {text: "Try to calm them", nextSection: 120, skillCheck: false}
                ]
            },
            61: {
                text: "You throw a rock into the black water. Dozens of leeches swarm to the spot! You carefully skirt around the infested area.",
                choices: [
                    {text: "Continue forward", nextSection: 121, skillCheck: false}
                ]
            },
            62: {
                text: "The animal trail is narrow but passable. It leads to a dry island with a small hut built on stilts. Smoke rises from the chimney.",
                choices: [
                    {text: "Approach the hut", nextSection: 122, skillCheck: false},
                    {text: "Observe from a distance", nextSection: 123, skillCheck: false},
                    {text: "Avoid the hut and continue", nextSection: 124, skillCheck: false}
                ]
            },
            63: {
                text: "You return to the fork in the path.",
                choices: [
                    {text: "Take the left fork", nextSection: 29, skillCheck: false},
                    {text: "Take the right fork", nextSection: 30, skillCheck: false}
                ]
            },
            64: {
                text: "You follow the Will-o'-Wisps. They lead you in circles, then to the edge of a bottomless bog! They were trying to lead you to your doom!",
                choices: [
                    {text: "Fight the Will-o'-Wisps", nextSection: 6401, skillCheck: false},
                    {text: "Try to escape the bog", nextSection: 125, skillCheck: true, checkType: 'skill', difficulty: 12},
                    {text: "Use a light source to counter them", nextSection: 126, skillCheck: false}
                ]
            },
            6401: {
                text: "You face the Deceptive Will-o'-Wisps! Roll for the first attack!",
                choices: [
                    {text: "Attack!", nextSection: 6402, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Will-o'-Wisps";
                    combatState.enemyStamina = 8;
                    combatState.enemyCurrentStamina = 8;
                    combatState.enemySkill = 13;
                    combatState.nextSection = 127;
                    combatState.round = 1;
                    
                    return "Will-o'-Wisps: Stamina " + combatState.enemyCurrentStamina + ", Skill " + combatState.enemySkill;
                }
            },
            65: {
                text: "You avoid the Will-o'-Wisps as warned. Your path takes you through a difficult but safe route. You find a cache of supplies left by previous travelers.",
                choices: [
                    {text: "Take the supplies", nextSection: 128, skillCheck: false},
                    {text: "Leave them and continue", nextSection: 129, skillCheck: false}
                ]
            },
            66: {
                text: "You try to catch a Will-o'-Wisp. It dodges easily and laughs with a sound like tinkling glass. The other Will-o'-Wisps surround you!",
                choices: [
                    {text: "Fight them", nextSection: 6401, skillCheck: false},
                    {text: "Apologize and back away", nextSection: 130, skillCheck: true, checkType: 'luck', difficulty: 11},
                    {text: "Offer them something", nextSection: 131, skillCheck: false}
                ]
            },
            67: {
                text: window.checkResult ? 
                    "You run across the bridge before the specters can fully materialize. You make it to the other side safely!" : 
                    "A specter grabs you as you run! You lose 5 Stamina breaking free.",
                choices: [
                    {text: "Continue", nextSection: 132, skillCheck: false}
                ],
                action: function() {
                    if (!window.checkResult) {
                        gameState.stamina -= 5;
                        updateStatsDisplay();
                    }
                }
            },
            68: {
                text: "You jump into the water to avoid the specters. The water is freezing and filled with grasping weeds. You lose 4 Stamina but swim to the other side.",
                choices: [
                    {text: "Climb out and continue", nextSection: 132, skillCheck: false}
                ],
                action: function() {
                    gameState.stamina -= 4;
                    updateStatsDisplay();
                }
            },
            69: {
                text: "After defeating the specters, you find they were guarding a chest on the far side of the bridge.",
                choices: [
                    {text: "Open the chest", nextSection: 133, skillCheck: false},
                    {text: "Leave it and continue", nextSection: 132, skillCheck: false}
                ]
            },
            70: {
                text: window.checkResult ? 
                    "You resist the toxic fumes and continue along the channel. It leads to a solid path out of the worst part of the swamp." : 
                    "The fumes overwhelm you! You collapse and lose 7 Stamina before crawling to cleaner air.",
                choices: [
                    {text: "Continue", nextSection: 134, skillCheck: false}
                ],
                action: function() {
                    if (!window.checkResult) {
                        gameState.stamina -= 7;
                        updateStatsDisplay();
                    }
                }
            },
            71: {
                text: "You cover your mouth and press on. The fumes are still potent, and you lose 3 Stamina from exposure, but you make it through.",
                choices: [
                    {text: "Continue", nextSection: 134, skillCheck: false}
                ],
                action: function() {
                    gameState.stamina -= 3;
                    updateStatsDisplay();
                }
            },
            72: {
                text: "You turn back and find another route. It's longer but safer.",
                choices: [
                    {text: "Take the longer route", nextSection: 135, skillCheck: false}
                ]
            },
            73: {
                text: "You investigate the movement and find it's just a large turtle. However, near the turtle's nesting site, you find some shiny stones that might be valuable.",
                choices: [
                    {text: "Take the stones", nextSection: 136, skillCheck: false},
                    {text: "Leave the turtle in peace", nextSection: 74, skillCheck: false}
                ]
            },
            74: {
                text: "You finish resting and feel somewhat restored. You regain 4 Stamina.",
                choices: [
                    {text: "Continue your journey", nextSection: 137, skillCheck: false}
                ],
                action: function() {
                    gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + 4);
                    updateStatsDisplay();
                }
            },
            75: {
                text: "You leave immediately and continue through the swamp.",
                choices: [
                    {text: "Continue", nextSection: 137, skillCheck: false}
                ]
            },
            76: {
                text: "The figure is an old swamp hermit. 'Few find this place,' she says. 'The swamp tests all who enter. What brings you here?'",
                choices: [
                    {text: "Ask for safe passage through the swamp", nextSection: 138, skillCheck: false},
                    {text: "Ask about the Swamp of Sorrows", nextSection: 139, skillCheck: false},
                    {text: "Attack the hermit", nextSection: 140, skillCheck: false}
                ]
            },
            77: {
                text: "You drink from the clear pool. The water is pure and refreshing! You regain 6 Stamina.",
                choices: [
                    {text: "Approach the figure", nextSection: 76, skillCheck: false},
                    {text: "Leave", nextSection: 78, skillCheck: false}
                ],
                action: function() {
                    gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + 6);
                    updateStatsDisplay();
                }
            },
            78: {
                text: "You leave the peaceful pool and return to the harsh swamp. The contrast is jarring.",
                choices: [
                    {text: "Continue", nextSection: 141, skillCheck: false}
                ]
            },
            79: {
                text: "You search the wagon wreck. Among the rotting wood, you find a locked strongbox and a rusted but usable mace.",
                choices: [
                    {text: "Try to open the strongbox", nextSection: 142, skillCheck: true, checkType: 'skill', difficulty: 11},
                    {text: "Take the mace and continue", nextSection: 143, skillCheck: false},
                    {text: "Leave everything", nextSection: 80, skillCheck: false}
                ]
            },
            80: {
                text: "You continue past the wagon wreck. The path becomes firmer, and you make good progress.",
                choices: [
                    {text: "Continue", nextSection: 144, skillCheck: false}
                ]
            },
            81: {
                text: "You use the wagon wreck for shelter as a sudden rainstorm hits. While waiting it out, you discover a hidden compartment with dried rations and a healing potion.",
                choices: [
                    {text: "Take the supplies and continue after the storm", nextSection: 144, skillCheck: false}
                ],
                action: function() {
                    gameState.inventory.push("Healing Potion");
                    gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + 3);
                    updateInventoryDisplay();
                    updateStatsDisplay();
                    return "You find a Healing Potion and eat some rations, restoring 3 Stamina.";
                }
            },
            82: {
                text: "You move toward the light and chanting. You find a group of SWAMP CULTISTS performing a ritual around a glowing green stone.",
                choices: [
                    {text: "Attack the cultists", nextSection: 8201, skillCheck: false},
                    {text: "Observe from hiding", nextSection: 145, skillCheck: true, checkType: 'skill', difficulty: 10},
                    {text: "Join the ritual", nextSection: 146, skillCheck: false}
                ]
            },
            8201: {
                text: "You face the Swamp Cultists! Roll for the first attack!",
                choices: [
                    {text: "Attack!", nextSection: 8202, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Swamp Cultists";
                    combatState.enemyStamina = 20;
                    combatState.enemyCurrentStamina = 20;
                    combatState.enemySkill = 9;
                    combatState.nextSection = 147;
                    combatState.round = 1;
                    
                    return "Swamp Cultists: Stamina " + combatState.enemyCurrentStamina + ", Skill " + combatState.enemySkill;
                }
            },
            83: {
                text: "You call out. The chanting stops abruptly. 'Who intrudes upon our ritual?' a voice echoes.",
                choices: [
                    {text: "Apologize and leave", nextSection: 148, skillCheck: false},
                    {text: "Claim to be a lost traveler", nextSection: 149, skillCheck: true, checkType: 'luck', difficulty: 10},
                    {text: "Challenge them", nextSection: 8201, skillCheck: false}
                ]
            },
            84: {
                text: "You leave the cave and continue through the swamp. The chanting fades behind you.",
                choices: [
                    {text: "Continue", nextSection: 150, skillCheck: false}
                ]
            },
            85: {
                text: "You head toward the swamp's exit. The ground becomes firmer, and the air cleaner. You've nearly made it through!",
                choices: [
                    {text: "Continue to the exit", nextSection: 200, skillCheck: false},
                    {text: "Rest first", nextSection: 151, skillCheck: false}
                ]
            },
            86: {
                text: "You search the area and find a discarded backpack with useful supplies: a coil of rope, a grappling hook, and 20 Gold.",
                choices: [
                    {text: "Take the supplies and head to the exit", nextSection: 200, skillCheck: false}
                ],
                action: function() {
                    gameState.inventory.push("Rope", "Grappling Hook");
                    gameState.gold += 20;
                    updateInventoryDisplay();
                    updateStatsDisplay();
                }
            },
            87: {
                text: "You keep running until you can't hear the ghostly wails anymore. You find yourself at the edge of a vast, mist-covered lake within the swamp.",
                choices: [
                    {text: "Follow the lake's edge", nextSection: 152, skillCheck: false},
                    {text: "Try to find a way across", nextSection: 153, skillCheck: false},
                    {text: "Rest and recover", nextSection: 154, skillCheck: false}
                ]
            },
            88: {
                text: window.checkResult ? 
                    "'We seek only to rest,' the spirits say. 'But the swamp torments us still. Free us by finding our remains and giving them proper burial.' They point toward a sunken graveyard." : 
                    "The spirits are too angry to reason with! They attack!",
                choices: [
                    window.checkResult ? 
                        {text: "Promise to help them", nextSection: 155, skillCheck: false} :
                        {text: "Fight the spirits", nextSection: 4201, skillCheck: false}
                ]
            },
            89: {
                text: "After defeating the spirits, the ground stops trembling. Where the marker stood, you find a small treasure chest.",
                choices: [
                    {text: "Open the chest", nextSection: 156, skillCheck: false},
                    {text: "Leave it and continue", nextSection: 157, skillCheck: false}
                ],
                action: function() {
                    gameState.gold += 30;
                    updateStatsDisplay();
                    return "You open the chest and find 30 Gold!";
                }
            },
            90: {
                text: "You take the crystal. It pulses with green energy in your hand. The temple begins to tremble!",
                choices: [
                    {text: "Run from the collapsing temple", nextSection: 158, skillCheck: false},
                    {text: "Try to replace the crystal", nextSection: 159, skillCheck: true, checkType: 'skill', difficulty: 13},
                    {text: "Use the crystal's power", nextSection: 160, skillCheck: false}
                ]
            },
            91: {
                text: window.checkResult ? 
                    "The murals show a ritual to purify swamp water using a special stone. The stone's location is depicted as being under a 'weeping willow where three streams meet.'" : 
                    "The murals are too damaged to understand fully. They seem to show rituals involving water purification.",
                choices: [
                    {text: "Take the crystal", nextSection: 90, skillCheck: false},
                    {text: "Leave the temple", nextSection: 92, skillCheck: false}
                ]
            },
            92: {
                text: "You leave the temple and continue through the swamp.",
                choices: [
                    {text: "Continue", nextSection: 161, skillCheck: false}
                ]
            },
            93: {
                text: "You take the gold from the offering bowl. As you do, the statue's eyes glow red! You've angered the swamp deity!",
                choices: [
                    {text: "Return the gold", nextSection: 162, skillCheck: false},
                    {text: "Keep the gold and run", nextSection: 163, skillCheck: false},
                    {text: "Fight the awakened statue", nextSection: 164, skillCheck: false}
                ],
                action: function() {
                    gameState.gold += 30;
                    updateStatsDisplay();
                }
            },
            94: {
                text: "You make an offering of 5 Gold. The statue's eyes glow with approval, and a hidden compartment opens, revealing a magical swamp amulet.",
                choices: [
                    {text: "Take the amulet", nextSection: 165, skillCheck: false},
                    {text: "Leave it", nextSection: 92, skillCheck: false}
                ],
                action: function() {
                    if (gameState.gold >= 5) {
                        gameState.gold -= 5;
                        gameState.inventory.push("Swamp Amulet");
                        updateInventoryDisplay();
                        updateStatsDisplay();
                    }
                }
            },
            95: {
                text: "The island is small but has a fresh water spring and edible berries. You can rest here safely.",
                choices: [
                    {text: "Rest and recover", nextSection: 166, skillCheck: false},
                    {text: "Search the island", nextSection: 167, skillCheck: false},
                    {text: "Continue from the island", nextSection: 168, skillCheck: false}
                ]
            },
            96: {
                text: "You follow the path away from the water. It leads through a dense thicket of thorny plants.",
                choices: [
                    {text: "Cut through the thicket", nextSection: 169, skillCheck: false},
                    {text: "Find a way around", nextSection: 170, skillCheck: false},
                    {text: "Return to the water", nextSection: 171, skillCheck: false}
                ]
            },
            97: {
                text: window.checkResult ? 
                    "You dodge the Froghemoth's tongue and escape! You run until you're sure it can't follow." : 
                    "The Froghemoth's tongue wraps around your leg! You take 4 damage breaking free.",
                choices: [
                    {text: "Continue", nextSection: 172, skillCheck: false}
                ],
                action: function() {
                    if (!window.checkResult) {
                        gameState.stamina -= 4;
                        updateStatsDisplay();
                    }
                }
            },
            98: {
                text: "You cut the Froghemoth's tongue! It recoils in pain, giving you time to escape.",
                choices: [
                    {text: "Escape while it's hurt", nextSection: 172, skillCheck: false},
                    {text: "Press the attack", nextSection: 4801, skillCheck: false}
                ]
            },
            99: {
                text: "After defeating the Froghemoth, you find its lair contains the remains of previous victims and their belongings.",
                choices: [
                    {text: "Search the lair", nextSection: 173, skillCheck: false},
                    {text: "Leave quickly", nextSection: 172, skillCheck: false}
                ],
                action: function() {
                    gameState.gold += 40;
                    gameState.weapons.push({name: 'Froghemoth Bone Dagger', damage: '1d6+2'});
                    updateStatsDisplay();
                    updateInventoryDisplay();
                    return "You find 40 Gold and a Froghemoth Bone Dagger (1d6+2 damage)!";
                }
            },
            100: {
                text: "You head toward the edge of the swamp. The ground becomes progressively firmer. You can see the outline of Bloodstone Keep in the distance!",
                choices: [
                    {text: "Continue toward the keep", nextSection: 200, skillCheck: false},
                    {text: "Search the area first", nextSection: 174, skillCheck: false}
                ]
            },
            101: {
                text: "You rest on the hillock. The view allows you to plan your route through the remaining swamp. You regain 4 Stamina.",
                choices: [
                    {text: "Head toward the edge of the swamp", nextSection: 100, skillCheck: false}
                ],
                action: function() {
                    gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + 4);
                    updateStatsDisplay();
                }
            },
            102: {
                text: "You retrieve the shiny object from the water lily. It's a silver ring set with a moonstone. The ring feels magical.",
                choices: [
                    {text: "Put on the ring", nextSection: 175, skillCheck: false},
                    {text: "Pocket it and move on", nextSection: 103, skillCheck: false}
                ],
                action: function() {
                    gameState.inventory.push("Moonstone Ring");
                    updateInventoryDisplay();
                }
            },
            103: {
                text: "You leave the pool and continue through the swamp.",
                choices: [
                    {text: "Continue", nextSection: 176, skillCheck: false}
                ]
            },
            104: {
                text: "After crossing the mud pits, you find yourself in a relatively dry area with several paths leading in different directions.",
                choices: [
                    {text: "Take the path marked with carved stones", nextSection: 177, skillCheck: false},
                    {text: "Follow the sound of running water", nextSection: 178, skillCheck: false},
                    {text: "Climb a tree to get your bearings", nextSection: 179, skillCheck: true, checkType: 'skill', difficulty: 10}
                ]
            },
            105: {
                text: window.checkResult ? 
                    "'We cannot rest,' the spirits say. 'Our bodies were never buried. Find them in the quicksand field to the east and give us peace.'" : 
                    "The spirits are beyond reason! They attack!",
                choices: [
                    window.checkResult ? 
                        {text: "Promise to help them", nextSection: 180, skillCheck: false} :
                        {text: "Fight the spirits", nextSection: 5401, skillCheck: false}
                ]
            },
            106: {
                text: "You flee from the spirits. They pursue for a while but eventually give up. You lose 4 Stamina from the exhausting chase.",
                choices: [
                    {text: "Continue", nextSection: 181, skillCheck: false}
                ],
                action: function() {
                    gameState.stamina -= 4;
                    updateStatsDisplay();
                }
            },
            107: {
                text: "After defeating the spirits, their whispering stops. The area grows quiet. You find a path leading away that seems safe.",
                choices: [
                    {text: "Follow the safe path", nextSection: 182, skillCheck: false}
                ]
            },
            108: {
                text: "The massive dead tree has carvings on its trunk. They depict a map of the swamp with a safe route marked. The tree also has a hollow containing something.",
                choices: [
                    {text: "Reach into the hollow", nextSection: 183, skillCheck: false},
                    {text: "Study the map", nextSection: 184, skillCheck: false},
                    {text: "Continue past the tree", nextSection: 110, skillCheck: false}
                ]
            },
            109: {
                text: "You rest against the tree. As you do, you notice a hidden compartment at its base containing supplies left by a previous traveler.",
                choices: [
                    {text: "Take the supplies", nextSection: 185, skillCheck: false},
                    {text: "Leave them", nextSection: 110, skillCheck: false}
                ],
                action: function() {
                    gameState.inventory.push("Healing Salve");
                    gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + 5);
                    updateInventoryDisplay();
                    updateStatsDisplay();
                    return "You find a Healing Salve and some rations that restore 5 Stamina!";
                }
            },
            110: {
                text: "You continue past the massive dead tree. The path winds through increasingly difficult terrain.",
                choices: [
                    {text: "Continue", nextSection: 186, skillCheck: false}
                ]
            },
            111: {
                text: "You thank the spirits and continue, remembering their advice about the Stone of Cleansing. The path leads to a beautiful weeping willow where three small streams meet.",
                choices: [
                    {text: "Search beneath the weeping willow", nextSection: 187, skillCheck: false},
                    {text: "Continue past it", nextSection: 188, skillCheck: false}
                ]
            },
            112: {
                text: "You take the journal and silver locket. The locket contains a portrait of a young woman and feels warm to the touch.",
                choices: [
                    {text: "Bury the skeleton", nextSection: 113, skillCheck: false},
                    {text: "Leave", nextSection: 59, skillCheck: false}
                ],
                action: function() {
                    gameState.inventory.push("Swamp Journal", "Silver Locket");
                    updateInventoryDisplay();
                }
            },
            113: {
                text: "You bury the skeleton properly. As you finish, a warm feeling washes over you, and your Luck increases by 2.",
                choices: [
                    {text: "Continue", nextSection: 59, skillCheck: false}
                ],
                action: function() {
                    gameState.luck += 2;
                    updateStatsDisplay();
                }
            },
            114: {
                text: "You follow the path of light between the standing stones. It leads you safely through a particularly dangerous part of the swamp with surprising speed.",
                choices: [
                    {text: "Continue following the light", nextSection: 189, skillCheck: false},
                    {text: "Leave the path of light", nextSection: 190, skillCheck: false}
                ]
            },
            115: {
                text: "As dusk falls, you follow the fireflies. They lead you along a safe, dry path that avoids all the swamp's dangers. The journal was right!",
                choices: [
                    {text: "Continue following the fireflies", nextSection: 191, skillCheck: false}
                ]
            },
            116: {
                text: "You find a dry cave to shelter in for the night. It's safe and comfortable.",
                choices: [
                    {text: "Rest until morning", nextSection: 192, skillCheck: false},
                    {text: "Explore the cave", nextSection: 193, skillCheck: false}
                ]
            },
            117: {
                text: "You make camp for the night. It's risky, but you're exhausted. During the night, something approaches your camp...",
                choices: [
                    {text: "Stand guard all night", nextSection: 194, skillCheck: true, checkType: 'stamina', difficulty: 12},
                    {text: "Sleep and hope for the best", nextSection: 195, skillCheck: false},
                    {text: "Abandon camp and travel by night", nextSection: 196, skillCheck: false}
                ]
            },
            118: {
                text: window.checkResult ? 
                    "You hold your breath and run through the toxic fumes, emerging on the other side unharmed." : 
                    "The toxic fumes overwhelm you! You lose 8 Stamina and barely make it through.",
                choices: [
                    {text: "Continue", nextSection: 197, skillCheck: false}
                ],
                action: function() {
                    if (!window.checkResult) {
                        gameState.stamina -= 8;
                        updateStatsDisplay();
                    }
                }
            },
            119: {
                text: "You attack the gas spores, causing them to explode! The resulting blast damages you but clears the area.",
                choices: [
                    {text: "Continue through the cleared area", nextSection: 197, skillCheck: false}
                ],
                action: function() {
                    gameState.stamina -= 6;
                    updateStatsDisplay();
                }
            },
            120: {
                text: "You try to calm the gas spores by moving slowly and peacefully. It works! They sink back beneath the surface.",
                choices: [
                    {text: "Continue carefully", nextSection: 197, skillCheck: false}
                ]
            },
            121: {
                text: "You continue forward, carefully avoiding the leech-infested waters. The path leads to solid ground.",
                choices: [
                    {text: "Continue", nextSection: 198, skillCheck: false}
                ]
            },
            122: {
                text: "You approach the hut. An old man opens the door. 'Traveler! Come in, come in. Few make it this far into the swamp.'",
                choices: [
                    {text: "Enter the hut", nextSection: 199, skillCheck: false},
                    {text: "Ask for directions", nextSection: 200, skillCheck: false},
                    {text: "Attack the old man", nextSection: 201, skillCheck: false}
                ]
            },
            123: {
                text: "You observe from a distance. The old man seems harmless, tending to a small garden of swamp herbs.",
                choices: [
                    {text: "Approach the hut", nextSection: 122, skillCheck: false},
                    {text: "Continue on your way", nextSection: 124, skillCheck: false}
                ]
            },
            124: {
                text: "You avoid the hut and continue through the swamp. The path becomes increasingly difficult.",
                choices: [
                    {text: "Continue", nextSection: 202, skillCheck: false}
                ]
            },
            125: {
                text: window.checkResult ? 
                    "You manage to escape the bog's edge and find solid ground. The Will-o'-Wisps fade away, disappointed." : 
                    "You sink into the bog! You lose 7 Stamina struggling free.",
                choices: [
                    {text: "Continue", nextSection: 203, skillCheck: false}
                ],
                action: function() {
                    if (!window.checkResult) {
                        gameState.stamina -= 7;
                        updateStatsDisplay();
                    }
                }
            },
            126: {
                text: "You light a torch or use a light source. The Will-o'-Wisps recoil from the true light and vanish!",
                choices: [
                    {text: "Continue", nextSection: 203, skillCheck: false}
                ]
            },
            127: {
                text: "After defeating the Will-o'-Wisps, you find they were guarding a small treasure hidden in a hollow tree.",
                choices: [
                    {text: "Take the treasure", nextSection: 204, skillCheck: false},
                    {text: "Leave it", nextSection: 203, skillCheck: false}
                ],
                action: function() {
                    gameState.gold += 25;
                    gameState.inventory.push("Glowing Crystal");
                    updateStatsDisplay();
                    updateInventoryDisplay();
                    return "You find 25 Gold and a Glowing Crystal that provides light in darkness!";
                }
            },
            128: {
                text: "You take the supplies: some dried meat, a water skin, and 10 Gold.",
                choices: [
                    {text: "Continue", nextSection: 129, skillCheck: false}
                ],
                action: function() {
                    gameState.gold += 10;
                    gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + 3);
                    updateStatsDisplay();
                }
            },
            129: {
                text: "You continue through the difficult but safe route. The terrain is challenging but free of monsters.",
                choices: [
                    {text: "Continue", nextSection: 205, skillCheck: false}
                ]
            },
            130: {
                text: window.checkResult ? 
                    "The Will-o'-Wisps accept your apology and drift away." : 
                    "The Will-o'-Wisps are not appeased! They attack!",
                choices: [
                    window.checkResult ? 
                        {text: "Continue", nextSection: 203, skillCheck: false} :
                        {text: "Fight them", nextSection: 6401, skillCheck: false}
                ]
            },
            131: {
                text: "You offer the Will-o'-Wisps 5 Gold. They take it and float away contentedly.",
                choices: [
                    {text: "Continue", nextSection: 203, skillCheck: false}
                ],
                action: function() {
                    if (gameState.gold >= 5) {
                        gameState.gold -= 5;
                        updateStatsDisplay();
                    }
                }
            },
            132: {
                text: "You continue from the bridge, moving deeper into the swamp. The air grows colder and more oppressive.",
                choices: [
                    {text: "Continue", nextSection: 206, skillCheck: false}
                ]
            },
            133: {
                text: "You open the chest and find 50 Gold and a magical swamp cloak that provides protection against the elements!",
                choices: [
                    {text: "Take the treasure and continue", nextSection: 132, skillCheck: false}
                ],
                action: function() {
                    gameState.gold += 50;
                    gameState.armor.push({name: 'Swamp Cloak', defense: 2});
                    updateStatsDisplay();
                    updateInventoryDisplay();
                    return "You find 50 Gold and a Swamp Cloak (2 DEF)!";
                }
            },
            134: {
                text: "You emerge from the foul area into cleaner air. The worst of the swamp is behind you.",
                choices: [
                    {text: "Continue toward the exit", nextSection: 207, skillCheck: false}
                ]
            },
            135: {
                text: "The longer route takes more time but is safer. You make steady progress.",
                choices: [
                    {text: "Continue", nextSection: 207, skillCheck: false}
                ]
            },
            136: {
                text: "You take the shiny stones. They're actually small gemstones worth 15 Gold!",
                choices: [
                    {text: "Continue", nextSection: 74, skillCheck: false}
                ],
                action: function() {
                    gameState.gold += 15;
                    updateStatsDisplay();
                }
            },
            137: {
                text: "You continue your journey through the swamp. The path winds through increasingly difficult terrain.",
                choices: [
                    {text: "Continue", nextSection: 208, skillCheck: false}
                ]
            },
            138: {
                text: "'Safe passage?' the hermit laughs. 'There is no safe passage through the Swamp of Sorrows. But I can give you this map of the least dangerous routes.'",
                choices: [
                    {text: "Accept the map", nextSection: 209, skillCheck: false},
                    {text: "Ask about the swamp's history", nextSection: 139, skillCheck: false},
                    {text: "Leave", nextSection: 78, skillCheck: false}
                ]
            },
            139: {
                text: "'This swamp was once a beautiful forest,' the hermit says sadly. 'A great battle was fought here, and the blood of warriors poisoned the land. Now it's a place of sorrow and regret.'",
                choices: [
                    {text: "Ask for the map", nextSection: 209, skillCheck: false},
                    {text: "Thank her and leave", nextSection: 78, skillCheck: false}
                ]
            },
            140: {
                text: "You attack the old hermit! Prepare for combat!",
                choices: [
                    {text: "Begin the battle!", nextSection: 1401, skillCheck: false}
                ]
            },
            1401: {
                text: "You face the Swamp Hermit! Roll for the first attack!",
                choices: [
                    {text: "Attack!", nextSection: 1402, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Swamp Hermit";
                    combatState.enemyStamina = 12;
                    combatState.enemyCurrentStamina = 12;
                    combatState.enemySkill = 7;
                    combatState.nextSection = 210;
                    combatState.round = 1;
                    
                    return "Swamp Hermit: Stamina " + combatState.enemyCurrentStamina + ", Skill " + combatState.enemySkill;
                }
            },
            141: {
                text: "You continue through the harsh swamp, missing the peaceful pool you left behind.",
                choices: [
                    {text: "Continue", nextSection: 211, skillCheck: false}
                ]
            },
            142: {
                text: window.checkResult ? 
                    "You successfully pick the lock! Inside you find 40 Gold and a silver amulet." : 
                    "The lock is too rusted. You can't open it.",
                choices: [
                    {text: "Take the mace and continue", nextSection: 143, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        gameState.gold += 40;
                        gameState.inventory.push("Silver Amulet");
                        updateStatsDisplay();
                        updateInventoryDisplay();
                        return "You find 40 Gold and a Silver Amulet!";
                    }
                }
            },
            143: {
                text: "You take the rusted mace. It's heavy but serviceable.",
                choices: [
                    {text: "Continue", nextSection: 144, skillCheck: false}
                ],
                action: function() {
                    gameState.weapons.push({name: 'Rusted Mace', damage: '2d4'});
                    updateInventoryDisplay();
                }
            },
            144: {
                text: "The firm path makes for easy going. You make good progress through the swamp.",
                choices: [
                    {text: "Continue", nextSection: 212, skillCheck: false}
                ]
            },
            145: {
                text: window.checkResult ? 
                    "You observe unseen. The cultists are performing a ritual to summon a swamp demon! They plan to sacrifice a captive traveler at midnight." : 
                    "You're spotted! The cultists turn toward you!",
                choices: [
                    window.checkResult ? 
                        {text: "Attack the cultists", nextSection: 8201, skillCheck: false} :
                        {text: "Try to talk your way out", nextSection: 213, skillCheck: false}
                ]
            },
            146: {
                text: "You join the ritual. The cultists welcome you. 'Help us summon the Swamp Demon, and we will reward you richly!'",
                choices: [
                    {text: "Help with the ritual", nextSection: 214, skillCheck: false},
                    {text: "Attack them during the ritual", nextSection: 8201, skillCheck: false},
                    {text: "Leave quietly", nextSection: 84, skillCheck: false}
                ]
            },
            147: {
                text: "After defeating the cultists, you free the captive traveler they were going to sacrifice. He rewards you with 50 Gold and information about a safe path out.",
                choices: [
                    {text: "Take the reward and follow the safe path", nextSection: 215, skillCheck: false}
                ],
                action: function() {
                    gameState.gold += 50;
                    updateStatsDisplay();
                    return "The grateful traveler gives you 50 Gold and tells you about a safe path to the swamp's edge!";
                }
            },
            148: {
                text: "'Leave now and never return!' the cult leader shouts. You back out of the cave quickly.",
                choices: [
                    {text: "Leave the cave", nextSection: 84, skillCheck: false}
                ]
            },
            149: {
                text: window.checkResult ? 
                    "'A lost traveler? Come, join our ritual. We seek to purify the swamp.' They seem sincere." : 
                    "'We don't believe you! You're a spy!'",
                choices: [
                    window.checkResult ? 
                        {text: "Join their ritual", nextSection: 146, skillCheck: false} :
                        {text: "Fight them", nextSection: 8201, skillCheck: false}
                ]
            },
            150: {
                text: "You leave the cave and the chanting behind. The swamp seems even darker now.",
                choices: [
                    {text: "Continue", nextSection: 216, skillCheck: false}
                ]
            },
            151: {
                text: "You rest briefly before the final push. You regain 4 Stamina.",
                choices: [
                    {text: "Continue to the exit", nextSection: 200, skillCheck: false}
                ],
                action: function() {
                    gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + 4);
                    updateStatsDisplay();
                }
            },
            152: {
                text: "You follow the lake's edge. The mist is thick here, but you can make out shapes moving in the water.",
                choices: [
                    {text: "Continue along the edge", nextSection: 217, skillCheck: false},
                    {text: "Try to cross the lake", nextSection: 218, skillCheck: false},
                    {text: "Rest here", nextSection: 154, skillCheck: false}
                ]
            },
            153: {
                text: "You search for a way across the lake. You find an old, rotting dock with a small rowboat tied to it.",
                choices: [
                    {text: "Take the rowboat", nextSection: 219, skillCheck: false},
                    {text: "Continue along the edge", nextSection: 217, skillCheck: false}
                ]
            },
            154: {
                text: "You rest by the lake. The peaceful lapping of water helps you recover. You regain 5 Stamina.",
                choices: [
                    {text: "Continue", nextSection: 220, skillCheck: false}
                ],
                action: function() {
                    gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + 5);
                    updateStatsDisplay();
                }
            },
            155: {
                text: "You promise to help the spirits. They give you directions to the sunken graveyard.",
                choices: [
                    {text: "Follow their directions", nextSection: 221, skillCheck: false},
                    {text: "Break your promise and flee", nextSection: 222, skillCheck: false}
                ]
            },
            156: {
                text: "You open the chest and find 40 Gold and a magical staff that glows with soft light!",
                choices: [
                    {text: "Take the treasure and continue", nextSection: 157, skillCheck: false}
                ],
                action: function() {
                    gameState.gold += 40;
                    gameState.weapons.push({name: 'Glowing Staff', damage: '1d6+3'});
                    updateStatsDisplay();
                    updateInventoryDisplay();
                    return "You find 40 Gold and a Glowing Staff (1d6+3 damage) that provides light!";
                }
            },
            157: {
                text: "You continue through the swamp, leaving the angry spirits behind.",
                choices: [
                    {text: "Continue", nextSection: 223, skillCheck: false}
                ]
            },
            158: {
                text: "You run from the collapsing temple just in time! The entrance collapses behind you.",
                choices: [
                    {text: "Continue", nextSection: 224, skillCheck: false}
                ]
            },
            159: {
                text: window.checkResult ? 
                    "You successfully replace the crystal. The temple stops trembling, and a hidden door opens, revealing a treasure room!" : 
                    "You fumble with the crystal! The temple collapses around you!",
                choices: [
                    window.checkResult ? 
                        {text: "Enter the treasure room", nextSection: 225, skillCheck: false} :
                        {text: "Escape the collapsing temple", nextSection: 158, skillCheck: false}
                ]
            },
            160: {
                text: "You channel the crystal's power! It heals you for 8 Stamina and increases your Luck by 2!",
                choices: [
                    {text: "Escape the collapsing temple", nextSection: 158, skillCheck: false}
                ],
                action: function() {
                    gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + 8);
                    gameState.luck += 2;
                    updateStatsDisplay();
                }
            },
            161: {
                text: "You leave the temple area and continue through the swamp. The going is difficult but you make progress.",
                choices: [
                    {text: "Continue", nextSection: 226, skillCheck: false}
                ]
            },
            162: {
                text: "You return the gold. The statue's eyes stop glowing, and it speaks: 'Your honesty is rewarded.' A compartment opens with a magical item.",
                choices: [
                    {text: "Take the reward", nextSection: 227, skillCheck: false},
                    {text: "Leave it", nextSection: 92, skillCheck: false}
                ],
                action: function() {
                    gameState.inventory.push("Swamp Guardian's Blessing");
                    updateInventoryDisplay();
                    return "You receive the Swamp Guardian's Blessing, a magical charm that increases your Skill by 1!";
                }
            },
            163: {
                text: "You keep the gold and run! The statue's eyes follow you, but it doesn't pursue.",
                choices: [
                    {text: "Continue running", nextSection: 228, skillCheck: false}
                ]
            },
            164: {
                text: "You fight the awakened statue! Prepare for combat!",
                choices: [
                    {text: "Begin the battle!", nextSection: 1641, skillCheck: false}
                ]
            },
            1641: {
                text: "You face the Awakened Swamp Statue! Roll for the first attack!",
                choices: [
                    {text: "Attack!", nextSection: 1642, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Awakened Swamp Statue";
                    combatState.enemyStamina = 22;
                    combatState.enemyCurrentStamina = 22;
                    combatState.enemySkill = 11;
                    combatState.nextSection = 229;
                    combatState.round = 1;
                    
                    return "Awakened Swamp Statue: Stamina " + combatState.enemyCurrentStamina + ", Skill " + combatState.enemySkill;
                }
            },
            165: {
                text: "You take the swamp amulet. It feels warm and protective.",
                choices: [
                    {text: "Leave the temple area", nextSection: 92, skillCheck: false}
                ],
                action: function() {
                    gameState.inventory.push("Swamp Amulet");
                    updateInventoryDisplay();
                }
            },
            166: {
                text: "You rest on the island, eating berries and drinking fresh water. You regain 8 Stamina.",
                choices: [
                    {text: "Search the island", nextSection: 167, skillCheck: false},
                    {text: "Continue from the island", nextSection: 168, skillCheck: false}
                ],
                action: function() {
                    gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + 8);
                    updateStatsDisplay();
                }
            },
            167: {
                text: "You search the island and find a hidden cave containing 30 Gold and a magical swamp herb that can cure poison.",
                choices: [
                    {text: "Take the treasure and continue", nextSection: 168, skillCheck: false}
                ],
                action: function() {
                    gameState.gold += 30;
                    gameState.inventory.push("Swamp Healing Herb");
                    updateStatsDisplay();
                    updateInventoryDisplay();
                    return "You find 30 Gold and a Swamp Healing Herb that can cure poison!";
                }
            },
            168: {
                text: "You leave the island and continue through the swamp. You find a path that seems to lead toward the edge.",
                choices: [
                    {text: "Follow the path", nextSection: 230, skillCheck: false}
                ]
            },
            169: {
                text: "You cut through the thicket. The thorns tear at your clothes and skin. You lose 3 Stamina but make it through.",
                choices: [
                    {text: "Continue", nextSection: 231, skillCheck: false}
                ],
                action: function() {
                    gameState.stamina -= 3;
                    updateStatsDisplay();
                }
            },
            170: {
                text: "You find a way around the thicket. It takes longer but you avoid injury.",
                choices: [
                    {text: "Continue", nextSection: 231, skillCheck: false}
                ]
            },
            171: {
                text: "You return to the water and find another path along the shore.",
                choices: [
                    {text: "Follow the new path", nextSection: 232, skillCheck: false}
                ]
            },
            172: {
                text: "You escape from the Froghemoth and continue through the swamp, breathing heavily.",
                choices: [
                    {text: "Continue", nextSection: 233, skillCheck: false}
                ]
            },
            173: {
                text: "You search the Froghemoth's lair and find 60 Gold and several valuable gems worth 40 Gold!",
                choices: [
                    {text: "Take the treasure and leave", nextSection: 172, skillCheck: false}
                ],
                action: function() {
                    gameState.gold += 100;
                    updateStatsDisplay();
                    return "You find 100 Gold worth of treasure in the Froghemoth's lair!";
                }
            },
            174: {
                text: "You search the area near the swamp's edge and find a hidden cache with 25 Gold and a map of Bloodstone Keep!",
                choices: [
                    {text: "Take the treasure and continue to Bloodstone Keep", nextSection: 200, skillCheck: false}
                ],
                action: function() {
                    gameState.gold += 25;
                    gameState.inventory.push("Bloodstone Keep Map");
                    updateStatsDisplay();
                    updateInventoryDisplay();
                    return "You find 25 Gold and a map of Bloodstone Keep!";
                }
            },
            175: {
                text: "You put on the Moonstone Ring. It glows with a soft light and increases your Luck by 2!",
                choices: [
                    {text: "Continue", nextSection: 103, skillCheck: false}
                ],
                action: function() {
                    gameState.luck += 2;
                    updateStatsDisplay();
                    // Remove from inventory since it's now equipped
                    const index = gameState.inventory.indexOf("Moonstone Ring");
                    if (index > -1) {
                        gameState.inventory.splice(index, 1);
                        updateInventoryDisplay();
                    }
                }
            },
            // Combat sections (402-403, 3302-3303, etc.) need to be added
            402: {
                text: "", // Will be filled by combat round
                choices: [
                    {text: "Continue the fight!", nextSection: 403, skillCheck: false}
                ]
            },
            403: {
                text: "", // Will be filled by combat round
                choices: [
                    {text: "Continue the fight!", nextSection: 402, skillCheck: false}
                ]
            },
            3302: {
                text: "", // Will be filled by combat round
                choices: [
                    {text: "Continue the fight!", nextSection: 3303, skillCheck: false}
                ]
            },
            3303: {
                text: "", // Will be filled by combat round
                choices: [
                    {text: "Continue the fight!", nextSection: 3302, skillCheck: false}
                ]
            },
            4202: {
                text: "", // Will be filled by combat round
                choices: [
                    {text: "Continue the fight!", nextSection: 4203, skillCheck: false}
                ]
            },
            4203: {
                text: "", // Will be filled by combat round
                choices: [
                    {text: "Continue the fight!", nextSection: 4202, skillCheck: false}
                ]
            },
            4802: {
                text: "", // Will be filled by combat round
                choices: [
                    {text: "Continue the fight!", nextSection: 4803, skillCheck: false}
                ]
            },
            4803: {
                text: "", // Will be filled by combat round
                choices: [
                    {text: "Continue the fight!", nextSection: 4802, skillCheck: false}
                ]
            },
            5402: {
                text: "", // Will be filled by combat round
                choices: [
                    {text: "Continue the fight!", nextSection: 5403, skillCheck: false}
                ]
            },
            5403: {
                text: "", // Will be filled by combat round
                choices: [
                    {text: "Continue the fight!", nextSection: 5402, skillCheck: false}
                ]
            },
            6402: {
                text: "", // Will be filled by combat round
                choices: [
                    {text: "Continue the fight!", nextSection: 6403, skillCheck: false}
                ]
            },
            6403: {
                text: "", // Will be filled by combat round
                choices: [
                    {text: "Continue the fight!", nextSection: 6402, skillCheck: false}
                ]
            },
            8202: {
                text: "", // Will be filled by combat round
                choices: [
                    {text: "Continue the fight!", nextSection: 8203, skillCheck: false}
                ]
            },
            8203: {
                text: "", // Will be filled by combat round
                choices: [
                    {text: "Continue the fight!", nextSection: 8202, skillCheck: false}
                ]
            },
            1402: {
                text: "", // Will be filled by combat round
                choices: [
                    {text: "Continue the fight!", nextSection: 1403, skillCheck: false}
                ]
            },
            1403: {
                text: "", // Will be filled by combat round
                choices: [
                    {text: "Continue the fight!", nextSection: 1402, skillCheck: false}
                ]
            },
            1642: {
                text: "", // Will be filled by combat round
                choices: [
                    {text: "Continue the fight!", nextSection: 1643, skillCheck: false}
                ]
            },
            1643: {
                text: "", // Will be filled by combat round
                choices: [
                    {text: "Continue the fight!", nextSection: 1642, skillCheck: false}
                ]
            },
            // VICTORY SECTION - Player completes the level
            200: {
                text: "You have successfully navigated the <span class='swamp-decoration'>SWAMP OF SORROWS</span>! Whether through combat, cunning, or diplomacy, you've survived one of the most treacherous regions in Dreadwood. Before you rises the ominous <span class='enemy'>BLOODSTONE KEEP</span>, your next challenge.",
                choices: [],
                action: function() {
                    gameState.gameComplete = true;
                    showScreen('screen-next');
                    document.getElementById('next-stat-skill').textContent = gameState.skill;
                    document.getElementById('next-stat-stamina').textContent = gameState.stamina;
                    document.getElementById('next-stat-luck').textContent = gameState.luck;
                    document.getElementById('next-stat-gold').textContent = gameState.gold;
                    return "You've completed Level 3: Swamp of Sorrows! Your journey continues to Bloodstone Keep...";
                }
            },
            // Additional sections to complete the story (199-234 would continue the narrative)
            199: {
                text: "The old hermit welcomes you into his hut. It's surprisingly cozy inside. 'I have lived here for twenty years,' he says. 'The swamp is my home now. What do you seek?'",
                choices: [
                    {text: "Ask for a map of the swamp", nextSection: 209, skillCheck: false},
                    {text: "Ask about the swamp's dangers", nextSection: 234, skillCheck: false},
                    {text: "Rest here for the night", nextSection: 235, skillCheck: false}
                ]
            },
            209: {
                text: "The hermit gives you a detailed map of the swamp. 'Follow the red line,' he says. 'It shows the safest route to the other side.'",
                choices: [
                    {text: "Thank him and follow the map", nextSection: 236, skillCheck: false},
                    {text: "Ask more questions", nextSection: 234, skillCheck: false}
                ],
                action: function() {
                    gameState.inventory.push("Swamp Map");
                    updateInventoryDisplay();
                }
            }
        };

        // Initialize game
        function initGame() {
            updateStatsDisplay();
            updateInventoryDisplay();
            
            if (gameState.currentSection > 0) {
                loadSection(gameState.currentSection);
            } else {
                loadSection(0);
            }
        }
        
        // Show warning dialog for new game
        function showNewGameWarning() {
            document.getElementById('screen-game').classList.remove('active-screen');
            document.getElementById('warning-dialog').classList.add('active-screen');
        }
        
        // Cancel new game and return to game screen
        function cancelNewGame() {
            document.getElementById('warning-dialog').classList.remove('active-screen');
            document.getElementById('screen-game').classList.add('active-screen');
        }
        
        // Start new game - reset everything
        function startNewGame() {
            localStorage.removeItem('dreadwoodGameState');
            gameState = {
                playerClass: '',
                skill: 0,
                maxStamina: 0,
                stamina: 0,
                luck: 0,
                gold: 0,
                inventory: [],
                weapons: [],
                armor: [],
                currentWeaponIndex: 0,
                currentArmorIndex: 0,
                currentSection: 0,
                gameComplete: false
            };
            window.location.href = 'level1.html';
        }
        
        // Show specific screen
        function showScreen(screenId) {
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => {
                screen.classList.remove('active-screen');
            });
            document.getElementById(screenId).classList.add('active-screen');
        }
        
        // Update stats display
        function updateStatsDisplay() {
            document.getElementById('stat-skill').textContent = gameState.skill;
            document.getElementById('stat-stamina').textContent = gameState.stamina;
            document.getElementById('stat-maxstamina').textContent = gameState.maxStamina;
            document.getElementById('stat-luck').textContent = gameState.luck;
            document.getElementById('stat-gold').textContent = gameState.gold;
        }
        
        // Update inventory display
        function updateInventoryDisplay() {
            const inventoryDiv = document.getElementById('inventory');
            inventoryDiv.innerHTML = '';
            
            // Show current equipped weapon
            if (gameState.weapons && gameState.weapons.length > 0 && gameState.currentWeaponIndex >= 0) {
                const weapon = gameState.weapons[gameState.currentWeaponIndex];
                const weaponSpan = document.createElement('span');
                weaponSpan.className = 'inventory-item';
                weaponSpan.id = 'inv-weapon';
                weaponSpan.textContent = `${weapon.name} (${weapon.damage})`;
                inventoryDiv.appendChild(weaponSpan);
            }
            
            // Show current equipped armor
            if (gameState.armor && gameState.armor.length > 0 && gameState.currentArmorIndex >= 0) {
                const armor = gameState.armor[gameState.currentArmorIndex];
                const armorSpan = document.createElement('span');
                armorSpan.className = 'inventory-item';
                armorSpan.id = 'inv-armor';
                armorSpan.textContent = `${armor.name} (${armor.defense} DEF)`;
                inventoryDiv.appendChild(armorSpan);
            }
            
            // Show gold
            const goldSpan = document.createElement('span');
            goldSpan.className = 'inventory-item';
            goldSpan.textContent = `${gameState.gold} Gold`;
            inventoryDiv.appendChild(goldSpan);
            
            // Show other inventory items
            if (gameState.inventory) {
                gameState.inventory.forEach(item => {
                    // Don't show items that are currently equipped as weapons/armor
                    const isCurrentWeapon = gameState.weapons[gameState.currentWeaponIndex] && 
                        gameState.weapons[gameState.currentWeaponIndex].name === item;
                    const isCurrentArmor = gameState.armor[gameState.currentArmorIndex] && 
                        gameState.armor[gameState.currentArmorIndex].name === item;
                    
                    if (!isCurrentWeapon && !isCurrentArmor) {
                        const itemSpan = document.createElement('span');
                        itemSpan.className = 'inventory-item';
                        itemSpan.textContent = item;
                        inventoryDiv.appendChild(itemSpan);
                    }
                });
            }
        }
        
        // Load story section
        function loadSection(sectionId) {
            gameState.currentSection = sectionId;
            const section = storySections[sectionId];
            
            if (!section) {
                // For any missing sections, provide a default continuation
                document.getElementById('story-text').innerHTML = "<p>You continue through the Swamp of Sorrows, navigating its treacherous paths. The air grows colder as you approach the edge of the swamp. In the distance, you can see the dark silhouette of Bloodstone Keep.</p>";
                document.getElementById('choice-buttons').innerHTML = `
                    <button class="choice-btn" onclick="loadSection(200)">Continue to Bloodstone Keep</button>
                    <button class="choice-btn" onclick="loadSection(0)">Return to Swamp Entrance</button>
                `;
                return;
            }
            
            let storyText = section.text;
            
            // Check if this is a combat round section
            const isCombatRound = (sectionId === 402 || sectionId === 403 || 
                                 sectionId === 3302 || sectionId === 3303 ||
                                 sectionId === 4202 || sectionId === 4203 ||
                                 sectionId === 4802 || sectionId === 4803 ||
                                 sectionId === 5402 || sectionId === 5403 ||
                                 sectionId === 6402 || sectionId === 6403 ||
                                 sectionId === 8202 || sectionId === 8203 ||
                                 sectionId === 1402 || sectionId === 1403 ||
                                 sectionId === 1642 || sectionId === 1643);
            
            if (isCombatRound && combatState.active) {
                const combatResult = executeCombatRound();
                storyText = combatResult;
                
                if (!combatState.active) {
                    const goldReward = Math.floor(Math.random() * 30) + 10;
                    gameState.gold += goldReward;
                    updateStatsDisplay();
                    
                    storyText += `<br><span class="success">You defeated the ${combatState.enemyName}!</span>`;
                    storyText += `<br>You find ${goldReward} Gold on the body.`;
                    
                    document.getElementById('choice-buttons').innerHTML = '';
                    
                    setTimeout(() => {
                        loadSection(combatState.nextSection);
                    }, 2000);
                }
            }
            
            if (section.action) {
                const actionResult = section.action();
                if (actionResult) {
                    storyText += "<br><br>" + actionResult;
                }
            }
            
            document.getElementById('story-text').innerHTML = "<p>" + storyText + "</p>";
            
            // Only show choice buttons if not in an ended combat
            if (!isCombatRound || combatState.active) {
                const choiceButtons = document.getElementById('choice-buttons');
                choiceButtons.innerHTML = '';
                
                section.choices.forEach(choice => {
                    const button = document.createElement('button');
                    button.className = 'choice-btn';
                    button.textContent = choice.text;
                    button.onclick = function() {
                        if (choice.skillCheck) {
                            performSkillCheck(choice.checkType, choice.difficulty, choice.nextSection);
                        } else {
                            loadSection(choice.nextSection);
                        }
                    };
                    choiceButtons.appendChild(button);
                });
            }
            
            // Save game progress
            saveGame();
        }
        
        // Execute one round of combat
function executeCombatRound() {
    combatState.round++;
    
    // Roll dice for both combatants
    const playerRoll = rollDiceHelper(2, 6);
    const enemyRoll = rollDiceHelper(2, 6);
    
    // Add skill to dice rolls
    const playerTotal = playerRoll + gameState.skill;
    const enemyTotal = enemyRoll + combatState.enemySkill;
    
    let resultText = `<span class="enemy">ROUND ${combatState.round}: ${combatState.enemyName}</span><br>`;
    resultText += `Your Stamina: ${gameState.stamina}, Enemy Stamina: ${combatState.enemyCurrentStamina}<br>`;
    resultText += `You roll ${playerRoll} + Skill ${gameState.skill} = <strong>${playerTotal}</strong><br>`;
    resultText += `Enemy rolls ${enemyRoll} + Skill ${combatState.enemySkill} = <strong>${enemyTotal}</strong><br>`;
    
    if (playerTotal > enemyTotal) {
        // Player hits enemy
        let damage = 0;
        if (gameState.weapons && gameState.weapons.length > 0 && gameState.currentWeaponIndex >= 0) {
            const weapon = gameState.weapons[gameState.currentWeaponIndex];
            if (weapon.damage === '1d6') damage = rollDiceHelper(1, 6);
            else if (weapon.damage === '2d4') damage = rollDiceHelper(2, 4);
            else if (weapon.damage === '3d6') damage = rollDiceHelper(3, 6);
            else damage = rollDiceHelper(1, 6); // Default fallback
        } else {
            damage = rollDiceHelper(1, 6);
        }
        
        combatState.enemyCurrentStamina -= damage;
        resultText += `<span class="success">You hit for ${damage} damage!</span><br>`;
        
        if (combatState.enemyCurrentStamina <= 0) {
            combatState.active = false;
            return resultText;
        }
        
    } else if (playerTotal < enemyTotal) {
        // Enemy hits player
        const enemyDamage = rollDiceHelper(1, 6); // Enemy always uses 1d6 damage
        gameState.stamina -= enemyDamage;
        resultText += `<span class="damage">The ${combatState.enemyName} hits you for ${enemyDamage} damage!</span>`;
        
        // Check if player died
        if (gameState.stamina <= 0) {
            combatState.active = false;
            resultText += `<br><span class="game-over">You have been defeated by the ${combatState.enemyName}! Game Over.</span>`;
            setTimeout(() => {
                localStorage.removeItem('dreadwoodGameState');
                location.reload();
            }, 3000);
        }
    } else {
        // Tie - no damage dealt
        resultText += "The attacks are evenly matched! No damage dealt this round.";
    }
    
    updateStatsDisplay();
    
    return resultText;
}
        
        // Perform skill check
        function performSkillCheck(checkType, difficulty, nextSection) {
            const diceRoll = rollDiceHelper(2, 6);
            let statValue = gameState[checkType];
            let success = diceRoll <= statValue;
            
            window.checkResult = success;
            
            let resultText = `You roll ${diceRoll}. Your ${checkType.toUpperCase()} is ${statValue}. `;
            resultText += success ? 
                `<span class="success">Success!</span>` : 
                `<span class="damage">Failure!</span>`;
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${resultText}</div>`;
            
            setTimeout(() => {
                loadSection(nextSection);
            }, 1500);
        }
        
        // Use Luck
        function useLuck() {
            if (gameState.luck <= 0) {
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">You have no Luck left!</div>`;
                return;
            }
            
            const diceRoll = rollDiceHelper(2, 6);
            const success = diceRoll <= gameState.luck;
            
            gameState.luck -= 1;
            updateStatsDisplay();
            
            let resultText = `You test your Luck... Roll: ${diceRoll}, Luck: ${gameState.luck + 1}. `;
            resultText += success ? 
                `<span class="success">Lucky!</span> Something good happens.` : 
                `<span class="damage">Unlucky!</span> Something bad happens.`;
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${resultText}</div>`;
            
            // Apply Luck effect
            if (success) {
                const goodEffects = [
                    "You find 10 Gold in the mud!",
                    "You feel a surge of energy! Restore 5 Stamina.",
                    "You spot a safe path through the swamp.",
                    "A rare swamp flower restores your luck! Gain 2 Luck.",
                    "You avoid a hidden sinkhole."
                ];
                const effect = goodEffects[Math.floor(Math.random() * goodEffects.length)];
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">${effect}</div>`;
                
                if (effect.includes("Gold")) {
                    gameState.gold += 10;
                } else if (effect.includes("Stamina")) {
                    gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + 5);
                } else if (effect.includes("Luck")) {
                    gameState.luck += 2;
                }
            } else {
                const badEffects = [
                    "You step in quicksand! Lose 4 Stamina escaping.",
                    "You drop 5 Gold in the murky water!",
                    "You attract a swarm of mosquitoes! Lose 2 Stamina.",
                    "You slip and fall in the mud! Lose 3 Stamina.",
                    "You disturb a nest of swamp snakes!"
                ];
                const effect = badEffects[Math.floor(Math.random() * badEffects.length)];
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">${effect}</div>`;
                
                if (effect.includes("Stamina")) {
                    const damage = parseInt(effect.match(/\d+/)[0]);
                    gameState.stamina -= damage;
                    if (gameState.stamina <= 0) {
                        document.getElementById('story-text').innerHTML += `<div class="game-over">You have been defeated! Game Over.</div>`;
                        setTimeout(() => {
                            localStorage.removeItem('dreadwoodGameState');
                            location.reload();
                        }, 3000);
                    }
                } else if (effect.includes("Gold")) {
                    gameState.gold = Math.max(0, gameState.gold - 5);
                } else if (effect.includes("snakes")) {
                    document.getElementById('story-text').innerHTML += `<div class="dice-roll">The snakes attack!</div>`;
                    setTimeout(() => {
                        combatState.active = true;
                        combatState.enemyName = "Swamp Snakes";
                        combatState.enemyStamina = 8;
                        combatState.enemyCurrentStamina = 8;
                        combatState.enemySkill = 6;
                        combatState.nextSection = gameState.currentSection;
                        combatState.round = 0;
                        loadSection(402);
                    }, 1000);
                }
            }
            
            updateStatsDisplay();
            updateInventoryDisplay();
        }
        
        // Use Item function
        function useItem() {
            const usableItems = gameState.inventory.filter(item => {
                const isWeapon = gameState.weapons.some(w => w.name === item);
                const isArmor = gameState.armor.some(a => a.name === item);
                return !isWeapon && !isArmor;
            });
            
            if (usableItems.length === 0) {
                document.getElementById('story-text').innerHTML += 
                    `<div class="dice-roll">You have no usable items in your inventory!</div>`;
                return;
            }
            
            let itemText = "<h3>Select an item to use:</h3>";
            
            usableItems.forEach((item, index) => {
                itemText += `<p>${item} `;
                
                if (item === "Healing Potion" || item === "Healing Salve") {
                    itemText += `<button onclick="useHealingItem('${item}')" style="font-size:12px; padding:3px 8px;">Use (Restore Stamina)</button>`;
                } else if (item === "Glowing Swamp Mushrooms") {
                    itemText += `<button onclick="useSwampMushrooms()" style="font-size:12px; padding:3px 8px;">Use (Random Effect)</button>`;
                } else if (item === "Moonstone Ring") {
                    itemText += `<button onclick="useMoonstoneRing()" style="font-size:12px; padding:3px 8px;">Use (Magical Light)</button>`;
                } else if (item === "Swamp Journal") {
                    itemText += `<button onclick="useSwampJournal()" style="font-size:12px; padding:3px 8px;">Read</button>`;
                } else if (item === "Swamp Healing Herb") {
                    itemText += `<button onclick="useSwampHerb()" style="font-size:12px; padding:3px 8px;">Use (Cure Poison)</button>`;
                } else {
                    itemText += `<button onclick="useGenericItem('${item}')" style="font-size:12px; padding:3px 8px;">Use</button>`;
                }
                
                itemText += `</p>`;
            });
            
            itemText += `<p><button onclick="cancelItemUse()" style="font-size:12px; padding:3px 8px; margin-top:10px;">Cancel</button></p>`;
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${itemText}</div>`;
        }
        
        // Use Healing Item
        function useHealingItem(itemName) {
            const itemIndex = gameState.inventory.indexOf(itemName);
            if (itemIndex !== -1) {
                gameState.inventory.splice(itemIndex, 1);
                
                let healAmount = 0;
                if (itemName === "Healing Potion") {
                    healAmount = 6;
                } else if (itemName === "Healing Salve") {
                    healAmount = 8;
                } else {
                    healAmount = 4;
                }
                
                const oldStamina = gameState.stamina;
                gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + healAmount);
                const actualHeal = gameState.stamina - oldStamina;
                
                updateInventoryDisplay();
                updateStatsDisplay();
                
                document.getElementById('story-text').innerHTML += 
                    `<div class="dice-roll"><span class="success">You use the ${itemName} and restore ${actualHeal} Stamina!</span></div>`;
            }
        }
        
        // Use Swamp Mushrooms
        function useSwampMushrooms() {
            const fungiIndex = gameState.inventory.indexOf("Glowing Swamp Mushrooms");
            if (fungiIndex !== -1) {
                gameState.inventory.splice(fungiIndex, 1);
                
                updateInventoryDisplay();
                
                const effect = rollDiceHelper(1, 6);
                let effectText = "";
                
                if (effect <= 2) {
                    gameState.stamina -= 5;
                    effectText = "The mushrooms are poisonous! You lose 5 Stamina.";
                } else if (effect <= 4) {
                    gameState.skill += 1;
                    effectText = "The mushrooms sharpen your senses! Your Skill increases by 1!";
                } else {
                    gameState.luck += 2;
                    effectText = "The mushrooms make you feel incredibly lucky! Your Luck increases by 2!";
                }
                
                updateStatsDisplay();
                
                document.getElementById('story-text').innerHTML += 
                    `<div class="dice-roll"><span class="success">You eat the glowing swamp mushrooms... ${effectText}</span></div>`;
            }
        }
        
        // Use Moonstone Ring
        function useMoonstoneRing() {
            const ringIndex = gameState.inventory.indexOf("Moonstone Ring");
            if (ringIndex !== -1) {
                gameState.inventory.splice(ringIndex, 1);
                updateInventoryDisplay();
                
                document.getElementById('story-text').innerHTML += 
                    `<div class="dice-roll"><span class="success">The Moonstone Ring glows with a soft white light, illuminating the darkness around you! Your Luck increases by 2!</span></div>`;
                
                gameState.luck += 2;
                gameState.hasLight = true;
                updateStatsDisplay();
                setTimeout(() => {
                    gameState.hasLight = false;
                    document.getElementById('story-text').innerHTML += 
                        `<div class="dice-roll">The ring's glow fades.</div>`;
                }, 30000);
            }
        }
        
        // Use Swamp Journal
        function useSwampJournal() {
            const journalIndex = gameState.inventory.indexOf("Swamp Journal");
            if (journalIndex !== -1) {
                document.getElementById('story-text').innerHTML += 
                    `<div class="dice-roll"><span class="success">You read the swamp journal: "The swamp shifts... paths change... follow the fireflies at dusk... they show the true way..." This might be useful knowledge.</span></div>`;
            }
        }
        
        // Use Swamp Herb
        function useSwampHerb() {
            const herbIndex = gameState.inventory.indexOf("Swamp Healing Herb");
            if (herbIndex !== -1) {
                gameState.inventory.splice(herbIndex, 1);
                updateInventoryDisplay();
                
                document.getElementById('story-text').innerHTML += 
                    `<div class="dice-roll"><span class="success">You chew the swamp healing herb. It has a bitter taste but cures any poison and restores 4 Stamina!</span></div>`;
                
                gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + 4);
                updateStatsDisplay();
            }
        }
        
        // Use Generic Item
        function useGenericItem(itemName) {
            const itemIndex = gameState.inventory.indexOf(itemName);
            if (itemIndex !== -1) {
                gameState.inventory.splice(itemIndex, 1);
                updateInventoryDisplay();
                
                let effectText = "";
                if (itemName.includes("Potion") || itemName.includes("Elixir")) {
                    const healAmount = rollDiceHelper(1, 4) + 2;
                    const oldStamina = gameState.stamina;
                    gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + healAmount);
                    const actualHeal = gameState.stamina - oldStamina;
                    effectText = `You use the ${itemName} and restore ${actualHeal} Stamina!`;
                    updateStatsDisplay();
                } else if (itemName.includes("Amulet") || itemName.includes("Charm")) {
                    gameState.luck += 1;
                    effectText = `You activate the ${itemName} and feel luckier! Luck +1`;
                    updateStatsDisplay();
                } else if (itemName.includes("Key")) {
                    effectText = `You examine the ${itemName}. It might unlock something important.`;
                    gameState.inventory.push(itemName);
                    updateInventoryDisplay();
                    return;
                } else {
                    effectText = `You use the ${itemName}.`;
                }
                
                document.getElementById('story-text').innerHTML += 
                    `<div class="dice-roll"><span class="success">${effectText}</span></div>`;
            }
        }
        
        // Cancel Item Use
        function cancelItemUse() {
            document.getElementById('story-text').innerHTML += 
                `<div class="dice-roll">You decide not to use an item.</div>`;
        }
        
        // Check inventory
        function checkInventory() {
            let inventoryText = "<h3>Your Inventory:</h3>";
            
            if (gameState.weapons && gameState.weapons.length > 0 && gameState.currentWeaponIndex >= 0) {
                const weapon = gameState.weapons[gameState.currentWeaponIndex];
                inventoryText += `<p><strong>Equipped Weapon:</strong> ${weapon.name} (${weapon.damage} damage)</p>`;
            }
            
            inventoryText += "<p><strong>Available Weapons:</strong><br>";
            gameState.weapons.forEach((weapon, index) => {
                const isEquipped = index === gameState.currentWeaponIndex;
                inventoryText += `${isEquipped ? " " : ""}${weapon.name} (${weapon.damage})`;
                if (!isEquipped) {
                    inventoryText += ` <button onclick="equipWeapon(${index})" style="font-size:10px; padding:2px 5px;">Equip</button>`;
                }
                inventoryText += "<br>";
            });
            inventoryText += "</p>";
            
            inventoryText += "<p><strong>Armor:</strong><br>";
            gameState.armor.forEach((armor, index) => {
                const isEquipped = index === gameState.currentArmorIndex;
                inventoryText += `${isEquipped ? " " : ""}${armor.name} (${armor.defense} DEF)`;
                if (!isEquipped) {
                    inventoryText += ` <button onclick="equipArmor(${index})" style="font-size:10px; padding:2px 5px;">Equip</button>`;
                }
                inventoryText += "<br>";
            });
            inventoryText += "</p>";
            
            inventoryText += `<p><strong>Gold:</strong> ${gameState.gold}</p>`;
            
            if (gameState.inventory && gameState.inventory.length > 0) {
                inventoryText += `<p><strong>Usable Items:</strong><br>`;
                const usableItems = gameState.inventory.filter(item => {
                    const isWeapon = gameState.weapons.some(w => w.name === item);
                    const isArmor = gameState.armor.some(a => a.name === item);
                    return !isWeapon && !isArmor;
                });
                
                if (usableItems.length > 0) {
                    usableItems.forEach(item => {
                        inventoryText += `${item} `;
                        
                        if (item === "Healing Potion" || item === "Healing Salve") {
                            inventoryText += `<button onclick="useHealingItem('${item}')" style="font-size:10px; padding:2px 5px;">Use</button>`;
                        } else if (item === "Glowing Swamp Mushrooms") {
                            inventoryText += `<button onclick="useSwampMushrooms()" style="font-size:10px; padding:2px 5px;">Use</button>`;
                        } else if (item === "Moonstone Ring") {
                            inventoryText += `<button onclick="useMoonstoneRing()" style="font-size:10px; padding:2px 5px;">Use</button>`;
                        } else if (item === "Swamp Journal") {
                            inventoryText += `<button onclick="useSwampJournal()" style="font-size:10px; padding:2px 5px;">Read</button>`;
                        } else if (item === "Swamp Healing Herb") {
                            inventoryText += `<button onclick="useSwampHerb()" style="font-size:10px; padding:2px 5px;">Use</button>`;
                        } else {
                            inventoryText += `<button onclick="useGenericItem('${item}')" style="font-size:10px; padding:2px 5px;">Use</button>`;
                        }
                        
                        inventoryText += `<br>`;
                    });
                } else {
                    inventoryText += "None";
                }
                inventoryText += `</p>`;
            }
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${inventoryText}</div>`;
        }
        
        // Equip weapon function
        function equipWeapon(index) {
            if (index >= 0 && index < gameState.weapons.length) {
                gameState.currentWeaponIndex = index;
                updateInventoryDisplay();
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">Equipped ${gameState.weapons[index].name}!</div>`;
                saveGame();
            }
        }
        
        // Equip armor function
        function equipArmor(index) {
            if (index >= 0 && index < gameState.armor.length) {
                gameState.currentArmorIndex = index;
                updateInventoryDisplay();
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">Equipped ${gameState.armor[index].name}!</div>`;
                saveGame();
            }
        }
        
        // Save game
        function saveGame() {
            if (gameState.currentWeaponIndex >= gameState.weapons.length) {
                gameState.currentWeaponIndex = gameState.weapons.length - 1;
            }
            if (gameState.currentArmorIndex >= gameState.armor.length) {
                gameState.currentArmorIndex = gameState.armor.length - 1;
            }
            
            localStorage.setItem('dreadwoodGameState', JSON.stringify(gameState));
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">Game saved!</div>`;
        }
        
        // Go to next level (Bloodstone Keep)
        function goToNextLevel() {
            localStorage.setItem('dreadwoodGameState', JSON.stringify(gameState));
            window.location.href = 'level4.html';
        }
        
        // Utility function to roll dice
        function rollDiceHelper(num, sides) {
            let total = 0;
            for (let i = 0; i < num; i++) {
                total += Math.floor(Math.random() * sides) + 1;
            }
            return total;
        }
        
        // Initialize on load
        window.onload = initGame;
    </script>
</body>
</html>
