<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Island of Lost Souls - Level 2: Forest of Dreadwood</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Source Code Pro', 'Courier New', monospace;
            background-color: #000;
            color: #fff;
            margin: 0;
            padding: 10px;
            line-height: 1.5;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        .container {
            max-width: 700px;
            margin: 0 auto;
            padding: 15px;
            border: 2px solid #0a0;
            background-color: #000;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.4);
            position: relative;
        }
        
        .header {
            text-align: center;
            border-bottom: 2px dashed #0a0;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        
        h1 {
            font-family: 'Press Start 2P', 'Courier New', monospace;
            color: #0f0;
            font-size: 28px;
            margin: 10px 0;
            text-transform: uppercase;
        }
        
        h2 {
            font-family: 'Press Start 2P', 'Courier New', monospace;
            color: #fff;
            border-bottom: 1px solid #0a0;
            padding-bottom: 5px;
            margin-top: 25px;
            text-transform: uppercase;
            font-size: 18px;
        }
        
        .screen {
            display: none;
        }
        
        .active-screen {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .level-progress {
            display: flex;
            justify-content: space-between;
            background-color: #111;
            border: 1px solid #0a0;
            padding: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .level-number {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #333;
            font-weight: bold;
            color: #888;
            background-color: #222;
            font-family: 'Press Start 2P', 'Courier New', monospace;
            font-size: 12px;
        }
        
        .level-number.completed {
            background-color: #050;
            color: #0f0;
            border-color: #0f0;
        }
        
        .level-number.current {
            background-color: #0a0;
            color: #fff;
            border-color: #0f0;
            box-shadow: 0 0 8px #0f0;
        }
        
        .stats-bar {
            background-color: #111;
            border: 1px solid #0a0;
            padding: 10px;
            margin: 15px 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            font-size: 14px;
        }
        
        .stat-item {
            margin: 5px 10px;
        }
        
        .stat-label {
            color: #fff;
        }
        
        .stat-value {
            color: #0f0;
            font-weight: bold;
            font-size: 16px;
        }
        
        .inventory-container {
            background-color: #111;
            border: 1px solid #0a0;
            padding: 10px;
            margin: 15px 0;
        }
        
        .inventory-title {
            color: #0f0;
            margin-bottom: 10px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'Press Start 2P', 'Courier New', monospace;
            font-size: 14px;
        }
        
        .inventory {
            min-height: 60px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .inventory-item {
            display: inline-block;
            background-color: #222;
            border: 1px solid #0a0;
            padding: 8px 12px;
            color: #fff;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .inventory-item:hover {
            background-color: #333;
            border-color: #0f0;
        }
        
        .inventory-item.equipped::after {
            content: "E";
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #0f0;
            color: #000;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .story-text {
            background-color: #000;
            border: 1px solid #0a0;
            padding: 15px;
            margin: 20px 0;
            min-height: 200px;
            overflow-y: auto;
            max-height: 350px;
            font-size: 16px;
            line-height: 1.6;
            color: #fff;
        }
        
        .choice-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        
        .choice-btn {
            background-color: #222;
            color: #fff;
            border: 2px solid #0a0;
            padding: 15px;
            font-family: 'Source Code Pro', 'Courier New', monospace;
            font-size: 16px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
        }
        
        .choice-btn:hover {
            background-color: #333;
            color: #0f0;
            border-color: #0f0;
        }
        
        .action-buttons {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-top: 20px;
            gap: 10px;
        }
        
        .action-btn {
            background-color: #222;
            color: #fff;
            border: 2px solid #0a0;
            padding: 10px 15px;
            font-family: 'Source Code Pro', 'Courier New', monospace;
            font-size: 14px;
            cursor: pointer;
            flex-grow: 1;
            text-align: center;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            background-color: #333;
            color: #0f0;
            border-color: #0f0;
        }
        
        .dice-roll {
            background-color: #111;
            border: 1px solid #0a0;
            padding: 10px;
            margin: 10px 0;
            text-align: center;
            color: #0f0;
            font-weight: bold;
        }
        
        .combat-log {
            background-color: #222;
            border: 1px solid #0f0;
            padding: 10px;
            margin: 10px 0;
            color: #0f0;
        }
        
        .game-over {
            color: #f00;
            font-weight: bold;
            text-align: center;
            font-size: 24px;
            margin: 20px;
        }
        
        .success {
            color: #0f0;
            font-weight: bold;
        }
        
        .damage {
            color: #f00;
            font-weight: bold;
        }
        
        .enemy {
            color: #ff9900;
            font-weight: bold;
        }
        
        .gold {
            color: #ff0;
            font-weight: bold;
        }
        
        .item {
            color: #0ff;
            font-weight: bold;
        }
        
        .cursed {
            color: #a0f;
            font-weight: bold;
        }
        
        .magic {
            color: #0cf;
            font-weight: bold;
        }
        
        .undead {
            color: #8b8;
            font-weight: bold;
        }
        
        .beast {
            color: #b85;
            font-weight: bold;
        }
        
        .next-level {
            text-align: center;
            margin-top: 20px;
            padding: 20px;
        }
        
        .next-level-btn {
            background-color: #222;
            color: #fff;
            border: 2px solid #0a0;
            padding: 15px 30px;
            font-family: 'Press Start 2P', 'Courier New', monospace;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
        }
        
        .next-level-btn:hover {
            background-color: #0a0;
            color: #fff;
            border-color: #0f0;
        }
        
        .footer {
            text-align: center;
            color: #888;
            font-size: 12px;
            margin-top: 20px;
            border-top: 1px solid #333;
            padding-top: 10px;
        }
        
        .top-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            z-index: 10;
        }
        
        .top-control-btn {
            background: #111;
            border: 1px solid #0a0;
            color: #fff;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .top-control-btn:hover {
            background: #222;
            color: #0f0;
        }
        
        .new-game-btn {
            background-color: #222;
            color: #fff;
            border: 2px solid #a00;
            padding: 10px 15px;
            font-family: 'Source Code Pro', 'Courier New', monospace;
            font-size: 14px;
            cursor: pointer;
            flex-grow: 1;
            text-align: center;
            transition: all 0.2s;
        }
        
        .new-game-btn:hover {
            background-color: #500;
            color: #f00;
            border-color: #f00;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="top-controls">
            <div class="top-control-btn" onclick="toggleSound()">
                SOUND: <span id="sound-status">ON</span>
            </div>
            <div class="top-control-btn" onclick="newGame()">
                NEW GAME
            </div>
        </div>
        
        <div class="header">
            <h1>ISLAND OF LOST SOULS</h1>
            <h2>LEVEL 2: FOREST OF DREADWOOD</h2>
        </div>
        
        <div class="level-progress">
            <div class="level-number completed">1</div>
            <div class="level-number current">2</div>
            <div class="level-number">3</div>
            <div class="level-number">4</div>
            <div class="level-number">5</div>
            <div class="level-number">6</div>
            <div class="level-number">7</div>
            <div class="level-number">8</div>
            <div class="level-number">9</div>
            <div class="level-number">10</div>
        </div>
        
        <div id="screen-game" class="screen active-screen">
            <div class="stats-bar">
                <div class="stat-item"><span class="stat-label">STRENGTH:</span> <span id="stat-strength" class="stat-value">0</span></div>
                <div class="stat-item"><span class="stat-label">HEALTH:</span> <span id="stat-health" class="stat-value">0</span>/<span id="stat-maxhealth" class="stat-value">0</span></div>
                <div class="stat-item"><span class="stat-label">AGILITY:</span> <span id="stat-agility" class="stat-value">0</span></div>
                <div class="stat-item"><span class="stat-label">MAGIC:</span> <span id="stat-magic" class="stat-value">0</span></div>
                <div class="stat-item"><span class="stat-label">GOLD:</span> <span id="stat-gold" class="stat-value">0</span></div>
                <div class="stat-item" id="dark-power-stat" style="display: none;"><span class="stat-label">DARK POWER:</span> <span id="stat-darkpower" class="stat-value">0</span></div>
            </div>
            
            <div class="inventory-container">
                <div class="inventory-title">
                    <span>INVENTORY</span>
                    <span id="inventory-count">ITEMS: 0/12</span>
                </div>
                <div class="inventory" id="inventory">
                    <!-- Inventory will be added here -->
                </div>
            </div>
            
            <h2>FOREST OF DREADWOOD</h2>
            <div class="story-text" id="story-text">
                <!-- Story will be added here -->
            </div>
            
            <div class="choice-buttons" id="choice-buttons">
                <!-- Choice buttons will be added here -->
            </div>
            
            <div class="action-buttons">
                <button class="action-btn" onclick="useClassAbility()">CLASS ABILITY</button>
                <button class="action-btn" onclick="useItem()">USE ITEM</button>
                <button class="action-btn" onclick="saveGame()">SAVE GAME</button>
                <button class="action-btn" onclick="loadGame()">LOAD GAME</button>
                <button class="new-game-btn" onclick="newGame()">NEW GAME</button>
            </div>
        </div>
        
        <div id="screen-next" class="screen">
            <h2>LEVEL 2 COMPLETE!</h2>
            <div class="story-text">
                <p>You have survived the Forest of Dreadwood!</p>
                <p>As you emerge from the dark forest, the jagged peaks of the Mountains of Moor rise before you.</p>
                <p>All your stats, gold, and inventory will carry over to Level 3: Mountains of Moor.</p>
                <div class="stats-bar">
                    <div class="stat-item"><span class="stat-label">STRENGTH:</span> <span id="next-stat-strength" class="stat-value">0</span></div>
                    <div class="stat-item"><span class="stat-label">HEALTH:</span> <span id="next-stat-health" class="stat-value">0</span></div>
                    <div class="stat-item"><span class="stat-label">AGILITY:</span> <span id="next-stat-agility" class="stat-value">0</span></div>
                    <div class="stat-item"><span class="stat-label">MAGIC:</span> <span id="next-stat-magic" class="stat-value">0</span></div>
                    <div class="stat-item"><span class="stat-label">GOLD:</span> <span id="next-stat-gold" class="stat-value">0</span></div>
                </div>
                <div style="margin-top: 15px; padding: 10px; background-color: #111; border: 1px solid #0a0;">
                    <h3 style="color: #0f0; margin-top: 0;">INVENTORY CARRYING OVER:</h3>
                    <div id="next-inventory-display"></div>
                </div>
            </div>
            
            <div class="next-level">
                <button class="next-level-btn" onclick="goToNextLevel()">CONTINUE TO LEVEL 3: MOUNTAINS OF MOOR</button>
            </div>
        </div>
        
        <div class="footer">
            ISLAND OF LOST SOULS - Level 2: Forest of Dreadwood
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            playerClass: '',
            strength: 0,
            maxHealth: 0,
            health: 0,
            agility: 0,
            magic: 0,
            darkPower: 0,
            gold: 0,
            inventory: [],
            equippedWeapon: 'Fists',
            equippedArmor: 'Tattered Clothes',
            currentSection: 1,
            level: 2,
            forestCleared: false
        };
        
        // Combat State
        let combatState = {
            active: false,
            enemyName: '',
            enemyHealth: 0,
            enemyCurrentHealth: 0,
            enemyStrength: 0,
            enemyDamageDice: 1,
            enemyDamageSides: 6,
            nextSection: 0,
            round: 1
        };
        
        // Sound
        let soundEnabled = true;
        
        function playSound(type) {
            if (!soundEnabled) return;
            // Simple beep for now
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            let frequency = 800;
            let duration = 0.1;
            
            switch(type) {
                case 'click': frequency = 800; break;
                case 'success': frequency = 1000; break;
                case 'failure': frequency = 400; break;
                case 'damage': frequency = 200; break;
                case 'combat': frequency = 1200; break;
                case 'item': frequency = 600; break;
            }
            
            oscillator.frequency.value = frequency;
            oscillator.type = 'square';
            
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.01);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }
        
        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('sound-status').textContent = soundEnabled ? 'ON' : 'OFF';
            playSound('click');
        }
        
        // Story Sections for Level 2
        const storySections = {
            1: {
                text: "You stand at the edge of the Forest of Dreadwood. The trees are twisted and dark. Strange noises echo from within.",
                choices: [
                    {text: "Follow the main path", nextSection: 2, skillCheck: false},
                    {text: "Take the overgrown trail", nextSection: 3, skillCheck: true, checkType: 'agility', difficulty: 12},
                    {text: "Search for hidden entrance", nextSection: 4, skillCheck: false}
                ]
            },
            2: {
                text: "You follow the main path into the forest. The canopy blocks most light. You hear rustling in the bushes.",
                choices: [
                    {text: "Investigate the rustling", nextSection: 5, skillCheck: false},
                    {text: "Ignore it and continue", nextSection: 6, skillCheck: false}
                ]
            },
            3: {
                text: "You take the overgrown animal trail. It's narrow but seems less traveled. You notice strange markings on trees.",
                choices: [
                    {text: "Examine the markings", nextSection: 7, skillCheck: false},
                    {text: "Continue on the trail", nextSection: 8, skillCheck: false}
                ]
            },
            4: {
                text: "You find a hidden passage behind thick vines. It leads into a dark passage between massive trees.",
                choices: [
                    {text: "Enter the hidden passage", nextSection: 9, skillCheck: false},
                    {text: "Take the main path", nextSection: 2, skillCheck: false}
                ]
            },
            5: {
                text: "You approach the rustling bushes. A CORRUPTED WOLF leaps out! Its eyes glow with unnatural red light.",
                choices: [
                    {text: "Fight the wolf", nextSection: 10, skillCheck: false},
                    {text: "Try to scare it away", nextSection: 11, skillCheck: true, checkType: 'strength', difficulty: 13}
                ]
            },
            6: {
                text: "You ignore the rustling and continue. The path becomes darker as you go deeper.",
                choices: [
                    {text: "Continue forward", nextSection: 12, skillCheck: false}
                ]
            },
            7: {
                text: "The markings appear to be ancient symbols carved into the bark.",
                choices: [
                    {text: "Try to decipher them", nextSection: 13, skillCheck: true, checkType: 'magic', difficulty: 12},
                    {text: "Continue on the trail", nextSection: 8, skillCheck: false}
                ]
            },
            8: {
                text: "You continue along the animal trail. You come to a small clearing with a moss-covered stone altar.",
                choices: [
                    {text: "Examine the altar", nextSection: 14, skillCheck: false},
                    {text: "Search the clearing", nextSection: 15, skillCheck: false}
                ]
            },
            9: {
                text: "You enter the hidden passage. It's dark but bypasses much of the forest's dangers.",
                choices: [
                    {text: "Continue from here", nextSection: 16, skillCheck: false}
                ],
                action: function() {
                    playSound('success');
                    return "The hidden passage was a shortcut! You've avoided several dangers.";
                }
            },
            10: {
                text: "The Corrupted Wolf snarls and prepares to attack!",
                choices: [
                    {text: "Fight!", nextSection: 17, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Corrupted Wolf";
                    combatState.enemyHealth = 35;
                    combatState.enemyCurrentHealth = 35;
                    combatState.enemyStrength = 10;
                    combatState.nextSection = 18;
                    playSound('combat');
                    return "<span class='beast'>Corrupted Wolf</span>: Health " + combatState.enemyCurrentHealth + ", Strength " + combatState.enemyStrength;
                }
            },
            11: {
                text: "You try to scare the wolf away...",
                choices: [
                    {text: "See if it worked", nextSection: 19, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "The wolf hesitates, then runs away. You've scared it off!";
                    } else {
                        playSound('failure');
                        return "Your attempt fails! The wolf attacks!";
                    }
                }
            },
            12: {
                text: "The forest grows denser. Glowing fungi appear on tree trunks. The path forks ahead.",
                choices: [
                    {text: "Take the left fork", nextSection: 20, skillCheck: false},
                    {text: "Take the right fork", nextSection: 21, skillCheck: false}
                ]
            },
            13: {
                text: "",
                choices: [
                    {text: "Continue on the trail", nextSection: 8, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        addToInventory('Forest Rune Knowledge');
                        return "You decipher the markings! They're protective runes. You gain <span class='item'>Forest Rune Knowledge</span>.";
                    } else {
                        playSound('failure');
                        return "You can't make sense of the markings.";
                    }
                }
            },
            14: {
                text: "The stone altar is ancient. Strange symbols are carved into its surface.",
                choices: [
                    {text: "Search around the altar", nextSection: 22, skillCheck: false},
                    {text: "Make an offering", nextSection: 23, skillCheck: false}
                ]
            },
            15: {
                text: "You search the clearing and find something useful.",
                choices: [
                    {text: "Take it and continue", nextSection: 24, skillCheck: false}
                ],
                action: function() {
                    const goldFound = rollDice(2, 10);
                    gameState.gold += goldFound;
                    updateStatsDisplay();
                    playSound('item');
                    return "You find <span class='gold'>" + goldFound + " Gold</span> coins hidden in the undergrowth.";
                }
            },
            16: {
                text: "You emerge from the hidden passage into a different part of the forest. The trees here are even larger.",
                choices: [
                    {text: "Continue forward", nextSection: 25, skillCheck: false}
                ]
            },
            17: {
                text: "", // Combat handled in combat system
                choices: [
                    {text: "Continue fighting!", nextSection: 26, skillCheck: false}
                ]
            },
            18: {
                text: "After defeating the wolf, you search its body.",
                choices: [
                    {text: "Continue your journey", nextSection: 12, skillCheck: false}
                ],
                action: function() {
                    const goldFound = rollDice(1, 15);
                    gameState.gold += goldFound;
                    updateStatsDisplay();
                    playSound('item');
                    return "You find <span class='gold'>" + goldFound + " Gold</span> on the wolf's remains.";
                }
            },
            19: {
                text: "",
                choices: [
                    {text: "Continue down the path", nextSection: 12, skillCheck: false}
                ]
            },
            20: {
                text: "The left fork leads to a crystal-clear stream. The water looks pure and refreshing.",
                choices: [
                    {text: "Drink from the stream", nextSection: 27, skillCheck: false},
                    {text: "Follow the stream", nextSection: 28, skillCheck: false}
                ]
            },
            21: {
                text: "The right fork has numerous glowing fungi that pulse with eerie light.",
                choices: [
                    {text: "Continue cautiously", nextSection: 29, skillCheck: true, checkType: 'agility', difficulty: 13},
                    {text: "Collect some fungi", nextSection: 30, skillCheck: false}
                ]
            },
            22: {
                text: "Searching around the altar, you find some interesting items.",
                choices: [
                    {text: "Take what you find", nextSection: 31, skillCheck: false}
                ],
                action: function() {
                    addToInventory('Sacred Herbs');
                    playSound('item');
                    return "You find some <span class='item'>Sacred Herbs</span> that retain a faint magical aura.";
                }
            },
            23: {
                text: "You make an offering at the altar.",
                choices: [
                    {text: "Continue your journey", nextSection: 24, skillCheck: false}
                ],
                action: function() {
                    if (gameState.gold >= 10) {
                        gameState.gold -= 10;
                        gameState.health = gameState.maxHealth;
                        updateStatsDisplay();
                        playSound('magic');
                        return "You offer 10 Gold. A warm light envelops you, healing all your wounds!";
                    } else {
                        playSound('failure');
                        return "You don't have enough gold to make a proper offering.";
                    }
                }
            },
            24: {
                text: "You leave the clearing and continue through the forest. The path becomes steeper.",
                choices: [
                    {text: "Continue climbing", nextSection: 32, skillCheck: false}
                ]
            },
            25: {
                text: "You walk among giant trees. The air is still and silent. You come to a circular clearing with an ancient oak.",
                choices: [
                    {text: "Approach the ancient oak", nextSection: 33, skillCheck: false},
                    {text: "Search the clearing", nextSection: 34, skillCheck: false}
                ]
            },
            26: {
                text: "", // Combat round
                choices: [
                    {text: "Continue fighting!", nextSection: 17, skillCheck: false}
                ]
            },
            27: {
                text: "You drink from the clear stream. The water is cold and refreshing.",
                choices: [
                    {text: "Continue following the stream", nextSection: 28, skillCheck: false}
                ],
                action: function() {
                    const healAmount = rollDice(1, 8) + 2;
                    const oldHealth = gameState.health;
                    gameState.health = Math.min(gameState.maxHealth, gameState.health + healAmount);
                    const actualHeal = gameState.health - oldHealth;
                    playSound('success');
                    return "The pure forest water refreshes you, healing " + actualHeal + " Health.";
                }
            },
            28: {
                text: "You follow the stream upstream to a beautiful glade with a small waterfall.",
                choices: [
                    {text: "Rest in the glade", nextSection: 35, skillCheck: false},
                    {text: "Continue your journey", nextSection: 36, skillCheck: false}
                ]
            },
            29: {
                text: "",
                choices: [
                    {text: "Continue down the path", nextSection: 37, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You move carefully past the reactive fungi without disturbing them.";
                    } else {
                        playSound('failure');
                        const damage = rollDice(1, 6);
                        gameState.health -= damage;
                        updateStatsDisplay();
                        return "You disturb the fungi! They release spores. You take <span class='damage'>" + damage + " damage</span>.";
                    }
                }
            },
            30: {
                text: "You carefully collect samples of the glowing fungi.",
                choices: [
                    {text: "Continue down the path", nextSection: 37, skillCheck: false}
                ],
                action: function() {
                    addToInventory('Glowing Fungi Samples');
                    playSound('item');
                    return "You collect <span class='item'>Glowing Fungi Samples</span>.";
                }
            },
            31: {
                text: "You've taken what you found around the altar.",
                choices: [
                    {text: "Make an offering", nextSection: 23, skillCheck: false},
                    {text: "Continue your journey", nextSection: 24, skillCheck: false}
                ]
            },
            32: {
                text: "You climb higher. The air grows colder. Snow begins to appear on the ground.",
                choices: [
                    {text: "Continue to the tree line", nextSection: 38, skillCheck: false},
                    {text: "Rest before continuing", nextSection: 39, skillCheck: false}
                ]
            },
            33: {
                text: "The ancient oak radiates great age and wisdom. You sense it has knowledge to share.",
                choices: [
                    {text: "Touch the tree", nextSection: 40, skillCheck: false},
                    {text: "Speak to the tree", nextSection: 41, skillCheck: false}
                ]
            },
            34: {
                text: "You search the clearing around the ancient oak.",
                choices: [
                    {text: "Take what you find", nextSection: 42, skillCheck: false}
                ],
                action: function() {
                    const findChance = Math.random();
                    if (findChance > 0.7) {
                        gameState.maxHealth += 5;
                        gameState.health += 5;
                        updateStatsDisplay();
                        playSound('magic');
                        return "You find miraculous herbs! <span class='success'>Maximum Health +5</span>";
                    } else {
                        addToInventory('Ancient Bark');
                        playSound('item');
                        return "You collect <span class='item'>Ancient Bark</span> from the tree.";
                    }
                }
            },
            35: {
                text: "You rest in the peaceful glade. The sound of the waterfall is soothing.",
                choices: [
                    {text: "Continue your journey", nextSection: 36, skillCheck: false}
                ],
                action: function() {
                    const healAmount = rollDice(2, 6) + 4;
                    const oldHealth = gameState.health;
                    gameState.health = Math.min(gameState.maxHealth, gameState.health + healAmount);
                    const actualHeal = gameState.health - oldHealth;
                    playSound('success');
                    return "The peaceful glade restores you. You heal " + actualHeal + " Health.";
                }
            },
            36: {
                text: "You leave the glade and continue. The path becomes steeper as you climb.",
                choices: [
                    {text: "Continue climbing", nextSection: 32, skillCheck: false}
                ]
            },
            37: {
                text: "You continue past the glowing fungi. The forest begins to change - trees become more stunted.",
                choices: [
                    {text: "Continue forward", nextSection: 43, skillCheck: false}
                ]
            },
            38: {
                text: "You push upward and finally reach the tree line! The forest ends, giving way to rocky mountain slopes.",
                choices: [
                    {text: "Enter the mountains", nextSection: 100, skillCheck: false}
                ]
            },
            39: {
                text: "You find a sheltered spot to rest before the final push.",
                choices: [
                    {text: "Continue to the tree line", nextSection: 38, skillCheck: false}
                ],
                action: function() {
                    const healAmount = rollDice(1, 10) + 5;
                    const oldHealth = gameState.health;
                    gameState.health = Math.min(gameState.maxHealth, gameState.health + healAmount);
                    const actualHeal = gameState.health - oldHealth;
                    playSound('success');
                    return "You rest and recover " + actualHeal + " Health.";
                }
            },
            40: {
                text: "You touch the ancient oak. A flow of knowledge enters your mind.",
                choices: [
                    {text: "Receive the knowledge", nextSection: 44, skillCheck: false}
                ],
                action: function() {
                    playSound('magic');
                    gameState.agility += 2;
                    updateStatsDisplay();
                    addToInventory('Ancient Oak Wisdom');
                    return "The oak shares its wisdom! <span class='success'>Agility +2</span>. You gain <span class='item'>Ancient Oak Wisdom</span>.";
                }
            },
            41: {
                text: "You speak to the ancient oak. A deep voice echoes in your mind.",
                choices: [
                    {text: "Ask for guidance", nextSection: 45, skillCheck: false}
                ]
            },
            42: {
                text: "You've taken what you found in the clearing.",
                choices: [
                    {text: "Touch the tree", nextSection: 40, skillCheck: false},
                    {text: "Speak to the tree", nextSection: 41, skillCheck: false},
                    {text: "Leave the clearing", nextSection: 46, skillCheck: false}
                ]
            },
            43: {
                text: "You continue upward. The air is colder now. You notice animal tracks in the mud.",
                choices: [
                    {text: "Follow the tracks", nextSection: 47, skillCheck: false},
                    {text: "Avoid the tracks", nextSection: 48, skillCheck: false}
                ]
            },
            44: {
                text: "You thank the ancient oak for its wisdom.",
                choices: [
                    {text: "Leave the clearing", nextSection: 46, skillCheck: false}
                ]
            },
            45: {
                text: "'THE PATH AHEAD IS DANGEROUS,' the tree says. 'RESPECT THE FOREST AND IT WILL RESPECT YOU.'",
                choices: [
                    {text: "Thank the tree and leave", nextSection: 46, skillCheck: false}
                ],
                action: function() {
                    playSound('success');
                    addToInventory('Tree Markings Knowledge');
                    return "The ancient oak gives you guidance. You gain <span class='item'>Tree Markings Knowledge</span>.";
                }
            },
            46: {
                text: "You leave the ancient clearing and continue through the forest.",
                choices: [
                    {text: "Continue climbing", nextSection: 49, skillCheck: false}
                ]
            },
            47: {
                text: "You follow the large animal tracks to a cave entrance. Heavy breathing comes from within.",
                choices: [
                    {text: "Enter the cave", nextSection: 50, skillCheck: false},
                    {text: "Back away quietly", nextSection: 51, skillCheck: true, checkType: 'agility', difficulty: 14}
                ]
            },
            48: {
                text: "You avoid the animal tracks, giving whatever made them a wide berth.",
                choices: [
                    {text: "Continue upward", nextSection: 52, skillCheck: false}
                ],
                action: function() {
                    playSound('success');
                    return "You successfully avoid the large creature. Smart move.";
                }
            },
            49: {
                text: "You climb steadily upward. The trees are sparse now, and you can see patches of sky.",
                choices: [
                    {text: "Push on to the tree line", nextSection: 53, skillCheck: false}
                ]
            },
            50: {
                text: "You enter the cave cautiously. Inside, a HUGE FOREST BEAR sleeps on a pile of leaves.",
                choices: [
                    {text: "Back out quietly", nextSection: 54, skillCheck: true, checkType: 'agility', difficulty: 15},
                    {text: "Attack the sleeping bear", nextSection: 55, skillCheck: false}
                ]
            },
            51: {
                text: "",
                choices: [
                    {text: "Continue upward", nextSection: 52, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You back away silently and the creature doesn't wake.";
                    } else {
                        playSound('failure');
                        return "You step on a twig! The bear wakes up and charges!";
                    }
                }
            },
            52: {
                text: "You continue upward, avoiding the creature's territory.",
                choices: [
                    {text: "Continue to the tree line", nextSection: 53, skillCheck: false}
                ]
            },
            53: {
                text: "You make one final push and emerge from the Forest of Dreadwood!",
                choices: [
                    {text: "Enter the Mountains of Moor", nextSection: 100, skillCheck: false}
                ]
            },
            54: {
                text: "",
                choices: [
                    {text: "Continue upward", nextSection: 52, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You successfully back out without waking the bear.";
                    } else {
                        playSound('failure');
                        return "You trip on a rock! The bear wakes with a roar!";
                    }
                }
            },
            55: {
                text: "You attack the sleeping bear! It wakes with a roar of pain and fury!",
                choices: [
                    {text: "Fight!", nextSection: 56, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Forest Bear";
                    combatState.enemyHealth = 50;
                    combatState.enemyCurrentHealth = 50;
                    combatState.enemyStrength = 14;
                    combatState.nextSection = 57;
                    playSound('combat');
                    return "<span class='beast'>Forest Bear</span>: Health " + combatState.enemyCurrentHealth + ", Strength " + combatState.enemyStrength;
                }
            },
            56: {
                text: "", // Combat round
                choices: [
                    {text: "Continue fighting!", nextSection: 58, skillCheck: false}
                ]
            },
            57: {
                text: "After defeating the bear, you search its cave.",
                choices: [
                    {text: "Take what you find", nextSection: 59, skillCheck: false},
                    {text: "Continue upward", nextSection: 52, skillCheck: false}
                ],
                action: function() {
                    const goldFound = rollDice(3, 15);
                    gameState.gold += goldFound;
                    addToInventory('Bear Pelt');
                    updateStatsDisplay();
                    playSound('item');
                    return "You find <span class='gold'>" + goldFound + " Gold</span> and a <span class='item'>Bear Pelt</span>.";
                }
            },
            58: {
                text: "", // Combat round
                choices: [
                    {text: "Continue fighting!", nextSection: 56, skillCheck: false}
                ]
            },
            59: {
                text: "You've taken everything from the bear's cave.",
                choices: [
                    {text: "Continue upward", nextSection: 52, skillCheck: false}
                ]
            },
            100: {
                text: "CONGRATULATIONS! You have survived the Forest of Dreadwood. You stand at the edge of the mountains, ready for your next challenge.",
                choices: [],
                action: function() {
                    gameState.forestCleared = true;
                    showScreen('screen-next');
                    document.getElementById('next-stat-strength').textContent = gameState.strength;
                    document.getElementById('next-stat-health').textContent = gameState.health;
                    document.getElementById('next-stat-agility').textContent = gameState.agility;
                    document.getElementById('next-stat-magic').textContent = gameState.magic;
                    document.getElementById('next-stat-gold').textContent = gameState.gold;
                    
                    const inventoryDisplay = document.getElementById('next-inventory-display');
                    inventoryDisplay.innerHTML = '';
                    
                    const equippedDiv = document.createElement('div');
                    equippedDiv.innerHTML = `<strong>Equipped:</strong> ${gameState.equippedWeapon}, ${gameState.equippedArmor}`;
                    inventoryDisplay.appendChild(equippedDiv);
                    
                    if (gameState.inventory.length > 0) {
                        const invDiv = document.createElement('div');
                        invDiv.innerHTML = `<strong>Inventory:</strong> ${gameState.inventory.join(', ')}`;
                        inventoryDisplay.appendChild(invDiv);
                    }
                    
                    gameState.level = 3;
                    saveGame();
                    
                    return "";
                }
            }
        };
        
        // Initialize Game
        function initGame() {
            console.log("Initializing Level 2...");
            
            // Try to load saved game
            const savedGame = localStorage.getItem('islandLostSoulsGameState');
            console.log("Saved game found:", savedGame);
            
            if (savedGame) {
                try {
                    const savedState = JSON.parse(savedGame);
                    console.log("Parsed saved state:", savedState);
                    
                    // Update game state with saved data
                    Object.assign(gameState, savedState);
                    gameState.level = 2; // Force level to 2 for this page
                    gameState.currentSection = 1; // Start at beginning of forest
                    
                    console.log("Game state loaded:", gameState);
                    
                    // Update display
                    updateStatsDisplay();
                    updateInventoryDisplay();
                    
                    // Load first section
                    loadSection(1);
                    
                } catch (e) {
                    console.error("Error loading saved game:", e);
                    alert("Error loading saved game. Starting new game.");
                    startNewGame();
                }
            } else {
                console.log("No saved game found, starting new");
                alert("No saved game found. Please complete Level 1 first.");
                window.location.href = 'lvl1.html';
            }
        }
        
        function startNewGame() {
            // Default values for testing
            gameState = {
                playerClass: 'warrior',
                strength: 10,
                maxHealth: 40,
                health: 40,
                agility: 8,
                magic: 5,
                darkPower: 0,
                gold: 50,
                inventory: ['Healing Herbs', 'Length of Rope', 'Lockpicks'],
                equippedWeapon: 'Broken Sword',
                equippedArmor: 'Tattered Clothes',
                currentSection: 1,
                level: 2,
                forestCleared: false
            };
            
            updateStatsDisplay();
            updateInventoryDisplay();
            loadSection(1);
        }
        
        // Show screen
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active-screen');
            });
            document.getElementById(screenId).classList.add('active-screen');
        }
        
        // Update stats display
        function updateStatsDisplay() {
            document.getElementById('stat-strength').textContent = gameState.strength;
            document.getElementById('stat-health').textContent = gameState.health;
            document.getElementById('stat-maxhealth').textContent = gameState.maxHealth;
            document.getElementById('stat-agility').textContent = gameState.agility;
            document.getElementById('stat-magic').textContent = gameState.magic;
            document.getElementById('stat-gold').textContent = gameState.gold;
            
            if (gameState.playerClass === 'necromancer' && gameState.darkPower > 0) {
                document.getElementById('dark-power-stat').style.display = 'block';
                document.getElementById('stat-darkpower').textContent = gameState.darkPower;
            }
        }
        
        // Add to inventory
        function addToInventory(item) {
            if (!gameState.inventory.includes(item)) {
                gameState.inventory.push(item);
                updateInventoryDisplay();
            }
        }
        
        // Remove from inventory
        function removeFromInventory(item) {
            const index = gameState.inventory.indexOf(item);
            if (index > -1) {
                gameState.inventory.splice(index, 1);
                updateInventoryDisplay();
            }
        }
        
        // Update inventory display
        function updateInventoryDisplay() {
            const inventoryDiv = document.getElementById('inventory');
            inventoryDiv.innerHTML = '';
            
            // Add equipped items
            const equippedWeapon = document.createElement('div');
            equippedWeapon.className = 'inventory-item equipped';
            equippedWeapon.textContent = gameState.equippedWeapon;
            equippedWeapon.onclick = () => {
                playSound('click');
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">Equipped: <span class='item'>${gameState.equippedWeapon}</span></div>`;
            };
            inventoryDiv.appendChild(equippedWeapon);
            
            const equippedArmor = document.createElement('div');
            equippedArmor.className = 'inventory-item equipped';
            equippedArmor.textContent = gameState.equippedArmor;
            equippedArmor.onclick = () => {
                playSound('click');
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">Equipped: <span class='item'>${gameState.equippedArmor}</span></div>`;
            };
            inventoryDiv.appendChild(equippedArmor);
            
            // Add other inventory
            gameState.inventory.forEach(item => {
                if (item !== gameState.equippedWeapon && item !== gameState.equippedArmor) {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'inventory-item';
                    itemElement.textContent = item;
                    itemElement.onclick = () => useInventoryItem(item);
                    inventoryDiv.appendChild(itemElement);
                }
            });
            
            document.getElementById('inventory-count').textContent = `ITEMS: ${gameState.inventory.length + 2}/12`;
        }
        
        // Use inventory item
        function useInventoryItem(item) {
            playSound('click');
            let message = "";
            
            if (item === 'Healing Herbs' || item === 'Sacred Herbs') {
                const healAmount = rollDice(1, 10) + 5;
                const oldHealth = gameState.health;
                gameState.health = Math.min(gameState.maxHealth, gameState.health + healAmount);
                const actualHeal = gameState.health - oldHealth;
                removeFromInventory(item);
                playSound('item');
                message = `You use <span class='item'>${item}</span> and heal ${actualHeal} Health!`;
                updateStatsDisplay();
            } else if (item === 'Length of Rope') {
                message = "The rope could be useful for climbing.";
            } else if (item === 'Lockpicks') {
                message = "Lockpicks might help with locked doors.";
            } else if (item === 'Glowing Fungi Samples') {
                message = "The fungi glow with an eerie light.";
            } else if (item === 'Ancient Bark') {
                message = "The bark feels warm and ancient.";
            } else if (item === 'Bear Pelt') {
                message = "The bear pelt is warm and thick.";
            } else if (item.includes('Knowledge') || item.includes('Wisdom')) {
                message = `Your <span class='item'>${item}</span> gives you special understanding.`;
            } else {
                message = `You examine the <span class='item'>${item}</span>.`;
            }
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${message}</div>`;
        }
        
        // Use item button
        function useItem() {
            playSound('click');
            if (gameState.inventory.length === 0) {
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">Your inventory is empty.</div>`;
                return;
            }
            
            let itemText = "<div class='dice-roll'><strong>Select an item:</strong><br>";
            gameState.inventory.forEach(item => {
                itemText += `<button onclick="useInventoryItem('${item}')" style="margin:5px;">${item}</button> `;
            });
            itemText += `<br><button onclick="document.getElementById('story-text').innerHTML += '<div class=dice-roll>Cancelled.</div>'" style="margin:5px;">Cancel</button>`;
            itemText += "</div>";
            
            document.getElementById('story-text').innerHTML += itemText;
        }
        
        // Class ability
        function useClassAbility() {
            playSound('click');
            let abilityText = "<div class='dice-roll'>";
            
            if (gameState.playerClass === 'wizard') {
                abilityText += "<strong>Wizard Spells:</strong><br>";
                abilityText += `<button onclick="castSpell('light')" style="margin:5px;">Light</button> `;
                abilityText += `<button onclick="castSpell('shield')" style="margin:5px;">Shield</button>`;
            } else if (gameState.playerClass === 'warrior') {
                abilityText += "<strong>Warrior Abilities:</strong><br>";
                abilityText += `<button onclick="warriorAbility('intimidate')" style="margin:5px;">Intimidate</button> `;
                abilityText += `<button onclick="warriorAbility('second_wind')" style="margin:5px;">Second Wind</button>`;
            } else if (gameState.playerClass === 'necromancer') {
                abilityText += "<strong>Necromancer Powers:</strong><br>";
                abilityText += `<button onclick="necromancerAbility('dark_healing')" style="margin:5px;">Dark Healing</button> `;
                abilityText += `<button onclick="necromancerAbility('sense_death')" style="margin:5px;">Sense Death</button>`;
            }
            
            abilityText += `<br><button onclick="document.getElementById('story-text').innerHTML += '<div class=dice-roll>Cancelled.</div>'" style="margin:5px;">Cancel</button>`;
            abilityText += "</div>";
            
            document.getElementById('story-text').innerHTML += abilityText;
        }
        
        // Wizard spells
        function castSpell(spell) {
            playSound('magic');
            const magicCheck = rollDice(2, 6);
            let message = "";
            
            if (magicCheck <= gameState.magic) {
                playSound('success');
                if (spell === 'light') {
                    message = "You cast Light! The area brightens.";
                } else if (spell === 'shield') {
                    message = "You cast Shield! You gain temporary protection.";
                }
            } else {
                playSound('failure');
                message = "The spell fizzles.";
                gameState.health -= 1;
                updateStatsDisplay();
            }
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${message}</div>`;
        }
        
        // Warrior abilities
        function warriorAbility(ability) {
            playSound('combat');
            let message = "";
            
            if (ability === 'intimidate') {
                const strengthCheck = rollDice(2, 6);
                if (strengthCheck <= gameState.strength) {
                    playSound('success');
                    message = "You intimidate your foes!";
                } else {
                    playSound('failure');
                    message = "Your attempt fails.";
                }
            } else if (ability === 'second_wind') {
                const healAmount = rollDice(1, 6) + Math.floor(gameState.strength / 2);
                const oldHealth = gameState.health;
                gameState.health = Math.min(gameState.maxHealth, gameState.health + healAmount);
                const actualHeal = gameState.health - oldHealth;
                playSound('success');
                message = `You catch your second wind and heal ${actualHeal} Health!`;
                updateStatsDisplay();
            }
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${message}</div>`;
        }
        
        // Necromancer abilities
        function necromancerAbility(ability) {
            playSound('magic');
            let message = "";
            
            if (ability === 'dark_healing') {
                if (gameState.darkPower >= 1) {
                    const healAmount = rollDice(1, 8) + gameState.darkPower;
                    const oldHealth = gameState.health;
                    gameState.health = Math.min(gameState.maxHealth, gameState.health + healAmount);
                    const actualHeal = gameState.health - oldHealth;
                    gameState.darkPower -= 1;
                    playSound('success');
                    message = `You drain life energy, healing ${actualHeal} Health!`;
                    updateStatsDisplay();
                } else {
                    playSound('failure');
                    message = "Not enough Dark Power.";
                }
            } else if (ability === 'sense_death') {
                message = "You sense death and undeath in the area.";
                playSound('success');
            }
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${message}</div>`;
        }
        
        // Load story section
        function loadSection(sectionId) {
            playSound('click');
            gameState.currentSection = sectionId;
            const section = storySections[sectionId];
            
            if (!section) {
                document.getElementById('story-text').innerHTML = "<p>Error: Section not found</p>";
                return;
            }
            
            let storyText = section.text;
            
            // Check for combat
            if ((sectionId === 17 || sectionId === 26 || sectionId === 56 || sectionId === 58) && combatState.active) {
                const combatResult = executeCombatRound();
                storyText = combatResult;
                
                if (!combatState.active) {
                    setTimeout(() => {
                        loadSection(combatState.nextSection);
                    }, 2000);
                }
            }
            
            // Execute section action
            if (section.action) {
                const actionResult = section.action();
                if (actionResult) {
                    storyText += "<br><br>" + actionResult;
                }
            }
            
            document.getElementById('story-text').innerHTML = "<p>" + storyText + "</p>";
            
            // Update choice buttons
            const choiceButtons = document.getElementById('choice-buttons');
            choiceButtons.innerHTML = '';
            
            const availableChoices = section.choices.filter(choice => {
                if (choice.requirement === 'magic') {
                    return gameState.magic >= choice.minValue;
                }
                return true;
            });
            
            if (availableChoices.length === 0 && section.choices.length > 0) {
                const button = document.createElement('button');
                button.className = 'choice-btn';
                button.textContent = "Continue through the forest";
                button.onclick = () => loadSection(1);
                choiceButtons.appendChild(button);
            } else {
                availableChoices.forEach(choice => {
                    const button = document.createElement('button');
                    button.className = 'choice-btn';
                    button.textContent = choice.text;
                    button.onclick = () => {
                        if (choice.skillCheck) {
                            performSkillCheck(choice.checkType, choice.difficulty, choice.nextSection);
                        } else {
                            loadSection(choice.nextSection);
                        }
                    };
                    choiceButtons.appendChild(button);
                });
            }
            
            saveGame();
        }
        
        // Execute combat round
        function executeCombatRound() {
            combatState.round++;
            
            const playerRoll = rollDice(2, 6);
            const enemyRoll = rollDice(2, 6);
            
            const playerTotal = playerRoll + gameState.strength;
            const enemyTotal = enemyRoll + combatState.enemyStrength;
            
            let resultText = `<div class="combat-log">Round ${combatState.round}: ${combatState.enemyName}<br>`;
            resultText += `Your Health: ${gameState.health}, Enemy Health: ${combatState.enemyCurrentHealth}<br>`;
            resultText += `You roll ${playerRoll} + ${gameState.strength} = <strong>${playerTotal}</strong><br>`;
            resultText += `Enemy rolls ${enemyRoll} + ${combatState.enemyStrength} = <strong>${enemyTotal}</strong><br>`;
            
            if (playerTotal > enemyTotal) {
                let damage = 0;
                if (gameState.equippedWeapon === 'Fists') damage = rollDice(1, 4);
                else if (gameState.equippedWeapon === 'Broken Sword') damage = rollDice(1, 8);
                else damage = rollDice(1, 6);
                
                combatState.enemyCurrentHealth -= damage;
                resultText += `<span class="success">You hit for ${damage} damage!</span><br>`;
                playSound('combat');
                
                if (combatState.enemyCurrentHealth <= 0) {
                    combatState.active = false;
                    resultText += `</div>`;
                    return resultText;
                }
            } else if (playerTotal < enemyTotal) {
                const enemyDamage = rollDice(combatState.enemyDamageDice, combatState.enemyDamageSides);
                gameState.health -= enemyDamage;
                resultText += `<span class="damage">Enemy hits for ${enemyDamage} damage!</span>`;
                playSound('damage');
                
                if (gameState.health <= 0) {
                    combatState.active = false;
                    resultText += `<br><span class="game-over">You have been defeated!</span>`;
                    resultText += `</div>`;
                    
                    setTimeout(() => {
                        localStorage.removeItem('islandLostSoulsGameState');
                        location.reload();
                    }, 3000);
                    
                    return resultText;
                }
            } else {
                resultText += "The attacks are evenly matched!";
            }
            
            resultText += `</div>`;
            updateStatsDisplay();
            
            return resultText;
        }
        
        // Skill check
        function performSkillCheck(checkType, difficulty, nextSection) {
            playSound('roll');
            const diceRoll = rollDice(2, 6);
            let statValue = gameState[checkType];
            let success = diceRoll <= statValue;
            
            window.checkResult = success;
            
            let resultText = `Roll: ${diceRoll}. Your ${checkType}: ${statValue}. `;
            resultText += success ? `<span class="success">Success!</span>` : `<span class="damage">Failure!</span>`;
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${resultText}</div>`;
            
            if (success) playSound('success');
            else playSound('failure');
            
            setTimeout(() => {
                loadSection(nextSection);
            }, 1500);
        }
        
        // Roll dice
        function rollDice(num, sides) {
            let total = 0;
            for (let i = 0; i < num; i++) {
                total += Math.floor(Math.random() * sides) + 1;
            }
            return total;
        }
        
        // New game
        function newGame() {
            playSound('click');
            if (confirm("Start new game? Current progress will be lost.")) {
                localStorage.removeItem('islandLostSoulsGameState');
                window.location.href = 'lvl1.html';
            }
        }
        
        // Save game
        function saveGame() {
            playSound('click');
            localStorage.setItem('islandLostSoulsGameState', JSON.stringify(gameState));
            document.getElementById('story-text').innerHTML += `<div class="dice-roll"><span class="success">Game saved!</span></div>`;
        }
        
        // Load game
        function loadGame() {
            playSound('click');
            const savedGame = localStorage.getItem('islandLostSoulsGameState');
            if (savedGame) {
                const savedState = JSON.parse(savedGame);
                Object.assign(gameState, savedState);
                updateStatsDisplay();
                updateInventoryDisplay();
                loadSection(gameState.currentSection);
                document.getElementById('story-text').innerHTML += `<div class="dice-roll"><span class="success">Game loaded!</span></div>`;
            } else {
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">No saved game found.</div>`;
            }
        }
        
        // Go to next level
        function goToNextLevel() {
            playSound('click');
            gameState.level = 3;
            localStorage.setItem('islandLostSoulsGameState', JSON.stringify(gameState));
            window.location.href = 'lvl3.html';
        }
        
        // Initialize on load
        window.onload = initGame;
        
        // Add click sound to buttons
        document.addEventListener('DOMContentLoaded', function() {
            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => {
                button.addEventListener('click', function() {
                    playSound('click');
                });
            });
        });
    </script>
</body>
</html>
