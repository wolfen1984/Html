<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LAND OF THE DAMMED - Level 2: Deadwood Mountains</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Retro terminal style - Green/Black/White theme */
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Source Code Pro', 'Courier New', monospace;
            background-color: #000;
            color: #0f0;
            margin: 0;
            padding: 10px;
            line-height: 1.5;
            max-width: 100%;
            overflow-x: hidden;
            min-height: 100vh;
            background-image: 
                linear-gradient(rgba(0, 20, 0, 0.2) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 20, 0, 0.2) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .container {
            max-width: 700px;
            margin: 0 auto;
            padding: 15px;
            border: 2px solid #0f0;
            background-color: #000;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
            position: relative;
            min-height: calc(100vh - 40px);
            overflow: hidden;
        }
        
        /* Scanline effect for authentic CRT monitor feel */
        .container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                transparent 50%,
                rgba(0, 30, 0, 0.1) 50%
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 2;
        }
        
        .header {
            text-align: center;
            border-bottom: 2px dashed #0f0;
            padding-bottom: 15px;
            margin-bottom: 20px;
            position: relative;
        }
        
        h1 {
            font-family: 'Press Start 2P', 'Courier New', monospace;
            color: #0f0;
            text-shadow: 0 0 5px #0f0;
            font-size: 28px;
            margin: 10px 0;
            letter-spacing: 2px;
            text-transform: uppercase;
            font-weight: normal;
        }
        
        h2 {
            font-family: 'Press Start 2P', 'Courier New', monospace;
            color: #fff;
            border-bottom: 1px solid #0f0;
            padding-bottom: 5px;
            margin-top: 25px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 18px;
            font-weight: normal;
        }
        
        .screen {
            display: none;
            position: relative;
            z-index: 1;
        }
        
        .active-screen {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Level Progress Indicator */
        .level-progress {
            display: flex;
            justify-content: space-between;
            background-color: #111;
            border: 1px solid #0f0;
            padding: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .level-number {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #333;
            font-weight: bold;
            color: #888;
            background-color: #111;
            font-family: 'Press Start 2P', 'Courier New', monospace;
            font-size: 12px;
        }
        
        .level-number.completed {
            background-color: #050;
            color: #0f0;
            border-color: #0f0;
        }
        
        .level-number.current {
            background-color: #0f0;
            color: #000;
            border-color: #0f0;
            box-shadow: 0 0 8px #0f0;
            text-shadow: 0 0 2px #000;
        }
        
        .level-number.future {
            background-color: #111;
            color: #444;
            border-color: #333;
        }
        
        /* Stats Bar */
        .stats-bar {
            background-color: #111;
            border: 1px solid #0f0;
            padding: 10px;
            margin: 15px 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            font-size: 14px;
        }
        
        .stat-item {
            margin: 5px 10px;
        }
        
        .stat-label {
            color: #fff;
        }
        
        .stat-value {
            color: #0f0;
            font-weight: bold;
            font-size: 16px;
        }
        
        /* Inventory */
        .inventory-container {
            background-color: #111;
            border: 1px solid #0f0;
            padding: 10px;
            margin: 15px 0;
        }
        
        .inventory-title {
            color: #0f0;
            margin-bottom: 10px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'Press Start 2P', 'Courier New', monospace;
            font-size: 14px;
        }
        
        .inventory {
            min-height: 60px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .inventory-item {
            display: inline-block;
            background-color: #111;
            border: 1px solid #0f0;
            padding: 8px 12px;
            color: #fff;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .inventory-item:hover {
            background-color: #222;
            border-color: #0f0;
            transform: translateY(-2px);
            box-shadow: 0 0 5px #0f0;
        }
        
        .inventory-item.equipped::after {
            content: "E";
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #0f0;
            color: #000;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-family: 'Press Start 2P', 'Courier New', monospace;
        }
        
        /* Story Text Area */
        .story-text {
            background-color: #000;
            border: 1px solid #0f0;
            padding: 15px;
            margin: 20px 0;
            min-height: 200px;
            overflow-y: auto;
            max-height: 350px;
            font-size: 16px;
            line-height: 1.6;
            color: #0f0;
        }
        
        /* Choice Buttons */
        .choice-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        
        .choice-btn {
            background-color: #111;
            color: #0f0;
            border: 2px solid #0f0;
            padding: 15px;
            font-family: 'Source Code Pro', 'Courier New', monospace;
            font-size: 16px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .choice-btn:hover, .choice-btn:active {
            background-color: #222;
            color: #0f0;
            border-color: #0f0;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
        }
        
        .choice-btn::after {
            content: ">";
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #0f0;
            font-weight: bold;
        }
        
        .choice-btn:hover::after {
            color: #0f0;
            text-shadow: 0 0 3px #0f0;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-top: 20px;
            gap: 10px;
        }
        
        .action-btn {
            background-color: #111;
            color: #0f0;
            border: 2px solid #0f0;
            padding: 10px 15px;
            font-family: 'Source Code Pro', 'Courier New', monospace;
            font-size: 14px;
            cursor: pointer;
            flex-grow: 1;
            text-align: center;
            transition: all 0.2s;
        }
        
        .action-btn:hover, .action-btn:active {
            background-color: #222;
            color: #0f0;
            border-color: #0f0;
            box-shadow: 0 0 8px #0f0;
        }
        
        /* Reset Button */
        .reset-btn {
            background-color: #300;
            color: #f00;
            border: 2px solid #f00;
            padding: 10px 15px;
            font-family: 'Source Code Pro', 'Courier New', monospace;
            font-size: 14px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            margin-top: 10px;
        }
        
        .reset-btn:hover, .reset-btn:active {
            background-color: #500;
            color: #f00;
            border-color: #f00;
            box-shadow: 0 0 8px #f00;
        }
        
        /* Dice Roll Display */
        .dice-roll {
            background-color: #111;
            border: 1px solid #0f0;
            padding: 10px;
            margin: 10px 0;
            text-align: center;
            color: #0f0;
            font-weight: bold;
        }
        
        /* Combat Display */
        .combat-log {
            background-color: #111;
            border: 1px solid #0f0;
            padding: 10px;
            margin: 10px 0;
            color: #0f0;
        }
        
        /* Special Text Styles */
        .game-over {
            color: #f00;
            font-weight: bold;
            text-align: center;
            font-size: 24px;
            margin: 20px;
            text-shadow: 0 0 5px #f00;
            font-family: 'Press Start 2P', 'Courier New', monospace;
        }
        
        .success {
            color: #0f0;
            font-weight: bold;
        }
        
        .damage {
            color: #f00;
            font-weight: bold;
        }
        
        .enemy {
            color: #ff9900;
            font-weight: bold;
        }
        
        .gold {
            color: #ff0;
            font-weight: bold;
        }
        
        .item {
            color: #0ff;
            font-weight: bold;
        }
        
        .mountain-spirit {
            color: #a0a0ff;
            font-weight: bold;
            text-shadow: 0 0 3px #00f;
        }
        
        /* Next Level Button */
        .next-level {
            text-align: center;
            margin-top: 20px;
            padding: 20px;
        }
        
        .next-level-btn {
            background-color: #111;
            color: #0f0;
            border: 2px solid #0f0;
            padding: 15px 30px;
            font-family: 'Press Start 2P', 'Courier New', monospace;
            font-size: 16px;
            cursor: pointer;
            font-weight: normal;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .next-level-btn:hover, .next-level-btn:active {
            background-color: #050;
            color: #0f0;
            border-color: #0f0;
            box-shadow: 0 0 15px #0f0;
        }
        
        /* Mountain Guide Items Display */
        .guide-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .guide-item {
            background-color: #111;
            border: 1px solid #0f0;
            padding: 10px;
            cursor: pointer;
            transition: all 0.2s;
            color: #0f0;
        }
        
        .guide-item:hover {
            background-color: #222;
            border-color: #0f0;
            box-shadow: 0 0 5px #0f0;
        }
        
        .guide-item h3 {
            color: #0f0;
            margin: 0 0 5px 0;
            font-size: 16px;
            font-family: 'Press Start 2P', 'Courier New', monospace;
        }
        
        .guide-item p {
            color: #0f0;
            font-size: 14px;
            margin: 0;
        }
        
        .guide-cost {
            color: #ff0;
            font-weight: bold;
            margin-top: 5px;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            color: #080;
            font-size: 12px;
            margin-top: 20px;
            border-top: 1px solid #050;
            padding-top: 10px;
            font-family: 'Source Code Pro', 'Courier New', monospace;
        }
        
        /* Blinking cursor effect */
        .blinking-cursor {
            display: inline-block;
            width: 10px;
            height: 20px;
            background-color: #0f0;
            vertical-align: middle;
            margin-left: 5px;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        /* Sound Toggle */
        .sound-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #111;
            border: 1px solid #0f0;
            color: #0f0;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
            z-index: 10;
            font-family: 'Source Code Pro', 'Courier New', monospace;
        }
        
        .sound-toggle:hover {
            background: #222;
            color: #0f0;
        }
        
        /* Character Stats Display */
        .char-stats {
            background-color: #111;
            border: 1px solid #0f0;
            padding: 15px;
            margin: 15px 0;
        }
        
        .stat-line {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            color: #0f0;
        }
        
        .stat-name {
            color: #0f0;
            font-weight: bold;
        }
        
        /* Responsive Design */
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 20px;
            }
            
            h2 {
                font-size: 14px;
            }
            
            .stats-bar {
                font-size: 12px;
            }
            
            .choice-btn {
                padding: 12px;
                font-size: 14px;
            }
            
            .level-number {
                width: 25px;
                height: 25px;
                font-size: 10px;
            }
            
            .guide-items {
                grid-template-columns: 1fr;
            }
            
            .inventory-title {
                font-size: 12px;
            }
            
            .next-level-btn {
                font-size: 14px;
                padding: 12px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sound Toggle -->
        <div class="sound-toggle" onclick="toggleSound()">
            SOUND: <span id="sound-status">ON</span>
        </div>
        
        <!-- Reset Button -->
        <button class="reset-btn" onclick="resetGame()" style="position: absolute; top: 10px; left: 10px; z-index: 10;">
            RESET GAME
        </button>
        
        <div class="header">
            <h1>LAND OF THE DAMMED</h1>
            <h2>LEVEL 2: DEADWOOD MOUNTAINS</h2>
        </div>
        
        <!-- Level Progress Indicator -->
        <div class="level-progress">
            <div class="level-number completed">1</div>
            <div class="level-number current">2</div>
            <div class="level-number future">3</div>
            <div class="level-number future">4</div>
            <div class="level-number future">5</div>
            <div class="level-number future">6</div>
            <div class="level-number future">7</div>
            <div class="level-number future">8</div>
            <div class="level-number future">9</div>
            <div class="level-number future">10</div>
        </div>
        
        <!-- Continue Screen (Loads saved game) -->
        <div id="screen-continue" class="screen active-screen">
            <h2>CONTINUE YOUR QUEST</h2>
            <div class="story-text">
                <p>You stand at the base of the Deadwood Mountains, having survived the treacherous Moors of Dredd. The mountains loom before you - jagged peaks piercing the gloomy sky, their slopes covered in skeletal trees that give the range its name.</p>
                <p>From the village of Duskhaven, you learned that somewhere in these mountains lies the source of the curse plaguing the land. The air grows colder as you begin your ascent.</p>
                <p>Your journey from the moors has prepared you, but the mountains present new challenges: treacherous paths, bitter cold, and creatures that haunt the high peaks.</p>
                
                <div class="char-stats">
                    <div class="stat-line">
                        <span class="stat-name">CLASS:</span>
                        <span id="continue-class"></span>
                    </div>
                    <div class="stat-line">
                        <span class="stat-name">STRENGTH:</span>
                        <span id="continue-strength"></span>
                    </div>
                    <div class="stat-line">
                        <span class="stat-name">HEALTH:</span>
                        <span id="continue-health"></span>
                    </div>
                    <div class="stat-line">
                        <span class="stat-name">AGILITY:</span>
                        <span id="continue-agility"></span>
                    </div>
                    <div class="stat-line">
                        <span class="stat-name">SPIRIT:</span>
                        <span id="continue-spirit"></span>
                    </div>
                    <div class="stat-line">
                        <span class="stat-name">SILVER:</span>
                        <span id="continue-silver"></span>
                    </div>
                </div>
                
                <div style="margin-top: 15px; padding: 10px; background-color: #111; border: 1px solid #0f0;">
                    <h3 style="color: #0f0; margin-top: 0;">INVENTORY:</h3>
                    <div id="continue-inventory"></div>
                </div>
            </div>
            
            <div class="choice-buttons">
                <button class="choice-btn" onclick="startMountainQuest()">BEGIN ASCENT INTO THE MOUNTAINS</button>
                <button class="choice-btn" onclick="visitMountainGuide()">SEEK OUT THE MOUNTAIN GUIDE FIRST</button>
            </div>
        </div>
        
        <!-- Mountain Guide Screen -->
        <div id="screen-guide" class="screen">
            <h2>THE MOUNTAIN GUIDE</h2>
            <div class="story-text">
                <p>Before beginning your ascent, you seek out the mountain guide mentioned by the villagers. You find her in a small cave at the mountain's base, surrounded by climbing gear and mountain lore.</p>
                <p>"Ah, you're the one who survived the moors," she says, eyeing you appraisingly. "The Deadwood Mountains are no easy climb. The paths are treacherous, the air thin, and the cold... it can kill you as surely as any creature."</p>
                <p>"I have some supplies that might help. But they're not cheap - silver is hard to come by up here."</p>
                <p>You have <span class="gold" id="guide-silver">0</span> silver pieces.</p>
                
                <div class="guide-items">
                    <div class="guide-item" onclick="selectGuideItem('climbing_gear')">
                        <h3>CLIMBING GEAR</h3>
                        <p>Ropes, pitons, and harness for mountain climbing.</p>
                        <div class="guide-cost">Cost: 25 Silver</div>
                    </div>
                    <div class="guide-item" onclick="selectGuideItem('warm_cloak')">
                        <h3>WARM CLOAK</h3>
                        <p>Thick fur cloak to protect against mountain cold.</p>
                        <div class="guide-cost">Cost: 30 Silver</div>
                    </div>
                    <div class="guide-item" onclick="selectGuideItem('mountain_map')">
                        <h3>MOUNTAIN MAP</h3>
                        <p>Detailed map showing safer paths through the peaks.</p>
                        <div class="guide-cost">Cost: 15 Silver</div>
                    </div>
                    <div class="guide-item" onclick="selectGuideItem('heating_stones')">
                        <h3>HEATING STONES</h3>
                        <p>Magical stones that generate warmth when activated.</p>
                        <div class="guide-cost">Cost: 20 Silver</div>
                    </div>
                    <div class="guide-item" onclick="selectGuideItem('ice_axe')">
                        <h3>ICE AXE</h3>
                        <p>Tool for climbing ice and defending against mountain creatures.</p>
                        <div class="guide-cost">Cost: 35 Silver</div>
                    </div>
                    <div class="guide-item" onclick="selectGuideItem('provisions')">
                        <h3>MOUNTAIN PROVISIONS</h3>
                        <p>High-energy food for the difficult climb ahead.</p>
                        <div class="guide-cost">Cost: 12 Silver</div>
                    </div>
                </div>
                
                <div id="selected-guide-item-display" style="display: none; margin-top: 15px; padding: 10px; background-color: #111; border: 1px solid #0f0;">
                    <p>Selected: <span id="selected-guide-item-name" class="item"></span></p>
                    <p id="selected-guide-item-desc"></p>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="action-btn" onclick="confirmGuideItem()" id="confirm-guide-btn" disabled>PURCHASE ITEM</button>
                <button class="action-btn" onclick="skipGuide()">CONTINUE WITHOUT PURCHASING</button>
            </div>
        </div>
        
        <!-- Game Screen -->
        <div id="screen-game" class="screen">
            <div class="stats-bar">
                <div class="stat-item"><span class="stat-label">STRENGTH:</span> <span id="stat-strength" class="stat-value">0</span></div>
                <div class="stat-item"><span class="stat-label">HEALTH:</span> <span id="stat-health" class="stat-value">0</span>/<span id="stat-maxhealth" class="stat-value">0</span></div>
                <div class="stat-item"><span class="stat-label">AGILITY:</span> <span id="stat-agility" class="stat-value">0</span></div>
                <div class="stat-item"><span class="stat-label">SPIRIT:</span> <span id="stat-spirit" class="stat-value">0</span></div>
                <div class="stat-item"><span class="stat-label">SILVER:</span> <span id="stat-silver" class="stat-value">0</span></div>
            </div>
            
            <div class="inventory-container">
                <div class="inventory-title">
                    <span>INVENTORY</span>
                    <span id="inventory-count">ITEMS: 0/8</span>
                </div>
                <div class="inventory" id="inventory">
                    <!-- Inventory items will be added here -->
                </div>
            </div>
            
            <h2>DEADWOOD MOUNTAINS</h2>
            <div class="story-text" id="story-text">
                <!-- Story content will be inserted here -->
            </div>
            
            <div class="choice-buttons" id="choice-buttons">
                <!-- Choice buttons will be inserted here -->
            </div>
            
            <div class="action-buttons">
                <button class="action-btn" onclick="useAgility()">USE AGILITY</button>
                <button class="action-btn" onclick="useItem()">USE ITEM</button>
                <button class="action-btn" onclick="saveGame()">SAVE GAME</button>
                <button class="action-btn" onclick="loadGame()">LOAD GAME</button>
            </div>
        </div>
        
        <!-- Next Level Screen -->
        <div id="screen-next" class="screen">
            <h2>LEVEL 2 COMPLETE!</h2>
            <div class="story-text">
                <p>You have survived the Deadwood Mountains!</p>
                <p>From the highest peak, you look down into the valley below. There, shrouded in mist and shadow, lies the Village of the Dammed - your next destination and possibly the source of the curse afflicting this land.</p>
                <p>The mountain winds howl behind you, but you cannot turn back. The fate of the entire region rests with you.</p>
                <p>All your stats, silver, and inventory will carry over to Level 3.</p>
                <div class="stats-bar">
                    <div class="stat-item"><span class="stat-label">STRENGTH:</span> <span id="next-stat-strength" class="stat-value">0</span></div>
                    <div class="stat-item"><span class="stat-label">HEALTH:</span> <span id="next-stat-health" class="stat-value">0</span></div>
                    <div class="stat-item"><span class="stat-label">AGILITY:</span> <span id="next-stat-agility" class="stat-value">0</span></div>
                    <div class="stat-item"><span class="stat-label">SPIRIT:</span> <span id="next-stat-spirit" class="stat-value">0</span></div>
                    <div class="stat-item"><span class="stat-label">SILVER:</span> <span id="next-stat-silver" class="stat-value">0</span></div>
                </div>
                <div style="margin-top: 15px; padding: 10px; background-color: #111; border: 1px solid #0f0;">
                    <h3 style="color: #0f0; margin-top: 0;">INVENTORY CARRYING OVER:</h3>
                    <div id="next-inventory-display"></div>
                </div>
            </div>
            
            <div class="next-level">
                <button class="next-level-btn" onclick="goToNextLevel()">CONTINUE TO LEVEL 3: VILLAGE OF THE DAMMED</button>
            </div>
        </div>
        
        <div class="footer">
            LAND OF THE DAMMED - A Retro Ghost-Hunting Adventure<br>
            Level 2: Deadwood Mountains
        </div>
    </div>

    <script>
        // Sound System
        let soundEnabled = true;
        let audioContext;
        
        // Simple beep generator using Web Audio API
        function playBeep(frequency, duration, type = 'square') {
            if (!soundEnabled) return;
            
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = type;
                
                // Volume envelope
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            } catch (e) {
                console.log("Web Audio not supported:", e);
            }
        }
        
        // Sound effects
        function playSound(type) {
            if (!soundEnabled) return;
            
            switch(type) {
                case 'click':
                    playBeep(800, 0.1, 'square');
                    break;
                case 'roll':
                    playBeep(400, 0.05, 'sine');
                    setTimeout(() => playBeep(600, 0.05, 'sine'), 50);
                    setTimeout(() => playBeep(300, 0.1, 'sine'), 100);
                    break;
                case 'combat':
                    playBeep(1200, 0.05, 'sawtooth');
                    break;
                case 'item':
                    playBeep(600, 0.2, 'triangle');
                    break;
                case 'success':
                    playBeep(1000, 0.15, 'sine');
                    setTimeout(() => playBeep(1200, 0.15, 'sine'), 150);
                    break;
                case 'failure':
                    playBeep(300, 0.3, 'sawtooth');
                    break;
                case 'damage':
                    playBeep(200, 0.2, 'square');
                    break;
                case 'level':
                    playBeep(500, 0.1, 'sine');
                    setTimeout(() => playBeep(700, 0.1, 'sine'), 100);
                    setTimeout(() => playBeep(900, 0.1, 'sine'), 200);
                    setTimeout(() => playBeep(1100, 0.2, 'sine'), 300);
                    break;
                case 'mountain':
                    playBeep(150, 0.3, 'sine');
                    setTimeout(() => playBeep(100, 0.3, 'sine'), 300);
                    break;
                case 'cold':
                    playBeep(300, 0.2, 'sine');
                    setTimeout(() => playBeep(250, 0.2, 'sine'), 200);
                    break;
            }
        }
        
        // Toggle sound on/off
        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('sound-status').textContent = soundEnabled ? 'ON' : 'OFF';
            
            if (soundEnabled) {
                playSound('click');
            }
        }
        
        // Reset game function
        function resetGame() {
            playSound('click');
            if (confirm("Are you sure you want to reset the game? All progress will be lost.")) {
                localStorage.removeItem('landOfTheDammedGameState');
                location.href = 'lvl1.html'; // Go back to Level 1
            }
        }
        
        // Game state object - loaded from localStorage
        let gameState = {
            playerClass: '',
            strength: 0,
            maxHealth: 0,
            health: 0,
            agility: 0,
            spirit: 0,
            silver: 0,
            inventory: [],
            equippedWeapon: 'Rusty Sword',
            equippedArmor: 'Leather Armor',
            currentSection: 1,
            gameComplete: false,
            level: 2,
            mountainGuideItem: null,
            mountainsCleared: false
        };
        
        // Mountain guide items data
        const guideItems = {
            climbing_gear: {
                name: 'Climbing Gear',
                description: 'Ropes, pitons, and harness for mountain climbing',
                cost: 25,
                effect: 'Helps with climbing checks in the mountains'
            },
            warm_cloak: {
                name: 'Warm Cloak',
                description: 'Thick fur cloak to protect against mountain cold',
                cost: 30,
                effect: 'Reduces damage from cold environments'
            },
            mountain_map: {
                name: 'Mountain Map',
                description: 'Detailed map showing safer paths through the peaks',
                cost: 15,
                effect: 'Helps navigate mountain paths safely'
            },
            heating_stones: {
                name: 'Heating Stones',
                description: 'Magical stones that generate warmth when activated',
                cost: 20,
                effect: 'Can be used to restore health in cold areas'
            },
            ice_axe: {
                name: 'Ice Axe',
                description: 'Tool for climbing ice and defending against mountain creatures',
                cost: 35,
                effect: '+2 damage in mountains, helps with ice climbing'
            },
            provisions: {
                name: 'Mountain Provisions',
                description: 'High-energy food for the difficult climb ahead',
                cost: 12,
                effect: 'Restores 2d6+6 health when consumed'
            }
        };
        
        // Combat state
        let combatState = {
            active: false,
            enemyName: '',
            enemyHealth: 0,
            enemyCurrentHealth: 0,
            enemyStrength: 0,
            enemyDamageDice: 1,
            enemyDamageSides: 6,
            nextSection: 0,
            round: 1,
            isMountainCreature: false
        };
        
        // Game story sections for Level 2
        const storySections = {
            1: {
                text: "You begin your ascent into the Deadwood Mountains. The air grows thin and cold as you climb. The path splits ahead: one route follows a narrow ridge, the other descends into a dark valley.",
                choices: [
                    {text: "Take the narrow ridge path (more direct but dangerous)", nextSection: 2, skillCheck: false},
                    {text: "Descend into the valley (longer but possibly safer)", nextSection: 3, skillCheck: false},
                    {text: "Consult the Mountain Map if you have one", nextSection: 4, skillCheck: false, requirement: 'Mountain Map'}
                ]
            },
            2: {
                text: "The narrow ridge path offers breathtaking views but little room for error. A strong wind threatens to blow you off the path. You must proceed carefully.",
                choices: [
                    {text: "Hug the mountain wall as you move", nextSection: 5, skillCheck: true, checkType: 'agility', difficulty: 12},
                    {text: "Use Climbing Gear if you have it", nextSection: 6, skillCheck: false, requirement: 'Climbing Gear'},
                    {text: "Try to run across quickly", nextSection: 7, skillCheck: true, checkType: 'agility', difficulty: 15}
                ]
            },
            3: {
                text: "You descend into the valley between peaks. The air is still and silent here. Dead trees stand like skeletal sentinels. Something moves in the shadows between the trees.",
                choices: [
                    {text: "Investigate the movement", nextSection: 8, skillCheck: false},
                    {text: "Continue quickly through the valley", nextSection: 9, skillCheck: true, checkType: 'agility', difficulty: 10},
                    {text: "Prepare your weapon", nextSection: 10, skillCheck: false}
                ]
            },
            4: {
                text: "You consult the Mountain Map. It shows that the ridge path has a recent rockfall marked as dangerous, while the valley route is longer but has a cave for shelter marked ahead.",
                choices: [
                    {text: "Take the valley route as suggested", nextSection: 11, skillCheck: false},
                    {text: "Risk the ridge path anyway (might be faster)", nextSection: 2, skillCheck: false}
                ],
                action: function() {
                    playSound('success');
                    return "The <span class='item'>Mountain Map</span> provides valuable information about the routes ahead.";
                }
            },
            5: {
                text: "", // Filled by action
                choices: [
                    {text: "Continue along the ridge", nextSection: 12, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You carefully hug the mountain wall, moving slowly but safely along the narrow ridge.";
                    } else {
                        const damage = rollDice(1, 8);
                        gameState.health -= damage;
                        updateStatsDisplay();
                        playSound('damage');
                        return "A gust of wind catches you off balance! You slip and fall a short distance, taking " + damage + " damage before catching yourself.";
                    }
                }
            },
            6: {
                text: "You secure yourself with your climbing gear. The ropes and pitons give you confidence as you navigate the treacherous ridge.",
                choices: [
                    {text: "Continue with the climbing gear", nextSection: 12, skillCheck: false}
                ],
                action: function() {
                    playSound('success');
                    return "Your <span class='item'>Climbing Gear</span> makes the dangerous ridge path much safer. You move with confidence.";
                }
            },
            7: {
                text: "", // Filled by action
                choices: [
                    {text: "Continue", nextSection: 13, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You sprint across the narrow ridge, moving so quickly that the wind doesn't have time to affect you!";
                    } else {
                        const damage = rollDice(2, 6);
                        gameState.health -= damage;
                        updateStatsDisplay();
                        playSound('damage');
                        return "You slip on loose rocks while running! You tumble and take " + damage + " damage before managing to stop your fall.";
                    }
                }
            },
            8: {
                text: "You approach the movement cautiously. A skeletal figure emerges from behind a dead tree - a MOUNTAIN WRAITH, its form shimmering with cold energy!",
                choices: [
                    {text: "Attempt to communicate peacefully", nextSection: 14, skillCheck: true, checkType: 'spirit', difficulty: 14},
                    {text: "Attack the wraith", nextSection: 15, skillCheck: false},
                    {text: "Try to sneak away", nextSection: 16, skillCheck: true, checkType: 'agility', difficulty: 12}
                ]
            },
            9: {
                text: "", // Filled by action
                choices: [
                    {text: "Continue through the valley", nextSection: 17, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You move quickly and quietly through the valley, avoiding whatever was moving in the shadows.";
                    } else {
                        playSound('failure');
                        return "You step on a dry branch! The snapping sound echoes through the silent valley. The movement in the shadows quickens toward you!";
                    }
                }
            },
            10: {
                text: "You draw your weapon as a creature emerges from the shadows. It's a mountain cat with glowing eyes and frost-covered fur - an ICE PANTHER!",
                choices: [
                    {text: "Fight the ice panther", nextSection: 18, skillCheck: false},
                    {text: "Try to scare it off", nextSection: 19, skillCheck: true, checkType: 'strength', difficulty: 13}
                ]
            },
            11: {
                text: "Following the map's advice, you take the valley route. The map indicates a cave ahead that can provide shelter from the mountain cold.",
                choices: [
                    {text: "Head for the cave", nextSection: 20, skillCheck: false},
                    {text: "Continue through the valley", nextSection: 21, skillCheck: false}
                ]
            },
            12: {
                text: "You successfully navigate the ridge path. As you reach the end, you find yourself at a higher elevation. The air is noticeably colder here.",
                choices: [
                    {text: "Continue climbing", nextSection: 22, skillCheck: false},
                    {text: "Rest and adjust to the altitude", nextSection: 23, skillCheck: false}
                ]
            },
            13: {
                text: "Whether you made it safely or not, you've crossed the ridge. The temperature has dropped significantly. You can see your breath in the air.",
                choices: [
                    {text: "Continue the climb", nextSection: 22, skillCheck: false}
                ]
            },
            14: {
                text: "", // Filled by action
                choices: [
                    {text: "Continue", nextSection: 24, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        const silverFound = rollDice(2, 10);
                        gameState.silver += silverFound;
                        updateStatsDisplay();
                        return "The mountain wraith calms at your spiritual presence. It was a climber who died here long ago. It points you toward a safe path before fading. You find <span class='gold'>" + silverFound + " Silver</span> where it vanished.";
                    } else {
                        playSound('failure');
                        return "The wraith doesn't respond to your attempts at communication. Instead, it lets out a chilling wail and attacks!";
                    }
                }
            },
            15: {
                text: "The mountain wraith reacts to your aggression, its form solidifying into a more threatening shape. Cold emanates from it in waves. Prepare for combat!",
                choices: [
                    {text: "Begin the battle!", nextSection: 25, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Mountain Wraith";
                    combatState.enemyHealth = 35;
                    combatState.enemyCurrentHealth = 35;
                    combatState.enemyStrength = 11;
                    combatState.enemyDamageDice = 2;
                    combatState.enemyDamageSides = 6;
                    combatState.nextSection = 26;
                    combatState.round = 1;
                    combatState.isMountainCreature = true;
                    
                    playSound('mountain');
                    return "<span class='mountain-spirit'>Mountain Wraith</span>: Health " + combatState.enemyCurrentHealth + ", Strength " + combatState.enemyStrength;
                }
            },
            16: {
                text: "", // Filled by action
                choices: [
                    {text: "Continue", nextSection: 27, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You slip away quietly before the wraith notices you. You continue through the valley undetected.";
                    } else {
                        playSound('failure');
                        return "The wraith senses your movement! It turns toward you with a chilling cry.";
                    }
                }
            },
            17: {
                text: "You continue through the valley. The skeletal trees create an eerie landscape. Ahead, you see a cave entrance - possibly the shelter marked on the map.",
                choices: [
                    {text: "Enter the cave", nextSection: 20, skillCheck: false},
                    {text: "Bypass the cave and continue", nextSection: 28, skillCheck: false}
                ]
            },
            18: {
                text: "The ice panther snarls, revealing fangs like icicles. It moves with unnatural grace across the frozen ground. Prepare for combat!",
                choices: [
                    {text: "Fight the ice panther", nextSection: 29, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Ice Panther";
                    combatState.enemyHealth = 30;
                    combatState.enemyCurrentHealth = 30;
                    combatState.enemyStrength = 10;
                    combatState.enemyDamageDice = 2;
                    combatState.enemyDamageSides = 5;
                    combatState.nextSection = 30;
                    combatState.round = 1;
                    combatState.isMountainCreature = true;
                    
                    playSound('combat');
                    return "<span class='enemy'>Ice Panther</span>: Health " + combatState.enemyCurrentHealth + ", Strength " + combatState.enemyStrength;
                }
            },
            19: {
                text: "", // Filled by action
                choices: [
                    {text: "Continue", nextSection: 31, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You roar and brandish your weapon, making yourself look as large and threatening as possible. The ice panther hesitates, then slinks back into the shadows.";
                    } else {
                        playSound('failure');
                        return "Your attempt to scare the panther fails. It sees through your bluff and attacks!";
                    }
                }
            },
            20: {
                text: "The cave offers shelter from the biting wind. Inside, you find evidence of previous travelers: ashes from an old fire, some discarded supplies.",
                choices: [
                    {text: "Rest in the cave", nextSection: 32, skillCheck: false},
                    {text: "Search the cave thoroughly", nextSection: 33, skillCheck: false},
                    {text: "Continue without resting", nextSection: 34, skillCheck: false}
                ]
            },
            21: {
                text: "You decide to bypass the cave and continue through the valley. The path begins to climb again, taking you back to higher elevations.",
                choices: [
                    {text: "Continue the ascent", nextSection: 22, skillCheck: false}
                ]
            },
            22: {
                text: "The climb becomes steeper. Your breath comes in short gasps in the thin air. The cold is becoming a real danger now.",
                choices: [
                    {text: "Put on Warm Cloak if you have one", nextSection: 35, skillCheck: false, requirement: 'Warm Cloak'},
                    {text: "Use Heating Stones if you have them", nextSection: 36, skillCheck: false, requirement: 'Heating Stones'},
                    {text: "Push through the cold", nextSection: 37, skillCheck: true, checkType: 'strength', difficulty: 12}
                ]
            },
            23: {
                text: "You take a moment to rest and adjust to the altitude. The brief respite helps, but you're still shivering from the cold.",
                choices: [
                    {text: "Continue climbing", nextSection: 22, skillCheck: false}
                ],
                action: function() {
                    const healAmount = rollDice(1, 4) + 2;
                    const oldHealth = gameState.health;
                    gameState.health = Math.min(gameState.maxHealth, gameState.health + healAmount);
                    const actualHeal = gameState.health - oldHealth;
                    return "Resting helps you recover slightly. You restore " + actualHeal + " Health.";
                }
            },
            24: {
                text: "With the wraith gone, you continue through the valley with new knowledge of a safer path.",
                choices: [
                    {text: "Follow the path the wraith indicated", nextSection: 38, skillCheck: false}
                ]
            },
            25: {
                text: "", // Combat round
                choices: [
                    {text: "Continue the fight!", nextSection: 39, skillCheck: false}
                ]
            },
            26: {
                text: "", // After combat
                choices: [
                    {text: "Search where the wraith vanished", nextSection: 40, skillCheck: false},
                    {text: "Continue through the valley", nextSection: 17, skillCheck: false}
                ]
            },
            27: {
                text: "You manage to evade the wraith and continue through the valley. The experience leaves you shaken but unharmed.",
                choices: [
                    {text: "Continue through the valley", nextSection: 17, skillCheck: false}
                ]
            },
            28: {
                text: "You bypass the cave and continue climbing. The temperature drops further as you gain elevation. Frost begins to form on your equipment.",
                choices: [
                    {text: "Continue upward", nextSection: 41, skillCheck: false}
                ]
            },
            29: {
                text: "", // Combat round
                choices: [
                    {text: "Continue the fight!", nextSection: 42, skillCheck: false}
                ]
            },
            30: {
                text: "", // After combat
                choices: [
                    {text: "Take the panther's frost-covered fang as trophy", nextSection: 43, skillCheck: false},
                    {text: "Continue through the valley", nextSection: 17, skillCheck: false}
                ]
            },
            31: {
                text: "With the ice panther dealt with, you continue through the valley. The experience has left you more cautious.",
                choices: [
                    {text: "Continue through the valley", nextSection: 17, skillCheck: false}
                ]
            },
            32: {
                text: "You build a small fire from dead wood and rest in the relative warmth of the cave. The shelter from the wind is a welcome relief.",
                choices: [
                    {text: "Continue your journey after resting", nextSection: 44, skillCheck: false}
                ],
                action: function() {
                    const healAmount = rollDice(2, 6) + 4;
                    const oldHealth = gameState.health;
                    gameState.health = Math.min(gameState.maxHealth, gameState.health + healAmount);
                    const actualHeal = gameState.health - oldHealth;
                    playSound('item');
                    return "Resting in the cave restores " + actualHeal + " Health. The warmth helps combat the mountain cold.";
                }
            },
            33: {
                text: "Searching the cave thoroughly, you find a small stash hidden in a crevice behind some rocks.",
                choices: [
                    {text: "Take the stash", nextSection: 32, skillCheck: false}
                ],
                action: function() {
                    const silverFound = rollDice(3, 8);
                    gameState.silver += silverFound;
                    addToInventory('Ancient Climber\'s Journal');
                    updateStatsDisplay();
                    playSound('item');
                    return "You find <span class='gold'>" + silverFound + " Silver</span> and an <span class='item'>Ancient Climber's Journal</span> with notes about the mountains.";
                }
            },
            34: {
                text: "You decide not to rest and continue immediately. The cold seems to bite deeper without proper rest.",
                choices: [
                    {text: "Continue climbing", nextSection: 22, skillCheck: false}
                ],
                action: function() {
                    const coldDamage = rollDice(1, 4);
                    gameState.health -= coldDamage;
                    updateStatsDisplay();
                    playSound('cold');
                    return "The lack of rest makes you more vulnerable to the cold. You take " + coldDamage + " damage from exposure.";
                }
            },
            35: {
                text: "You put on the Warm Cloak. Immediately, you feel the biting cold lessen. The thick fur provides excellent insulation.",
                choices: [
                    {text: "Continue climbing with the cloak", nextSection: 45, skillCheck: false}
                ],
                action: function() {
                    playSound('item');
                    return "Your <span class='item'>Warm Cloak</span> protects you from the worst of the mountain cold. You can continue without taking cold damage.";
                }
            },
            36: {
                text: "You activate the Heating Stones. They glow with a warm, comforting light, driving back the chill.",
                choices: [
                    {text: "Continue with the heating stones", nextSection: 45, skillCheck: false}
                ],
                action: function() {
                    playSound('item');
                    return "The <span class='item'>Heating Stones</span> create a bubble of warmth around you. The cold no longer affects you.";
                }
            },
            37: {
                text: "", // Filled by action
                choices: [
                    {text: "Continue", nextSection: 46, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You push through the cold with sheer determination, your strength overcoming the mountain's chill.";
                    } else {
                        const coldDamage = rollDice(1, 6) + 2;
                        gameState.health -= coldDamage;
                        updateStatsDisplay();
                        playSound('cold');
                        return "The cold is too much for you. You take " + coldDamage + " damage from exposure and frostbite.";
                    }
                }
            },
            38: {
                text: "Following the path indicated by the wraith, you find a relatively easy route through the valley. It seems this was once a proper trail.",
                choices: [
                    {text: "Follow the old trail", nextSection: 47, skillCheck: false}
                ]
            },
            39: {
                text: "", // Combat round
                choices: [
                    {text: "Continue the fight!", nextSection: 25, skillCheck: false}
                ]
            },
            40: {
                text: "Where the wraith vanished, you find a few items it had collected from previous victims.",
                choices: [
                    {text: "Take the items", nextSection: 17, skillCheck: false}
                ],
                action: function() {
                    const silverFound = rollDice(2, 12);
                    gameState.silver += silverFound;
                    addToInventory('Frost-Covered Amulet');
                    updateStatsDisplay();
                    playSound('item');
                    return "You find <span class='gold'>" + silverFound + " Silver</span> and a <span class='item'>Frost-Covered Amulet</span> that feels unnaturally cold.";
                }
            },
            41: {
                text: "The climb becomes treacherous. You're now high enough that patches of snow and ice cover the ground. The path ahead is slick with ice.",
                choices: [
                    {text: "Use Ice Axe if you have one", nextSection: 48, skillCheck: false, requirement: 'Ice Axe'},
                    {text: "Carefully navigate the ice", nextSection: 49, skillCheck: true, checkType: 'agility', difficulty: 14},
                    {text: "Look for an alternative route", nextSection: 50, skillCheck: true, checkType: 'agility', difficulty: 12}
                ]
            },
            42: {
                text: "", // Combat round
                choices: [
                    {text: "Continue the fight!", nextSection: 29, skillCheck: false}
                ]
            },
            43: {
                text: "You take one of the panther's frost-covered fangs. It's cold to the touch and strangely beautiful.",
                choices: [
                    {text: "Continue through the valley", nextSection: 17, skillCheck: false}
                ],
                action: function() {
                    addToInventory('Ice Panther Fang');
                    playSound('item');
                    return "You collect an <span class='item'>Ice Panther Fang</span>. It might be valuable or useful later.";
                }
            },
            44: {
                text: "Refreshed from your rest in the cave, you continue your ascent. The mountain seems less daunting now.",
                choices: [
                    {text: "Continue climbing", nextSection: 22, skillCheck: false}
                ]
            },
            45: {
                text: "Protected from the cold, you make good progress up the mountain. The peak is now visible in the distance.",
                choices: [
                    {text: "Head toward the peak", nextSection: 51, skillCheck: false}
                ]
            },
            46: {
                text: "You continue your climb, dealing with the cold as best you can. The peak draws nearer with each step.",
                choices: [
                    {text: "Head toward the peak", nextSection: 51, skillCheck: false}
                ]
            },
            47: {
                text: "The old trail leads you to a mountain pass. From here, you can see the path splits again: one route continues upward, the other descends slightly before climbing again.",
                choices: [
                    {text: "Take the upward route", nextSection: 52, skillCheck: false},
                    {text: "Take the route that descends first", nextSection: 53, skillCheck: false}
                ]
            },
            48: {
                text: "Your Ice Axe makes traversing the icy path much easier. You can chip handholds and secure your footing.",
                choices: [
                    {text: "Continue with the ice axe", nextSection: 54, skillCheck: false}
                ],
                action: function() {
                    playSound('success');
                    return "Your <span class='item'>Ice Axe</span> is invaluable on the icy terrain. You move with confidence where others would slip and fall.";
                }
            },
            49: {
                text: "", // Filled by action
                choices: [
                    {text: "Continue", nextSection: 55, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You navigate the icy path with careful, deliberate steps. Your agility keeps you from slipping.";
                    } else {
                        const damage = rollDice(2, 6);
                        gameState.health -= damage;
                        updateStatsDisplay();
                        playSound('damage');
                        return "You slip on the ice and tumble down a short slope, taking " + damage + " damage before managing to stop yourself.";
                    }
                }
            },
            50: {
                text: "", // Filled by action
                choices: [
                    {text: "Continue", nextSection: 56, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You find an alternative route that bypasses the worst of the ice. It takes longer but is safer.";
                    } else {
                        playSound('failure');
                        return "You can't find a safe alternative route. You'll have to risk the icy path.";
                    }
                }
            },
            51: {
                text: "You're making steady progress toward the peak. The air grows even thinner, making each breath an effort. Suddenly, you hear a rumbling sound above you.",
                choices: [
                    {text: "Look up to see what's happening", nextSection: 57, skillCheck: false},
                    {text: "Take cover immediately", nextSection: 58, skillCheck: true, checkType: 'agility', difficulty: 13},
                    {text: "Run downhill away from the sound", nextSection: 59, skillCheck: true, checkType: 'agility', difficulty: 15}
                ]
            },
            52: {
                text: "The upward route is steep but direct. As you climb, you notice strange carvings on the rocks - ancient runes that glow faintly.",
                choices: [
                    {text: "Examine the runes", nextSection: 60, skillCheck: false},
                    {text: "Ignore them and continue climbing", nextSection: 61, skillCheck: false}
                ]
            },
            53: {
                text: "The route that descends first is less steep. It takes you through a sheltered gully before climbing again. The gully is protected from the wind.",
                choices: [
                    {text: "Rest in the sheltered gully", nextSection: 62, skillCheck: false},
                    {text: "Continue without resting", nextSection: 63, skillCheck: false}
                ]
            },
            54: {
                text: "With the help of your ice axe, you successfully cross the icy section. You're now at the highest point you've reached so far.",
                choices: [
                    {text: "Continue toward the peak", nextSection: 51, skillCheck: false}
                ]
            },
            55: {
                text: "Whether you navigated the ice successfully or not, you've crossed the treacherous section. The peak is now clearly visible.",
                choices: [
                    {text: "Continue toward the peak", nextSection: 51, skillCheck: false}
                ]
            },
            56: {
                text: "You find yourself back on the main path after your search for an alternative route. The peak looms ahead.",
                choices: [
                    {text: "Continue toward the peak", nextSection: 51, skillCheck: false}
                ]
            },
            57: {
                text: "You look up just in time to see an avalanche of snow and rock cascading toward you!",
                choices: [
                    {text: "Try to outrun it downhill", nextSection: 64, skillCheck: true, checkType: 'agility', difficulty: 16},
                    {text: "Find shelter behind a large rock", nextSection: 65, skillCheck: true, checkType: 'agility', difficulty: 12},
                    {text: "Dig into the snow to create a pocket", nextSection: 66, skillCheck: false}
                ]
            },
            58: {
                text: "", // Filled by action
                choices: [
                    {text: "Continue", nextSection: 67, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You dive behind a large boulder just as the avalanche crashes past. You're safe, though covered in snow dust.";
                    } else {
                        const damage = rollDice(3, 8);
                        gameState.health -= damage;
                        updateStatsDisplay();
                        playSound('damage');
                        return "You're not fast enough! The avalanche catches you, tumbling you down the slope. You take " + damage + " damage before coming to a stop.";
                    }
                }
            },
            59: {
                text: "", // Filled by action
                choices: [
                    {text: "Continue", nextSection: 68, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You sprint downhill, outpacing the avalanche! You watch from a safe distance as it crashes past where you just were.";
                    } else {
                        const damage = rollDice(2, 10);
                        gameState.health -= damage;
                        updateStatsDisplay();
                        playSound('damage');
                        return "You trip while running! The avalanche catches up to you, burying you partially. You take " + damage + " damage digging yourself out.";
                    }
                }
            },
            60: {
                text: "The runes are ancient protective symbols, placed here long ago to ward off mountain spirits. Touching them fills you with a sense of peace and protection.",
                choices: [
                    {text: "Absorb the runes' protective energy", nextSection: 69, skillCheck: false},
                    {text: "Continue climbing", nextSection: 61, skillCheck: false}
                ],
                action: function() {
                    const healAmount = rollDice(2, 6) + 4;
                    const oldHealth = gameState.health;
                    gameState.health = Math.min(gameState.maxHealth, gameState.health + healAmount);
                    const actualHeal = gameState.health - oldHealth;
                    playSound('item');
                    return "The runes' protective energy flows into you, restoring " + actualHeal + " Health and strengthening your spirit.";
                }
            },
            61: {
                text: "You ignore the runes and continue climbing. The path becomes increasingly difficult as you approach the peak.",
                choices: [
                    {text: "Press on toward the peak", nextSection: 70, skillCheck: false}
                ]
            },
            62: {
                text: "The sheltered gully provides a much-needed respite from the wind and cold. You can rest here safely.",
                choices: [
                    {text: "Rest then continue", nextSection: 71, skillCheck: false}
                ],
                action: function() {
                    const healAmount = rollDice(1, 8) + 4;
                    const oldHealth = gameState.health;
                    gameState.health = Math.min(gameState.maxHealth, gameState.health + healAmount);
                    const actualHeal = gameState.health - oldHealth;
                    return "Resting in the sheltered gully restores " + actualHeal + " Health. The break from the wind is revitalizing.";
                }
            },
            63: {
                text: "You push on without resting. The gully provides some protection from the wind, making the climb easier despite your fatigue.",
                choices: [
                    {text: "Continue climbing", nextSection: 72, skillCheck: false}
                ]
            },
            64: {
                text: "", // Filled by action
                choices: [
                    {text: "Continue", nextSection: 73, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You run with incredible speed, staying ahead of the avalanche until it slows and stops. You're safe!";
                    } else {
                        const damage = rollDice(4, 6);
                        gameState.health -= damage;
                        updateStatsDisplay();
                        playSound('damage');
                        return "The avalanche overtakes you! You're buried under snow and rock. It takes all your strength to dig yourself out, and you take " + damage + " damage.";
                    }
                }
            },
            65: {
                text: "", // Filled by action
                choices: [
                    {text: "Continue", nextSection: 74, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You find excellent shelter behind a massive boulder. The avalanche splits around it, leaving you untouched.";
                    } else {
                        const damage = rollDice(2, 8);
                        gameState.health -= damage;
                        updateStatsDisplay();
                        playSound('damage');
                        return "Your shelter isn't adequate! The avalanche partially envelops your hiding place. You take " + damage + " damage from the impact.";
                    }
                }
            },
            66: {
                text: "You quickly dig into the snow, creating an air pocket just as the avalanche hits. You're buried but alive, with air to breathe.",
                choices: [
                    {text: "Dig yourself out", nextSection: 75, skillCheck: true, checkType: 'strength', difficulty: 10}
                ],
                action: function() {
                    playSound('success');
                    return "Your quick thinking saves you! You create a protective pocket in the snow as the avalanche passes over you.";
                }
            },
            67: {
                text: "The avalanche has passed. The mountain is quiet again, but the landscape is changed - covered in fresh snow and debris.",
                choices: [
                    {text: "Continue toward the peak", nextSection: 76, skillCheck: false}
                ]
            },
            68: {
                text: "You've survived the avalanche. The experience has left you shaken but determined to reach the peak.",
                choices: [
                    {text: "Continue toward the peak", nextSection: 76, skillCheck: false}
                ]
            },
            69: {
                text: "Strengthened by the runes' energy, you continue your climb with renewed vigor. The peak seems closer than ever.",
                choices: [
                    {text: "Continue toward the peak", nextSection: 70, skillCheck: false}
                ]
            },
            70: {
                text: "You're nearing the peak now. The air is so thin it's hard to breathe. The final ascent is the steepest yet.",
                choices: [
                    {text: "Make the final push to the peak", nextSection: 77, skillCheck: true, checkType: 'strength', difficulty: 14},
                    {text: "Use Climbing Gear for the final ascent", nextSection: 78, skillCheck: false, requirement: 'Climbing Gear'},
                    {text: "Rest before the final push", nextSection: 79, skillCheck: false}
                ]
            },
            71: {
                text: "Refreshed from your rest, you continue the climb out of the gully. The peak is now within reach.",
                choices: [
                    {text: "Make the final push to the peak", nextSection: 77, skillCheck: true, checkType: 'strength', difficulty: 12}
                ]
            },
            72: {
                text: "You continue climbing out of the gully. Fatigue is setting in, but the peak is tantalizingly close.",
                choices: [
                    {text: "Make the final push to the peak", nextSection: 77, skillCheck: true, checkType: 'strength', difficulty: 15}
                ]
            },
            73: {
                text: "You've survived the avalanche. The mountain seems to respect your determination now.",
                choices: [
                    {text: "Continue toward the peak", nextSection: 76, skillCheck: false}
                ]
            },
            74: {
                text: "The avalanche has passed, leaving you battered but alive. The peak calls to you from above.",
                choices: [
                    {text: "Continue toward the peak", nextSection: 76, skillCheck: false}
                ]
            },
            75: {
                text: "", // Filled by action
                choices: [
                    {text: "Continue", nextSection: 80, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "You dig yourself out of the snow with strong, determined movements. You emerge into the sunlight, cold but alive.";
                    } else {
                        const damage = rollDice(1, 6);
                        gameState.health -= damage;
                        updateStatsDisplay();
                        playSound('damage');
                        return "Digging out is harder than expected. You exhaust yourself and take " + damage + " additional damage from the effort and cold.";
                    }
                }
            },
            76: {
                text: "The avalanche has changed the landscape, but the path to the peak is still clear. You continue your ascent.",
                choices: [
                    {text: "Make the final push to the peak", nextSection: 77, skillCheck: true, checkType: 'strength', difficulty: 13}
                ]
            },
            77: {
                text: "", // Filled by action
                choices: [
                    {text: "Reach the peak", nextSection: 81, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        playSound('success');
                        return "With a final burst of strength, you conquer the last difficult section and reach the peak!";
                    } else {
                        const damage = rollDice(1, 8);
                        gameState.health -= damage;
                        updateStatsDisplay();
                        playSound('damage');
                        return "The final ascent is grueling. You slip multiple times and take " + damage + " damage, but you eventually reach the peak.";
                    }
                }
            },
            78: {
                text: "Your climbing gear makes the final ascent manageable. You secure yourself with ropes and pitons as you climb.",
                choices: [
                    {text: "Reach the peak with climbing gear", nextSection: 81, skillCheck: false}
                ],
                action: function() {
                    playSound('success');
                    return "Your <span class='item'>Climbing Gear</span> makes the final ascent safe and relatively easy. You reach the peak without incident.";
                }
            },
            79: {
                text: "You rest before the final push, gathering your strength for the last difficult climb.",
                choices: [
                    {text: "Make the final push to the peak", nextSection: 77, skillCheck: true, checkType: 'strength', difficulty: 10}
                ],
                action: function() {
                    const healAmount = rollDice(1, 4) + 2;
                    const oldHealth = gameState.health;
                    gameState.health = Math.min(gameState.maxHealth, gameState.health + healAmount);
                    const actualHeal = gameState.health - oldHealth;
                    return "Resting before the final push restores " + actualHeal + " Health and gives you the energy you need.";
                }
            },
            80: {
                text: "You've dug yourself out of the avalanche debris. The peak stands above you, seeming to challenge you to continue.",
                choices: [
                    {text: "Continue toward the peak", nextSection: 76, skillCheck: false}
                ]
            },
            81: {
                text: "You stand at the peak of the Deadwood Mountains! The view is breathtaking. To the north, you see the Moors of Dredd that you crossed. To the south...",
                choices: [
                    {text: "Look south toward your next destination", nextSection: 100, skillCheck: false}
                ],
                action: function() {
                    // Check if player has any mountain provisions to use
                    if (gameState.inventory.includes('Mountain Provisions')) {
                        const healAmount = rollDice(2, 6) + 6;
                        const oldHealth = gameState.health;
                        gameState.health = Math.min(gameState.maxHealth, gameState.health + healAmount);
                        const actualHeal = gameState.health - oldHealth;
                        removeFromInventory('Mountain Provisions');
                        return "You celebrate your achievement by eating your <span class='item'>Mountain Provisions</span>, restoring " + actualHeal + " Health.";
                    }
                    return "";
                }
            },
            100: {
                text: "CONGRATULATIONS! You have conquered the Deadwood Mountains. From the peak, you look south into a mist-shrouded valley. There, barely visible through the gloom, lies the Village of the Dammed - a settlement said to be the heart of the curse afflicting this land.",
                choices: [],
                action: function() {
                    gameState.mountainsCleared = true;
                    gameState.gameComplete = true;
                    showScreen('screen-next');
                    document.getElementById('next-stat-strength').textContent = gameState.strength;
                    document.getElementById('next-stat-health').textContent = gameState.health;
                    document.getElementById('next-stat-agility').textContent = gameState.agility;
                    document.getElementById('next-stat-spirit').textContent = gameState.spirit;
                    document.getElementById('next-stat-silver').textContent = gameState.silver;
                    
                    // Display inventory that will carry over
                    const inventoryDisplay = document.getElementById('next-inventory-display');
                    inventoryDisplay.innerHTML = '';
                    
                    // Show equipped items
                    const equippedDiv = document.createElement('div');
                    equippedDiv.innerHTML = `<strong>Equipped:</strong> ${gameState.equippedWeapon}, ${gameState.equippedArmor}`;
                    inventoryDisplay.appendChild(equippedDiv);
                    
                    // Show other inventory
                    if (gameState.inventory.length > 0) {
                        const invDiv = document.createElement('div');
                        invDiv.innerHTML = `<strong>Inventory:</strong> ${gameState.inventory.join(', ')}`;
                        inventoryDisplay.appendChild(invDiv);
                    }
                    
                    playSound('level');
                    
                    // Save completed level state
                    gameState.level = 3;
                    saveGame();
                    
                    return "";
                }
            }
        };
        
        // Initialize game - FIXED VERSION
        function initGame() {
            // Check for saved game
            const savedGame = localStorage.getItem('landOfTheDammedGameState');
            if (savedGame) {
                const savedState = JSON.parse(savedGame);
                
                // Check if this is Level 1 OR Level 2 save data
                // We accept both because when Level 1 is completed, it sets level to 2
                if (savedState.level === 1 || savedState.level === 2) {
                    // Load the game state
                    Object.assign(gameState, savedState);
                    
                    // Update to Level 2 if it was Level 1
                    if (gameState.level === 1) {
                        gameState.level = 2;
                        gameState.currentSection = 1; // Reset to start of Level 2
                        gameState.mountainsCleared = false;
                        gameState.gameComplete = false;
                        saveGame(); // Save the updated state
                    }
                    
                    // Display character info on continue screen
                    document.getElementById('continue-class').textContent = gameState.playerClass.toUpperCase();
                    document.getElementById('continue-strength').textContent = gameState.strength;
                    document.getElementById('continue-health').textContent = gameState.health + "/" + gameState.maxHealth;
                    document.getElementById('continue-agility').textContent = gameState.agility;
                    document.getElementById('continue-spirit').textContent = gameState.spirit;
                    document.getElementById('continue-silver').textContent = gameState.silver;
                    
                    // Display inventory
                    const inventoryDisplay = document.getElementById('continue-inventory');
                    inventoryDisplay.innerHTML = '';
                    
                    // Show equipped items
                    const equippedDiv = document.createElement('div');
                    equippedDiv.innerHTML = `<strong>Equipped:</strong> ${gameState.equippedWeapon}, ${gameState.equippedArmor}`;
                    inventoryDisplay.appendChild(equippedDiv);
                    
                    // Show other inventory
                    if (gameState.inventory.length > 0) {
                        const invDiv = document.createElement('div');
                        invDiv.innerHTML = `<strong>Inventory:</strong> ${gameState.inventory.join(', ')}`;
                        inventoryDisplay.appendChild(invDiv);
                    }
                    
                    showScreen('screen-continue');
                    return;
                } else {
                    // If the saved level is not 1 or 2, redirect to Level 1
                    alert("Invalid saved game. Starting from Level 1.");
                    window.location.href = 'lvl1.html';
                    return;
                }
            } else {
                // No save data found, redirect to Level 1
                alert("No saved game found. Starting from Level 1.");
                window.location.href = 'lvl1.html';
                return;
            }
        }
        
        // Show specific screen
        function showScreen(screenId) {
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => {
                screen.classList.remove('active-screen');
            });
            document.getElementById(screenId).classList.add('active-screen');
        }
        
        // Start mountain quest directly
        function startMountainQuest() {
            playSound('click');
            updateStatsDisplay();
            updateInventoryDisplay();
            showScreen('screen-game');
            loadSection(1);
        }
        
        // Visit mountain guide first
        function visitMountainGuide() {
            playSound('click');
            document.getElementById('guide-silver').textContent = gameState.silver;
            showScreen('screen-guide');
        }
        
        // Mountain guide item selection
        let selectedGuideItem = null;
        
        function selectGuideItem(itemKey) {
            playSound('click');
            selectedGuideItem = itemKey;
            const item = guideItems[itemKey];
            
            document.getElementById('selected-guide-item-name').textContent = item.name;
            document.getElementById('selected-guide-item-desc').innerHTML = 
                `<span class="item">${item.name}</span>: ${item.description}<br>Effect: ${item.effect}`;
            document.getElementById('selected-guide-item-display').style.display = 'block';
            
            // Enable confirm button if player has enough silver
            if (gameState.silver >= item.cost) {
                document.getElementById('confirm-guide-btn').disabled = false;
            } else {
                document.getElementById('confirm-guide-btn').disabled = true;
            }
        }
        
        function confirmGuideItem() {
            if (!selectedGuideItem) return;
            
            const item = guideItems[selectedGuideItem];
            
            if (gameState.silver >= item.cost) {
                playSound('item');
                gameState.silver -= item.cost;
                addToInventory(item.name);
                gameState.mountainGuideItem = item.name;
                
                // Special handling for ice axe (can be equipped)
                if (selectedGuideItem === 'ice_axe') {
                    gameState.equippedWeapon = 'Ice Axe';
                }
                
                updateStatsDisplay();
                updateInventoryDisplay();
                document.getElementById('guide-silver').textContent = gameState.silver;
                document.getElementById('selected-guide-item-display').style.display = 'none';
                document.getElementById('confirm-guide-btn').disabled = true;
                selectedGuideItem = null;
                
                // Show success message
                document.querySelector('.story-text').innerHTML += `<div class="dice-roll">Purchased: <span class="item">${item.name}</span> for ${item.cost} silver.</div>`;
            }
        }
        
        function skipGuide() {
            playSound('click');
            startMountainQuest();
        }
        
        // Update stats display
        function updateStatsDisplay() {
            document.getElementById('stat-strength').textContent = gameState.strength;
            document.getElementById('stat-health').textContent = gameState.health;
            document.getElementById('stat-maxhealth').textContent = gameState.maxHealth;
            document.getElementById('stat-agility').textContent = gameState.agility;
            document.getElementById('stat-spirit').textContent = gameState.spirit;
            document.getElementById('stat-silver').textContent = gameState.silver;
        }
        
        // Add item to inventory
        function addToInventory(item) {
            if (!gameState.inventory.includes(item)) {
                gameState.inventory.push(item);
                updateInventoryDisplay();
            }
        }
        
        // Remove item from inventory
        function removeFromInventory(item) {
            const index = gameState.inventory.indexOf(item);
            if (index !== -1) {
                gameState.inventory.splice(index, 1);
                updateInventoryDisplay();
            }
        }
        
        // Update inventory display
        function updateInventoryDisplay() {
            const inventoryDiv = document.getElementById('inventory');
            inventoryDiv.innerHTML = '';
            
            // Add equipped weapon and armor first
            const equippedWeapon = document.createElement('div');
            equippedWeapon.className = 'inventory-item equipped';
            equippedWeapon.textContent = gameState.equippedWeapon;
            equippedWeapon.onclick = () => {
                playSound('click');
                document.getElementById('story-text').innerHTML += 
                    `<div class="dice-roll">Currently equipped: <span class='item'>${gameState.equippedWeapon}</span></div>`;
            };
            inventoryDiv.appendChild(equippedWeapon);
            
            const equippedArmor = document.createElement('div');
            equippedArmor.className = 'inventory-item equipped';
            equippedArmor.textContent = gameState.equippedArmor;
            equippedArmor.onclick = () => {
                playSound('click');
                document.getElementById('story-text').innerHTML += 
                    `<div class="dice-roll">Currently equipped: <span class='item'>${gameState.equippedArmor}</span></div>`;
            };
            inventoryDiv.appendChild(equippedArmor);
            
            // Add other inventory items
            gameState.inventory.forEach(item => {
                // Skip if it's the equipped weapon or armor
                if (item !== gameState.equippedWeapon && item !== gameState.equippedArmor) {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'inventory-item';
                    itemElement.textContent = item;
                    itemElement.onclick = () => {
                        useInventoryItem(item);
                    };
                    inventoryDiv.appendChild(itemElement);
                }
            });
            
            // Update inventory count
            const totalItems = gameState.inventory.length + 2; // +2 for equipped items
            document.getElementById('inventory-count').textContent = `ITEMS: ${totalItems}/8`;
        }
        
        // Use inventory item
        function useInventoryItem(item) {
            playSound('click');
            let message = "";
            
            if (item === 'Mountain Provisions') {
                const healAmount = rollDice(2, 6) + 6;
                const oldHealth = gameState.health;
                gameState.health = Math.min(gameState.maxHealth, gameState.health + healAmount);
                const actualHeal = gameState.health - oldHealth;
                removeFromInventory('Mountain Provisions');
                playSound('item');
                message = `You eat the <span class='item'>Mountain Provisions</span> and restore ${actualHeal} Health!`;
                updateStatsDisplay();
            } else if (item === 'Heating Stones') {
                const healAmount = rollDice(1, 6) + 3;
                const oldHealth = gameState.health;
                gameState.health = Math.min(gameState.maxHealth, gameState.health + healAmount);
                const actualHeal = gameState.health - oldHealth;
                playSound('item');
                message = `You activate the <span class='item'>Heating Stones</span>. The warmth restores ${actualHeal} Health and protects you from cold.`;
                updateStatsDisplay();
            } else if (item === 'Ancient Climber\'s Journal') {
                message = "The <span class='item'>Ancient Climber's Journal</span> contains notes about mountain paths and warnings about certain areas. It might help you navigate.";
            } else if (item === 'Frost-Covered Amulet') {
                message = "The <span class='item'>Frost-Covered Amulet</span> is unnaturally cold to the touch. It might have protective properties against cold-based attacks.";
            } else if (item === 'Ice Panther Fang') {
                message = "The <span class='item'>Ice Panther Fang</span> is beautiful and sharp. It might be valuable or useful as a tool.";
            } else if (item === 'Climbing Gear') {
                message = "The <span class='item'>Climbing Gear</span> includes ropes, pitons, and a harness. Essential for difficult mountain climbs.";
            } else if (item === 'Warm Cloak') {
                message = "The <span class='item'>Warm Cloak</span> provides excellent insulation against the mountain cold.";
            } else if (item === 'Mountain Map') {
                message = "The <span class='item'>Mountain Map</span> shows safer paths through the Deadwood Mountains.";
            } else if (item === 'Ice Axe') {
                message = "The <span class='item'>Ice Axe</span> is both a climbing tool and a weapon, especially effective in mountain environments.";
            } else if (item === 'Healing Herbs') {
                const healAmount = rollDice(2, 8) + 8;
                const oldHealth = gameState.health;
                gameState.health = Math.min(gameState.maxHealth, gameState.health + healAmount);
                const actualHeal = gameState.health - oldHealth;
                removeFromInventory('Healing Herbs');
                playSound('item');
                message = `You use the <span class='item'>Healing Herbs</span> and restore ${actualHeal} Health!`;
                updateStatsDisplay();
            } else if (item === 'Hardtack' || item === 'Dried Meat') {
                const healAmount = rollDice(1, 4) + 2;
                const oldHealth = gameState.health;
                gameState.health = Math.min(gameState.maxHealth, gameState.health + healAmount);
                const actualHeal = gameState.health - oldHealth;
                removeFromInventory(item);
                playSound('item');
                message = `You eat the <span class='item'>${item}</span> and restore ${actualHeal} Health!`;
                updateStatsDisplay();
            } else {
                message = `You examine the <span class='item'>${item}</span>.`;
            }
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${message}</div>`;
        }
        
        // Use item from action button
        function useItem() {
            playSound('click');
            if (gameState.inventory.length === 0 && 
                gameState.equippedWeapon === 'Rusty Sword' && 
                gameState.equippedArmor === 'Leather Armor') {
                document.getElementById('story-text').innerHTML += 
                    `<div class="dice-roll">You have no usable items in your inventory.</div>`;
                return;
            }
            
            let itemText = "<div class='dice-roll'><strong>Select an item to use:</strong><br>";
            
            // Show equipped items
            itemText += `<br><strong>Equipped:</strong><br>`;
            itemText += `<button onclick="useInventoryItem('${gameState.equippedWeapon}')" class="action-btn" style="margin: 5px;">${gameState.equippedWeapon}</button> `;
            itemText += `<button onclick="useInventoryItem('${gameState.equippedArmor}')" class="action-btn" style="margin: 5px;">${gameState.equippedArmor}</button>`;
            
            // Show inventory items
            const usableItems = gameState.inventory.filter(item => 
                item !== gameState.equippedWeapon && item !== gameState.equippedArmor);
            
            if (usableItems.length > 0) {
                itemText += `<br><br><strong>Inventory:</strong><br>`;
                usableItems.forEach(item => {
                    itemText += `<button onclick="useInventoryItem('${item}')" class="action-btn" style="margin: 5px;">${item}</button> `;
                });
            }
            
            itemText += `<br><br><button onclick="document.getElementById('story-text').innerHTML += '<div class=dice-roll>Item use cancelled.</div>'" class="action-btn">Cancel</button>`;
            itemText += "</div>";
            
            document.getElementById('story-text').innerHTML += itemText;
        }
        
        // Load story section
        function loadSection(sectionId) {
            playSound('click');
            gameState.currentSection = sectionId;
            const section = storySections[sectionId];
            
            if (!section) {
                document.getElementById('story-text').innerHTML = "<p class='game-over'>Error: Story section not found!</p>";
                return;
            }
            
            let storyText = section.text;
            
            // Check if this is a combat round section
            const isCombatRound = (sectionId === 25 || sectionId === 29 || sectionId === 39 || sectionId === 42);
            
            if (isCombatRound && combatState.active) {
                // Execute combat round
                const combatResult = executeCombatRound();
                storyText = combatResult;
                
                // Check if combat is over
                if (!combatState.active) {
                    // Combat ended
                    const silverReward = Math.floor(Math.random() * 25) + 15;
                    gameState.silver += silverReward;
                    updateStatsDisplay();
                    
                    storyText += `<br><span class="success">You defeated the ${combatState.enemyName}!</span>`;
                    storyText += `<br>You find <span class="gold">${silverReward} Silver</span> on the remains.`;
                    
                    // Clear choice buttons - combat is over
                    document.getElementById('choice-buttons').innerHTML = '';
                    
                    // Auto-continue to next section after combat
                    setTimeout(() => {
                        loadSection(combatState.nextSection);
                    }, 2000);
                }
            }
            
            // Execute any section action
            if (section.action) {
                const actionResult = section.action();
                if (actionResult) {
                    storyText += "<br><br>" + actionResult;
                }
            }
            
            document.getElementById('story-text').innerHTML = "<p>" + storyText + "</p><div class='blinking-cursor'></div>";
            
            // Only show choice buttons if not in an ended combat
            if (!isCombatRound || combatState.active) {
                const choiceButtons = document.getElementById('choice-buttons');
                choiceButtons.innerHTML = '';
                
                // Filter choices based on requirements
                const availableChoices = section.choices.filter(choice => {
                    if (!choice.requirement) return true;
                    return gameState.inventory.includes(choice.requirement) || 
                           gameState.equippedWeapon === choice.requirement ||
                           gameState.equippedArmor === choice.requirement;
                });
                
                // If no choices available (and not a special section), provide a default
                if (availableChoices.length === 0 && section.choices.length > 0) {
                    const button = document.createElement('button');
                    button.className = 'choice-btn';
                    button.textContent = "Continue through the mountains";
                    button.onclick = function() {
                        loadSection(1); // Go back to start
                    };
                    choiceButtons.appendChild(button);
                } else {
                    availableChoices.forEach(choice => {
                        const button = document.createElement('button');
                        button.className = 'choice-btn';
                        button.textContent = choice.text;
                        button.onclick = function() {
                            if (choice.skillCheck) {
                                performSkillCheck(choice.checkType, choice.difficulty, choice.nextSection);
                            } else {
                                loadSection(choice.nextSection);
                            }
                        };
                        choiceButtons.appendChild(button);
                    });
                }
            }
            
            // Save game progress
            saveGame();
        }
        
        // Execute one round of combat
        function executeCombatRound() {
            combatState.round++;
            
            // Roll dice for both combatants
            const playerRoll = rollDice(2, 6);
            const enemyRoll = rollDice(2, 6);
            
            // Add strength to dice rolls
            let playerTotal = playerRoll + gameState.strength;
            let enemyTotal = enemyRoll + combatState.enemyStrength;
            
            // Special bonuses for mountain creatures with ice axe
            if (combatState.isMountainCreature && gameState.equippedWeapon === 'Ice Axe') {
                playerTotal += 2; // Bonus vs mountain creatures
            }
            
            let resultText = `<div class="combat-log"><span class="enemy">ROUND ${combatState.round}: ${combatState.enemyName}</span><br>`;
            resultText += `Your Health: ${gameState.health}/${gameState.maxHealth}, Enemy Health: ${combatState.enemyCurrentHealth}<br>`;
            resultText += `You roll ${playerRoll} + Strength ${gameState.strength}${combatState.isMountainCreature && gameState.equippedWeapon === 'Ice Axe' ? ' + 2 (ice axe in mountains)' : ''} = <strong>${playerTotal}</strong><br>`;
            resultText += `Enemy rolls ${enemyRoll} + Strength ${combatState.enemyStrength} = <strong>${enemyTotal}</strong><br>`;
            
            if (playerTotal > enemyTotal) {
                // Player hits enemy
                let damage = 0;
                if (gameState.equippedWeapon === 'Rusty Sword') damage = rollDice(2, 6);
                else if (gameState.equippedWeapon === 'Silvered Knife') damage = rollDice(2, 6);
                else if (gameState.equippedWeapon === 'Ice Axe') {
                    damage = rollDice(2, 6) + 2; // Bonus in mountains
                }
                else damage = rollDice(2, 6); // Default
                
                combatState.enemyCurrentHealth -= damage;
                resultText += `<span class="success">You hit for ${damage} damage!</span><br>`;
                playSound('combat');
                
                if (combatState.enemyCurrentHealth <= 0) {
                    combatState.active = false;
                    resultText += `</div>`;
                    return resultText;
                }
                
            } else if (playerTotal < enemyTotal) {
                // Enemy hits player
                const enemyDamage = rollDice(combatState.enemyDamageDice, combatState.enemyDamageSides);
                gameState.health -= enemyDamage;
                resultText += `<span class="damage">The ${combatState.enemyName} hits you for ${enemyDamage} damage!</span>`;
                playSound('damage');
                
                // Check if player died
                if (gameState.health <= 0) {
                    combatState.active = false;
                    resultText += `<br><span class="game-over">You have been defeated! Game Over.</span>`;
                    resultText += `</div>`;
                    
                    setTimeout(() => {
                        localStorage.removeItem('landOfTheDammedGameState');
                        location.href = 'lvl1.html';
                    }, 3000);
                    
                    return resultText;
                }
            } else {
                // Tie - no damage dealt
                resultText += "The attacks are evenly matched! No damage dealt this round.";
            }
            
            resultText += `</div>`;
            updateStatsDisplay();
            
            return resultText;
        }
        
        // Perform skill check
        function performSkillCheck(checkType, difficulty, nextSection) {
            playSound('roll');
            const diceRoll = rollDice(2, 6);
            let statValue = gameState[checkType];
            
            // For non-mystics trying spirit checks, they have their base spirit
            if (checkType === 'spirit') {
                // All classes have spirit from Level 1
            }
            
            let success = diceRoll <= statValue;
            
            // Store result globally for section actions to use
            window.checkResult = success;
            
            let resultText = `You roll ${diceRoll}. Your ${checkType.toUpperCase()} is ${statValue}. `;
            resultText += success ? 
                `<span class="success">Success!</span>` : 
                `<span class="damage">Failure!</span>`;
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${resultText}</div>`;
            
            if (success) {
                playSound('success');
            } else {
                playSound('failure');
            }
            
            // Continue to next section after a brief delay
            setTimeout(() => {
                loadSection(nextSection);
            }, 1500);
        }
        
        // Use Agility
        function useAgility() {
            playSound('click');
            if (gameState.agility <= 0) {
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">You have no Agility!</div>`;
                return;
            }
            
            const diceRoll = rollDice(2, 6);
            const success = diceRoll <= gameState.agility;
            
            let resultText = `You use your agility... Roll: ${diceRoll}, Agility: ${gameState.agility}. `;
            resultText += success ? 
                `<span class="success">Agile!</span> You move with grace and speed.` : 
                `<span class="damage">Clumsy!</span> You fumble.`;
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${resultText}</div>`;
            
            if (success) {
                playSound('success');
                // Good effect
                const goodEffects = [
                    "You nimbly avoid loose rocks on the path!",
                    "You climb a difficult section with ease!",
                    "You balance perfectly on a narrow ledge."
                ];
                const effect = goodEffects[Math.floor(Math.random() * goodEffects.length)];
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">${effect}</div>`;
            } else {
                playSound('failure');
                // Bad effect
                const badEffects = [
                    "You slip on loose gravel and take 3 damage!",
                    "You lose your footing and drop some silver!",
                    "You make noise that echoes through the mountains."
                ];
                const effect = badEffects[Math.floor(Math.random() * badEffects.length)];
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">${effect}</div>`;
                
                if (effect.includes("damage")) {
                    gameState.health -= 3;
                    updateStatsDisplay();
                    playSound('damage');
                } else if (effect.includes("silver")) {
                    const silverLost = rollDice(1, 10);
                    gameState.silver = Math.max(0, gameState.silver - silverLost);
                    updateStatsDisplay();
                    playSound('damage');
                }
            }
        }
        
        // Save game
        function saveGame() {
            playSound('click');
            localStorage.setItem('landOfTheDammedGameState', JSON.stringify(gameState));
            document.getElementById('story-text').innerHTML += `<div class="dice-roll"><span class="success">Game saved!</span></div>`;
        }
        
        // Load game
        function loadGame() {
            playSound('click');
            const savedGame = localStorage.getItem('landOfTheDammedGameState');
            if (savedGame) {
                const savedState = JSON.parse(savedGame);
                
                // Accept Level 1 or Level 2 saved games
                if (savedState.level === 1 || savedState.level === 2) {
                    Object.assign(gameState, savedState);
                    
                    // Update to Level 2 if it was Level 1
                    if (gameState.level === 1) {
                        gameState.level = 2;
                        saveGame();
                    }
                    
                    updateStatsDisplay();
                    updateInventoryDisplay();
                    showScreen('screen-game');
                    loadSection(gameState.currentSection);
                    
                    document.getElementById('story-text').innerHTML += `<div class="dice-roll"><span class="success">Game loaded!</span></div>`;
                } else {
                    document.getElementById('story-text').innerHTML += `<div class="dice-roll">No saved game found for Level 2.</div>`;
                }
            } else {
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">No saved game found.</div>`;
            }
        }
        
        // Go to next level
        function goToNextLevel() {
            playSound('click');
            // Save game state for level 3 with updated level
            gameState.level = 3;
            localStorage.setItem('landOfTheDammedGameState', JSON.stringify(gameState));
            // Redirect to level 3
            window.location.href = 'lvl3.html';
        }
        
        // Utility function to roll dice
        function rollDice(num, sides) {
            let total = 0;
            for (let i = 0; i < num; i++) {
                total += Math.floor(Math.random() * sides) + 1;
            }
            return total;
        }
        
        // Initialize on load
        window.onload = initGame;
        
        // Add click sound to all buttons
        document.addEventListener('DOMContentLoaded', function() {
            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => {
                button.addEventListener('click', function() {
                    playSound('click');
                });
            });
        });
    </script>
</body>
</html>
