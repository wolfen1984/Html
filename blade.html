<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Blade Runner: Neon Pursuit</title>
<style>
:root {
  --blade-orange: #ff5500;
  --neon-blue: #00aaff;
  --cyber-gray: #1a1a2e;
  --panel-bg: rgba(10, 10, 30, 0.9);
  --text-color: #e0e0ff;
  --grid-color: rgba(0, 170, 255, 0.15);
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  font-family: 'Rajdhani', sans-serif;
}

body {
  margin: 0;
  padding: 0;
  background-color: var(--cyber-gray);
  color: var(--text-color);
  touch-action: manipulation;
  overflow: hidden;
  height: 100vh;
  user-select: none;
  -webkit-user-select: none;
  background-image: 
    linear-gradient(to bottom, rgba(10, 10, 30, 0.9), rgba(5, 5, 15, 0.95)),
    url('https://images.unsplash.com/photo-1535223289827-42f1e9919769?q=80');
  background-size: cover;
  background-position: center;
  position: relative;
  line-height: 1.5;
}

/* Scanlines effect */
body::after {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    repeating-linear-gradient(
      0deg,
      rgba(0, 170, 255, 0.05),
      rgba(0, 170, 255, 0.05) 1px,
      transparent 1px,
      transparent 2px
    );
  pointer-events: none;
  z-index: 100;
}

/* Grid overlay */
body::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    linear-gradient(90deg, var(--grid-color) 1px, transparent 1px),
    linear-gradient(0deg, var(--grid-color) 1px, transparent 1px);
  background-size: 20px 20px;
  pointer-events: none;
  z-index: 1;
}

/* Particle Effects */
.particle {
  position: absolute;
  background-color: var(--neon-blue);
  border-radius: 50%;
  pointer-events: none;
  z-index: 10;
}

.damage-number {
  position: absolute;
  color: var(--blade-orange);
  font-weight: bold;
  font-size: 1.5em;
  text-shadow: 0 0 5px rgba(255, 85, 0, 0.7);
  pointer-events: none;
  z-index: 20;
  animation: floatUp 1s forwards;
  font-family: 'Orbitron', sans-serif;
}

@keyframes floatUp {
  0% { transform: translateY(0); opacity: 1; }
  100% { transform: translateY(-50px); opacity: 0; }
}

/* Game Container */
#game-container {
  width: 100%;
  height: 100vh;
  display: flex;
  flex-direction: column;
  position: relative;
  z-index: 2;
  background-color: rgba(5, 5, 15, 0.7);
  border: 1px solid var(--neon-blue);
  box-shadow: 0 0 20px rgba(0, 170, 255, 0.3);
  overflow: hidden;
}

/* Header Section */
#header {
  background: linear-gradient(to bottom, rgba(30, 30, 50, 0.8), rgba(15, 15, 35, 0.9));
  padding: 12px 10px;
  border-bottom: 1px solid var(--neon-blue);
  text-align: center;
  font-size: 1.1em;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: relative;
  font-family: 'Orbitron', sans-serif;
  text-shadow: 0 0 5px rgba(0, 170, 255, 0.7);
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.7);
  z-index: 5;
  letter-spacing: 1px;
}

#equipped-weapon {
  font-size: 0.8em;
  color: var(--blade-orange);
  font-style: italic;
}

#shift-status {
  font-size: 0.9em;
  color: var(--neon-blue);
  margin-left: 50px;
  text-transform: uppercase;
  letter-spacing: 1px;
  text-shadow: 0 0 3px rgba(0, 170, 255, 0.5);
}

/* Shift Display */
#time-container {
  display: flex;
  align-items: center;
  gap: 8px;
}

#time-indicator {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  background: var(--blade-orange);
  position: relative;
  border: 1px solid var(--neon-blue);
  box-shadow: 0 0 10px rgba(255, 85, 0, 0.5);
}

#shift-indicator {
  font-size: 0.85em;
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* Enemy Stats */
#enemy-stats {
  background: linear-gradient(to bottom, rgba(30, 30, 50, 0.8), rgba(15, 15, 35, 0.9));
  padding: 12px 10px;
  border-bottom: 1px solid var(--neon-blue);
  font-size: 0.95em;
  text-align: center;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.7);
  position: relative;
}

.enemy-health-container {
  flex: 1;
}

#enemy-stats .enemy-name {
  font-weight: bold;
  font-size: 14px;
  color: var(--neon-blue);
  text-shadow: 0 0 3px var(--neon-blue);
  font-family: 'Orbitron', sans-serif;
  letter-spacing: 1px;
  text-transform: uppercase;
}

#enemy-stats .enemy-hp {
  color: var(--neon-blue);
  font-size: 12px;
  text-shadow: 0 0 3px var(--neon-blue);
}

#enemy-stats .enemy-dmg {
  color: var(--blade-orange);
  margin-right: 100px;
  font-size: 12px;
  text-shadow: 0 0 3px var(--blade-orange);
}

#enemy-hp-bar {
  height: 8px;
  background-color: rgba(30, 30, 50, 0.7);
  margin-top: 5px;
  border-radius: 5px;
  overflow: hidden;
  border: 1px solid var(--neon-blue);
}

#enemy-hp-fill {
  height: 100%;
  background: linear-gradient(to right, var(--blade-orange), #ff7733);
  width: 100%;
  transition: width 0.3s;
  box-shadow: 0 0 5px rgba(255, 85, 0, 0.7);
}

/* Enemy Weakness Indicator */
.enemy-weakness {
  position: absolute;
  top: -15px;
  right: 10px;
  font-size: 0.7em;
  padding: 3px 8px;
  border-radius: 3px;
  background-color: rgba(30, 30, 50, 0.9);
  border: 1px solid var(--neon-blue);
  color: var(--blade-orange);
  text-transform: uppercase;
  letter-spacing: 1px;
  font-family: 'Orbitron', sans-serif;
}

/* Main Display */
#main-display {
  flex: 1;
  padding: 15px;
  background-color: rgba(10, 10, 30, 0.8);
  border-bottom: 1px solid var(--neon-blue);
  overflow-y: auto;
  font-size: 1.1em;
  border-left: 1px solid rgba(0, 170, 255, 0.1);
  border-right: 1px solid rgba(0, 170, 255, 0.1);
  box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
  position: relative;
}

#combat-log {
  height: 100%;
  overflow-y: auto;
  padding-right: 5px;
}

.combat-entry {
  margin-bottom: 10px;
  animation: fadeIn 0.3s;
  padding: 8px;
  border-left: 2px solid transparent;
  transition: all 0.2s;
  border-radius: 3px;
  background: rgba(20, 20, 40, 0.3);
  border: 1px solid rgba(0, 170, 255, 0.1);
}

.combat-entry:hover {
  background-color: rgba(30, 30, 50, 0.5);
  border-left: 2px solid var(--neon-blue);
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(5px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Message Types */
.player-action {
  color: var(--neon-blue);
}

.enemy-action {
  color: var(--blade-orange);
}

.system-message {
  color: #ffcc00;
  font-style: italic;
}

.loot-message {
  color: #00ccff;
}

.critical-hit {
  color: #ffcc00;
  font-weight: bold;
  animation: pulse 0.5s infinite alternate;
}

@keyframes pulse {
  from { text-shadow: 0 0 5px #ffcc00; }
  to { text-shadow: 0 0 10px #ffcc00, 0 0 20px #ffcc00; }
}

.dodge-message {
  color: var(--neon-blue);
  font-weight: bold;
}

.xp-message {
  color: var(--neon-blue);
}

.level-up-message {
  color: #ffcc00;
  font-weight: bold;
  animation: glow 1s infinite alternate;
  text-shadow: 0 0 5px #ffcc00;
}

@keyframes glow {
  from { text-shadow: 0 0 5px #ffcc00; }
  to { text-shadow: 0 0 10px #ffcc00, 0 0 20px #ffcc00; }
}

/* Stats Panel */
#stats-panel {
  display: flex;
  justify-content: space-between;
  background: linear-gradient(to bottom, rgba(30, 30, 50, 0.8), rgba(15, 15, 35, 0.9));
  padding: 12px 10px;
  border-bottom: 1px solid var(--neon-blue);
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.7);
}

.stat-box {
  text-align: center;
  flex: 1;
  position: relative;
  padding: 5px;
  border-right: 1px solid rgba(0, 170, 255, 0.2);
}

.stat-box:last-child {
  border-right: none;
}

.stat-box:hover .stat-tooltip {
  display: block;
}

.stat-tooltip {
  display: none;
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background-color: rgba(30, 30, 50, 0.95);
  padding: 5px;
  border-radius: 3px;
  font-size: 0.8em;
  white-space: nowrap;
  z-index: 100;
  border: 1px solid var(--neon-blue);
  color: var(--text-color);
  min-width: 120px;
}

.stat-value {
  font-weight: bold;
  font-size: 1.2em;
  color: var(--neon-blue);
  text-shadow: 0 0 3px rgba(0, 170, 255, 0.5);
  font-family: 'Orbitron', sans-serif;
}

/* Health and Integrity Bars */
#hp-bar, #integrity-bar {
  height: 8px;
  background-color: rgba(30, 30, 50, 0.7);
  margin-top: 5px;
  border-radius: 5px;
  overflow: hidden;
  border: 1px solid var(--neon-blue);
}

#hp-fill {
  height: 100%;
  background: linear-gradient(to right, #006400, #00cc00);
  width: 100%;
  transition: width 0.3s;
  box-shadow: 0 0 5px rgba(0, 204, 0, 0.7);
}

#integrity-fill {
  height: 100%;
  background: linear-gradient(to right, #0066cc, var(--neon-blue));
  width: 100%;
  transition: width 0.3s;
  box-shadow: 0 0 5px rgba(0, 170, 255, 0.7);
}

/* Controls */
#controls {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 10px;
  padding: 15px;
  background: linear-gradient(to bottom, rgba(30, 30, 50, 0.8), rgba(15, 15, 35, 0.9));
  border-top: 1px solid var(--neon-blue);
  box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.7);
  position: relative;
}

button {
  padding: 14px;
  border: none;
  border-radius: 4px;
  background: linear-gradient(to bottom, #2a2a4a, #1a1a3a);
  color: var(--text-color);
  font-family: 'Rajdhani', sans-serif;
  font-size: 1em;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
  overflow: hidden;
  border: 1px solid var(--neon-blue);
  text-shadow: 0 0 3px rgba(0, 0, 0, 0.7);
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
  letter-spacing: 1px;
}

button::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(to bottom, rgba(0, 170, 255, 0.1), rgba(0, 170, 255, 0.05));
  opacity: 0;
  transition: opacity 0.2s;
}

button:hover::before {
  opacity: 1;
}

button:active {
  transform: translateY(2px);
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
}

button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  background: linear-gradient(to bottom, #2a2a3a, #1a1a2a);
}

/* Special Ability Button */
#special-ability {
  background: linear-gradient(to bottom, #0044aa, #003388);
  grid-column: span 3;
  font-weight: bold;
  letter-spacing: 1px;
  text-transform: uppercase;
  font-family: 'Orbitron', sans-serif;
}

#special-ability.available {
  background: linear-gradient(to bottom, var(--neon-blue), #0088ff);
  color: white;
  animation: pulse 2s infinite;
  text-shadow: none;
}

@keyframes pulse {
  0% { box-shadow: 0 0 0 0 rgba(0, 170, 255, 0.7); }
  70% { box-shadow: 0 0 0 10px rgba(0, 170, 255, 0); }
  100% { box-shadow: 0 0 0 0 rgba(0, 170, 255, 0); }
}

/* Floating Action Buttons */
.floating-btn {
  position: absolute;
  bottom: 90px;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: linear-gradient(to bottom, #2a2a4a, #1a1a3a);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5em;
  z-index: 5;
  transition: transform 0.2s;
  border: 1px solid var(--neon-blue);
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
  cursor: pointer;
}

.floating-btn:hover {
  transform: scale(1.1);
  background: linear-gradient(to bottom, #3a3a5a, #2a2a4a);
}

#inventory-btn {
  right: 70px;
}

#shop-btn {
  right: 10px;
}

.floating-btn::after {
  content: attr(data-count);
  position: absolute;
  top: -5px;
  right: -5px;
  background: linear-gradient(to bottom, var(--neon-blue), #0088ff);
  color: white;
  border-radius: 50%;
  width: 20px;
  height: 20px;
  font-size: 0.7em;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid var(--neon-blue);
}

/* Inventory Panel */
#inventory-panel, #shop-panel {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.9);
  display: none;
  flex-direction: column;
  z-index: 20;
  padding: 20px;
  box-sizing: border-box;
  background-image: 
    linear-gradient(to bottom, rgba(0, 0, 0, 0.9), rgba(5, 5, 15, 0.95)),
    url('https://images.unsplash.com/photo-1535223289827-42f1e9919769?q=80');
  background-size: cover;
  background-position: center;
}

.panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 10px;
  border-bottom: 1px solid var(--neon-blue);
}

.panel-title {
  font-size: 1.5em;
  color: var(--neon-blue);
  font-family: 'Orbitron', sans-serif;
  text-shadow: 0 0 5px var(--neon-blue);
}

.close-btn {
  background: none;
  border: none;
  color: var(--text-color);
  font-size: 1.5em;
  cursor: pointer;
  padding: 5px;
}

#inventory-items, #shop-items {
  flex: 1;
  overflow-y: auto;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: 15px;
  padding: 10px;
}

.inventory-item, .shop-item {
  background: rgba(30, 30, 50, 0.8);
  border: 1px solid var(--neon-blue);
  border-radius: 5px;
  padding: 10px;
  display: flex;
  flex-direction: column;
  align-items: center;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
  overflow: hidden;
}

.inventory-item:hover, .shop-item:hover {
  transform: translateY(-3px);
  box-shadow: 0 5px 15px rgba(0, 170, 255, 0.3);
}

.inventory-item::before, .shop-item::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, rgba(0, 170, 255, 0.1), transparent);
  z-index: 1;
}

.item-icon {
  font-size: 2em;
  margin-bottom: 5px;
}

.item-name {
  font-weight: bold;
  margin-bottom: 5px;
  text-align: center;
}

.item-desc {
  font-size: 0.8em;
  text-align: center;
  color: #aaa;
  margin-bottom: 5px;
}

.item-stats {
  font-size: 0.8em;
  color: var(--blade-orange);
  text-align: center;
  margin-top: auto;
}

.item-price {
  font-size: 0.8em;
  color: #ffcc00;
  text-align: center;
  margin-top: 5px;
}

.item-rarity {
  position: absolute;
  top: 5px;
  right: 5px;
  font-size: 0.7em;
  padding: 2px 5px;
  border-radius: 3px;
}

.rarity-common {
  background-color: rgba(100, 100, 100, 0.7);
  color: #ccc;
}

.rarity-uncommon {
  background-color: rgba(0, 100, 0, 0.7);
  color: #0f0;
}

.rarity-rare {
  background-color: rgba(0, 0, 100, 0.7);
  color: #00f;
}

.rarity-epic {
  background-color: rgba(100, 0, 100, 0.7);
  color: #f0f;
}

.panel-actions {
  display: flex;
  justify-content: space-between;
  margin-top: 15px;
  padding-top: 15px;
  border-top: 1px solid var(--neon-blue);
}

.panel-actions button {
  flex: 1;
  margin: 0 5px;
  padding: 10px;
}

#selected-item-info {
  margin-top: 15px;
  padding: 10px;
  background: rgba(20, 20, 40, 0.7);
  border: 1px solid var(--neon-blue);
  border-radius: 5px;
  display: none;
}

#player-credits {
  position: absolute;
  top: 20px;
  right: 20px;
  color: #ffcc00;
  font-family: 'Orbitron', sans-serif;
  font-size: 1.2em;
  text-shadow: 0 0 5px rgba(255, 204, 0, 0.5);
}

/* Game Over Screen */
#game-over {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.9);
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 20;
  text-align: center;
  background-image: 
    linear-gradient(to bottom, rgba(0, 0, 0, 0.9), rgba(5, 5, 15, 0.95)),
    url('https://images.unsplash.com/photo-1535223289827-42f1e9919769?q=80');
  background-size: cover;
  background-position: center;
  background-blend-mode: multiply;
}

#game-over h1 {
  color: var(--blade-orange);
  font-size: 3em;
  margin-bottom: 20px;
  text-shadow: 0 0 10px #ff5500;
  animation: pulse-red 1.5s infinite;
  font-family: 'Orbitron', sans-serif;
  letter-spacing: 3px;
  text-transform: uppercase;
}

@keyframes pulse-red {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

#death-message {
  font-size: 1.2em;
  margin-bottom: 30px;
  max-width: 80%;
  color: var(--text-color);
  font-style: italic;
  text-shadow: 0 0 5px rgba(0, 0, 0, 0.7);
  padding: 0 20px;
}

#stats-summary {
  margin-bottom: 30px;
  background-color: rgba(30, 30, 50, 0.8);
  padding: 15px;
  border-radius: 5px;
  width: 80%;
  max-width: 400px;
  border: 2px solid var(--neon-blue);
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.7);
}

#stats-summary div {
  margin-bottom: 8px;
  color: var(--text-color);
  font-size: 1.1em;
}

#stats-summary span {
  color: var(--neon-blue);
  font-weight: bold;
}

#restart-btn {
  padding: 15px 30px;
  font-size: 1.2em;
  background: linear-gradient(to bottom, var(--neon-blue), #0088ff);
  border: none;
  border-radius: 5px;
  color: white;
  cursor: pointer;
  transition: all 0.2s;
  font-family: 'Orbitron', sans-serif;
  border: 1px solid var(--neon-blue);
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
  text-transform: uppercase;
  letter-spacing: 1px;
}

#restart-btn:hover {
  background: linear-gradient(to bottom, #00aaff, #0088ff);
  transform: scale(1.05);
}

/* Combo Display */
#combo-display {
  position: absolute;
  top: 10px;
  right: 60px;
  background: linear-gradient(to bottom, #2a2a4a, #1a1a3a);
  padding: 5px 15px;
  border-radius: 15px;
  font-size: 0.9em;
  display: none;
  z-index: 5;
  border: 1px solid var(--neon-blue);
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
  color: var(--blade-orange);
  font-weight: bold;
  font-family: 'Orbitron', sans-serif;
}

.combo-active {
  animation: comboPulse 0.5s infinite alternate;
}

@keyframes comboPulse {
  from { box-shadow: 0 0 5px rgba(255, 85, 0, 0.5); }
  to { box-shadow: 0 0 15px rgba(255, 85, 0, 0.8); }
}

/* Animations */
.enemy-attack-animation {
  animation: enemyAttack 0.3s;
}

@keyframes enemyAttack {
  0% { transform: translateX(0); }
  50% { transform: translateX(-10px); }
  100% { transform: translateX(0); }
}

.player-attack-animation {
  animation: playerAttack 0.3s;
}

@keyframes playerAttack {
  0% { transform: translateX(0); }
  50% { transform: translateX(10px); }
  100% { transform: translateX(0); }
}

/* Scrollbar styling */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(20, 20, 40, 0.5);
}

::-webkit-scrollbar-thumb {
  background: var(--neon-blue);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: #0088ff;
}

/* Responsive adjustments */
@media (max-width: 600px) {
  #header {
    font-size: 0.95em;
    padding: 10px 5px;
  }

  .stat-value {
    font-size: 1em;
  }

  #main-display {
    font-size: 1em;
    padding: 10px;
  }

  button {
    padding: 12px;
    font-size: 0.9em;
  }
  
  #combo-display {
    right: 50px;
    font-size: 0.8em;
    padding: 5px 10px;
  }
  
  .floating-btn {
    width: 45px;
    height: 45px;
    font-size: 1.3em;
    bottom: 80px;
  }
  
  #inventory-btn {
    right: 60px;
  }
  
  #shop-btn {
    right: 10px;
  }
  
  #controls {
    padding: 12px;
    gap: 8px;
  }
  
  #stats-panel {
    padding: 10px 5px;
  }
  
  .stat-box {
    padding: 3px;
  }
  
  #inventory-items, #shop-items {
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 10px;
  }
}
</style>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
<div id="game-container">
<!-- Header -->
<div id="header">
  <span id="shift-status">Night Shift</span>
  <span id="equipped-weapon">Equipped: Blaster Pistol</span>
  <div id="time-container">
    <div id="time-indicator"></div>
    <span id="shift-indicator">Night</span>
  </div>
</div>

<!-- Stats Panel -->
<div id="stats-panel">
  <div class="stat-box">
    <div>Sector</div>
    <div class="stat-value" id="district">1</div>
    <div class="stat-tooltip">Current city sector</div>
  </div>
  <div class="stat-box">
    <div>Level</div>
    <div class="stat-value" id="level">1</div>
    <div class="stat-tooltip">Your Blade Runner rank</div>
  </div>
  <div class="stat-box">
    <div>Health</div>
    <div class="stat-value" id="hp">30/30</div>
    <div id="hp-bar"><div id="hp-fill"></div></div>
    <div class="stat-tooltip">Your current health</div>
  </div>
  <div class="stat-box">
    <div>Integrity</div>
    <div class="stat-value" id="integrity">0/100</div>
    <div id="integrity-bar"><div id="integrity-fill"></div></div>
    <div class="stat-tooltip">Build Integrity for special abilities</div>
  </div>
  <div class="stat-box">
    <div>Retires</div>
    <div class="stat-value" id="kills">0</div>
    <div class="stat-tooltip">Total replicants retired</div>
  </div>
</div>

<!-- Enemy Stats -->
<div id="enemy-stats">
  <div class="enemy-health-container">
    <div id="enemy-name" class="enemy-name">Security Drone</div>
    <div id="enemy-hp" class="enemy-hp">HP: 12/12</div>
    <div id="enemy-hp-bar"><div id="enemy-hp-fill"></div></div>
  </div>
  <div id="enemy-dmg" class="enemy-dmg">DMG: 1-3</div>
  <div id="enemy-weakness" class="enemy-weakness" style="display: none;">Weak: EMP</div>
</div>

<!-- Main Display -->
<div id="main-display">
  <div id="combat-log">
    <div class="system-message combat-entry">Los Angeles, November 2019. Rain-slicked streets glow with neon.</div>
    <div class="system-message combat-entry">You are a Blade Runner. Your mission: hunt and retire rogue replicants.</div>
    <div class="combat-entry">A security drone scans the alley ahead!</div>
  </div>
</div>

<!-- Controls -->
<div id="controls">
  <button id="attack-btn">Fire</button>
  <button id="analyze-btn">Analyze</button>
  <button id="evade-btn">Evade</button>
  <button id="special-ability">Precision Shot (0/100)</button>
</div>

<!-- Floating Action Buttons -->
<button id="inventory-btn" class="floating-btn" data-count="3">üéí</button>
<button id="shop-btn" class="floating-btn">üõí</button>

<!-- Inventory Panel -->
<div id="inventory-panel">
  <div class="panel-header">
    <h2 class="panel-title">INVENTORY</h2>
    <button class="close-btn" id="close-inventory">‚úï</button>
  </div>
  <div id="player-credits">Credits: 100</div>
  <div id="inventory-items"></div>
  <div id="selected-item-info"></div>
  <div class="panel-actions">
    <button id="use-item-btn" disabled>Use</button>
    <button id="equip-item-btn" disabled>Equip</button>
    <button id="sell-item-btn" disabled>Sell</button>
  </div>
</div>

<!-- Shop Panel -->
<div id="shop-panel">
  <div class="panel-header">
    <h2 class="panel-title">WEAPONS SHOP</h2>
    <button class="close-btn" id="close-shop">‚úï</button>
  </div>
  <div id="shop-credits">Credits: 100</div>
  <div id="shop-items"></div>
  <div id="selected-shop-item-info"></div>
  <div class="panel-actions">
    <button id="buy-item-btn" disabled>Buy</button>
  </div>
</div>

<!-- Game Over Screen -->
<div id="game-over">
  <h1>RETIREMENT</h1>
  <div id="death-message">Your time as a Blade Runner has come to an end.</div>
  <div id="stats-summary">
    <div>Sector Reached: <span id="final-district">1</span></div>
    <div>Level Achieved: <span id="final-level">1</span></div>
    <div>Replicants Retired: <span id="final-kills">0</span></div>
    <div>Highest Combo: <span id="final-combo">0</span>x</div>
    <div>Total Credits: <span id="final-credits">100</span></div>
  </div>
  <button id="restart-btn">New Assignment</button>
</div>
</div>

<script>
// Game State
const gameState = {
  district: 1,
  level: 1,
  xp: 0,
  maxXp: 100,
  baseMinDmg: 0,
  baseMaxDmg: 0,
  maxHp: 30,
  currentHp: 30,
  integrity: 0,
  maxIntegrity: 100,
  isNight: true,
  equippedWeapon: { 
    name: "Blaster Pistol", 
    minDmg: 6, 
    maxDmg: 10, 
    durability: Infinity,
    icon: "üî´",
    value: 50
  },
  inventory: [
    { 
      name: "Medkit", 
      description: "Restores 10 HP", 
      type: "consumable", 
      rarity: "common", 
      icon: "ü©π",
      value: 20 
    },
    { 
      name: "EMP Grenade", 
      type: "consumable", 
      description: "Stuns mechanical enemies for 1 turn", 
      rarity: "uncommon", 
      icon: "üí£",
      value: 35
    },
    { 
      name: "Stun Baton", 
      type: "weapon", 
      minDmg: 4, 
      maxDmg: 8, 
      durability: 20, 
      description: "4-8 DMG, 20 uses", 
      rarity: "uncommon", 
      icon: "‚ö°",
      value: 75
    }
  ],
  credits: 100,
  enemiesDefeated: 0,
  gameActive: true,
  currentCombo: 0,
  highestCombo: 0,
  lastAction: null,
  currentEnemy: null,
  selectedInventoryItem: null,
  selectedShopItem: null,
  enemyStunned: false
};

// Enemy Types
const enemies = [
  { name: "Security Drone", hp: 12, minDmg: 1, maxDmg: 3, xp: 10, weakness: "EMP", credits: 15 },
  { name: "Corporate Security", hp: 18, minDmg: 2, maxDmg: 4, xp: 20, weakness: null, credits: 25 },
  { name: "Combat Android", hp: 25, minDmg: 3, maxDmg: 5, xp: 30, weakness: "EMP", credits: 40 },
  { name: "Heavy Enforcer", hp: 35, minDmg: 4, maxDmg: 7, xp: 40, weakness: "EMP", credits: 60 },
  { name: "Corporate Investigator", hp: 30, minDmg: 3, maxDmg: 6, xp: 35, weakness: null, credits: 50 },
  { name: "Replicant Leader", hp: 60, minDmg: 6, maxDmg: 10, xp: 100, weakness: "EMP", credits: 150 }
];

// Shop Items
const shopItems = [
  { 
    name: "Taser Gloves", 
    type: "weapon", 
    minDmg: 5, 
    maxDmg: 9, 
    durability: 25, 
    description: "5-9 DMG, 25 uses", 
    rarity: "common", 
    icon: "‚ö°", 
    value: 80 
  },
  { 
    name: "Laser Carbine", 
    type: "weapon", 
    minDmg: 8, 
    maxDmg: 12, 
    durability: 20, 
    description: "8-12 DMG, 20 uses", 
    rarity: "uncommon", 
    icon: "üî´", 
    value: 150 
  },
  { 
    name: "Plasma Rifle", 
    type: "weapon", 
    minDmg: 12, 
    maxDmg: 16, 
    durability: 15, 
    description: "12-16 DMG, 15 uses", 
    rarity: "rare", 
    icon: "üî´", 
    value: 250 
  },
  { 
    name: "Deckard's Blaster", 
    type: "weapon", 
    minDmg: 15, 
    maxDmg: 20, 
    durability: 12, 
    description: "15-20 DMG, 12 uses", 
    rarity: "epic", 
    icon: "üî´", 
    value: 400 
  },
  { 
    name: "Pulse Cannon", 
    type: "weapon", 
    minDmg: 18, 
    maxDmg: 24, 
    durability: 10, 
    description: "18-24 DMG, 10 uses", 
    rarity: "epic", 
    icon: "üí•", 
    value: 500 
  },
  { 
    name: "Energy Sword", 
    type: "weapon", 
    minDmg: 14, 
    maxDmg: 18, 
    durability: 18, 
    description: "14-18 DMG, 18 uses", 
    rarity: "rare", 
    icon: "‚öîÔ∏è", 
    value: 350 
  },
  { 
    name: "Advanced Medkit", 
    type: "consumable", 
    description: "Restores 20 HP", 
    rarity: "uncommon", 
    icon: "üíä", 
    value: 50 
  },
  { 
    name: "Integrity Booster", 
    type: "consumable", 
    description: "Restores 50 Integrity", 
    rarity: "rare", 
    icon: "üîã", 
    value: 80 
  }
];

// DOM elements
const combatLog = document.getElementById('combat-log');
const districtDisplay = document.getElementById('district');
const levelDisplay = document.getElementById('level');
const hpDisplay = document.getElementById('hp');
const hpFill = document.getElementById('hp-fill');
const integrityDisplay = document.getElementById('integrity');
const integrityFill = document.getElementById('integrity-fill');
const killsDisplay = document.getElementById('kills');
const attackBtn = document.getElementById('attack-btn');
const analyzeBtn = document.getElementById('analyze-btn');
const evadeBtn = document.getElementById('evade-btn');
const specialBtn = document.getElementById('special-ability');
const inventoryBtn = document.getElementById('inventory-btn');
const shopBtn = document.getElementById('shop-btn');
const gameOverPanel = document.getElementById('game-over');
const deathMessage = document.getElementById('death-message');
const restartBtn = document.getElementById('restart-btn');
const timeIndicator = document.getElementById('time-indicator');
const shiftIndicator = document.getElementById('shift-indicator');
const equippedWeaponDisplay = document.getElementById('equipped-weapon');
const enemyNameDisplay = document.getElementById('enemy-name');
const enemyHpDisplay = document.getElementById('enemy-hp');
const enemyHpFill = document.getElementById('enemy-hp-fill');
const enemyDmgDisplay = document.getElementById('enemy-dmg');
const enemyWeaknessDisplay = document.getElementById('enemy-weakness');
const shiftStatusDisplay = document.getElementById('shift-status');
const finalDistrictDisplay = document.getElementById('final-district');
const finalLevelDisplay = document.getElementById('final-level');
const finalKillsDisplay = document.getElementById('final-kills');
const finalComboDisplay = document.getElementById('final-combo');
const finalCreditsDisplay = document.getElementById('final-credits');
const inventoryPanel = document.getElementById('inventory-panel');
const shopPanel = document.getElementById('shop-panel');
const inventoryItemsContainer = document.getElementById('inventory-items');
const shopItemsContainer = document.getElementById('shop-items');
const closeInventoryBtn = document.getElementById('close-inventory');
const closeShopBtn = document.getElementById('close-shop');
const selectedItemInfo = document.getElementById('selected-item-info');
const selectedShopItemInfo = document.getElementById('selected-shop-item-info');
const useItemBtn = document.getElementById('use-item-btn');
const equipItemBtn = document.getElementById('equip-item-btn');
const sellItemBtn = document.getElementById('sell-item-btn');
const buyItemBtn = document.getElementById('buy-item-btn');
const playerCreditsDisplay = document.getElementById('player-credits');
const shopCreditsDisplay = document.getElementById('shop-credits');

// Create particles for visual effects
function createParticles(x, y, color, count = 10) {
  for (let i = 0; i < count; i++) {
    const particle = document.createElement('div');
    particle.className = 'particle';
    particle.style.backgroundColor = color;
    particle.style.width = `${Math.random() * 5 + 2}px`;
    particle.style.height = particle.style.width;
    particle.style.left = `${x}px`;
    particle.style.top = `${y}px`;
    
    const angle = Math.random() * Math.PI * 2;
    const velocity = Math.random() * 5 + 2;
    const lifetime = Math.random() * 1000 + 500;
    
    document.body.appendChild(particle);
    
    const startTime = Date.now();
    
    function update() {
      const elapsed = Date.now() - startTime;
      const progress = elapsed / lifetime;
      
      if (progress >= 1) {
        document.body.removeChild(particle);
        return;
      }
      
      particle.style.opacity = 1 - progress;
      particle.style.transform = `translate(${Math.cos(angle) * velocity * progress * 50}px, ${Math.sin(angle) * velocity * progress * 50}px)`;
      
      requestAnimationFrame(update);
    }
    
    requestAnimationFrame(update);
  }
}

// Show damage numbers
function showDamageNumber(x, y, damage, isCritical = false) {
  const damageNumber = document.createElement('div');
  damageNumber.className = 'damage-number';
  damageNumber.textContent = damage;
  damageNumber.style.left = `${x}px`;
  damageNumber.style.top = `${y}px`;
  if (isCritical) {
    damageNumber.style.color = '#ffcc00';
    damageNumber.style.fontSize = '2em';
  }
  
  document.body.appendChild(damageNumber);
  
  setTimeout(() => {
    document.body.removeChild(damageNumber);
  }, 1000);
}

// Initialize game
function initGame() {
  gameState.district = 1;
  gameState.level = 1;
  gameState.xp = 0;
  gameState.maxXp = 100;
  gameState.baseMinDmg = 0;
  gameState.baseMaxDmg = 0;
  gameState.maxHp = 30;
  gameState.currentHp = gameState.maxHp;
  gameState.integrity = 0;
  gameState.isNight = true;
  gameState.equippedWeapon = { 
    name: "Blaster Pistol", 
    minDmg: 6, 
    maxDmg: 10, 
    durability: Infinity,
    icon: "üî´",
    value: 50
  };
  gameState.inventory = [
    { 
      name: "Medkit", 
      description: "Restores 10 HP", 
      type: "consumable", 
      rarity: "common", 
      icon: "ü©π",
      value: 20 
    },
    { 
      name: "EMP Grenade", 
      type: "consumable", 
      description: "Stuns mechanical enemies for 1 turn", 
      rarity: "uncommon", 
      icon: "üí£",
      value: 35
    },
    { 
      name: "Stun Baton", 
      type: "weapon", 
      minDmg: 4, 
      maxDmg: 8, 
      durability: 20, 
      description: "4-8 DMG, 20 uses", 
      rarity: "uncommon", 
      icon: "‚ö°",
      value: 75
    }
  ];
  gameState.credits = 100;
  gameState.enemiesDefeated = 0;
  gameState.gameActive = true;
  gameState.currentCombo = 0;
  gameState.highestCombo = 0;
  gameState.lastAction = null;
  gameState.selectedInventoryItem = null;
  gameState.selectedShopItem = null;
  gameState.enemyStunned = false;

  updateDisplays();
  generateEnemy();
  gameOverPanel.style.display = 'none';
  inventoryPanel.style.display = 'none';
  shopPanel.style.display = 'none';

  combatLog.innerHTML = `
    <div class="system-message combat-entry">Los Angeles, November 2019. Rain-slicked streets glow with neon.</div>
    <div class="system-message combat-entry">You are a Blade Runner. Your mission: hunt and retire rogue replicants.</div>
    <div class="system-message combat-entry">Maintain your integrity. Retire targets efficiently. Avoid corporate oversight.</div>
  `;

  addLogEntry(`A security drone scans the alley ahead!`, 'system');
}

// Update all displays
function updateDisplays() {
  districtDisplay.textContent = gameState.district;
  levelDisplay.textContent = gameState.level;
  hpDisplay.textContent = `${gameState.currentHp}/${gameState.maxHp}`;
  hpFill.style.width = `${(gameState.currentHp / gameState.maxHp) * 100}%`;
  integrityDisplay.textContent = `${gameState.integrity}/${gameState.maxIntegrity}`;
  integrityFill.style.width = `${(gameState.integrity / gameState.maxIntegrity) * 100}%`;
  killsDisplay.textContent = gameState.enemiesDefeated;
  specialBtn.textContent = `Precision Shot (${gameState.integrity}/${gameState.maxIntegrity})`;
  equippedWeaponDisplay.textContent = `Equipped: ${gameState.equippedWeapon.name}`;
  shiftStatusDisplay.textContent = gameState.isNight ? "Night Shift" : "Day Shift";
  inventoryBtn.setAttribute('data-count', gameState.inventory.length);
  shiftIndicator.textContent = gameState.isNight ? "Night" : "Day";
  playerCreditsDisplay.textContent = `Credits: ${gameState.credits}`;
  shopCreditsDisplay.textContent = `Credits: ${gameState.credits}`;

  // Update time indicator
  if (gameState.isNight) {
    timeIndicator.style.background = 'var(--neon-blue)';
    timeIndicator.style.boxShadow = '0 0 10px rgba(0, 170, 255, 0.5)';
  } else {
    timeIndicator.style.background = 'var(--blade-orange)';
    timeIndicator.style.boxShadow = '0 0 10px rgba(255, 85, 0, 0.5)';
  }

  if (gameState.currentEnemy) {
    enemyNameDisplay.textContent = gameState.currentEnemy.name;
    enemyHpDisplay.textContent = `HP: ${Math.max(0, gameState.currentEnemy.currentHp)}/${gameState.currentEnemy.hp}`;
    enemyHpFill.style.width = `${(gameState.currentEnemy.currentHp / gameState.currentEnemy.hp) * 100}%`;
    enemyDmgDisplay.textContent = `DMG: ${gameState.currentEnemy.minDmg}-${gameState.currentEnemy.maxDmg}`;
    
    // Show enemy weakness if known
    if (gameState.level >= 2 || gameState.enemiesDefeated > 3) {
      if (gameState.currentEnemy.weakness) {
        enemyWeaknessDisplay.style.display = 'block';
        enemyWeaknessDisplay.textContent = `Weak: ${gameState.currentEnemy.weakness}`;
      } else {
        enemyWeaknessDisplay.style.display = 'none';
      }
    } else {
      enemyWeaknessDisplay.style.display = 'none';
    }
  }

  if (gameState.integrity >= gameState.maxIntegrity) {
    specialBtn.classList.add('available');
  } else {
    specialBtn.classList.remove('available');
  }
}

// Add entry to combat log
function addLogEntry(text, type = 'normal') {
  const entry = document.createElement('div');
  entry.className = 'combat-entry';

  if (type === 'player') {
    entry.classList.add('player-action');
  } else if (type === 'enemy') {
    entry.classList.add('enemy-action');
  } else if (type === 'system') {
    entry.classList.add('system-message');
  } else if (type === 'loot') {
    entry.classList.add('loot-message');
  } else if (type === 'critical') {
    entry.classList.add('critical-hit');
  }

  entry.textContent = text;
  combatLog.appendChild(entry);
  combatLog.scrollTop = combatLog.scrollHeight;
}

// Generate a new enemy
function generateEnemy() {
  // Boss every 5 sectors
  if (gameState.district % 5 === 0) {
    gameState.currentEnemy = {...enemies[5]};
    addLogEntry(`A Replicant Leader has been detected in your sector!`, 'system');
  } else {
    // Scale enemy level with sector progression
    let enemyLevel = Math.min(Math.floor(gameState.district / 2), enemies.length - 2);
    gameState.currentEnemy = {...enemies[enemyLevel]};
  }

  // Scale enemy stats with sector progression
  const districtScale = 1 + (gameState.district * 0.05);
  gameState.currentEnemy.hp = Math.floor(gameState.currentEnemy.hp * districtScale);
  gameState.currentEnemy.minDmg = Math.floor(gameState.currentEnemy.minDmg * districtScale);
  gameState.currentEnemy.maxDmg = Math.floor(gameState.currentEnemy.maxDmg * districtScale);
  gameState.currentEnemy.currentHp = gameState.currentEnemy.hp;

  // Reset combo when new enemy appears
  gameState.currentCombo = 0;
  gameState.enemyStunned = false;
  updateDisplays();
}

// Player attack
function playerAttack() {
  if (!gameState.gameActive || !gameState.currentEnemy) return;

  // Add attack animation
  const controls = document.getElementById('controls');
  controls.classList.add('player-attack-animation');
  setTimeout(() => {
    controls.classList.remove('player-attack-animation');
  }, 300);

  // Combo system
  let comboMultiplier = 1;
  if (gameState.lastAction === 'attack') {
    gameState.currentCombo++;
    gameState.highestCombo = Math.max(gameState.highestCombo, gameState.currentCombo);

    if (gameState.currentCombo >= 3) {
      comboMultiplier = 1 + (gameState.currentCombo * 0.05);
      addLogEntry(`Combo x${gameState.currentCombo}! Damage increased!`, 'system');
    }
  } else {
    gameState.currentCombo = 1;
  }
  gameState.lastAction = 'attack';

  let damage = Math.floor(Math.random() * (gameState.equippedWeapon.maxDmg - gameState.equippedWeapon.minDmg + 1)) + gameState.equippedWeapon.minDmg;
  damage += Math.floor(gameState.baseMinDmg + (gameState.baseMaxDmg - gameState.baseMinDmg) * Math.random());
  damage = Math.floor(damage * comboMultiplier);
  
  // Critical hit chance
  const isCritical = Math.random() < 0.2;

  if (isCritical) {
    damage = Math.floor(damage * 1.5);
  }

  // Check enemy weakness
  if (gameState.currentEnemy.weakness === "EMP" && gameState.equippedWeapon.name === "EMP Grenade") {
    damage = Math.floor(damage * 1.5);
    addLogEntry(`The ${gameState.currentEnemy.name} is weak to EMP attacks!`, 'player');
  }

  gameState.currentEnemy.currentHp -= damage;

  // Show damage number
  const enemyRect = document.getElementById('enemy-stats').getBoundingClientRect();
  showDamageNumber(
    enemyRect.left + enemyRect.width / 2,
    enemyRect.top + enemyRect.height / 2,
    damage,
    isCritical
  );

  // Create particles
  createParticles(
    enemyRect.left + enemyRect.width / 2,
    enemyRect.top + enemyRect.height / 2,
    '#ff5500'
  );

  addLogEntry(
    `You fire at the ${gameState.currentEnemy.name} with ${gameState.equippedWeapon.name} for ${damage} damage${isCritical ? " (CRITICAL)" : ""}!`,
    isCritical ? 'critical' : 'player'
  );

  // Gain integrity
  gameState.integrity = Math.min(gameState.integrity + 10, gameState.maxIntegrity);
  updateDisplays();

  // Reduce weapon durability if not infinite
  if (gameState.equippedWeapon.durability !== Infinity) {
    gameState.equippedWeapon.durability--;
    if (gameState.equippedWeapon.durability <= 0) {
      addLogEntry(`Your ${gameState.equippedWeapon.name} is depleted!`, 'system');
      // Revert to default blaster
      gameState.equippedWeapon = { 
        name: "Blaster Pistol", 
        minDmg: 6, 
        maxDmg: 10, 
        durability: Infinity,
        icon: "üî´",
        value: 50
      };
      updateDisplays();
    }
  }

  if (gameState.currentEnemy.currentHp <= 0) {
    enemyDefeated();
  } else if (gameState.enemyStunned) {
    addLogEntry(`The ${gameState.currentEnemy.name} is stunned and can't retaliate!`, 'system');
    gameState.enemyStunned = false;
    setTimeout(nextPlayerTurn, 1000);
  } else {
    setTimeout(enemyTurn, 1000);
  }
}

// Player analyze
function playerAnalyze() {
  if (!gameState.gameActive || !gameState.currentEnemy) return;

  // Add animation
  const controls = document.getElementById('controls');
  controls.classList.add('player-attack-animation');
  setTimeout(() => {
    controls.classList.remove('player-attack-animation');
  }, 300);

  // Reset combo
  gameState.currentCombo = 0;
  gameState.lastAction = 'analyze';

  // Reveal weakness if any
  if (gameState.currentEnemy.weakness) {
    addLogEntry(`You analyze the ${gameState.currentEnemy.name} and discover a weakness to ${gameState.currentEnemy.weakness}!`, 'player');
    enemyWeaknessDisplay.style.display = 'block';
  } else {
    addLogEntry(`You analyze the ${gameState.currentEnemy.name} but find no weaknesses.`, 'player');
  }

  // Heal player
  const healAmount = Math.min(5, gameState.maxHp - gameState.currentHp);
  gameState.currentHp += healAmount;

  // Create particles
  const playerRect = document.getElementById('stats-panel').getBoundingClientRect();
  createParticles(
    playerRect.left + playerRect.width / 2,
    playerRect.top + playerRect.height / 2,
    '#00aaff',
    10
  );

  if (healAmount > 0) {
    addLogEntry(`Your analysis reveals tactical advantages, restoring ${healAmount} health.`, 'player');
  }

  // Gain integrity
  gameState.integrity = Math.min(gameState.integrity + 8, gameState.maxIntegrity);
  updateDisplays();

  if (gameState.enemyStunned) {
    addLogEntry(`The ${gameState.currentEnemy.name} is stunned and can't retaliate!`, 'system');
    gameState.enemyStunned = false;
    setTimeout(nextPlayerTurn, 1000);
  } else {
    setTimeout(enemyTurn, 1000);
  }
}

// Player evade
function playerEvade() {
  if (!gameState.gameActive || !gameState.currentEnemy) return;

  // Reset combo
  gameState.currentCombo = 0;
  gameState.lastAction = 'evade';

  // 70% chance to dodge next attack
  if (Math.random() < 0.7) {
    addLogEntry(`You take evasive maneuvers, preparing to dodge the next attack!`, 'player');
    gameState.shadowDodge = true;
  } else {
    addLogEntry(`You attempt to evade but fail to avoid the attack zone!`, 'player');
  }

  // Gain integrity
  gameState.integrity = Math.min(gameState.integrity + 8, gameState.maxIntegrity);
  updateDisplays();

  setTimeout(enemyTurn, 1000);
}

// Special ability - Precision Shot
function precisionShot() {
  if (!gameState.gameActive || !gameState.currentEnemy || gameState.integrity < gameState.maxIntegrity) return;

  gameState.integrity = 0;
  
  // Add attack animation
  const controls = document.getElementById('controls');
  controls.classList.add('player-attack-animation');
  setTimeout(() => {
    controls.classList.remove('player-attack-animation');
  }, 300);

  // Combo system
  let comboMultiplier = 1;
  if (gameState.lastAction === 'attack') {
    gameState.currentCombo++;
    gameState.highestCombo = Math.max(gameState.highestCombo, gameState.currentCombo);

    if (gameState.currentCombo >= 3) {
      comboMultiplier = 1 + (gameState.currentCombo * 0.05);
      addLogEntry(`Combo x${gameState.currentCombo}! Damage increased!`, 'system');
    }
  } else {
    gameState.currentCombo = 1;
  }
  gameState.lastAction = 'attack';

  let damage = Math.floor(Math.random() * 16) + 15;
  damage += Math.floor(gameState.baseMinDmg + (gameState.baseMaxDmg - gameState.baseMinDmg) * Math.random());
  damage = Math.floor(damage * comboMultiplier);

  gameState.currentEnemy.currentHp -= damage;

  // Show damage number
  const enemyRect = document.getElementById('enemy-stats').getBoundingClientRect();
  showDamageNumber(
    enemyRect.left + enemyRect.width / 2,
    enemyRect.top + enemyRect.height / 2,
    damage,
    true
  );

  // Create particles
  createParticles(
    enemyRect.left + enemyRect.width / 2,
    enemyRect.top + enemyRect.height / 2,
    '#ff5500',
    20
  );

  addLogEntry(`You take a PRECISION SHOT and hit the ${gameState.currentEnemy.name} for ${damage} damage!`, 'player');
  addLogEntry("Your targeting system confirms a critical hit!", 'system');

  updateDisplays();

  if (gameState.currentEnemy.currentHp <= 0) {
    enemyDefeated();
  } else if (gameState.enemyStunned) {
    addLogEntry(`The ${gameState.currentEnemy.name} is stunned and can't retaliate!`, 'system');
    gameState.enemyStunned = false;
    setTimeout(nextPlayerTurn, 1000);
  } else {
    setTimeout(enemyTurn, 1000);
  }
}

// Enemy turn
function enemyTurn() {
  if (!gameState.gameActive || !gameState.currentEnemy) return;

  // Check for dodge from evade
  if (gameState.shadowDodge) {
    addLogEntry(`The ${gameState.currentEnemy.name}'s attack misses your evasive position!`, 'system');
    gameState.shadowDodge = false;
    updateDisplays();
    return;
  }

  // Add enemy attack animation
  const enemyStats = document.getElementById('enemy-stats');
  enemyStats.classList.add('enemy-attack-animation');
  setTimeout(() => {
    enemyStats.classList.remove('enemy-attack-animation');
  }, 300);

  // Player dodge chance (15%)
  if (Math.random() < 0.15) {
    addLogEntry(`You dodge the ${gameState.currentEnemy.name}'s attack!`, 'dodge');
    updateDisplays();
    return;
  }

  let damage = Math.floor(Math.random() * (gameState.currentEnemy.maxDmg - gameState.currentEnemy.minDmg + 1)) + gameState.currentEnemy.minDmg;
  gameState.currentHp -= damage;

  // Show damage number on player
  const playerRect = document.getElementById('stats-panel').getBoundingClientRect();
  showDamageNumber(
    playerRect.left + playerRect.width / 2,
    playerRect.top + playerRect.height / 2,
    damage
  );

  addLogEntry(`The ${gameState.currentEnemy.name} attacks you for ${damage} damage!`, 'enemy');

  updateDisplays();

  if (gameState.currentHp <= 0) {
    gameOver();
  }
}

// Next player turn (after enemy is stunned)
function nextPlayerTurn() {
  addLogEntry(`The ${gameState.currentEnemy.name} is recovering from the stun!`, 'system');
}

// Enemy defeated
function enemyDefeated() {
  addLogEntry(`You have retired the ${gameState.currentEnemy.name}!`, 'player');
  gameState.enemiesDefeated++;
  gameState.xp += gameState.currentEnemy.xp;
  gameState.credits += gameState.currentEnemy.credits;
  addLogEntry(`You gain ${gameState.currentEnemy.xp} XP and ${gameState.currentEnemy.credits} credits!`, 'system');

  if (gameState.xp >= gameState.maxXp) {
    gameState.level++;
    gameState.xp -= gameState.maxXp;
    gameState.maxXp = Math.floor(gameState.maxXp * 1.2);
    gameState.maxHp += 5;
    gameState.currentHp = gameState.maxHp;
    gameState.baseMinDmg += 1;
    gameState.baseMaxDmg += 1;
    addLogEntry(`You are promoted to Level ${gameState.level}! Max HP increased to ${gameState.maxHp}, base damage increased!`, 'level-up');
  }

  // Loot drop
  if (Math.random() < 0.6 && gameState.inventory.length < 10) {
    const lootItems = [
      { 
        name: "Medkit", 
        description: "Restores 10 HP", 
        type: "consumable", 
        rarity: "common", 
        icon: "ü©π",
        value: 20 
      },
      { 
        name: "Energy Pack", 
        description: "Restores 25 Integrity", 
        type: "consumable", 
        rarity: "uncommon", 
        icon: "üîã",
        value: 35 
      },
      { 
        name: "EMP Grenade", 
        type: "consumable", 
        description: "Stuns mechanical enemies for 1 turn", 
        rarity: "uncommon", 
        icon: "üí£",
        value: 35 
      },
      { 
        name: "Targeting Scope", 
        type: "trinket", 
        description: "Increases critical chance", 
        rarity: "rare", 
        icon: "üéØ",
        value: 100 
      },
      { 
        name: "Stun Baton", 
        type: "weapon", 
        minDmg: 4, 
        maxDmg: 8, 
        durability: 20, 
        description: "4-8 DMG, 20 uses", 
        rarity: "uncommon", 
        icon: "‚ö°",
        value: 75 
      },
      { 
        name: "Pulse Rifle", 
        type: "weapon", 
        minDmg: 8, 
        maxDmg: 12, 
        durability: 15, 
        description: "8-12 DMG, 15 uses", 
        rarity: "rare", 
        icon: "üî´",
        value: 150 
      }
    ];

    const loot = lootItems[Math.floor(Math.random() * lootItems.length)];
    gameState.inventory.push(loot);
    addLogEntry(`You found a ${loot.name}!`, 'loot');
    inventoryBtn.setAttribute('data-count', gameState.inventory.length);
  } else if (gameState.inventory.length >= 10) {
    addLogEntry("Your inventory is full! Discard items to make space.", 'system');
  }

  // Increase max HP every 3 sectors
  if (gameState.district % 3 === 0) {
    gameState.maxHp += 3;
    gameState.currentHp = Math.min(gameState.currentHp + 3, gameState.maxHp);
    addLogEntry(`Your resilience grows! Max HP increased to ${gameState.maxHp}!`, 'system');
  }

  setTimeout(nextDistrict, 1500);
}

// Move to next district
function nextDistrict() {
  gameState.district++;
  
  // Advance time (each sector is 1 hour)
  if (gameState.district % 6 === 0) {
    gameState.isNight = !gameState.isNight;
    if (!gameState.isNight) {
      addLogEntry("Day shift begins! Corporate oversight increases.", 'system');
    } else {
      addLogEntry("Night shift begins! Your operational freedom increases.", 'system');
    }
  }

  generateEnemy();
  addLogEntry(`You enter Sector ${gameState.district}. A ${gameState.currentEnemy.name} approaches!`, 'system');
  updateDisplays();
}

// Game over
function gameOver() {
  gameState.gameActive = false;

  const deathMessages = [
    "Your time as a Blade Runner has come to an end.",
    "A replicant counter-attack proved too much for your defenses.",
    "Corporate security forces caught you during a retirement.",
    "You were overwhelmed by superior numbers.",
    "Your systems failed during critical combat operations."
  ];

  deathMessage.textContent = deathMessages[Math.floor(Math.random() * deathMessages.length)];

  // Update final stats
  finalDistrictDisplay.textContent = gameState.district;
  finalLevelDisplay.textContent = gameState.level;
  finalKillsDisplay.textContent = gameState.enemiesDefeated;
  finalComboDisplay.textContent = gameState.highestCombo;
  finalCreditsDisplay.textContent = gameState.credits;

  gameOverPanel.style.display = 'flex';
}

// Inventory functions
function openInventory() {
  inventoryPanel.style.display = 'flex';
  renderInventoryItems();
  selectedItemInfo.style.display = 'none';
  useItemBtn.disabled = true;
  equipItemBtn.disabled = true;
  sellItemBtn.disabled = true;
  gameState.selectedInventoryItem = null;
}

function closeInventory() {
  inventoryPanel.style.display = 'none';
}

function renderInventoryItems() {
  inventoryItemsContainer.innerHTML = '';
  
  gameState.inventory.forEach((item, index) => {
    const itemElement = document.createElement('div');
    itemElement.className = 'inventory-item';
    itemElement.dataset.index = index;
    
    // Set rarity class
    const rarityClass = `rarity-${item.rarity}`;
    
    itemElement.innerHTML = `
      <div class="item-icon">${item.icon || '‚ùì'}</div>
      <div class="item-name">${item.name}</div>
      <div class="item-desc">${item.description}</div>
      ${item.type === 'weapon' ? `<div class="item-stats">${item.minDmg}-${item.maxDmg} DMG</div>` : ''}
      ${item.durability && item.durability !== Infinity ? `<div class="item-stats">Uses: ${item.durability}</div>` : ''}
      <div class="item-price">Value: ${item.value}¬¢</div>
      <div class="item-rarity ${rarityClass}">${item.rarity}</div>
    `;
    
    itemElement.addEventListener('click', () => selectInventoryItem(index));
    inventoryItemsContainer.appendChild(itemElement);
  });
}

function selectInventoryItem(index) {
  gameState.selectedInventoryItem = index;
  const item = gameState.inventory[index];
  
  selectedItemInfo.style.display = 'block';
  selectedItemInfo.innerHTML = `
    <h3>${item.name}</h3>
    <p>${item.description}</p>
    ${item.type === 'weapon' ? `<p>Damage: ${item.minDmg}-${item.maxDmg}</p>` : ''}
    ${item.durability && item.durability !== Infinity ? `<p>Uses remaining: ${item.durability}</p>` : ''}
    <p>Rarity: <span class="rarity-${item.rarity}">${item.rarity}</span></p>
    <p>Value: <span class="item-price">${item.value}¬¢</span></p>
  `;
  
  // Enable appropriate buttons
  useItemBtn.disabled = item.type !== 'consumable';
  equipItemBtn.disabled = item.type !== 'weapon';
  sellItemBtn.disabled = false;
}

function useSelectedItem() {
  if (gameState.selectedInventoryItem === null) return;
  
  const item = gameState.inventory[gameState.selectedInventoryItem];
  
  if (item.type === 'consumable') {
    if (item.name === "Medkit" || item.name === "Advanced Medkit") {
      const healAmount = item.name === "Advanced Medkit" ? 20 : 10;
      const actualHeal = Math.min(healAmount, gameState.maxHp - gameState.currentHp);
      gameState.currentHp += actualHeal;
      addLogEntry(`You use a ${item.name} and heal ${actualHeal} HP!`, 'player');
    } else if (item.name === "Energy Pack" || item.name === "Integrity Booster") {
      const restoreAmount = item.name === "Integrity Booster" ? 50 : 25;
      const actualRestore = Math.min(restoreAmount, gameState.maxIntegrity - gameState.integrity);
      gameState.integrity += actualRestore;
      addLogEntry(`You use an ${item.name} and restore ${actualRestore} Integrity!`, 'player');
    } else if (item.name === "EMP Grenade") {
      if (gameState.currentEnemy && gameState.currentEnemy.weakness === "EMP") {
        gameState.enemyStunned = true;
        addLogEntry(`You throw an EMP Grenade! The ${gameState.currentEnemy.name} is stunned for 1 turn!`, 'player');
      } else {
        addLogEntry(`The EMP Grenade has no effect on this enemy!`, 'player');
      }
    }
    
    // Remove the item from inventory
    gameState.inventory.splice(gameState.selectedInventoryItem, 1);
    inventoryBtn.setAttribute('data-count', gameState.inventory.length);
    
    // Update displays and close inventory
    updateDisplays();
    renderInventoryItems();
    selectedItemInfo.style.display = 'none';
    useItemBtn.disabled = true;
    equipItemBtn.disabled = true;
    sellItemBtn.disabled = true;
    gameState.selectedInventoryItem = null;
  }
}

function equipSelectedItem() {
  if (gameState.selectedInventoryItem === null) return;
  
  const item = gameState.inventory[gameState.selectedInventoryItem];
  
  if (item.type === 'weapon') {
    // Add current weapon back to inventory if it's not the default blaster
    if (gameState.equippedWeapon.name !== "Blaster Pistol") {
      gameState.inventory.push(gameState.equippedWeapon);
    }
    
    // Equip the new weapon
    gameState.equippedWeapon = {...item};
    
    // Remove the equipped item from inventory
    gameState.inventory.splice(gameState.selectedInventoryItem, 1);
    inventoryBtn.setAttribute('data-count', gameState.inventory.length);
    
    addLogEntry(`You equip the ${item.name}!`, 'player');
    
    // Update displays and close inventory
    updateDisplays();
    renderInventoryItems();
    selectedItemInfo.style.display = 'none';
    useItemBtn.disabled = true;
    equipItemBtn.disabled = true;
    sellItemBtn.disabled = true;
    gameState.selectedInventoryItem = null;
  }
}

function sellSelectedItem() {
  if (gameState.selectedInventoryItem === null) return;
  
  const item = gameState.inventory[gameState.selectedInventoryItem];
  const sellValue = Math.floor(item.value * 0.75); // Sell for 75% of value
  
  gameState.credits += sellValue;
  gameState.inventory.splice(gameState.selectedInventoryItem, 1);
  inventoryBtn.setAttribute('data-count', gameState.inventory.length);
  
  addLogEntry(`You sold ${item.name} for ${sellValue} credits!`, 'system');
  
  // Update displays and close inventory
  updateDisplays();
  renderInventoryItems();
  selectedItemInfo.style.display = 'none';
  useItemBtn.disabled = true;
  equipItemBtn.disabled = true;
  sellItemBtn.disabled = true;
  gameState.selectedInventoryItem = null;
}

// Shop functions
function openShop() {
  shopPanel.style.display = 'flex';
  renderShopItems();
  selectedShopItemInfo.style.display = 'none';
  buyItemBtn.disabled = true;
  gameState.selectedShopItem = null;
}

function closeShop() {
  shopPanel.style.display = 'none';
}

function renderShopItems() {
  shopItemsContainer.innerHTML = '';
  
  shopItems.forEach((item, index) => {
    const itemElement = document.createElement('div');
    itemElement.className = 'shop-item';
    itemElement.dataset.index = index;
    
    // Set rarity class
    const rarityClass = `rarity-${item.rarity}`;
    
    itemElement.innerHTML = `
      <div class="item-icon">${item.icon || '‚ùì'}</div>
      <div class="item-name">${item.name}</div>
      <div class="item-desc">${item.description}</div>
      ${item.type === 'weapon' ? `<div class="item-stats">${item.minDmg}-${item.maxDmg} DMG</div>` : ''}
      ${item.durability && item.durability !== Infinity ? `<div class="item-stats">Uses: ${item.durability}</div>` : ''}
      <div class="item-price">Price: ${item.value}¬¢</div>
      <div class="item-rarity ${rarityClass}">${item.rarity}</div>
    `;
    
    itemElement.addEventListener('click', () => selectShopItem(index));
    shopItemsContainer.appendChild(itemElement);
  });
}

function selectShopItem(index) {
  gameState.selectedShopItem = index;
  const item = shopItems[index];
  
  selectedShopItemInfo.style.display = 'block';
  selectedShopItemInfo.innerHTML = `
    <h3>${item.name}</h3>
    <p>${item.description}</p>
    ${item.type === 'weapon' ? `<p>Damage: ${item.minDmg}-${item.maxDmg}</p>` : ''}
    ${item.durability && item.durability !== Infinity ? `<p>Uses: ${item.durability}</p>` : ''}
    <p>Rarity: <span class="rarity-${item.rarity}">${item.rarity}</span></p>
    <p>Price: <span class="item-price">${item.value}¬¢</span></p>
  `;
  
  // Enable buy button if player has enough credits
  buyItemBtn.disabled = gameState.credits < item.value;
}

function buySelectedItem() {
  if (gameState.selectedShopItem === null) return;
  
  const item = shopItems[gameState.selectedShopItem];
  
  if (gameState.credits >= item.value) {
    if (gameState.inventory.length < 10) {
      gameState.credits -= item.value;
      gameState.inventory.push({...item});
      inventoryBtn.setAttribute('data-count', gameState.inventory.length);
      addLogEntry(`You purchased ${item.name}!`, 'system');
      updateDisplays();
      renderShopItems();
      buyItemBtn.disabled = true;
      selectedShopItemInfo.style.display = 'none';
      gameState.selectedShopItem = null;
    } else {
      addLogEntry("Your inventory is full! Cannot buy more items.", 'system');
    }
  } else {
    addLogEntry("Not enough credits to purchase this item!", 'system');
  }
}

// Event listeners
attackBtn.addEventListener('click', playerAttack);
analyzeBtn.addEventListener('click', playerAnalyze);
evadeBtn.addEventListener('click', playerEvade);
specialBtn.addEventListener('click', precisionShot);
restartBtn.addEventListener('click', initGame);
inventoryBtn.addEventListener('click', openInventory);
shopBtn.addEventListener('click', openShop);
closeInventoryBtn.addEventListener('click', closeInventory);
closeShopBtn.addEventListener('click', closeShop);
useItemBtn.addEventListener('click', useSelectedItem);
equipItemBtn.addEventListener('click', equipSelectedItem);
sellItemBtn.addEventListener('click', sellSelectedItem);
buyItemBtn.addEventListener('click', buySelectedItem);

// Start the game
initGame();
</script>
</body>
</html>
