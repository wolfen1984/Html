<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DreadWood: The Moors of Dread</title>
    <style>
        /* EXACT SAME STYLE as previous levels */
        body {
            font-family: 'Courier New', monospace;
            background-color: #0a0a2a;
            color: #33ff33;
            margin: 0;
            padding: 10px;
            line-height: 1.5;
            max-width: 100%;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 10px;
            border: 2px solid #33ff33;
            background-color: #000;
            box-shadow: 0 0 15px rgba(51, 255, 51, 0.5);
            position: relative;
            min-height: calc(100vh - 40px);
        }
        
        .header {
            text-align: center;
            border-bottom: 2px dashed #33ff33;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        h1 {
            color: #ff33ff;
            text-shadow: 0 0 5px #ff33ff;
            font-size: 28px;
            margin: 10px 0;
            letter-spacing: 2px;
        }
        
        h2 {
            color: #33ccff;
            border-bottom: 1px solid #33ccff;
            padding-bottom: 5px;
            margin-top: 25px;
        }
        
        .screen {
            display: none;
        }
        
        .active-screen {
            display: block;
        }
        
        .stats-bar {
            background-color: #111133;
            border: 1px solid #33ff33;
            padding: 10px;
            margin: 15px 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            font-size: 14px;
        }
        
        .stat-item {
            margin: 5px 10px;
        }
        
        .stat-value {
            color: #ffff33;
            font-weight: bold;
        }
        
        .inventory {
            background-color: #111122;
            border: 1px solid #ff33ff;
            padding: 10px;
            margin: 15px 0;
            min-height: 60px;
        }
        
        .inventory-item {
            display: inline-block;
            background-color: #222244;
            border: 1px solid #33ccff;
            padding: 5px 10px;
            margin: 5px;
            border-radius: 3px;
        }
        
        .story-text {
            background-color: #111111;
            border: 1px solid #33ff33;
            padding: 15px;
            margin: 20px 0;
            min-height: 150px;
            overflow-y: auto;
            max-height: 300px;
        }
        
        .choice-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        
        .choice-btn {
            background-color: #222244;
            color: #33ff33;
            border: 2px solid #33ff33;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
        }
        
        .choice-btn:hover, .choice-btn:active {
            background-color: #333366;
            color: #ffff33;
            border-color: #ffff33;
        }
        
        .action-buttons {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-top: 20px;
            gap: 10px;
        }
        
        .action-btn {
            background-color: #330033;
            color: #ff33ff;
            border: 2px solid #ff33ff;
            padding: 10px 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            cursor: pointer;
            flex-grow: 1;
            text-align: center;
        }
        
        .action-btn:hover, .action-btn:active {
            background-color: #550055;
            color: #ff99ff;
        }
        
        .dice-roll {
            background-color: #223322;
            border: 1px solid #33ff33;
            padding: 10px;
            margin: 10px 0;
            text-align: center;
            color: #ffff33;
        }
        
        .game-over {
            color: #ff3333;
            font-weight: bold;
            text-align: center;
            font-size: 24px;
            margin: 20px;
            text-shadow: 0 0 5px #ff3333;
        }
        
        .success {
            color: #33ff33;
            font-weight: bold;
        }
        
        .damage {
            color: #ff3333;
            font-weight: bold;
        }
        
        .enemy {
            color: #ff9933;
            font-weight: bold;
        }
        
        .next-level {
            text-align: center;
            margin-top: 20px;
            padding: 20px;
        }
        
        .next-level-btn {
            background-color: #003333;
            color: #33ff99;
            border: 2px solid #33ff99;
            padding: 15px 30px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .next-level-btn:hover, .next-level-btn:active {
            background-color: #005555;
            color: #99ffcc;
        }
        
        .retro-notice {
            text-align: center;
            color: #888888;
            font-size: 12px;
            margin-top: 20px;
            border-top: 1px solid #333333;
            padding-top: 10px;
        }
        
        .warning-dialog {
            background-color: #332222;
            border: 2px solid #ff3333;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .warning-text {
            color: #ff9933;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .dialog-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .dialog-btn {
            padding: 10px 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            cursor: pointer;
            border: 2px solid;
        }
        
        .dialog-btn-yes {
            background-color: #223322;
            color: #33ff33;
            border-color: #33ff33;
        }
        
        .dialog-btn-no {
            background-color: #332222;
            color: #ff3333;
            border-color: #ff3333;
        }
        
        .moors-decoration {
            color: #9933ff;
            font-style: italic;
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 5px;
            }
            
            h1 {
                font-size: 22px;
            }
            
            .stats-bar {
                font-size: 12px;
            }
            
            .choice-btn {
                padding: 10px;
                font-size: 14px;
            }
            
            .dialog-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>DREADWOOD</h1>
            <h2>THE MOORS OF DREAD</h2>
            <div class="retro-notice">Level 5 - Your Adventure Continues</div>
        </div>
        
        <!-- Game Screen -->
        <div id="screen-game" class="screen active-screen">
            <div class="stats-bar">
                <div class="stat-item">SKILL: <span id="stat-skill" class="stat-value">0</span></div>
                <div class="stat-item">STAMINA: <span id="stat-stamina" class="stat-value">0</span>/<span id="stat-maxstamina" class="stat-value">0</span></div>
                <div class="stat-item">LUCK: <span id="stat-luck" class="stat-value">0</span></div>
                <div class="stat-item">GOLD: <span id="stat-gold" class="stat-value">0</span></div>
            </div>
            
            <h2>INVENTORY</h2>
            <div class="inventory" id="inventory">
                <!-- Inventory will be loaded from saved game -->
            </div>
            
            <h2>THE ADVENTURE</h2>
            <div class="story-text" id="story-text">
                <p>You stand at the edge of the <span class="moors-decoration">MOORS OF DREAD</span>, a desolate wasteland where the very ground seems to whisper of ancient terrors. Thick fog hangs low, obscuring visibility beyond a few yards. Strange lights flicker in the distance, and the air carries the scent of ozone and decay. Your journey through this accursed place begins now...</p>
            </div>
            
            <div class="choice-buttons" id="choice-buttons">
                <button class="choice-btn" onclick="loadSection(1)">Follow the old stone path into the fog</button>
                <button class="choice-btn" onclick="loadSection(2)">Head toward the flickering lights</button>
                <button class="choice-btn" onclick="loadSection(3)">Search for high ground to survey the area</button>
            </div>
            
            <div class="action-buttons">
                <button class="action-btn" onclick="useLuck()">TEST LUCK</button>
                <button class="action-btn" onclick="checkInventory()">INVENTORY</button>
                <button class="action-btn" onclick="useItem()">USE ITEM</button>
                <button class="action-btn" onclick="saveGame()">SAVE GAME</button>
                <button class="action-btn" onclick="showNewGameWarning()">START NEW GAME</button>
            </div>
        </div>
        
        <!-- Warning Dialog for New Game -->
        <div id="warning-dialog" class="screen">
            <div class="warning-dialog">
                <div class="warning-text">WARNING: Starting a new game will delete ALL your current progress!</div>
                <p>Your current character, stats, inventory, and gold will be permanently erased.</p>
                <p>You will return to the beginning of the game to create a new character.</p>
                <div class="dialog-buttons">
                    <button class="dialog-btn dialog-btn-yes" onclick="startNewGame()">YES, START NEW GAME</button>
                    <button class="dialog-btn dialog-btn-no" onclick="cancelNewGame()">NO, KEEP MY CHARACTER</button>
                </div>
            </div>
        </div>
        
        <!-- Next Level Screen -->
        <div id="screen-next" class="screen">
            <h2>VICTORY!</h2>
            <div class="story-text">
                <p>You have survived the <span class="moors-decoration">MOORS OF DREAD</span>!</p>
                <p>After braving the haunted wastes and defeating the spectral guardians, you stand before the gates of the <span class="enemy">NECROPOLIS OF BONES</span>, a city built from the remains of ancient civilizations. Skulls stare blankly from the walls, and the air hums with necromantic energy.</p>
                <p>Your journey continues... All your stats, gold, and inventory will carry over to the next chapter.</p>
                <div class="stats-bar">
                    <div class="stat-item">SKILL: <span id="next-stat-skill" class="stat-value">0</span></div>
                    <div class="stat-item">STAMINA: <span id="next-stat-stamina" class="stat-value">0</span></div>
                    <div class="stat-item">LUCK: <span id="next-stat-luck" class="stat-value">0</span></div>
                    <div class="stat-item">GOLD: <span id="next-stat-gold" class="stat-value">0</span></div>
                </div>
            </div>
            
            <div class="next-level">
                <button class="next-level-btn" onclick="goToNextLevel()">CONTINUE TO NECROPOLIS OF BONES</button>
            </div>
        </div>
        
        <div class="retro-notice">
            DREADWOOD - A Retro Gamebook Adventure<br>
            Level 5: The Moors of Dread
        </div>
    </div>

    <script>
        // Game state (loaded from localStorage)
        let gameState = JSON.parse(localStorage.getItem('dreadwoodGameState')) || {
            playerClass: 'warrior',
            skill: 10,
            maxStamina: 18,
            stamina: 18,
            luck: 10,
            gold: 20,
            inventory: ['Dagger', 'Leather Armor'],
            weapons: [{name: 'Dagger', damage: '1d6'}],
            armor: [{name: 'Leather Armor', defense: 1}],
            currentWeaponIndex: 0,
            currentArmorIndex: 0,
            currentSection: 0,
            gameComplete: false
        };
        
        // Combat state
        let combatState = {
            active: false,
            enemyName: '',
            enemyStamina: 0,
            enemyCurrentStamina: 0,
            enemySkill: 0,
            nextSection: 0,
            round: 1
        };
        
        // Reset currentSection when starting a new level
        // Assuming Level 4 ends at section 300
        if (gameState.currentSection === 300 || gameState.gameComplete) {
            gameState.currentSection = 0;
            gameState.gameComplete = false;
        }
        
        // Ensure indices exist
        if (gameState.currentWeaponIndex === undefined) {
            gameState.currentWeaponIndex = gameState.weapons.length - 1;
        }
        if (gameState.currentArmorIndex === undefined) {
            gameState.currentArmorIndex = gameState.armor.length - 1;
        }
        
        // Level 5 story sections - THE MOORS OF DREAD
        const storySections = {
            0: {
                text: "You stand at the edge of the <span class='moors-decoration'>MOORS OF DREAD</span>, a desolate wasteland where the very ground seems to whisper of ancient terrors. Thick fog hangs low, obscuring visibility beyond a few yards. Strange lights flicker in the distance, and the air carries the scent of ozone and decay. Your journey through this accursed place begins now...",
                choices: [
                    {text: "Follow the old stone path into the fog", nextSection: 1, skillCheck: false},
                    {text: "Head toward the flickering lights", nextSection: 2, skillCheck: false},
                    {text: "Search for high ground to survey the area", nextSection: 3, skillCheck: false}
                ]
            },
            1: {
                text: "You follow the ancient stone path. The stones are slick with moisture, and strange runes are carved into their surfaces. The fog grows thicker, and you hear whispers carried on the wind. Ahead, the path splits around a standing stone covered in glowing moss.",
                choices: [
                    {text: "Examine the standing stone", nextSection: 4, skillCheck: false},
                    {text: "Take the left fork", nextSection: 5, skillCheck: false},
                    {text: "Take the right fork", nextSection: 6, skillCheck: false}
                ]
            },
            2: {
                text: "You head toward the flickering lights. As you approach, you realize they're WILL-O'-THE-MOORS - spectral flames that dance just above the ground. They seem to be leading you somewhere...",
                choices: [
                    {text: "Follow the will-o'-the-moors", nextSection: 7, skillCheck: false},
                    {text: "Try to capture one", nextSection: 8, skillCheck: true, checkType: 'skill', difficulty: 12},
                    {text: "Avoid them and go another way", nextSection: 9, skillCheck: false}
                ]
            },
            3: {
                text: "You search for high ground and find a crumbling watchtower. The stairs are rotten, but you might be able to climb to the top for a better view.",
                choices: [
                    {text: "Climb the watchtower", nextSection: 10, skillCheck: true, checkType: 'skill', difficulty: 11},
                    {text: "Search the base of the tower", nextSection: 11, skillCheck: false},
                    {text: "Continue on the ground", nextSection: 12, skillCheck: false}
                ]
            },
            4: {
                text: "The standing stone radiates cold energy. The glowing moss pulses in rhythm with your heartbeat. The runes on the stone seem to tell a story of a great battle and a fallen king...",
                choices: [
                    {text: "Touch the stone to read more", nextSection: 13, skillCheck: true, checkType: 'luck', difficulty: 10},
                    {text: "Take some glowing moss", nextSection: 14, skillCheck: false},
                    {text: "Leave the stone and continue", nextSection: 15, skillCheck: false}
                ]
            },
            5: {
                text: "The left fork leads through a field of strange, crystalline flowers that hum with energy. In the center of the field, you see a shimmering portal of light.",
                choices: [
                    {text: "Approach the portal", nextSection: 16, skillCheck: false},
                    {text: "Pick some crystalline flowers", nextSection: 17, skillCheck: false},
                    {text: "Avoid the field entirely", nextSection: 18, skillCheck: false}
                ]
            },
            6: {
                text: "The right fork descends into a mist-filled valley. You hear the sound of clanking metal and distant moans. Through the fog, you see spectral warriors locked in eternal combat!",
                choices: [
                    {text: "Try to sneak past the spectral battle", nextSection: 19, skillCheck: true, checkType: 'skill', difficulty: 13},
                    {text: "Join the battle on one side", nextSection: 20, skillCheck: false},
                    {text: "Attempt to dispel the ghosts", nextSection: 21, skillCheck: false}
                ]
            },
            7: {
                text: "The will-o'-the-moors lead you to a circle of ancient standing stones. In the center, a ghostly figure awaits. 'I am the Guardian of the Moors,' it intones. 'Answer my riddle to pass, or face my wrath.'",
                choices: [
                    {text: "Accept the riddle challenge", nextSection: 22, skillCheck: false},
                    {text: "Attack the guardian", nextSection: 23, skillCheck: false},
                    {text: "Try to flee", nextSection: 24, skillCheck: true, checkType: 'luck', difficulty: 11}
                ]
            },
            8: {
                text: "You attempt to capture a will-o'-the-moor...",
                choices: [
                    {text: "Continue", nextSection: 25, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        gameState.inventory.push("Captured Will-o'-Moor");
                        updateInventoryDisplay();
                        return "You successfully capture a will-o'-the-moor! It glows softly in your hand, providing light and warmth.";
                    } else {
                        gameState.stamina -= 4;
                        updateStatsDisplay();
                        return "The will-o'-the-moor burns you with spectral fire! You lose 4 Stamina.";
                    }
                }
            },
            9: {
                text: "You avoid the will-o'-the-moors and find yourself in a quiet glen. A stone well stands in the center, with an old bucket on a rope.",
                choices: [
                    {text: "Look into the well", nextSection: 26, skillCheck: false},
                    {text: "Take the bucket", nextSection: 27, skillCheck: false},
                    {text: "Leave the glen", nextSection: 28, skillCheck: false}
                ]
            },
            10: {
                text: window.checkResult ? 
                    "You carefully climb to the top of the watchtower. From here, you can see the entire moor! You spot three distinct paths leading to what looks like the Necropolis of Bones in the distance." : 
                    "You slip and fall from the rotten stairs! You lose 5 Stamina.",
                choices: [
                    window.checkResult ? 
                        {text: "Head toward the northern path", nextSection: 29, skillCheck: false} :
                        {text: "Search the base of the tower", nextSection: 11, skillCheck: false}
                ],
                action: function() {
                    if (!window.checkResult) {
                        gameState.stamina -= 5;
                        updateStatsDisplay();
                    }
                }
            },
            11: {
                text: "At the base of the watchtower, you find the remains of a previous adventurer. His equipment is mostly ruined, but you find a still-serviceable sword and a journal.",
                choices: [
                    {text: "Take the sword and journal", nextSection: 30, skillCheck: false},
                    {text: "Bury the remains", nextSection: 31, skillCheck: false},
                    {text: "Leave everything", nextSection: 12, skillCheck: false}
                ]
            },
            12: {
                text: "You continue across the moor, the fog swirling around you. You come to a stone bridge spanning a dark chasm. Something moves in the depths below...",
                choices: [
                    {text: "Cross the bridge quickly", nextSection: 32, skillCheck: false},
                    {text: "Investigate the chasm", nextSection: 33, skillCheck: false},
                    {text: "Look for another way across", nextSection: 34, skillCheck: false}
                ]
            },
            13: {
                text: window.checkResult ? 
                    "As you touch the stone, visions flood your mind: The Battle of Mourning Moor, where King Alistair fell to a traitor's blade. The stone reveals the location of his hidden tomb, which contains his enchanted armor!" : 
                    "The stone's energy overwhelms you! You're thrown back, losing 6 Stamina from psychic feedback.",
                choices: [
                    window.checkResult ? 
                        {text: "Head toward the hidden tomb", nextSection: 35, skillCheck: false} :
                        {text: "Leave the stone area", nextSection: 15, skillCheck: false}
                ],
                action: function() {
                    if (!window.checkResult) {
                        gameState.stamina -= 6;
                        updateStatsDisplay();
                    }
                }
            },
            14: {
                text: "You collect some of the glowing moss. It continues to pulse with soft light in your hand.",
                choices: [
                    {text: "Continue on the path", nextSection: 15, skillCheck: false}
                ],
                action: function() {
                    gameState.inventory.push("Glowing Moor Moss");
                    updateInventoryDisplay();
                    return "You take some Glowing Moor Moss. It might be useful for light or healing.";
                }
            },
            15: {
                text: "You continue along the stone path. The fog thickens until you can barely see your own feet. You hear something large moving through the mist nearby...",
                choices: [
                    {text: "Prepare for combat", nextSection: 36, skillCheck: false},
                    {text: "Hide and let it pass", nextSection: 37, skillCheck: true, checkType: 'skill', difficulty: 10},
                    {text: "Call out to it", nextSection: 38, skillCheck: false}
                ]
            },
            16: {
                text: "The portal shimmers with rainbow colors. Through it, you can see a different part of the moor - one without fog. A voice whispers, 'Step through to bypass the dangers...'",
                choices: [
                    {text: "Enter the portal", nextSection: 39, skillCheck: false},
                    {text: "Test it first by throwing something through", nextSection: 40, skillCheck: false},
                    {text: "Destroy the portal", nextSection: 41, skillCheck: false}
                ]
            },
            17: {
                text: "You pick one of the crystalline flowers. It hums in your hand, and you feel a surge of energy!",
                choices: [
                    {text: "Eat the flower", nextSection: 42, skillCheck: false},
                    {text: "Keep it for later", nextSection: 43, skillCheck: false},
                    {text: "Approach the portal", nextSection: 16, skillCheck: false}
                ]
            },
            18: {
                text: "You circle around the field of crystalline flowers. The detour takes you through a patch of quicksand!",
                choices: [
                    {text: "Try to cross carefully", nextSection: 44, skillCheck: true, checkType: 'skill', difficulty: 12},
                    {text: "Look for solid ground", nextSection: 45, skillCheck: false},
                    {text: "Return to the stone path", nextSection: 1, skillCheck: false}
                ]
            },
            19: {
                text: window.checkResult ? 
                    "You successfully sneak past the spectral warriors! Their eternal battle continues as you slip by unnoticed." : 
                    "A spectral warrior spots you and attacks!",
                choices: [
                    window.checkResult ? 
                        {text: "Continue past the battle", nextSection: 46, skillCheck: false} :
                        {text: "Fight the spectral warrior", nextSection: 1901, skillCheck: false}
                ]
            },
            20: {
                text: "You join the spectral battle on the side of the knights in silver armor against dark-clad warriors. Prepare for combat!",
                choices: [
                    {text: "Begin the battle!", nextSection: 2001, skillCheck: false}
                ]
            },
            2001: {
                text: "You face the Dark Spectral Warriors! Roll for the first attack!",
                choices: [
                    {text: "Attack!", nextSection: 2002, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Dark Spectral Warriors";
                    combatState.enemyStamina = 18;
                    combatState.enemyCurrentStamina = 18;
                    combatState.enemySkill = 11;
                    combatState.nextSection = 47;
                    combatState.round = 1;
                    
                    return "Dark Spectral Warriors: Stamina " + combatState.enemyCurrentStamina + ", Skill " + combatState.enemySkill;
                }
            },
            21: {
                text: "You attempt to dispel the ghosts using any holy items or magic you might possess...",
                choices: [
                    {text: "Continue", nextSection: 48, skillCheck: false}
                ],
                action: function() {
                    // Check if player has holy items
                    const holyItems = gameState.inventory.filter(item => 
                        item.includes("Holy") || item.includes("Silver") || item.includes("Light"));
                    
                    if (holyItems.length > 0) {
                        gameState.inventory = gameState.inventory.filter(item => 
                            !(item.includes("Holy") || item.includes("Silver") || item.includes("Light")));
                        updateInventoryDisplay();
                        return "You use your holy items to dispel the ghosts! They fade away with whispers of gratitude.";
                    } else {
                        gameState.stamina -= 8;
                        updateStatsDisplay();
                        return "You lack the holy power to dispel the ghosts! Their negative energy saps your strength, costing 8 Stamina.";
                    }
                }
            },
            22: {
                text: "'I speak without a mouth and hear without ears. I have no body, but I come alive with wind. What am I?' asks the Guardian.",
                choices: [
                    {text: "An echo", nextSection: 49, skillCheck: false},
                    {text: "A ghost", nextSection: 50, skillCheck: false},
                    {text: "Wind", nextSection: 51, skillCheck: false}
                ]
            },
            23: {
                text: "You attack the Guardian of the Moors! Prepare for combat!",
                choices: [
                    {text: "Begin the battle!", nextSection: 2301, skillCheck: false}
                ]
            },
            2301: {
                text: "You face the Guardian of the Moors! Roll for the first attack!",
                choices: [
                    {text: "Attack!", nextSection: 2302, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Guardian of the Moors";
                    combatState.enemyStamina = 22;
                    combatState.enemyCurrentStamina = 22;
                    combatState.enemySkill = 13;
                    combatState.nextSection = 52;
                    combatState.round = 1;
                    
                    return "Guardian of the Moors: Stamina " + combatState.enemyCurrentStamina + ", Skill " + combatState.enemySkill;
                }
            },
            24: {
                text: window.checkResult ? 
                    "You successfully flee from the Guardian! It doesn't pursue beyond its stone circle." : 
                    "The Guardian blocks your escape! 'You cannot flee from fate,' it intones.",
                choices: [
                    window.checkResult ? 
                        {text: "Continue away from the circle", nextSection: 53, skillCheck: false} :
                        {text: "Accept the riddle", nextSection: 22, skillCheck: false}
                ]
            },
            25: {
                text: window.checkResult ? 
                    "With your captured will-o'-the-moor providing light, you can see a safe path through the moor." : 
                    "After your failed attempt, the will-o'-the-moors lead you to a dangerous bog.",
                choices: [
                    window.checkResult ? 
                        {text: "Follow the illuminated path", nextSection: 54, skillCheck: false} :
                        {text: "Navigate the bog carefully", nextSection: 55, skillCheck: false}
                ]
            },
            26: {
                text: "You look into the well. The water at the bottom glows with a soft blue light. Your reflection stares back... and then waves at you!",
                choices: [
                    {text: "Reach into the water", nextSection: 56, skillCheck: false},
                    {text: "Talk to your reflection", nextSection: 57, skillCheck: false},
                    {text: "Back away from the well", nextSection: 58, skillCheck: false}
                ]
            },
            27: {
                text: "You take the bucket. It's old but still sturdy. You could use it to draw water from the well.",
                choices: [
                    {text: "Draw water from the well", nextSection: 59, skillCheck: false},
                    {text: "Keep the bucket and leave", nextSection: 28, skillCheck: false}
                ],
                action: function() {
                    gameState.inventory.push("Old Bucket");
                    updateInventoryDisplay();
                }
            },
            28: {
                text: "You leave the quiet glen and find yourself on a rocky outcropping. Below, you see the ruins of an ancient village.",
                choices: [
                    {text: "Explore the ruined village", nextSection: 60, skillCheck: false},
                    {text: "Continue around the outcropping", nextSection: 61, skillCheck: false}
                ]
            },
            29: {
                text: "You head toward the northern path. It's relatively clear of fog, and you make good progress. You come across a stone marker pointing toward 'The Whispering Cairns'.",
                choices: [
                    {text: "Follow toward the Whispering Cairns", nextSection: 62, skillCheck: false},
                    {text: "Ignore the marker and continue north", nextSection: 63, skillCheck: false}
                ]
            },
            30: {
                text: "You take the adventurer's sword - it's a well-made longsword - and his journal. The journal describes his failed attempt to cross the moor and warns of 'The Howling' that comes at night.",
                choices: [
                    {text: "Continue your journey", nextSection: 12, skillCheck: false}
                ],
                action: function() {
                    gameState.weapons.push({name: 'Adventurer\'s Longsword', damage: '2d4'});
                    gameState.inventory.push("Adventurer's Journal");
                    updateInventoryDisplay();
                    return "You find an Adventurer's Longsword (2d4 damage) and his journal!";
                }
            },
            31: {
                text: "You bury the adventurer's remains properly. As you finish, a warm light surrounds you, and your Luck increases by 2.",
                choices: [
                    {text: "Continue your journey", nextSection: 12, skillCheck: false}
                ],
                action: function() {
                    gameState.luck += 2;
                    updateStatsDisplay();
                }
            },
            32: {
                text: "You cross the bridge quickly. Midway across, tentacles erupt from the chasm below! It's a CHASM CRAWLER!",
                choices: [
                    {text: "Fight the Chasm Crawler", nextSection: 3201, skillCheck: false},
                    {text: "Run to the other side", nextSection: 64, skillCheck: true, checkType: 'skill', difficulty: 12},
                    {text: "Jump off the bridge", nextSection: 65, skillCheck: false}
                ]
            },
            3201: {
                text: "You face the Chasm Crawler! Roll for the first attack!",
                choices: [
                    {text: "Attack!", nextSection: 3202, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Chasm Crawler";
                    combatState.enemyStamina = 20;
                    combatState.enemyCurrentStamina = 20;
                    combatState.enemySkill = 10;
                    combatState.nextSection = 66;
                    combatState.round = 1;
                    
                    return "Chasm Crawler: Stamina " + combatState.enemyCurrentStamina + ", Skill " + combatState.enemySkill;
                }
            },
            33: {
                text: "You peer into the chasm. The darkness seems to peer back. You see glowing eyes staring up at you from the depths.",
                choices: [
                    {text: "Throw a torch or light source down", nextSection: 67, skillCheck: false},
                    {text: "Listen to the sounds from below", nextSection: 68, skillCheck: false},
                    {text: "Back away from the edge", nextSection: 69, skillCheck: false}
                ]
            },
            34: {
                text: "You search for another way across and find a narrow stone ledge that runs along the chasm wall. It looks treacherous but passable.",
                choices: [
                    {text: "Attempt to cross on the ledge", nextSection: 70, skillCheck: true, checkType: 'skill', difficulty: 13},
                    {text: "Return to the bridge", nextSection: 32, skillCheck: false}
                ]
            },
            35: {
                text: "Following the vision from the standing stone, you find King Alistair's hidden tomb. The entrance is sealed with a stone door bearing his crest.",
                choices: [
                    {text: "Try to open the tomb", nextSection: 71, skillCheck: false},
                    {text: "Search for a hidden mechanism", nextSection: 72, skillCheck: true, checkType: 'skill', difficulty: 12},
                    {text: "Leave the tomb undisturbed", nextSection: 73, skillCheck: false}
                ]
            },
            36: {
                text: "You draw your weapon as a massive MOOR BEAST emerges from the fog! It's a hulking creature with glowing eyes and sharp claws.",
                choices: [
                    {text: "Begin the battle!", nextSection: 3601, skillCheck: false}
                ]
            },
            3601: {
                text: "You face the Moor Beast! Roll for the first attack!",
                choices: [
                    {text: "Attack!", nextSection: 3602, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Moor Beast";
                    combatState.enemyStamina = 16;
                    combatState.enemyCurrentStamina = 16;
                    combatState.enemySkill = 9;
                    combatState.nextSection = 74;
                    combatState.round = 1;
                    
                    return "Moor Beast: Stamina " + combatState.enemyCurrentStamina + ", Skill " + combatState.enemySkill;
                }
            },
            37: {
                text: window.checkResult ? 
                    "You hide successfully as the Moor Beast lumbers past without noticing you." : 
                    "The Moor Beast smells you and attacks!",
                choices: [
                    window.checkResult ? 
                        {text: "Continue after it passes", nextSection: 75, skillCheck: false} :
                        {text: "Fight the Moor Beast", nextSection: 3601, skillCheck: false}
                ]
            },
            38: {
                text: "You call out into the fog. The Moor Beast responds with a roar and charges!",
                choices: [
                    {text: "Prepare for battle", nextSection: 3601, skillCheck: false},
                    {text: "Try to calm it", nextSection: 76, skillCheck: true, checkType: 'luck', difficulty: 14},
                    {text: "Run away", nextSection: 77, skillCheck: false}
                ]
            },
            39: {
                text: "You step through the portal and emerge on the other side of the moor, much closer to the Necropolis! However, the portal was a trap set by a MOOR WRAITH!",
                choices: [
                    {text: "Fight the Moor Wraith", nextSection: 3901, skillCheck: false},
                    {text: "Try to reason with it", nextSection: 78, skillCheck: false},
                    {text: "Flee toward the Necropolis", nextSection: 79, skillCheck: true, checkType: 'luck', difficulty: 11}
                ]
            },
            3901: {
                text: "You face the Moor Wraith! Roll for the first attack!",
                choices: [
                    {text: "Attack!", nextSection: 3902, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Moor Wraith";
                    combatState.enemyStamina = 14;
                    combatState.enemyCurrentStamina = 14;
                    combatState.enemySkill = 12;
                    combatState.nextSection = 80;
                    combatState.round = 1;
                    
                    return "Moor Wraith: Stamina " + combatState.enemyCurrentStamina + ", Skill " + combatState.enemySkill;
                }
            },
            40: {
                text: "You throw a rock through the portal. It disappears and doesn't return. The portal seems stable, but you're not sure where it leads.",
                choices: [
                    {text: "Enter the portal", nextSection: 39, skillCheck: false},
                    {text: "Leave it alone", nextSection: 81, skillCheck: false}
                ]
            },
            41: {
                text: "You attack the portal with your weapon. It shatters in a burst of energy, knocking you back! You lose 4 Stamina, but you're free from its influence.",
                choices: [
                    {text: "Continue on your way", nextSection: 81, skillCheck: false}
                ],
                action: function() {
                    gameState.stamina -= 4;
                    updateStatsDisplay();
                }
            },
            42: {
                text: "You eat the crystalline flower. Energy courses through your body!",
                choices: [
                    {text: "Continue", nextSection: 82, skillCheck: false}
                ],
                action: function() {
                    const effect = rollDiceHelper(1, 6);
                    if (effect <= 2) {
                        gameState.stamina += 8;
                        updateStatsDisplay();
                        return "The flower heals you! You regain 8 Stamina.";
                    } else if (effect <= 4) {
                        gameState.skill += 1;
                        updateStatsDisplay();
                        return "The flower sharpens your mind! Your Skill increases by 1.";
                    } else {
                        gameState.luck += 3;
                        updateStatsDisplay();
                        return "The flower makes you feel incredibly lucky! Your Luck increases by 3.";
                    }
                }
            },
            43: {
                text: "You pocket the crystalline flower for later use.",
                choices: [
                    {text: "Approach the portal", nextSection: 16, skillCheck: false}
                ],
                action: function() {
                    gameState.inventory.push("Crystalline Flower");
                    updateInventoryDisplay();
                }
            },
            44: {
                text: window.checkResult ? 
                    "You carefully navigate the quicksand, testing each step before putting your weight down. You make it across safely." : 
                    "You step into quicksand! You lose 7 Stamina struggling free.",
                choices: [
                    {text: "Continue", nextSection: 83, skillCheck: false}
                ],
                action: function() {
                    if (!window.checkResult) {
                        gameState.stamina -= 7;
                        updateStatsDisplay();
                    }
                }
            },
            45: {
                text: "You find a path of solid ground through the quicksand. It takes longer but is safe.",
                choices: [
                    {text: "Continue", nextSection: 83, skillCheck: false}
                ]
            },
            46: {
                text: "You continue past the eternal battle. The fog begins to clear, and you can see the outline of the Necropolis of Bones in the distance!",
                choices: [
                    {text: "Head toward the Necropolis", nextSection: 84, skillCheck: false},
                    {text: "Rest first", nextSection: 85, skillCheck: false}
                ]
            },
            47: {
                text: "After helping the silver knights defeat their foes, their leader approaches you. 'Thank you for your aid, mortal. Take this as reward.' He gives you a silver amulet.",
                choices: [
                    {text: "Take the amulet and continue", nextSection: 46, skillCheck: false}
                ],
                action: function() {
                    gameState.inventory.push("Silver Spectral Amulet");
                    gameState.luck += 2;
                    updateInventoryDisplay();
                    updateStatsDisplay();
                    return "You receive a Silver Spectral Amulet that increases your Luck by 2!";
                }
            },
            48: {
                text: "The ghosts fade away or you escape their grasp. You continue through the valley.",
                choices: [
                    {text: "Continue", nextSection: 46, skillCheck: false}
                ]
            },
            49: {
                text: "'Correct,' says the Guardian. 'You may pass, and take this gift.' It hands you a crystal that glows with inner light.",
                choices: [
                    {text: "Take the crystal and pass", nextSection: 86, skillCheck: false}
                ],
                action: function() {
                    gameState.inventory.push("Guardian's Crystal");
                    updateInventoryDisplay();
                    return "The Guardian gives you a crystal that provides light and protection against spirits.";
                }
            },
            50: {
                text: "'Incorrect,' says the Guardian. 'But I appreciate the creativity. You may pass, but be wary.'",
                choices: [
                    {text: "Pass through the circle", nextSection: 86, skillCheck: false}
                ]
            },
            51: {
                text: "'Incorrect,' says the Guardian. 'Wind has no voice of its own. Prepare to face my wrath!'",
                choices: [
                    {text: "Fight the Guardian", nextSection: 2301, skillCheck: false}
                ]
            },
            52: {
                text: "After defeating the Guardian, the standing stones stop glowing. In the center of the circle, you find a treasure chest!",
                choices: [
                    {text: "Open the chest", nextSection: 87, skillCheck: false},
                    {text: "Leave it and continue", nextSection: 86, skillCheck: false}
                ]
            },
            53: {
                text: "You flee from the stone circle and find yourself in a misty hollow. Strange mushrooms grow here, pulsing with soft light.",
                choices: [
                    {text: "Take some mushrooms", nextSection: 88, skillCheck: false},
                    {text: "Continue through the hollow", nextSection: 89, skillCheck: false}
                ]
            },
            54: {
                text: "The captured will-o'-the-moor illuminates a safe path that avoids all the moor's dangers. You make excellent progress!",
                choices: [
                    {text: "Continue following the safe path", nextSection: 90, skillCheck: false}
                ]
            },
            55: {
                text: "You navigate the bog carefully, but it's slow going. You lose 3 Stamina from the effort and cold.",
                choices: [
                    {text: "Continue", nextSection: 91, skillCheck: false}
                ],
                action: function() {
                    gameState.stamina -= 3;
                    updateStatsDisplay();
                }
            },
            56: {
                text: "You reach into the glowing water. Your hand feels incredibly cold, and when you pull it out, it's covered in silver frost that quickly melts. You gain 2 Skill from the magical water!",
                choices: [
                    {text: "Continue", nextSection: 92, skillCheck: false}
                ],
                action: function() {
                    gameState.skill += 2;
                    updateStatsDisplay();
                }
            },
            57: {
                text: "You talk to your reflection. It speaks back! 'I am the Echo of the Well. Ask me one question about the moor.'",
                choices: [
                    {text: "Ask for the safest path", nextSection: 93, skillCheck: false},
                    {text: "Ask about hidden treasures", nextSection: 94, skillCheck: false},
                    {text: "Ask how to defeat the moor's guardians", nextSection: 95, skillCheck: false}
                ]
            },
            58: {
                text: "You back away from the well. It feels too dangerous to interact with.",
                choices: [
                    {text: "Leave the glen", nextSection: 28, skillCheck: false}
                ]
            },
            59: {
                text: "You draw water from the well. It glows with a soft blue light and feels magical.",
                choices: [
                    {text: "Drink the water", nextSection: 96, skillCheck: false},
                    {text: "Store it for later", nextSection: 97, skillCheck: false},
                    {text: "Pour it back", nextSection: 98, skillCheck: false}
                ]
            },
            60: {
                text: "The ruined village is eerily silent. Buildings have collapsed, and everything is covered in moss. In what was once the town square, you find a stone altar with offerings.",
                choices: [
                    {text: "Examine the altar", nextSection: 99, skillCheck: false},
                    {text: "Search the buildings", nextSection: 100, skillCheck: false},
                    {text: "Leave the village", nextSection: 101, skillCheck: false}
                ]
            },
            61: {
                text: "You continue around the rocky outcropping and find a cave entrance. From within, you hear soft chanting.",
                choices: [
                    {text: "Enter the cave", nextSection: 102, skillCheck: false},
                    {text: "Call into the cave", nextSection: 103, skillCheck: false},
                    {text: "Avoid the cave", nextSection: 104, skillCheck: false}
                ]
            },
            62: {
                text: "You follow the marker to the Whispering Cairns - a field of burial mounds. Voices whisper from the mounds, offering advice, warnings, and sometimes lies.",
                choices: [
                    {text: "Listen to the whispers", nextSection: 105, skillCheck: false},
                    {text: "Search the cairns for treasure", nextSection: 106, skillCheck: true, checkType: 'luck', difficulty: 12},
                    {text: "Leave the cairns", nextSection: 107, skillCheck: false}
                ]
            },
            63: {
                text: "You ignore the marker and continue north. The path becomes steep and rocky, but you eventually reach a high vantage point with a clear view of the Necropolis!",
                choices: [
                    {text: "Continue toward the Necropolis", nextSection: 108, skillCheck: false}
                ]
            },
            64: {
                text: window.checkResult ? 
                    "You sprint across the bridge before the Chasm Crawler can fully emerge. You make it to the other side!" : 
                    "The Chasm Crawler grabs you as you run! You lose 6 Stamina breaking free.",
                choices: [
                    {text: "Continue", nextSection: 109, skillCheck: false}
                ],
                action: function() {
                    if (!window.checkResult) {
                        gameState.stamina -= 6;
                        updateStatsDisplay();
                    }
                }
            },
            65: {
                text: "You jump off the bridge into the chasm! Fortunately, you land in a deep pool of water. You lose 5 Stamina from the impact but survive.",
                choices: [
                    {text: "Swim to shore", nextSection: 110, skillCheck: false}
                ],
                action: function() {
                    gameState.stamina -= 5;
                    updateStatsDisplay();
                }
            },
            66: {
                text: "After defeating the Chasm Crawler, you find its lair contains the remains of previous victims and their equipment.",
                choices: [
                    {text: "Search the lair", nextSection: 111, skillCheck: false},
                    {text: "Continue across the bridge", nextSection: 109, skillCheck: false}
                ]
            },
            67: {
                text: "You throw a light source down the chasm. It illuminates the walls, revealing ancient carvings and a narrow ledge leading to the other side.",
                choices: [
                    {text: "Climb down to the ledge", nextSection: 112, skillCheck: true, checkType: 'skill', difficulty: 12},
                    {text: "Return to the bridge", nextSection: 32, skillCheck: false}
                ]
            },
            68: {
                text: "You listen to the sounds from the chasm. You hear whispering voices that seem to be reciting an ancient poem about the moor's creation.",
                choices: [
                    {text: "Memorize the poem", nextSection: 113, skillCheck: false},
                    {text: "Back away", nextSection: 69, skillCheck: false}
                ]
            },
            69: {
                text: "You back away from the chasm edge and return to the bridge.",
                choices: [
                    {text: "Cross the bridge", nextSection: 32, skillCheck: false}
                ]
            },
            70: {
                text: window.checkResult ? 
                    "You successfully cross on the narrow ledge, avoiding the bridge and its guardian entirely." : 
                    "You slip and fall from the ledge! You lose 8 Stamina from the fall.",
                choices: [
                    {text: "Continue", nextSection: 114, skillCheck: false}
                ],
                action: function() {
                    if (!window.checkResult) {
                        gameState.stamina -= 8;
                        updateStatsDisplay();
                    }
                }
            },
            71: {
                text: "You try to force the tomb door open, but it's sealed with magic. Suddenly, the tomb's guardian - a stone golem - activates!",
                choices: [
                    {text: "Fight the stone golem", nextSection: 7101, skillCheck: false},
                    {text: "Try to find another way in", nextSection: 72, skillCheck: false},
                    {text: "Flee", nextSection: 73, skillCheck: false}
                ]
            },
            7101: {
                text: "You face the Tomb Golem! Roll for the first attack!",
                choices: [
                    {text: "Attack!", nextSection: 7102, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Tomb Golem";
                    combatState.enemyStamina = 24;
                    combatState.enemyCurrentStamina = 24;
                    combatState.enemySkill = 11;
                    combatState.nextSection = 115;
                    combatState.round = 1;
                    
                    return "Tomb Golem: Stamina " + combatState.enemyCurrentStamina + ", Skill " + combatState.enemySkill;
                }
            },
            72: {
                text: window.checkResult ? 
                    "You find a hidden mechanism - pressing the king's crest in a specific pattern opens the door!" : 
                    "You can't find any hidden mechanism. The door remains sealed.",
                choices: [
                    window.checkResult ? 
                        {text: "Enter the tomb", nextSection: 116, skillCheck: false} :
                        {text: "Leave the tomb", nextSection: 73, skillCheck: false}
                ]
            },
            73: {
                text: "You leave the tomb undisturbed and continue across the moor.",
                choices: [
                    {text: "Continue", nextSection: 117, skillCheck: false}
                ]
            },
            74: {
                text: "After defeating the Moor Beast, you notice it was guarding a cave entrance. Inside, you find a cache of supplies.",
                choices: [
                    {text: "Search the cave", nextSection: 118, skillCheck: false},
                    {text: "Continue through the fog", nextSection: 75, skillCheck: false}
                ]
            },
            75: {
                text: "You continue through the fog. It begins to thin, revealing a path lined with strange, twisted trees.",
                choices: [
                    {text: "Follow the tree-lined path", nextSection: 119, skillCheck: false},
                    {text: "Leave the path", nextSection: 120, skillCheck: false}
                ]
            },
            76: {
                text: window.checkResult ? 
                    "You somehow calm the Moor Beast with soothing words and body language. It grunts and lumbers away." : 
                    "Your attempt to calm it fails! It attacks!",
                choices: [
                    window.checkResult ? 
                        {text: "Continue after it leaves", nextSection: 75, skillCheck: false} :
                        {text: "Fight the Moor Beast", nextSection: 3601, skillCheck: false}
                ]
            },
            77: {
                text: "You run from the Moor Beast! It pursues for a while but eventually gives up. You lose 4 Stamina from the exhausting chase.",
                choices: [
                    {text: "Continue", nextSection: 121, skillCheck: false}
                ],
                action: function() {
                    gameState.stamina -= 4;
                    updateStatsDisplay();
                }
            },
            78: {
                text: "'Why have you trapped me?' you ask the Moor Wraith. 'I guard the shortcut,' it replies. 'None may use it without paying a price of 20 Gold.'",
                choices: [
                    {text: "Pay 20 Gold", nextSection: 122, skillCheck: false},
                    {text: "Refuse to pay", nextSection: 123, skillCheck: false},
                    {text: "Attack the wraith", nextSection: 3901, skillCheck: false}
                ]
            },
            79: {
                text: window.checkResult ? 
                    "You successfully flee from the Moor Wraith and make it to the edge of the Necropolis!" : 
                    "The Moor Wraith catches you! You must fight or bargain.",
                choices: [
                    window.checkResult ? 
                        {text: "Enter the Necropolis", nextSection: 200, skillCheck: false} :
                        {text: "Fight the wraith", nextSection: 3901, skillCheck: false}
                ]
            },
            80: {
                text: "After defeating the Moor Wraith, the portal's magic dissipates. You're left at the edge of the Necropolis of Bones.",
                choices: [
                    {text: "Enter the Necropolis", nextSection: 200, skillCheck: false}
                ]
            },
            81: {
                text: "You leave the portal area and continue across the moor. The crystalline flowers fade behind you.",
                choices: [
                    {text: "Continue", nextSection: 124, skillCheck: false}
                ]
            },
            82: {
                text: "The energy from the flower sustains you as you continue across the moor.",
                choices: [
                    {text: "Continue", nextSection: 125, skillCheck: false}
                ]
            },
            83: {
                text: "After navigating the quicksand, you find yourself on solid ground again. The fog has lifted slightly.",
                choices: [
                    {text: "Continue", nextSection: 126, skillCheck: false}
                ]
            },
            84: {
                text: "You head toward the Necropolis of Bones. The ground becomes littered with bones of all sizes. The air grows cold and silent.",
                choices: [
                    {text: "Continue to the Necropolis gates", nextSection: 200, skillCheck: false},
                    {text: "Search the bone fields first", nextSection: 127, skillCheck: false}
                ]
            },
            85: {
                text: "You rest briefly, recovering 5 Stamina.",
                choices: [
                    {text: "Continue toward the Necropolis", nextSection: 84, skillCheck: false}
                ],
                action: function() {
                    gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + 5);
                    updateStatsDisplay();
                }
            },
            86: {
                text: "You pass through the stone circle and continue across the moor. The Guardian's blessing seems to keep the fog at bay.",
                choices: [
                    {text: "Continue", nextSection: 128, skillCheck: false}
                ]
            },
            87: {
                text: "You open the chest and find King Alistair's Armor! It's magical plate armor that provides excellent protection.",
                choices: [
                    {text: "Take the armor and continue", nextSection: 86, skillCheck: false}
                ],
                action: function() {
                    gameState.armor.push({name: 'King Alistair\'s Armor', defense: 4});
                    gameState.currentArmorIndex = gameState.armor.length - 1;
                    updateInventoryDisplay();
                    return "You find King Alistair's Armor (4 DEF)! It's magically lightweight and protective.";
                }
            },
            88: {
                text: "You collect some of the glowing mushrooms. They might have magical properties.",
                choices: [
                    {text: "Continue through the hollow", nextSection: 89, skillCheck: false}
                ],
                action: function() {
                    gameState.inventory.push("Glowing Moor Mushrooms");
                    updateInventoryDisplay();
                }
            },
            89: {
                text: "You continue through the hollow and emerge near a fast-flowing underground river that surfaces here.",
                choices: [
                    {text: "Follow the river", nextSection: 129, skillCheck: false},
                    {text: "Cross the river", nextSection: 130, skillCheck: false}
                ]
            },
            90: {
                text: "The safe path leads you directly to the edge of the Necropolis with minimal danger!",
                choices: [
                    {text: "Enter the Necropolis", nextSection: 200, skillCheck: false}
                ]
            },
            91: {
                text: "After navigating the bog, you reach solid ground. You're exhausted but alive.",
                choices: [
                    {text: "Rest and recover", nextSection: 131, skillCheck: false},
                    {text: "Continue immediately", nextSection: 132, skillCheck: false}
                ]
            },
            92: {
                text: "After interacting with the magical water, you leave the well area.",
                choices: [
                    {text: "Leave the glen", nextSection: 28, skillCheck: false}
                ]
            },
            93: {
                text: "'Follow the path of white stones,' says the Echo. 'They will lead you safely through the moor.'",
                choices: [
                    {text: "Thank the Echo and follow the white stones", nextSection: 133, skillCheck: false}
                ]
            },
            94: {
                text: "'There is great treasure in the tomb of the fallen king,' says the Echo. 'But it is guarded by a stone servant.'",
                choices: [
                    {text: "Thank the Echo and continue", nextSection: 134, skillCheck: false}
                ]
            },
            95: {
                text: "'The guardians fear silver and light,' says the Echo. 'Use these against them.'",
                choices: [
                    {text: "Thank the Echo and continue", nextSection: 134, skillCheck: false}
                ]
            },
            96: {
                text: "You drink the magical well water. It tastes like mint and starlight. You feel rejuvenated and gain 2 Luck!",
                choices: [
                    {text: "Continue", nextSection: 135, skillCheck: false}
                ],
                action: function() {
                    gameState.luck += 2;
                    updateStatsDisplay();
                }
            },
            97: {
                text: "You store the magical water in your waterskin or the bucket.",
                choices: [
                    {text: "Leave the glen", nextSection: 28, skillCheck: false}
                ],
                action: function() {
                    gameState.inventory.push("Magical Well Water");
                    updateInventoryDisplay();
                }
            },
            98: {
                text: "You pour the water back into the well. The glowing intensifies for a moment, then returns to normal.",
                choices: [
                    {text: "Leave the glen", nextSection: 28, skillCheck: false}
                ]
            },
            99: {
                text: "The stone altar has offerings of bones, crystals, and dried flowers. Carved into the altar is a map of the moor showing a safe path.",
                choices: [
                    {text: "Study the map", nextSection: 136, skillCheck: false},
                    {text: "Take an offering", nextSection: 137, skillCheck: false},
                    {text: "Leave the altar", nextSection: 138, skillCheck: false}
                ]
            },
            100: {
                text: "You search the ruined buildings. In one relatively intact house, you find a chest containing 50 Gold and a silver dagger!",
                choices: [
                    {text: "Take the treasure", nextSection: 139, skillCheck: false},
                    {text: "Leave it", nextSection: 138, skillCheck: false}
                ],
                action: function() {
                    gameState.gold += 50;
                    gameState.weapons.push({name: 'Silver Village Dagger', damage: '1d6+2'});
                    updateStatsDisplay();
                    updateInventoryDisplay();
                    return "You find 50 Gold and a Silver Village Dagger (1d6+2 damage against undead)!";
                }
            },
            101: {
                text: "You leave the ruined village and continue across the moor.",
                choices: [
                    {text: "Continue", nextSection: 140, skillCheck: false}
                ]
            },
            102: {
                text: "You enter the cave. Inside, you find a group of MOOR HERMITS performing a ritual. They turn as you enter.",
                choices: [
                    {text: "Greet them peacefully", nextSection: 141, skillCheck: false},
                    {text: "Attack them", nextSection: 142, skillCheck: false},
                    {text: "Back out slowly", nextSection: 143, skillCheck: false}
                ]
            },
            103: {
                text: "You call into the cave. The chanting stops. 'Who disturbs our meditation?' a voice calls back.",
                choices: [
                    {text: "Identify yourself", nextSection: 144, skillCheck: false},
                    {text: "Apologize and leave", nextSection: 143, skillCheck: false}
                ]
            },
            104: {
                text: "You avoid the cave and continue around the outcropping.",
                choices: [
                    {text: "Continue", nextSection: 145, skillCheck: false}
                ]
            },
            105: {
                text: "You listen to the whispers from the cairns. Some offer helpful advice, others try to mislead you. You must discern truth from lies...",
                choices: [
                    {text: "Follow the advice that seems most honest", nextSection: 146, skillCheck: true, checkType: 'luck', difficulty: 11},
                    {text: "Ignore all the whispers", nextSection: 147, skillCheck: false}
                ]
            },
            106: {
                text: window.checkResult ? 
                    "You find a cairn that contains ancient weapons and 40 Gold!" : 
                    "You disturb a cairn and anger the spirit within! It attacks!",
                choices: [
                    window.checkResult ? 
                        {text: "Take the treasure and leave", nextSection: 148, skillCheck: false} :
                        {text: "Fight the angry spirit", nextSection: 10601, skillCheck: false}
                ],
                action: function() {
                    if (window.checkResult) {
                        gameState.gold += 40;
                        gameState.weapons.push({name: 'Ancient Cairn Sword', damage: '2d4'});
                        updateStatsDisplay();
                        updateInventoryDisplay();
                        return "You find 40 Gold and an Ancient Cairn Sword (2d4 damage)!";
                    }
                }
            },
            10601: {
                text: "You face an Angry Cairn Spirit! Roll for the first attack!",
                choices: [
                    {text: "Attack!", nextSection: 10602, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Angry Cairn Spirit";
                    combatState.enemyStamina = 12;
                    combatState.enemyCurrentStamina = 12;
                    combatState.enemySkill = 10;
                    combatState.nextSection = 149;
                    combatState.round = 1;
                    
                    return "Angry Cairn Spirit: Stamina " + combatState.enemyCurrentStamina + ", Skill " + combatState.enemySkill;
                }
            },
            107: {
                text: "You leave the Whispering Cairns and continue your journey.",
                choices: [
                    {text: "Continue", nextSection: 150, skillCheck: false}
                ]
            },
            108: {
                text: "From your high vantage point, you can see the entire path to the Necropolis. You descend and follow it safely.",
                choices: [
                    {text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}
                ]
            },
            109: {
                text: "You've crossed the bridge and continue across the moor. The chasm fades behind you.",
                choices: [
                    {text: "Continue", nextSection: 151, skillCheck: false}
                ]
            },
            110: {
                text: "You swim to shore, soaked and cold. You lose another 2 Stamina from exposure.",
                choices: [
                    {text: "Continue", nextSection: 152, skillCheck: false}
                ],
                action: function() {
                    gameState.stamina -= 2;
                    updateStatsDisplay();
                }
            },
            111: {
                text: "You search the Chasm Crawler's lair and find 60 Gold and a magical chitin shield!",
                choices: [
                    {text: "Take the treasure and continue", nextSection: 109, skillCheck: false}
                ],
                action: function() {
                    gameState.gold += 60;
                    gameState.armor.push({name: 'Chitin Shield', defense: 2});
                    updateStatsDisplay();
                    updateInventoryDisplay();
                    return "You find 60 Gold and a Chitin Shield (2 DEF)!";
                }
            },
            112: {
                text: window.checkResult ? 
                    "You successfully climb down to the ledge and follow it to the other side of the chasm, avoiding the bridge entirely." : 
                    "You slip while climbing! You lose 6 Stamina from the fall.",
                choices: [
                    {text: "Continue", nextSection: 153, skillCheck: false}
                ],
                action: function() {
                    if (!window.checkResult) {
                        gameState.stamina -= 6;
                        updateStatsDisplay();
                    }
                }
            },
            113: {
                text: "You memorize the poem. It seems to be a protective chant against moor spirits. This knowledge might be useful.",
                choices: [
                    {text: "Continue", nextSection: 154, skillCheck: false}
                ],
                action: function() {
                    gameState.inventory.push("Protective Moor Chant");
                    updateInventoryDisplay();
                }
            },
            114: {
                text: "You continue from the chasm, whether you crossed safely or fell.",
                choices: [
                    {text: "Continue", nextSection: 155, skillCheck: false}
                ]
            },
            115: {
                text: "After defeating the Tomb Golem, the tomb door opens. Inside, you find King Alistair's resting place and his treasures!",
                choices: [
                    {text: "Take the treasures", nextSection: 156, skillCheck: false},
                    {text: "Leave the tomb", nextSection: 117, skillCheck: false}
                ]
            },
            116: {
                text: "You enter the tomb and find King Alistair's sarcophagus surrounded by treasure!",
                choices: [
                    {text: "Take the treasures", nextSection: 156, skillCheck: false},
                    {text: "Pay respects and leave", nextSection: 117, skillCheck: false}
                ]
            },
            156: {
                text: "You take King Alistair's treasures: his enchanted armor, his sword, and 100 Gold!",
                choices: [
                    {text: "Leave the tomb", nextSection: 117, skillCheck: false}
                ],
                action: function() {
                    gameState.gold += 100;
                    gameState.armor.push({name: 'King Alistair\'s Armor', defense: 4});
                    gameState.weapons.push({name: 'King Alistair\'s Sword', damage: '2d6'});
                    updateStatsDisplay();
                    updateInventoryDisplay();
                    return "You find 100 Gold, King Alistair's Armor (4 DEF), and King Alistair's Sword (2d6 damage)!";
                }
            },
            117: {
                text: "You leave the tomb area and continue across the moor.",
                choices: [
                    {text: "Continue", nextSection: 157, skillCheck: false}
                ]
            },
            118: {
                text: "In the Moor Beast's cave, you find a nest with 30 Gold and some healing herbs.",
                choices: [
                    {text: "Take the items and continue", nextSection: 75, skillCheck: false}
                ],
                action: function() {
                    gameState.gold += 30;
                    gameState.inventory.push("Healing Herbs");
                    updateStatsDisplay();
                    updateInventoryDisplay();
                    return "You find 30 Gold and Healing Herbs!";
                }
            },
            119: {
                text: "The tree-lined path is eerily quiet. The twisted trees seem to watch you as you pass.",
                choices: [
                    {text: "Continue on the path", nextSection: 158, skillCheck: false},
                    {text: "Leave the path", nextSection: 120, skillCheck: false}
                ]
            },
            120: {
                text: "You leave the tree-lined path and cut across country. The going is rough but direct.",
                choices: [
                    {text: "Continue", nextSection: 159, skillCheck: false}
                ]
            },
            121: {
                text: "After fleeing the Moor Beast, you find yourself in a rocky area with many caves.",
                choices: [
                    {text: "Explore a cave", nextSection: 160, skillCheck: false},
                    {text: "Continue past the caves", nextSection: 161, skillCheck: false}
                ]
            },
            122: {
                text: "You pay the Moor Wraith 20 Gold. 'You may pass,' it says, fading away. You're now at the edge of the Necropolis.",
                choices: [
                    {text: "Enter the Necropolis", nextSection: 200, skillCheck: false}
                ],
                action: function() {
                    if (gameState.gold >= 20) {
                        gameState.gold -= 20;
                        updateStatsDisplay();
                    }
                }
            },
            123: {
                text: "'Then you shall not pass,' says the Moor Wraith, attacking!",
                choices: [
                    {text: "Fight the wraith", nextSection: 3901, skillCheck: false}
                ]
            },
            124: {
                text: "You continue across the moor, leaving the portal area behind.",
                choices: [
                    {text: "Continue", nextSection: 162, skillCheck: false}
                ]
            },
            125: {
                text: "The flower's energy sustains you as you travel. You make excellent progress.",
                choices: [
                    {text: "Continue", nextSection: 163, skillCheck: false}
                ]
            },
            126: {
                text: "After the quicksand, the terrain becomes easier. You can see landmarks in the distance.",
                choices: [
                    {text: "Continue", nextSection: 164, skillCheck: false}
                ]
            },
            127: {
                text: "You search the bone fields. Among the countless bones, you find a few intact skeletons with equipment. One has a magical bone staff!",
                choices: [
                    {text: "Take the staff", nextSection: 165, skillCheck: false},
                    {text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}
                ],
                action: function() {
                    gameState.weapons.push({name: 'Bone Staff of the Moors', damage: '1d6+3'});
                    updateInventoryDisplay();
                    return "You find a Bone Staff of the Moors (1d6+3 damage)! It hums with necromantic energy.";
                }
            },
            128: {
                text: "With the Guardian's blessing, you make quick progress across the moor.",
                choices: [
                    {text: "Continue", nextSection: 166, skillCheck: false}
                ]
            },
            129: {
                text: "You follow the underground river as it surfaces. It leads you through a series of caves that bypass much of the moor's danger.",
                choices: [
                    {text: "Continue following the river", nextSection: 167, skillCheck: false}
                ]
            },
            130: {
                text: "You cross the river. The water is cold and fast, but you make it across, losing 3 Stamina from the effort.",
                choices: [
                    {text: "Continue", nextSection: 168, skillCheck: false}
                ],
                action: function() {
                    gameState.stamina -= 3;
                    updateStatsDisplay();
                }
            },
            131: {
                text: "You rest and recover 6 Stamina.",
                choices: [
                    {text: "Continue", nextSection: 132, skillCheck: false}
                ],
                action: function() {
                    gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + 6);
                    updateStatsDisplay();
                }
            },
            132: {
                text: "You continue across the moor, pushing through your exhaustion.",
                choices: [
                    {text: "Continue", nextSection: 169, skillCheck: false}
                ]
            },
            133: {
                text: "You find the path of white stones and follow it. It leads you safely through the most dangerous parts of the moor.",
                choices: [
                    {text: "Continue following the stones", nextSection: 170, skillCheck: false}
                ]
            },
            134: {
                text: "With the Echo's advice, you continue across the moor, better prepared for its guardians.",
                choices: [
                    {text: "Continue", nextSection: 171, skillCheck: false}
                ]
            },
            135: {
                text: "After drinking the magical water, you leave the well area feeling fortunate.",
                choices: [
                    {text: "Leave the glen", nextSection: 28, skillCheck: false}
                ]
            },
            136: {
                text: "You study the altar map. It shows a safe path to the Necropolis that avoids all major hazards!",
                choices: [
                    {text: "Follow the safe path", nextSection: 172, skillCheck: false},
                    {text: "Take an offering", nextSection: 137, skillCheck: false}
                ]
            },
            137: {
                text: "You take one of the offerings - a crystal that glows with soft light.",
                choices: [
                    {text: "Leave the altar", nextSection: 138, skillCheck: false}
                ],
                action: function() {
                    gameState.inventory.push("Altar Crystal");
                    updateInventoryDisplay();
                }
            },
            138: {
                text: "You leave the altar and continue exploring the village or leave entirely.",
                choices: [
                    {text: "Search the buildings", nextSection: 100, skillCheck: false},
                    {text: "Leave the village", nextSection: 101, skillCheck: false}
                ]
            },
            139: {
                text: "With your newfound treasure, you continue through the ruined village.",
                choices: [
                    {text: "Leave the village", nextSection: 101, skillCheck: false}
                ]
            },
            140: {
                text: "You leave the village behind and continue across the moor.",
                choices: [
                    {text: "Continue", nextSection: 173, skillCheck: false}
                ]
            },
            141: {
                text: "'Peace be with you, traveler,' says the lead hermit. 'We meditate to keep the moor's darkest energies at bay. Can you help us?'",
                choices: [
                    {text: "Offer to help", nextSection: 174, skillCheck: false},
                    {text: "Ask for help instead", nextSection: 175, skillCheck: false},
                    {text: "Attack them", nextSection: 142, skillCheck: false}
                ]
            },
            142: {
                text: "You attack the Moor Hermits! Prepare for combat!",
                choices: [
                    {text: "Begin the battle!", nextSection: 14201, skillCheck: false}
                ]
            },
            14201: {
                text: "You face the Moor Hermits! Roll for the first attack!",
                choices: [
                    {text: "Attack!", nextSection: 14202, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Moor Hermits";
                    combatState.enemyStamina = 18;
                    combatState.enemyCurrentStamina = 18;
                    combatState.enemySkill = 8;
                    combatState.nextSection = 176;
                    combatState.round = 1;
                    
                    return "Moor Hermits: Stamina " + combatState.enemyCurrentStamina + ", Skill " + combatState.enemySkill;
                }
            },
            143: {
                text: "You back out of the cave slowly. The hermits resume their chanting.",
                choices: [
                    {text: "Continue around the outcropping", nextSection: 145, skillCheck: false}
                ]
            },
            144: {
                text: "'I am a traveler seeking passage to the Necropolis,' you say. 'We can guide you,' says a hermit. 'For a donation to our order.'",
                choices: [
                    {text: "Pay 15 Gold for guidance", nextSection: 177, skillCheck: false},
                    {text: "Refuse to pay", nextSection: 178, skillCheck: false}
                ]
            },
            145: {
                text: "You continue around the rocky outcropping, leaving the cave behind.",
                choices: [
                    {text: "Continue", nextSection: 179, skillCheck: false}
                ]
            },
            146: {
                text: window.checkResult ? 
                    "You follow honest advice that leads you safely through the cairns and beyond." : 
                    "You follow misleading advice that leads you into a trap!",
                choices: [
                    window.checkResult ? 
                        {text: "Continue safely", nextSection: 180, skillCheck: false} :
                        {text: "Face the trap", nextSection: 181, skillCheck: false}
                ]
            },
            147: {
                text: "You ignore all the whispers and navigate the cairns on your own. It's difficult but you manage.",
                choices: [
                    {text: "Continue", nextSection: 182, skillCheck: false}
                ]
            },
            148: {
                text: "With your newfound treasure, you leave the Whispering Cairns.",
                choices: [
                    {text: "Continue", nextSection: 150, skillCheck: false}
                ]
            },
            149: {
                text: "After defeating the Angry Cairn Spirit, the other cairns fall silent. You can pass safely.",
                choices: [
                    {text: "Continue", nextSection: 150, skillCheck: false}
                ]
            },
            150: {
                text: "You leave the Whispering Cairns behind and continue across the moor.",
                choices: [
                    {text: "Continue", nextSection: 183, skillCheck: false}
                ]
            },
            // Combat sections (for all combat encounters)
            1901: {
                text: "You face a Spectral Warrior! Roll for the first attack!",
                choices: [
                    {text: "Attack!", nextSection: 1902, skillCheck: false}
                ],
                action: function() {
                    combatState.active = true;
                    combatState.enemyName = "Spectral Warrior";
                    combatState.enemyStamina = 10;
                    combatState.enemyCurrentStamina = 10;
                    combatState.enemySkill = 9;
                    combatState.nextSection = 184;
                    combatState.round = 1;
                    
                    return "Spectral Warrior: Stamina " + combatState.enemyCurrentStamina + ", Skill " + combatState.enemySkill;
                }
            },
            2002: { text: "", choices: [{text: "Continue the fight!", nextSection: 2003, skillCheck: false}] },
            2003: { text: "", choices: [{text: "Continue the fight!", nextSection: 2002, skillCheck: false}] },
            2302: { text: "", choices: [{text: "Continue the fight!", nextSection: 2303, skillCheck: false}] },
            2303: { text: "", choices: [{text: "Continue the fight!", nextSection: 2302, skillCheck: false}] },
            3202: { text: "", choices: [{text: "Continue the fight!", nextSection: 3203, skillCheck: false}] },
            3203: { text: "", choices: [{text: "Continue the fight!", nextSection: 3202, skillCheck: false}] },
            3602: { text: "", choices: [{text: "Continue the fight!", nextSection: 3603, skillCheck: false}] },
            3603: { text: "", choices: [{text: "Continue the fight!", nextSection: 3602, skillCheck: false}] },
            3902: { text: "", choices: [{text: "Continue the fight!", nextSection: 3903, skillCheck: false}] },
            3903: { text: "", choices: [{text: "Continue the fight!", nextSection: 3902, skillCheck: false}] },
            7102: { text: "", choices: [{text: "Continue the fight!", nextSection: 7103, skillCheck: false}] },
            7103: { text: "", choices: [{text: "Continue the fight!", nextSection: 7102, skillCheck: false}] },
            10602: { text: "", choices: [{text: "Continue the fight!", nextSection: 10603, skillCheck: false}] },
            10603: { text: "", choices: [{text: "Continue the fight!", nextSection: 10602, skillCheck: false}] },
            14202: { text: "", choices: [{text: "Continue the fight!", nextSection: 14203, skillCheck: false}] },
            14203: { text: "", choices: [{text: "Continue the fight!", nextSection: 14202, skillCheck: false}] },
            1902: { text: "", choices: [{text: "Continue the fight!", nextSection: 1903, skillCheck: false}] },
            1903: { text: "", choices: [{text: "Continue the fight!", nextSection: 1902, skillCheck: false}] },
            
            // VICTORY SECTION - Player completes the level
            200: {
                text: "You have successfully navigated the <span class='moors-decoration'>MOORS OF DREAD</span>! Whether through combat, cunning, or diplomacy, you've survived one of the most haunted regions in Dreadwood. Before you rise the gates of the <span class='enemy'>NECROPOLIS OF BONES</span>, your next challenge. The air grows colder as you approach, and the ground is littered with bones of all shapes and sizes.",
                choices: [],
                action: function() {
                    gameState.gameComplete = true;
                    showScreen('screen-next');
                    document.getElementById('next-stat-skill').textContent = gameState.skill;
                    document.getElementById('next-stat-stamina').textContent = gameState.stamina;
                    document.getElementById('next-stat-luck').textContent = gameState.luck;
                    document.getElementById('next-stat-gold').textContent = gameState.gold;
                    return "You've completed Level 5: The Moors of Dread! Your journey continues to the Necropolis of Bones...";
                }
            },
            // Additional sections for completeness (simplified)
            151: { text: "You continue across the moor.", choices: [{text: "Continue", nextSection: 185, skillCheck: false}] },
            152: { text: "You continue, soaked but alive.", choices: [{text: "Continue", nextSection: 186, skillCheck: false}] },
            153: { text: "You continue from the chasm.", choices: [{text: "Continue", nextSection: 187, skillCheck: false}] },
            154: { text: "You continue with the protective chant in mind.", choices: [{text: "Continue", nextSection: 188, skillCheck: false}] },
            155: { text: "You continue across the moor.", choices: [{text: "Continue", nextSection: 189, skillCheck: false}] },
            157: { text: "You continue across the moor.", choices: [{text: "Continue", nextSection: 190, skillCheck: false}] },
            158: { text: "You continue on the tree-lined path.", choices: [{text: "Continue", nextSection: 191, skillCheck: false}] },
            159: { text: "You continue across country.", choices: [{text: "Continue", nextSection: 192, skillCheck: false}] },
            160: { text: "You explore a cave and find 20 Gold.", choices: [{text: "Continue", nextSection: 193, skillCheck: false}], action: function() { gameState.gold += 20; updateStatsDisplay(); }},
            161: { text: "You continue past the caves.", choices: [{text: "Continue", nextSection: 194, skillCheck: false}] },
            162: { text: "You continue across the moor.", choices: [{text: "Continue", nextSection: 195, skillCheck: false}] },
            163: { text: "You continue with sustained energy.", choices: [{text: "Continue", nextSection: 196, skillCheck: false}] },
            164: { text: "You continue, seeing landmarks.", choices: [{text: "Continue", nextSection: 197, skillCheck: false}] },
            165: { text: "With the bone staff, you continue.", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            166: { text: "You continue with the Guardian's blessing.", choices: [{text: "Continue", nextSection: 198, skillCheck: false}] },
            167: { text: "You follow the river through caves.", choices: [{text: "Continue", nextSection: 199, skillCheck: false}] },
            168: { text: "You continue after crossing the river.", choices: [{text: "Continue", nextSection: 201, skillCheck: false}] },
            169: { text: "You continue, pushing through exhaustion.", choices: [{text: "Continue", nextSection: 202, skillCheck: false}] },
            170: { text: "You follow the white stones safely.", choices: [{text: "Continue", nextSection: 203, skillCheck: false}] },
            171: { text: "You continue with the Echo's advice.", choices: [{text: "Continue", nextSection: 204, skillCheck: false}] },
            172: { text: "You follow the altar map's safe path.", choices: [{text: "Continue", nextSection: 205, skillCheck: false}] },
            173: { text: "You continue across the moor.", choices: [{text: "Continue", nextSection: 206, skillCheck: false}] },
            174: { text: "You help the hermits and they reward you with a protective amulet.", choices: [{text: "Continue", nextSection: 207, skillCheck: false}], action: function() { gameState.inventory.push("Hermit's Amulet"); updateInventoryDisplay(); }},
            175: { text: "The hermits give you directions for free.", choices: [{text: "Continue", nextSection: 208, skillCheck: false}] },
            176: { text: "After defeating the hermits, you find their supplies.", choices: [{text: "Continue", nextSection: 209, skillCheck: false}], action: function() { gameState.gold += 25; updateStatsDisplay(); }},
            177: { text: "The hermits guide you safely partway.", choices: [{text: "Continue", nextSection: 210, skillCheck: false}], action: function() { if(gameState.gold >= 15) { gameState.gold -= 15; updateStatsDisplay(); } }},
            178: { text: "You refuse to pay and leave.", choices: [{text: "Continue", nextSection: 211, skillCheck: false}] },
            179: { text: "You continue around the outcropping.", choices: [{text: "Continue", nextSection: 212, skillCheck: false}] },
            180: { text: "You continue safely.", choices: [{text: "Continue", nextSection: 213, skillCheck: false}] },
            181: { text: "You face a trap but survive, losing 5 Stamina.", choices: [{text: "Continue", nextSection: 214, skillCheck: false}], action: function() { gameState.stamina -= 5; updateStatsDisplay(); }},
            182: { text: "You continue on your own.", choices: [{text: "Continue", nextSection: 215, skillCheck: false}] },
            183: { text: "You continue across the moor.", choices: [{text: "Continue", nextSection: 216, skillCheck: false}] },
            184: { text: "After defeating the Spectral Warrior, you continue.", choices: [{text: "Continue", nextSection: 217, skillCheck: false}] },
            185: { text: "You continue toward the Necropolis.", choices: [{text: "Continue", nextSection: 218, skillCheck: false}] },
            186: { text: "You continue, drying off slowly.", choices: [{text: "Continue", nextSection: 219, skillCheck: false}] },
            187: { text: "You continue from the chasm.", choices: [{text: "Continue", nextSection: 220, skillCheck: false}] },
            188: { text: "You continue, chanting quietly.", choices: [{text: "Continue", nextSection: 221, skillCheck: false}] },
            189: { text: "You continue across the moor.", choices: [{text: "Continue", nextSection: 222, skillCheck: false}] },
            190: { text: "You continue across the moor.", choices: [{text: "Continue", nextSection: 223, skillCheck: false}] },
            191: { text: "You continue on the path.", choices: [{text: "Continue", nextSection: 224, skillCheck: false}] },
            192: { text: "You continue across country.", choices: [{text: "Continue", nextSection: 225, skillCheck: false}] },
            193: { text: "You continue from the cave.", choices: [{text: "Continue", nextSection: 226, skillCheck: false}] },
            194: { text: "You continue past the caves.", choices: [{text: "Continue", nextSection: 227, skillCheck: false}] },
            195: { text: "You continue across the moor.", choices: [{text: "Continue", nextSection: 228, skillCheck: false}] },
            196: { text: "You continue with sustained energy.", choices: [{text: "Continue", nextSection: 229, skillCheck: false}] },
            197: { text: "You continue toward landmarks.", choices: [{text: "Continue", nextSection: 230, skillCheck: false}] },
            198: { text: "You continue with the blessing.", choices: [{text: "Continue", nextSection: 231, skillCheck: false}] },
            199: { text: "You continue through the caves.", choices: [{text: "Continue", nextSection: 232, skillCheck: false}] },
            201: { text: "You continue after the river.", choices: [{text: "Continue", nextSection: 233, skillCheck: false}] },
            202: { text: "You continue, exhausted.", choices: [{text: "Continue", nextSection: 234, skillCheck: false}] },
            203: { text: "You follow the white stones.", choices: [{text: "Continue", nextSection: 235, skillCheck: false}] },
            204: { text: "You continue with good advice.", choices: [{text: "Continue", nextSection: 236, skillCheck: false}] },
            205: { text: "You follow the safe path.", choices: [{text: "Continue", nextSection: 237, skillCheck: false}] },
            206: { text: "You continue across the moor.", choices: [{text: "Continue", nextSection: 238, skillCheck: false}] },
            207: { text: "You continue with the amulet.", choices: [{text: "Continue", nextSection: 239, skillCheck: false}] },
            208: { text: "You continue with the hermits' directions.", choices: [{text: "Continue", nextSection: 240, skillCheck: false}] },
            209: { text: "You continue with the hermits' supplies.", choices: [{text: "Continue", nextSection: 241, skillCheck: false}] },
            210: { text: "You continue with the hermits' guidance.", choices: [{text: "Continue", nextSection: 242, skillCheck: false}] },
            211: { text: "You continue on your own.", choices: [{text: "Continue", nextSection: 243, skillCheck: false}] },
            212: { text: "You continue around the outcropping.", choices: [{text: "Continue", nextSection: 244, skillCheck: false}] },
            213: { text: "You continue safely.", choices: [{text: "Continue", nextSection: 245, skillCheck: false}] },
            214: { text: "You continue after the trap.", choices: [{text: "Continue", nextSection: 246, skillCheck: false}] },
            215: { text: "You continue on your own.", choices: [{text: "Continue", nextSection: 247, skillCheck: false}] },
            216: { text: "You continue across the moor.", choices: [{text: "Continue", nextSection: 248, skillCheck: false}] },
            217: { text: "You continue after the spectral battle.", choices: [{text: "Continue", nextSection: 249, skillCheck: false}] },
            218: { text: "You continue toward the Necropolis.", choices: [{text: "Continue", nextSection: 250, skillCheck: false}] },
            219: { text: "You continue, drying off.", choices: [{text: "Continue", nextSection: 251, skillCheck: false}] },
            220: { text: "You continue from the chasm.", choices: [{text: "Continue", nextSection: 252, skillCheck: false}] },
            221: { text: "You continue, chanting.", choices: [{text: "Continue", nextSection: 253, skillCheck: false}] },
            222: { text: "You continue across the moor.", choices: [{text: "Continue", nextSection: 254, skillCheck: false}] },
            223: { text: "You continue across the moor.", choices: [{text: "Continue", nextSection: 255, skillCheck: false}] },
            224: { text: "You continue on the path.", choices: [{text: "Continue", nextSection: 256, skillCheck: false}] },
            225: { text: "You continue across country.", choices: [{text: "Continue", nextSection: 257, skillCheck: false}] },
            226: { text: "You continue from the cave.", choices: [{text: "Continue", nextSection: 258, skillCheck: false}] },
            227: { text: "You continue past the caves.", choices: [{text: "Continue", nextSection: 259, skillCheck: false}] },
            228: { text: "You continue across the moor.", choices: [{text: "Continue", nextSection: 260, skillCheck: false}] },
            229: { text: "You continue with energy.", choices: [{text: "Continue", nextSection: 261, skillCheck: false}] },
            230: { text: "You continue toward landmarks.", choices: [{text: "Continue", nextSection: 262, skillCheck: false}] },
            231: { text: "You continue with the blessing.", choices: [{text: "Continue", nextSection: 263, skillCheck: false}] },
            232: { text: "You continue through caves.", choices: [{text: "Continue", nextSection: 264, skillCheck: false}] },
            233: { text: "You continue after the river.", choices: [{text: "Continue", nextSection: 265, skillCheck: false}] },
            234: { text: "You continue, exhausted.", choices: [{text: "Continue", nextSection: 266, skillCheck: false}] },
            235: { text: "You follow the white stones.", choices: [{text: "Continue", nextSection: 267, skillCheck: false}] },
            236: { text: "You continue with advice.", choices: [{text: "Continue", nextSection: 268, skillCheck: false}] },
            237: { text: "You follow the safe path.", choices: [{text: "Continue", nextSection: 269, skillCheck: false}] },
            238: { text: "You continue across the moor.", choices: [{text: "Continue", nextSection: 270, skillCheck: false}] },
            239: { text: "You continue with the amulet.", choices: [{text: "Continue", nextSection: 271, skillCheck: false}] },
            240: { text: "You continue with directions.", choices: [{text: "Continue", nextSection: 272, skillCheck: false}] },
            241: { text: "You continue with supplies.", choices: [{text: "Continue", nextSection: 273, skillCheck: false}] },
            242: { text: "You continue with guidance.", choices: [{text: "Continue", nextSection: 274, skillCheck: false}] },
            243: { text: "You continue on your own.", choices: [{text: "Continue", nextSection: 275, skillCheck: false}] },
            244: { text: "You continue around the outcropping.", choices: [{text: "Continue", nextSection: 276, skillCheck: false}] },
            245: { text: "You continue safely.", choices: [{text: "Continue", nextSection: 277, skillCheck: false}] },
            246: { text: "You continue after the trap.", choices: [{text: "Continue", nextSection: 278, skillCheck: false}] },
            247: { text: "You continue on your own.", choices: [{text: "Continue", nextSection: 279, skillCheck: false}] },
            248: { text: "You continue across the moor.", choices: [{text: "Continue", nextSection: 280, skillCheck: false}] },
            249: { text: "You continue after the battle.", choices: [{text: "Continue", nextSection: 281, skillCheck: false}] },
            250: { text: "You continue toward the Necropolis.", choices: [{text: "Continue", nextSection: 282, skillCheck: false}] },
            251: { text: "You continue, drying.", choices: [{text: "Continue", nextSection: 283, skillCheck: false}] },
            252: { text: "You continue from the chasm.", choices: [{text: "Continue", nextSection: 284, skillCheck: false}] },
            253: { text: "You continue, chanting.", choices: [{text: "Continue", nextSection: 285, skillCheck: false}] },
            254: { text: "You continue across the moor.", choices: [{text: "Continue", nextSection: 286, skillCheck: false}] },
            255: { text: "You continue across the moor.", choices: [{text: "Continue", nextSection: 287, skillCheck: false}] },
            256: { text: "You continue on the path.", choices: [{text: "Continue", nextSection: 288, skillCheck: false}] },
            257: { text: "You continue across country.", choices: [{text: "Continue", nextSection: 289, skillCheck: false}] },
            258: { text: "You continue from the cave.", choices: [{text: "Continue", nextSection: 290, skillCheck: false}] },
            259: { text: "You continue past the caves.", choices: [{text: "Continue", nextSection: 291, skillCheck: false}] },
            260: { text: "You continue across the moor.", choices: [{text: "Continue", nextSection: 292, skillCheck: false}] },
            261: { text: "You continue with energy.", choices: [{text: "Continue", nextSection: 293, skillCheck: false}] },
            262: { text: "You continue toward landmarks.", choices: [{text: "Continue", nextSection: 294, skillCheck: false}] },
            263: { text: "You continue with the blessing.", choices: [{text: "Continue", nextSection: 295, skillCheck: false}] },
            264: { text: "You continue through caves.", choices: [{text: "Continue", nextSection: 296, skillCheck: false}] },
            265: { text: "You continue after the river.", choices: [{text: "Continue", nextSection: 297, skillCheck: false}] },
            266: { text: "You continue, exhausted.", choices: [{text: "Continue", nextSection: 298, skillCheck: false}] },
            267: { text: "You follow the white stones.", choices: [{text: "Continue", nextSection: 299, skillCheck: false}] },
            268: { text: "You continue with advice.", choices: [{text: "Continue", nextSection: 300, skillCheck: false}] },
            269: { text: "You follow the safe path.", choices: [{text: "Continue", nextSection: 301, skillCheck: false}] },
            270: { text: "You continue across the moor.", choices: [{text: "Continue", nextSection: 302, skillCheck: false}] },
            271: { text: "You continue with the amulet.", choices: [{text: "Continue", nextSection: 303, skillCheck: false}] },
            272: { text: "You continue with directions.", choices: [{text: "Continue", nextSection: 304, skillCheck: false}] },
            273: { text: "You continue with supplies.", choices: [{text: "Continue", nextSection: 305, skillCheck: false}] },
            274: { text: "You continue with guidance.", choices: [{text: "Continue", nextSection: 306, skillCheck: false}] },
            275: { text: "You continue on your own.", choices: [{text: "Continue", nextSection: 307, skillCheck: false}] },
            276: { text: "You continue around the outcropping.", choices: [{text: "Continue", nextSection: 308, skillCheck: false}] },
            277: { text: "You continue safely.", choices: [{text: "Continue", nextSection: 309, skillCheck: false}] },
            278: { text: "You continue after the trap.", choices: [{text: "Continue", nextSection: 310, skillCheck: false}] },
            279: { text: "You continue on your own.", choices: [{text: "Continue", nextSection: 311, skillCheck: false}] },
            280: { text: "You continue across the moor.", choices: [{text: "Continue", nextSection: 312, skillCheck: false}] },
            281: { text: "You continue after the battle.", choices: [{text: "Continue", nextSection: 313, skillCheck: false}] },
            282: { text: "You continue toward the Necropolis.", choices: [{text: "Continue", nextSection: 314, skillCheck: false}] },
            283: { text: "You continue, drying.", choices: [{text: "Continue", nextSection: 315, skillCheck: false}] },
            284: { text: "You continue from the chasm.", choices: [{text: "Continue", nextSection: 316, skillCheck: false}] },
            285: { text: "You continue, chanting.", choices: [{text: "Continue", nextSection: 317, skillCheck: false}] },
            286: { text: "You continue across the moor.", choices: [{text: "Continue", nextSection: 318, skillCheck: false}] },
            287: { text: "You continue across the moor.", choices: [{text: "Continue", nextSection: 319, skillCheck: false}] },
            288: { text: "You continue on the path.", choices: [{text: "Continue", nextSection: 320, skillCheck: false}] },
            289: { text: "You continue across country.", choices: [{text: "Continue", nextSection: 321, skillCheck: false}] },
            290: { text: "You continue from the cave.", choices: [{text: "Continue", nextSection: 322, skillCheck: false}] },
            291: { text: "You continue past the caves.", choices: [{text: "Continue", nextSection: 323, skillCheck: false}] },
            292: { text: "You continue across the moor.", choices: [{text: "Continue", nextSection: 324, skillCheck: false}] },
            293: { text: "You continue with energy.", choices: [{text: "Continue", nextSection: 325, skillCheck: false}] },
            294: { text: "You continue toward landmarks.", choices: [{text: "Continue", nextSection: 326, skillCheck: false}] },
            295: { text: "You continue with the blessing.", choices: [{text: "Continue", nextSection: 327, skillCheck: false}] },
            296: { text: "You continue through caves.", choices: [{text: "Continue", nextSection: 328, skillCheck: false}] },
            297: { text: "You continue after the river.", choices: [{text: "Continue", nextSection: 329, skillCheck: false}] },
            298: { text: "You continue, exhausted.", choices: [{text: "Continue", nextSection: 330, skillCheck: false}] },
            299: { text: "You follow the white stones.", choices: [{text: "Continue", nextSection: 331, skillCheck: false}] },
            300: { text: "You continue with advice.", choices: [{text: "Continue", nextSection: 332, skillCheck: false}] },
            301: { text: "You follow the safe path.", choices: [{text: "Continue", nextSection: 333, skillCheck: false}] },
            302: { text: "You continue across the moor.", choices: [{text: "Continue", nextSection: 334, skillCheck: false}] },
            303: { text: "You continue with the amulet.", choices: [{text: "Continue", nextSection: 335, skillCheck: false}] },
            304: { text: "You continue with directions.", choices: [{text: "Continue", nextSection: 336, skillCheck: false}] },
            305: { text: "You continue with supplies.", choices: [{text: "Continue", nextSection: 337, skillCheck: false}] },
            306: { text: "You continue with guidance.", choices: [{text: "Continue", nextSection: 338, skillCheck: false}] },
            307: { text: "You continue on your own.", choices: [{text: "Continue", nextSection: 339, skillCheck: false}] },
            308: { text: "You continue around the outcropping.", choices: [{text: "Continue", nextSection: 340, skillCheck: false}] },
            309: { text: "You continue safely.", choices: [{text: "Continue", nextSection: 341, skillCheck: false}] },
            310: { text: "You continue after the trap.", choices: [{text: "Continue", nextSection: 342, skillCheck: false}] },
            311: { text: "You continue on your own.", choices: [{text: "Continue", nextSection: 343, skillCheck: false}] },
            312: { text: "You continue across the moor.", choices: [{text: "Continue", nextSection: 344, skillCheck: false}] },
            313: { text: "You continue after the battle.", choices: [{text: "Continue", nextSection: 345, skillCheck: false}] },
            314: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            315: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            316: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            317: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            318: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            319: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            320: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            321: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            322: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            323: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            324: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            325: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            326: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            327: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            328: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            329: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            330: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            331: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            332: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            333: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            334: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            335: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            336: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            337: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            338: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            339: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            340: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            341: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            342: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            343: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            344: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] },
            345: { text: "You can see the Necropolis ahead!", choices: [{text: "Continue to the Necropolis", nextSection: 200, skillCheck: false}] }
        };

        // Initialize game
        function initGame() {
            updateStatsDisplay();
            updateInventoryDisplay();
            
            if (gameState.currentSection > 0) {
                loadSection(gameState.currentSection);
            } else {
                loadSection(0);
            }
        }
        
        // Show warning dialog for new game
        function showNewGameWarning() {
            document.getElementById('screen-game').classList.remove('active-screen');
            document.getElementById('warning-dialog').classList.add('active-screen');
        }
        
        // Cancel new game and return to game screen
        function cancelNewGame() {
            document.getElementById('warning-dialog').classList.remove('active-screen');
            document.getElementById('screen-game').classList.add('active-screen');
        }
        
        // Start new game - reset everything
        function startNewGame() {
            localStorage.removeItem('dreadwoodGameState');
            gameState = {
                playerClass: '',
                skill: 0,
                maxStamina: 0,
                stamina: 0,
                luck: 0,
                gold: 0,
                inventory: [],
                weapons: [],
                armor: [],
                currentWeaponIndex: 0,
                currentArmorIndex: 0,
                currentSection: 0,
                gameComplete: false
            };
            window.location.href = 'level1.html';
        }
        
        // Show specific screen
        function showScreen(screenId) {
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => {
                screen.classList.remove('active-screen');
            });
            document.getElementById(screenId).classList.add('active-screen');
        }
        
        // Update stats display
        function updateStatsDisplay() {
            document.getElementById('stat-skill').textContent = gameState.skill;
            document.getElementById('stat-stamina').textContent = gameState.stamina;
            document.getElementById('stat-maxstamina').textContent = gameState.maxStamina;
            document.getElementById('stat-luck').textContent = gameState.luck;
            document.getElementById('stat-gold').textContent = gameState.gold;
        }
        
        // Update inventory display
        function updateInventoryDisplay() {
            const inventoryDiv = document.getElementById('inventory');
            inventoryDiv.innerHTML = '';
            
            // Show current equipped weapon
            if (gameState.weapons && gameState.weapons.length > 0 && gameState.currentWeaponIndex >= 0) {
                const weapon = gameState.weapons[gameState.currentWeaponIndex];
                const weaponSpan = document.createElement('span');
                weaponSpan.className = 'inventory-item';
                weaponSpan.id = 'inv-weapon';
                weaponSpan.textContent = `${weapon.name} (${weapon.damage})`;
                inventoryDiv.appendChild(weaponSpan);
            }
            
            // Show current equipped armor
            if (gameState.armor && gameState.armor.length > 0 && gameState.currentArmorIndex >= 0) {
                const armor = gameState.armor[gameState.currentArmorIndex];
                const armorSpan = document.createElement('span');
                armorSpan.className = 'inventory-item';
                armorSpan.id = 'inv-armor';
                armorSpan.textContent = `${armor.name} (${armor.defense} DEF)`;
                inventoryDiv.appendChild(armorSpan);
            }
            
            // Show gold
            const goldSpan = document.createElement('span');
            goldSpan.className = 'inventory-item';
            goldSpan.textContent = `${gameState.gold} Gold`;
            inventoryDiv.appendChild(goldSpan);
            
            // Show other inventory items
            if (gameState.inventory) {
                gameState.inventory.forEach(item => {
                    // Don't show items that are currently equipped as weapons/armor
                    const isCurrentWeapon = gameState.weapons[gameState.currentWeaponIndex] && 
                        gameState.weapons[gameState.currentWeaponIndex].name === item;
                    const isCurrentArmor = gameState.armor[gameState.currentArmorIndex] && 
                        gameState.armor[gameState.currentArmorIndex].name === item;
                    
                    if (!isCurrentWeapon && !isCurrentArmor) {
                        const itemSpan = document.createElement('span');
                        itemSpan.className = 'inventory-item';
                        itemSpan.textContent = item;
                        inventoryDiv.appendChild(itemSpan);
                    }
                });
            }
        }
        
        // Load story section
        function loadSection(sectionId) {
            gameState.currentSection = sectionId;
            const section = storySections[sectionId];
            
            if (!section) {
                // For any missing sections, provide a default continuation
                document.getElementById('story-text').innerHTML = "<p>You continue through the Moors of Dread, navigating its treacherous paths. The fog begins to clear as you approach the edge of the moor. In the distance, you can see the dark silhouette of the Necropolis of Bones.</p>";
                document.getElementById('choice-buttons').innerHTML = `
                    <button class="choice-btn" onclick="loadSection(200)">Continue to the Necropolis of Bones</button>
                    <button class="choice-btn" onclick="loadSection(0)">Return to Moor Entrance</button>
                `;
                return;
            }
            
            let storyText = section.text;
            
            // Check if this is a combat round section
            const isCombatRound = (sectionId === 2002 || sectionId === 2003 || 
                                 sectionId === 2302 || sectionId === 2303 ||
                                 sectionId === 3202 || sectionId === 3203 ||
                                 sectionId === 3602 || sectionId === 3603 ||
                                 sectionId === 3902 || sectionId === 3903 ||
                                 sectionId === 7102 || sectionId === 7103 ||
                                 sectionId === 10602 || sectionId === 10603 ||
                                 sectionId === 14202 || sectionId === 14203 ||
                                 sectionId === 1902 || sectionId === 1903);
            
            if (isCombatRound && combatState.active) {
                const combatResult = executeCombatRound();
                storyText = combatResult;
                
                if (!combatState.active) {
                    const goldReward = Math.floor(Math.random() * 30) + 10;
                    gameState.gold += goldReward;
                    updateStatsDisplay();
                    
                    storyText += `<br><span class="success">You defeated the ${combatState.enemyName}!</span>`;
                    storyText += `<br>You find ${goldReward} Gold on the body.`;
                    
                    document.getElementById('choice-buttons').innerHTML = '';
                    
                    setTimeout(() => {
                        loadSection(combatState.nextSection);
                    }, 2000);
                }
            }
            
            if (section.action) {
                const actionResult = section.action();
                if (actionResult) {
                    storyText += "<br><br>" + actionResult;
                }
            }
            
            document.getElementById('story-text').innerHTML = "<p>" + storyText + "</p>";
            
            // Only show choice buttons if not in an ended combat
            if (!isCombatRound || combatState.active) {
                const choiceButtons = document.getElementById('choice-buttons');
                choiceButtons.innerHTML = '';
                
                section.choices.forEach(choice => {
                    const button = document.createElement('button');
                    button.className = 'choice-btn';
                    button.textContent = choice.text;
                    button.onclick = function() {
                        if (choice.skillCheck) {
                            performSkillCheck(choice.checkType, choice.difficulty, choice.nextSection);
                        } else {
                            loadSection(choice.nextSection);
                        }
                    };
                    choiceButtons.appendChild(button);
                });
            }
            
            // Save game progress
            saveGame();
        }
        
        // Execute one round of combat
        function executeCombatRound() {
            combatState.round++;
            
            // Roll dice for both combatants
            const playerRoll = rollDiceHelper(2, 6);
            const enemyRoll = rollDiceHelper(2, 6);
            
            // Add skill to dice rolls
            const playerTotal = playerRoll + gameState.skill;
            const enemyTotal = enemyRoll + combatState.enemySkill;
            
            let resultText = `<span class="enemy">ROUND ${combatState.round}: ${combatState.enemyName}</span><br>`;
            resultText += `Your Stamina: ${gameState.stamina}, Enemy Stamina: ${combatState.enemyCurrentStamina}<br>`;
            resultText += `You roll ${playerRoll} + Skill ${gameState.skill} = <strong>${playerTotal}</strong><br>`;
            resultText += `Enemy rolls ${enemyRoll} + Skill ${combatState.enemySkill} = <strong>${enemyTotal}</strong><br>`;
            
            if (playerTotal > enemyTotal) {
                // Player hits enemy
                let damage = 0;
                if (gameState.weapons && gameState.weapons.length > 0 && gameState.currentWeaponIndex >= 0) {
                    const weapon = gameState.weapons[gameState.currentWeaponIndex];
                    if (weapon.damage === '1d6') damage = rollDiceHelper(1, 6);
                    else if (weapon.damage === '2d4') damage = rollDiceHelper(2, 4);
                    else if (weapon.damage === '2d6') damage = rollDiceHelper(2, 6);
                    else if (weapon.damage === '1d6+2') damage = rollDiceHelper(1, 6) + 2;
                    else if (weapon.damage === '1d6+3') damage = rollDiceHelper(1, 6) + 3;
                    else damage = rollDiceHelper(1, 6); // Default fallback
                } else {
                    damage = rollDiceHelper(1, 6);
                }
                
                combatState.enemyCurrentStamina -= damage;
                resultText += `<span class="success">You hit for ${damage} damage!</span><br>`;
                
                if (combatState.enemyCurrentStamina <= 0) {
                    combatState.active = false;
                    return resultText;
                }
                
            } else if (playerTotal < enemyTotal) {
                // Enemy hits player
                const enemyDamage = rollDiceHelper(1, 6); // Enemy always uses 1d6 damage
                gameState.stamina -= enemyDamage;
                resultText += `<span class="damage">The ${combatState.enemyName} hits you for ${enemyDamage} damage!</span>`;
                
                // Check if player died
                if (gameState.stamina <= 0) {
                    combatState.active = false;
                    resultText += `<br><span class="game-over">You have been defeated by the ${combatState.enemyName}! Game Over.</span>`;
                    setTimeout(() => {
                        localStorage.removeItem('dreadwoodGameState');
                        location.reload();
                    }, 3000);
                }
            } else {
                // Tie - no damage dealt
                resultText += "The attacks are evenly matched! No damage dealt this round.";
            }
            
            updateStatsDisplay();
            
            return resultText;
        }
        
        // Perform skill check
        function performSkillCheck(checkType, difficulty, nextSection) {
            const diceRoll = rollDiceHelper(2, 6);
            let statValue = gameState[checkType];
            let success = diceRoll <= statValue;
            
            window.checkResult = success;
            
            let resultText = `You roll ${diceRoll}. Your ${checkType.toUpperCase()} is ${statValue}. `;
            resultText += success ? 
                `<span class="success">Success!</span>` : 
                `<span class="damage">Failure!</span>`;
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${resultText}</div>`;
            
            setTimeout(() => {
                loadSection(nextSection);
            }, 1500);
        }
        
        // Use Luck
        function useLuck() {
            if (gameState.luck <= 0) {
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">You have no Luck left!</div>`;
                return;
            }
            
            const diceRoll = rollDiceHelper(2, 6);
            const success = diceRoll <= gameState.luck;
            
            gameState.luck -= 1;
            updateStatsDisplay();
            
            let resultText = `You test your Luck... Roll: ${diceRoll}, Luck: ${gameState.luck + 1}. `;
            resultText += success ? 
                `<span class="success">Lucky!</span> Something good happens.` : 
                `<span class="damage">Unlucky!</span> Something bad happens.`;
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${resultText}</div>`;
            
            // Apply Luck effect
            if (success) {
                const goodEffects = [
                    "You find 10 Gold in the mist!",
                    "You feel a surge of energy! Restore 5 Stamina.",
                    "You spot a safe path through the moor.",
                    "A lucky charm falls from the sky! Gain 2 Luck.",
                    "You avoid a hidden sinkhole."
                ];
                const effect = goodEffects[Math.floor(Math.random() * goodEffects.length)];
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">${effect}</div>`;
                
                if (effect.includes("Gold")) {
                    gameState.gold += 10;
                } else if (effect.includes("Stamina")) {
                    gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + 5);
                } else if (effect.includes("Luck")) {
                    gameState.luck += 2;
                }
            } else {
                const badEffects = [
                    "You step in quicksand! Lose 4 Stamina escaping.",
                    "You drop 5 Gold in the fog!",
                    "You attract a swarm of mist mosquitoes! Lose 2 Stamina.",
                    "You slip on wet stones! Lose 3 Stamina.",
                    "You disturb a nest of moor snakes!"
                ];
                const effect = badEffects[Math.floor(Math.random() * badEffects.length)];
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">${effect}</div>`;
                
                if (effect.includes("Stamina")) {
                    const damage = parseInt(effect.match(/\d+/)[0]);
                    gameState.stamina -= damage;
                    if (gameState.stamina <= 0) {
                        document.getElementById('story-text').innerHTML += `<div class="game-over">You have been defeated! Game Over.</div>`;
                        setTimeout(() => {
                            localStorage.removeItem('dreadwoodGameState');
                            location.reload();
                        }, 3000);
                    }
                } else if (effect.includes("Gold")) {
                    gameState.gold = Math.max(0, gameState.gold - 5);
                } else if (effect.includes("snakes")) {
                    document.getElementById('story-text').innerHTML += `<div class="dice-roll">The snakes attack!</div>`;
                    setTimeout(() => {
                        combatState.active = true;
                        combatState.enemyName = "Moor Snakes";
                        combatState.enemyStamina = 8;
                        combatState.enemyCurrentStamina = 8;
                        combatState.enemySkill = 6;
                        combatState.nextSection = gameState.currentSection;
                        combatState.round = 0;
                        loadSection(2002);
                    }, 1000);
                }
            }
            
            updateStatsDisplay();
            updateInventoryDisplay();
        }
        
        // Use Item function
        function useItem() {
            const usableItems = gameState.inventory.filter(item => {
                const isWeapon = gameState.weapons.some(w => w.name === item);
                const isArmor = gameState.armor.some(a => a.name === item);
                return !isWeapon && !isArmor;
            });
            
            if (usableItems.length === 0) {
                document.getElementById('story-text').innerHTML += 
                    `<div class="dice-roll">You have no usable items in your inventory!</div>`;
                return;
            }
            
            let itemText = "<h3>Select an item to use:</h3>";
            
            usableItems.forEach((item, index) => {
                itemText += `<p>${item} `;
                
                if (item === "Healing Potion" || item === "Healing Salve" || item === "Healing Herbs") {
                    itemText += `<button onclick="useHealingItem('${item}')" style="font-size:12px; padding:3px 8px;">Use (Restore Stamina)</button>`;
                } else if (item === "Glowing Moor Mushrooms" || item === "Glowing Moor Moss") {
                    itemText += `<button onclick="useMoorMushrooms('${item}')" style="font-size:12px; padding:3px 8px;">Use (Random Effect)</button>`;
                } else if (item === "Crystalline Flower") {
                    itemText += `<button onclick="useCrystallineFlower()" style="font-size:12px; padding:3px 8px;">Use (Magical Energy)</button>`;
                } else if (item === "Adventurer's Journal") {
                    itemText += `<button onclick="useAdventurerJournal()" style="font-size:12px; padding:3px 8px;">Read</button>`;
                } else if (item === "Magical Well Water") {
                    itemText += `<button onclick="useMagicalWater()" style="font-size:12px; padding:3px 8px;">Use (Boost Luck)</button>`;
                } else if (item === "Protective Moor Chant") {
                    itemText += `<button onclick="useProtectiveChant()" style="font-size:12px; padding:3px 8px;">Use (Protection)</button>`;
                } else {
                    itemText += `<button onclick="useGenericItem('${item}')" style="font-size:12px; padding:3px 8px;">Use</button>`;
                }
                
                itemText += `</p>`;
            });
            
            itemText += `<p><button onclick="cancelItemUse()" style="font-size:12px; padding:3px 8px; margin-top:10px;">Cancel</button></p>`;
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${itemText}</div>`;
        }
        
        // Use Healing Item
        function useHealingItem(itemName) {
            const itemIndex = gameState.inventory.indexOf(itemName);
            if (itemIndex !== -1) {
                gameState.inventory.splice(itemIndex, 1);
                
                let healAmount = 0;
                if (itemName === "Healing Potion") {
                    healAmount = 6;
                } else if (itemName === "Healing Salve") {
                    healAmount = 8;
                } else if (itemName === "Healing Herbs") {
                    healAmount = 4;
                } else {
                    healAmount = 4;
                }
                
                const oldStamina = gameState.stamina;
                gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + healAmount);
                const actualHeal = gameState.stamina - oldStamina;
                
                updateInventoryDisplay();
                updateStatsDisplay();
                
                document.getElementById('story-text').innerHTML += 
                    `<div class="dice-roll"><span class="success">You use the ${itemName} and restore ${actualHeal} Stamina!</span></div>`;
            }
        }
        
        // Use Moor Mushrooms
        function useMoorMushrooms(itemName) {
            const fungiIndex = gameState.inventory.indexOf(itemName);
            if (fungiIndex !== -1) {
                gameState.inventory.splice(fungiIndex, 1);
                
                updateInventoryDisplay();
                
                const effect = rollDiceHelper(1, 6);
                let effectText = "";
                
                if (effect <= 2) {
                    gameState.stamina -= 5;
                    effectText = "The mushrooms are poisonous! You lose 5 Stamina.";
                } else if (effect <= 4) {
                    gameState.skill += 1;
                    effectText = "The mushrooms sharpen your senses! Your Skill increases by 1!";
                } else {
                    gameState.luck += 2;
                    effectText = "The mushrooms make you feel incredibly lucky! Your Luck increases by 2!";
                }
                
                updateStatsDisplay();
                
                document.getElementById('story-text').innerHTML += 
                    `<div class="dice-roll"><span class="success">You use the ${itemName}... ${effectText}</span></div>`;
            }
        }
        
        // Use Crystalline Flower
        function useCrystallineFlower() {
            const flowerIndex = gameState.inventory.indexOf("Crystalline Flower");
            if (flowerIndex !== -1) {
                gameState.inventory.splice(flowerIndex, 1);
                updateInventoryDisplay();
                
                const effect = rollDiceHelper(1, 6);
                let effectText = "";
                
                if (effect <= 2) {
                    gameState.stamina += 8;
                    effectText = "The flower heals you! You regain 8 Stamina.";
                } else if (effect <= 4) {
                    gameState.skill += 1;
                    effectText = "The flower sharpens your mind! Your Skill increases by 1.";
                } else {
                    gameState.luck += 3;
                    effectText = "The flower makes you feel incredibly lucky! Your Luck increases by 3.";
                }
                
                updateStatsDisplay();
                
                document.getElementById('story-text').innerHTML += 
                    `<div class="dice-roll"><span class="success">You use the Crystalline Flower... ${effectText}</span></div>`;
            }
        }
        
        // Use Adventurer Journal
        function useAdventurerJournal() {
            const journalIndex = gameState.inventory.indexOf("Adventurer's Journal");
            if (journalIndex !== -1) {
                document.getElementById('story-text').innerHTML += 
                    `<div class="dice-roll"><span class="success">You read the adventurer's journal: 'The moor shifts at night... avoid the Howling... follow the white stones at dawn...' This might be useful knowledge.</span></div>`;
            }
        }
        
        // Use Magical Water
        function useMagicalWater() {
            const waterIndex = gameState.inventory.indexOf("Magical Well Water");
            if (waterIndex !== -1) {
                gameState.inventory.splice(waterIndex, 1);
                updateInventoryDisplay();
                
                document.getElementById('story-text').innerHTML += 
                    `<div class="dice-roll"><span class="success">You drink the Magical Well Water. It tastes like mint and starlight. You feel rejuvenated and gain 2 Luck!</span></div>`;
                
                gameState.luck += 2;
                updateStatsDisplay();
            }
        }
        
        // Use Protective Chant
        function useProtectiveChant() {
            const chantIndex = gameState.inventory.indexOf("Protective Moor Chant");
            if (chantIndex !== -1) {
                gameState.inventory.splice(chantIndex, 1);
                updateInventoryDisplay();
                
                document.getElementById('story-text').innerHTML += 
                    `<div class="dice-roll"><span class="success">You recite the Protective Moor Chant. The mist seems to thin around you, and you feel protected from moor spirits for a time.</span></div>`;
                
                gameState.protected = true;
                setTimeout(() => {
                    gameState.protected = false;
                    document.getElementById('story-text').innerHTML += 
                        `<div class="dice-roll">The chant's protection fades.</div>`;
                }, 30000);
            }
        }
        
        // Use Generic Item
        function useGenericItem(itemName) {
            const itemIndex = gameState.inventory.indexOf(itemName);
            if (itemIndex !== -1) {
                gameState.inventory.splice(itemIndex, 1);
                updateInventoryDisplay();
                
                let effectText = "";
                if (itemName.includes("Potion") || itemName.includes("Elixir")) {
                    const healAmount = rollDiceHelper(1, 4) + 2;
                    const oldStamina = gameState.stamina;
                    gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + healAmount);
                    const actualHeal = gameState.stamina - oldStamina;
                    effectText = `You use the ${itemName} and restore ${actualHeal} Stamina!`;
                    updateStatsDisplay();
                } else if (itemName.includes("Amulet") || itemName.includes("Charm") || itemName.includes("Crystal")) {
                    gameState.luck += 1;
                    effectText = `You activate the ${itemName} and feel luckier! Luck +1`;
                    updateStatsDisplay();
                } else if (itemName.includes("Key")) {
                    effectText = `You examine the ${itemName}. It might unlock something important.`;
                    gameState.inventory.push(itemName);
                    updateInventoryDisplay();
                    return;
                } else {
                    effectText = `You use the ${itemName}.`;
                }
                
                document.getElementById('story-text').innerHTML += 
                    `<div class="dice-roll"><span class="success">${effectText}</span></div>`;
            }
        }
        
        // Cancel Item Use
        function cancelItemUse() {
            document.getElementById('story-text').innerHTML += 
                `<div class="dice-roll">You decide not to use an item.</div>`;
        }
        
        // Check inventory
        function checkInventory() {
            let inventoryText = "<h3>Your Inventory:</h3>";
            
            if (gameState.weapons && gameState.weapons.length > 0 && gameState.currentWeaponIndex >= 0) {
                const weapon = gameState.weapons[gameState.currentWeaponIndex];
                inventoryText += `<p><strong>Equipped Weapon:</strong> ${weapon.name} (${weapon.damage} damage)</p>`;
            }
            
            inventoryText += "<p><strong>Available Weapons:</strong><br>";
            gameState.weapons.forEach((weapon, index) => {
                const isEquipped = index === gameState.currentWeaponIndex;
                inventoryText += `${isEquipped ? " " : ""}${weapon.name} (${weapon.damage})`;
                if (!isEquipped) {
                    inventoryText += ` <button onclick="equipWeapon(${index})" style="font-size:10px; padding:2px 5px;">Equip</button>`;
                }
                inventoryText += "<br>";
            });
            inventoryText += "</p>";
            
            inventoryText += "<p><strong>Armor:</strong><br>";
            gameState.armor.forEach((armor, index) => {
                const isEquipped = index === gameState.currentArmorIndex;
                inventoryText += `${isEquipped ? " " : ""}${armor.name} (${armor.defense} DEF)`;
                if (!isEquipped) {
                    inventoryText += ` <button onclick="equipArmor(${index})" style="font-size:10px; padding:2px 5px;">Equip</button>`;
                }
                inventoryText += "<br>";
            });
            inventoryText += "</p>";
            
            inventoryText += `<p><strong>Gold:</strong> ${gameState.gold}</p>`;
            
            if (gameState.inventory && gameState.inventory.length > 0) {
                inventoryText += `<p><strong>Usable Items:</strong><br>`;
                const usableItems = gameState.inventory.filter(item => {
                    const isWeapon = gameState.weapons.some(w => w.name === item);
                    const isArmor = gameState.armor.some(a => a.name === item);
                    return !isWeapon && !isArmor;
                });
                
                if (usableItems.length > 0) {
                    usableItems.forEach(item => {
                        inventoryText += `${item} `;
                        
                        if (item === "Healing Potion" || item === "Healing Salve" || item === "Healing Herbs") {
                            inventoryText += `<button onclick="useHealingItem('${item}')" style="font-size:10px; padding:2px 5px;">Use</button>`;
                        } else if (item === "Glowing Moor Mushrooms" || item === "Glowing Moor Moss") {
                            inventoryText += `<button onclick="useMoorMushrooms('${item}')" style="font-size:10px; padding:2px 5px;">Use</button>`;
                        } else if (item === "Crystalline Flower") {
                            inventoryText += `<button onclick="useCrystallineFlower()" style="font-size:10px; padding:2px 5px;">Use</button>`;
                        } else if (item === "Adventurer's Journal") {
                            inventoryText += `<button onclick="useAdventurerJournal()" style="font-size:10px; padding:2px 5px;">Read</button>`;
                        } else if (item === "Magical Well Water") {
                            inventoryText += `<button onclick="useMagicalWater()" style="font-size:10px; padding:2px 5px;">Use</button>`;
                        } else if (item === "Protective Moor Chant") {
                            inventoryText += `<button onclick="useProtectiveChant()" style="font-size:10px; padding:2px 5px;">Use</button>`;
                        } else {
                            inventoryText += `<button onclick="useGenericItem('${item}')" style="font-size:10px; padding:2px 5px;">Use</button>`;
                        }
                        
                        inventoryText += `<br>`;
                    });
                } else {
                    inventoryText += "None";
                }
                inventoryText += `</p>`;
            }
            
            document.getElementById('story-text').innerHTML += `<div class="dice-roll">${inventoryText}</div>`;
        }
        
        // Equip weapon function
        function equipWeapon(index) {
            if (index >= 0 && index < gameState.weapons.length) {
                gameState.currentWeaponIndex = index;
                updateInventoryDisplay();
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">Equipped ${gameState.weapons[index].name}!</div>`;
                saveGame();
            }
        }
        
        // Equip armor function
        function equipArmor(index) {
            if (index >= 0 && index < gameState.armor.length) {
                gameState.currentArmorIndex = index;
                updateInventoryDisplay();
                document.getElementById('story-text').innerHTML += `<div class="dice-roll">Equipped ${gameState.armor[index].name}!</div>`;
                saveGame();
            }
        }
        
        // Save game
        function saveGame() {
            if (gameState.currentWeaponIndex >= gameState.weapons.length) {
                gameState.currentWeaponIndex = gameState.weapons.length - 1;
            }
            if (gameState.currentArmorIndex >= gameState.armor.length) {
                gameState.currentArmorIndex = gameState.armor.length - 1;
            }
            
            localStorage.setItem('dreadwoodGameState', JSON.stringify(gameState));
        }
        
        // Go to next level (Necropolis of Bones)
        function goToNextLevel() {
            localStorage.setItem('dreadwoodGameState', JSON.stringify(gameState));
            window.location.href = 'level6.html';
        }
        
        // Utility function to roll dice
        function rollDiceHelper(num, sides) {
            let total = 0;
            for (let i = 0; i < num; i++) {
                total += Math.floor(Math.random() * sides) + 1;
            }
            return total;
        }
        
        // Initialize on load
        window.onload = initGame;
    </script>
</body>
</html>
