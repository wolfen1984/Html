<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCII Wizard Duel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background-color: #000;
            color: #0f0;
            line-height: 1.2;
            padding: 5px;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }
        
        #game-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            max-width: 100%;
        }
        
        .screen {
            display: none;
            flex-direction: column;
            height: 100%;
            width: 100%;
        }
        
        #main-menu {
            display: flex;
        }
        
        .active {
            display: flex !important;
        }
        
        .header {
            text-align: center;
            padding: 5px;
            border-bottom: 1px solid #0f0;
            margin-bottom: 5px;
            flex-shrink: 0;
        }
        
        .content {
            flex: 1;
            overflow-y: auto;
            padding: 5px;
            min-height: 0; /* Critical for flex scrolling */
        }
        
        .footer {
            padding: 5px;
            border-top: 1px solid #0f0;
            margin-top: 5px;
            flex-shrink: 0;
        }
        
        button {
            background-color: #000;
            color: #0f0;
            border: 1px solid #0f0;
            padding: 8px 12px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 2px;
            cursor: pointer;
            width: 100%;
        }
        
        button:active {
            background-color: #0f0;
            color: #000;
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            flex-wrap: wrap;
        }
        
        .battle-area {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        
        .wizard {
            text-align: center;
            width: 48%;
            min-width: 150px;
            margin-bottom: 10px;
        }
        
        .wizard-ascii {
            font-size: 12px;
            line-height: 1;
            margin: 5px 0;
            white-space: pre;
        }
        
        .health-bar {
            width: 100%;
            height: 10px;
            background-color: #333;
            margin: 5px 0;
        }
        
        .health-fill {
            height: 100%;
            background-color: #0f0;
        }
        
        .mana-bar {
            width: 100%;
            height: 10px;
            background-color: #333;
            margin: 5px 0;
        }
        
        .mana-fill {
            height: 100%;
            background-color: #00f;
        }
        
        .spell-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 5px;
        }
        
        .spell {
            width: 48%;
            margin-bottom: 5px;
            min-width: 120px;
        }
        
        .log {
            height: 100px;
            overflow-y: auto;
            border: 1px solid #0f0;
            padding: 5px;
            margin-top: 10px;
            font-size: 12px;
            flex-shrink: 0;
        }
        
        .enemy-list {
            display: flex;
            flex-direction: column;
        }
        
        .enemy {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px;
            border: 1px solid #0f0;
            margin-bottom: 5px;
            flex-wrap: wrap;
        }
        
        .profile {
            border: 1px solid #0f0;
            padding: 5px;
            margin-bottom: 10px;
        }
        
        .inventory {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 5px;
        }
        
        .item {
            width: 48%;
            margin-bottom: 5px;
            border: 1px solid #0f0;
            padding: 5px;
            min-width: 140px;
        }
        
        .item-common { border-color: #0f0; }
        .item-rare { border-color: #00f; }
        .item-epic { border-color: #90f; }
        .item-legendary { border-color: #ff0; }
        
        .xp-bar {
            width: 100%;
            height: 10px;
            background-color: #333;
            margin: 5px 0;
        }
        
        .xp-fill {
            height: 100%;
            background-color: #ff0;
        }
        
        .upgrade-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px;
            border: 1px solid #0f0;
            margin-bottom: 5px;
            flex-wrap: wrap;
        }
        
        .mana-warning {
            color: #f00;
            text-align: center;
            margin: 5px 0;
        }
        
        .victory-screen, .defeat-screen, .loot-screen {
            text-align: center;
            padding: 10px;
        }
        
        .victory-rewards, .defeat-stats, .loot-items {
            border: 1px solid #0f0;
            padding: 10px;
            margin: 10px 0;
        }
        
        .victory-message, .defeat-message {
            font-size: 16px;
            margin: 10px 0;
            color: #ff0;
        }
        
        .defeat-message {
            color: #f00;
        }
        
        .health-critical {
            color: #f00;
            animation: pulse 1s infinite;
        }
        
        .loot-item {
            margin: 5px 0;
            padding: 5px;
            border: 1px solid #0f0;
        }
        
        .loot-rarity-common { color: #0f0; }
        .loot-rarity-rare { color: #00f; }
        .loot-rarity-epic { color: #90f; }
        .loot-rarity-legendary { color: #ff0; }
        
        .consumable-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin: 10px 0;
            gap: 5px;
        }
        
        .consumable-btn {
            width: 48%;
            margin-bottom: 5px;
            min-width: 120px;
        }
        
        .inventory-item {
            width: 100%;
            margin-bottom: 10px;
            border: 1px solid #0f0;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .item-actions {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            margin-top: 5px;
            width: 100%;
            justify-content: flex-end;
        }
        
        .item-action-btn {
            width: auto;
            padding: 6px 12px;
            font-size: 12px;
            margin: 0;
            flex: 1;
            min-width: 80px;
        }
        
        .inventory-empty {
            text-align: center;
            padding: 20px;
            color: #666;
            width: 100%;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .enemy-defeated {
            color: #ff0;
            font-weight: bold;
        }
        
        /* New styles for enhanced features */
        .elemental-bonus {
            color: #ff0;
            font-weight: bold;
        }
        
        .status-effect {
            display: inline-block;
            padding: 2px 5px;
            margin: 0 2px;
            border-radius: 3px;
            font-size: 10px;
        }
        
        .status-burn { background-color: #f00; color: #fff; }
        .status-freeze { background-color: #0ff; color: #000; }
        .status-shock { background-color: #ff0; color: #000; }
        
        .damage-number {
            position: absolute;
            color: #f00;
            font-weight: bold;
            animation: floatUp 1s ease-out forwards;
        }
        
        .critical-hit {
            color: #ff0;
            font-size: 14px;
            font-weight: bold;
        }
        
        .combo-counter {
            text-align: center;
            font-size: 16px;
            color: #ff0;
            margin: 5px 0;
        }
        
        .gold-display {
            text-align: center;
            margin: 5px 0;
            color: #ff0;
        }
        
        .achievement-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #000;
            border: 2px solid #ff0;
            padding: 10px;
            z-index: 100;
            text-align: center;
            max-width: 90%;
        }
        
        .shop-item {
            border: 1px solid #0f0;
            padding: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .daily-challenge {
            border: 1px solid #ff0;
            padding: 10px;
            margin: 10px 0;
        }
        
        .scrollable-container {
            overflow-y: auto;
            flex: 1;
            min-height: 0;
        }
        
        .compact-list {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .compact-item {
            padding: 8px;
            border: 1px solid #0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .compact-actions {
            display: flex;
            gap: 5px;
            margin-top: 5px;
            width: 100%;
        }
        
        .compact-action-btn {
            flex: 1;
            padding: 4px 8px;
            font-size: 11px;
        }
        
        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-30px); opacity: 0; }
        }
        
        @media (max-height: 600px) {
            .wizard-ascii {
                font-size: 10px;
            }
            
            button {
                padding: 6px 10px;
                font-size: 12px;
            }
            
            .log {
                height: 80px;
            }
            
            .inventory-item {
                padding: 5px;
            }
            
            .item-action-btn {
                padding: 4px 8px;
                font-size: 11px;
            }
        }
        
        @media (max-width: 480px) {
            .wizard {
                width: 100%;
            }
            
            .spell, .consumable-btn {
                width: 100%;
            }
            
            .item {
                width: 100%;
            }
            
            .enemy {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .compact-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .compact-actions {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- Main Menu Screen -->
        <div id="main-menu" class="screen active">
            <div class="header">
                <pre>
  _    _ _____ _     _ _______ _____  ______ 
 | |  | (____ | |   | (_______|____ \/ _____)
 | |  | |_   _| |__ | |_       _   | / /  _ 
 \ \/ /  | | |  __)| | | |   | |  | | |  |_| |
  \  /   | | | |   | | | |__/ /| |__| | |_ 
  / /    |_| |_|   |_| |_____/ |_____/ \___
 /_/                                         
                </pre>
                <h2>ENHANCED WIZARD DUEL</h2>
            </div>
            <div class="content">
                <div class="compact-list">
                    <button id="new-game">NEW GAME</button>
                    <button id="player-profile">PLAYER PROFILE</button>
                    <button id="select-enemy">FIGHT WIZARD</button>
                    <button id="use-consumables">USE ITEMS</button>
                    <button id="shop-btn">SHOP</button>
                    <button id="achievements-btn">ACHIEVEMENTS</button>
                    <div class="gold-display">Gold: <span id="gold-amount">0</span></div>
                    <div id="combo-counter-main" class="combo-counter" style="display: none;"></div>
                    <div id="daily-challenge-main" class="daily-challenge" style="display: none;">
                        <h3>Daily Challenge Available!</h3>
                        <button id="daily-challenge-btn">VIEW DAILY CHALLENGE</button>
                    </div>
                </div>
            </div>
            <div class="footer">
                <p>Use your spells wisely!</p>
            </div>
        </div>
        
        <!-- Player Profile Screen -->
        <div id="player-profile-screen" class="screen">
            <div class="header">
                <h2>PLAYER PROFILE</h2>
            </div>
            <div class="content">
                <div class="scrollable-container">
                    <div class="profile">
                        <div class="profile-header">
                            <pre>
     /\
    /  \
   / /\ \
  / ____ \
 /_/    \_\
                            </pre>
                            <h3 id="player-name">MERLIN</h3>
                            <div class="stats">
                                <div>Gold: <span id="player-gold">0</span></div>
                                <div>Achievements: <span id="player-achievements">0</span>/5</div>
                            </div>
                        </div>
                        <div class="stats">
                            <div>Level: <span id="player-level">1</span></div>
                            <div>XP: <span id="player-xp">0</span>/<span id="player-next-level">100</span></div>
                        </div>
                        <div class="xp-bar">
                            <div class="xp-fill" id="player-xp-bar" style="width: 0%;"></div>
                        </div>
                        <div class="stats">
                            <div>Health: <span id="player-health">50</span>/<span id="player-max-health">50</span></div>
                            <div>Mana: <span id="player-mana">30</span>/<span id="player-max-mana">30</span></div>
                        </div>
                        <div class="stats">
                            <div>Attack: <span id="player-attack">5</span></div>
                            <div>Defense: <span id="player-defense">3</span></div>
                        </div>
                        <div id="player-status-effects" class="stats">
                            <!-- Status effects will appear here -->
                        </div>
                        <h4>SPELLS:</h4>
                        <div class="spell-list" id="profile-spells">
                            <!-- Spells will be dynamically added here -->
                        </div>
                        <h4>EQUIPMENT:</h4>
                        <div class="inventory">
                            <div class="item">
                                <div>Weapon: <span id="player-weapon">Staff</span></div>
                                <div>DMG: +<span id="player-weapon-dmg">2</span></div>
                            </div>
                            <div class="item">
                                <div>Armor: <span id="player-armor">Robes</span></div>
                                <div>DEF: +<span id="player-armor-def">1</span></div>
                            </div>
                        </div>
                        <h4>INVENTORY:</h4>
                        <div id="player-inventory-items">
                            <div class="inventory-empty">No items in inventory</div>
                        </div>
                        <button id="manage-inventory" style="margin-top: 10px;">MANAGE INVENTORY</button>
                    </div>
                </div>
            </div>
            <div class="footer">
                <button id="back-from-profile">BACK</button>
            </div>
        </div>
        
        <!-- Enemy Selection Screen -->
        <div id="enemy-selection" class="screen">
            <div class="header">
                <h2>SELECT YOUR OPPONENT</h2>
            </div>
            <div class="content">
                <div class="scrollable-container">
                    <div class="enemy-list" id="enemy-list">
                        <!-- Enemies will be dynamically added here -->
                    </div>
                </div>
            </div>
            <div class="footer">
                <button id="back-from-enemies">BACK</button>
            </div>
        </div>
        
        <!-- Battle Screen -->
        <div id="battle-screen" class="screen">
            <div class="header">
                <h2>WIZARD DUEL</h2>
                <div id="combo-counter-battle" class="combo-counter" style="display: none;"></div>
            </div>
            <div class="content">
                <div class="scrollable-container">
                    <div class="battle-area">
                        <div class="wizard">
                            <h3>PLAYER</h3>
                            <div class="wizard-ascii" id="player-ascii">
     /\
    /  \
   / /\ \
  / ____ \
 /_/    \_\
                            </div>
                            <div>Health: <span id="battle-player-health">50</span>/<span id="battle-player-max-health">50</span></div>
                            <div class="health-bar">
                                <div class="health-fill" id="player-health-fill" style="width: 100%;"></div>
                            </div>
                            <div>Mana: <span id="battle-player-mana">30</span>/<span id="battle-player-max-mana">30</span></div>
                            <div class="mana-bar">
                                <div class="mana-fill" id="player-mana-fill" style="width: 100%;"></div>
                            </div>
                            <div id="player-status-effects-battle" class="stats">
                                <!-- Player status effects in battle -->
                            </div>
                        </div>
                        <div class="wizard">
                            <h3 id="enemy-name">FIRE MAGE</h3>
                            <div class="wizard-ascii" id="enemy-ascii">
     /\
    /  \
   / /\ \
  / ____ \
 /_/    \_\
                            </div>
                            <div>Health: <span id="battle-enemy-health">40</span>/<span id="battle-enemy-max-health">40</span></div>
                            <div class="health-bar">
                                <div class="health-fill" id="enemy-health-fill" style="width: 100%;"></div>
                            </div>
                            <div>Mana: <span id="battle-enemy-mana">25</span>/<span id="battle-enemy-max-mana">25</span></div>
                            <div class="mana-bar">
                                <div class="mana-fill" id="enemy-mana-fill" style="width: 100%;"></div>
                            </div>
                            <div id="enemy-status-effects" class="stats">
                                <!-- Enemy status effects -->
                            </div>
                        </div>
                    </div>
                    <div class="log" id="battle-log">
                        <div>A wizard duel begins!</div>
                    </div>
                    <div id="mana-warning" class="mana-warning" style="display: none;">
                        Low on mana! Consider fleeing to recover.
                    </div>
                    <div id="health-warning" class="mana-warning health-critical" style="display: none;">
                        CRITICAL HEALTH! Use Heal or flee!
                    </div>
                    <h4>YOUR SPELLS:</h4>
                    <div class="spell-list" id="battle-spells">
                        <!-- Spells will be dynamically added here -->
                    </div>
                    <div class="consumable-buttons" id="battle-consumables" style="display: none;">
                        <!-- Consumable buttons will be added here -->
                    </div>
                </div>
            </div>
            <div class="footer">
                <button id="flee">FLEE</button>
            </div>
        </div>
        
        <!-- Victory Screen -->
        <div id="victory-screen" class="screen">
            <div class="header">
                <h2>VICTORY!</h2>
            </div>
            <div class="content">
                <div class="victory-screen">
                    <pre>
   __   _____  _  _  ____  __    ____ 
  /__\ (  _  )( \( )( ___)(  )  ( ___)
 /(__)\ )(_)(  )  (  )__)  )(__  )__) 
(__)(__)(_____)(_)\_)(____)(____)(____)
                    </pre>
                    <div class="victory-message" id="victory-message">
                        You have defeated the enemy wizard!
                    </div>
                    <div class="victory-rewards">
                        <h3>REWARDS:</h3>
                        <div id="victory-xp">XP Gained: 0</div>
                        <div id="victory-gold">Gold Gained: 0</div>
                        <div id="victory-level-up" style="display: none; color: #ff0; font-weight: bold;">
                            LEVEL UP! You are now level <span id="new-level">2</span>!
                        </div>
                    </div>
                </div>
            </div>
            <div class="footer">
                <button id="continue-after-victory">CONTINUE</button>
            </div>
        </div>
        
        <!-- Loot Screen -->
        <div id="loot-screen" class="screen">
            <div class="header">
                <h2>LOOT FOUND!</h2>
            </div>
            <div class="content">
                <div class="loot-screen">
                    <pre>
   __   _____   ___  _____ 
  / /  |  _  | / _ \|_   _|
 / /   | | | |/ /_\ \ | |  
/ /    | | | ||  _  | | |  
\ \    | |_| || | | | | |  
 \_\   |_____/\_| |_/ \_/  
                    </pre>
                    <div class="loot-message">
                        You found valuable loot from the defeated wizard!
                    </div>
                    <div class="loot-items" id="loot-items">
                        <!-- Loot items will be displayed here -->
                    </div>
                </div>
            </div>
            <div class="footer">
                <button id="take-loot">TAKE LOOT</button>
            </div>
        </div>
        
        <!-- Defeat Screen -->
        <div id="defeat-screen" class="screen">
            <div class="header">
                <h2>DEFEAT</h2>
            </div>
            <div class="content">
                <div class="defeat-screen">
                    <pre>
  _____  ______  _____  ______  _______  _____ 
 |  __ \|  ____|/ ____||  ____||__   __|/ ____|
 | |  | | |__  | (___  | |__      | |  | (___  
 | |  | |  __|  \___ \ |  __|     | |   \___ \ 
 | |__| | |____ ____) || |____    | |   ____) |
 |_____/|______|_____/ |______|   |_|  |_____/ 
                    </pre>
                    <div class="defeat-message" id="defeat-message">
                        You have been defeated in battle!
                    </div>
                    <div class="defeat-stats">
                        <h3>BATTLE STATS:</h3>
                        <div id="defeat-enemy">Defeated by: Unknown</div>
                        <div id="defeat-level">Your Level: 1</div>
                        <div id="defeat-xp">Current XP: 0</div>
                    </div>
                </div>
            </div>
            <div class="footer">
                <button id="try-again">TRY AGAIN</button>
                <button id="main-menu-after-defeat">MAIN MENU</button>
            </div>
        </div>
        
        <!-- Upgrade Screen -->
        <div id="upgrade-screen" class="screen">
            <div class="header">
                <h2>LEVEL UP!</h2>
            </div>
            <div class="content">
                <div class="scrollable-container">
                    <p>You gained a level! Choose an upgrade:</p>
                    <div class="upgrade-option">
                        <div>
                            <h4>+10 Max Health</h4>
                            <p>Increases your maximum health by 10</p>
                        </div>
                        <button class="upgrade-btn" data-upgrade="health">SELECT</button>
                    </div>
                    <div class="upgrade-option">
                        <div>
                            <h4>+5 Max Mana</h4>
                            <p>Increases your maximum mana by 5</p>
                        </div>
                        <button class="upgrade-btn" data-upgrade="mana">SELECT</button>
                    </div>
                    <div class="upgrade-option">
                        <div>
                            <h4>+2 Attack</h4>
                            <p>Increases your attack power by 2</p>
                        </div>
                        <button class="upgrade-btn" data-upgrade="attack">SELECT</button>
                    </div>
                    <div class="upgrade-option">
                        <div>
                            <h4>+2 Defense</h4>
                            <p>Increases your defense by 2</p>
                        </div>
                        <button class="upgrade-btn" data-upgrade="defense">SELECT</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Consumables Screen -->
        <div id="consumables-screen" class="screen">
            <div class="header">
                <h2>USE ITEMS</h2>
            </div>
            <div class="content">
                <div class="scrollable-container">
                    <div id="consumables-list">
                        <!-- Consumable items will be listed here -->
                    </div>
                </div>
            </div>
            <div class="footer">
                <button id="back-from-consumables">BACK</button>
            </div>
        </div>
        
        <!-- Inventory Screen -->
        <div id="inventory-screen" class="screen">
            <div class="header">
                <h2>INVENTORY</h2>
            </div>
            <div class="content">
                <div class="scrollable-container">
                    <div id="inventory-items">
                        <!-- Inventory items with actions will be listed here -->
                    </div>
                </div>
            </div>
            <div class="footer">
                <button id="back-from-inventory">BACK</button>
            </div>
        </div>
        
        <!-- Shop Screen -->
        <div id="shop-screen" class="screen">
            <div class="header">
                <h2>SHOP</h2>
                <div>Your Gold: <span id="shop-gold">0</span></div>
            </div>
            <div class="content">
                <div class="scrollable-container">
                    <div id="shop-items">
                        <!-- Shop items will be dynamically added here -->
                    </div>
                </div>
            </div>
            <div class="footer">
                <button id="back-from-shop">BACK</button>
            </div>
        </div>
        
        <!-- Achievements Screen -->
        <div id="achievements-screen" class="screen">
            <div class="header">
                <h2>ACHIEVEMENTS</h2>
            </div>
            <div class="content">
                <div class="scrollable-container">
                    <div id="achievements-list">
                        <!-- Achievements will be dynamically added here -->
                    </div>
                </div>
            </div>
            <div class="footer">
                <button id="back-from-achievements">BACK</button>
            </div>
        </div>
        
        <!-- Daily Challenge Screen -->
        <div id="daily-challenge-screen" class="screen">
            <div class="header">
                <h2>DAILY CHALLENGE</h2>
            </div>
            <div class="content">
                <div class="scrollable-container">
                    <div id="daily-challenge-info">
                        <!-- Daily challenge info will be displayed here -->
                    </div>
                </div>
            </div>
            <div class="footer">
                <button id="back-from-daily">BACK</button>
                <button id="start-daily-challenge">START CHALLENGE</button>
            </div>
        </div>
    </div>

    <script>
        // ============== GAME STATE ==============
        const gameState = {
            player: {
                name: "MERLIN",
                level: 1,
                xp: 0,
                nextLevel: 100,
                health: 50,
                maxHealth: 50,
                mana: 30,
                maxMana: 30,
                attack: 5,
                defense: 3,
                gold: 0,
                statusEffects: [],
                spells: [
                    { name: "Fireball", damage: 8, cost: 5, element: "fire", statusEffect: "burn" },
                    { name: "Ice Shard", damage: 6, cost: 4, element: "ice", statusEffect: "freeze" },
                    { name: "Lightning", damage: 10, cost: 7, element: "lightning", statusEffect: "shock" },
                    { name: "Heal", heal: 10, cost: 6, element: "holy" }
                ],
                equipment: {
                    weapon: { name: "Staff", damage: 2 },
                    armor: { name: "Robes", defense: 1 }
                },
                inventory: [],
                unlockedSpells: [0, 1, 2, 3],
                comboCount: 0,
                lastSpellElement: null
            },
            currentEnemy: null,
            currentXpReward: 0,
            currentGoldReward: 0,
            battleLog: [],
            currentLoot: [],
            achievements: {
                first_blood: { name: "First Blood", description: "Defeat your first enemy", unlocked: false, reward: { gold: 50 } },
                elemental_master: { name: "Elemental Master", description: "Learn all elemental spells", unlocked: false, reward: { gold: 100 } },
                rich_wizard: { name: "Rich Wizard", description: "Collect 1000 gold", unlocked: false, reward: { gold: 200 } },
                combo_master: { name: "Combo Master", description: "Achieve a 5-spell combo", unlocked: false, reward: { gold: 75 } },
                dragon_slayer: { name: "Dragon Slayer", description: "Defeat the Ancient Dragon", unlocked: false, reward: { gold: 500 } }
            },
            dailyChallenge: {
                available: false,
                completed: false,
                progress: 0,
                required: 3,
                reward: { xp: 200, gold: 100 }
            },
            enemies: {
                fire: {
                    name: "Fire Mage",
                    level: 1,
                    health: 40,
                    maxHealth: 40,
                    mana: 25,
                    maxMana: 25,
                    attack: 4,
                    defense: 2,
                    element: "fire",
                    spells: [
                        { name: "Fireball", damage: 8, cost: 5, element: "fire", statusEffect: "burn" },
                        { name: "Ember", damage: 4, cost: 3, element: "fire" }
                    ],
                    ascii: `     /\\
    /  \\
   / /\\ \\
  / ____ \\
 /_/    \\_\\`,
                    xpReward: 25,
                    goldReward: 10,
                    lootTier: 1
                },
                ice: {
                    name: "Ice Sorcerer",
                    level: 2,
                    health: 50,
                    maxHealth: 50,
                    mana: 30,
                    maxMana: 30,
                    attack: 5,
                    defense: 3,
                    element: "ice",
                    spells: [
                        { name: "Ice Shard", damage: 6, cost: 4, element: "ice", statusEffect: "freeze" },
                        { name: "Frost Bolt", damage: 7, cost: 5, element: "ice" }
                    ],
                    ascii: `     /\\
    /  \\
   / /\\ \\
  / ____ \\
 /_/    \\_\\`,
                    xpReward: 40,
                    goldReward: 15,
                    lootTier: 2
                },
                storm: {
                    name: "Storm Caller",
                    level: 3,
                    health: 60,
                    maxHealth: 60,
                    mana: 35,
                    maxMana: 35,
                    attack: 6,
                    defense: 4,
                    element: "lightning",
                    spells: [
                        { name: "Lightning", damage: 10, cost: 7, element: "lightning", statusEffect: "shock" },
                        { name: "Wind Slash", damage: 5, cost: 4, element: "air" }
                    ],
                    ascii: `     /\\
    /  \\
   / /\\ \\
  / ____ \\
 /_/    \\_\\`,
                    xpReward: 60,
                    goldReward: 20,
                    lootTier: 3
                },
                necro: {
                    name: "Necromancer",
                    level: 4,
                    health: 70,
                    maxHealth: 70,
                    mana: 40,
                    maxMana: 40,
                    attack: 7,
                    defense: 5,
                    element: "dark",
                    spells: [
                        { name: "Dark Bolt", damage: 9, cost: 6, element: "dark" },
                        { name: "Life Drain", damage: 6, heal: 3, cost: 5, element: "dark" }
                    ],
                    ascii: `     /\\
    /  \\
   / /\\ \\
  / ____ \\
 /_/    \\_\\`,
                    xpReward: 80,
                    goldReward: 25,
                    lootTier: 4
                },
                dragon: {
                    name: "Ancient Dragon",
                    level: 10,
                    health: 150,
                    maxHealth: 150,
                    mana: 80,
                    maxMana: 80,
                    attack: 12,
                    defense: 8,
                    element: "fire",
                    spells: [
                        { name: "Fire Breath", damage: 15, cost: 10, element: "fire", statusEffect: "burn" },
                        { name: "Dragon Claw", damage: 12, cost: 8 }
                    ],
                    ascii: `         __
        /  \\
       / ..|\\
      (_\\  |_)
      /  \\@'
     /     \\
    / *    \\
   :----....:
   (C   (C) `,
                    xpReward: 200,
                    goldReward: 100,
                    lootTier: 5
                }
            },
            elementalEffects: {
                fire: { strongAgainst: "ice", weakAgainst: "water" },
                ice: { strongAgainst: "storm", weakAgainst: "fire" },
                lightning: { strongAgainst: "water", weakAgainst: "earth" }
            },
            statusEffects: {
                burn: { 
                    name: "Burn", 
                    damagePerTurn: 2, 
                    duration: 3, 
                    element: "fire",
                    description: "Takes damage over time"
                },
                freeze: { 
                    name: "Freeze", 
                    skipTurns: 1, 
                    duration: 2, 
                    element: "ice",
                    description: "Skips turns occasionally"
                },
                shock: { 
                    name: "Shock", 
                    manaDrain: 5, 
                    duration: 2, 
                    element: "lightning",
                    description: "Drains mana each turn"
                }
            },
            lootItems: {
                weapons: [
                    { name: "Crystal Wand", damage: 3, rarity: "common", type: "weapon" },
                    { name: "Obsidian Staff", damage: 5, rarity: "rare", type: "weapon" },
                    { name: "Dragonbone Rod", damage: 7, rarity: "epic", type: "weapon" }
                ],
                armor: [
                    { name: "Mage Robes", defense: 2, rarity: "common", type: "armor" },
                    { name: "Enchanted Cloak", defense: 3, rarity: "rare", type: "armor" },
                    { name: "Arcane Armor", defense: 5, rarity: "epic", type: "armor" }
                ],
                potions: [
                    { name: "Health Potion", type: "potion", potionType: "health", value: 20, rarity: "common" },
                    { name: "Mana Potion", type: "potion", potionType: "mana", value: 15, rarity: "common" },
                    { name: "Greater Health Potion", type: "potion", potionType: "health", value: 40, rarity: "rare" },
                    { name: "Greater Mana Potion", type: "potion", potionType: "mana", value: 30, rarity: "rare" }
                ],
                spells: [
                    { name: "Arcane Missile", damage: 12, cost: 8, rarity: "rare", type: "spell", element: "arcane" },
                    { name: "Chain Lightning", damage: 15, cost: 10, rarity: "epic", type: "spell", element: "lightning" }
                ]
            },
            shopItems: [
                { name: "Health Potion", cost: 20, type: "potion", item: { name: "Health Potion", type: "potion", potionType: "health", value: 20, rarity: "common" } },
                { name: "Mana Potion", cost: 15, type: "potion", item: { name: "Mana Potion", type: "potion", potionType: "mana", value: 15, rarity: "common" } },
                { name: "Greater Health Potion", cost: 40, type: "potion", item: { name: "Greater Health Potion", type: "potion", potionType: "health", value: 40, rarity: "rare" } },
                { name: "Greater Mana Potion", cost: 35, type: "potion", item: { name: "Greater Mana Potion", type: "potion", potionType: "mana", value: 30, rarity: "rare" } }
            ]
        };

        // ============== DOM ==============
        const screens = {
            mainMenu: document.getElementById('main-menu'),
            playerProfile: document.getElementById('player-profile-screen'),
            enemySelection: document.getElementById('enemy-selection'),
            battle: document.getElementById('battle-screen'),
            victory: document.getElementById('victory-screen'),
            loot: document.getElementById('loot-screen'),
            defeat: document.getElementById('defeat-screen'),
            upgrade: document.getElementById('upgrade-screen'),
            consumables: document.getElementById('consumables-screen'),
            inventory: document.getElementById('inventory-screen'),
            shop: document.getElementById('shop-screen'),
            achievements: document.getElementById('achievements-screen'),
            dailyChallenge: document.getElementById('daily-challenge-screen')
        };

        function showScreen(name) {
            Object.values(screens).forEach(s => s.classList.remove('active'));
            if (screens[name]) {
                screens[name].classList.add('active');
                // Scroll to top when switching screens
                const content = screens[name].querySelector('.content');
                if (content) content.scrollTop = 0;
            }
        }

        // ============== CORE GAME FUNCTIONS ==============

        function updatePlayerProfile() {
            const p = gameState.player;
            document.getElementById('player-name').textContent = p.name;
            document.getElementById('player-level').textContent = p.level;
            document.getElementById('player-xp').textContent = p.xp;
            document.getElementById('player-next-level').textContent = p.nextLevel;
            document.getElementById('player-xp-bar').style.width = `${(p.xp / p.nextLevel) * 100}%`;
            document.getElementById('player-health').textContent = p.health;
            document.getElementById('player-max-health').textContent = p.maxHealth;
            document.getElementById('player-mana').textContent = p.mana;
            document.getElementById('player-max-mana').textContent = p.maxMana;
            document.getElementById('player-attack').textContent = p.attack;
            document.getElementById('player-defense').textContent = p.defense;
            document.getElementById('player-gold').textContent = p.gold;
            document.getElementById('player-weapon').textContent = p.equipment.weapon.name;
            document.getElementById('player-weapon-dmg').textContent = p.equipment.weapon.damage;
            document.getElementById('player-armor').textContent = p.equipment.armor.name;
            document.getElementById('player-armor-def').textContent = p.equipment.armor.defense;
            
            // Update main menu displays
            document.getElementById('gold-amount').textContent = p.gold;
            
            // Update achievements count
            const unlockedCount = Object.values(gameState.achievements).filter(a => a.unlocked).length;
            document.getElementById('player-achievements').textContent = unlockedCount;
            
            updateProfileInventoryDisplay();
            updateSpellDisplay();
            updateStatusEffectsDisplay();
        }

        function updateProfileInventoryDisplay() {
            const inventoryElement = document.getElementById('player-inventory-items');
            inventoryElement.innerHTML = '';
            
            if (gameState.player.inventory.length === 0) {
                inventoryElement.innerHTML = '<div class="inventory-empty">No items in inventory</div>';
                return;
            }
            
            gameState.player.inventory.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = `compact-item item-${item.rarity}`;
                
                let itemText = `${item.name}`;
                if (item.type === 'weapon') {
                    itemText += ` (DMG +${item.damage})`;
                } else if (item.type === 'armor') {
                    itemText += ` (DEF +${item.defense})`;
                } else if (item.type === 'potion') {
                    itemText += ` (${item.value} ${item.potionType})`;
                } else if (item.type === 'spell') {
                    itemText += ` (DMG: ${item.damage}, Cost: ${item.cost})`;
                }
                
                const textElement = document.createElement('div');
                textElement.textContent = itemText;
                itemElement.appendChild(textElement);
                
                inventoryElement.appendChild(itemElement);
            });
        }

        function updateSpellDisplay() {
            const profileSpells = document.getElementById('profile-spells');
            profileSpells.innerHTML = '';
            
            const battleSpells = document.getElementById('battle-spells');
            battleSpells.innerHTML = '';
            
            gameState.player.unlockedSpells.forEach(spellIndex => {
                const spell = gameState.player.spells[spellIndex];
                
                // Profile display
                const profileSpellElement = document.createElement('div');
                profileSpellElement.className = 'spell';
                profileSpellElement.innerHTML = `
                    <button>${spell.name}</button>
                    <div>${spell.heal ? `Heal: ${spell.heal}` : `DMG: ${spell.damage}`} | Cost: ${spell.cost} | Element: ${spell.element || 'None'}</div>
                `;
                profileSpells.appendChild(profileSpellElement);
                
                // Battle display
                const button = document.createElement('button');
                button.className = 'spell-btn';
                button.setAttribute('data-spell', spellIndex);
                button.textContent = `${spell.name} (${spell.cost} MP)`;
                
                button.addEventListener('click', () => {
                    castSpell(spellIndex);
                });
                
                battleSpells.appendChild(button);
            });
        }

        function updateBattleConsumables() {
            const consumablesElement = document.getElementById('battle-consumables');
            consumablesElement.innerHTML = '';
            
            // Create an array of potion indices in the main inventory
            const potionIndices = [];
            gameState.player.inventory.forEach((item, index) => {
                if (item.type === 'potion') {
                    potionIndices.push(index);
                }
            });
            
            if (potionIndices.length === 0) {
                consumablesElement.style.display = 'none';
                return;
            }
            
            consumablesElement.style.display = 'flex';
            
            potionIndices.forEach(inventoryIndex => {
                const potion = gameState.player.inventory[inventoryIndex];
                const button = document.createElement('button');
                button.className = 'consumable-btn';
                button.textContent = `${potion.name}`;
                button.onclick = () => useConsumable(inventoryIndex);
                consumablesElement.appendChild(button);
            });
        }

        function updateStatusEffectsDisplay() {
            const playerEffectsElement = document.getElementById('player-status-effects');
            const playerBattleEffectsElement = document.getElementById('player-status-effects-battle');
            const enemyEffectsElement = document.getElementById('enemy-status-effects');
            
            // Clear existing displays
            if (playerEffectsElement) playerEffectsElement.innerHTML = '';
            if (playerBattleEffectsElement) playerBattleEffectsElement.innerHTML = '';
            if (enemyEffectsElement) enemyEffectsElement.innerHTML = '';
            
            // Display player status effects
            gameState.player.statusEffects.forEach(effect => {
                const effectElement = document.createElement('span');
                effectElement.className = `status-effect status-${effect.type}`;
                effectElement.textContent = effect.name;
                effectElement.title = effect.description;
                
                if (playerEffectsElement) playerEffectsElement.appendChild(effectElement);
                if (playerBattleEffectsElement) playerBattleEffectsElement.appendChild(effectElement.cloneNode(true));
            });
            
            // Display enemy status effects
            if (gameState.currentEnemy && gameState.currentEnemy.statusEffects) {
                gameState.currentEnemy.statusEffects.forEach(effect => {
                    const effectElement = document.createElement('span');
                    effectElement.className = `status-effect status-${effect.type}`;
                    effectElement.textContent = effect.name;
                    effectElement.title = effect.description;
                    
                    if (enemyEffectsElement) enemyEffectsElement.appendChild(effectElement);
                });
            }
        }

        function updateComboDisplay() {
            const comboCounterMain = document.getElementById('combo-counter-main');
            const comboCounterBattle = document.getElementById('combo-counter-battle');
            
            if (gameState.player.comboCount > 1) {
                const comboText = `Combo: x${gameState.player.comboCount}`;
                if (comboCounterMain) {
                    comboCounterMain.textContent = comboText;
                    comboCounterMain.style.display = 'block';
                }
                if (comboCounterBattle) {
                    comboCounterBattle.textContent = comboText;
                    comboCounterBattle.style.display = 'block';
                }
            } else {
                if (comboCounterMain) comboCounterMain.style.display = 'none';
                if (comboCounterBattle) comboCounterBattle.style.display = 'none';
            }
        }

        // ============== ITEM MANAGEMENT ==============
        function useConsumable(index) {
            // Fix: Use the actual inventory index passed from the UI
            const item = gameState.player.inventory[index];
            
            if (!item) {
                console.error("Item not found at index:", index);
                return;
            }
            
            if (item.type === 'potion') {
                if (item.potionType === 'health') {
                    const healAmount = Math.min(item.value, gameState.player.maxHealth - gameState.player.health);
                    gameState.player.health += healAmount;
                    addToLog(`You used ${item.name} and healed ${healAmount} health!`);
                } else if (item.potionType === 'mana') {
                    const manaAmount = Math.min(item.value, gameState.player.maxMana - gameState.player.mana);
                    gameState.player.mana += manaAmount;
                    addToLog(`You used ${item.name} and restored ${manaAmount} mana!`);
                }
                
                // Remove from inventory using the actual index
                gameState.player.inventory.splice(index, 1);
                
                // Update UI
                updatePlayerProfile();
                updateBattleConsumables();
                updateConsumablesScreen();
                updateInventoryScreen();
                
                // Update battle display if in battle
                if (document.getElementById('battle-player-health')) {
                    document.getElementById('battle-player-health').textContent = gameState.player.health;
                    document.getElementById('battle-player-mana').textContent = gameState.player.mana;
                    document.getElementById('player-health-fill').style.width = 
                        `${(gameState.player.health / gameState.player.maxHealth) * 100}%`;
                    document.getElementById('player-mana-fill').style.width = 
                        `${(gameState.player.mana / gameState.player.maxMana) * 100}%`;
                }
            }
        }

        function equipItem(index) {
            const item = gameState.player.inventory[index];
            
            if (item.type === 'weapon') {
                // Store old weapon
                const oldWeapon = {...gameState.player.equipment.weapon, type: 'weapon', rarity: 'common'};
                
                // Equip new weapon
                gameState.player.equipment.weapon = {
                    name: item.name,
                    damage: item.damage
                };
                
                // Replace item in inventory with old weapon
                gameState.player.inventory[index] = oldWeapon;
                
                addToLog(`You equipped ${item.name}!`);
            } 
            else if (item.type === 'armor') {
                // Store old armor
                const oldArmor = {...gameState.player.equipment.armor, type: 'armor', rarity: 'common'};
                
                // Equip new armor
                gameState.player.equipment.armor = {
                    name: item.name,
                    defense: item.defense
                };
                
                // Replace item in inventory with old armor
                gameState.player.inventory[index] = oldArmor;
                
                addToLog(`You equipped ${item.name}!`);
            }
            else if (item.type === 'spell') {
                // Check if spell is already known
                const spellExists = gameState.player.spells.some(spell => spell.name === item.name);
                if (!spellExists) {
                    // Add new spell
                    gameState.player.spells.push({
                        name: item.name,
                        damage: item.damage,
                        cost: item.cost,
                        element: item.element || "arcane"
                    });
                    gameState.player.unlockedSpells.push(gameState.player.spells.length - 1);
                    
                    // Remove from inventory
                    gameState.player.inventory.splice(index, 1);
                    
                    addToLog(`You learned ${item.name}!`);
                } else {
                    addToLog(`You already know ${item.name}!`);
                    return;
                }
            }
            
            updatePlayerProfile();
            updateInventoryScreen();
        }

        function updateConsumablesScreen() {
            const consumablesList = document.getElementById('consumables-list');
            consumablesList.innerHTML = '';
            
            // Create an array of potion indices in the main inventory
            const potionIndices = [];
            gameState.player.inventory.forEach((item, index) => {
                if (item.type === 'potion') {
                    potionIndices.push(index);
                }
            });
            
            if (potionIndices.length === 0) {
                consumablesList.innerHTML = '<div class="inventory-empty">No consumables in inventory</div>';
                return;
            }
            
            potionIndices.forEach(inventoryIndex => {
                const potion = gameState.player.inventory[inventoryIndex];
                const itemElement = document.createElement('div');
                itemElement.className = `compact-item item-${potion.rarity}`;
                
                const textElement = document.createElement('div');
                textElement.textContent = `${potion.name} - ${potion.value} ${potion.potionType}`;
                itemElement.appendChild(textElement);
                
                const actionsElement = document.createElement('div');
                actionsElement.className = 'compact-actions';
                
                const useButton = document.createElement('button');
                useButton.className = 'compact-action-btn';
                useButton.textContent = 'Use';
                useButton.onclick = () => {
                    useConsumable(inventoryIndex);
                };
                actionsElement.appendChild(useButton);
                
                itemElement.appendChild(actionsElement);
                consumablesList.appendChild(itemElement);
            });
        }

        function updateInventoryScreen() {
            const inventoryItems = document.getElementById('inventory-items');
            inventoryItems.innerHTML = '';
            
            if (gameState.player.inventory.length === 0) {
                inventoryItems.innerHTML = '<div class="inventory-empty">No items in inventory</div>';
                return;
            }
            
            gameState.player.inventory.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = `compact-item item-${item.rarity}`;
                
                let itemText = `${item.name}`;
                if (item.type === 'weapon') {
                    itemText += ` (DMG +${item.damage})`;
                } else if (item.type === 'armor') {
                    itemText += ` (DEF +${item.defense})`;
                } else if (item.type === 'potion') {
                    itemText += ` (${item.value} ${item.potionType})`;
                } else if (item.type === 'spell') {
                    itemText += ` (DMG: ${item.damage}, Cost: ${item.cost})`;
                }
                
                const textElement = document.createElement('div');
                textElement.textContent = itemText;
                itemElement.appendChild(textElement);
                
                const actionsElement = document.createElement('div');
                actionsElement.className = 'compact-actions';
                
                if (item.type === 'potion') {
                    const useButton = document.createElement('button');
                    useButton.className = 'compact-action-btn';
                    useButton.textContent = 'Use';
                    useButton.onclick = () => {
                        useConsumable(index);
                    };
                    actionsElement.appendChild(useButton);
                } else if (item.type === 'weapon' || item.type === 'armor' || item.type === 'spell') {
                    const actionButton = document.createElement('button');
                    actionButton.className = 'compact-action-btn';
                    actionButton.textContent = item.type === 'spell' ? 'Learn' : 'Equip';
                    actionButton.onclick = () => {
                        equipItem(index);
                    };
                    actionsElement.appendChild(actionButton);
                }
                
                itemElement.appendChild(actionsElement);
                inventoryItems.appendChild(itemElement);
            });
        }

        // ============== BATTLE SYSTEM ==============
        function calculateElementalBonus(attackerElement, defenderElement) {
            if (gameState.elementalEffects[attackerElement] && 
                gameState.elementalEffects[attackerElement].strongAgainst === defenderElement) {
                return 1.5; // 50% bonus damage
            }
            if (gameState.elementalEffects[attackerElement] && 
                gameState.elementalEffects[attackerElement].weakAgainst === defenderElement) {
                return 0.75; // 25% reduced damage
            }
            return 1;
        }

        function applyStatusEffect(target, effectType, duration = null) {
            const effect = gameState.statusEffects[effectType];
            if (!effect) return;
            
            // Check if effect already exists
            const existingEffect = target.statusEffects.find(e => e.type === effectType);
            if (existingEffect) {
                existingEffect.duration = duration || effect.duration;
            } else {
                target.statusEffects.push({
                    type: effectType,
                    duration: duration || effect.duration,
                    ...effect
                });
            }
            
            updateStatusEffectsDisplay();
        }

        function processStatusEffects(target) {
            if (!target.statusEffects || target.statusEffects.length === 0) return;
            
            const effectsToRemove = [];
            
            target.statusEffects.forEach((effect, index) => {
                // Apply effect
                if (effect.damagePerTurn) {
                    target.health -= effect.damagePerTurn;
                    addToLog(`${target.name} takes ${effect.damagePerTurn} damage from ${effect.name}!`);
                }
                
                if (effect.manaDrain) {
                    target.mana = Math.max(0, target.mana - effect.manaDrain);
                    addToLog(`${target.name} loses ${effect.manaDrain} mana from ${effect.name}!`);
                }
                
                // Decrement duration
                effect.duration--;
                
                // Check if effect should be removed
                if (effect.duration <= 0) {
                    effectsToRemove.push(index);
                    addToLog(`${effect.name} wears off from ${target.name}.`);
                }
            });
            
            // Remove expired effects
            effectsToRemove.reverse().forEach(index => {
                target.statusEffects.splice(index, 1);
            });
            
            updateStatusEffectsDisplay();
        }

        function updateComboCounter(spellElement) {
            if (gameState.player.lastSpellElement === spellElement) {
                gameState.player.comboCount++;
            } else {
                gameState.player.comboCount = 1;
            }
            gameState.player.lastSpellElement = spellElement;
            
            // Check for combo achievement
            if (gameState.player.comboCount >= 5 && !gameState.achievements.combo_master.unlocked) {
                unlockAchievement('combo_master');
            }
            
            updateComboDisplay();
        }

        function generateLoot(enemyTier) {
            const loot = [];
            const numItems = Math.floor(Math.random() * 2) + 1;
            
            for (let i = 0; i < numItems; i++) {
                const lootType = Math.random();
                let item;
                
                if (lootType < 0.3) {
                    const weaponIndex = Math.min(Math.floor(Math.random() * enemyTier), gameState.lootItems.weapons.length - 1);
                    item = {...gameState.lootItems.weapons[weaponIndex]};
                } else if (lootType < 0.6) {
                    const armorIndex = Math.min(Math.floor(Math.random() * enemyTier), gameState.lootItems.armor.length - 1);
                    item = {...gameState.lootItems.armor[armorIndex]};
                } else if (lootType < 0.9) {
                    const potionIndex = Math.min(Math.floor(Math.random() * enemyTier * 1.5), gameState.lootItems.potions.length - 1);
                    item = {...gameState.lootItems.potions[potionIndex]};
                } else {
                    if (Math.random() < 0.3 && gameState.lootItems.spells.length > 0) {
                        const spellIndex = Math.floor(Math.random() * gameState.lootItems.spells.length);
                        item = {...gameState.lootItems.spells[spellIndex]};
                    } else {
                        const potionIndex = Math.min(Math.floor(Math.random() * enemyTier * 1.5), gameState.lootItems.potions.length - 1);
                        item = {...gameState.lootItems.potions[potionIndex]};
                    }
                }
                
                loot.push(item);
            }
            
            return loot;
        }

        function showLootScreen(loot) {
            const lootItemsElement = document.getElementById('loot-items');
            lootItemsElement.innerHTML = '';
            
            loot.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = `loot-item loot-rarity-${item.rarity}`;
                
                let itemText = `${item.name} `;
                if (item.type === 'weapon') {
                    itemText += `- DMG +${item.damage}`;
                } else if (item.type === 'armor') {
                    itemText += `- DEF +${item.defense}`;
                } else if (item.type === 'potion') {
                    itemText += `- Restores ${item.value} ${item.potionType}`;
                } else if (item.type === 'spell') {
                    itemText += `- DMG: ${item.damage}, Cost: ${item.cost}`;
                }
                
                itemElement.textContent = itemText;
                lootItemsElement.appendChild(itemElement);
            });
            
            gameState.currentLoot = loot;
            showScreen('loot');
        }

        function takeLoot() {
            gameState.currentLoot.forEach(item => {
                if (item.type === 'spell') {
                    const spellExists = gameState.player.spells.some(spell => spell.name === item.name);
                    if (!spellExists) {
                        gameState.player.spells.push({
                            name: item.name,
                            damage: item.damage,
                            cost: item.cost,
                            element: item.element || "arcane"
                        });
                        gameState.player.unlockedSpells.push(gameState.player.spells.length - 1);
                    } else {
                        gameState.player.inventory.push(item);
                    }
                } else {
                    gameState.player.inventory.push(item);
                }
            });
            
            updatePlayerProfile();
            updateInventoryScreen();
            updateConsumablesScreen();
            showScreen('victory');
        }

        function startBattle(enemyType) {
            // Fix: Create a fresh copy of the enemy each time
            gameState.currentEnemy = JSON.parse(JSON.stringify(gameState.enemies[enemyType]));
            
            // Initialize status effects
            gameState.currentEnemy.statusEffects = [];
            
            document.getElementById('enemy-name').textContent = gameState.currentEnemy.name;
            document.getElementById('enemy-ascii').textContent = gameState.currentEnemy.ascii;
            document.getElementById('battle-enemy-health').textContent = gameState.currentEnemy.health;
            document.getElementById('battle-enemy-max-health').textContent = gameState.currentEnemy.maxHealth;
            document.getElementById('battle-enemy-mana').textContent = gameState.currentEnemy.mana;
            document.getElementById('battle-enemy-max-mana').textContent = gameState.currentEnemy.maxMana;
            
            document.getElementById('battle-player-health').textContent = gameState.player.health;
            document.getElementById('battle-player-max-health').textContent = gameState.player.maxHealth;
            document.getElementById('battle-player-mana').textContent = gameState.player.mana;
            document.getElementById('battle-player-max-mana').textContent = gameState.player.maxMana;
            
            document.getElementById('player-health-fill').style.width = `${(gameState.player.health / gameState.player.maxHealth) * 100}%`;
            document.getElementById('player-mana-fill').style.width = `${(gameState.player.mana / gameState.player.maxMana) * 100}%`;
            document.getElementById('enemy-health-fill').style.width = '100%';
            document.getElementById('enemy-mana-fill').style.width = '100%';
            
            gameState.battleLog = ["A wizard duel begins!"];
            updateBattleLog();
            
            updateSpellButtons();
            updateBattleConsumables();
            updateStatusEffectsDisplay();
            updateComboDisplay();
            
            showScreen('battle');
        }

        function updateBattleLog() {
            const logElement = document.getElementById('battle-log');
            logElement.innerHTML = '';
            gameState.battleLog.forEach(entry => {
                const div = document.createElement('div');
                div.innerHTML = entry;
                logElement.appendChild(div);
            });
            logElement.scrollTop = logElement.scrollHeight;
        }

        function addToLog(message) {
            gameState.battleLog.push(message);
            if (gameState.battleLog.length > 10) {
                gameState.battleLog.shift();
            }
            updateBattleLog();
        }

        function updateSpellButtons() {
            const spellButtons = document.querySelectorAll('.spell-btn');
            const manaWarning = document.getElementById('mana-warning');
            const healthWarning = document.getElementById('health-warning');
            let hasEnoughMana = false;
            
            spellButtons.forEach(button => {
                const spellIndex = parseInt(button.dataset.spell);
                const spell = gameState.player.spells[spellIndex];
                
                if (gameState.player.mana >= spell.cost) {
                    button.disabled = false;
                    hasEnoughMana = true;
                } else {
                    button.disabled = true;
                }
            });
            
            manaWarning.style.display = !hasEnoughMana && gameState.player.mana > 0 ? 'block' : 'none';
            healthWarning.style.display = gameState.player.health <= gameState.player.maxHealth * 0.3 ? 'block' : 'none';
        }

        function castSpell(spellIndex) {
            const spell = gameState.player.spells[spellIndex];
            
            if (gameState.player.mana < spell.cost) {
                addToLog("Not enough mana!");
                return;
            }
            
            gameState.player.mana -= spell.cost;
            document.getElementById('battle-player-mana').textContent = gameState.player.mana;
            document.getElementById('player-mana-fill').style.width = 
                `${(gameState.player.mana / gameState.player.maxMana) * 100}%`;
            
            // Update combo
            updateComboCounter(spell.element);
            
            if (spell.name === "Heal") {
                const healAmount = Math.min(spell.heal, gameState.player.maxHealth - gameState.player.health);
                gameState.player.health += healAmount;
                document.getElementById('battle-player-health').textContent = gameState.player.health;
                document.getElementById('player-health-fill').style.width = 
                    `${(gameState.player.health / gameState.player.maxHealth) * 100}%`;
                addToLog(`You cast ${spell.name} and heal ${healAmount} health.`);
            } else {
                const totalAttack = gameState.player.attack + gameState.player.equipment.weapon.damage;
                const elementalBonus = calculateElementalBonus(spell.element, gameState.currentEnemy.element);
                const baseDamage = spell.damage + totalAttack - gameState.currentEnemy.defense;
                const damage = Math.max(1, Math.floor(baseDamage * elementalBonus));
                
                gameState.currentEnemy.health -= damage;
                document.getElementById('battle-enemy-health').textContent = gameState.currentEnemy.health;
                document.getElementById('enemy-health-fill').style.width = 
                    `${(gameState.currentEnemy.health / gameState.currentEnemy.maxHealth) * 100}%`;
                
                let logMessage = `You cast ${spell.name} and deal ${damage} damage.`;
                
                // Show elemental effectiveness
                if (elementalBonus > 1) {
                    logMessage += ` <span class="elemental-bonus">It's super effective!</span>`;
                } else if (elementalBonus < 1) {
                    logMessage += ` <span class="elemental-bonus">It's not very effective...</span>`;
                }
                
                addToLog(logMessage);
                
                // Apply status effect if any
                if (spell.statusEffect) {
                    applyStatusEffect(gameState.currentEnemy, spell.statusEffect);
                }
            }
            
            updateSpellButtons();
            
            if (gameState.currentEnemy.health <= 0) {
                endBattle(true);
                return;
            }
            
            setTimeout(enemyTurn, 1000);
        }

        function enemyTurn() {
            // Process status effects on enemy
            processStatusEffects(gameState.currentEnemy);
            
            // Check if enemy is frozen and skips turn
            const frozen = gameState.currentEnemy.statusEffects.find(e => e.type === 'freeze');
            if (frozen && Math.random() < 0.5) {
                addToLog(`${gameState.currentEnemy.name} is frozen and cannot move!`);
                updateSpellButtons();
                return;
            }
            
            const affordableSpells = gameState.currentEnemy.spells.filter(spell => 
                gameState.currentEnemy.mana >= spell.cost
            );
            
            let spell;
            if (affordableSpells.length > 0) {
                const spellIndex = Math.floor(Math.random() * affordableSpells.length);
                spell = affordableSpells[spellIndex];
            } else {
                // Basic attack if no affordable spells
                const damage = Math.max(1, gameState.currentEnemy.attack - gameState.player.defense);
                gameState.player.health -= damage;
                document.getElementById('battle-player-health').textContent = gameState.player.health;
                document.getElementById('player-health-fill').style.width = 
                    `${(gameState.player.health / gameState.player.maxHealth) * 100}%`;
                addToLog(`${gameState.currentEnemy.name} attacks and deals ${damage} damage.`);
                
                if (gameState.player.health <= 0) {
                    endBattle(false);
                } else {
                    // Process status effects on player
                    processStatusEffects(gameState.player);
                    updateSpellButtons();
                }
                return;
            }
            
            gameState.currentEnemy.mana -= spell.cost;
            document.getElementById('battle-enemy-mana').textContent = gameState.currentEnemy.mana;
            document.getElementById('enemy-mana-fill').style.width = 
                `${(gameState.currentEnemy.mana / gameState.currentEnemy.maxMana) * 100}%`;
            
            if (spell.heal) {
                const healAmount = Math.min(spell.heal, gameState.currentEnemy.maxHealth - gameState.currentEnemy.health);
                gameState.currentEnemy.health += healAmount;
                document.getElementById('battle-enemy-health').textContent = gameState.currentEnemy.health;
                document.getElementById('enemy-health-fill').style.width = 
                    `${(gameState.currentEnemy.health / gameState.currentEnemy.maxHealth) * 100}%`;
                addToLog(`${gameState.currentEnemy.name} casts ${spell.name} and heals ${healAmount} health.`);
            } else {
                const damage = Math.max(1, spell.damage + gameState.currentEnemy.attack - gameState.player.defense);
                gameState.player.health -= damage;
                document.getElementById('battle-player-health').textContent = gameState.player.health;
                document.getElementById('player-health-fill').style.width = 
                    `${(gameState.player.health / gameState.player.maxHealth) * 100}%`;
                addToLog(`${gameState.currentEnemy.name} casts ${spell.name} and deals ${damage} damage.`);
                
                // Apply status effect if any
                if (spell.statusEffect) {
                    applyStatusEffect(gameState.player, spell.statusEffect);
                }
            }
            
            if (gameState.player.health <= 0) {
                endBattle(false);
            } else {
                // Process status effects on player
                processStatusEffects(gameState.player);
                updateSpellButtons();
            }
        }

        function endBattle(playerWon) {
            if (playerWon) {
                addToLog(`You defeated ${gameState.currentEnemy.name}!`);
                
                // Store rewards in gameState for display
                gameState.currentXpReward = gameState.currentEnemy.xpReward;
                gameState.currentGoldReward = gameState.currentEnemy.goldReward;
                
                // Add XP and gold to player
                gameState.player.xp += gameState.currentXpReward;
                gameState.player.gold += gameState.currentGoldReward;
                addToLog(`You gained ${gameState.currentXpReward} XP and ${gameState.currentGoldReward} gold!`);
                
                // Check for first blood achievement
                if (!gameState.achievements.first_blood.unlocked) {
                    unlockAchievement('first_blood');
                }
                
                // Check for rich wizard achievement
                if (gameState.player.gold >= 1000 && !gameState.achievements.rich_wizard.unlocked) {
                    unlockAchievement('rich_wizard');
                }
                
                // Check for dragon slayer achievement
                if (gameState.currentEnemy.name === "Ancient Dragon" && !gameState.achievements.dragon_slayer.unlocked) {
                    unlockAchievement('dragon_slayer');
                }
                
                // Check for elemental master achievement
                const hasFire = gameState.player.spells.some(s => s.element === "fire");
                const hasIce = gameState.player.spells.some(s => s.element === "ice");
                const hasLightning = gameState.player.spells.some(s => s.element === "lightning");
                if (hasFire && hasIce && hasLightning && !gameState.achievements.elemental_master.unlocked) {
                    unlockAchievement('elemental_master');
                }
                
                const loot = generateLoot(gameState.currentEnemy.lootTier);
                
                const manaRestore = Math.floor(gameState.player.maxMana * 0.25);
                gameState.player.mana = Math.min(gameState.player.maxMana, gameState.player.mana + manaRestore);
                addToLog(`You recovered ${manaRestore} mana.`);
                
                // Reset combo
                gameState.player.comboCount = 0;
                gameState.player.lastSpellElement = null;
                updateComboDisplay();
                
                if (loot.length > 0) {
                    setTimeout(() => showLootScreen(loot), 1500);
                } else {
                    setTimeout(() => showVictoryScreen(), 1500);
                }
                
                updatePlayerProfile();
            } else {
                addToLog("You have been defeated!");
                setTimeout(() => showDefeatScreen(), 1500);
            }
        }

        function showVictoryScreen() {
            // Use the stored rewards from the battle
            document.getElementById('victory-xp').textContent = `XP Gained: ${gameState.currentXpReward}`;
            document.getElementById('victory-gold').textContent = `Gold Gained: ${gameState.currentGoldReward}`;
            document.getElementById('victory-message').textContent = `You have defeated ${gameState.currentEnemy.name}!`;
            
            // Check if the player leveled up after the battle
            if (gameState.player.xp >= gameState.player.nextLevel) {
                document.getElementById('victory-level-up').style.display = 'block';
                document.getElementById('new-level').textContent = gameState.player.level + 1;
            } else {
                document.getElementById('victory-level-up').style.display = 'none';
            }
            
            showScreen('victory');
        }

        function showDefeatScreen() {
            document.getElementById('defeat-enemy').textContent = `Defeated by: ${gameState.currentEnemy.name}`;
            document.getElementById('defeat-level').textContent = `Your Level: ${gameState.player.level}`;
            document.getElementById('defeat-xp').textContent = `Current XP: ${gameState.player.xp}`;
            
            showScreen('defeat');
        }

        function applyUpgrade(upgradeType) {
            switch(upgradeType) {
                case 'health':
                    gameState.player.maxHealth += 10;
                    gameState.player.health = gameState.player.maxHealth;
                    break;
                case 'mana':
                    gameState.player.maxMana += 5;
                    gameState.player.mana = gameState.player.maxMana;
                    break;
                case 'attack':
                    gameState.player.attack += 2;
                    break;
                case 'defense':
                    gameState.player.defense += 2;
                    break;
            }
            
            gameState.player.level++;
            gameState.player.xp = 0;
            gameState.player.nextLevel = Math.floor(gameState.player.nextLevel * 1.5);
            
            updatePlayerProfile();
            showScreen('main-menu');
        }

        function resetGame() {
            Object.assign(gameState.player, {
                name: "MERLIN",
                level: 1,
                xp: 0,
                nextLevel: 100,
                health: 50,
                maxHealth: 50,
                mana: 30,
                maxMana: 30,
                attack: 5,
                defense: 3,
                gold: 0,
                statusEffects: [],
                spells: [
                    { name: "Fireball", damage: 8, cost: 5, element: "fire", statusEffect: "burn" },
                    { name: "Ice Shard", damage: 6, cost: 4, element: "ice", statusEffect: "freeze" },
                    { name: "Lightning", damage: 10, cost: 7, element: "lightning", statusEffect: "shock" },
                    { name: "Heal", heal: 10, cost: 6, element: "holy" }
                ],
                equipment: {
                    weapon: { name: "Staff", damage: 2 },
                    armor: { name: "Robes", defense: 1 }
                },
                inventory: [],
                unlockedSpells: [0, 1, 2, 3],
                comboCount: 0,
                lastSpellElement: null
            });
            
            // Reset achievements
            Object.keys(gameState.achievements).forEach(key => {
                gameState.achievements[key].unlocked = false;
            });
            
            updatePlayerProfile();
        }

        function restoreAfterDefeat() {
            gameState.player.health = gameState.player.maxHealth;
            gameState.player.mana = gameState.player.maxMana;
            gameState.player.statusEffects = [];
            updatePlayerProfile();
        }

        function updateEnemySelection() {
            const enemyList = document.getElementById('enemy-list');
            enemyList.innerHTML = '';
            
            Object.keys(gameState.enemies).forEach(enemyType => {
                const enemy = gameState.enemies[enemyType];
                
                const enemyElement = document.createElement('div');
                enemyElement.className = 'enemy';
                
                enemyElement.innerHTML = `
                    <div>
                        <h3>${enemy.name}</h3>
                        <div>Level: ${enemy.level} | Health: ${enemy.health}</div>
                        <div>Element: ${enemy.element}</div>
                        <div>Spells: ${enemy.spells.map(s => s.name).join(', ')}</div>
                    </div>
                    <button class="select-enemy" data-enemy="${enemyType}">FIGHT</button>
                `;
                
                enemyList.appendChild(enemyElement);
            });
            
            // Add event listeners to enemy buttons
            document.querySelectorAll('.select-enemy').forEach(btn => {
                btn.onclick = () => startBattle(btn.dataset.enemy);
            });
        }

        // ============== NEW FEATURES ==============

        // Achievement system
        function unlockAchievement(achievementId) {
            const achievement = gameState.achievements[achievementId];
            if (!achievement || achievement.unlocked) return;
            
            achievement.unlocked = true;
            
            // Show achievement notification
            const notification = document.createElement('div');
            notification.className = 'achievement-notification';
            notification.innerHTML = `
                <h3>Achievement Unlocked!</h3>
                <p>${achievement.name}</p>
                <p>${achievement.description}</p>
                <p>Reward: ${achievement.reward.gold} Gold</p>
                <button onclick="this.parentElement.remove()">OK</button>
            `;
            document.body.appendChild(notification);
            
            // Apply reward
            gameState.player.gold += achievement.reward.gold;
            addToLog(`Achievement Unlocked: ${achievement.name}! Received ${achievement.reward.gold} gold.`);
            
            updatePlayerProfile();
            updateAchievementsScreen();
        }

        function updateAchievementsScreen() {
            const achievementsList = document.getElementById('achievements-list');
            achievementsList.innerHTML = '';
            
            Object.keys(gameState.achievements).forEach(achievementId => {
                const achievement = gameState.achievements[achievementId];
                const achievementElement = document.createElement('div');
                achievementElement.className = `compact-item ${achievement.unlocked ? 'item-rare' : ''}`;
                
                achievementElement.innerHTML = `
                    <div>
                        <h3>${achievement.name}</h3>
                        <p>${achievement.description}</p>
                        <p>Reward: ${achievement.reward.gold} Gold</p>
                        <p>Status: ${achievement.unlocked ? 'Unlocked' : 'Locked'}</p>
                    </div>
                `;
                
                achievementsList.appendChild(achievementElement);
            });
        }

        // Shop system
        function updateShopScreen() {
            const shopItems = document.getElementById('shop-items');
            shopItems.innerHTML = '';
            
            gameState.shopItems.forEach((shopItem, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'compact-item';
                
                const itemInfo = document.createElement('div');
                itemInfo.innerHTML = `
                    <h3>${shopItem.name}</h3>
                    <p>Cost: ${shopItem.cost} gold</p>
                `;
                
                const buyButton = document.createElement('button');
                buyButton.className = 'compact-action-btn';
                buyButton.textContent = 'Buy';
                buyButton.onclick = () => buyItem(index);
                buyButton.disabled = gameState.player.gold < shopItem.cost;
                
                itemElement.appendChild(itemInfo);
                itemElement.appendChild(buyButton);
                shopItems.appendChild(itemElement);
            });
            
            document.getElementById('shop-gold').textContent = gameState.player.gold;
        }

        function buyItem(shopIndex) {
            const shopItem = gameState.shopItems[shopIndex];
            
            if (gameState.player.gold < shopItem.cost) {
                addToLog("Not enough gold!");
                return;
            }
            
            gameState.player.gold -= shopItem.cost;
            gameState.player.inventory.push(shopItem.item);
            
            addToLog(`Purchased ${shopItem.name} for ${shopItem.cost} gold!`);
            
            updatePlayerProfile();
            updateShopScreen();
            updateInventoryScreen();
        }

        // Daily challenge system
        function generateDailyChallenge() {
            // Simple daily challenge - defeat 3 enemies
            gameState.dailyChallenge = {
                available: true,
                completed: false,
                progress: 0,
                required: 3,
                reward: { xp: 200, gold: 100 }
            };
            
            updateDailyChallengeDisplay();
        }

        function updateDailyChallengeDisplay() {
            const dailyChallengeElement = document.getElementById('daily-challenge-main');
            const dailyChallengeInfo = document.getElementById('daily-challenge-info');
            
            if (gameState.dailyChallenge.available && !gameState.dailyChallenge.completed) {
                dailyChallengeElement.style.display = 'block';
                
                if (dailyChallengeInfo) {
                    dailyChallengeInfo.innerHTML = `
                        <h3>Daily Challenge</h3>
                        <p>Defeat ${gameState.dailyChallenge.required} enemies</p>
                        <p>Progress: ${gameState.dailyChallenge.progress}/${gameState.dailyChallenge.required}</p>
                        <p>Reward: ${gameState.dailyChallenge.reward.xp} XP and ${gameState.dailyChallenge.reward.gold} Gold</p>
                        ${gameState.dailyChallenge.completed ? '<p style="color: #0f0;">Completed!</p>' : ''}
                    `;
                }
            } else {
                dailyChallengeElement.style.display = 'none';
            }
        }

        function completeDailyChallenge() {
            if (gameState.dailyChallenge.available && !gameState.dailyChallenge.completed) {
                gameState.dailyChallenge.progress++;
                
                if (gameState.dailyChallenge.progress >= gameState.dailyChallenge.required) {
                    gameState.dailyChallenge.completed = true;
                    gameState.player.xp += gameState.dailyChallenge.reward.xp;
                    gameState.player.gold += gameState.dailyChallenge.reward.gold;
                    
                    addToLog(`Daily Challenge Completed! Received ${gameState.dailyChallenge.reward.xp} XP and ${gameState.dailyChallenge.reward.gold} gold.`);
                    
                    updatePlayerProfile();
                }
                
                updateDailyChallengeDisplay();
            }
        }

        // ============== EVENT LISTENERS ==============
        document.addEventListener('DOMContentLoaded', () => {
            updatePlayerProfile();
            updateEnemySelection();
            generateDailyChallenge();

            // Main menu buttons
            document.getElementById('new-game').onclick = () => { resetGame(); showScreen('enemySelection'); };
            document.getElementById('player-profile').onclick = () => { updatePlayerProfile(); showScreen('playerProfile'); };
            document.getElementById('select-enemy').onclick = () => { updateEnemySelection(); showScreen('enemySelection'); };
            document.getElementById('use-consumables').onclick = () => {
                updateConsumablesScreen();
                showScreen('consumables');
            };
            document.getElementById('shop-btn').onclick = () => {
                updateShopScreen();
                showScreen('shop');
            };
            document.getElementById('achievements-btn').onclick = () => {
                updateAchievementsScreen();
                showScreen('achievements');
            };
            document.getElementById('daily-challenge-btn').onclick = () => {
                updateDailyChallengeDisplay();
                showScreen('daily-challenge');
            };

            // Navigation buttons
            document.getElementById('back-from-profile').onclick = () => showScreen('mainMenu');
            document.getElementById('back-from-enemies').onclick = () => showScreen('mainMenu');
            document.getElementById('flee').onclick = () => {
                addToLog("You fled from the battle!");
                const manaRestore = Math.floor(gameState.player.maxMana * 0.5);
                gameState.player.mana = Math.min(gameState.player.maxMana, gameState.player.mana + manaRestore);
                addToLog(`You recovered ${manaRestore} mana while fleeing.`);
                setTimeout(() => showScreen('mainMenu'), 1000);
            };
            document.getElementById('continue-after-victory').onclick = () => {
                // Update daily challenge progress on victory
                completeDailyChallenge();
                
                if (gameState.player.xp >= gameState.player.nextLevel) {
                    showScreen('upgrade');
                } else {
                    showScreen('mainMenu');
                }
            };
            document.getElementById('try-again').onclick = () => {
                restoreAfterDefeat();
                showScreen('enemySelection');
            };
            document.getElementById('main-menu-after-defeat').onclick = () => {
                restoreAfterDefeat();
                showScreen('mainMenu');
            };

            // Loot screen
            document.getElementById('take-loot').onclick = () => takeLoot();

            // Consumables screen
            document.getElementById('back-from-consumables').onclick = () => showScreen('mainMenu');

            // Shop screen
            document.getElementById('back-from-shop').onclick = () => showScreen('mainMenu');

            // Achievements screen
            document.getElementById('back-from-achievements').onclick = () => showScreen('mainMenu');

            // Daily challenge screen
            document.getElementById('back-from-daily').onclick = () => showScreen('mainMenu');
            document.getElementById('start-daily-challenge').onclick = () => {
                showScreen('enemySelection');
            };

            // Enemy selection
            document.querySelectorAll('.select-enemy').forEach(btn => {
                btn.onclick = () => startBattle(btn.dataset.enemy);
            });

            // Upgrade buttons
            document.querySelectorAll('.upgrade-btn').forEach(btn => {
                btn.onclick = () => {
                    const upgradeType = btn.dataset.upgrade;
                    applyUpgrade(upgradeType);
                };
            });

            // Inventory management button
            document.getElementById('manage-inventory').onclick = () => {
                updateInventoryScreen();
                showScreen('inventory');
            };

            // Back button for inventory screen
            document.getElementById('back-from-inventory').onclick = () => showScreen('playerProfile');
        });
    </script>
</body>
</html>
