<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Highway Hauntings - Route 66 Supernatural</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }
        
        body {
            background-color: #0a0a14;
            color: #8b0000;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(139, 0, 0, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(47, 79, 79, 0.1) 0%, transparent 20%),
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 1px,
                    rgba(47, 79, 79, 0.05) 1px,
                    rgba(47, 79, 79, 0.05) 2px
                );
        }
        
        #game-container {
            width: 100%;
            max-width: 500px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            border: 2px solid #8b0000;
            background-color: #0a0a14;
            position: relative;
            box-shadow: 0 0 20px rgba(139, 0, 0, 0.5);
            overflow: hidden;
        }
        
        .screen {
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            padding: 10px;
            overflow-y: auto;
        }
        
        .active {
            display: flex !important;
        }
        
        h1, h2, h3 {
            color: #d4af37;
            text-align: center;
            margin: 10px 0;
            text-transform: uppercase;
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.7);
            font-family: 'Georgia', serif;
        }
        
        .button {
            background-color: #1a1a2a;
            color: #d4af37;
            border: 1px solid #8b0000;
            padding: 10px;
            margin: 5px 0;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            font-family: 'Georgia', serif;
        }
        
        .button:hover {
            background-color: #8b0000;
            color: #f5f5dc;
            box-shadow: 0 0 10px rgba(139, 0, 0, 0.7);
        }
        
        .button:active {
            transform: scale(0.98);
        }
        
        .button.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            border-bottom: 1px dashed #8b0000;
            padding-bottom: 10px;
        }
        
        .log {
            border: 1px solid #8b0000;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            margin: 10px 0;
            font-size: 14px;
            background-color: rgba(26, 26, 42, 0.8);
            font-family: 'Georgia', serif;
            line-height: 1.4;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 3px;
            border-left: 2px solid transparent;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .radio-active {
            border-left: 2px solid #d4af37 !important;
            background: rgba(212, 175, 55, 0.1);
        }
        
        .inventory-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
        }
        
        .item {
            border: 1px solid #8b0000;
            padding: 8px;
            cursor: pointer;
            position: relative;
            background-color: rgba(26, 26, 42, 0.8);
        }
        
        .item-stats {
            font-size: 12px;
            margin-top: 5px;
            color: #d4af37;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #000;
            border: 1px solid #8b0000;
            margin: 5px 0;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            width: 0%;
            transition: width 0.3s;
        }
        
        .gas-bar .progress-fill {
            background-color: #d4af37;
        }
        
        .sanity-bar .progress-fill {
            background-color: #8b0000;
        }
        
        .money-bar .progress-fill {
            background-color: #228b22;
        }
        
        .class-select {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        
        .class-option {
            border: 1px solid #8b0000;
            padding: 15px;
            cursor: pointer;
            background-color: rgba(26, 26, 42, 0.8);
        }
        
        .class-option:hover {
            background-color: #8b0000;
            color: #f5f5dc;
        }
        
        .travel-display {
            display: flex;
            justify-content: space-around;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        
        .location-slot {
            border: 1px solid #8b0000;
            padding: 5px;
            margin: 5px;
            min-width: 80px;
            text-align: center;
            background-color: rgba(26, 26, 42, 0.8);
            position: relative;
        }
        
        .location-danger {
            font-size: 10px;
            color: #ff5555;
        }
        
        .location-clues {
            font-size: 10px;
            color: #00ffff;
        }
        
        .money-counter {
            color: #228b22;
            font-weight: bold;
        }
        
        .radio-button {
            background: linear-gradient(45deg, #8b0000, #d4af37);
            color: #f5f5dc;
            border: 1px solid #00ffff;
        }
        
        .floating-text {
            position: absolute;
            font-weight: bold;
            pointer-events: none;
            z-index: 100;
            animation: floatUp 1s ease-out forwards;
            font-family: 'Georgia', serif;
        }
        
        .damage-text {
            color: #ff5555;
        }
        
        .clue-text {
            color: #00ffff;
        }
        
        .money-text {
            color: #228b22;
        }
        
        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-30px); opacity: 0; }
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .rarity-common { color: #fff; }
        .rarity-uncommon { color: #1eff00; }
        .rarity-rare { color: #0070dd; }
        .rarity-epic { color: #a335ee; }
        .rarity-legendary { color: #ff8000; }
        
        .tooltip {
            position: absolute;
            background: #1a1a2a;
            border: 1px solid #8b0000;
            padding: 8px;
            z-index: 1000;
            max-width: 250px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            font-family: 'Georgia', serif;
        }
        
        .tooltip.show {
            opacity: 1;
        }
        
        .investigation-bars {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin: 10px 0;
        }
        
        .investigation-bar-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .investigation-bar-label {
            width: 80px;
            font-size: 12px;
        }
        
        .investigation-bar {
            flex: 1;
            height: 15px;
            background-color: #000;
            border: 1px solid #8b0000;
            position: relative;
            overflow: hidden;
        }
        
        .investigation-bar-fill {
            height: 100%;
            transition: width 0.3s;
        }
        
        .gas-fill {
            background-color: #d4af37;
        }
        
        .sanity-fill {
            background-color: #8b0000;
        }
        
        .investigation-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
        }
        
        .evidence-slot {
            border: 1px solid #8b0000;
            padding: 10px;
            background-color: rgba(26, 26, 42, 0.8);
        }
        
        .evidence-equipment {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            margin-top: 10px;
        }
        
        .evidence-equip-slot {
            border: 1px dashed #8b0000;
            padding: 5px;
            text-align: center;
            font-size: 10px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .upgrade-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
        }
        
        .upgrade-slot {
            border: 1px solid #8b0000;
            padding: 10px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(26, 26, 42, 0.8);
            cursor: pointer;
        }
        
        .upgrade-slot.selected {
            border-color: #00ffff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.7);
        }
        
        .upgrade-preview {
            border: 1px solid #00ffff;
            padding: 10px;
            margin: 10px 0;
            background-color: rgba(0, 255, 255, 0.1);
        }
        
        .evidence-item {
            border: 1px solid #8b0000;
            padding: 5px;
            margin: 2px;
            font-size: 10px;
            text-align: center;
            cursor: pointer;
            background-color: rgba(26, 26, 42, 0.8);
        }
        
        .tab-container {
            display: flex;
            border-bottom: 1px solid #8b0000;
            margin-bottom: 10px;
        }
        
        .tab {
            padding: 8px 15px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            margin-right: 5px;
            font-family: 'Georgia', serif;
        }
        
        .tab.active {
            border-color: #8b0000;
            background-color: rgba(139, 0, 0, 0.2);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .enhanced-button {
            background: linear-gradient(45deg, #8b0000, #d4af37);
            color: #f5f5dc;
            border: 1px solid #00ffff;
            position: relative;
            overflow: hidden;
            font-family: 'Georgia', serif;
        }
        
        .enhanced-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .enhanced-button:hover::before {
            left: 100%;
        }
        
        .location-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1a1a2a;
            border: 2px solid #8b0000;
            padding: 20px;
            z-index: 1000;
            max-width: 90%;
            max-height: 80%;
            overflow: auto;
            box-shadow: 0 0 20px rgba(139, 0, 0, 0.7);
        }
        
        .location-option {
            border: 1px solid #8b0000;
            padding: 10px;
            margin: 5px 0;
            cursor: pointer;
            background-color: rgba(26, 26, 42, 0.8);
        }
        
        .location-option:hover {
            background-color: rgba(139, 0, 0, 0.3);
        }
        
        .investigatable-items {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .investigatable-item {
            border: 1px solid #8b0000;
            padding: 8px;
            cursor: pointer;
            background-color: rgba(26, 26, 42, 0.8);
        }
        
        .investigatable-item:hover {
            border-color: #00ffff;
        }
        
        .investigatable-item.selected {
            border-color: #00ffff;
            background-color: rgba(0, 255, 255, 0.1);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        .encounter-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1a1a2a;
            border: 2px solid #8b0000;
            padding: 20px;
            z-index: 1000;
            max-width: 90%;
            max-height: 80%;
            overflow: auto;
            box-shadow: 0 0 20px rgba(139, 0, 0, 0.7);
        }

        .car-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
            border-bottom: 1px dashed #8b0000;
            padding-bottom: 10px;
        }

        .car-upgrades {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .car-upgrade-slot {
            border: 1px solid #8b0000;
            padding: 15px;
            background-color: rgba(26, 26, 42, 0.8);
            text-align: center;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .car-upgrade-slot.installed {
            border-color: #d4af37;
            background-color: rgba(212, 175, 55, 0.1);
        }

        .car-upgrade-slot.unlocked {
            border-color: #1eff00;
        }

        .car-upgrade-slot.locked {
            opacity: 0.6;
            background-color: rgba(26, 26, 42, 0.5);
        }

        .upgrade-level {
            color: #00ffff;
            font-weight: bold;
        }

        .upgrade-effect {
            color: #1eff00;
            font-size: 12px;
        }

        .upgrade-cost {
            color: #ff5555;
            font-size: 12px;
        }

        .radio-log {
            border: 1px solid #8b0000;
            padding: 10px;
            background-color: rgba(26, 26, 42, 0.8);
            margin: 10px 0;
        }

        .radio-message {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 14px;
        }
        
        .encounter-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
        }
        
        .encounter-stat {
            border: 1px solid #8b0000;
            padding: 5px;
            text-align: center;
        }
        
        .encounter-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
        }
        
        .equipment-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1a1a2a;
            border: 2px solid #8b0000;
            padding: 20px;
            z-index: 1000;
            max-width: 90%;
            max-height: 80%;
            overflow: auto;
            box-shadow: 0 0 20px rgba(139, 0, 0, 0.7);
        }
        
        .equipment-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .audio-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            z-index: 100;
        }
        
        .audio-btn {
            background: rgba(26, 26, 42, 0.8);
            border: 1px solid #8b0000;
            color: #8b0000;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
            font-family: 'Georgia', serif;
        }
        
        .audio-btn:hover {
            background: #8b0000;
            color: #f5f5dc;
        }
        
        .accessibility-controls {
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            gap: 5px;
            z-index: 100;
        }
        
        .accessibility-btn {
            background: rgba(26, 26, 42, 0.8);
            border: 1px solid #8b0000;
            color: #8b0000;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
            font-family: 'Georgia', serif;
        }
        
        .accessibility-btn:hover {
            background: #8b0000;
            color: #f5f5dc;
        }
        
        .font-small {
            font-size: 12px;
        }
        
        .font-medium {
            font-size: 14px;
        }
        
        .font-large {
            font-size: 16px;
        }
        
        .font-xlarge {
            font-size: 18px;
        }
        
        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .tutorial-box {
            background: #1a1a2a;
            border: 2px solid #8b0000;
            padding: 20px;
            max-width: 80%;
            max-height: 80%;
            overflow-y: auto;
            box-shadow: 0 0 20px rgba(139, 0, 0, 0.7);
        }
        
        .tutorial-highlight {
            position: relative;
            z-index: 1999;
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5), 0 0 10px 2px #00ffff;
        }
        
        .tutorial-progress {
            margin-top: 10px;
            text-align: center;
            font-size: 12px;
            color: #8b0000;
        }
        
        .gas-low {
            animation: pulse-warning 1s infinite;
        }
        
        .sanity-low {
            animation: pulse-red 1s infinite;
        }
        
        @keyframes pulse-warning {
            0%, 100% { background-color: transparent; }
            50% { background-color: rgba(255, 215, 0, 0.2); }
        }
        
        @keyframes pulse-red {
            0%, 100% { background-color: transparent; }
            50% { background-color: rgba(139, 0, 0, 0.2); }
        }
        
        .defeat-screen h2 {
            color: #ff5555;
            animation: pulse 2s infinite;
        }
        
        .defeat-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .defeat-penalty {
            color: #ff5555;
            font-weight: bold;
        }
        
        .defeat-message {
            color: #8b0000;
            text-align: center;
            margin: 10px 0;
        }

        .evidence-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 10px 0;
        }

        .evidence-display .evidence-item {
            min-height: 100px;
            padding: 15px;
            font-size: 16px;
            border: 1px solid #8b0000;
            text-align: center;
            cursor: pointer;
            background-color: rgba(26, 26, 42, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .class-occultist { border-color: #8b0000; }
        .class-skeptic { border-color: #2f4f4f; }
        .class-drifter { border-color: #d4af37; }

        .class-occultist:hover { background-color: #8b0000; }
        .class-skeptic:hover { background-color: #2f4f4f; }
        .class-drifter:hover { background-color: #d4af37; }

        .set-item {
            border: 1px solid #ffd700 !important;
            box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
        }

        .legendary-item {
            border: 2px solid #ff8000 !important;
            animation: legendary-glow 2s infinite alternate;
            box-shadow: 0 0 10px rgba(255, 128, 0, 0.7);
        }

        @keyframes legendary-glow {
            0% { box-shadow: 0 0 5px rgba(255, 128, 0, 0.5); }
            100% { box-shadow: 0 0 15px rgba(255, 128, 0, 1); }
        }

        .road-animation {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent 50%, rgba(139, 0, 0, 0.1) 50%);
            background-size: 20px 100%;
            animation: road-move 1s linear infinite;
            pointer-events: none;
            opacity: 0.3;
        }

        @keyframes road-move {
            0% { background-position: 0 0; }
            100% { background-position: 20px 0; }
        }

        .radio-static {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.65" numOctaves="3" stitchTiles="stitch"/></filter><rect width="100" height="100" filter="url(%23noise)" opacity="0.1"/></svg>');
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .radio-static.active {
            opacity: 0.1;
        }
        
        .item:hover .tooltip {
            display: block;
        }
        
        #find-mystery-btn {
            background: linear-gradient(45deg, #8b0000, #2f4f4f);
            border: 1px solid #00ffff;
        }
        
        @keyframes pulse-animation {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse-animation {
            animation: pulse-animation 1s infinite;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- Road Animation -->
        <div class="road-animation" id="road-animation"></div>
        
        <!-- Radio Static Overlay -->
        <div class="radio-static" id="radio-static"></div>
        
        <!-- Audio Controls -->
        <div class="audio-controls">
            <button class="audio-btn" id="music-toggle">Music: ON</button>
            <button class="audio-btn" id="sfx-toggle">SFX: ON</button>
        </div>
        
        <!-- Accessibility Controls -->
        <div class="accessibility-controls">
            <button class="accessibility-btn" id="font-size-btn">Font: Medium</button>
            <button class="accessibility-btn" id="tutorial-btn">Tutorial</button>
        </div>
        
        <!-- Start Screen -->
        <div id="start-screen" class="screen active">
            <h1>HIGHWAY HAUNTINGS</h1>
            <h3>Route 66 Supernatural Investigation</h3>
            <div style="margin: 40px 0; text-align: center;">
                <p>The year is 1978. You're driving down Route 66...</p>
                <p>The radio crackles with more than static.</p>
                <p>Lost souls whisper from roadside diners.</p>
                <p>Something watches from the desert.</p>
                <p style="color: #d4af37; margin-top: 20px;">Solve mysteries. Survive the road. Don't run out of gas.</p>
            </div>
            <div class="button enhanced-button" id="start-button">START YOUR ENGINE</div>
            <div class="button" id="load-button">CONTINUE JOURNEY</div>
        </div>
        
        <!-- Class Selection Screen -->
        <div id="class-screen" class="screen">
            <h1>CHOOSE YOUR DRIVER</h1>
            <div class="class-select">
                <div class="class-option class-occultist" data-class="occultist">
                    <h3>THE OCCULTIST</h3>
                    <p>Knows ancient rituals and forbidden lore</p>
                    <p>+20% to supernatural investigations</p>
                    <p>Starts with Ritual Kit and Occult Library</p>
                    <p style="color: #8b0000;">"The old gods still walk these roads..."</p>
                </div>
                <div class="class-option class-skeptic" data-class="skeptic">
                    <h3>THE SKEPTIC</h3>
                    <p>Investigative journalist seeking the truth</p>
                    <p>+30% to gathering evidence</p>
                    <p>Starts with Camera and Tape Recorder</p>
                    <p style="color: #2f4f4f;">"There's always a rational explanation..."</p>
                </div>
                <div class="class-option class-drifter" data-class="drifter">
                    <h3>THE DRIFTER</h3>
                    <p>Seen too much, survived everything</p>
                    <p>+25% to survival and car maintenance</p>
                    <p>Starts with Tool Kit and Road Map</p>
                    <p style="color: #d4af37;">"Some roads shouldn't be traveled at night..."</p>
                </div>
            </div>
        </div>
        
        <!-- Main Game Screen -->
        <div id="game-screen" class="screen">
            <h2>ROUTE 66 - MILE 0</h2>
            <div class="stats">
                <div>
                    <div>Location: <span id="current-location">Starting Point</span></div>
                    <div>Gas: <span id="player-gas">100</span>/<span id="player-max-gas">100</span></div>
                    <div>Sanity: <span id="player-sanity">80</span>/<span id="player-max-sanity">100</span></div>
                </div>
                <div>
                    <div>Cash: $<span id="player-cash" class="money-counter">50</span></div>
                    <div>Day: <span id="player-day">1</span></div>
                    <div>Mysteries: <span id="player-mysteries">0</span></div>
                </div>
            </div>
            
            <div class="progress-bar gas-bar">
                <div id="gas-bar" class="progress-fill" style="width: 100%"></div>
            </div>
            <div class="progress-bar sanity-bar">
                <div id="sanity-bar" class="progress-fill" style="width: 80%"></div>
            </div>
            <div class="progress-bar money-bar">
                <div id="cash-bar" class="progress-fill" style="width: 50%"></div>
            </div>
            
            <h3>CURRENT INVESTIGATION</h3>
            <div id="current-investigation" style="text-align: center; margin: 10px 0; padding: 10px; border: 1px solid #8b0000; background-color: rgba(26, 26, 42, 0.8);">
                No active investigation
            </div>
            
            <h3>CAR STATUS</h3>
            <div class="travel-display" id="car-display">
                <div class="location-slot">Engine: OK</div>
                <div class="location-slot">Tires: Good</div>
                <div class="location-slot">Radio: Static</div>
            </div>
            
            <div class="button enhanced-button" id="drive-button">DRIVE TO NEXT TOWN</div>
            <div class="button" id="investigate-button">INVESTIGATE AREA</div>
            <div class="button" id="inventory-button">CAR INVENTORY</div>
            <div class="button" id="radio-button">SCAN RADIO</div>
            <div class="button" id="upgrades-button">CAR UPGRADES</div>
            <div class="button" id="map-button">CHECK MAP</div>
            <div class="button" id="rest-button">REST AT MOTEL</div>
            <div class="button" id="save-button">SAVE PROGRESS</div>
            <div class="button" id="find-mystery-btn" style="display: none;">FIND MYSTERY ($25)</div>
            
            <div class="log" id="game-log">
                <div class="log-entry">The engine hums as you pull onto Route 66. The road stretches into darkness...</div>
                <div class="log-entry radio-active">RADIO: "...strange lights reported near mile marker 42..."</div>
            </div>
        </div>
        
        <!-- Drive/Encounter Screen -->
        <div id="drive-screen" class="screen">
            <h2>ON THE ROAD</h2>
            
            <div class="investigation-bars">
                <div class="investigation-bar-container">
                    <div class="investigation-bar-label">Gas:</div>
                    <div class="investigation-bar">
                        <div id="drive-gas-bar" class="investigation-bar-fill gas-fill" style="width: 100%"></div>
                    </div>
                </div>
                <div class="investigation-bar-container">
                    <div class="investigation-bar-label">Sanity:</div>
                    <div class="investigation-bar">
                        <div id="drive-sanity-bar" class="investigation-bar-fill sanity-fill" style="width: 80%"></div>
                    </div>
                </div>
                <div class="investigation-bar-container">
                    <div class="investigation-bar-label">Distance:</div>
                    <div class="investigation-bar">
                        <div id="distance-bar" class="investigation-bar-fill" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            
            <div class="stats">
                <div>
                    <div>Gas: <span id="drive-player-gas">100</span>/<span id="drive-player-max-gas">100</span></div>
                    <div>Sanity: <span id="drive-player-sanity">80</span>/<span id="drive-player-max-sanity">100</span></div>
                </div>
                <div>
                    <div>Cash: $<span id="drive-player-cash" class="money-counter">50</span></div>
                    <div>Next Town: <span id="next-town">50</span> miles</div>
                </div>
            </div>
            
            <h3>ROAD AHEAD</h3>
            <div class="log" id="drive-log">
                <div class="log-entry">Headlights cut through the darkness. The radio crackles...</div>
            </div>
            
            <div id="encounter-display" style="text-align: center; margin: 20px 0; font-size: 18px;">
                [DRIVING...]
            </div>
            
            <div id="encounter-actions" style="display: none;">
                <h3>ENCOUNTER</h3>
                <div id="encounter-description"></div>
                <div class="encounter-actions" id="encounter-choices">
                </div>
            </div>
            
            <div id="drive-actions">
                <div class="button" id="continue-drive">CONTINUE DRIVING</div>
                <div class="button" id="stop-car">PULL OVER</div>
                <div class="button" id="check-radio">CHECK RADIO</div>
                <div class="button" id="return-to-map">RETURN TO MAP</div>
            </div>
        </div>
        
        <!-- Investigation Screen -->
        <div id="investigate-screen" class="screen">
            <h2>INVESTIGATION</h2>
            
            <div class="stats">
                <div>Location: <span id="investigate-location">Current Area</span></div>
                <div>Clues Found: <span id="clues-found">0</span>/<span id="clues-needed">0</span></div>
            </div>
            
            <h3>ACTIVE MYSTERY</h3>
            <div id="mystery-description" class="log" style="height: 100px;">
                No active mystery
            </div>
            
            <h3>GATHER EVIDENCE</h3>
            <div class="investigation-grid" id="investigation-options">
                <!-- Investigation options appear here -->
            </div>
            
            <h3>EVIDENCE COLLECTED</h3>
            <div id="evidence-collected" class="log" style="height: 150px; overflow-y: auto;">
                No evidence collected yet.
            </div>
            
            <div class="button enhanced-button" id="solve-button">SOLVE MYSTERY</div>
            <div class="button" id="back-from-investigate">RETURN TO CAR</div>
        </div>
        
        <!-- Inventory Screen -->
        <div id="inventory-screen" class="screen">
            <h2>CAR INVENTORY</h2>
            <div class="tab-container">
                <div class="tab active" data-tab="items">Supplies</div>
                <div class="tab" data-tab="evidence">Evidence</div>
                <div class="tab" data-tab="tools">Tools</div>
                <div class="tab" data-tab="notes">Case Notes</div>
            </div>
            
            <div class="tab-content active" id="items-tab">
                <div class="car-stats">
                    <div>Gas Cans: <span id="gas-cans">1</span></div>
                    <div>Food Rations: <span id="food-rations">3</span></div>
                    <div>First Aid: <span id="first-aid">2</span></div>
                    <div>Spare Parts: <span id="spare-parts">0</span></div>
                </div>
                <div class="inventory-grid" id="inventory-items">
                    <!-- Inventory items appear here -->
                </div>
            </div>
            
            <div class="tab-content" id="evidence-tab">
                <h3>COLLECTED EVIDENCE</h3>
                <div id="evidence-display" class="inventory-grid">
                    <!-- Evidence appears here -->
                </div>
            </div>
            
            <div class="tab-content" id="tools-tab">
                <h3>INVESTIGATION TOOLS</h3>
                <div id="tools-display" class="inventory-grid">
                    <!-- Tools appear here -->
                </div>
            </div>
            
            <div class="tab-content" id="notes-tab">
                <h3>CASE NOTES</h3>
                <div id="notes-display" class="log">
                    <!-- Case notes appear here -->
                </div>
            </div>
            
            <div class="button" id="back-from-inventory">BACK TO CAR</div>
        </div>
        
        <!-- Radio Screen -->
        <div id="radio-screen" class="screen">
            <h2>CAR RADIO</h2>
            <div class="stats">
                <div>Signal Strength: <span id="signal-strength">50%</span></div>
                <div>Frequency: <span id="current-frequency">88.5 FM</span></div>
                <div>Battery: <span id="radio-battery">100%</span></div>
            </div>
            
            <div class="radio-log" id="radio-log">
                <div class="radio-message">
                    <span>Police Band: "...missing persons report..."</span>
                    <span style="color: #d4af37;">[88.5 FM]</span>
                </div>
                <div class="radio-message">
                    <span>Weather: "...unexplained fog patterns..."</span>
                    <span style="color: #d4af37;">[92.3 FM]</span>
                </div>
                <div class="radio-message">
                    <span>Static: "...help us..."</span>
                    <span style="color: #8b0000;">[Unknown]</span>
                </div>
            </div>
            
            <h3>TUNE FREQUENCY</h3>
            <div class="investigation-grid">
                <div class="button" data-freq="88.5">88.5 FM (Police)</div>
                <div class="button" data-freq="92.3">92.3 FM (Weather)</div>
                <div class="button" data-freq="95.7">95.7 FM (News)</div>
                <div class="button" data-freq="98.1">98.1 FM (Music)</div>
                <div class="button enhanced-button" data-freq="scan">SCAN FOR SIGNALS</div>
                <div class="button" data-freq="static">LISTEN TO STATIC</div>
            </div>
            
            <div class="button" id="back-from-radio">TURN OFF RADIO</div>
        </div>
        
        <!-- Car Upgrades Screen -->
        <div id="upgrades-screen" class="screen">
            <h2>CAR UPGRADES</h2>
            <div class="car-stats">
                <div>Cash: $<span id="upgrade-cash" class="money-counter">50</span></div>
                <div>Car Condition: <span id="car-condition">Good</span></div>
                <div>Trunk Space: <span id="trunk-space">10/20</span></div>
            </div>
            
            <h3>AVAILABLE UPGRADES</h3>
            <div class="car-upgrades" id="car-upgrades-grid">
                <!-- Car upgrades appear here -->
            </div>
            
            <h3>INSTALLED UPGRADES</h3>
            <div id="installed-upgrades" class="log">
                <!-- Installed upgrades appear here -->
            </div>
            
            <div class="button" id="back-from-upgrades">BACK TO CAR</div>
        </div>
        
        <!-- Map Screen -->
        <div id="map-screen" class="screen">
            <h2>ROUTE 66 MAP</h2>
            <div class="stats">
                <div>Current Mile: <span id="current-mile">0</span></div>
                <div>Next Town: <span id="map-next-town">50 miles</span></div>
                <div>Gas Stations: <span id="gas-stations">1 ahead</span></div>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <pre style="color: #d4af37; font-family: monospace;">
    CHICAGO ─────────┐
                     │
    ST. LOUIS ───────┘
                     │
    OKLAHOMA CITY ───┘
                     │
    AMARILLO ────────┘
                     │
    ALBUQUERQUE ─────┘
                     │
    FLAGSTAFF ───────┘
                     │
    LOS ANGELES ─────┘
                </pre>
            </div>
            
            <h3>KNOWN MYSTERIES</h3>
            <div id="map-mysteries" class="log">
                <!-- Known mysteries appear here -->
            </div>
            
            <div class="button enhanced-button" id="plan-route">PLAN ROUTE</div>
            <div class="button" id="back-from-map">BACK TO CAR</div>
        </div>
        
        <!-- Rest Screen -->
        <div id="rest-screen" class="screen">
            <h2>MOTEL STOP</h2>
            
            <div class="stats">
                <div>Cash: $<span id="rest-cash" class="money-counter">50</span></div>
                <div>Room Cost: $<span id="room-cost">20</span></div>
                <div>Food Cost: $<span id="food-cost">10</span></div>
            </div>
            
            <div class="log" id="motel-description">
                <div class="log-entry">The "Desert Star Motel" sign flickers in the night.</div>
                <div class="log-entry">Room 13 is available... if you dare.</div>
            </div>
            
            <h3>OPTIONS</h3>
            <div class="investigation-grid">
                <div class="button" id="rest-cheap">SLEEP IN CAR (Free)</div>
                <div class="button" id="rest-room">RENT ROOM ($20)</div>
                <div class="button" id="rest-food">BUY FOOD ($10)</div>
                <div class="button" id="rest-gas">BUY GAS ($30/Can)</div>
                <div class="button" id="rest-find-mystery">LISTEN FOR RUMORS ($15)</div>
                <div class="button" id="rest-leave">LEAVE MOTEL</div>
            </div>
            
            <h3>NOTICE BOARD</h3>
            <div id="notice-board" class="log" style="height: 100px;">
                <div class="log-entry">"Missing: Traveling salesman, last seen near mile 156"</div>
                <div class="log-entry">"Wanted: Information about glowing rocks"</div>
            </div>
        </div>
        
        <!-- Mystery Solved Screen -->
        <div id="solved-screen" class="screen">
            <h2>MYSTERY SOLVED!</h2>
            <div class="log">
                <div class="log-entry">You've uncovered the truth!</div>
                <div class="log-entry" id="solution-text"></div>
                <div class="log-entry">Rewards:</div>
                <div id="reward-items">
                </div>
            </div>
            <div class="button" id="continue-after-solve">CONTINUE JOURNEY</div>
        </div>
        
        <!-- Defeat Screen -->
        <div id="defeat-screen" class="screen">
            <h2>STRANDED</h2>
            <div class="log">
                <div class="log-entry">The road has claimed another traveler...</div>
                <div class="log-entry" id="defeat-message"></div>
                <div class="log-entry" id="loss-message"></div>
                <div class="log-entry">A tow truck finds you days later...</div>
            </div>
            <div class="defeat-options">
                <div class="button enhanced-button" id="continue-from-defeat">CONTINUE FROM LAST TOWN</div>
                <div class="button" id="return-to-menu-from-defeat">MAIN MENU</div>
            </div>
        </div>
    </div>

    <script>
        // ================================================
        // HIGHWAY HAUNTINGS - Route 66 Supernatural
        // ================================================

        // Audio System with Web Audio API
        const audioSystem = {
            context: null,
            enabled: { music: true, sfx: true },
            
            init: function() {
                try {
                    this.context = new (window.AudioContext || window.webkitAudioContext)();
                    console.log("Audio system initialized");
                } catch (e) {
                    console.error("Web Audio API not supported:", e);
                    this.context = null;
                }
            },
            
            playClick: function() {
                if (!this.enabled.sfx || !this.context) return;
                
                const oscillator = this.context.createOscillator();
                const gainNode = this.context.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.context.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.1, this.context.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.context.currentTime + 0.1);
                
                oscillator.start();
                oscillator.stop(this.context.currentTime + 0.1);
            },
            
            playEngine: function() {
                if (!this.enabled.sfx || !this.context) return;
                
                const oscillator = this.context.createOscillator();
                const gainNode = this.context.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.context.destination);
                
                oscillator.frequency.value = 120;
                oscillator.type = 'sawtooth';
                
                gainNode.gain.setValueAtTime(0.05, this.context.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.context.currentTime + 0.5);
                
                oscillator.start();
                oscillator.stop(this.context.currentTime + 0.5);
            },
            
            playRadio: function() {
                if (!this.enabled.sfx || !this.context) return;
                
                const oscillator = this.context.createOscillator();
                const gainNode = this.context.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.context.destination);
                
                oscillator.frequency.value = 600;
                oscillator.type = 'square';
                
                gainNode.gain.setValueAtTime(0.1, this.context.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.context.currentTime + 0.2);
                
                oscillator.start();
                oscillator.stop(this.context.currentTime + 0.2);
            },
            
            playSuccess: function() {
                if (!this.enabled.sfx || !this.context) return;
                
                const oscillator = this.context.createOscillator();
                const gainNode = this.context.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.context.destination);
                
                oscillator.frequency.setValueAtTime(523.25, this.context.currentTime); // C5
                oscillator.frequency.setValueAtTime(659.25, this.context.currentTime + 0.1); // E5
                oscillator.frequency.setValueAtTime(783.99, this.context.currentTime + 0.2); // G5
                
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.1, this.context.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.context.currentTime + 0.5);
                
                oscillator.start();
                oscillator.stop(this.context.currentTime + 0.5);
            },
            
            playDefeat: function() {
                if (!this.enabled.sfx || !this.context) return;
                
                const oscillator = this.context.createOscillator();
                const gainNode = this.context.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.context.destination);
                
                oscillator.frequency.setValueAtTime(220, this.context.currentTime); // A3
                oscillator.frequency.setValueAtTime(174.61, this.context.currentTime + 0.2); // F3
                oscillator.frequency.setValueAtTime(146.83, this.context.currentTime + 0.4); // D3
                
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.1, this.context.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.context.currentTime + 0.6);
                
                oscillator.start();
                oscillator.stop(this.context.currentTime + 0.6);
            }
        };

        const gameState = {
            currentScreen: 'start',
            player: {
                class: null,
                location: 'chicago',
                mile: 0,
                day: 1,
                gas: 100,
                maxGas: 100,
                sanity: 80,
                maxSanity: 100,
                cash: 50,
                mysteriesSolved: 0,
                reputation: 0,
                equipment: {
                    main: null,
                    secondary: null,
                    tool: null
                },
                inventory: [],
                evidence: [],
                tools: [],
                notes: [],
                carUpgrades: [],
                activeMystery: null,
                cluesFound: 0,
                cluesNeeded: 3
            },
            currentEncounter: null,
            gameLog: [],
            radioLog: [],
            driveDistance: 0,
            nextTownDistance: 50,
            accessibility: {
                fontSize: 'medium',
                tutorialEnabled: true,
                completedTutorials: []
            }
        };

        // Traveler Classes
        const classes = {
            occultist: {
                name: "The Occultist",
                description: "Knows ancient rituals and forbidden lore",
                gas: 80,
                sanity: 70,
                cash: 40,
                startingItems: ['ritual_kit', 'occult_library', 'holy_water'],
                startingTools: ['ouija_board', 'silver_dagger'],
                bonus: "supernatural_investigation",
                bonusValue: 20
            },
            skeptic: {
                name: "The Skeptic",
                description: "Investigative journalist seeking the truth",
                gas: 90,
                sanity: 90,
                cash: 60,
                startingItems: ['camera', 'tape_recorder', 'notebook'],
                startingTools: ['flashlight', 'magnifying_glass'],
                bonus: "evidence_gathering",
                bonusValue: 30
            },
            drifter: {
                name: "The Drifter",
                description: "Seen too much, survived everything",
                gas: 100,
                sanity: 60,
                cash: 50,
                startingItems: ['tool_kit', 'road_map', 'whiskey'],
                startingTools: ['crowbar', 'shotgun'],
                bonus: "survival",
                bonusValue: 25
            }
        };

        // Route 66 Locations
        const locations = {
            chicago: {
                name: "Chicago, IL",
                mile: 0,
                description: "The starting point. City lights fade behind you.",
                mysteries: ['vanishing_hitchhiker'],
                services: ['gas', 'motel', 'diner'],
                danger: 1
            },
            st_louis: {
                name: "St. Louis, MO",
                mile: 300,
                description: "Gateway to the West. The arch looms in the distance.",
                mysteries: ['ghostly_arch'],
                services: ['gas', 'motel', 'repair'],
                danger: 2
            },
            springfield: {
                name: "Springfield, IL",
                mile: 200,
                description: "A quiet town with restless spirits.",
                mysteries: ['grave_robber'],
                services: ['gas', 'diner'],
                danger: 3
            },
            tulsa: {
                name: "Tulsa, OK",
                mile: 500,
                description: "Oil money and old secrets.",
                mysteries: ['oil_ghosts'],
                services: ['gas', 'motel', 'repair'],
                danger: 2
            },
            amarillo: {
                name: "Amarillo, TX",
                mile: 800,
                description: "Where the desert begins to whisper.",
                mysteries: ['sand_ghosts'],
                services: ['gas', 'motel'],
                danger: 4
            },
            albuquerque: {
                name: "Albuquerque, NM",
                mile: 1100,
                description: "Ancient ruins and modern mysteries.",
                mysteries: ['ancient_curse'],
                services: ['gas', 'motel', 'diner', 'repair'],
                danger: 3
            },
            flagstaff: {
                name: "Flagstaff, AZ",
                mile: 1400,
                description: "Pine forests hiding dark things.",
                mysteries: ['forest_watchers'],
                services: ['gas', 'motel'],
                danger: 4
            },
            los_angeles: {
                name: "Los Angeles, CA",
                mile: 2000,
                description: "The end of the road... or is it?",
                mysteries: ['final_mystery'],
                services: ['all'],
                danger: 5
            }
        };

        // Supernatural Mysteries
        const mysteries = {
            vanishing_hitchhiker: {
                name: "The Vanishing Hitchhiker",
                description: "Travelers report picking up a hitchhiker who disappears from their car.",
                location: 'chicago',
                cluesNeeded: 3,
                solution: "The hitchhiker is the ghost of a teenager who died on this stretch of road in 1965.",
                rewards: { cash: 100, reputation: 10, item: 'ghost_photo' },
                difficulty: 1
            },
            ghostly_arch: {
                name: "The Ghostly Arch",
                description: "The St. Louis Arch appears to be haunted by construction workers.",
                location: 'st_louis',
                cluesNeeded: 4,
                solution: "A safety cover-up from 1965 caused multiple deaths. Their spirits remain.",
                rewards: { cash: 150, reputation: 15, item: 'construction_helmet' },
                difficulty: 2
            },
            grave_robber: {
                name: "The Springfield Grave Robber",
                description: "Fresh graves are being dug up, but nothing is stolen.",
                location: 'springfield',
                cluesNeeded: 3,
                solution: "A local doctor is checking if the 'dead' are truly deceased after a misdiagnosis.",
                rewards: { cash: 200, reputation: 20, item: 'medical_journal' },
                difficulty: 2
            },
            oil_ghosts: {
                name: "Oil Field Phantoms",
                description: "Ghostly figures seen around abandoned oil derricks.",
                location: 'tulsa',
                cluesNeeded: 4,
                solution: "The ghosts are former workers killed in a 1930s explosion covered up by the company.",
                rewards: { cash: 250, reputation: 25, item: 'oil_lamp' },
                difficulty: 3
            },
            sand_ghosts: {
                name: "Sandstorm Spirits",
                description: "Travelers lost in sandstorms report being guided by mysterious figures.",
                location: 'amarillo',
                cluesNeeded: 5,
                solution: "The spirits are pioneers who died in the 1800s, still trying to help travelers.",
                rewards: { cash: 300, reputation: 30, item: 'pioneer_compass' },
                difficulty: 4
            }
        };

        // Items and Supplies
        const items = {
            // Starting items
            ritual_kit: {
                name: "Ritual Kit",
                type: "tool",
                description: "Salt, candles, and ancient symbols for protection.",
                effect: "sanity_protection",
                value: 50
            },
            occult_library: {
                name: "Occult Library",
                type: "tool",
                description: "Books on supernatural phenomena.",
                effect: "clue_bonus",
                value: 75
            },
            holy_water: {
                name: "Holy Water",
                type: "consumable",
                description: "Blessed water for purification.",
                effect: "cleanse",
                power: 20,
                value: 20
            },
            camera: {
                name: "Camera",
                type: "tool",
                description: "35mm camera for evidence collection.",
                effect: "evidence_quality",
                value: 60
            },
            tape_recorder: {
                name: "Tape Recorder",
                type: "tool",
                description: "Records EVPs and interviews.",
                effect: "audio_evidence",
                value: 45
            },
            notebook: {
                name: "Notebook",
                type: "tool",
                description: "For recording observations.",
                effect: "note_taking",
                value: 5
            },
            tool_kit: {
                name: "Tool Kit",
                type: "tool",
                description: "For car repairs and improvisation.",
                effect: "repair_bonus",
                value: 40
            },
            road_map: {
                name: "Road Map",
                type: "tool",
                description: "Detailed Route 66 map.",
                effect: "navigation",
                value: 10
            },
            whiskey: {
                name: "Whiskey",
                type: "consumable",
                description: "For courage... or forgetting.",
                effect: "sanity_boost",
                power: 15,
                value: 15
            },
            
            // Consumables
            gas_can: {
                name: "Gas Can",
                type: "consumable",
                description: "5 gallons of gasoline.",
                effect: "refuel",
                power: 25,
                value: 30
            },
            food_ration: {
                name: "Food Ration",
                type: "consumable",
                description: "Canned beans and crackers.",
                effect: "sanity_restore",
                power: 10,
                value: 10
            },
            first_aid: {
                name: "First Aid Kit",
                type: "consumable",
                description: "Bandages and antiseptic.",
                effect: "sanity_restore",
                power: 20,
                value: 25
            },
            spare_part: {
                name: "Spare Part",
                type: "consumable",
                description: "Random car part.",
                effect: "repair",
                power: 15,
                value: 20
            },
            
            // Evidence
            ghost_photo: {
                name: "Ghost Photograph",
                type: "evidence",
                description: "Foggy figure caught on film.",
                mystery: "vanishing_hitchhiker",
                value: 50
            },
            construction_helmet: {
                name: "Construction Helmet",
                type: "evidence",
                description: "1960s helmet with strange markings.",
                mystery: "ghostly_arch",
                value: 60
            },
            medical_journal: {
                name: "Medical Journal",
                type: "evidence",
                description: "Doctor's notes on misdiagnosed deaths.",
                mystery: "grave_robber",
                value: 70
            },
            oil_lamp: {
                name: "Oil Lamp",
                type: "evidence",
                description: "Still burns with ghostly flame.",
                mystery: "oil_ghosts",
                value: 80
            },
            pioneer_compass: {
                name: "Pioneer's Compass",
                type: "evidence",
                description: "Points to locations of death.",
                mystery: "sand_ghosts",
                value: 90
            }
        };

        // Car Upgrades
        const carUpgrades = {
            radio_upgrade: {
                name: "Enhanced Radio",
                description: "Picks up supernatural frequencies.",
                cost: 100,
                effect: "better_radio_signals",
                installed: false
            },
            extra_tank: {
                name: "Extra Gas Tank",
                description: "+50% gas capacity.",
                cost: 150,
                effect: "more_gas",
                installed: false
            },
            reinforced_bumpers: {
                name: "Reinforced Bumpers",
                description: "Protection from... things that bump in the night.",
                cost: 200,
                effect: "damage_reduction",
                installed: false
            },
            occult_trunk: {
                name: "Occult Storage",
                description: "Special compartments for artifacts.",
                cost: 120,
                effect: "more_inventory",
                installed: false
            },
            search_lights: {
                name: "Powerful Searchlights",
                description: "See further into the darkness.",
                cost: 80,
                effect: "better_night_vision",
                installed: false
            },
            engine_tune: {
                name: "Performance Tune",
                description: "Better gas mileage.",
                cost: 90,
                effect: "gas_efficiency",
                installed: false
            }
        };

        // Road Encounters
        const encounters = {
            hitchhiker: {
                name: "Hitchhiker",
                description: "A lone figure thumbs for a ride in the moonlight.",
                choices: [
                    { text: "Pick them up", effect: { sanity: -10, clue: "hitchhiker_info" }, chance: 0.7 },
                    { text: "Drive past", effect: { sanity: -5 }, chance: 1.0 },
                    { text: "Stop and talk", effect: { sanity: -15, cash: 20, clue: "local_lore" }, chance: 0.5 }
                ],
                danger: 2
            },
            roadside_attraction: {
                name: "Roadside Attraction",
                description: "A bizarre tourist trap glowing in the dark.",
                choices: [
                    { text: "Investigate", effect: { gas: -10, sanity: -10, clue: "strange_artifact" }, chance: 0.6 },
                    { text: "Take photo", effect: { sanity: -5, cash: 10 }, chance: 0.8 },
                    { text: "Ignore it", effect: { sanity: 5 }, chance: 1.0 }
                ],
                danger: 1
            },
            animal_crossing: {
                name: "Strange Animals",
                description: "Eyes glow in your headlights. These aren't normal animals.",
                choices: [
                    { text: "Speed up", effect: { gas: -15, sanity: -15 }, chance: 0.9 },
                    { text: "Stop and watch", effect: { sanity: -20, clue: "unnatural_wildlife" }, chance: 0.4 },
                    { text: "Use horn", effect: { sanity: -10, gas: -5 }, chance: 0.7 }
                ],
                danger: 3
            },
            ghost_lights: {
                name: "Ghost Lights",
                description: "Floating orbs dance alongside the road.",
                choices: [
                    { text: "Follow them", effect: { gas: -20, sanity: -25, clue: "will_o_wisp" }, chance: 0.3 },
                    { text: "Look away", effect: { sanity: -15 }, chance: 1.0 },
                    { text: "Take measurements", effect: { sanity: -20, clue: "ectoplasmic_readings" }, chance: 0.5 }
                ],
                danger: 4
            },
            time_slip: {
                name: "Time Slip",
                description: "The road suddenly looks decades older. A vintage car passes going the other way.",
                choices: [
                    { text: "Continue driving", effect: { sanity: -30, gas: -25 }, chance: 0.8 },
                    { text: "Try to follow", effect: { sanity: -40, clue: "temporal_anomaly" }, chance: 0.2 },
                    { text: "Pull over and wait", effect: { sanity: -20, gas: -10 }, chance: 1.0 }
                ],
                danger: 5
            },
            whispering_statue: {
                name: "The Whispering Statue",
                description: "A roadside statue seems to be whispering warnings.",
                choices: [
                    { text: "Listen closely", effect: { sanity: -25, clue: "prophetic_warning" }, chance: 0.6 },
                    { text: "Ignore it", effect: { sanity: -10 }, chance: 1.0 },
                    { text: "Take a rubbing", effect: { sanity: -15, clue: "ancient_symbols" }, chance: 0.4 }
                ],
                danger: 3
            }
        };

        // Radio Stations
        const radioStations = {
            '88.5': {
                name: "Police Band",
                messages: [
                    "All units, be advised: missing persons report on Highway 66...",
                    "Unidentified vehicle reported following travelers...",
                    "Weather advisory: Unexplained fog patterns moving east...",
                    "10-78: Officer requesting backup at mile marker 156..."
                ]
            },
            '92.3': {
                name: "Weather Radio",
                messages: [
                    "Unusual atmospheric conditions detected...",
                    "Travel advisory: Reduced visibility expected...",
                    "Temperature dropping rapidly in localized areas...",
                    "Static discharge reported along Route 66 corridor..."
                ]
            },
            '95.7': {
                name: "News Radio",
                messages: [
                    "Another traveler reported missing on Route 66...",
                    "Local authorities dismiss supernatural claims...",
                    "Historical society investigates old roadside legends...",
                    "Meteor shower expected tonight, but some reports differ..."
                ]
            },
            '98.1': {
                name: "Music Station",
                messages: [
                    "Playing: 'Hotel California' by Eagles...",
                    "Next up: 'Riders on the Storm' by The Doors...",
                    "Classic rock all night on K-RAD...",
                    "This next one goes out to all the night drivers..."
                ]
            },
            'static': {
                name: "Static",
                messages: [
                    "...help...us...",
                    "...turn...back...",
                    "...they...watch...",
                    "...not...alone...",
                    "...the...road...hungers..."
                ]
            }
        };

        // Screen references
        const screens = {
            start: document.getElementById('start-screen'),
            class: document.getElementById('class-screen'),
            game: document.getElementById('game-screen'),
            drive: document.getElementById('drive-screen'),
            investigate: document.getElementById('investigate-screen'),
            inventory: document.getElementById('inventory-screen'),
            radio: document.getElementById('radio-screen'),
            upgrades: document.getElementById('upgrades-screen'),
            map: document.getElementById('map-screen'),
            rest: document.getElementById('rest-screen'),
            solved: document.getElementById('solved-screen'),
            defeat: document.getElementById('defeat-screen')
        };

        // ================================================
        // SCREEN MANAGEMENT
        // ================================================

        function showScreen(screenName) {
            console.log(`Switching to screen: ${screenName}`);
            
            // Hide all screens
            Object.values(screens).forEach(screen => {
                if (screen) {
                    screen.classList.remove('active');
                }
            });
            
            // Show the requested screen
            if (screens[screenName]) {
                screens[screenName].classList.add('active');
                gameState.currentScreen = screenName;
                
                // Update the screen content
                switch(screenName) {
                    case 'game': updateGameScreen(); break;
                    case 'drive': updateDriveScreen(); break;
                    case 'investigate': updateInvestigationScreen(); break;
                    case 'inventory': updateInventoryScreen(); break;
                    case 'radio': updateRadioScreen(); break;
                    case 'upgrades': updateUpgradesScreen(); break;
                    case 'map': updateMapScreen(); break;
                    case 'rest': updateRestScreen(); break;
                }
            }
        }

        // ================================================
        // GAME INITIALIZATION
        // ================================================

        function initGame() {
            console.log("Initializing Highway Hauntings...");
            
            // Initialize audio system
            audioSystem.init();
            
            // Set up event listeners
            document.getElementById('start-button').addEventListener('click', () => {
                audioSystem.playClick();
                showScreen('class');
            });
            
            document.getElementById('load-button').addEventListener('click', () => {
                audioSystem.playClick();
                loadGame();
            });
            
            // Class selection
            document.querySelectorAll('.class-option').forEach(option => {
                option.addEventListener('click', function() {
                    const className = this.getAttribute('data-class');
                    audioSystem.playClick();
                    selectClass(className);
                });
            });
            
            // Game screen buttons
            document.getElementById('drive-button').addEventListener('click', () => {
                audioSystem.playEngine();
                startDrive();
            });
            
            document.getElementById('investigate-button').addEventListener('click', () => {
                audioSystem.playClick();
                startInvestigation();
            });
            
            document.getElementById('inventory-button').addEventListener('click', () => {
                audioSystem.playClick();
                showScreen('inventory');
                updateInventoryScreen();
            });
            
            document.getElementById('radio-button').addEventListener('click', () => {
                audioSystem.playRadio();
                showScreen('radio');
                updateRadioScreen();
            });
            
            document.getElementById('upgrades-button').addEventListener('click', () => {
                audioSystem.playClick();
                showScreen('upgrades');
                updateUpgradesScreen();
            });
            
            document.getElementById('map-button').addEventListener('click', () => {
                audioSystem.playClick();
                showScreen('map');
                updateMapScreen();
            });
            
            document.getElementById('rest-button').addEventListener('click', () => {
                audioSystem.playClick();
                showScreen('rest');
                updateRestScreen();
            });
            
            document.getElementById('save-button').addEventListener('click', () => {
                audioSystem.playClick();
                saveGame();
                addToGameLog("Progress saved at the last roadside phone.");
            });
            
            document.getElementById('find-mystery-btn').addEventListener('click', purchaseMystery);
            
            // Drive screen buttons
            document.getElementById('continue-drive').addEventListener('click', continueDrive);
            document.getElementById('stop-car').addEventListener('click', stopCar);
            document.getElementById('check-radio').addEventListener('click', checkRadio);
            document.getElementById('return-to-map').addEventListener('click', () => {
                audioSystem.playClick();
                showScreen('game');
            });
            
            // Investigation screen
            document.getElementById('back-from-investigate').addEventListener('click', () => {
                audioSystem.playClick();
                showScreen('game');
            });
            
            document.getElementById('solve-button').addEventListener('click', solveMystery);
            
            // Inventory screen
            document.getElementById('back-from-inventory').addEventListener('click', () => {
                audioSystem.playClick();
                showScreen('game');
            });
            
            // Radio screen
            document.querySelectorAll('[data-freq]').forEach(button => {
                button.addEventListener('click', function() {
                    audioSystem.playRadio();
                    tuneRadio(this.dataset.freq);
                });
            });
            
            document.getElementById('back-from-radio').addEventListener('click', () => {
                audioSystem.playClick();
                showScreen('game');
            });
            
            // Upgrades screen
            document.getElementById('back-from-upgrades').addEventListener('click', () => {
                audioSystem.playClick();
                showScreen('game');
            });
            
            // Map screen
            document.getElementById('back-from-map').addEventListener('click', () => {
                audioSystem.playClick();
                showScreen('game');
            });
            
            document.getElementById('plan-route').addEventListener('click', planRoute);
            
            // Rest screen
            document.getElementById('rest-cheap').addEventListener('click', () => restCheap());
            document.getElementById('rest-room').addEventListener('click', () => restRoom());
            document.getElementById('rest-food').addEventListener('click', () => buyFood());
            document.getElementById('rest-gas').addEventListener('click', () => buyGas());
            document.getElementById('rest-find-mystery').addEventListener('click', findMystery);
            document.getElementById('rest-leave').addEventListener('click', () => {
                audioSystem.playClick();
                showScreen('game');
            });
            
            // Solved screen
            document.getElementById('continue-after-solve').addEventListener('click', () => {
                audioSystem.playClick();
                
                // Chance to get a new mystery after solving one
                if (Math.random() < 0.7) { // 70% chance for new mystery
                    const availableMysteries = Object.keys(mysteries).filter(m => 
                        mysteries[m].difficulty <= gameState.player.mysteriesSolved + 1
                    );
                    
                    if (availableMysteries.length > 0) {
                        const mysteryId = availableMysteries[Math.floor(Math.random() * availableMysteries.length)];
                        gameState.player.activeMystery = mysteryId;
                        gameState.player.cluesFound = 0;
                        gameState.player.cluesNeeded = mysteries[mysteryId].cluesNeeded;
                        addToGameLog(`New mystery discovered: ${mysteries[mysteryId].name}`);
                    }
                }
                
                showScreen('game');
                updateGameScreen();
            });
            
            // Defeat screen
            document.getElementById('continue-from-defeat').addEventListener('click', () => {
                audioSystem.playClick();
                continueFromDefeat();
            });
            
            document.getElementById('return-to-menu-from-defeat').addEventListener('click', () => {
                audioSystem.playClick();
                showScreen('start');
            });
            
            // Tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    this.classList.add('active');
                    const content = document.getElementById(`${tabName}-tab`);
                    if (content) {
                        content.classList.add('active');
                    }
                    
                    if (tabName === 'items') updateInventoryDisplay();
                    if (tabName === 'evidence') updateEvidenceDisplay();
                    if (tabName === 'tools') updateToolsDisplay();
                    if (tabName === 'notes') updateNotesDisplay();
                });
            });
            
            // Audio controls
            document.getElementById('music-toggle').addEventListener('click', toggleMusic);
            document.getElementById('sfx-toggle').addEventListener('click', toggleSFX);
            
            // Accessibility
            document.getElementById('font-size-btn').addEventListener('click', cycleFontSize);
            document.getElementById('tutorial-btn').addEventListener('click', showTutorial);
            
            // Initialize game log
            addToGameLog("The engine hums as you pull onto Route 66. The road stretches into darkness...");
            addToGameLog("RADIO: \"...strange lights reported near mile marker 42...\"", true);
            
            // Start road animation
            startRoadAnimation();
            
            // Check for low resources
            setInterval(checkResources, 1000);
            
            console.log("Game initialized successfully!");
        }

        // ================================================
        // PLAYER & CLASS SYSTEM
        // ================================================

        function selectClass(className) {
            gameState.player.class = className;
            const classData = classes[className];
            
            gameState.player.gas = classData.gas;
            gameState.player.maxGas = 100;
            gameState.player.sanity = classData.sanity;
            gameState.player.maxSanity = 100;
            gameState.player.cash = classData.cash;
            
            // Add starting items
            classData.startingItems.forEach(itemId => {
                gameState.player.inventory.push(itemId);
            });
            
            classData.startingTools.forEach(toolId => {
                gameState.player.tools.push(toolId);
            });
            
            // Add some supplies
            gameState.player.inventory.push('gas_can');
            for (let i = 0; i < 3; i++) {
                gameState.player.inventory.push('food_ration');
            }
            gameState.player.inventory.push('first_aid');
            
            // Start with first mystery
            gameState.player.activeMystery = 'vanishing_hitchhiker';
            gameState.player.cluesNeeded = mysteries['vanishing_hitchhiker'].cluesNeeded;
            
            updatePlayerStats();
            showScreen('game');
            
            addToGameLog(`You take the wheel as ${classData.name}.`);
            addToGameLog(classData.description);
            addToGameLog("Active mystery: The Vanishing Hitchhiker");
            addToGameLog("The radio crackles to life as you head west...", true);
        }

        // ================================================
        // DRIVING SYSTEM
        // ================================================

        function startDrive() {
            gameState.driveDistance = 0;
            gameState.nextTownDistance = 50 + Math.floor(Math.random() * 50);
            updateDriveScreen();
            showScreen('drive');
            addToDriveLog("Headlights cut through the darkness. The radio crackles...");
        }

        function continueDrive() {
            if (gameState.player.gas <= 0) {
                addToDriveLog("You're out of gas!");
                showDefeat("ran out of gas in the middle of nowhere.");
                return;
            }
            
            // Consume gas
            const gasUsed = 5 + Math.floor(Math.random() * 10);
            gameState.player.gas = Math.max(0, gameState.player.gas - gasUsed);
            
            // Progress distance
            const distanceTraveled = 10 + Math.floor(Math.random() * 20);
            gameState.driveDistance += distanceTraveled;
            gameState.player.mile += distanceTraveled;
            
            // Check for encounters
            if (Math.random() < 0.3) {
                triggerEncounter();
            } else {
                addToDriveLog(`You drive ${distanceTraveled} miles through the night.`);
            }
            
            // Check if reached town
            if (gameState.driveDistance >= gameState.nextTownDistance) {
                reachTown();
                return;
            }
            
            // Small sanity drain
            gameState.player.sanity = Math.max(0, gameState.player.sanity - 2);
            
            updateDriveScreen();
        }

        function triggerEncounter() {
            const encounterKeys = Object.keys(encounters);
            const randomEncounter = encounterKeys[Math.floor(Math.random() * encounterKeys.length)];
            gameState.currentEncounter = encounters[randomEncounter];
            
            // Show encounter
            document.getElementById('encounter-display').style.display = 'none';
            document.getElementById('encounter-actions').style.display = 'block';
            document.getElementById('drive-actions').style.display = 'none';
            
            document.getElementById('encounter-description').innerHTML = `
                <div class="log-entry"><strong>${gameState.currentEncounter.name}</strong></div>
                <div class="log-entry">${gameState.currentEncounter.description}</div>
            `;
            
            // Create choices
            const choicesContainer = document.getElementById('encounter-choices');
            choicesContainer.innerHTML = '';
            
            gameState.currentEncounter.choices.forEach((choice, index) => {
                const choiceButton = document.createElement('div');
                choiceButton.className = 'button';
                choiceButton.textContent = choice.text;
                choiceButton.addEventListener('click', () => handleEncounterChoice(index));
                choicesContainer.appendChild(choiceButton);
            });
        }

        function handleEncounterChoice(choiceIndex) {
            const choice = gameState.currentEncounter.choices[choiceIndex];
            
            // Apply effects regardless of chance
            if (choice.effect.gas) gameState.player.gas += choice.effect.gas;
            if (choice.effect.sanity) gameState.player.sanity += choice.effect.sanity;
            if (choice.effect.cash) gameState.player.cash += choice.effect.cash;
            
            // Check for success
            if (Math.random() <= choice.chance) {
                addToDriveLog(`Success! ${choice.text}`);
                if (choice.effect.clue) {
                    addClue(choice.effect.clue);
                    addToDriveLog("Found a clue!");
                    showFloatingText("+1 Clue", "clue", document.getElementById('encounter-description'));
                }
            } else {
                addToDriveLog(`Failed: ${choice.text}`);
            }
            
            // Reset encounter UI
            document.getElementById('encounter-display').style.display = 'block';
            document.getElementById('encounter-actions').style.display = 'none';
            document.getElementById('drive-actions').style.display = 'block';
            
            // Small time passage
            gameState.player.gas = Math.max(0, gameState.player.gas - 5);
            gameState.driveDistance += 5;
            
            updateDriveScreen();
        }

        function stopCar() {
            addToDriveLog("You pull over to the side of the road.");
            gameState.player.sanity += 5; // Rest from driving
            
            // Chance to find something
            if (Math.random() < 0.4) {
                const findings = [
                    { text: "Found an old gas can with some fuel.", effect: { gas: 15 } },
                    { text: "Found a discarded map with notes.", effect: { clue: "map_clue" } },
                    { text: "Found $20 on the ground.", effect: { cash: 20 } },
                    { text: "Found nothing but eerie silence.", effect: { sanity: -5 } }
                ];
                
                const finding = findings[Math.floor(Math.random() * findings.length)];
                addToDriveLog(finding.text);
                
                if (finding.effect.gas) {
                    gameState.player.gas += finding.effect.gas;
                    showFloatingText(`+${finding.effect.gas} Gas`, "clue", document.getElementById('stop-car'));
                }
                if (finding.effect.sanity) gameState.player.sanity += finding.effect.sanity;
                if (finding.effect.cash) {
                    gameState.player.cash += finding.effect.cash;
                    showFloatingText(`+$${finding.effect.cash}`, "money", document.getElementById('stop-car'));
                }
                if (finding.effect.clue) {
                    addClue(finding.effect.clue);
                    showFloatingText("+1 Clue", "clue", document.getElementById('stop-car'));
                }
            }
            
            updateDriveScreen();
        }

        function checkRadio() {
            audioSystem.playRadio();
            const stations = ['88.5', '92.3', '95.7', '98.1', 'static'];
            const randomStation = stations[Math.floor(Math.random() * stations.length)];
            const station = radioStations[randomStation];
            const message = station.messages[Math.floor(Math.random() * station.messages.length)];
            
            addToDriveLog(`RADIO (${station.name}): "${message}"`, true);
            gameState.player.sanity -= 5;
            updateDriveScreen();
        }

        function reachTown() {
            gameState.player.day++;
            gameState.player.sanity = Math.min(100, gameState.player.sanity + 20);
            gameState.player.gas = Math.min(100, gameState.player.gas + 20);
            
            addToDriveLog(`You reach a small town as dawn breaks.`);
            addToDriveLog(`Day ${gameState.player.day}. Rest restored some sanity.`);
            
            // Always try to get a new mystery when reaching town (if none active)
            if (!gameState.player.activeMystery) {
                const availableMysteries = Object.keys(mysteries).filter(m => 
                    mysteries[m].difficulty <= gameState.player.mysteriesSolved + 1
                );
                
                if (availableMysteries.length > 0) {
                    const mysteryId = availableMysteries[Math.floor(Math.random() * availableMysteries.length)];
                    gameState.player.activeMystery = mysteryId;
                    gameState.player.cluesFound = 0;
                    gameState.player.cluesNeeded = mysteries[mysteryId].cluesNeeded;
                    addToDriveLog(`You hear about a local mystery: ${mysteries[mysteryId].name}`);
                }
            }
            
            setTimeout(() => {
                showScreen('game');
                addToGameLog(`You arrive in a new town. Day ${gameState.player.day}.`);
                if (gameState.player.activeMystery) {
                    addToGameLog(`Active mystery: ${mysteries[gameState.player.activeMystery].name}`);
                }
                updateGameScreen();
            }, 2000);
        }

        // ================================================
        // INVESTIGATION SYSTEM - FIXED!
        // ================================================

        function startInvestigation() {
            if (!gameState.player.activeMystery) {
                addToGameLog("No active mystery to investigate.");
                addToGameLog("Try driving to a new town or purchasing information.");
                
                // Show the find mystery button
                updateFindMysteryButton();
                
                return;
            }
            
            updateInvestigationScreen();
            showScreen('investigate');
        }

        function investigateAction(action) {
            const mystery = mysteries[gameState.player.activeMystery];
            const actions = {
                'interview': { sanity: -10, clueChance: 0.6, text: "You interview locals about the strange occurrences." },
                'search': { sanity: -5, clueChance: 0.4, text: "You search the area for physical evidence." },
                'research': { sanity: -8, clueChance: 0.5, text: "You research historical records and local archives." },
                'stakeout': { sanity: -15, clueChance: 0.7, text: "You conduct a night-time stakeout." }
            };
            
            if (!actions[action]) return;
            
            const chosenAction = actions[action];
            
            // Apply sanity cost
            gameState.player.sanity = Math.max(0, gameState.player.sanity + chosenAction.sanity);
            
            // Add to log
            addToGameLog(chosenAction.text);
            
            // Chance to find clue
            if (Math.random() < chosenAction.clueChance) {
                gameState.player.cluesFound++;
                addToGameLog(`Found a clue! (${gameState.player.cluesFound}/${gameState.player.cluesNeeded})`);
                showFloatingText("+1 Clue", "clue", event.target);
                
                // Add evidence item
                const evidenceItems = ['ghost_photo', 'construction_helmet', 'medical_journal', 'oil_lamp', 'pioneer_compass'];
                const randomEvidence = evidenceItems[Math.floor(Math.random() * evidenceItems.length)];
                if (!gameState.player.evidence.includes(randomEvidence)) {
                    gameState.player.evidence.push(randomEvidence);
                }
            }
            
            // Small chance of encounter during investigation
            if (Math.random() < 0.2) {
                gameState.player.sanity -= 10;
                addToGameLog("Something watches you from the shadows...");
            }
            
            updateInvestigationScreen();
            updateGameScreen();
            
            // Check if enough clues to solve
            if (gameState.player.cluesFound >= gameState.player.cluesNeeded) {
                document.getElementById('solve-button').classList.remove('disabled');
                document.getElementById('solve-button').style.backgroundColor = '#8b0000';
                addToGameLog("You have enough clues to solve the mystery!");
            }
        }

        function solveMystery() {
            if (!gameState.player.activeMystery) {
                addToGameLog("No mystery to solve!");
                return;
            }
            
            if (gameState.player.cluesFound < gameState.player.cluesNeeded) {
                addToGameLog(`Need ${gameState.player.cluesNeeded - gameState.player.cluesFound} more clues!`);
                return;
            }
            
            const mystery = mysteries[gameState.player.activeMystery];
            
            // Show solution
            document.getElementById('solution-text').textContent = mystery.solution;
            
            // Calculate rewards
            const rewardContainer = document.getElementById('reward-items');
            rewardContainer.innerHTML = '';
            
            let totalCash = mystery.rewards.cash || 0;
            let totalRep = mystery.rewards.reputation || 0;
            
            // Bonus for extra clues
            const extraClues = gameState.player.cluesFound - gameState.player.cluesNeeded;
            if (extraClues > 0) {
                totalCash += extraClues * 25;
                totalRep += extraClues * 5;
                rewardContainer.innerHTML += `<div class="log-entry">Bonus for ${extraClues} extra clues: +$${extraClues * 25}, +${extraClues * 5} rep</div>`;
            }
            
            // Apply rewards
            gameState.player.cash += totalCash;
            gameState.player.reputation += totalRep;
            
            if (mystery.rewards.item) {
                gameState.player.inventory.push(mystery.rewards.item);
                rewardContainer.innerHTML += `<div class="log-entry">Item: ${items[mystery.rewards.item].name}</div>`;
            }
            
            rewardContainer.innerHTML += `<div class="log-entry">Cash: +$${totalCash}</div>`;
            rewardContainer.innerHTML += `<div class="log-entry">Reputation: +${totalRep}</div>`;
            
            // Clear mystery
            gameState.player.mysteriesSolved++;
            gameState.player.activeMystery = null;
            gameState.player.cluesFound = 0;
            gameState.player.evidence = []; // Clear evidence after solving
            
            showScreen('solved');
            audioSystem.playSuccess();
        }

        // ================================================
        // INVENTORY & ITEM SYSTEM
        // ================================================

        function useItem(itemId) {
            const item = items[itemId];
            if (!item) return false;
            
            switch(item.type) {
                case 'consumable':
                    if (item.effect === 'refuel') {
                        gameState.player.gas = Math.min(gameState.player.maxGas, gameState.player.gas + (item.power || 25));
                        addToGameLog(`Used ${item.name}. Gas +${item.power || 25}.`);
                        showFloatingText(`+${item.power || 25} Gas`, "clue", event.target);
                        return true;
                    }
                    if (item.effect === 'sanity_restore' || item.effect === 'sanity_boost') {
                        gameState.player.sanity = Math.min(gameState.player.maxSanity, gameState.player.sanity + (item.power || 10));
                        addToGameLog(`Used ${item.name}. Sanity +${item.power || 10}.`);
                        showFloatingText(`+${item.power || 10} Sanity`, "clue", event.target);
                        return true;
                    }
                    if (item.effect === 'repair') {
                        addToGameLog(`Used ${item.name} for repairs.`);
                        return true;
                    }
                    if (item.effect === 'cleanse') {
                        gameState.player.sanity += 10;
                        addToGameLog(`Used ${item.name}. Cleansed negative energy.`);
                        showFloatingText("Cleansed", "clue", event.target);
                        return true;
                    }
                    break;
            }
            return false;
        }

        function updateInventoryScreen() {
            // Update supplies counts
            const counts = {
                gas_can: 0,
                food_ration: 0,
                first_aid: 0,
                spare_part: 0
            };
            
            gameState.player.inventory.forEach(itemId => {
                if (counts[itemId] !== undefined) {
                    counts[itemId]++;
                }
            });
            
            document.getElementById('gas-cans').textContent = counts.gas_can;
            document.getElementById('food-rations').textContent = counts.food_ration;
            document.getElementById('first-aid').textContent = counts.first_aid;
            document.getElementById('spare-parts').textContent = counts.spare_part;
            
            // Update inventory items display
            updateInventoryDisplay();
            updateEvidenceDisplay();
            updateToolsDisplay();
            updateNotesDisplay();
        }

        function updateInventoryDisplay() {
            const inventoryContainer = document.getElementById('inventory-items');
            inventoryContainer.innerHTML = '';
            
            // Group items by type with counts
            const itemCounts = {};
            gameState.player.inventory.forEach(itemId => {
                if (items[itemId]) {
                    itemCounts[itemId] = (itemCounts[itemId] || 0) + 1;
                }
            });
            
            Object.keys(itemCounts).forEach(itemId => {
                const item = items[itemId];
                const count = itemCounts[itemId];
                const itemElement = document.createElement('div');
                itemElement.className = 'item';
                itemElement.innerHTML = `
                    <strong>${item.name} ${count > 1 ? `(x${count})` : ''}</strong><br>
                    <small>${item.description}</small>
                    <div class="item-stats">
                        ${item.effect ? `Effect: ${item.effect}` : ''}
                        ${item.value ? ` | Value: $${item.value}` : ''}
                    </div>
                `;
                
                // Make consumables clickable
                if (item.type === 'consumable') {
                    itemElement.style.cursor = 'pointer';
                    itemElement.addEventListener('click', (e) => {
                        if (useItem(itemId)) {
                            // Remove from inventory
                            const index = gameState.player.inventory.indexOf(itemId);
                            if (index > -1) {
                                gameState.player.inventory.splice(index, 1);
                                updateInventoryScreen();
                                updateGameScreen();
                                audioSystem.playClick();
                            }
                        }
                    });
                    
                    // Add tooltip
                    createTooltip(itemElement, `Click to use: ${item.effect}`);
                }
                
                inventoryContainer.appendChild(itemElement);
            });
            
            if (Object.keys(itemCounts).length === 0) {
                inventoryContainer.innerHTML = '<div>No items in inventory.</div>';
            }
        }

        function updateEvidenceDisplay() {
            const evidenceContainer = document.getElementById('evidence-display');
            evidenceContainer.innerHTML = '';
            
            if (gameState.player.evidence.length === 0) {
                evidenceContainer.innerHTML = '<div>No evidence collected.</div>';
                return;
            }
            
            gameState.player.evidence.forEach(evidenceId => {
                const evidenceElement = document.createElement('div');
                evidenceElement.className = 'evidence-item';
                evidenceElement.textContent = evidenceId.replace(/_/g, ' ').toUpperCase();
                evidenceContainer.appendChild(evidenceElement);
            });
        }

        function updateToolsDisplay() {
            const toolsContainer = document.getElementById('tools-display');
            toolsContainer.innerHTML = '';
            
            if (gameState.player.tools.length === 0) {
                toolsContainer.innerHTML = '<div>No tools available.</div>';
                return;
            }
            
            gameState.player.tools.forEach(toolId => {
                if (items[toolId]) {
                    const tool = items[toolId];
                    const toolElement = document.createElement('div');
                    toolElement.className = 'item';
                    toolElement.innerHTML = `
                        <strong>${tool.name}</strong><br>
                        <small>${tool.description}</small>
                    `;
                    toolsContainer.appendChild(toolElement);
                }
            });
        }

        function updateNotesDisplay() {
            const notesContainer = document.getElementById('notes-display');
            notesContainer.innerHTML = '';
            
            if (gameState.player.notes.length === 0) {
                notesContainer.innerHTML = '<div>No case notes yet.</div>';
                return;
            }
            
            gameState.player.notes.forEach(note => {
                const noteElement = document.createElement('div');
                noteElement.className = 'log-entry';
                noteElement.textContent = note;
                notesContainer.appendChild(noteElement);
            });
        }

        // ================================================
        // RADIO SYSTEM
        // ================================================

        function updateRadioScreen() {
            document.getElementById('signal-strength').textContent = `${50 + Math.floor(Math.random() * 50)}%`;
            document.getElementById('current-frequency').textContent = '--.-- FM';
            document.getElementById('radio-battery').textContent = `${100 - gameState.player.day * 5}%`;
        }

        function tuneRadio(frequency) {
            if (frequency === 'scan') {
                audioSystem.playRadio();
                const stationKeys = Object.keys(radioStations).filter(k => k !== 'static');
                const randomStation = stationKeys[Math.floor(Math.random() * stationKeys.length)];
                const station = radioStations[randomStation];
                const message = station.messages[Math.floor(Math.random() * station.messages.length)];
                
                document.getElementById('current-frequency').textContent = `${randomStation} FM`;
                addToRadioLog(`[SCAN] ${station.name}: "${message}"`);
                
                // Show static animation
                document.getElementById('radio-static').classList.add('active');
                setTimeout(() => {
                    document.getElementById('radio-static').classList.remove('active');
                }, 500);
                
            } else if (frequency === 'static') {
                audioSystem.playRadio();
                const station = radioStations['static'];
                const message = station.messages[Math.floor(Math.random() * station.messages.length)];
                
                document.getElementById('current-frequency').textContent = '??? FM';
                addToRadioLog(`[STATIC] "${message}"`);
                
                // Show static animation
                document.getElementById('radio-static').classList.add('active');
                setTimeout(() => {
                    document.getElementById('radio-static').classList.remove('active');
                }, 1000);
                
                // Static affects sanity
                gameState.player.sanity -= 5;
                
            } else {
                const station = radioStations[frequency];
                const message = station.messages[Math.floor(Math.random() * station.messages.length)];
                
                document.getElementById('current-frequency').textContent = `${frequency} FM`;
                addToRadioLog(`${station.name}: "${message}"`);
            }
        }

        // ================================================
        // CAR UPGRADES SYSTEM
        // ================================================

        function updateUpgradesScreen() {
            document.getElementById('upgrade-cash').textContent = gameState.player.cash;
            document.getElementById('car-condition').textContent = 
                gameState.player.gas > 50 ? 'Good' : gameState.player.gas > 20 ? 'Fair' : 'Poor';
            document.getElementById('trunk-space').textContent = `${gameState.player.inventory.length}/20`;
            
            const upgradesContainer = document.getElementById('car-upgrades-grid');
            upgradesContainer.innerHTML = '';
            
            Object.keys(carUpgrades).forEach(upgradeId => {
                const upgrade = carUpgrades[upgradeId];
                const upgradeElement = document.createElement('div');
                upgradeElement.className = `car-upgrade-slot ${upgrade.installed ? 'installed' : 'unlocked'}`;
                
                let buttonHTML = '';
                if (upgrade.installed) {
                    buttonHTML = `<div class="button disabled">INSTALLED</div>`;
                } else if (gameState.player.cash >= upgrade.cost) {
                    buttonHTML = `<div class="button" onclick="buyUpgrade('${upgradeId}')">INSTALL ($${upgrade.cost})</div>`;
                } else {
                    buttonHTML = `<div class="button disabled">NEED $${upgrade.cost}</div>`;
                }
                
                upgradeElement.innerHTML = `
                    <div>
                        <h4>${upgrade.name}</h4>
                        <p>${upgrade.description}</p>
                        <div class="upgrade-effect">Effect: ${upgrade.effect}</div>
                    </div>
                    ${buttonHTML}
                `;
                
                upgradesContainer.appendChild(upgradeElement);
            });
            
            // Show installed upgrades
            const installedContainer = document.getElementById('installed-upgrades');
            const installedUpgrades = Object.keys(carUpgrades).filter(id => carUpgrades[id].installed);
            
            if (installedUpgrades.length === 0) {
                installedContainer.innerHTML = '<div>No upgrades installed.</div>';
            } else {
                installedContainer.innerHTML = installedUpgrades.map(id => 
                    `<div class="log-entry">• ${carUpgrades[id].name}</div>`
                ).join('');
            }
        }

        function buyUpgrade(upgradeId) {
            const upgrade = carUpgrades[upgradeId];
            if (gameState.player.cash >= upgrade.cost) {
                gameState.player.cash -= upgrade.cost;
                upgrade.installed = true;
                addToGameLog(`Installed ${upgrade.name}.`);
                updateUpgradesScreen();
                updateGameScreen();
                audioSystem.playSuccess();
            }
        }

        // ================================================
        // MAP & TRAVEL SYSTEM
        // ================================================

        function updateMapScreen() {
            document.getElementById('current-mile').textContent = gameState.player.mile;
            document.getElementById('map-next-town').textContent = `${gameState.nextTownDistance} miles`;
            
            // Show known mysteries
            const mysteriesContainer = document.getElementById('map-mysteries');
            const knownMysteries = Object.keys(mysteries).filter(m => 
                mysteries[m].difficulty <= gameState.player.mysteriesSolved + 2
            );
            
            if (knownMysteries.length === 0) {
                mysteriesContainer.innerHTML = '<div>No known mysteries ahead.</div>';
            } else {
                mysteriesContainer.innerHTML = knownMysteries.map(mId => {
                    const m = mysteries[mId];
                    return `<div class="log-entry"><strong>${m.name}</strong><br><small>${m.description}</small></div>`;
                }).join('');
            }
        }

        function planRoute() {
            gameState.nextTownDistance = 30 + Math.floor(Math.random() * 70);
            addToGameLog(`Planned route to next town: ${gameState.nextTownDistance} miles.`);
            showScreen('game');
        }

        // ================================================
        // REST SYSTEM
        // ================================================

        function updateRestScreen() {
            document.getElementById('rest-cash').textContent = gameState.player.cash;
            document.getElementById('room-cost').textContent = '20';
            document.getElementById('food-cost').textContent = '10';
            
            // Random motel description
            const motels = [
                "The 'Desert Star Motel' sign flickers in the night.",
                "'Sleepy Hollow Inn' - the vacancy sign is broken.",
                "A rundown motel with one working light in the parking lot.",
                "'Bates Motel'... wait, that's not right."
            ];
            document.getElementById('motel-description').innerHTML = 
                `<div class="log-entry">${motels[Math.floor(Math.random() * motels.length)]}</div>
                 <div class="log-entry">Room 13 is available... if you dare.</div>`;
        }

        function restCheap() {
            addToGameLog("You sleep in your car. It's uncomfortable but free.");
            gameState.player.sanity = Math.min(100, gameState.player.sanity + 10);
            showScreen('game');
        }

        function restRoom() {
            if (gameState.player.cash >= 20) {
                gameState.player.cash -= 20;
                gameState.player.sanity = Math.min(100, gameState.player.sanity + 30);
                addToGameLog("Rented a room. You sleep well.");
                showScreen('game');
            } else {
                addToGameLog("Not enough cash for a room.");
            }
        }

        function buyFood() {
            if (gameState.player.cash >= 10) {
                gameState.player.cash -= 10;
                gameState.player.inventory.push('food_ration');
                addToGameLog("Bought food rations.");
                showFloatingText("+1 Food", "clue", document.getElementById('rest-food'));
                updateRestScreen();
                updateGameScreen();
            } else {
                addToGameLog("Not enough cash for food.");
            }
        }

        function buyGas() {
            if (gameState.player.cash >= 30) {
                gameState.player.cash -= 30;
                gameState.player.inventory.push('gas_can');
                addToGameLog("Bought a gas can.");
                showFloatingText("+1 Gas Can", "clue", document.getElementById('rest-gas'));
                updateRestScreen();
                updateGameScreen();
            } else {
                addToGameLog("Not enough cash for gas.");
            }
        }

        function findMystery() {
            if (gameState.player.cash >= 15) {
                gameState.player.cash -= 15;
                
                if (!gameState.player.activeMystery) {
                    const availableMysteries = Object.keys(mysteries).filter(m => 
                        mysteries[m].difficulty <= gameState.player.mysteriesSolved + 1
                    );
                    
                    if (availableMysteries.length > 0) {
                        const mysteryId = availableMysteries[Math.floor(Math.random() * availableMysteries.length)];
                        gameState.player.activeMystery = mysteryId;
                        gameState.player.cluesFound = 0;
                        gameState.player.cluesNeeded = mysteries[mysteryId].cluesNeeded;
                        
                        addToGameLog(`You hear rumors about: ${mysteries[mysteryId].name}`);
                        addToGameLog(mysteries[mysteryId].description);
                        showFloatingText("Mystery Found!", "clue", document.getElementById('rest-find-mystery'));
                    } else {
                        addToGameLog("No new mysteries to discover right now.");
                    }
                } else {
                    addToGameLog("You're already investigating a mystery!");
                }
                
                updateRestScreen();
                updateGameScreen();
            } else {
                addToGameLog("Not enough cash to gather information.");
            }
        }

        // ================================================
        // MYSTERY FINDING SYSTEM
        // ================================================

        function updateFindMysteryButton() {
            const findBtn = document.getElementById('find-mystery-btn');
            if (!gameState.player.activeMystery) {
                findBtn.style.display = 'block';
                const cost = 25 + gameState.player.mysteriesSolved * 5;
                findBtn.innerHTML = `FIND MYSTERY ($${cost})`;
            } else {
                findBtn.style.display = 'none';
            }
        }

        function purchaseMystery() {
            const cost = 25 + gameState.player.mysteriesSolved * 5;
            
            if (gameState.player.cash >= cost && !gameState.player.activeMystery) {
                gameState.player.cash -= cost;
                
                const availableMysteries = Object.keys(mysteries).filter(m => 
                    mysteries[m].difficulty <= gameState.player.mysteriesSolved + 1
                );
                
                if (availableMysteries.length > 0) {
                    const mysteryId = availableMysteries[Math.floor(Math.random() * availableMysteries.length)];
                    gameState.player.activeMystery = mysteryId;
                    gameState.player.cluesFound = 0;
                    gameState.player.cluesNeeded = mysteries[mysteryId].cluesNeeded;
                    
                    addToGameLog(`Paid $${cost} for information.`);
                    addToGameLog(`Discovered: ${mysteries[mysteryId].name}`);
                    addToGameLog(mysteries[mysteryId].description);
                    
                    showFloatingText("Mystery Found!", "clue", document.getElementById('find-mystery-btn'));
                    audioSystem.playSuccess();
                } else {
                    addToGameLog("No mysteries available at your current reputation level.");
                    gameState.player.cash += cost; // Refund
                }
                
                updateFindMysteryButton();
                updateGameScreen();
            } else if (gameState.player.activeMystery) {
                addToGameLog("You're already investigating a mystery!");
            } else {
                addToGameLog(`Not enough cash. Need $${cost}.`);
            }
        }

        // ================================================
        // GAME STATE MANAGEMENT
        // ================================================

        function addClue(clueId) {
            gameState.player.notes.push(`Clue found: ${clueId}`);
            addToGameLog("Added to case notes.");
        }

        function showDefeat(reason) {
            document.getElementById('defeat-message').textContent = `You ${reason}`;
            document.getElementById('loss-message').textContent = 
                `Lost $${Math.floor(gameState.player.cash * 0.3)} and all evidence.`;
            
            // Penalties
            gameState.player.cash = Math.floor(gameState.player.cash * 0.7);
            gameState.player.evidence = [];
            gameState.player.activeMystery = null;
            gameState.player.cluesFound = 0;
            
            showScreen('defeat');
            audioSystem.playDefeat();
        }

        function continueFromDefeat() {
            gameState.player.gas = 50;
            gameState.player.sanity = 50;
            gameState.player.mile = Math.max(0, gameState.player.mile - 100);
            showScreen('game');
            addToGameLog("You wake up in a strange town with no memory of how you got here...");
        }

        // ================================================
        // UI UPDATES
        // ================================================

        function updateGameScreen() {
            document.getElementById('current-location').textContent = locations[gameState.player.location].name;
            document.getElementById('player-gas').textContent = gameState.player.gas;
            document.getElementById('player-max-gas').textContent = gameState.player.maxGas;
            document.getElementById('player-sanity').textContent = gameState.player.sanity;
            document.getElementById('player-max-sanity').textContent = gameState.player.maxSanity;
            document.getElementById('player-cash').textContent = gameState.player.cash;
            document.getElementById('player-day').textContent = gameState.player.day;
            document.getElementById('player-mysteries').textContent = gameState.player.mysteriesSolved;
            
            // Update bars
            const gasPercent = (gameState.player.gas / gameState.player.maxGas) * 100;
            const sanityPercent = (gameState.player.sanity / gameState.player.maxSanity) * 100;
            const cashPercent = (gameState.player.cash / 500) * 100;
            
            document.getElementById('gas-bar').style.width = `${gasPercent}%`;
            document.getElementById('sanity-bar').style.width = `${sanityPercent}%`;
            document.getElementById('cash-bar').style.width = `${cashPercent > 100 ? 100 : cashPercent}%`;
            
            // Update current investigation
            const investigationEl = document.getElementById('current-investigation');
            if (gameState.player.activeMystery) {
                const mystery = mysteries[gameState.player.activeMystery];
                investigationEl.innerHTML = `
                    <strong>${mystery.name}</strong><br>
                    <small>${mystery.description}</small><br>
                    <small>Clues: ${gameState.player.cluesFound}/${gameState.player.cluesNeeded}</small>
                `;
            } else {
                investigationEl.innerHTML = "No active investigation";
            }
            
            // Update car status
            const carSlots = document.querySelectorAll('#car-display .location-slot');
            carSlots[0].textContent = `Engine: ${gameState.player.gas > 20 ? 'OK' : 'LOW'}`;
            carSlots[1].textContent = `Tires: ${gameState.player.day % 5 === 0 ? 'WEAR' : 'GOOD'}`;
            carSlots[2].textContent = `Radio: ${gameState.player.sanity > 50 ? 'STATIC' : 'WHISPERS'}`;
            
            // Update find mystery button
            updateFindMysteryButton();
        }

        function updateDriveScreen() {
            document.getElementById('drive-player-gas').textContent = gameState.player.gas;
            document.getElementById('drive-player-max-gas').textContent = gameState.player.maxGas;
            document.getElementById('drive-player-sanity').textContent = gameState.player.sanity;
            document.getElementById('drive-player-max-sanity').textContent = gameState.player.maxSanity;
            document.getElementById('drive-player-cash').textContent = gameState.player.cash;
            document.getElementById('next-town').textContent = Math.max(0, gameState.nextTownDistance - gameState.driveDistance);
            
            const gasPercent = (gameState.player.gas / gameState.player.maxGas) * 100;
            const sanityPercent = (gameState.player.sanity / gameState.player.maxSanity) * 100;
            const distancePercent = (gameState.driveDistance / gameState.nextTownDistance) * 100;
            
            document.getElementById('drive-gas-bar').style.width = `${gasPercent}%`;
            document.getElementById('drive-sanity-bar').style.width = `${sanityPercent}%`;
            document.getElementById('distance-bar').style.width = `${distancePercent}%`;
        }

        function updateInvestigationScreen() {
            document.getElementById('investigate-location').textContent = locations[gameState.player.location].name;
            document.getElementById('clues-found').textContent = gameState.player.cluesFound;
            document.getElementById('clues-needed').textContent = gameState.player.cluesNeeded;
            
            if (gameState.player.activeMystery) {
                const mystery = mysteries[gameState.player.activeMystery];
                document.getElementById('mystery-description').innerHTML = `
                    <strong>${mystery.name}</strong><br>
                    ${mystery.description}<br>
                    <small>Difficulty: ${'★'.repeat(mystery.difficulty)}</small>
                `;
                
                // Update investigation options
                const optionsContainer = document.getElementById('investigation-options');
                optionsContainer.innerHTML = '';
                
                const investigationActions = [
                    { id: 'interview', name: 'Interview Locals', desc: 'Talk to townspeople (-10 Sanity, 60% clue chance)' },
                    { id: 'search', name: 'Search Area', desc: 'Look for physical evidence (-5 Sanity, 40% clue chance)' },
                    { id: 'research', name: 'Research', desc: 'Check archives (-8 Sanity, 50% clue chance)' },
                    { id: 'stakeout', name: 'Stakeout', desc: 'Watch at night (-15 Sanity, 70% clue chance)' }
                ];
                
                investigationActions.forEach(action => {
                    const option = document.createElement('div');
                    option.className = 'button';
                    option.innerHTML = `
                        <strong>${action.name}</strong><br>
                        <small>${action.desc}</small>
                    `;
                    option.addEventListener('click', function(e) {
                        audioSystem.playClick();
                        investigateAction(action.id);
                    });
                    optionsContainer.appendChild(option);
                });
                
                // Update evidence display
                updateEvidenceCollectedDisplay();
                
                // Enable/disable solve button
                const solveButton = document.getElementById('solve-button');
                if (gameState.player.cluesFound >= gameState.player.cluesNeeded) {
                    solveButton.classList.remove('disabled');
                    solveButton.style.backgroundColor = '#8b0000';
                } else {
                    solveButton.classList.add('disabled');
                    solveButton.style.backgroundColor = '#1a1a2a';
                }
            } else {
                document.getElementById('mystery-description').innerHTML = 
                    'No active mystery. Travel to find mysteries or rest at motels to hear rumors.';
                document.getElementById('investigation-options').innerHTML = 
                    '<div>No investigation available</div>';
            }
        }

        function updateEvidenceCollectedDisplay() {
            const evidenceContainer = document.getElementById('evidence-collected');
            if (gameState.player.evidence.length === 0) {
                evidenceContainer.innerHTML = 'No evidence collected yet.';
            } else {
                evidenceContainer.innerHTML = gameState.player.evidence.map(evidenceId => {
                    const item = items[evidenceId];
                    if (item) {
                        return `<div class="log-entry">• ${item.name}: ${item.description}</div>`;
                    }
                    return `<div class="log-entry">• ${evidenceId.replace(/_/g, ' ')}</div>`;
                }).join('');
            }
        }

        function updatePlayerStats() {
            updateGameScreen();
        }

        // ================================================
        // UTILITY FUNCTIONS
        // ================================================

        function addToGameLog(message, isRadio = false) {
            const logElement = document.getElementById('game-log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${isRadio ? 'radio-active' : ''}`;
            entry.textContent = message;
            logElement.appendChild(entry);
            logElement.scrollTop = logElement.scrollHeight;
        }

        function addToDriveLog(message, isRadio = false) {
            const logElement = document.getElementById('drive-log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${isRadio ? 'radio-active' : ''}`;
            entry.textContent = message;
            logElement.appendChild(entry);
            logElement.scrollTop = logElement.scrollHeight;
        }

        function addToRadioLog(message) {
            const logElement = document.getElementById('radio-log');
            const entry = document.createElement('div');
            entry.className = 'radio-message';
            
            const parts = message.split(': ');
            if (parts.length > 1) {
                entry.innerHTML = `<span>${parts[0]}:</span> <span style="color: #d4af37;">"${parts[1]}"</span>`;
            } else {
                entry.textContent = message;
            }
            
            logElement.appendChild(entry);
            logElement.scrollTop = logElement.scrollHeight;
        }

        function showFloatingText(text, type, element) {
            if (!element) return;
            const rect = element.getBoundingClientRect();
            const floatText = document.createElement('div');
            floatText.className = `floating-text ${type}-text`;
            floatText.textContent = text;
            floatText.style.left = (rect.left + rect.width/2 - 20) + 'px';
            floatText.style.top = (rect.top - 10) + 'px';
            document.body.appendChild(floatText);
            
            setTimeout(() => floatText.remove(), 1000);
        }

        function createTooltip(element, text) {
            element.addEventListener('mouseenter', (e) => {
                const tooltip = document.createElement('div');
                tooltip.className = 'tooltip';
                tooltip.textContent = text;
                tooltip.style.left = (e.clientX + 10) + 'px';
                tooltip.style.top = (e.clientY - 40) + 'px';
                document.body.appendChild(tooltip);
                setTimeout(() => tooltip.classList.add('show'), 10);
                
                element.addEventListener('mouseleave', () => {
                    tooltip.remove();
                }, { once: true });
            });
        }

        // ================================================
        // AUDIO CONTROLS
        // ================================================

        function toggleMusic() {
            audioSystem.enabled.music = !audioSystem.enabled.music;
            document.getElementById('music-toggle').textContent = `Music: ${audioSystem.enabled.music ? 'ON' : 'OFF'}`;
        }

        function toggleSFX() {
            audioSystem.enabled.sfx = !audioSystem.enabled.sfx;
            document.getElementById('sfx-toggle').textContent = `SFX: ${audioSystem.enabled.sfx ? 'ON' : 'OFF'}`;
        }

        // ================================================
        // ACCESSIBILITY FUNCTIONS
        // ================================================

        function cycleFontSize() {
            const sizes = ['small', 'medium', 'large', 'xlarge'];
            const current = document.body.className.match(/font-\w+/);
            let nextSize = 'medium';
            
            if (current) {
                const currentSize = current[0].replace('font-', '');
                const currentIndex = sizes.indexOf(currentSize);
                nextSize = sizes[(currentIndex + 1) % sizes.length];
            }
            
            document.body.className = document.body.className.replace(/font-\w+/g, '');
            document.body.classList.add(`font-${nextSize}`);
            document.getElementById('font-size-btn').textContent = `Font: ${nextSize.charAt(0).toUpperCase() + nextSize.slice(1)}`;
        }

        function showTutorial() {
            alert("HIGHWAY HAUNTINGS\n\nDrive between towns to find mysteries.\nInvestigate to gather clues.\nSolve mysteries for cash and reputation.\nKeep your gas and sanity up.\nListen to the radio for hints and warnings.\n\nGood luck on the road.");
        }

        // ================================================
        // SAVE/LOAD SYSTEM
        // ================================================

        function saveGame() {
            const saveData = {
                player: gameState.player,
                day: gameState.player.day,
                mile: gameState.player.mile,
                mysteriesSolved: gameState.player.mysteriesSolved,
                inventory: gameState.player.inventory,
                evidence: gameState.player.evidence,
                cash: gameState.player.cash,
                gas: gameState.player.gas,
                sanity: gameState.player.sanity,
                activeMystery: gameState.player.activeMystery,
                cluesFound: gameState.player.cluesFound,
                cluesNeeded: gameState.player.cluesNeeded
            };
            
            localStorage.setItem('highwayHauntingsSave', JSON.stringify(saveData));
            addToGameLog("Game saved!");
        }

        function loadGame() {
            const saved = localStorage.getItem('highwayHauntingsSave');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    Object.assign(gameState.player, data);
                    updateGameScreen();
                    showScreen('game');
                    addToGameLog("Game loaded successfully!");
                    return true;
                } catch (e) {
                    console.error("Load error:", e);
                    addToGameLog("Failed to load save.");
                }
            } else {
                addToGameLog("No saved game found.");
            }
            return false;
        }

        // ================================================
        // ANIMATION & VISUAL EFFECTS
        // ================================================

        function startRoadAnimation() {
            const animation = document.getElementById('road-animation');
            if (animation) {
                animation.style.animationPlayState = 'running';
            }
        }

        function checkResources() {
            const gasBar = document.getElementById('gas-bar');
            const sanityBar = document.getElementById('sanity-bar');
            
            if (gasBar && gameState.player.gas <= 20) {
                gasBar.classList.add('gas-low');
            } else if (gasBar) {
                gasBar.classList.remove('gas-low');
            }
            
            if (sanityBar && gameState.player.sanity <= 30) {
                sanityBar.classList.add('sanity-low');
            } else if (sanityBar) {
                sanityBar.classList.remove('sanity-low');
            }
        }

        // Make buyUpgrade globally available
        window.buyUpgrade = buyUpgrade;

        // Initialize the game when page loads
        window.addEventListener('load', function() {
            console.log("Page loaded, initializing game...");
            initGame();
        });
    </script>
</body>
</html>
