<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dracula's Redemption - Expanded Gamebook Adventure</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #000;
            color: #fff;
            font-family: 'Press Start 2P', cursive;
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .game-container {
            border: 4px double #fff;
            padding: 20px;
            margin-bottom: 20px;
            background-color: #111;
            min-height: 80vh;
        }
        
        .screen {
            display: none;
        }
        
        .active {
            display: block;
        }
        
        h1, h2, h3 {
            color: #ff3333;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 0 5px #ff0000;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 30px;
        }
        
        h2 {
            font-size: 1.8rem;
            margin-top: 20px;
        }
        
        h3 {
            font-size: 1.2rem;
            text-align: left;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
            margin-top: 15px;
        }
        
        .game-text {
            background-color: #000;
            border: 2px solid #333;
            padding: 15px;
            margin: 20px 0;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            font-size: 0.9rem;
            line-height: 1.8;
        }
        
        .game-text p {
            margin-bottom: 15px;
        }
        
        .npc-dialogue {
            color: #ffff66;
            font-style: italic;
            margin: 10px 0;
            padding-left: 10px;
            border-left: 2px solid #ffff66;
        }
        
        .player-dialogue {
            color: #66ff66;
            margin: 10px 0;
            padding-left: 10px;
            border-left: 2px solid #66ff66;
        }
        
        .button-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }
        
        button {
            background-color: #222;
            color: #fff;
            border: 2px solid #666;
            font-family: 'Press Start 2P', cursive;
            padding: 12px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
            flex-grow: 1;
            min-width: 200px;
        }
        
        button:hover:not(:disabled) {
            background-color: #333;
            border-color: #ff3333;
            color: #ff3333;
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-item {
            background-color: #222;
            padding: 10px;
            border: 1px solid #444;
            text-align: center;
        }
        
        .stat-value {
            color: #ffff66;
            font-weight: bold;
            font-size: 1.5rem;
        }
        
        .inventory {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
        }
        
        .item {
            background-color: #1a1a1a;
            padding: 8px;
            border: 1px solid #333;
            font-size: 0.8rem;
        }
        
        .item-rare {
            border-color: #ff9900;
            color: #ff9900;
        }
        
        .item-legendary {
            border-color: #ff3366;
            color: #ff3366;
        }
        
        .outcome-good {
            color: #66ff66;
        }
        
        .outcome-bad {
            color: #ff6666;
        }
        
        .warning {
            color: #ff9900;
        }
        
        .game-over {
            color: #ff0000;
            font-size: 1.5rem;
            text-align: center;
            margin: 30px 0;
        }
        
        .victory {
            color: #66ff66;
            font-size: 1.5rem;
            text-align: center;
            margin: 30px 0;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #666;
            font-size: 0.7rem;
            border-top: 1px solid #333;
            padding-top: 15px;
        }
        
        /* Combat styles */
        .combat-screen {
            background-color: #220000;
            border: 2px solid #ff0000;
        }
        
        .combatant {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 10px 0;
            background-color: #330000;
            border: 1px solid #660000;
        }
        
        .combatant-player {
            border-color: #006600;
            background-color: #003300;
        }
        
        .health-bar {
            width: 100%;
            height: 20px;
            background-color: #330000;
            border: 1px solid #666;
            margin: 5px 0;
        }
        
        .health-fill {
            height: 100%;
            background-color: #ff0000;
            transition: width 0.3s;
        }
        
        .health-fill-player {
            background-color: #66ff66;
        }
        
        /* Dice roller */
        .dice-roller {
            background-color: #222;
            border: 2px solid #666;
            padding: 10px;
            margin: 10px 0;
            text-align: center;
        }
        
        .dice-result {
            font-size: 2rem;
            color: #ffff66;
            margin: 10px 0;
        }
        
        .roll-button {
            background-color: #333;
            color: #ffff66;
            border-color: #ffff66;
        }
        
        /* Skill check display */
        .skill-check {
            background-color: #1a1a2a;
            border: 1px solid #4444ff;
            padding: 10px;
            margin: 10px 0;
        }
        
        .skill-success {
            color: #3399ff;
            background-color: #112233;
            padding: 5px;
            margin: 5px 0;
            border-left: 3px solid #3399ff;
        }
        
        .skill-failure {
            color: #ff6666;
            background-color: #332222;
            padding: 5px;
            margin: 5px 0;
            border-left: 3px solid #ff6666;
        }
        
        /* Puzzle and trap styles */
        .puzzle-container {
            background-color: #1a1a1a;
            border: 2px dashed #ff9900;
            padding: 15px;
            margin: 15px 0;
        }
        
        .trap-warning {
            color: #ff3333;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* Gamebook section numbers */
        .section-number {
            color: #ffff66;
            font-weight: bold;
            margin-right: 10px;
        }
        
        /* Inventory slots */
        .inventory-slot {
            width: 80px;
            height: 80px;
            border: 2px solid #444;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin: 5px;
            background-color: #222;
            cursor: pointer;
        }
        
        .inventory-slot.filled {
            border-color: #ff9900;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }
            
            h2 {
                font-size: 1.3rem;
            }
            
            .game-text {
                font-size: 0.8rem;
            }
            
            button {
                font-size: 0.7rem;
                min-width: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Start Screen -->
        <div id="start-screen" class="screen active">
            <h1>DRACULA'S REDEMPTION</h1>
            <h2>EXPANDED GAMEBOOK ADVENTURE</h2>
            <div class="game-text">
                <p>Transylvania, 1897. The blood moon rises over the Carpathian Mountains.</p>
                <p>You are Count Dracula, an ancient vampire prince, awakening from centuries of slumber.</p>
                <p>But something is different this night. An ancient prophecy speaks of redemption, or damnation.</p>
                <p class="warning">This is a Fighting Fantasy-style gamebook adventure. You will need:</p>
                <p>• Your CHARACTER SHEET (Stamina, Skill, Luck, Vampiric Powers)</p>
                <p>• Two six-sided dice (2D6)</p>
                <p>• A pencil and eracer to track your inventory and stats</p>
                <p class="outcome-good">Now with 100+ sections! Multiple endings! Extended gameplay!</p>
                <p class="outcome-bad">Beware: Death lurks around every corner!</p>
            </div>
            <div class="button-container">
                <button id="start-btn">BEGIN YOUR QUEST</button>
                <button id="rules-btn">GAME RULES</button>
            </div>
        </div>
        
        <!-- Rules Screen -->
        <div id="rules-screen" class="screen">
            <h2>GAMEBOOK RULES</h2>
            <div class="game-text">
                <h3>YOUR CHARACTER</h3>
                <p><span class="section-number">1.</span> <strong>STAMINA:</strong> Your health. If it reaches 0, you die.</p>
                <p><span class="section-number">2.</span> <strong>SKILL:</strong> Your combat ability and agility.</p>
                <p><span class="section-number">3.</span> <strong>LUCK:</strong> Your fortune. Test Luck to avoid traps or find treasure.</p>
                <p><span class="section-number">4.</span> <strong>VAMPIRIC POWER:</strong> Your dark abilities. Spend Blood Points to use them.</p>
                
                <h3>COMBAT</h3>
                <p><span class="section-number">1.</span> Roll 2D6 + your SKILL vs enemy's 2D6 + their SKILL</p>
                <p><span class="section-number">2.</span> Higher score hits for damage (see enemy stats)</p>
                <p><span class="section-number">3.</span> You may flee on your turn (Test Skill to escape)</p>
                
                <h3>TESTING SKILL</h3>
                <p>Roll 2D6. If result ≤ your SKILL, you succeed!</p>
                <p>Example: Skill 12 needs 12 or less on 2D6</p>
                
                <h3>TESTING LUCK</h3>
                <p>Roll 2D6. If result ≤ your LUCK, you're lucky!</p>
                <p>Each Luck test reduces LUCK by 1 (win or lose)</p>
                
                <h3>INVENTORY</h3>
                <p>You can carry 10 items. Weapons, armor, and special items take slots.</p>
                <p>Some items give combat bonuses or solve puzzles.</p>
            </div>
            <div class="button-container">
                <button onclick="showStartScreen()">BACK</button>
                <button onclick="showCharacterScreen()">CREATE CHARACTER</button>
            </div>
        </div>
        
        <!-- Character Creation Screen -->
        <div id="character-screen" class="screen">
            <h2>CREATE YOUR DRACULA</h2>
            <div class="game-text">
                <p>Roll 2D6 for each stat, then distribute 6 bonus points as you wish.</p>
                <p class="warning">Write these scores on your character sheet!</p>
                
                <div class="stats-container">
                    <div class="stat-item">
                        <h3>STAMINA</h3>
                        <div class="dice-roller">
                            <div class="dice-result" id="stamina-roll">--</div>
                            <button class="roll-button" onclick="rollStat('stamina')">ROLL 2D6 + 12</button>
                        </div>
                        <p>Current: <span id="stamina-value" class="stat-value">0</span></p>
                        <button onclick="adjustStat('stamina', 1)">+</button>
                        <button onclick="adjustStat('stamina', -1)">-</button>
                    </div>
                    
                    <div class="stat-item">
                        <h3>SKILL</h3>
                        <div class="dice-roller">
                            <div class="dice-result" id="skill-roll">--</div>
                            <button class="roll-button" onclick="rollStat('skill')">ROLL 2D6 + 6</button>
                        </div>
                        <p>Current: <span id="skill-value" class="stat-value">0</span></p>
                        <button onclick="adjustStat('skill', 1)">+</button>
                        <button onclick="adjustStat('skill', -1)">-</button>
                    </div>
                    
                    <div class="stat-item">
                        <h3>LUCK</h3>
                        <div class="dice-roller">
                            <div class="dice-result" id="luck-roll">--</div>
                            <button class="roll-button" onclick="rollStat('luck')">ROLL 2D6 + 6</button>
                        </div>
                        <p>Current: <span id="luck-value" class="stat-value">0</span></p>
                        <button onclick="adjustStat('luck', 1)">+</button>
                        <button onclick="adjustStat('luck', -1)">-</button>
                    </div>
                </div>
                
                <p>Bonus points remaining: <span id="bonus-points" class="stat-value">6</span></p>
                <p class="warning">Minimum Stamina: 12, Minimum Skill: 6, Minimum Luck: 6</p>
                
                <h3>CHOOSE STARTING EQUIPMENT</h3>
                <p>Select 3 items from the list below:</p>
            </div>
            
            <div class="button-container">
                <button onclick="selectEquipment('silver_dagger')">SILVER DAGGER (+1 Skill in combat)</button>
                <button onclick="selectEquipment('holy_water')">VIAL OF HOLY WATER (3 uses)</button>
                <button onclick="selectEquipment('garlic_charm')">GARLIC CHARM (vs vampires)</button>
                <button onclick="selectEquipment('healing_potion')">HEALING POTION (+4 Stamina)</button>
                <button onclick="selectEquipment('lantern')">BRASS LANTERN (light in darkness)</button>
                <button onclick="selectEquipment('lockpicks')">LOCKPICKS (+2 Skill for traps)</button>
                <button onclick="selectEquipment('wolfsbane')">WOLFSBANE (vs werewolves)</button>
                <button onclick="selectEquipment('thieves_tools')">THIEVES' TOOLS</button>
            </div>
            
            <div class="inventory" id="selected-equipment">
                <!-- Selected equipment will appear here -->
            </div>
            
            <div class="button-container">
                <button id="begin-btn" onclick="startGame()" disabled>BEGIN ADVENTURE AT SECTION 1</button>
            </div>
        </div>
        
        <!-- Main Game Screen -->
        <div id="game-screen" class="screen">
            <h2>DRACULA'S REDEMPTION - EXPANDED EDITION</h2>
            
            <div class="stats-container">
                <div class="stat-item">
                    <h3>STAMINA</h3>
                    <div class="stat-value" id="current-stamina">0</div>
                    <div class="health-bar">
                        <div id="stamina-bar" class="health-fill health-fill-player" style="width: 100%"></div>
                    </div>
                </div>
                <div class="stat-item">
                    <h3>SKILL</h3>
                    <div class="stat-value" id="current-skill">0</div>
                    <div>Current Bonus: <span id="skill-bonus">+0</span></div>
                </div>
                <div class="stat-item">
                    <h3>LUCK</h3>
                    <div class="stat-value" id="current-luck">0</div>
                    <div>Next Test: <span id="luck-test">--</span></div>
                </div>
                <div class="stat-item">
                    <h3>BLOOD</h3>
                    <div class="stat-value" id="current-blood">5</div>
                    <div>Vampiric Power Points</div>
                </div>
                <div class="stat-item">
                    <h3>SECTION</h3>
                    <div class="stat-value" id="current-section">1</div>
                    <div>Gamebook Reference</div>
                </div>
            </div>
            
            <div class="button-container">
                <button onclick="showInventory()">INVENTORY (<span id="inventory-count">0</span>/10)</button>
                <button onclick="showPowers()">VAMPIRIC POWERS</button>
                <button onclick="rollDice()">ROLL DICE</button>
                <button onclick="testLuck()">TEST LUCK</button>
            </div>
            
            <div class="game-text" id="game-text">
                <!-- Game text will be added here dynamically -->
            </div>
            
            <div class="button-container" id="action-buttons">
                <!-- Action buttons will be added here dynamically -->
            </div>
            
            <div id="dice-results" style="display:none;">
                <!-- Dice results will appear here -->
            </div>
        </div>
        
        <!-- Inventory Screen -->
        <div id="inventory-screen" class="screen">
            <h2>INVENTORY</h2>
            <div class="game-text">
                <h3>EQUIPMENT (<span id="total-items">0</span>/10 slots)</h3>
                <div class="inventory" id="inventory-items">
                    <!-- Inventory items will appear here -->
                </div>
                
                <h3>WEAPONS (Equipped)</h3>
                <div id="equipped-weapons">
                    <!-- Equipped weapons will appear here -->
                </div>
                
                <h3>SPECIAL ITEMS</h3>
                <div id="special-items">
                    <!-- Special items will appear here -->
                </div>
                
                <h3>PROVISIONS</h3>
                <div id="provisions">
                    <!-- Provisions will appear here -->
                </div>
            </div>
            <div class="button-container">
                <button onclick="showGameScreen()">RETURN TO GAME</button>
                <button onclick="useHealing()">USE HEALING (if available)</button>
            </div>
        </div>
        
        <!-- Powers Screen -->
        <div id="powers-screen" class="screen">
            <h2>VAMPIRIC POWERS</h2>
            <div class="game-text">
                <p>Blood Points: <span class="stat-value" id="blood-points-display">5</span></p>
                <p>Spend 1 Blood Point to use a power. Regain 1 Blood Point by drinking blood from a victim.</p>
                
                <div class="button-container">
                    <button onclick="usePower('hypnotic_gaze')" id="power-hypnotic">HYPNOTIC GAZE (Cost: 1)</button>
                    <button onclick="usePower('shadow_form')" id="power-shadow">SHADOW FORM (Cost: 1)</button>
                    <button onclick="usePower('bat_swarm')" id="power-bat">BAT SWARM (Cost: 1)</button>
                    <button onclick="usePower('blood_drain')" id="power-drain">BLOOD DRAIN (Cost: 0, combat)</button>
                    <button onclick="usePower('mist_form')" id="power-mist">MIST FORM (Cost: 2)</button>
                    <button onclick="usePower('animal_call')" id="power-animal">ANIMAL CALL (Cost: 1)</button>
                </div>
                
                <h3>POWER DESCRIPTIONS</h3>
                <p><strong>Hypnotic Gaze:</strong> Test Skill vs target's Skill. If successful, they obey one command.</p>
                <p><strong>Shadow Form:</strong> Become shadows for 3 turns. +4 to escape rolls.</p>
                <p><strong>Bat Swarm:</strong> Transform into bats. Fly over obstacles or confuse enemies.</p>
                <p><strong>Blood Drain:</strong> In combat, restore 2 Stamina if you hit.</p>
                <p><strong>Mist Form:</strong> Become intangible. Pass through bars or under doors.</p>
                <p><strong>Animal Call:</strong> Summon wolves or bats to aid you.</p>
            </div>
            <div class="button-container">
                <button onclick="showGameScreen()">RETURN TO GAME</button>
            </div>
        </div>
        
        <!-- Combat Screen -->
        <div id="combat-screen" class="screen">
            <h2>COMBAT!</h2>
            <div class="game-text combat-screen" id="combat-text">
                <!-- Combat text will appear here -->
            </div>
            
            <div class="stats-container">
                <div class="stat-item">
                    <h3>YOUR STAMINA</h3>
                    <div class="stat-value" id="combat-player-stamina">0</div>
                    <div class="health-bar">
                        <div id="player-combat-bar" class="health-fill health-fill-player" style="width: 100%"></div>
                    </div>
                </div>
                <div class="stat-item">
                    <h3>ENEMY STAMINA</h3>
                    <div class="stat-value" id="combat-enemy-stamina">0</div>
                    <div class="health-bar">
                        <div id="enemy-combat-bar" class="health-fill" style="width: 100%"></div>
                    </div>
                </div>
            </div>
            
            <div id="combat-round">
                <!-- Combat round info will appear here -->
            </div>
            
            <div class="button-container" id="combat-actions">
                <!-- Combat actions will appear here -->
            </div>
        </div>
        
        <!-- Game Over Screen -->
        <div id="gameover-screen" class="screen">
            <h2>YOUR ADVENTURE HAS ENDED</h2>
            <div class="game-text" id="gameover-text">
                <!-- Game over text will appear here -->
            </div>
            <div class="button-container">
                <button onclick="restartGame()">TRY AGAIN</button>
            </div>
        </div>
        
        <!-- Victory Screen -->
        <div id="victory-screen" class="screen">
            <h2>VICTORY!</h2>
            <div class="game-text" id="victory-text">
                <!-- Victory text will appear here -->
            </div>
            <div class="button-container">
                <button onclick="restartGame()">PLAY AGAIN</button>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>DRACULA'S REDEMPTION - EXPANDED FIGHTING FANTASY STYLE GAMEBOOK ADVENTURE</p>
        <p>Now with 100+ sections! Multiple paths! Extended gameplay!</p>
    </div>

    <script>
        // Gamebook Adventure State
        const gameState = {
            screen: 'start',
            stats: {
                initialStamina: 0,
                stamina: 0,
                maxStamina: 0,
                initialSkill: 0,
                skill: 0,
                skillBonus: 0,
                initialLuck: 0,
                luck: 0,
                bloodPoints: 5,
                maxBloodPoints: 10
            },
            inventory: [],
            equippedWeapon: null,
            armor: null,
            currentSection: 1,
            visitedSections: [],
            combat: {
                active: false,
                enemy: null,
                enemyStamina: 0,
                round: 1,
                playerRoll: 0,
                enemyRoll: 0
            },
            dice: {
                value1: 0,
                value2: 0,
                total: 0
            },
            gameOver: false,
            victory: false,
            bonusPoints: 6,
            selectedEquipment: []
        };
        
        // COMPLETE GAMEBOOK SECTIONS WITH ALL CONNECTIONS
        const sections = {
            1: {
                text: "You awaken in your coffin as the blood moon rises. The centuries of sleep have left you weakened, but the ancient hunger returns. Through the castle window, you see lights in the village below. Do you:",
                options: [
                    { text: "Remain in the castle and explore your ancestral home", goto: 2, test: null },
                    { text: "Fly to the village as a bat to feed", goto: 3, test: null },
                    { text: "Use your hypnotic powers to call a victim to the castle", goto: 4, test: { type: "skill", difficulty: 10 } }
                ]
            },
            2: {
                text: "The castle is vast and filled with ancient secrets. Dust covers everything. In the main hall, you find three doors. The left door bears the symbol of a wolf. The center door has a dragon crest. The right door shows a crescent moon. Which do you choose?",
                options: [
                    { text: "The wolf door", goto: 5, test: null },
                    { text: "The dragon door", goto: 6, test: null },
                    { text: "The moon door", goto: 7, test: null },
                    { text: "Return to the coffin chamber", goto: 100, test: null },
                    { text: "Explore the castle dungeons", goto: 19, test: null }
                ]
            },
            3: {
                text: "You transform into a bat and fly toward the village. As you approach, you see a lone traveler on the road below, and a carriage approaching from the opposite direction. Do you:",
                options: [
                    { text: "Attack the lone traveler", goto: 8, test: null },
                    { text: "Investigate the carriage", goto: 9, test: { type: "skill", difficulty: 9 } },
                    { text: "Continue to the village square", goto: 10, test: null }
                ]
            },
            4: {
                text: "You concentrate your vampiric will, sending a mental call into the night. Roll 2D6 and add your Skill. If the total is 10 or more, turn to 11. If 9 or less, turn to 12.",
                options: [
                    { text: "Roll 2D6 + Skill", goto: 11, test: { type: "skill", target: 10 } },
                    { text: "The attempt fails", goto: 12, test: { type: "autoFail" } }
                ]
            },
            5: {
                text: "The wolf door leads to a trophy room filled with hunting relics. Among them, you find a SILVER DAGGER (add to inventory). On the wall hangs a WOLF PELT CLOAK that might offer protection. Suddenly, you hear growling from a shadowed corner! A WEREWOLF attacks!",
                options: [
                    { text: "Fight the werewolf", goto: 20, combat: "werewolf" },
                    { text: "Use Wolfsbane if you have it", goto: 21, test: { type: "item", item: "wolfsbane" } },
                    { text: "Flee back to the hall", goto: 2, test: { type: "skill", difficulty: 8 } }
                ]
            },
            6: {
                text: "The dragon door opens to a vast library filled with ancient books reaching to the ceiling. Dust dances in moonbeams from high windows. You see: 1) A GLOWING BOOK on a pedestal in the center, 2) Rows of bookshelves along the walls, 3) A STUDY AREA with a large oak desk, and 4) A TAPESTRY depicting your family history.",
                options: [
                    { text: "Approach the glowing book (WARNING: Trap!)", goto: 13, test: { type: "skill", difficulty: 10 } },
                    { text: "Search the bookshelves carefully", goto: 22, test: { type: "skill", difficulty: 8 } },
                    { text: "Examine the study area and desk", goto: 181, test: null },
                    { text: "Study the family tapestry", goto: 182, test: null },
                    { text: "Leave the library", goto: 2, test: null }
                ]
            },
            7: {
                text: "The moon door reveals an alchemy laboratory. Strange potions bubble on tables. You see three vials: red, blue, and green. A note says 'One grants strength, one grants wisdom, one is poison.' Which do you drink?",
                options: [
                    { text: "Red potion", goto: 16, test: null },
                    { text: "Blue potion", goto: 17, test: null },
                    { text: "Green potion", goto: 18, test: null },
                    { text: "Leave them all", goto: 2, test: null }
                ]
            },
            8: {
                text: "You descend upon the traveler, but as you land, you realize it's VAN HELSING, the vampire hunter! He was waiting for you! 'At last, demon! Your reign ends tonight!' He draws a silver sword and a cross.",
                options: [
                    { text: "Fight Van Helsing", goto: 30, combat: "van_helsing" },
                    { text: "Flee as bats", goto: 31, test: { type: "skill", difficulty: 12 } },
                    { text: "Try to hypnotize him", goto: 32, test: { type: "skill", difficulty: 14 } }
                ]
            },
            9: {
                text: "You land silently on the carriage roof. Peering inside, you see a young woman in a white dress. She looks out the window, her face pale and beautiful. She seems to sense your presence. 'Who's there?' she whispers.",
                options: [
                    { text: "Reveal yourself", goto: 33, test: null },
                    { text: "Use Hypnotic Gaze through the window", goto: 34, test: { type: "skill", difficulty: 9 } },
                    { text: "Fly away", goto: 3, test: null }
                ]
            },
            10: {
                text: "The village square is empty except for a fountain and a gallows. Three buildings surround the square: the TAVERN with light and noise, the CHURCH dark and silent, and the MAYOR'S HOUSE with a single lit window. Where do you go?",
                options: [
                    { text: "The tavern", goto: 40, test: null },
                    { text: "The church", goto: 41, test: null },
                    { text: "The mayor's house", goto: 42, test: null },
                    { text: "Return to the castle", goto: 1, test: null }
                ]
            },
            11: {
                text: "Your mental call is successful! A young villager, entranced, stumbles up the mountain path to the castle gates. He enters willingly. Do you:",
                options: [
                    { text: "Drink his blood (gain 3 Stamina, lose 1 Luck)", goto: 50, test: null },
                    { text: "Turn him into a vampire servant", goto: 51, test: { type: "skill", difficulty: 11 } },
                    { text: "Release him unharmed (gain 1 Luck)", goto: 52, test: null }
                ]
            },
            12: {
                text: "Your powers fail you tonight. The hunger grows painful. Lose 2 Stamina from the effort. Do you:",
                options: [
                    { text: "Try again with more effort", goto: 4, test: null },
                    { text: "Leave the castle to hunt", goto: 3, test: null },
                    { text: "Search the castle for other prey", goto: 2, test: null }
                ]
            },
            13: {
                text: "You leap aside as spikes shoot from the wall! Test your Skill (roll 2D6). If you roll equal to or less than your Skill, turn to 60. If you roll higher, turn to 61.",
                options: [
                    { text: "Test Skill", goto: 60, test: { type: "skill", target: function() { return gameState.stats.skill; } } },
                    { text: "Test automatically fails", goto: 61, test: { type: "autoFail" } }
                ]
            },
            14: {
                text: "You dissolve into mist as the spikes pass harmlessly through you. The glowing book is 'The Necronomicon Vampyrica' - an ancient vampire text. Reading it, you gain 2 Blood Points and learn new powers.",
                effect: { blood: 2 },
                options: [
                    { text: "Continue reading", goto: 62, test: null },
                    { text: "Take the book", goto: 63, test: null },
                    { text: "Leave the library", goto: 2, test: null }
                ]
            },
            15: {
                text: "The spikes impale you! Lose 4 Stamina. If you survive, you find the book is about werewolf lore. It mentions silver weapons are their weakness.",
                effect: { stamina: -4 },
                options: [
                    { text: "Take the book", goto: 63, test: null },
                    { text: "Leave the library", goto: 2, test: null }
                ]
            },
            16: {
                text: "You drink the red potion. It burns as it goes down! Roll 2D6. If you roll 7 or more, turn to 64. If you roll 6 or less, turn to 65.",
                options: [
                    { text: "Roll 2D6", goto: 64, test: { type: "luck", target: 7 } },
                    { text: "Automatic failure", goto: 65, test: { type: "autoFail" } }
                ]
            },
            17: {
                text: "You drink the blue potion. It tastes of blueberries and lightning. Your mind becomes sharper. Gain 2 Skill points permanently!",
                effect: { skill: 2 },
                options: [
                    { text: "Leave the laboratory", goto: 2, test: null }
                ]
            },
            18: {
                text: "You drink the green potion. It tastes of herbs and earth. You feel energy course through your veins. Gain 4 Stamina!",
                effect: { stamina: 4 },
                options: [
                    { text: "Leave the laboratory", goto: 2, test: null }
                ]
            },
            19: {
                text: "You descend stone steps into the castle dungeons. The air is cold and damp. You hear faint scratching sounds from the darkness. Ahead, you see a cell door slightly ajar. Torches flicker in iron sconces, casting long shadows.",
                options: [
                    { text: "Enter the cell", goto: 70, test: null },
                    { text: "Continue down the corridor", goto: 71, test: null },
                    { text: "Search for secret doors", goto: 104, test: { type: "skill", difficulty: 9 } },
                    { text: "Return to the main hall", goto: 2, test: null }
                ]
            },
            20: {
                text: "WEREWOLF: Skill 9, Stamina 10, Damage 2D6+2. The creature is immune to normal weapons. Silver weapons deal double damage. Wolfsbane causes it to flee. Fight!",
                combat: {
                    enemy: "werewolf",
                    skill: 9,
                    stamina: 10,
                    damage: "2d6+2",
                    weakness: "silver",
                    loot: ["wolf_fang", "silver_amulet"],
                    escape: 2
                }
            },
            21: {
                text: "You throw the Wolfsbane at the creature. It howls in pain and retreats into the shadows. You are safe for now. In the room, you find a SILVER AMULET (add to inventory).",
                effect: { item: "silver_amulet" },
                options: [
                    { text: "Take the amulet and leave", goto: 2, test: null },
                    { text: "Search the room further", goto: 72, test: null }
                ]
            },
            22: {
                text: "As you examine the library shelves, you notice one bookshelf looks slightly different. The books on it are fake - painted onto wood! You push against it and it swings open, revealing a secret passage leading downward into darkness. The air grows colder as you peer into the gloom.",
                options: [
                    { text: "Enter the secret passage", goto: 73, test: null },
                    { text: "Close it and continue searching the library", goto: 6, test: null },
                    { text: "Mark the location and return later", goto: 2, test: null }
                ]
            },
            23: {
                text: "The secret passage ends at an ancient crypt. Stone coffins line the walls, covered in centuries of dust. In the center, a larger coffin rests on a dais illuminated by a single shaft of moonlight through a crack in the ceiling. It bears your family crest - the dragon holding a sword.",
                options: [
                    { text: "Open the central coffin", goto: 24, test: null },
                    { text: "Examine the smaller coffins", goto: 25, test: null },
                    { text: "Search the crypt for treasures", goto: 180, test: { type: "skill", difficulty: 9 } },
                    { text: "Leave the crypt", goto: 2, test: null }
                ]
            },
            24: {
                text: "You open the central coffin. Inside lies a vampire in ancient robes - your sire, Vlad Tepes! He awakens! 'My child... join me in eternal darkness...'",
                options: [
                    { text: "Fight your sire", goto: 76, combat: "vlad_tepes" },
                    { text: "Kneel before him", goto: 77, test: null },
                    { text: "Flee from the crypt", goto: 78, test: { type: "skill", difficulty: 10 } }
                ]
            },
            25: {
                text: "The smaller coffins contain your former vampire brides! They awaken and surround you, hissing. They are hungry and aggressive.",
                options: [
                    { text: "Fight the vampire brides", goto: 79, combat: "vampire_brides" },
                    { text: "Command them as their master", goto: 80, test: { type: "skill", difficulty: 12 } },
                    { text: "Use Hypnotic Gaze on them", goto: 81, test: { type: "skill", difficulty: 11 } }
                ]
            },
            26: {
                text: "You successfully command your brides. They bow before you. 'Master... we have slept for centuries. What is your will?'",
                options: [
                    { text: "Send them to the village to hunt", goto: 82, test: null },
                    { text: "Have them guard the castle", goto: 83, test: null },
                    { text: "Destroy them (gain 2 Luck)", goto: 84, test: null }
                ]
            },
            27: {
                text: "You send your brides to the village. They will return with blood and information. Gain 3 Blood Points when they return.",
                effect: { blood: 3 },
                options: [
                    { text: "Wait for their return", goto: 85, test: null },
                    { text: "Follow them to the village", goto: 10, test: null }
                ]
            },
            28: {
                text: "The brides guard the castle. You are now safer here. Gain 2 Skill points for having loyal servants.",
                effect: { skill: 2 },
                options: [
                    { text: "Continue exploring", goto: 2, test: null }
                ]
            },
            29: {
                text: "You destroy your brides with a silver stake. They scream as they turn to dust. You feel a pang of regret but gain 2 Luck for removing potential threats.",
                effect: { luck: 2 },
                options: [
                    { text: "Leave the crypt", goto: 2, test: null }
                ]
            },
            30: {
                text: "VAN HELSING: Skill 12, Stamina 14, Damage 2D6+3. He has holy water (3 uses, 4 damage each) and a silver sword. If you have a crucifix, you can try to repel him. Fight!",
                combat: {
                    enemy: "van_helsing",
                    skill: 12,
                    stamina: 14,
                    damage: "2d6+3",
                    special: "holy_water",
                    loot: ["silver_sword", "holy_symbol"],
                    escape: 6
                }
            },
            31: {
                text: "You transform into a swarm of bats and fly away from Van Helsing. He shoots at you but misses. You escape to the village square.",
                options: [
                    { text: "Go to the village square", goto: 10, test: null },
                    { text: "Return to the castle", goto: 1, test: null }
                ]
            },
            32: {
                text: "You lock eyes with Van Helsing, attempting to hypnotize him. He resists with all his will! Test your Skill at difficulty 14.",
                options: [
                    { text: "Test Skill to hypnotize", goto: 86, test: { type: "skill", difficulty: 14 } },
                    { text: "Give up and fight", goto: 30, test: null }
                ]
            },
            33: {
                text: "You reveal yourself to the woman. She screams and tries to flee. The carriage driver hears and comes to investigate.",
                options: [
                    { text: "Attack the driver", goto: 87, combat: "carriage_driver" },
                    { text: "Flee as bats", goto: 31, test: null },
                    { text: "Hypnotize both of them", goto: 88, test: { type: "skill", difficulty: 10 } }
                ]
            },
            34: {
                text: "You use your Hypnotic Gaze on the woman. She falls into a trance. Do you:",
                options: [
                    { text: "Drink her blood", goto: 50, test: null },
                    { text: "Command her to come with you", goto: 89, test: null },
                    { text: "Erase her memory and leave", goto: 90, test: null }
                ]
            },
            35: {
                text: "The woman becomes your obedient servant. She may be useful in the future. You take her to the castle.",
                effect: { item: "servant" },
                options: [
                    { text: "Return to the castle", goto: 1, test: null }
                ]
            },
            36: {
                text: "You erase the woman's memory of the encounter. She will wake confused but unharmed. Gain 1 Luck for showing restraint.",
                effect: { luck: 1 },
                options: [
                    { text: "Return to the village", goto: 10, test: null }
                ]
            },
            37: {
                text: "You arrive at the village square. The tavern door swings open and a drunken villager staggers out. He sees you and freezes in terror.",
                options: [
                    { text: "Hypnotize him", goto: 91, test: { type: "skill", difficulty: 8 } },
                    { text: "Attack him", goto: 92, test: null },
                    { text: "Ignore him and enter the tavern", goto: 40, test: null }
                ]
            },
            38: {
                text: "You hypnotize the villager. He becomes docile. 'Take me to your leader,' you command.",
                options: [
                    { text: "Follow him to the mayor's house", goto: 42, test: null },
                    { text: "Command him to bring others", goto: 93, test: null },
                    { text: "Drink his blood and leave", goto: 50, test: null }
                ]
            },
            39: {
                text: "You attack the villager, drinking his blood quickly in the shadows. Gain 2 Stamina, but lose 1 Luck.",
                effect: { stamina: 2, luck: -1 },
                options: [
                    { text: "Enter the tavern", goto: 40, test: null },
                    { text: "Go to the church", goto: 41, test: null }
                ]
            },
            40: {
                text: "The tavern is filled with villagers drinking and singing. They fall silent as you enter. A large man stands up. 'We don't serve your kind here, stranger.' Do you:",
                options: [
                    { text: "Use Hypnotic Gaze on the crowd", goto: 94, test: { type: "skill", difficulty: 11 } },
                    { text: "Leave peacefully", goto: 10, test: null },
                    { text: "Attack the largest man", goto: 95, combat: "tavern_brawler" },
                    { text: "Challenge them to a drinking contest", goto: 96, test: { type: "skill", difficulty: 13 } }
                ]
            },
            41: {
                text: "The church is dark and silent. You sense holy power here. There is a font of holy water and a silver cross on the altar. Do you:",
                options: [
                    { text: "Take the holy water", goto: 97, test: null },
                    { text: "Take the silver cross", goto: 98, test: null },
                    { text: "Leave the church", goto: 10, test: null },
                    { text: "Search for hidden relics", goto: 99, test: { type: "skill", difficulty: 10 } }
                ]
            },
            42: {
                text: "You approach the mayor's house. Through the window, you see the mayor counting gold coins. He looks up and sees you! He draws a pistol and shoots!",
                options: [
                    { text: "Dodge the bullet", goto: 100, test: { type: "skill", difficulty: 12 } },
                    { text: "Use Mist Form", goto: 101, test: { type: "power", power: "mist_form" } },
                    { text: "Take the bullet", goto: 102, test: null },
                    { text: "Use Hypnotic Gaze through the window", goto: 103, test: { type: "skill", difficulty: 10 } }
                ]
            },
            43: {
                text: "You dodge the bullet and leap through the window. The mayor is defenseless. Do you:",
                options: [
                    { text: "Drink his blood", goto: 50, test: null },
                    { text: "Hypnotize him", goto: 51, test: null },
                    { text: "Demand information", goto: 104, test: null }
                ]
            },
            44: {
                text: "You hypnotize the mayor through the window. He puts down his gun and opens the door. 'Enter, master...' he says blankly.",
                options: [
                    { text: "Enter and question him", goto: 105, test: null },
                    { text: "Command him to come with you", goto: 106, test: null },
                    { text: "Drink his blood through the window", goto: 107, test: null }
                ]
            },
            45: {
                text: "The mayor tells you everything: Van Helsing arrived yesterday with four armed men. They're staying at the inn. The villagers are terrified and arming themselves with silver and garlic.",
                options: [
                    { text: "Go to the inn to confront Van Helsing", goto: 108, test: null },
                    { text: "Return to the castle to prepare", goto: 1, test: null },
                    { text: "Drink the mayor's blood for strength", goto: 50, test: null }
                ]
            },
            46: {
                text: "You command the mayor to come with you as a hostage. He follows obediently. You now have leverage against the villagers.",
                effect: { item: "hostage" },
                options: [
                    { text: "Return to the castle", goto: 1, test: null },
                    { text: "Use him as bait", goto: 109, test: null }
                ]
            },
            47: {
                text: "The inn is a two-story building with light in the windows. You sense Van Helsing's presence inside. Four horses are tied outside.",
                options: [
                    { text: "Enter through the front door", goto: 110, test: null },
                    { text: "Climb to the second floor window", goto: 111, test: { type: "skill", difficulty: 9 } },
                    { text: "Set the inn on fire", goto: 112, test: null },
                    { text: "Wait and ambush them", goto: 113, test: null }
                ]
            },
            48: {
                text: "You enter the inn. Van Helsing and his four men are seated at a table, studying maps. They look up in shock!",
                options: [
                    { text: "Attack immediately", goto: 114, combat: "van_helsing_party" },
                    { text: "Use Hypnotic Gaze on all of them", goto: 115, test: { type: "skill", difficulty: 15 } },
                    { text: "Retreat and set a trap", goto: 116, test: null }
                ]
            },
            49: {
                text: "You climb to the second floor and enter through a window. Below, you hear Van Helsing speaking: 'The creature will come to us. Be ready.' You're above them, unseen.",
                options: [
                    { text: "Drop down and attack", goto: 117, test: null },
                    { text: "Listen to their plans", goto: 118, test: { type: "skill", difficulty: 8 } },
                    { text: "Escape out the window", goto: 10, test: null }
                ]
            },
            50: {
                text: "You drink deeply, restoring your strength. Gain 3 Stamina, but lose 1 Luck for killing an innocent. The body must be disposed of. Do you:",
                effect: { stamina: 3, luck: -1 },
                options: [
                    { text: "Bury it in the castle crypt", goto: 119, test: null },
                    { text: "Throw it from the castle walls", goto: 120, test: null },
                    { text: "Leave it for others to find", goto: 121, test: null },
                    { text: "Hide it carefully", goto: 122, test: { type: "skill", difficulty: 9 } }
                ]
            },
            51: {
                text: "You use your vampiric powers to turn the villager into a vampire servant. He will obey your commands. Gain a SERVANT (can help in combat, +1 Skill).",
                effect: { skill: 1 },
                options: [
                    { text: "Continue", goto: 119, test: null }
                ]
            },
            52: {
                text: "You release the villager, showing mercy. He runs away, grateful. Gain 2 Luck.",
                effect: { luck: 2 },
                options: [
                    { text: "Continue", goto: 119, test: null }
                ]
            },
            53: {
                text: "You bury the body respectfully. The dark forces are pleased. Gain 1 Luck.",
                effect: { luck: 1 },
                options: [
                    { text: "Return to exploring", goto: 2, test: null }
                ]
            },
            54: {
                text: "You throw the body from the walls. It will be found, causing panic. Lose 1 Luck.",
                effect: { luck: -1 },
                options: [
                    { text: "Return to the castle", goto: 2, test: null }
                ]
            },
            55: {
                text: "You leave the body. It will be found by your servants. No consequence.",
                options: [
                    { text: "Return to the castle", goto: 2, test: null }
                ]
            },
            56: {
                text: "You hide the body expertly. No one will find it. Gain 1 Skill point for your cunning.",
                effect: { skill: 1 },
                options: [
                    { text: "Return to the castle", goto: 2, test: null }
                ]
            },
            57: {
                text: "You listen to Van Helsing's plans: 'We attack the castle at dawn. The eastern wall has a weak point. Remember: silver, garlic, and faith.'",
                options: [
                    { text: "Attack now while they're planning", goto: 114, combat: "van_helsing_party" },
                    { text: "Return to the castle to prepare defenses", goto: 123, test: null },
                    { text: "Sabotage their weapons", goto: 124, test: { type: "skill", difficulty: 11 } }
                ]
            },
            58: {
                text: "You return to the castle and prepare defenses. You board up windows, set traps, and command your servants to guard. Gain 2 Skill points for preparation.",
                effect: { skill: 2 },
                options: [
                    { text: "Wait for the attack", goto: 125, test: null },
                    { text: "Launch a preemptive strike", goto: 126, test: null }
                ]
            },
            59: {
                text: "You sabotage their weapons, replacing silver bullets with normal ones and diluting holy water. They won't know until it's too late.",
                effect: { skill: 1 },
                options: [
                    { text: "Return to the castle", goto: 123, test: null },
                    { text: "Watch from hiding", goto: 127, test: null }
                ]
            },
            60: {
                text: "You dodge successfully! The spikes clatter to the floor harmlessly. The glowing book contains ancient vampire secrets. Gain 1 Skill point and 2 Blood Points.",
                effect: { skill: 1, blood: 2 },
                options: [
                    { text: "Take the book", goto: 63, test: null },
                    { text: "Leave the library", goto: 2, test: null }
                ]
            },
            61: {
                text: "You're too slow! The spikes tear into you. Lose 3 Stamina. The book is knocked from its pedestal and opens to a page about 'The Cure for Vampirism.'",
                effect: { stamina: -3 },
                options: [
                    { text: "Read about the cure", goto: 128, test: null },
                    { text: "Ignore it and leave", goto: 2, test: null }
                ]
            },
            62: {
                text: "You read more of the ancient book. It tells of a cure for vampirism, but also of great dark powers. You gain 2 Blood Points and 1 Skill point.",
                effect: { blood: 2, skill: 1 },
                options: [
                    { text: "Take the book", goto: 63, test: null },
                    { text: "Leave the book", goto: 2, test: null }
                ]
            },
            63: {
                text: "You take the ancient book. It feels heavy with dark knowledge. This could be useful in your quest. The library has nothing else of interest, so you return to the main hall.",
                effect: { item: "ancient_tome" },
                options: [
                    { text: "Return to the main hall", goto: 2, test: null }
                ]
            },
            64: {
                text: "The potion was a Strength elixir! You feel power coursing through your veins. Gain 2 Skill points permanently!",
                effect: { skill: 2 },
                options: [
                    { text: "Leave the laboratory", goto: 2, test: null }
                ]
            },
            65: {
                text: "The potion was poison! You convulse in pain. Lose 4 Stamina. If you survive, you stumble out of the laboratory.",
                effect: { stamina: -4 },
                options: [
                    { text: "Stagger back to the main hall", goto: 2, test: null }
                ]
            },
            66: {
                text: "You enter the dungeon cell. Inside, you find a prisoner - a witch hunter chained to the wall! He's been here for weeks but still lives.",
                options: [
                    { text: "Drink his blood", goto: 129, test: null },
                    { text: "Free him and question him", goto: 130, test: null },
                    { text: "Leave him to rot", goto: 131, test: null }
                ]
            },
            67: {
                text: "The witch hunter spits at you. 'Demon! I'll never talk!' But he's weak. Test your Skill to intimidate him.",
                options: [
                    { text: "Intimidate him", goto: 132, test: { type: "skill", difficulty: 10 } },
                    { text: "Use Hypnotic Gaze", goto: 133, test: { type: "skill", difficulty: 9 } },
                    { text: "Kill him", goto: 134, test: null }
                ]
            },
            68: {
                text: "The witch hunter breaks under your intimidation. 'Van Helsing... he has a ritual... at the old monastery... to summon sunlight at night...' He tells you everything.",
                options: [
                    { text: "Kill him anyway", goto: 134, test: null },
                    { text: "Lock him back up", goto: 135, test: null },
                    { text: "Turn him into a vampire", goto: 136, test: { type: "skill", difficulty: 11 } }
                ]
            },
            69: {
                text: "You learn of Van Helsing's plan: a ritual at the ruined monastery to create artificial sunlight that will burn all vampires in the region. It requires a virgin's blood and a holy relic.",
                options: [
                    { text: "Go to the monastery immediately", goto: 137, test: null },
                    { text: "Prepare counter-ritual items", goto: 138, test: null },
                    { text: "Ignore it as superstition", goto: 139, test: null }
                ]
            },
            70: {
                text: "The ruined monastery is 5 miles from the village. You arrive as the moon is high. You see light from within - they've already begun!",
                options: [
                    { text: "Attack immediately", goto: 140, combat: "monastery_guardians" },
                    { text: "Sneak in quietly", goto: 141, test: { type: "skill", difficulty: 10 } },
                    { text: "Wait and observe", goto: 142, test: null }
                ]
            },
            71: {
                text: "You see Van Helsing conducting a ritual with four acolytes. A young woman is tied to an altar. A holy relic glows on a pedestal.",
                options: [
                    { text: "Disrupt the ritual from a distance", goto: 143, test: { type: "skill", difficulty: 12 } },
                    { text: "Attack the acolytes first", goto: 144, combat: "acolytes" },
                    { text: "Go straight for Van Helsing", goto: 145, combat: "van_helsing_ritual" }
                ]
            },
            72: {
                text: "You successfully disrupt the ritual! The glowing relic dims. Van Helsing turns to you, furious. 'You! You'll pay for this!'",
                options: [
                    { text: "Fight Van Helsing", goto: 145, combat: "van_helsing_ritual" },
                    { text: "Free the captive girl", goto: 146, test: null },
                    { text: "Steal the holy relic", goto: 147, test: { type: "skill", difficulty: 11 } }
                ]
            },
            73: {
                text: "You continue down the secret passage. It slopes steeply downward, the air growing colder with each step. Strange symbols are carved into the walls - warnings in an ancient language. After what feels like an hour of descent, you reach a heavy iron door.",
                options: [
                    { text: "Open the iron door", goto: 23, test: null },
                    { text: "Return to the library", goto: 6, test: null }
                ]
            },
            74: {
                text: "You free the girl. She's terrified but grateful. 'Thank you! They were going to kill me!' She can be useful.",
                effect: { item: "rescued_maiden" },
                options: [
                    { text: "Take her with you", goto: 148, test: null },
                    { text: "Send her to safety", goto: 149, test: null },
                    { text: "Fight Van Helsing", goto: 145, combat: "van_helsing_ritual" }
                ]
            },
            75: {
                text: "You steal the holy relic - a silver crucifix that glows with divine power. It burns your hand but you manage to contain it. This could be used against Van Helsing!",
                effect: { item: "holy_relic" },
                options: [
                    { text: "Fight Van Helsing", goto: 145, combat: "van_helsing_ritual" },
                    { text: "Flee with the relic", goto: 150, test: null }
                ]
            },
            76: {
                text: "You have acquired the three ingredients for the vampirism cure: Holy Water, Garlic from a virgin's garden, and now the Blood of a Willing Sacrifice (the rescued maiden offers hers). The ritual can be performed at the next new moon.",
                options: [
                    { text: "Perform the ritual for redemption", goto: 153, test: { type: "skill", difficulty: 14 } },
                    { text: "Reject humanity, embrace power", goto: 154, test: null },
                    { text: "Keep the ingredients as trophies", goto: 155, test: null }
                ]
            },
            77: {
                text: "You perform the ritual under the new moon. The pain is excruciating as the vampire essence is torn from your soul. Test your Stamina (roll 2D6 ≤ Stamina).",
                options: [
                    { text: "Test Stamina for the ritual", goto: 156, test: { type: "skill", target: function() { return gameState.stats.stamina; } } },
                    { text: "Abort the ritual", goto: 157, test: null }
                ]
            },
            78: {
                text: "The ritual succeeds! You feel warmth for the first time in centuries. Your heartbeat returns. You are human again! But weak and vulnerable.",
                effect: { stamina: 5, skill: 5, luck: 12, blood: 0 },
                options: [
                    { text: "Face the dawn as a human", goto: 158, test: null }
                ]
            },
            79: {
                text: "The ritual fails! The backlash nearly destroys you. Lose 8 Stamina. If you survive, you remain a vampire but are permanently weakened.",
                effect: { stamina: -8 },
                options: [
                    { text: "Crawl away to heal", goto: 159, test: null }
                ]
            },
            80: {
                text: "You reject redemption and consume the ritual ingredients to increase your power! Gain 4 Skill, 6 Stamina, and 5 Blood Points! You are now a Vampire Lord!",
                effect: { skill: 4, stamina: 6, blood: 5 },
                options: [
                    { text: "Begin your reign of terror", goto: 160, test: null }
                ]
            },
            81: {
                text: "As a Vampire Lord, you march on the village with an army of the undead. The villagers flee in terror. Van Helsing makes his last stand in the church.",
                options: [
                    { text: "Attack the church", goto: 161, combat: "final_stand" },
                    { text: "Burn the village", goto: 162, test: null },
                    { text: "Offer them surrender", goto: 163, test: null }
                ]
            },
            82: {
                text: "You defeat Van Helsing in his final stand. The village is yours. You establish your rule, feeding on the villagers but keeping some alive to serve you. You reign for centuries.",
                victory: true,
                text: "VICTORY! You have conquered Transylvania and established your eternal reign as Vampire Lord. The night is forever yours."
            },
            83: {
                text: "You burn the village to the ground. Nothing remains but ash. You return to your castle, master of a dead land. Lonely but powerful.",
                victory: true,
                text: "VICTORY! You have destroyed all opposition. The land is dead, but it is yours forever."
            },
            84: {
                text: "The villagers surrender. You establish a dark kingdom where humans serve vampires. A new order begins in Transylvania.",
                victory: true,
                text: "VICTORY! You rule a kingdom of night. Humans serve, vampires rule. Your dynasty begins."
            },
            85: {
                text: "As a human, you face Van Helsing. He sees your humanity has returned. 'A miracle...' he says. He offers you protection and a new life.",
                options: [
                    { text: "Accept his help", goto: 164, test: null },
                    { text: "Walk away alone", goto: 165, test: null }
                ]
            },
            86: {
                text: "Van Helsing helps you start a new life far from Transylvania. You live out your days in peace, always remembering what you were, grateful for what you became.",
                victory: true,
                text: "REDEMPTION! You have reclaimed your humanity and found peace. Your soul is saved."
            },
            87: {
                text: "You walk away into the dawn, a free man. The road is hard, but it is yours. You have a second chance at life.",
                victory: true,
                text: "REDEMPTION! You walk into the sunrise, human again. Your journey begins anew."
            },
            88: {
                text: "You discover an ancient artifact in the castle depths - the Amulet of Eternal Twilight. It grants power over day and night!",
                options: [
                    { text: "Wear the amulet", goto: 166, test: null },
                    { text: "Destroy the amulet", goto: 167, test: { type: "skill", difficulty: 15 } },
                    { text: "Hide it forever", goto: 168, test: null }
                ]
            },
            89: {
                text: "The amulet makes you immune to sunlight! You can walk by day! You are now the ultimate vampire - master of both day and night!",
                victory: true,
                text: "ULTIMATE VICTORY! With the Amulet of Eternal Twilight, you conquer both day and night. No one can stop you now."
            },
            90: {
                text: "You destroy the amulet, preventing anyone from ever wielding such power. The explosion damages the castle but you survive.",
                victory: true,
                text: "WISDOM! You destroyed ultimate power for the greater good. The world is safer."
            },
            91: {
                text: "Van Helsing completes his ritual! Artificial sunlight fills the monastery! You burn! Lose 6 Stamina immediately!",
                effect: { stamina: -6 },
                options: [
                    { text: "Fight through the pain", goto: 169, combat: "van_helsing_sunlight" },
                    { text: "Flee into darkness", goto: 170, test: { type: "skill", difficulty: 12 } },
                    { text: "Use the holy relic as shield", goto: 171, test: { type: "item", item: "holy_relic" } }
                ]
            },
            92: {
                text: "You defeat Van Helsing even in sunlight! But you are badly burned. The ritual ends, darkness returns. You stand victorious over your greatest enemy.",
                victory: true,
                text: "EPIC VICTORY! You defeated Van Helsing against all odds. Your legend grows."
            },
            93: {
                text: "You flee, badly wounded. The ritual succeeds - sunlight now burns vampires in this region. You must leave Transylvania forever.",
                victory: true,
                text: "EXILE! You survive but must leave your homeland. Your story continues elsewhere."
            },
            94: {
                text: "The holy relic protects you from the artificial sunlight! It absorbs the divine energy. You are unharmed! Van Helsing stares in disbelief.",
                options: [
                    { text: "Attack while he's shocked", goto: 172, test: null },
                    { text: "Offer him mercy", goto: 173, test: null }
                ]
            },
            95: {
                text: "You spare Van Helsing. 'You have shown mercy where I showed none,' he says. He leaves Transylvania, defeated. You rule in peace.",
                victory: true,
                text: "MERCIFUL VICTORY! You defeated your enemy with mercy. A new era of understanding begins."
            },
            96: {
                text: "YOUR ADVENTURE CONCLUDES",
                victory: true,
                text: "You have reached the end of your journey. Your choices have shaped your destiny. Will you play again to discover other paths?"
            },
            97: {
                text: "The castle collapses around you! An earthquake triggered by the magical battles brings down the ancient stones!",
                options: [
                    { text: "Escape as bats", goto: 174, test: { type: "skill", difficulty: 10 } },
                    { text: "Use Mist Form to pass through debris", goto: 175, test: { type: "power", power: "mist_form" } },
                    { text: "Try to save your treasures", goto: 176, test: null }
                ]
            },
            98: {
                text: "You escape the collapsing castle but lose everything. You are a homeless vampire, but free.",
                victory: true,
                text: "SURVIVOR! You lost your home but gained freedom. Your story continues on the road."
            },
            99: {
                text: "You save your most precious treasures as the castle falls. You rebuild elsewhere, wiser and stronger.",
                victory: true,
                text: "REBUILDER! From the ashes, you rise again. Your new kingdom awaits."
            },
            100: {
                text: "You return to your coffin chamber. Something feels different. As you examine your coffin, you notice a hidden latch underneath. It opens to reveal a small compartment containing your original human journal from 400 years ago!",
                options: [
                    { text: "Read the journal", goto: 177, test: null },
                    { text: "Ignore it - the past is dead", goto: 178, test: null },
                    { text: "Take it with you", goto: 179, test: null }
                ]
            },
            101: {
                text: "The journal reminds you of your humanity. You feel something you haven't felt in centuries: hope. This could be the key to your redemption.",
                effect: { luck: 3 },
                options: [
                    { text: "Begin the path to redemption", goto: 76, test: null },
                    { text: "Reject these weak emotions", goto: 80, test: null }
                ]
            },
            102: {
                text: "You burn the journal, destroying the last remnants of your human past. You are now fully vampire, without regret or memory.",
                effect: { skill: 2, blood: 2 },
                options: [
                    { text: "Embrace total darkness", goto: 81, test: null }
                ]
            },
            103: {
                text: "You keep the journal as a trophy of what you once were. It gives you perspective but doesn't change your course.",
                options: [
                    { text: "Continue your current path", goto: 2, test: null }
                ]
            },
            104: {
                text: "In the dungeons, you find a secret tunnel behind a loose stone! It appears to lead toward the village.",
                options: [
                    { text: "Explore the tunnel", goto: 189, test: null },
                    { text: "Mark it and return later", goto: 19, test: null }
                ]
            },
            105: {
                text: "You question the hypnotized mayor. He reveals Van Helsing's plans: 'He stays at the inn with four armed men. They plan to attack the castle at dawn.'",
                options: [
                    { text: "Go to the inn immediately", goto: 110, test: null },
                    { text: "Prepare castle defenses", goto: 123, test: null },
                    { text: "Send the mayor as a spy", goto: 190, test: null }
                ]
            },
            106: {
                text: "You command the mayor to follow you. He becomes your pawn in the village. Useful for gathering information and resources.",
                effect: { item: "mayor_pawn" },
                options: [
                    { text: "Return to castle with your new pawn", goto: 1, test: null }
                ]
            },
            107: {
                text: "You drink the mayor's blood through the window. Gain 4 Stamina but lose 2 Luck. The villagers will panic when they find his body.",
                effect: { stamina: 4, luck: -2 },
                options: [
                    { text: "Return to village square", goto: 10, test: null }
                ]
            },
            108: {
                text: "You go to the inn. Light streams from the windows. You can hear voices inside discussing 'the creature' and 'silver bullets'.",
                options: [
                    { text: "Enter boldly", goto: 110, test: null },
                    { text: "Listen at the window", goto: 118, test: { type: "skill", difficulty: 8 } },
                    { text: "Set a trap outside", goto: 191, test: null }
                ]
            },
            109: {
                text: "You use the mayor as bait, sending him to the inn to lure Van Helsing out. The plan works! Van Helsing and two men come out to investigate.",
                options: [
                    { text: "Ambush them", goto: 192, combat: "van_helsing_ambush" },
                    { text: "Sneak into the empty inn", goto: 193, test: null }
                ]
            },
            110: {
                text: "You burst through the inn door! Van Helsing and his four men leap to their feet, weapons drawn!",
                options: [
                    { text: "Attack immediately", goto: 114, combat: "van_helsing_party" },
                    { text: "Use Hypnotic Gaze on them all", goto: 115, test: { type: "skill", difficulty: 15 } },
                    { text: "Retreat and regroup", goto: 116, test: null }
                ]
            },
            111: {
                text: "You climb to the second floor window. It's unlocked! You slip inside a dark bedroom. Below, you can hear Van Helsing's voice.",
                options: [
                    { text: "Listen at the door", goto: 118, test: { type: "skill", difficulty: 7 } },
                    { text: "Search the room", goto: 194, test: null },
                    { text: "Attack from above", goto: 117, test: null }
                ]
            },
            112: {
                text: "You set fire to the inn! Flames quickly spread. Shouts of panic come from inside. Do you:",
                options: [
                    { text: "Wait to attack those who escape", goto: 195, test: null },
                    { text: "Make sure none escape", goto: 196, test: null },
                    { text: "Let them burn and return to castle", goto: 1, test: null }
                ]
            },
            113: {
                text: "You wait in the shadows. An hour passes. One of Van Helsing's men comes out to relieve himself. Do you:",
                options: [
                    { text: "Attack him silently", goto: 197, test: { type: "skill", difficulty: 9 } },
                    { text: "Let him go and keep waiting", goto: 198, test: null },
                    { text: "Use him as bait", goto: 199, test: null }
                ]
            },
            114: {
                text: "VAN HELSING'S PARTY: Skill 11, Stamina 20, Damage 2D6+3. Five experienced vampire hunters working together. Fight!",
                combat: {
                    enemy: "van_helsing_party",
                    skill: 11,
                    stamina: 20,
                    damage: "2d6+3",
                    special: "teamwork",
                    loot: ["silver_sword", "holy_symbol", "hunter_medal"],
                    escape: 10
                }
            },
            115: {
                text: "You attempt to hypnotize all five men at once! This requires tremendous power. Test your Skill at difficulty 15.",
                options: [
                    { text: "Test Skill for mass hypnosis", goto: 200, test: { type: "skill", difficulty: 15 } },
                    { text: "Attack instead", goto: 114, test: null }
                ]
            },
            116: {
                text: "You retreat from the inn. Van Helsing's men don't follow. You need a better plan.",
                options: [
                    { text: "Return to castle to prepare", goto: 123, test: null },
                    { text: "Try a different approach", goto: 47, test: null }
                ]
            },
            117: {
                text: "You drop from above onto Van Helsing's table! The element of surprise gives you advantage!",
                options: [
                    { text: "Attack with surprise bonus", goto: 201, combat: "van_helsing_surprise" },
                    { text: "Grab the maps and flee", goto: 202, test: { type: "skill", difficulty: 11 } }
                ]
            },
            118: {
                text: "You listen carefully at the door/window. 'The castle's weak point is the eastern wall,' Van Helsing says. 'We strike at first light. Remember your silver and garlic.'",
                options: [
                    { text: "Attack now", goto: 114, combat: "van_helsing_party" },
                    { text: "Sabotage their weapons first", goto: 124, test: { type: "skill", difficulty: 11 } },
                    { text: "Return to castle with this information", goto: 123, test: null }
                ]
            },
            119: {
                text: "You dispose of the body in the castle crypt. The ancient stones seem to absorb the evidence. No one will find it here.",
                options: [
                    { text: "Return to exploring", goto: 2, test: null }
                ]
            },
            120: {
                text: "The body tumbles down the mountain. It will be found at dawn, causing panic in the village. Lose 1 Luck.",
                effect: { luck: -1 },
                options: [
                    { text: "Return to castle", goto: 2, test: null }
                ]
            },
            121: {
                text: "You leave the body where it lies. Let the villagers find it and know fear. Lose 1 Luck but gain 1 Skill from the intimidation factor.",
                effect: { luck: -1, skill: 1 },
                options: [
                    { text: "Return to castle", goto: 2, test: null }
                ]
            },
            122: {
                text: "You hide the body expertly in a secret compartment. No trace remains. Gain 1 Skill for your cunning.",
                effect: { skill: 1 },
                options: [
                    { text: "Return to castle", goto: 2, test: null }
                ]
            },
            123: {
                text: "You return to the castle and begin preparations. You barricade doors, set traps in the corridors, and position your servants strategically.",
                effect: { skill: 1 },
                options: [
                    { text: "Wait for the attack", goto: 125, test: null },
                    { text: "Launch a night attack on the village", goto: 126, test: null },
                    { text: "Prepare escape route", goto: 203, test: null }
                ]
            },
            124: {
                text: "You sneak into their room while they sleep/drink. Test your Skill to sabotage their weapons without waking them.",
                options: [
                    { text: "Test Skill to sabotage", goto: 204, test: { type: "skill", difficulty: 11 } },
                    { text: "Attack them while they're vulnerable", goto: 205, combat: "van_helsing_sleeping" }
                ]
            },
            125: {
                text: "Dawn approaches. You wait in the great hall. Suddenly, the eastern wall explodes! Van Helsing and his men charge in!",
                options: [
                    { text: "Fight the invaders", goto: 206, combat: "castle_invasion" },
                    { text: "Use castle traps against them", goto: 207, test: { type: "skill", difficulty: 10 } },
                    { text: "Flee through secret passages", goto: 208, test: null }
                ]
            },
            126: {
                text: "You launch a preemptive strike on the village! Under cover of darkness, you and your servants attack the inn!",
                options: [
                    { text: "Lead the attack", goto: 209, combat: "night_attack" },
                    { text: "Send servants first as distraction", goto: 210, test: null },
                    { text: "Burn the village while they sleep", goto: 211, test: null }
                ]
            },
            127: {
                text: "You watch from hiding as Van Helsing's men prepare. They seem confident, even arrogant. This could be used against them.",
                options: [
                    { text: "Attack now while they're confident", goto: 114, combat: "van_helsing_party" },
                    { text: "Let them come to the castle", goto: 123, test: null }
                ]
            },
            128: {
                text: "The book describes a cure for vampirism! It requires three ingredients: 1) Holy water blessed by a true believer, 2) Garlic grown in a virgin's garden, and 3) The blood of a willing sacrifice.",
                options: [
                    { text: "Seek the cure ingredients", goto: 212, test: null },
                    { text: "Destroy this dangerous knowledge", goto: 213, test: null },
                    { text: "Keep the book for other secrets", goto: 63, test: null }
                ]
            },
            129: {
                text: "You drink the witch hunter's blood. He dies screaming curses. Gain 3 Stamina but lose 2 Luck.",
                effect: { stamina: 3, luck: -2 },
                options: [
                    { text: "Leave the dungeon", goto: 19, test: null }
                ]
            },
            130: {
                text: "You free the witch hunter. He collapses, weak from hunger and thirst. 'Why... why free me?' he gasps.",
                options: [
                    { text: "Question him", goto: 67, test: null },
                    { text: "Let him go", goto: 214, test: null },
                    { text: "Turn him into a vampire servant", goto: 136, test: { type: "skill", difficulty: 11 } }
                ]
            },
            131: {
                text: "You leave the witch hunter to rot. He shouts curses as you walk away. Lose 1 Luck for cruelty.",
                effect: { luck: -1 },
                options: [
                    { text: "Continue exploring dungeon", goto: 19, test: null }
                ]
            },
            132: {
                text: "You intimidate the witch hunter. Test your Skill at difficulty 10 to break his will.",
                options: [
                    { text: "Test Skill to intimidate", goto: 68, test: { type: "skill", difficulty: 10 } },
                    { text: "Use torture instead", goto: 215, test: null }
                ]
            },
            133: {
                text: "You use Hypnotic Gaze on the weak witch hunter. Test your Skill at difficulty 9.",
                options: [
                    { text: "Test Skill to hypnotize", goto: 216, test: { type: "skill", difficulty: 9 } },
                    { text: "Intimidate instead", goto: 132, test: null }
                ]
            },
            134: {
                text: "You kill the witch hunter quickly. He dies with dignity. You find a silver cross on his body.",
                effect: { item: "silver_cross" },
                options: [
                    { text: "Leave the dungeon", goto: 19, test: null }
                ]
            },
            135: {
                text: "You lock the witch hunter back in his chains. 'You'll regret this, demon!' he shouts.",
                options: [
                    { text: "Leave him", goto: 19, test: null },
                    { text: "Return and kill him", goto: 134, test: null }
                ]
            },
            136: {
                text: "You turn the witch hunter into a vampire! He will serve you, though reluctantly. Gain a VAMPIRE HUNTER SERVANT (+2 Skill in combat vs holy enemies).",
                effect: { skill: 2 },
                options: [
                    { text: "Command your new servant", goto: 217, test: null }
                ]
            },
            137: {
                text: "You rush to the monastery! It's a three-hour journey. Do you:",
                options: [
                    { text: "Travel as bats for speed", goto: 218, test: { type: "skill", difficulty: 8 } },
                    { text: "Take the secret tunnel", goto: 189, test: null },
                    { text: "Travel normally", goto: 70, test: null }
                ]
            },
            138: {
                text: "You need counter-ritual items: a black candle, grave dirt, and a vampire's fang. Where to find them?",
                options: [
                    { text: "Search the alchemy lab", goto: 7, test: null },
                    { text: "Search the crypt", goto: 23, test: null },
                    { text: "Use your own fang", goto: 219, test: null }
                ]
            },
            139: {
                text: "You ignore the witch hunter's warning as superstition. Two days later, artificial sunlight burns the castle! Lose 4 Stamina!",
                effect: { stamina: -4 },
                options: [
                    { text: "Flee the castle", goto: 220, test: null },
                    { text: "Search for protection", goto: 138, test: null }
                ]
            },
            140: {
                text: "MONASTERY GUARDIANS: Skill 8, Stamina 12, Damage 2D6+1. Two monks armed with silver-tipped spears guard the entrance.",
                combat: {
                    enemy: "monastery_guardians",
                    skill: 8,
                    stamina: 12,
                    damage: "2d6+1",
                    special: "holy_weapons",
                    loot: ["silver_spear", "monk_robe"],
                    escape: 70
                }
            },
            141: {
                text: "You sneak past the guards through a broken window. Inside, you see the ritual in progress.",
                options: [
                    { text: "Attack the acolytes", goto: 144, combat: "acolytes" },
                    { text: "Disrupt the ritual", goto: 143, test: { type: "skill", difficulty: 12 } },
                    { text: "Observe first", goto: 142, test: null }
                ]
            },
            142: {
                text: "You watch from the shadows. The ritual is almost complete! The holy relic glows brighter. Do you:",
                options: [
                    { text: "Attack now!", goto: 144, combat: "acolytes" },
                    { text: "Try to steal the relic", goto: 147, test: { type: "skill", difficulty: 11 } },
                    { text: "Disrupt from a distance", goto: 143, test: { type: "skill", difficulty: 12 } }
                ]
            },
            143: {
                text: "You attempt to disrupt the ritual from a distance. Test your Skill at difficulty 12.",
                options: [
                    { text: "Test Skill to disrupt", goto: 72, test: { type: "skill", difficulty: 12 } },
                    { text: "Attack directly instead", goto: 144, combat: "acolytes" }
                ]
            },
            144: {
                text: "ACOLYTES: Skill 7, Stamina 8 each (x4), Damage 2D6. Four fanatical monks conducting the ritual. They fight to the death.",
                combat: {
                    enemy: "acolytes",
                    skill: 7,
                    stamina: 8,
                    damage: "2d6",
                    special: "ritual_protection",
                    loot: ["prayer_book", "silver_dagger"],
                    escape: 70
                }
            },
            145: {
                text: "VAN HELSING (RITUAL): Skill 13, Stamina 16, Damage 2D6+3. He's empowered by the ritual! The holy relic glows nearby.",
                combat: {
                    enemy: "van_helsing_ritual",
                    skill: 13,
                    stamina: 16,
                    damage: "2d6+3",
                    special: "ritual_power",
                    loot: ["holy_relic", "van_helsing_journal"],
                    escape: 70
                }
            },
            146: {
                text: "You free the girl from the altar. 'Thank you!' she sobs. The ritual falters without her blood.",
                effect: { item: "rescued_maiden" },
                options: [
                    { text: "Fight Van Helsing", goto: 145, combat: "van_helsing_ritual" },
                    { text: "Escape with the girl", goto: 221, test: null }
                ]
            },
            147: {
                text: "You attempt to steal the holy relic while Van Helsing is distracted. Test your Skill at difficulty 11.",
                options: [
                    { text: "Test Skill to steal relic", goto: 75, test: { type: "skill", difficulty: 11 } },
                    { text: "Attack instead", goto: 145, combat: "van_helsing_ritual" }
                ]
            },
            148: {
                text: "You take the rescued maiden with you. She's grateful and may be useful. 'I'll do anything to repay you,' she says.",
                effect: { item: "rescued_maiden" },
                options: [
                    { text: "Return to castle", goto: 1, test: null },
                    { text: "Find a safe place for her", goto: 222, test: null }
                ]
            },
            149: {
                text: "You send the maiden to safety in the village. 'Go, and tell no one what happened here.' She runs into the night.",
                options: [
                    { text: "Fight Van Helsing", goto: 145, combat: "van_helsing_ritual" },
                    { text: "Leave the monastery", goto: 70, test: null }
                ]
            },
            150: {
                text: "You flee with the holy relic! Van Helsing shouts in rage but doesn't follow immediately. You escape into the night.",
                effect: { item: "holy_relic" },
                options: [
                    { text: "Return to castle", goto: 1, test: null },
                    { text: "Hide in the woods", goto: 223, test: null }
                ]
            },
            151: {
                text: "You hide in the woods until dawn. The holy relic burns your hand even through cloth. It's incredibly powerful.",
                options: [
                    { text: "Study the relic", goto: 224, test: null },
                    { text: "Bury it for safety", goto: 225, test: null },
                    { text: "Return to castle", goto: 1, test: null }
                ]
            },
            152: {
                text: "Back at the castle, you examine the holy relic. It's a silver crucifix that glows with divine energy. Dangerous but potentially useful.",
                options: [
                    { text: "Keep it as trophy", goto: 226, test: null },
                    { text: "Destroy it", goto: 227, test: { type: "skill", difficulty: 14 } },
                    { text: "Use it in a ritual", goto: 228, test: null }
                ]
            },
            153: {
                text: "You gather the cure ingredients: Holy water from the church, Garlic from the village, and the willing blood of the rescued maiden. The new moon rises tonight.",
                options: [
                    { text: "Perform the ritual", goto: 77, test: null },
                    { text: "Have second thoughts", goto: 229, test: null }
                ]
            },
            154: {
                text: "You reject redemption! The ingredients could make you even more powerful if consumed instead.",
                options: [
                    { text: "Consume the ingredients for power", goto: 80, test: null },
                    { text: "Keep them as trophies", goto: 155, test: null }
                ]
            },
            155: {
                text: "You keep the cure ingredients as trophies of your near-redemption. They remind you of what you almost lost - your power.",
                options: [
                    { text: "Return to your dark pursuits", goto: 2, test: null }
                ]
            },
            156: {
                text: "The ritual is agonizing! Test your Stamina (roll 2D6). If you roll equal to or less than your Stamina, turn to 78. If higher, turn to 79.",
                options: [
                    { text: "Test Stamina", goto: 78, test: { type: "skill", target: function() { return gameState.stats.stamina; } } },
                    { text: "Give up", goto: 230, test: null }
                ]
            },
            157: {
                text: "You abort the ritual at the last moment! The ingredients are wasted, but you remain a vampire. Lose 2 Stamina from the backlash.",
                effect: { stamina: -2 },
                options: [
                    { text: "Return to castle", goto: 2, test: null }
                ]
            },
            158: {
                text: "As a human, you watch the sunrise from the castle walls. The warmth feels strange but wonderful. Van Helsing arrives and sees your transformation.",
                options: [
                    { text: "Face Van Helsing as a human", goto: 85, test: null },
                    { text: "Flee before he arrives", goto: 231, test: null }
                ]
            },
            159: {
                text: "The failed ritual leaves you weak and in pain. You crawl to your coffin to heal. Lose 1 Skill permanently from the damage.",
                effect: { skill: -1 },
                options: [
                    { text: "Sleep to heal", goto: 232, test: null }
                ]
            },
            160: {
                text: "As a Vampire Lord with increased power, you feel unstoppable! The night bends to your will.",
                options: [
                    { text: "Attack the village", goto: 81, test: null },
                    { text: "Expand your territory", goto: 233, test: null },
                    { text: "Search for more power", goto: 234, test: null }
                ]
            },
            161: {
                text: "FINAL STAND: Van Helsing and the remaining villagers make their last stand in the church. Skill 13, Stamina 18, Damage 2D6+3.",
                combat: {
                    enemy: "final_stand",
                    skill: 13,
                    stamina: 18,
                    damage: "2d6+3",
                    special: "last_stand",
                    loot: ["village_key", "van_helsing_final_journal"],
                    escape: 10
                }
            },
            162: {
                text: "You burn the village! Flames consume everything. Screams fill the night. By dawn, only ashes remain.",
                options: [
                    { text: "Return to your silent castle", goto: 235, test: null }
                ]
            },
            163: {
                text: "You offer the villagers surrender: serve you or die. Most choose service. A new dark age begins.",
                options: [
                    { text: "Establish your rule", goto: 84, test: null }
                ]
            },
            164: {
                text: "Van Helsing helps you leave Transylvania. You start a new life in England under a new name. You live quietly, always hiding your past.",
                victory: true,
                text: "REDEMPTION! You live out your days in peace, a human again. The vampire is dead."
            },
            165: {
                text: "You walk away alone. The road is hard, but you're free. You find work in a distant city, always looking over your shoulder.",
                victory: true,
                text: "SOLITARY REDEMPTION! You're human again, but alone. Your new life begins."
            },
            166: {
                text: "You wear the Amulet of Eternal Twilight! Power surges through you! You can walk in sunlight! You are now the ultimate vampire!",
                effect: { skill: 5, stamina: 10, blood: 10 },
                options: [
                    { text: "Begin your ultimate reign", goto: 236, test: null }
                ]
            },
            167: {
                text: "You destroy the amulet! The explosion knocks you unconscious. When you wake, the amulet is gone forever.",
                effect: { stamina: -5 },
                options: [
                    { text: "Return to castle", goto: 2, test: null }
                ]
            },
            168: {
                text: "You hide the amulet where no one will ever find it. Some powers are too dangerous for anyone to wield.",
                victory: true,
                text: "WISDOM VICTORY! You chose wisdom over power. The world is safer with the amulet hidden."
            },
            169: {
                text: "VAN HELSING (SUNLIGHT): Skill 14, Stamina 12, Damage 2D6+4. He's empowered by artificial sunlight! You're weakened!",
                combat: {
                    enemy: "van_helsing_sunlight",
                    skill: 14,
                    stamina: 12,
                    damage: "2d6+4",
                    special: "sunlight_empowered",
                    loot: ["holy_relic", "sun_amulet"],
                    escape: 10
                }
            },
            170: {
                text: "You flee into the darkness as sunlight burns! You escape but are badly wounded. Lose 4 Stamina.",
                effect: { stamina: -4 },
                options: [
                    { text: "Hide and heal", goto: 237, test: null }
                ]
            },
            171: {
                text: "The holy relic protects you! It absorbs the sunlight energy. You're unharmed! Van Helsing stares in shock.",
                options: [
                    { text: "Attack while he's shocked", goto: 172, test: null },
                    { text: "Flee with the relic", goto: 150, test: null }
                ]
            },
            172: {
                text: "You attack Van Helsing while he's shocked! He's defenseless for a moment!",
                options: [
                    { text: "Strike the killing blow", goto: 238, test: null },
                    { text: "Take him prisoner", goto: 239, test: null }
                ]
            },
            173: {
                text: "You spare Van Helsing. 'You've shown mercy I didn't deserve,' he says. He leaves Transylvania forever.",
                victory: true,
                text: "MERCY VICTORY! You defeated your enemy with mercy. A new era begins."
            },
            174: {
                text: "You transform into bats and fly through collapsing corridors! Test your Skill to escape.",
                options: [
                    { text: "Test Skill to escape", goto: 98, test: { type: "skill", difficulty: 10 } },
                    { text: "Try another method", goto: 97, test: null }
                ]
            },
            175: {
                text: "You become mist and flow through cracks in the collapsing stone. You escape unharmed!",
                options: [
                    { text: "Watch castle collapse from outside", goto: 240, test: null }
                ]
            },
            176: {
                text: "You try to save your treasures! The castle collapses around you! Lose 3 Stamina from falling debris.",
                effect: { stamina: -3 },
                options: [
                    { text: "Escape with what you can carry", goto: 99, test: null }
                ]
            },
            177: {
                text: "You read your ancient journal. The handwriting is yours, but from centuries ago. The last entry: 'I feel the change... God help me...' You remember your human life.",
                effect: { luck: 2 },
                options: [
                    { text: "Continue reading", goto: 241, test: null },
                    { text: "Take the journal", goto: 179, test: null }
                ]
            },
            178: {
                text: "You ignore the journal. The past is dead. You are Dracula now, not whatever human you once were.",
                options: [
                    { text: "Leave the coffin chamber", goto: 2, test: null }
                ]
            },
            179: {
                text: "You take the journal. It might be useful later, or at least interesting.",
                effect: { item: "ancient_journal" },
                options: [
                    { text: "Leave the coffin chamber", goto: 2, test: null }
                ]
            },
            180: {
                text: "You search the crypt carefully. Behind a loose stone, you find a hidden compartment containing ancient treasures! You discover: 1) A GOLDEN GOBLET studded with rubies, 2) A SILVER KEY with dragon design, and 3) A DUSTY SCROLL in a protective case.",
                effect: { items: ["golden_goblet", "silver_key", "dusty_scroll"] },
                options: [
                    { text: "Take the treasures and open central coffin", goto: 24, test: null },
                    { text: "Take the treasures and examine smaller coffins", goto: 25, test: null },
                    { text: "Take the treasures and leave", goto: 2, test: null }
                ]
            },
            181: {
                text: "The oak desk is covered in dust but well-preserved. In the drawers you find: 1) A JOURNAL written in your own hand from centuries ago, 2) A SET OF MAPS showing secret passages in the castle, and 3) A CRYSTAL INKWELL that still contains black ink.",
                effect: { items: ["ancient_journal", "castle_maps", "crystal_inkwell"] },
                options: [
                    { text: "Read the journal", goto: 183, test: null },
                    { text: "Study the maps", goto: 184, test: null },
                    { text: "Take items and check glowing book", goto: 13, test: { type: "skill", difficulty: 10 } },
                    { text: "Take items and search bookshelves", goto: 22, test: { type: "skill", difficulty: 8 } }
                ]
            },
            182: {
                text: "The tapestry shows your family's history: Vlad Tepes defeating the Turks, the pact with dark forces that granted vampirism, and your own turning ceremony. At the bottom, woven in silver thread, is a prophecy: 'When blood moon rises, the son shall face the sire, and darkness shall choose its master.'",
                options: [
                    { text: "Search behind the tapestry", goto: 185, test: { type: "skill", difficulty: 7 } },
                    { text: "Return to library choices", goto: 6, test: null }
                ]
            },
            183: {
                text: "The journal contains your thoughts from 400 years ago. The last entry reads: 'I feel the change taking hold. My reflection fades. The hunger grows. What have I become? God forgive me. I will hide this journal where only I can find it, in case... in case I ever want to remember the man I was.' You gain 2 Luck from this profound self-discovery.",
                effect: { luck: 2 },
                options: [
                    { text: "Continue exploring library", goto: 6, test: null }
                ]
            },
            184: {
                text: "The maps show the castle's secret passages: 1) Library to crypt, 2) Great hall to village tunnel, 3) Dungeons to mountain caves. With this knowledge, you gain +1 Skill for navigation!",
                effect: { skill: 1 },
                options: [
                    { text: "Use map to find secret passage", goto: 22, test: null },
                    { text: "Return to library", goto: 6, test: null }
                ]
            },
            185: {
                text: "Behind the tapestry, you find a hidden safe set into the stone wall! It has a keyhole with a dragon design. Do you have a key that might fit?",
                options: [
                    { text: "Try to open with Silver Dragon Key (if you have it)", goto: 186, test: { type: "item", item: "silver_key" } },
                    { text: "Try to pick the lock", goto: 187, test: { type: "skill", difficulty: 12 } },
                    { text: "Leave it for later", goto: 6, test: null }
                ]
            },
            186: {
                text: "The Silver Dragon Key fits perfectly! The safe opens with a click. Inside you find: THE AMULET OF ETERNAL TWILIGHT (grants sunlight immunity!), a deed to lands in Wallachia, and a portrait of you as a human prince.",
                effect: { items: ["eternal_twilight_amulet", "wallachia_deed", "human_portrait"] },
                options: [
                    { text: "Wear the amulet immediately", goto: 88, test: null },
                    { text: "Take everything and continue", goto: 6, test: null }
                ]
            },
            187: {
                text: "You attempt to pick the complex lock. Test your Skill at difficulty 12.",
                options: [
                    { text: "Test Skill to pick lock", goto: 188, test: { type: "skill", difficulty: 12 } },
                    { text: "Give up", goto: 6, test: null }
                ]
            },
            188: {
                text: "Success! The lock clicks open. Inside the safe you find valuable gems and gold coins worth 500 gold.",
                effect: { item: "gem_collection" },
                options: [
                    { text: "Take the gems", goto: 6, test: null }
                ]
            },
            189: {
                text: "The tunnel emerges in the village cemetery. Fresh graves remind you of your feeding habits. You can see the church spire in the distance.",
                options: [
                    { text: "Go to the church", goto: 41, test: null },
                    { text: "Return through the tunnel", goto: 19, test: null }
                ]
            },
            190: {
                text: "You send the hypnotized mayor back to the inn as your spy. He'll report everything to you.",
                options: [
                    { text: "Wait for his report", goto: 242, test: null },
                    { text: "Follow him secretly", goto: 243, test: { type: "skill", difficulty: 9 } }
                ]
            },
            191: {
                text: "You set a trap outside the inn - a tripwire that will alert you when someone leaves.",
                options: [
                    { text: "Wait for the trap to spring", goto: 244, test: null },
                    { text: "Enter the inn anyway", goto: 110, test: null }
                ]
            },
            192: {
                text: "VAN HELSING AMBUSH: Skill 11, Stamina 10, Damage 2D6+2. You have the element of surprise!",
                combat: {
                    enemy: "van_helsing_ambush",
                    skill: 11,
                    stamina: 10,
                    damage: "2d6+2",
                    special: "surprised",
                    loot: ["silver_pistol", "holy_water"],
                    escape: 5
                }
            },
            193: {
                text: "You sneak into the now-empty inn. Inside, you find Van Helsing's notes and maps. Valuable intelligence!",
                effect: { item: "van_helsing_notes" },
                options: [
                    { text: "Take everything and leave", goto: 245, test: null },
                    { text: "Set a trap inside", goto: 246, test: null }
                ]
            },
            194: {
                text: "You search the bedroom. Under the bed, you find a silver crucifix and a diary belonging to one of Van Helsing's men.",
                effect: { items: ["silver_crucifix", "hunter_diary"] },
                options: [
                    { text: "Read the diary", goto: 247, test: null },
                    { text: "Take items and attack", goto: 117, test: null }
                ]
            },
            195: {
                text: "You wait as men stumble from the burning inn, coughing and blinded by smoke. Easy prey.",
                options: [
                    { text: "Attack the survivors", goto: 248, combat: "burning_survivors" },
                    { text: "Let them go and watch", goto: 249, test: null }
                ]
            },
            196: {
                text: "You make sure no one escapes the burning inn. It's ruthless but effective.",
                options: [
                    { text: "Return to castle", goto: 1, test: null }
                ]
            },
            197: {
                text: "You attack the man silently from behind. Test your Skill at difficulty 9 to kill him quietly.",
                options: [
                    { text: "Test Skill for silent kill", goto: 250, test: { type: "skill", difficulty: 9 } },
                    { text: "Just knock him out", goto: 251, test: null }
                ]
            },
            198: {
                text: "You let the man go back inside. He doesn't notice you. You continue waiting.",
                options: [
                    { text: "Wait longer", goto: 113, test: null },
                    { text: "Attack now", goto: 114, combat: "van_helsing_party" }
                ]
            },
            199: {
                text: "You use the man as bait! When he returns inside, you follow close behind him into the inn!",
                options: [
                    { text: "Attack from behind him", goto: 252, combat: "surprise_entrance" },
                    { text: "Let him raise alarm and wait", goto: 253, test: null }
                ]
            },
            200: {
                text: "You attempt mass hypnosis on all five men! The effort is tremendous. Lose 2 Blood Points regardless of success.",
                effect: { blood: -2 },
                options: [
                    { text: "Test Skill at difficulty 15", goto: 254, test: { type: "skill", difficulty: 15 } },
                    { text: "Attack instead", goto: 114, test: null }
                ]
            },
            201: {
                text: "VAN HELSING SURPRISE: Skill 10, Stamina 14, Damage 2D6+2. They're surprised! You get first strike!",
                combat: {
                    enemy: "van_helsing_surprise",
                    skill: 10,
                    stamina: 14,
                    damage: "2d6+2",
                    special: "surprised",
                    loot: ["castle_maps", "silver_bullets"],
                    escape: 8
                }
            },
            202: {
                text: "You grab the maps from the table and flee out the window! Test your Skill to escape.",
                options: [
                    { text: "Test Skill to escape", goto: 255, test: { type: "skill", difficulty: 11 } },
                    { text: "Fight instead", goto: 201, combat: "van_helsing_surprise" }
                ]
            },
            203: {
                text: "You prepare an escape route through the secret tunnels. If things go badly, you can flee.",
                options: [
                    { text: "Wait for attack", goto: 125, test: null },
                    { text: "Flee now", goto: 256, test: null }
                ]
            },
            204: {
                text: "You sabotage their weapons! Silver bullets replaced with lead, holy water diluted. They won't know until combat.",
                effect: { skill: 1 },
                options: [
                    { text: "Attack them now", goto: 205, combat: "van_helsing_sleeping" },
                    { text: "Leave and let them come", goto: 123, test: null }
                ]
            },
            205: {
                text: "VAN HELSING SLEEPING: Skill 8, Stamina 12, Damage 2D6. They're asleep! Easy targets!",
                combat: {
                    enemy: "van_helsing_sleeping",
                    skill: 8,
                    stamina: 12,
                    damage: "2d6",
                    special: "sleeping",
                    loot: ["silver_sword", "holy_water", "gold_coins"],
                    escape: 2
                }
            },
            206: {
                text: "CASTLE INVASION: Skill 10, Stamina 16, Damage 2D6+2. Van Helsing and four men in your castle!",
                combat: {
                    enemy: "castle_invasion",
                    skill: 10,
                    stamina: 16,
                    damage: "2d6+2",
                    special: "home_advantage",
                    loot: ["castle_key", "treasure_map"],
                    escape: 15
                }
            },
            207: {
                text: "You trigger castle traps! Falling stones, hidden pits, swinging blades! Test your Skill to use them effectively.",
                options: [
                    { text: "Test Skill to use traps", goto: 257, test: { type: "skill", difficulty: 10 } },
                    { text: "Fight directly", goto: 206, combat: "castle_invasion" }
                ]
            },
            208: {
                text: "You flee through secret passages! The invaders search the empty castle, frustrated.",
                options: [
                    { text: "Escape to the woods", goto: 258, test: null },
                    { text: "Double back and ambush", goto: 259, test: { type: "skill", difficulty: 11 } }
                ]
            },
            209: {
                text: "NIGHT ATTACK: Skill 9, Stamina 14, Damage 2D6+1. You attack the sleeping village!",
                combat: {
                    enemy: "night_attack",
                    skill: 9,
                    stamina: 14,
                    damage: "2d6+1",
                    special: "night_advantage",
                    loot: ["village_treasure", "silver_ware"],
                    escape: 8
                }
            },
            210: {
                text: "You send your servants first as a distraction. They cause chaos in the village while you target Van Helsing.",
                options: [
                    { text: "Attack Van Helsing directly", goto: 260, combat: "van_helsing_distracted" },
                    { text: "Let servants do the work", goto: 261, test: null }
                ]
            },
            211: {
                text: "You burn the village while everyone sleeps! Horrifying but effective. The villagers flee into the night.",
                options: [
                    { text: "Hunt the fleeing villagers", goto: 262, test: null },
                    { text: "Return to castle", goto: 1, test: null }
                ]
            },
            212: {
                text: "You seek the cure ingredients: 1) Holy water (from the church), 2) Virgin's garden garlic (from the village), 3) Willing blood sacrifice (hardest to find).",
                options: [
                    { text: "Go to church for holy water", goto: 41, test: null },
                    { text: "Go to village for garlic", goto: 10, test: null },
                    { text: "Search castle for alternatives", goto: 263, test: null }
                ]
            },
            213: {
                text: "You burn the book containing the cure! Such knowledge is too dangerous. Lose 1 Luck for destroying knowledge.",
                effect: { luck: -1 },
                options: [
                    { text: "Leave the library", goto: 2, test: null }
                ]
            },
            214: {
                text: "You let the witch hunter go. He stumbles away, free but weak. Gain 1 Luck for mercy.",
                effect: { luck: 1 },
                options: [
                    { text: "Leave the dungeon", goto: 19, test: null }
                ]
            },
            215: {
                text: "You torture the witch hunter for information. He breaks quickly but you lose 2 Luck for cruelty.",
                effect: { luck: -2 },
                options: [
                    { text: "Get information", goto: 68, test: null }
                ]
            },
            216: {
                text: "You hypnotize the weak witch hunter. He tells you everything he knows.",
                options: [
                    { text: "Get the information", goto: 68, test: null }
                ]
            },
            217: {
                text: "You command your new vampire hunter servant. 'What is your will, master?' he asks reluctantly.",
                options: [
                    { text: "Send him to spy on Van Helsing", goto: 264, test: null },
                    { text: "Keep him as bodyguard", goto: 265, test: null },
                    { text: "Send him to kill Van Helsing", goto: 266, test: null }
                ]
            },
            218: {
                text: "You travel as a swarm of bats! You reach the monastery in one hour instead of three.",
                options: [
                    { text: "Attack immediately", goto: 140, combat: "monastery_guardians" },
                    { text: "Observe first", goto: 142, test: null }
                ]
            },
            219: {
                text: "You pull out one of your own fangs! It's painful but provides a powerful vampire component. Lose 2 Stamina.",
                effect: { stamina: -2, item: "vampire_fang" },
                options: [
                    { text: "Continue gathering ingredients", goto: 138, test: null }
                ]
            },
            220: {
                text: "You flee the castle as artificial sunlight burns through the windows! You escape to the woods, homeless.",
                options: [
                    { text: "Find a new lair", goto: 267, test: null },
                    { text: "Seek revenge on Van Helsing", goto: 70, test: null }
                ]
            },
            221: {
                text: "You escape the monastery with the girl. Van Helsing doesn't follow immediately - he's trying to salvage the ritual.",
                options: [
                    { text: "Return to castle", goto: 1, test: null },
                    { text: "Hide in the woods", goto: 223, test: null }
                ]
            },
            222: {
                text: "You find a safe cottage in the woods for the maiden. 'I'll hide here,' she says. 'Come for me if you need my blood for the cure.'",
                options: [
                    { text: "Return to castle", goto: 1, test: null }
                ]
            },
            223: {
                text: "You hide in the woods until dawn. The holy relic is safe with you.",
                options: [
                    { text: "Study the relic", goto: 224, test: null },
                    { text: "Return to castle", goto: 1, test: null }
                ]
            },
            224: {
                text: "You study the holy relic. It's ancient, possibly from the time of Christ. Incredibly powerful against vampires... including you.",
                options: [
                    { text: "Keep it carefully", goto: 152, test: null },
                    { text: "Destroy it", goto: 227, test: { type: "skill", difficulty: 14 } }
                ]
            },
            225: {
                text: "You bury the holy relic deep in the woods. No one will ever find it. The world is safer.",
                victory: true,
                text: "GUARDIAN VICTORY! You protected the world from a dangerous relic. Your wisdom prevails."
            },
            226: {
                text: "You keep the holy relic as a trophy. It's dangerous but proves your power over holy objects.",
                options: [
                    { text: "Display it in the castle", goto: 268, test: null },
                    { text: "Keep it hidden", goto: 269, test: null }
                ]
            },
            227: {
                text: "You attempt to destroy the holy relic! Test your Skill at difficulty 14.",
                options: [
                    { text: "Test Skill to destroy relic", goto: 270, test: { type: "skill", difficulty: 14 } },
                    { text: "Keep it instead", goto: 226, test: null }
                ]
            },
            228: {
                text: "You use the holy relic in a dark ritual to increase your power! Dangerous but potentially rewarding.",
                options: [
                    { text: "Perform the ritual", goto: 271, test: { type: "skill", difficulty: 13 } },
                    { text: "Abandon the idea", goto: 152, test: null }
                ]
            },
            229: {
                text: "You have second thoughts about the cure. Becoming human means mortality, weakness, death...",
                options: [
                    { text: "Proceed with cure", goto: 77, test: null },
                    { text: "Reject cure", goto: 154, test: null }
                ]
            },
            230: {
                text: "You give up the ritual at the last moment! The ingredients are wasted. You remain a vampire.",
                options: [
                    { text: "Return to castle", goto: 2, test: null }
                ]
            },
            231: {
                text: "You flee before Van Helsing arrives. You start a new life far away, always hiding your past.",
                victory: true,
                text: "SECRET REDEMPTION! You're human again and free. Your past is behind you."
            },
            232: {
                text: "You sleep for a week to heal from the failed ritual. When you wake, you're weaker but alive.",
                options: [
                    { text: "Begin again", goto: 1, test: null }
                ]
            },
            233: {
                text: "You expand your territory, turning neighboring villages into hunting grounds. Your power grows.",
                victory: true,
                text: "EXPANSION VICTORY! Your vampire kingdom expands. You rule the night across Transylvania."
            },
            234: {
                text: "You search for more power, seeking ancient artifacts and forbidden knowledge.",
                options: [
                    { text: "Search the library", goto: 6, test: null },
                    { text: "Search the crypt", goto: 23, test: null },
                    { text: "Consult dark forces", goto: 272, test: null }
                ]
            },
            235: {
                text: "You return to your silent castle. The village is ashes. You are alone with your power.",
                victory: true,
                text: "SOLITARY VICTORY! You rule alone in a dead land. Powerful but lonely."
            },
            236: {
                text: "With the Amulet of Eternal Twilight, you're unstoppable! You conquer by day and night!",
                victory: true,
                text: "ULTIMATE VICTORY! With the amulet, you conquer all. Day and night bow before you!"
            },
            237: {
                text: "You hide in a cave to heal from sunlight burns. It takes days to recover.",
                options: [
                    { text: "Return to castle when healed", goto: 1, test: null }
                ]
            },
            238: {
                text: "You kill Van Helsing! The greatest vampire hunter is dead! Your legend is secure.",
                victory: true,
                text: "LEGENDARY VICTORY! You killed Van Helsing! No one will challenge you again."
            },
            239: {
                text: "You take Van Helsing prisoner. He's a valuable hostage and source of information.",
                effect: { item: "van_helsing_prisoner" },
                options: [
                    { text: "Return to castle with prisoner", goto: 1, test: null }
                ]
            },
            240: {
                text: "You watch your castle collapse from a safe distance. Centuries of history gone in minutes.",
                options: [
                    { text: "Start anew elsewhere", goto: 273, test: null },
                    { text: "Search the ruins", goto: 274, test: null }
                ]
            },
            241: {
                text: "The journal details your human life: Prince Vlad, warrior, statesman... then the turning. It's painful to read.",
                effect: { luck: 1 },
                options: [
                    { text: "Take the journal", goto: 179, test: null },
                    { text: "Leave it", goto: 178, test: null }
                ]
            },
            242: {
                text: "You wait for the mayor's report. He returns hours later with valuable information.",
                options: [
                    { text: "Get the information", goto: 45, test: null }
                ]
            },
            243: {
                text: "You follow the mayor secretly. He goes straight to the inn and acts normally. He's still hypnotized.",
                options: [
                    { text: "Wait outside", goto: 113, test: null },
                    { text: "Enter with him", goto: 110, test: null }
                ]
            },
            244: {
                text: "Your trap springs! Someone leaves the inn! It's one of Van Helsing's men.",
                options: [
                    { text: "Attack him", goto: 197, test: { type: "skill", difficulty: 9 } },
                    { text: "Follow him", goto: 275, test: null }
                ]
            },
            245: {
                text: "You take Van Helsing's notes and maps. Valuable intelligence! You leave the inn unseen.",
                options: [
                    { text: "Return to castle", goto: 1, test: null }
                ]
            },
            246: {
                text: "You set a trap in the inn for when they return. Poison in the wine, tripwires, the works.",
                options: [
                    { text: "Wait nearby", goto: 276, test: null },
                    { text: "Return to castle", goto: 1, test: null }
                ]
            },
            247: {
                text: "The diary reveals the hunter's fears: 'Van Helsing is obsessed. He'll get us all killed. The creature is too powerful.'",
                options: [
                    { text: "Use this knowledge", goto: 277, test: null },
                    { text: "Take items and attack", goto: 117, test: null }
                ]
            },
            248: {
                text: "BURNING SURVIVORS: Skill 6, Stamina 8, Damage 2D6. They're injured and disoriented from the fire.",
                combat: {
                    enemy: "burning_survivors",
                    skill: 6,
                    stamina: 8,
                    damage: "2d6",
                    special: "injured",
                    loot: ["burned_gear", "gold_coins"],
                    escape: 3
                }
            },
            249: {
                text: "You watch as the survivors stumble away. Let them spread fear of your power.",
                options: [
                    { text: "Return to castle", goto: 1, test: null }
                ]
            },
            250: {
                text: "You kill the man silently. His body won't be found until morning.",
                options: [
                    { text: "Return to waiting", goto: 113, test: null },
                    { text: "Attack the inn now", goto: 114, combat: "van_helsing_party" }
                ]
            },
            251: {
                text: "You knock the man out and hide his body. He won't be missed until morning.",
                options: [
                    { text: "Return to waiting", goto: 113, test: null }
                ]
            },
            252: {
                text: "SURPRISE ENTRANCE: Skill 9, Stamina 12, Damage 2D6+1. You enter right behind their comrade!",
                combat: {
                    enemy: "surprise_entrance",
                    skill: 9,
                    stamina: 12,
                    damage: "2d6+1",
                    special: "confusion",
                    loot: ["inn_key", "provisions"],
                    escape: 6
                }
            },
            253: {
                text: "You let the man raise the alarm. Now they're alert and waiting for you.",
                options: [
                    { text: "Attack anyway", goto: 114, combat: "van_helsing_party" },
                    { text: "Withdraw and reconsider", goto: 47, test: null }
                ]
            },
            254: {
                text: "Mass hypnosis succeeds! All five men fall under your control! Tremendous power!",
                options: [
                    { text: "Command them", goto: 278, test: null }
                ]
            },
            255: {
                text: "You escape with the maps! Van Helsing shouts in rage but can't catch you.",
                effect: { item: "castle_maps" },
                options: [
                    { text: "Return to castle", goto: 1, test: null }
                ]
            },
            256: {
                text: "You flee the castle through secret passages. You leave everything behind but escape with your life.",
                options: [
                    { text: "Start over elsewhere", goto: 273, test: null }
                ]
            },
            257: {
                text: "You use castle traps effectively! Falling stones crush two invaders! The others are terrified.",
                options: [
                    { text: "Attack the survivors", goto: 279, combat: "trapped_invaders" },
                    { text: "Let them flee", goto: 280, test: null }
                ]
            },
            258: {
                text: "You escape to the woods. The castle is lost, but you're free.",
                options: [
                    { text: "Find a new lair", goto: 267, test: null },
                    { text: "Plan revenge", goto: 281, test: null }
                ]
            },
            259: {
                text: "You double back through secret passages and ambush the invaders from behind!",
                options: [
                    { text: "Ambush them", goto: 282, combat: "ambush_invaders" },
                    { text: "Continue escaping", goto: 258, test: null }
                ]
            },
            260: {
                text: "VAN HELSING DISTRACTED: Skill 10, Stamina 12, Damage 2D6+2. He's distracted by your servants!",
                combat: {
                    enemy: "van_helsing_distracted",
                    skill: 10,
                    stamina: 12,
                    damage: "2d6+2",
                    special: "distracted",
                    loot: ["silver_sword", "hunter_medal"],
                    escape: 5
                }
            },
            261: {
                text: "You let your servants do the work. They slaughter many villagers before Van Helsing organizes a defense.",
                options: [
                    { text: "Join the battle", goto: 209, combat: "night_attack" },
                    { text: "Watch from safety", goto: 283, test: null }
                ]
            },
            262: {
                text: "You hunt the fleeing villagers like animals. It's a massacre.",
                victory: true,
                text: "TERROR VICTORY! You rule through absolute terror. None dare oppose you."
            },
            263: {
                text: "You search the castle for alternative cure ingredients. The alchemy lab might have something.",
                options: [
                    { text: "Search the alchemy lab", goto: 7, test: null },
                    { text: "Search the library", goto: 6, test: null },
                    { text: "Search the crypt", goto: 23, test: null }
                ]
            },
            264: {
                text: "You send your vampire hunter servant to spy on Van Helsing. He returns with valuable information.",
                options: [
                    { text: "Get the information", goto: 45, test: null }
                ]
            },
            265: {
                text: "You keep the vampire hunter as your bodyguard. He's effective but resentful.",
                options: [
                    { text: "Continue", goto: 2, test: null }
                ]
            },
            266: {
                text: "You send the vampire hunter to kill Van Helsing. He fails but weakens Van Helsing first.",
                options: [
                    { text: "Attack Van Helsing while he's weakened", goto: 284, combat: "weakened_van_helsing" },
                    { text: "Let them kill each other", goto: 285, test: null }
                ]
            },
            267: {
                text: "You find a new lair - an abandoned mine in the mountains. It's crude but defensible.",
                options: [
                    { text: "Establish new domain", goto: 286, test: null }
                ]
            },
            268: {
                text: "You display the holy relic in the castle as a trophy. It's dangerous but impressive.",
                options: [
                    { text: "Continue", goto: 2, test: null }
                ]
            },
            269: {
                text: "You hide the holy relic in a secret compartment. Only you know where it is.",
                options: [
                    { text: "Continue", goto: 2, test: null }
                ]
            },
            270: {
                text: "You destroy the holy relic! The explosion knocks you across the room. Lose 3 Stamina.",
                effect: { stamina: -3 },
                options: [
                    { text: "Return to castle", goto: 2, test: null }
                ]
            },
            271: {
                text: "You use the holy relic in a dark ritual! Test your Skill at difficulty 13.",
                options: [
                    { text: "Test Skill for dark ritual", goto: 287, test: { type: "skill", difficulty: 13 } },
                    { text: "Abandon the ritual", goto: 152, test: null }
                ]
            },
            272: {
                text: "You consult dark forces through ancient rituals. They offer power at a price.",
                options: [
                    { text: "Accept their offer", goto: 288, test: null },
                    { text: "Reject their offer", goto: 289, test: null }
                ]
            },
            273: {
                text: "You start anew elsewhere, building a new kingdom far from Transylvania.",
                victory: true,
                text: "NEW BEGINNING! You leave your past behind and build a new empire elsewhere."
            },
            274: {
                text: "You search the castle ruins. Buried treasure, ancient artifacts, and perhaps survivors...",
                options: [
                    { text: "Dig for treasure", goto: 290, test: null },
                    { text: "Leave the ruins", goto: 273, test: null }
                ]
            },
            275: {
                text: "You follow the man. He goes to the stables to check the horses.",
                options: [
                    { text: "Attack him in the stables", goto: 291, test: null },
                    { text: "Sabotage the horses", goto: 292, test: null }
                ]
            },
            276: {
                text: "You wait nearby. Hours later, Van Helsing and his men return to the trapped inn!",
                options: [
                    { text: "Watch the traps spring", goto: 293, test: null },
                    { text: "Attack while they're trapped", goto: 294, combat: "trapped_hunters" }
                ]
            },
            277: {
                text: "You use the diary's information to sow discord among the hunters.",
                options: [
                    { text: "Continue with plan", goto: 117, test: null }
                ]
            },
            278: {
                text: "You have five hypnotized vampire hunters under your control! Tremendous power!",
                options: [
                    { text: "Command your new army", goto: 295, test: null }
                ]
            },
            279: {
                text: "TRAPPED INVADERS: Skill 8, Stamina 10, Damage 2D6. They're wounded and demoralized from the traps.",
                combat: {
                    enemy: "trapped_invaders",
                    skill: 8,
                    stamina: 10,
                    damage: "2d6",
                    special: "demoralized",
                    loot: ["damaged_gear", "medical_supplies"],
                    escape: 4
                }
            },
            280: {
                text: "You let the survivors flee. They'll spread word of your power and the castle's defenses.",
                options: [
                    { text: "Repair castle defenses", goto: 296, test: null }
                ]
            },
            281: {
                text: "You plan revenge against those who took your castle. It will be slow but sure.",
                victory: true,
                text: "REVENGE QUEST! Your castle is gone but your vengeance begins. Your story continues..."
            },
            282: {
                text: "AMBUSH INVADERS: Skill 9, Stamina 12, Damage 2D6+1. You attack from behind!",
                combat: {
                    enemy: "ambush_invaders",
                    skill: 9,
                    stamina: 12,
                    damage: "2d6+1",
                    special: "ambush",
                    loot: ["invader_gear", "gold_coins"],
                    escape: 7
                }
            },
            283: {
                text: "You watch from safety as your servants attack the village. Effective but cruel.",
                options: [
                    { text: "Join eventually", goto: 209, combat: "night_attack" },
                    { text: "Return to castle", goto: 1, test: null }
                ]
            },
            284: {
                text: "WEAKENED VAN HELSING: Skill 10, Stamina 8, Damage 2D6+1. He's wounded from fighting your servant!",
                combat: {
                    enemy: "weakened_van_helsing",
                    skill: 10,
                    stamina: 8,
                    damage: "2d6+1",
                    special: "wounded",
                    loot: ["silver_sword", "medical_kit"],
                    escape: 3
                }
            },
            285: {
                text: "You let your servant and Van Helsing fight. They mortally wound each other. Both die.",
                options: [
                    { text: "Claim victory", goto: 297, test: null }
                ]
            },
            286: {
                text: "You establish a new domain in the abandoned mine. It's not the castle, but it's yours.",
                victory: true,
                text: "REBUILDER VICTORY! From the ashes, you rise again in a new lair."
            },
            287: {
                text: "The dark ritual with the holy relic works! You absorb its power without being destroyed! Gain 3 Skill and 4 Stamina!",
                effect: { skill: 3, stamina: 4 },
                options: [
                    { text: "Continue", goto: 2, test: null }
                ]
            },
            288: {
                text: "You accept the dark forces' offer. Immense power, but at the cost of your soul.",
                victory: true,
                text: "DARK PACT VICTORY! You gain ultimate power but lose your soul. The price was high."
            },
            289: {
                text: "You reject the dark forces' offer. Power isn't worth your soul.",
                victory: true,
                text: "INTEGRITY VICTORY! You kept your soul intact. A different kind of strength."
            },
            290: {
                text: "You dig in the ruins and find buried treasure! Gold, jewels, and ancient artifacts!",
                victory: true,
                text: "TREASURE HUNTER! You recover great wealth from the ruins. Rich but homeless."
            },
            291: {
                text: "You attack the man in the stables. The horses panic, causing chaos.",
                options: [
                    { text: "Kill him quickly", goto: 298, test: null },
                    { text: "Use him as hostage", goto: 299, test: null }
                ]
            },
            292: {
                text: "You sabotage the horses - cut reins, scatter them, poison feed.",
                options: [
                    { text: "Return to waiting", goto: 113, test: null }
                ]
            },
            293: {
                text: "You watch as your traps spring! Poisoned wine makes them sick, tripwires injure them.",
                options: [
                    { text: "Attack the weakened men", goto: 294, combat: "trapped_hunters" },
                    { text: "Let them suffer", goto: 300, test: null }
                ]
            },
            294: {
                text: "TRAPPED HUNTERS: Skill 7, Stamina 8, Damage 2D6. They're sick and injured from your traps!",
                combat: {
                    enemy: "trapped_hunters",
                    skill: 7,
                    stamina: 8,
                    damage: "2d6",
                    special: "poisoned",
                    loot: ["trapped_gear", "antidotes"],
                    escape: 2
                }
            },
            295: {
                text: "You command five hypnotized vampire hunters! An unstoppable force!",
                victory: true,
                text: "ARMY VICTORY! With five vampire hunters under your control, you're unstoppable!"
            },
            296: {
                text: "You repair and improve castle defenses. The next attack will fail for sure.",
                victory: true,
                text: "DEFENDER VICTORY! Your castle is impregnable. You rule secure in your fortress."
            },
            297: {
                text: "Both your servant and Van Helsing lie dead. You've won without lifting a finger.",
                victory: true,
                text: "MANIPULATOR VICTORY! You won through manipulation. The smartest victory of all."
            },
            298: {
                text: "You kill the man in the stables quickly and silently.",
                options: [
                    { text: "Return to waiting", goto: 113, test: null }
                ]
            },
            299: {
                text: "You take the man hostage. Useful for negotiations.",
                effect: { item: "hostage_hunter" },
                options: [
                    { text: "Use him to get to Van Helsing", goto: 301, test: null }
                ]
            },
            300: {
                text: "You let the poisoned, injured men suffer. They'll die slowly.",
                victory: true,
                text: "CRUEL VICTORY! You win through cruelty. Effective but monstrous."
            },
            301: {
                text: "You use the hostage hunter to get Van Helsing to negotiate.",
                options: [
                    { text: "Demand surrender", goto: 302, test: null },
                    { text: "Set a trap", goto: 303, test: null }
                ]
            },
            302: {
                text: "Van Helsing surrenders to save his man! You've won without further bloodshed.",
                victory: true,
                text: "DIPLOMAT VICTORY! You won through negotiation. The most civilized victory."
            },
            303: {
                text: "You set a trap using the hostage as bait. Van Helsing walks right into it.",
                options: [
                    { text: "Spring the trap", goto: 304, combat: "baited_trap" }
                ]
            },
            304: {
                text: "BAITED TRAP: Skill 9, Stamina 10, Damage 2D6+1. Van Helsing is caught in your trap!",
                combat: {
                    enemy: "baited_trap",
                    skill: 9,
                    stamina: 10,
                    damage: "2d6+1",
                    special: "trapped",
                    loot: ["van_helsing_gear", "ransom_money"],
                    escape: 4
                }
            }
        };

        // ENEMIES
        const enemies = {
            werewolf: {
                name: "WEREWOLF",
                description: "A half-man, half-wolf creature with razor-sharp claws.",
                skill: 9,
                stamina: 10,
                damage: "2d6+2",
                weakness: "silver",
                loot: ["wolf_fang", "silver_amulet"]
            },
            van_helsing: {
                name: "VAN HELSING",
                description: "The legendary vampire hunter, armed with holy relics.",
                skill: 12,
                stamina: 14,
                damage: "2d6+3",
                special: "holy_water",
                loot: ["silver_sword", "holy_symbol"]
            },
            tavern_brawler: {
                name: "TAVERN BRAWLER",
                description: "A huge villanger with fists like hams.",
                skill: 8,
                stamina: 12,
                damage: "2d6+1",
                loot: ["iron_key"]
            },
            carriage_driver: {
                name: "CARRIAGE DRIVER",
                description: "A strong man with a whip.",
                skill: 7,
                stamina: 8,
                damage: "2d6+1",
                loot: ["whip", "gold_coins"]
            },
            vlad_tepes: {
                name: "VLAD TEPES",
                description: "Your ancient sire, the original Dracula.",
                skill: 15,
                stamina: 18,
                damage: "2d6+4",
                special: "blood_drain",
                loot: ["ancient_crown", "dragon_ring"]
            },
            vampire_brides: {
                name: "VAMPIRE BRIDES",
                description: "Your three former brides, now feral.",
                skill: 10,
                stamina: 15,
                damage: "2d6+2",
                special: "swarm",
                loot: ["bridal_veil", "crystal_vial"]
            },
            van_helsing_party: {
                name: "VAN HELSING'S PARTY",
                description: "Van Helsing and four armed hunters.",
                skill: 11,
                stamina: 20,
                damage: "2d6+3",
                special: "teamwork",
                loot: ["silver_sword", "holy_symbol", "hunter_medal"]
            },
            monastery_guardians: {
                name: "MONASTERY GUARDIANS",
                description: "Two monks with silver-tipped spears.",
                skill: 8,
                stamina: 12,
                damage: "2d6+1",
                special: "holy_weapons",
                loot: ["silver_spear", "monk_robe"]
            },
            acolytes: {
                name: "ACOLYTES",
                description: "Four fanatical monks conducting the ritual.",
                skill: 7,
                stamina: 8,
                damage: "2d6",
                special: "ritual_protection",
                loot: ["prayer_book", "silver_dagger"]
            },
            van_helsing_ritual: {
                name: "VAN HELSING (RITUAL)",
                description: "Empowered by the ritual!",
                skill: 13,
                stamina: 16,
                damage: "2d6+3",
                special: "ritual_power",
                loot: ["holy_relic", "van_helsing_journal"]
            },
            van_helsing_sunlight: {
                name: "VAN HELSING (SUNLIGHT)",
                description: "Empowered by artificial sunlight!",
                skill: 14,
                stamina: 12,
                damage: "2d6+4",
                special: "sunlight_empowered",
                loot: ["holy_relic", "sun_amulet"]
            },
            final_stand: {
                name: "FINAL STAND",
                description: "Van Helsing and villagers making their last stand.",
                skill: 13,
                stamina: 18,
                damage: "2d6+3",
                special: "last_stand",
                loot: ["village_key", "van_helsing_final_journal"]
            },
            van_helsing_ambush: {
                name: "VAN HELSING (AMBUSH)",
                description: "You have the element of surprise!",
                skill: 11,
                stamina: 10,
                damage: "2d6+2",
                special: "surprised",
                loot: ["silver_pistol", "holy_water"]
            },
            van_helsing_surprise: {
                name: "VAN HELSING (SURPRISED)",
                description: "They're surprised by your attack from above!",
                skill: 10,
                stamina: 14,
                damage: "2d6+2",
                special: "surprised",
                loot: ["castle_maps", "silver_bullets"]
            },
            van_helsing_sleeping: {
                name: "VAN HELSING (SLEEPING)",
                description: "They're asleep! Easy targets!",
                skill: 8,
                stamina: 12,
                damage: "2d6",
                special: "sleeping",
                loot: ["silver_sword", "holy_water", "gold_coins"]
            },
            castle_invasion: {
                name: "CASTLE INVADERS",
                description: "Van Helsing and four men in your castle!",
                skill: 10,
                stamina: 16,
                damage: "2d6+2",
                special: "home_advantage",
                loot: ["castle_key", "treasure_map"]
            },
            night_attack: {
                name: "NIGHT ATTACK",
                description: "You attack the sleeping village!",
                skill: 9,
                stamina: 14,
                damage: "2d6+1",
                special: "night_advantage",
                loot: ["village_treasure", "silver_ware"]
            },
            van_helsing_distracted: {
                name: "VAN HELSING (DISTRACTED)",
                description: "He's distracted by your servants!",
                skill: 10,
                stamina: 12,
                damage: "2d6+2",
                special: "distracted",
                loot: ["silver_sword", "hunter_medal"]
            },
            burning_survivors: {
                name: "BURNING SURVIVORS",
                description: "Injured and disoriented from the fire.",
                skill: 6,
                stamina: 8,
                damage: "2d6",
                special: "injured",
                loot: ["burned_gear", "gold_coins"]
            },
            surprise_entrance: {
                name: "SURPRISE ENTRANCE",
                description: "You enter right behind their comrade!",
                skill: 9,
                stamina: 12,
                damage: "2d6+1",
                special: "confusion",
                loot: ["inn_key", "provisions"]
            },
            trapped_invaders: {
                name: "TRAPPED INVADERS",
                description: "Wounded and demoralized from castle traps.",
                skill: 8,
                stamina: 10,
                damage: "2d6",
                special: "demoralized",
                loot: ["damaged_gear", "medical_supplies"]
            },
            ambush_invaders: {
                name: "AMBUSH INVADERS",
                description: "You attack from behind through secret passages!",
                skill: 9,
                stamina: 12,
                damage: "2d6+1",
                special: "ambush",
                loot: ["invader_gear", "gold_coins"]
            },
            weakened_van_helsing: {
                name: "WEAKENED VAN HELSING",
                description: "Wounded from fighting your servant.",
                skill: 10,
                stamina: 8,
                damage: "2d6+1",
                special: "wounded",
                loot: ["silver_sword", "medical_kit"]
            },
            trapped_hunters: {
                name: "TRAPPED HUNTERS",
                description: "Sick and injured from your traps in the inn.",
                skill: 7,
                stamina: 8,
                damage: "2d6",
                special: "poisoned",
                loot: ["trapped_gear", "antidotes"]
            },
            baited_trap: {
                name: "BAITED TRAP",
                description: "Van Helsing is caught in your trap!",
                skill: 9,
                stamina: 10,
                damage: "2d6+1",
                special: "trapped",
                loot: ["van_helsing_gear", "ransom_money"]
            }
        };

        // COMPLETE ITEMS LIST
        const items = {
            silver_dagger: {
                name: "Silver Dagger",
                description: "+1 Skill in combat. Effective against werewolves.",
                type: "weapon",
                bonus: 1,
                slots: 1
            },
            holy_water: {
                name: "Holy Water",
                description: "3 uses. Does 4 damage to undead.",
                type: "consumable",
                uses: 3,
                slots: 1
            },
            garlic_charm: {
                name: "Garlic Charm",
                description: "Protects against vampires. Can be used as weapon.",
                type: "special",
                slots: 1
            },
            healing_potion: {
                name: "Healing Potion",
                description: "Restores 4 Stamina when drunk.",
                type: "consumable",
                effect: 4,
                slots: 1
            },
            lantern: {
                name: "Brass Lantern",
                description: "Lights dark areas. Can blind enemies.",
                type: "tool",
                slots: 2
            },
            lockpicks: {
                name: "Lockpicks",
                description: "+2 Skill when picking locks or disarming traps.",
                type: "tool",
                bonus: 2,
                slots: 1
            },
            wolfsbane: {
                name: "Wolfsbane",
                description: "Causes werewolves to flee. One use.",
                type: "consumable",
                slots: 1
            },
            thieves_tools: {
                name: "Thieves' Tools",
                description: "Allows picking of complex locks.",
                type: "tool",
                slots: 2
            },
            silver_amulet: {
                name: "Silver Amulet",
                description: "Protects against curses. Worth 50 gold.",
                type: "treasure",
                slots: 1
            },
            wolf_fang: {
                name: "Wolf Fang",
                description: "Trophy from a werewolf. Can be made into necklace.",
                type: "treasure",
                slots: 1
            },
            silver_sword: {
                name: "Silver Sword",
                description: "+2 Skill in combat. Holy blessing.",
                type: "weapon",
                bonus: 2,
                slots: 2
            },
            holy_symbol: {
                name: "Holy Symbol",
                description: "Repels undead. Can be used as focus.",
                type: "special",
                slots: 1
            },
            iron_key: {
                name: "Iron Key",
                description: "Opens the castle dungeon.",
                type: "key",
                slots: 1
            },
            ancient_tome: {
                name: "Ancient Tome",
                description: "Contains vampire secrets. May be valuable.",
                type: "book",
                slots: 2
            },
            whip: {
                name: "Whip",
                description: "A leather whip. Can be used as a weapon (+0 Skill).",
                type: "weapon",
                bonus: 0,
                slots: 2
            },
            gold_coins: {
                name: "Gold Coins",
                description: "A bag of 50 gold coins. Useful for bribes.",
                type: "treasure",
                slots: 1
            },
            silver_bullet: {
                name: "Silver Bullet",
                description: "A single silver bullet. Can be used in a firearm.",
                type: "ammo",
                slots: 1
            },
            servant: {
                name: "Servant",
                description: "A loyal servant. Helps in combat (+1 Skill).",
                type: "follower",
                bonus: 1,
                slots: 0
            },
            hostage: {
                name: "Hostage",
                description: "The village mayor. Useful for negotiations.",
                type: "follower",
                slots: 0
            },
            ancient_crown: {
                name: "Ancient Crown",
                description: "Vlad Tepes' crown. +2 Skill when worn.",
                type: "artifact",
                bonus: 2,
                slots: 1
            },
            dragon_ring: {
                name: "Dragon Ring",
                description: "Magical ring. +1 to all stats.",
                type: "artifact",
                bonus: 1,
                slots: 1
            },
            bridal_veil: {
                name: "Bridal Veil",
                description: "Enchanted veil. +1 Luck.",
                type: "clothing",
                bonus: 1,
                slots: 1
            },
            crystal_vial: {
                name: "Crystal Vial",
                description: "Holds potions without degradation.",
                type: "container",
                slots: 1
            },
            hunter_medal: {
                name: "Hunter Medal",
                description: "Proof of defeating Van Helsing.",
                type: "trophy",
                slots: 1
            },
            holy_relic: {
                name: "Holy Relic",
                description: "Ancient religious artifact. Powerful but dangerous.",
                type: "artifact",
                slots: 1
            },
            rescued_maiden: {
                name: "Rescued Maiden",
                description: "A grateful young woman. Can provide help.",
                type: "follower",
                slots: 0
            },
            eternal_twilight_amulet: {
                name: "Amulet of Eternal Twilight",
                description: "Legendary artifact! Grants immunity to sunlight. +5 to all stats when worn.",
                type: "artifact",
                bonus: 5,
                slots: 1
            },
            wallachia_deed: {
                name: "Deed to Wallachian Lands",
                description: "Legal ownership of 1000 acres. Potentially valuable if you regain humanity.",
                type: "treasure",
                slots: 1
            },
            human_portrait: {
                name: "Portrait of Human Self",
                description: "A painting of you as a young prince. Haunting reminder of what you lost.",
                type: "special",
                slots: 1
            },
            gem_collection: {
                name: "Collection of Gems",
                description: "Rubies, sapphires, and emeralds worth 500 gold coins.",
                type: "treasure",
                slots: 1
            },
            golden_goblet: {
                name: "Golden Goblet",
                description: "Ancient drinking vessel worth 200 gold. Can hold holy water without burning.",
                type: "treasure",
                slots: 1
            },
            silver_key: {
                name: "Silver Dragon Key",
                description: "Opens a special lock somewhere in the castle. The dragon design matches your family crest.",
                type: "key",
                slots: 1
            },
            dusty_scroll: {
                name: "Dusty Scroll",
                description: "Ancient writing in a forgotten language. May contain secrets if deciphered.",
                type: "book",
                slots: 1
            },
            ancient_journal: {
                name: "Your Ancient Journal",
                description: "Your own writings from human days. Reading it restores memories.",
                type: "book",
                slots: 1
            },
            castle_maps: {
                name: "Castle Secret Maps",
                description: "Shows all hidden passages. No Skill tests needed for secret doors.",
                type: "tool",
                slots: 1
            },
            crystal_inkwell: {
                name: "Crystal Inkwell",
                description: "Still contains magical ink that never dries. Could be useful for rituals.",
                type: "tool",
                slots: 1
            },
            silver_cross: {
                name: "Silver Cross",
                description: "A simple silver cross. Painful to touch but useful.",
                type: "special",
                slots: 1
            },
            van_helsing_notes: {
                name: "Van Helsing's Notes",
                description: "Detailed plans for hunting vampires. Valuable intelligence.",
                type: "book",
                slots: 1
            },
            silver_crucifix: {
                name: "Silver Crucifix",
                description: "A powerful holy symbol. Dangerous to vampires.",
                type: "special",
                slots: 1
            },
            hunter_diary: {
                name: "Hunter's Diary",
                description: "Reveals fears and doubts of Van Helsing's men.",
                type: "book",
                slots: 1
            },
            burned_gear: {
                name: "Burned Gear",
                description: "Charred equipment from the inn fire. Mostly useless.",
                type: "junk",
                slots: 1
            },
            inn_key: {
                name: "Inn Key",
                description: "Key to the village inn. Could be useful.",
                type: "key",
                slots: 1
            },
            provisions: {
                name: "Provisions",
                description: "Food and drink. Not useful to a vampire.",
                type: "junk",
                slots: 1
            },
            silver_spear: {
                name: "Silver Spear",
                description: "A silver-tipped spear. +1 Skill in combat.",
                type: "weapon",
                bonus: 1,
                slots: 2
            },
            monk_robe: {
                name: "Monk's Robe",
                description: "A simple robe. Disguise potential.",
                type: "clothing",
                slots: 1
            },
            prayer_book: {
                name: "Prayer Book",
                description: "Holy book. Painful to read for a vampire.",
                type: "book",
                slots: 1
            },
            van_helsing_journal: {
                name: "Van Helsing's Journal",
                description: "His personal notes on vampire hunting.",
                type: "book",
                slots: 1
            },
            sun_amulet: {
                name: "Sun Amulet",
                description: "Creates artificial sunlight. Very dangerous!",
                type: "artifact",
                slots: 1
            },
            van_helsing_final_journal: {
                name: "Van Helsing's Final Journal",
                description: "His last writings before defeat.",
                type: "book",
                slots: 1
            },
            village_key: {
                name: "Village Key",
                description: "Key to the village strongbox.",
                type: "key",
                slots: 1
            },
            village_treasure: {
                name: "Village Treasure",
                description: "Gold and jewels looted from the village.",
                type: "treasure",
                slots: 2
            },
            silver_ware: {
                name: "Silver Ware",
                description: "Silver plates and cutlery. Valuable.",
                type: "treasure",
                slots: 1
            },
            vampire_fang: {
                name: "Vampire Fang",
                description: "Your own fang. Powerful ritual component.",
                type: "special",
                slots: 1
            },
            damaged_gear: {
                name: "Damaged Gear",
                description: "Equipment damaged by castle traps.",
                type: "junk",
                slots: 1
            },
            medical_supplies: {
                name: "Medical Supplies",
                description: "Bandages and medicines. Not useful to a vampire.",
                type: "junk",
                slots: 1
            },
            invader_gear: {
                name: "Invader's Gear",
                description: "Equipment from castle invaders.",
                type: "junk",
                slots: 1
            },
            silver_pistol: {
                name: "Silver Pistol",
                description: "A pistol loaded with silver bullets. +2 Skill at range.",
                type: "weapon",
                bonus: 2,
                slots: 2
            },
            trapped_gear: {
                name: "Trapped Hunter Gear",
                description: "Equipment from trapped hunters.",
                type: "junk",
                slots: 1
            },
            antidotes: {
                name: "Antidotes",
                description: "Counteracts poison. Not needed by a vampire.",
                type: "junk",
                slots: 1
            },
            ransom_money: {
                name: "Ransom Money",
                description: "Money for paying ransoms. Now yours.",
                type: "treasure",
                slots: 1
            },
            hostage_hunter: {
                name: "Hunter Hostage",
                description: "A captured hunter. Useful for negotiations.",
                type: "follower",
                slots: 0
            },
            van_helsing_prisoner: {
                name: "Van Helsing Prisoner",
                description: "The great vampire hunter himself, your prisoner!",
                type: "follower",
                slots: 0
            },
            van_helsing_gear: {
                name: "Van Helsing's Gear",
                description: "His personal equipment. Valuable trophies.",
                type: "treasure",
                slots: 2
            },
            mayor_pawn: {
                name: "Mayor Pawn",
                description: "The hypnotized village mayor. Your pawn.",
                type: "follower",
                slots: 0
            },
            medical_kit: {
                name: "Medical Kit",
                description: "Advanced medical supplies. Useless to a vampire.",
                type: "junk",
                slots: 1
            },
            treasure_map: {
                name: "Treasure Map",
                description: "Map to hidden treasure in the castle.",
                type: "tool",
                slots: 1
            }
        };

        // Initialize Game
        function initGame() {
            document.getElementById('start-btn').addEventListener('click', showCharacterScreen);
            document.getElementById('rules-btn').addEventListener('click', showRulesScreen);
            
            console.log("Game initialized with " + Object.keys(sections).length + " sections!");
            console.log("All areas properly connected:");
            console.log("- Library (6) → Secret passage (22) → Crypt (23)");
            console.log("- Dungeons (19) → Secret tunnel (104) → Village cemetery (189)");
            console.log("- Coffin chamber (100) → Hidden journal");
            console.log("- Multiple paths to victory and defeat!");
        }

        // Game Functions
        function showStartScreen() {
            hideAllScreens();
            document.getElementById('start-screen').classList.add('active');
            gameState.screen = 'start';
        }
        
        function showRulesScreen() {
            hideAllScreens();
            document.getElementById('rules-screen').classList.add('active');
            gameState.screen = 'rules';
        }
        
        function showCharacterScreen() {
            hideAllScreens();
            document.getElementById('character-screen').classList.add('active');
            gameState.screen = 'character';
            
            gameState.selectedEquipment = [];
            document.getElementById('selected-equipment').innerHTML = "";
            updateBeginButtonState();
        }
        
        function hideAllScreens() {
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => {
                screen.classList.remove('active');
            });
        }
        
        function rollStat(stat) {
            const dice1 = Math.floor(Math.random() * 6) + 1;
            const dice2 = Math.floor(Math.random() * 6) + 1;
            const total = dice1 + dice2;
            
            let baseValue = 0;
            if (stat === 'stamina') {
                baseValue = total + 12;
            } else {
                baseValue = total + 6;
            }
            
            document.getElementById(`${stat}-roll`).textContent = `${dice1}+${dice2} = ${total} + ${baseValue - total} = ${baseValue}`;
            
            gameState.stats[`initial${stat.charAt(0).toUpperCase() + stat.slice(1)}`] = baseValue;
            gameState.stats[stat] = baseValue;
            
            if (stat === 'stamina') {
                gameState.stats.maxStamina = baseValue;
            }
            
            document.getElementById(`${stat}-value`).textContent = baseValue;
            
            updateBonusPoints();
            updateBeginButtonState();
        }
        
        function adjustStat(stat, change) {
            if (change > 0 && gameState.bonusPoints <= 0) return;
            
            let minValue = 6;
            if (stat === 'stamina') minValue = 12;
            
            if (change < 0 && gameState.stats[stat] <= minValue) return;
            
            let maxValue = 18;
            if (stat === 'stamina') maxValue = 24;
            
            if (change > 0 && gameState.stats[stat] >= maxValue) return;
            
            gameState.stats[stat] += change;
            gameState.bonusPoints -= change;
            
            if (stat === 'stamina') {
                gameState.stats.maxStamina = gameState.stats.stamina;
            }
            
            document.getElementById(`${stat}-value`).textContent = gameState.stats[stat];
            document.getElementById('bonus-points').textContent = gameState.bonusPoints;
            
            updateBeginButtonState();
        }
        
        function updateBonusPoints() {
            let usedPoints = 0;
            usedPoints += Math.max(0, gameState.stats.stamina - (gameState.stats.initialStamina || 0));
            usedPoints += Math.max(0, gameState.stats.skill - (gameState.stats.initialSkill || 0));
            usedPoints += Math.max(0, gameState.stats.luck - (gameState.stats.initialLuck || 0));
            
            gameState.bonusPoints = 6 - usedPoints;
            document.getElementById('bonus-points').textContent = gameState.bonusPoints;
        }
        
        function selectEquipment(itemId) {
            if (gameState.selectedEquipment.length >= 3 && !gameState.selectedEquipment.includes(itemId)) {
                alert("You can only select 3 starting items!");
                return;
            }
            
            if (gameState.selectedEquipment.includes(itemId)) {
                const index = gameState.selectedEquipment.indexOf(itemId);
                gameState.selectedEquipment.splice(index, 1);
            } else {
                gameState.selectedEquipment.push(itemId);
            }
            
            const equipmentDiv = document.getElementById('selected-equipment');
            equipmentDiv.innerHTML = "";
            
            gameState.selectedEquipment.forEach(itemId => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'item';
                itemDiv.textContent = items[itemId].name;
                equipmentDiv.appendChild(itemDiv);
            });
            
            updateBeginButtonState();
        }
        
        function updateBeginButtonState() {
            const beginBtn = document.getElementById('begin-btn');
            const isValid = 
                gameState.stats.stamina >= 12 &&
                gameState.stats.skill >= 6 &&
                gameState.stats.luck >= 6 &&
                gameState.selectedEquipment.length === 3 &&
                gameState.bonusPoints === 0;
            
            beginBtn.disabled = !isValid;
        }
        
        function startGame() {
            if (gameState.stats.stamina < 12) {
                alert("Minimum Stamina not met: Need at least 12!");
                return;
            }
            
            if (gameState.stats.skill < 6) {
                alert("Minimum Skill not met: Need at least 6!");
                return;
            }
            
            if (gameState.stats.luck < 6) {
                alert("Minimum Luck not met: Need at least 6!");
                return;
            }
            
            if (gameState.selectedEquipment.length !== 3) {
                alert("You must select exactly 3 starting items!");
                return;
            }
            
            if (gameState.bonusPoints !== 0) {
                alert("You must use all 6 bonus points!");
                return;
            }
            
            gameState.inventory = [...gameState.selectedEquipment];
            
            document.getElementById('current-stamina').textContent = gameState.stats.stamina;
            document.getElementById('current-skill').textContent = gameState.stats.skill;
            document.getElementById('current-luck').textContent = gameState.stats.luck;
            document.getElementById('current-blood').textContent = gameState.stats.bloodPoints;
            document.getElementById('current-section').textContent = gameState.currentSection;
            
            updateStaminaBar();
            updateInventoryCount();
            
            hideAllScreens();
            document.getElementById('game-screen').classList.add('active');
            gameState.screen = 'game';
            
            showSection(1);
        }
        
        function showSection(sectionNumber) {
            gameState.currentSection = sectionNumber;
            gameState.visitedSections.push(sectionNumber);
            
            const section = sections[sectionNumber];
            if (!section) {
                handleEnding(sectionNumber);
                return;
            }
            
            document.getElementById('current-section').textContent = sectionNumber;
            
            let html = `<p><span class="section-number">${sectionNumber}.</span> ${section.text}</p>`;
            
            if (section.effect) {
                applyEffect(section.effect);
            }
            
            if (section.combat) {
                document.getElementById('game-text').innerHTML = html;
                startCombat(section.combat);
                return;
            }
            
            if (section.victory) {
                showVictory(section.text || section.victoryText);
                return;
            }
            
            document.getElementById('game-text').innerHTML = html;
            
            const buttonContainer = document.getElementById('action-buttons');
            buttonContainer.innerHTML = "";
            
            if (section.options) {
                section.options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.textContent = option.text;
                    
                    if (option.test) {
                        button.onclick = () => handleTest(option.test, option.goto);
                    } else if (option.combat) {
                        button.onclick = () => {
                            document.getElementById('game-text').innerHTML = html;
                            startCombat(option.combat);
                        };
                    } else {
                        button.onclick = () => showSection(option.goto);
                    }
                    
                    buttonContainer.appendChild(button);
                });
            }
            
            const inventoryButton = document.createElement('button');
            inventoryButton.textContent = "CHECK INVENTORY";
            inventoryButton.onclick = showInventory;
            buttonContainer.appendChild(inventoryButton);
            
            const diceButton = document.createElement('button');
            diceButton.textContent = "ROLL DICE";
            diceButton.onclick = rollDice;
            buttonContainer.appendChild(diceButton);
        }
        
        function applyEffect(effect) {
            let message = "";
            
            if (effect.stamina) {
                gameState.stats.stamina += effect.stamina;
                gameState.stats.stamina = Math.min(gameState.stats.stamina, gameState.stats.maxStamina);
                if (gameState.stats.stamina <= 0) {
                    gameOver("Your Stamina has reached 0!");
                    return;
                }
                updateStaminaBar();
                message += ` Stamina ${effect.stamina > 0 ? '+' : ''}${effect.stamina}.`;
            }
            
            if (effect.skill) {
                gameState.stats.skill += effect.skill;
                document.getElementById('current-skill').textContent = gameState.stats.skill;
                message += ` Skill ${effect.skill > 0 ? '+' : ''}${effect.skill}.`;
            }
            
            if (effect.luck) {
                gameState.stats.luck += effect.luck;
                document.getElementById('current-luck').textContent = gameState.stats.luck;
                message += ` Luck ${effect.luck > 0 ? '+' : ''}${effect.luck}.`;
            }
            
            if (effect.blood) {
                gameState.stats.bloodPoints += effect.blood;
                gameState.stats.bloodPoints = Math.min(gameState.stats.bloodPoints, gameState.stats.maxBloodPoints);
                document.getElementById('current-blood').textContent = gameState.stats.bloodPoints;
                message += ` Blood Points ${effect.blood > 0 ? '+' : ''}${effect.blood}.`;
            }
            
            if (effect.item) {
                if (!gameState.inventory.includes(effect.item)) {
                    gameState.inventory.push(effect.item);
                    updateInventoryCount();
                    message += ` Added ${items[effect.item].name} to inventory.`;
                }
            }
            
            if (effect.items) {
                effect.items.forEach(itemId => {
                    if (!gameState.inventory.includes(itemId)) {
                        gameState.inventory.push(itemId);
                        updateInventoryCount();
                        message += ` Added ${items[itemId].name} to inventory.`;
                    }
                });
            }
            
            if (message) {
                const gameText = document.getElementById('game-text');
                gameText.innerHTML += `<p class="outcome-good">${message}</p>`;
            }
        }
        
        function handleTest(test, successGoto) {
            let html = document.getElementById('game-text').innerHTML;
            
            if (test.type === "skill") {
                html += `<div class="skill-check">`;
                html += `<p>Testing Skill (${gameState.stats.skill})...</p>`;
                
                const dice1 = Math.floor(Math.random() * 6) + 1;
                const dice2 = Math.floor(Math.random() * 6) + 1;
                const total = dice1 + dice2;
                
                html += `<p>Roll: ${dice1} + ${dice2} = <strong>${total}</strong></p>`;
                
                let success = false;
                if (test.target) {
                    const target = typeof test.target === 'function' ? test.target() : test.target;
                    success = total <= target;
                    html += `<p>Need ${total} ≤ ${target}: ${success ? 'SUCCESS!' : 'FAILURE!'}</p>`;
                } else if (test.difficulty) {
                    const checkTotal = total + gameState.stats.skill;
                    success = checkTotal >= test.difficulty;
                    html += `<p>${total} + Skill ${gameState.stats.skill} = ${checkTotal} vs ${test.difficulty}: ${success ? 'SUCCESS!' : 'FAILURE!'}</p>`;
                }
                
                if (success) {
                    html += `<p class="skill-success">You succeeded!</p>`;
                    document.getElementById('game-text').innerHTML = html;
                    setTimeout(() => showSection(successGoto), 1500);
                } else {
                    html += `<p class="skill-failure">You failed!</p>`;
                    document.getElementById('game-text').innerHTML = html;
                    
                    const failureButton = document.createElement('button');
                    failureButton.textContent = "CONTINUE";
                    failureButton.onclick = () => showSection(successGoto + 1);
                    document.getElementById('action-buttons').innerHTML = "";
                    document.getElementById('action-buttons').appendChild(failureButton);
                }
                
            } else if (test.type === "luck") {
                html += `<div class="skill-check">`;
                html += `<p>Testing Luck (${gameState.stats.luck})...</p>`;
                
                const dice1 = Math.floor(Math.random() * 6) + 1;
                const dice2 = Math.floor(Math.random() * 6) + 1;
                const total = dice1 + dice2;
                
                html += `<p>Roll: ${dice1} + ${dice2} = <strong>${total}</strong></p>`;
                
                let success = false;
                if (test.target) {
                    success = total >= test.target;
                    html += `<p>Need ${total} ≥ ${test.target}: ${success ? 'LUCKY!' : 'UNLUCKY!'}</p>`;
                } else {
                    success = total <= gameState.stats.luck;
                    html += `<p>Need ${total} ≤ ${gameState.stats.luck}: ${success ? 'LUCKY!' : 'UNLUCKY!'}</p>`;
                }
                
                gameState.stats.luck--;
                document.getElementById('current-luck').textContent = gameState.stats.luck;
                html += `<p>Your Luck is now ${gameState.stats.luck}</p>`;
                
                if (success) {
                    html += `<p class="skill-success">You are lucky!</p>`;
                    document.getElementById('game-text').innerHTML = html;
                    setTimeout(() => showSection(successGoto), 1500);
                } else {
                    html += `<p class="skill-failure">You are unlucky!</p>`;
                    document.getElementById('game-text').innerHTML = html;
                    
                    const failureButton = document.createElement('button');
                    failureButton.textContent = "CONTINUE";
                    failureButton.onclick = () => showSection(successGoto + 1);
                    document.getElementById('action-buttons').innerHTML = "";
                    document.getElementById('action-buttons').appendChild(failureButton);
                }
                
            } else if (test.type === "item") {
                const hasItem = gameState.inventory.includes(test.item);
                if (hasItem) {
                    html += `<p class="outcome-good">You use the ${items[test.item].name}!</p>`;
                    document.getElementById('game-text').innerHTML = html;
                    setTimeout(() => showSection(successGoto), 1000);
                } else {
                    html += `<p class="outcome-bad">You don't have the required item!</p>`;
                    document.getElementById('game-text').innerHTML = html;
                    
                    const failureButton = document.createElement('button');
                    failureButton.textContent = "CONTINUE";
                    failureButton.onclick = () => showSection(successGoto + 10);
                    document.getElementById('action-buttons').innerHTML = "";
                    document.getElementById('action-buttons').appendChild(failureButton);
                }
            } else if (test.type === "power") {
                if (gameState.stats.bloodPoints > 0) {
                    gameState.stats.bloodPoints--;
                    document.getElementById('current-blood').textContent = gameState.stats.bloodPoints;
                    html += `<p class="skill-success">You use your vampiric power!</p>`;
                    document.getElementById('game-text').innerHTML = html;
                    setTimeout(() => showSection(successGoto), 1000);
                } else {
                    html += `<p class="outcome-bad">Not enough Blood Points!</p>`;
                    document.getElementById('game-text').innerHTML = html;
                    
                    const failureButton = document.createElement('button');
                    failureButton.textContent = "CONTINUE";
                    failureButton.onclick = () => showSection(successGoto + 5);
                    document.getElementById('action-buttons').innerHTML = "";
                    document.getElementById('action-buttons').appendChild(failureButton);
                }
            } else if (test.type === "autoFail") {
                html += `<p class="skill-failure">The attempt fails!</p>`;
                document.getElementById('game-text').innerHTML = html;
                setTimeout(() => showSection(successGoto), 1000);
            }
        }
        
        function startCombat(combatData) {
            gameState.combat.active = true;
            gameState.combat.enemy = combatData.enemy || combatData;
            gameState.combat.round = 1;
            
            const enemy = enemies[gameState.combat.enemy];
            
            hideAllScreens();
            document.getElementById('combat-screen').classList.add('active');
            gameState.screen = 'combat';
            
            let html = `<p class="game-over">COMBAT!</p>`;
            html += `<p>You face a ${enemy.name}: ${enemy.description}</p>`;
            html += `<p>Enemy Skill: ${enemy.skill}, Stamina: ${enemy.stamina}</p>`;
            
            if (enemy.weakness) {
                html += `<p class="warning">Weakness: ${enemy.weakness}</p>`;
            }
            
            if (enemy.special) {
                html += `<p class="warning">Special: ${enemy.special}</p>`;
            }
            
            document.getElementById('combat-text').innerHTML = html;
            
            gameState.combat.enemyStamina = enemy.stamina;
            document.getElementById('combat-player-stamina').textContent = gameState.stats.stamina;
            document.getElementById('combat-enemy-stamina').textContent = enemy.stamina;
            
            updateCombatBars();
            showCombatActions();
        }
        
        function showCombatActions() {
            const actionsDiv = document.getElementById('combat-actions');
            actionsDiv.innerHTML = "";
            
            const attackButton = document.createElement('button');
            attackButton.textContent = "ATTACK";
            attackButton.className = 'combat-option';
            attackButton.onclick = combatRound;
            actionsDiv.appendChild(attackButton);
            
            const bloodDrainButton = document.createElement('button');
            bloodDrainButton.textContent = "BLOOD DRAIN (if hit, +2 Stamina)";
            bloodDrainButton.onclick = () => combatRound(true);
            actionsDiv.appendChild(bloodDrainButton);
            
            if (hasItem('holy_water') && gameState.combat.enemy === 'van_helsing') {
                const holyButton = document.createElement('button');
                holyButton.textContent = "USE HOLY WATER (4 damage)";
                holyButton.onclick = useHolyWater;
                actionsDiv.appendChild(holyButton);
            }
            
            if (hasItem('silver_dagger') && gameState.combat.enemy === 'werewolf') {
                const silverButton = document.createElement('button');
                silverButton.textContent = "USE SILVER DAGGER (double damage)";
                silverButton.onclick = useSilverWeapon;
                actionsDiv.appendChild(silverButton);
            }
            
            const fleeButton = document.createElement('button');
            fleeButton.textContent = "ATTEMPT TO FLEE";
            fleeButton.onclick = attemptFlee;
            actionsDiv.appendChild(fleeButton);
        }
        
        function combatRound(useBloodDrain = false) {
            const enemy = enemies[gameState.combat.enemy];
            let html = document.getElementById('combat-text').innerHTML;
            
            html += `<h3>ROUND ${gameState.combat.round}</h3>`;
            
            const playerRoll1 = Math.floor(Math.random() * 6) + 1;
            const playerRoll2 = Math.floor(Math.random() * 6) + 1;
            const playerAttack = playerRoll1 + playerRoll2 + gameState.stats.skill + gameState.stats.skillBonus;
            
            html += `<p>You attack... Roll: ${playerRoll1} + ${playerRoll2} + Skill ${gameState.stats.skill} = <strong>${playerAttack}</strong></p>`;
            
            const enemyRoll1 = Math.floor(Math.random() * 6) + 1;
            const enemyRoll2 = Math.floor(Math.random() * 6) + 1;
            const enemyAttack = enemyRoll1 + enemyRoll2 + enemy.skill;
            
            html += `<p>${enemy.name} attacks... Roll: ${enemyRoll1} + ${enemyRoll2} + Skill ${enemy.skill} = <strong>${enemyAttack}</strong></p>`;
            
            if (playerAttack > enemyAttack) {
                let damage = 0;
                if (gameState.combat.enemy === 'werewolf' && hasItem('silver_dagger')) {
                    damage = 4;
                    html += `<p class="outcome-good">Your silver weapon strikes true! Damage: ${damage}</p>`;
                } else {
                    damage = Math.floor(Math.random() * 6) + 1 + 2;
                    html += `<p class="outcome-good">You hit for ${damage} damage!</p>`;
                }
                
                gameState.combat.enemyStamina -= damage;
                
                if (useBloodDrain) {
                    gameState.stats.stamina = Math.min(gameState.stats.maxStamina, gameState.stats.stamina + 2);
                    html += `<p class="skill-success">Blood drain restores 2 Stamina!</p>`;
                    updateStaminaBar();
                }
                
            } else if (enemyAttack > playerAttack) {
                let damage = 0;
                if (enemy.special === 'holy_water' && Math.random() > 0.7) {
                    damage = 4;
                    html += `<p class="outcome-bad">${enemy.name} uses holy water! Damage: ${damage}</p>`;
                } else {
                    damage = Math.floor(Math.random() * 6) + 1 + 2;
                    html += `<p class="outcome-bad">${enemy.name} hits for ${damage} damage!</p>`;
                }
                
                gameState.stats.stamina -= damage;
                
            } else {
                html += `<p>Your attacks clash! No damage this round.</p>`;
            }
            
            gameState.combat.round++;
            
            document.getElementById('combat-text').innerHTML = html;
            updateCombatBars();
            setTimeout(() => checkCombatEnd(), 1000);
        }
        
        function useHolyWater() {
            const holyIndex = gameState.inventory.indexOf('holy_water');
            if (holyIndex === -1) return;
            
            let html = document.getElementById('combat-text').innerHTML;
            html += `<p class="skill-success">You throw holy water! 4 damage!</p>`;
            
            gameState.combat.enemyStamina -= 4;
            gameState.inventory.splice(holyIndex, 1);
            updateInventoryCount();
            
            document.getElementById('combat-text').innerHTML = html;
            updateCombatBars();
            setTimeout(() => checkCombatEnd(), 1000);
        }
        
        function useSilverWeapon() {
            if (!hasItem('silver_dagger')) return;
            
            let html = document.getElementById('combat-text').innerHTML;
            html += `<p class="skill-success">Silver weapon strikes true! 4 damage!</p>`;
            
            gameState.combat.enemyStamina -= 4;
            document.getElementById('combat-text').innerHTML = html;
            updateCombatBars();
            setTimeout(() => checkCombatEnd(), 1000);
        }
        
        function attemptFlee() {
            let html = document.getElementById('combat-text').innerHTML;
            html += `<p>You attempt to flee...</p>`;
            
            const dice1 = Math.floor(Math.random() * 6) + 1;
            const dice2 = Math.floor(Math.random() * 6) + 1;
            const total = dice1 + dice2;
            
            html += `<p>Roll: ${dice1} + ${dice2} = ${total}. Need ≤ Skill ${gameState.stats.skill}.</p>`;
            
            if (total <= gameState.stats.skill) {
                html += `<p class="outcome-good">You escape!</p>`;
                document.getElementById('combat-text').innerHTML = html;
                
                setTimeout(() => {
                    endCombat(false);
                    showSection(gameState.currentSection + 1);
                }, 1500);
            } else {
                html += `<p class="outcome-bad">You fail to escape!</p>`;
                document.getElementById('combat-text').innerHTML = html;
                
                setTimeout(() => {
                    const enemy = enemies[gameState.combat.enemy];
                    const damage = Math.floor(Math.random() * 6) + 1 + 2;
                    
                    html += `<p>${enemy.name} attacks as you flee! ${damage} damage!</p>`;
                    gameState.stats.stamina -= damage;
                    
                    document.getElementById('combat-text').innerHTML = html;
                    updateCombatBars();
                    
                    if (gameState.stats.stamina <= 0) {
                        gameOver("You were defeated in combat!");
                    } else {
                        setTimeout(() => checkCombatEnd(), 1000);
                    }
                }, 1000);
            }
        }
        
        function updateCombatBars() {
            const playerPercent = (gameState.stats.stamina / gameState.stats.maxStamina) * 100;
            document.getElementById('player-combat-bar').style.width = `${playerPercent}%`;
            document.getElementById('combat-player-stamina').textContent = gameState.stats.stamina;
            
            const enemy = enemies[gameState.combat.enemy];
            const enemyPercent = (gameState.combat.enemyStamina / enemy.stamina) * 100;
            document.getElementById('enemy-combat-bar').style.width = `${enemyPercent}%`;
            document.getElementById('combat-enemy-stamina').textContent = gameState.combat.enemyStamina;
            
            document.getElementById('current-stamina').textContent = gameState.stats.stamina;
            updateStaminaBar();
        }
        
        function checkCombatEnd() {
            if (gameState.stats.stamina <= 0) {
                gameOver("You were defeated in combat!");
                return;
            }
            
            if (gameState.combat.enemyStamina <= 0) {
                const enemy = enemies[gameState.combat.enemy];
                let html = document.getElementById('combat-text').innerHTML;
                html += `<p class="victory">You defeated the ${enemy.name}!</p>`;
                
                if (enemy.loot && enemy.loot.length > 0) {
                    html += `<p class="outcome-good">You find: ${enemy.loot.map(item => items[item].name).join(', ')}</p>`;
                    enemy.loot.forEach(item => {
                        if (!gameState.inventory.includes(item)) {
                            gameState.inventory.push(item);
                        }
                    });
                    updateInventoryCount();
                }
                
                gameState.stats.bloodPoints = Math.min(gameState.stats.maxBloodPoints, gameState.stats.bloodPoints + 2);
                document.getElementById('current-blood').textContent = gameState.stats.bloodPoints;
                html += `<p>Gained 2 Blood Points from the victory!</p>`;
                
                document.getElementById('combat-text').innerHTML = html;
                
                setTimeout(() => {
                    endCombat(true);
                    showSection(gameState.currentSection + 1);
                }, 2000);
            } else {
                showCombatActions();
            }
        }
        
        function endCombat(victory) {
            gameState.combat.active = false;
            
            if (!victory && gameState.stats.stamina <= 0) return;
            
            hideAllScreens();
            document.getElementById('game-screen').classList.add('active');
            gameState.screen = 'game';
        }
        
        function hasItem(itemId) {
            return gameState.inventory.includes(itemId);
        }
        
        function showInventory() {
            hideAllScreens();
            document.getElementById('inventory-screen').classList.add('active');
            gameState.screen = 'inventory';
            
            document.getElementById('total-items').textContent = gameState.inventory.length;
            
            const inventoryDiv = document.getElementById('inventory-items');
            inventoryDiv.innerHTML = "";
            
            if (gameState.inventory.length === 0) {
                inventoryDiv.innerHTML = "<p>Your inventory is empty.</p>";
            } else {
                gameState.inventory.forEach(itemId => {
                    if (items[itemId]) {
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'item';
                        itemDiv.innerHTML = `<strong>${items[itemId].name}</strong><br>${items[itemId].description}`;
                        inventoryDiv.appendChild(itemDiv);
                    }
                });
            }
            
            const weaponDiv = document.getElementById('equipped-weapons');
            weaponDiv.innerHTML = "";
            
            if (gameState.equippedWeapon) {
                const weapon = items[gameState.equippedWeapon];
                weaponDiv.innerHTML = `<div class="item item-rare"><strong>${weapon.name}</strong><br>${weapon.description}</div>`;
            } else {
                weaponDiv.innerHTML = "<p>No weapon equipped.</p>";
            }
            
            const specialDiv = document.getElementById('special-items');
            specialDiv.innerHTML = "";
            
            const specialItems = gameState.inventory.filter(itemId => 
                items[itemId] && items[itemId].type === 'special'
            );
            
            if (specialItems.length === 0) {
                specialDiv.innerHTML = "<p>No special items.</p>";
            } else {
                specialItems.forEach(itemId => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'item';
                    itemDiv.innerHTML = `<strong>${items[itemId].name}</strong><br>${items[itemId].description}`;
                    specialDiv.appendChild(itemDiv);
                });
            }
            
            const provisionsDiv = document.getElementById('provisions');
            provisionsDiv.innerHTML = "";
            
            const healingItems = gameState.inventory.filter(itemId => 
                items[itemId] && items[itemId].type === 'consumable' && itemId.includes('healing')
            );
            
            if (healingItems.length === 0) {
                provisionsDiv.innerHTML = "<p>No healing items.</p>";
            } else {
                healingItems.forEach(itemId => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'item';
                    itemDiv.innerHTML = `<strong>${items[itemId].name}</strong><br>${items[itemId].description}`;
                    provisionsDiv.appendChild(itemDiv);
                });
            }
        }
        
        function useHealing() {
            const healingIndex = gameState.inventory.findIndex(itemId => 
                items[itemId] && items[itemId].type === 'consumable' && itemId.includes('healing')
            );
            
            if (healingIndex === -1) {
                alert("No healing items available!");
                return;
            }
            
            const healingItem = gameState.inventory[healingIndex];
            const healAmount = items[healingItem].effect || 4;
            
            gameState.stats.stamina = Math.min(gameState.stats.maxStamina, gameState.stats.stamina + healAmount);
            gameState.inventory.splice(healingIndex, 1);
            
            updateStaminaBar();
            updateInventoryCount();
            showInventory();
            
            alert(`Used ${items[healingItem].name}! Restored ${healAmount} Stamina.`);
        }
        
        function showPowers() {
            hideAllScreens();
            document.getElementById('powers-screen').classList.add('active');
            gameState.screen = 'powers';
            
            document.getElementById('blood-points-display').textContent = gameState.stats.bloodPoints;
            
            const powers = ['hypnotic_gaze', 'shadow_form', 'bat_swarm', 'mist_form', 'animal_call'];
            powers.forEach(power => {
                const button = document.getElementById(`power-${power.split('_')[0]}`);
                if (button) {
                    if (gameState.stats.bloodPoints >= (power === 'mist_form' ? 2 : 1)) {
                        button.disabled = false;
                    } else {
                        button.disabled = true;
                    }
                }
            });
        }
        
        function usePower(powerId) {
            let cost = 1;
            if (powerId === 'mist_form') cost = 2;
            if (powerId === 'blood_drain') cost = 0;
            
            if (gameState.stats.bloodPoints < cost) {
                alert("Not enough Blood Points!");
                return;
            }
            
            gameState.stats.bloodPoints -= cost;
            document.getElementById('blood-points-display').textContent = gameState.stats.bloodPoints;
            document.getElementById('current-blood').textContent = gameState.stats.bloodPoints;
            
            let message = "";
            switch(powerId) {
                case 'hypnotic_gaze':
                    message = "Your eyes glow crimson. A weak-willed target would obey your commands.";
                    break;
                case 'shadow_form':
                    message = "You become one with the shadows. For the next few minutes, you are nearly invisible.";
                    break;
                case 'bat_swarm':
                    message = "You transform into a swarm of bats! You can fly over obstacles or confuse enemies.";
                    break;
                case 'mist_form':
                    message = "Your body dissolves into mist. You can pass through bars or under doors.";
                    break;
                case 'animal_call':
                    message = "You emit a silent call. Wolves or bats in the area will come to your aid.";
                    break;
            }
            
            alert(`Used ${powerId.replace('_', ' ').toUpperCase()}!\n\n${message}`);
            showGameScreen();
        }
        
        function showGameScreen() {
            hideAllScreens();
            document.getElementById('game-screen').classList.add('active');
            gameState.screen = 'game';
        }
        
        function rollDice() {
            const dice1 = Math.floor(Math.random() * 6) + 1;
            const dice2 = Math.floor(Math.random() * 6) + 1;
            const total = dice1 + dice2;
            
            const diceResults = document.getElementById('dice-results');
            diceResults.style.display = 'block';
            diceResults.innerHTML = `
                <div class="dice-roller">
                    <h3>DICE ROLL</h3>
                    <p>Rolled: ${dice1} and ${dice2}</p>
                    <p class="dice-result">Total: ${total}</p>
                    <p>2D6 = ${total}</p>
                </div>
            `;
            
            diceResults.scrollIntoView({ behavior: 'smooth' });
            
            setTimeout(() => {
                diceResults.style.display = 'none';
            }, 5000);
        }
        
        function testLuck() {
            if (gameState.stats.luck <= 0) {
                alert("Your Luck is 0! You cannot test Luck!");
                return;
            }
            
            const dice1 = Math.floor(Math.random() * 6) + 1;
            const dice2 = Math.floor(Math.random() * 6) + 1;
            const total = dice1 + dice2;
            
            const isLucky = total <= gameState.stats.luck;
            
            gameState.stats.luck--;
            document.getElementById('current-luck').textContent = gameState.stats.luck;
            
            let message = `You roll: ${dice1} + ${dice2} = ${total}\n`;
            message += `Your Luck is ${gameState.stats.luck + 1}\n`;
            message += `Need ${total} ≤ ${gameState.stats.luck + 1}\n\n`;
            message += isLucky ? 
                "You are LUCKY! Good fortune favors you!" : 
                "You are UNLUCKY! Misfortune strikes!";
            
            alert(message);
            document.getElementById('luck-test').textContent = isLucky ? "Lucky!" : "Unlucky!";
        }
        
        function updateStaminaBar() {
            const staminaPercent = (gameState.stats.stamina / gameState.stats.maxStamina) * 100;
            document.getElementById('stamina-bar').style.width = `${staminaPercent}%`;
            document.getElementById('current-stamina').textContent = gameState.stats.stamina;
        }
        
        function updateInventoryCount() {
            document.getElementById('inventory-count').textContent = gameState.inventory.length;
        }
        
        function handleEnding(sectionNumber) {
            if (sectionNumber >= 150) {
                showVictory("Congratulations! You have completed your adventure!");
            } else {
                gameOver("Your adventure has reached a dead end at section " + sectionNumber);
            }
        }
        
        function showVictory(message) {
            hideAllScreens();
            document.getElementById('victory-screen').classList.add('active');
            
            let victoryText = "<p class='victory'>VICTORY!</p>";
            victoryText += `<p>${message}</p>`;
            victoryText += "<p>Your adventure has reached its conclusion.</p>";
            victoryText += `<p>Final Stats: Stamina ${gameState.stats.stamina}, Skill ${gameState.stats.skill}, Luck ${gameState.stats.luck}</p>`;
            victoryText += `<p>Sections visited: ${gameState.visitedSections.length}</p>`;
            victoryText += `<p>Items collected: ${gameState.inventory.length}</p>`;
            
            document.getElementById('victory-text').innerHTML = victoryText;
        }
        
        function gameOver(reason) {
            hideAllScreens();
            document.getElementById('gameover-screen').classList.add('active');
            
            let html = `<p class="game-over">GAME OVER</p>`;
            html += `<p>${reason}</p>`;
            html += `<p>You reached section ${gameState.currentSection}</p>`;
            html += `<p>Final Stamina: ${gameState.stats.stamina}</p>`;
            html += `<p>Final Skill: ${gameState.stats.skill}</p>`;
            html += `<p>Final Luck: ${gameState.stats.luck}</p>`;
            html += `<p>Items collected: ${gameState.inventory.length}</p>`;
            
            document.getElementById('gameover-text').innerHTML = html;
        }
        
        function restartGame() {
            gameState.screen = 'start';
            gameState.stats = {
                initialStamina: 0,
                stamina: 0,
                maxStamina: 0,
                initialSkill: 0,
                skill: 0,
                skillBonus: 0,
                initialLuck: 0,
                luck: 0,
                bloodPoints: 5,
                maxBloodPoints: 10
            };
            gameState.inventory = [];
            gameState.equippedWeapon = null;
            gameState.armor = null;
            gameState.currentSection = 1;
            gameState.visitedSections = [];
            gameState.combat = {
                active: false,
                enemy: null,
                enemyStamina: 0,
                round: 1,
                playerRoll: 0,
                enemyRoll: 0
            };
            gameState.dice = {
                value1: 0,
                value2: 0,
                total: 0
            };
            gameState.gameOver = false;
            gameState.victory = false;
            gameState.bonusPoints = 6;
            gameState.selectedEquipment = [];
            
            document.getElementById('stamina-roll').textContent = '--';
            document.getElementById('skill-roll').textContent = '--';
            document.getElementById('luck-roll').textContent = '--';
            document.getElementById('stamina-value').textContent = '0';
            document.getElementById('skill-value').textContent = '0';
            document.getElementById('luck-value').textContent = '0';
            document.getElementById('bonus-points').textContent = '6';
            document.getElementById('selected-equipment').innerHTML = '';
            
            hideAllScreens();
            document.getElementById('start-screen').classList.add('active');
        }
        
        // Initialize the game when page loads
        window.onload = initGame;
    </script>
</body>
</html>
