<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dracula's Redemption - Gamebook Adventure</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #000;
            color: #fff;
            font-family: 'Press Start 2P', cursive;
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .game-container {
            border: 4px double #fff;
            padding: 20px;
            margin-bottom: 20px;
            background-color: #111;
            min-height: 80vh;
        }
        
        .screen {
            display: none;
        }
        
        .active {
            display: block;
        }
        
        h1, h2, h3 {
            color: #ff3333;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 0 5px #ff0000;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 30px;
        }
        
        h2 {
            font-size: 1.8rem;
            margin-top: 20px;
        }
        
        h3 {
            font-size: 1.2rem;
            text-align: left;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
            margin-top: 15px;
        }
        
        .game-text {
            background-color: #000;
            border: 2px solid #333;
            padding: 15px;
            margin: 20px 0;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            font-size: 0.9rem;
            line-height: 1.8;
        }
        
        .game-text p {
            margin-bottom: 15px;
        }
        
        .npc-dialogue {
            color: #ffff66;
            font-style: italic;
            margin: 10px 0;
            padding-left: 10px;
            border-left: 2px solid #ffff66;
        }
        
        .player-dialogue {
            color: #66ff66;
            margin: 10px 0;
            padding-left: 10px;
            border-left: 2px solid #66ff66;
        }
        
        .button-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }
        
        button {
            background-color: #222;
            color: #fff;
            border: 2px solid #666;
            font-family: 'Press Start 2P', cursive;
            padding: 12px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
            flex-grow: 1;
            min-width: 200px;
        }
        
        button:hover:not(:disabled) {
            background-color: #333;
            border-color: #ff3333;
            color: #ff3333;
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-item {
            background-color: #222;
            padding: 10px;
            border: 1px solid #444;
            text-align: center;
        }
        
        .stat-value {
            color: #ffff66;
            font-weight: bold;
            font-size: 1.5rem;
        }
        
        .inventory {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
        }
        
        .item {
            background-color: #1a1a1a;
            padding: 8px;
            border: 1px solid #333;
            font-size: 0.8rem;
        }
        
        .item-rare {
            border-color: #ff9900;
            color: #ff9900;
        }
        
        .item-legendary {
            border-color: #ff3366;
            color: #ff3366;
        }
        
        .outcome-good {
            color: #66ff66;
        }
        
        .outcome-bad {
            color: #ff6666;
        }
        
        .warning {
            color: #ff9900;
        }
        
        .game-over {
            color: #ff0000;
            font-size: 1.5rem;
            text-align: center;
            margin: 30px 0;
        }
        
        .victory {
            color: #66ff66;
            font-size: 1.5rem;
            text-align: center;
            margin: 30px 0;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #666;
            font-size: 0.7rem;
            border-top: 1px solid #333;
            padding-top: 15px;
        }
        
        /* Combat styles */
        .combat-screen {
            background-color: #220000;
            border: 2px solid #ff0000;
        }
        
        .combatant {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 10px 0;
            background-color: #330000;
            border: 1px solid #660000;
        }
        
        .combatant-player {
            border-color: #006600;
            background-color: #003300;
        }
        
        .health-bar {
            width: 100%;
            height: 20px;
            background-color: #330000;
            border: 1px solid #666;
            margin: 5px 0;
        }
        
        .health-fill {
            height: 100%;
            background-color: #ff0000;
            transition: width 0.3s;
        }
        
        .health-fill-player {
            background-color: #66ff66;
        }
        
        /* Dice roller */
        .dice-roller {
            background-color: #222;
            border: 2px solid #666;
            padding: 10px;
            margin: 10px 0;
            text-align: center;
        }
        
        .dice-result {
            font-size: 2rem;
            color: #ffff66;
            margin: 10px 0;
        }
        
        .roll-button {
            background-color: #333;
            color: #ffff66;
            border-color: #ffff66;
        }
        
        /* Skill check display */
        .skill-check {
            background-color: #1a1a2a;
            border: 1px solid #4444ff;
            padding: 10px;
            margin: 10px 0;
        }
        
        .skill-success {
            color: #3399ff;
            background-color: #112233;
            padding: 5px;
            margin: 5px 0;
            border-left: 3px solid #3399ff;
        }
        
        .skill-failure {
            color: #ff6666;
            background-color: #332222;
            padding: 5px;
            margin: 5px 0;
            border-left: 3px solid #ff6666;
        }
        
        /* Puzzle and trap styles */
        .puzzle-container {
            background-color: #1a1a1a;
            border: 2px dashed #ff9900;
            padding: 15px;
            margin: 15px 0;
        }
        
        .trap-warning {
            color: #ff3333;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* Gamebook section numbers */
        .section-number {
            color: #ffff66;
            font-weight: bold;
            margin-right: 10px;
        }
        
        /* Inventory slots */
        .inventory-slot {
            width: 80px;
            height: 80px;
            border: 2px solid #444;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin: 5px;
            background-color: #222;
            cursor: pointer;
        }
        
        .inventory-slot.filled {
            border-color: #ff9900;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }
            
            h2 {
                font-size: 1.3rem;
            }
            
            .game-text {
                font-size: 0.8rem;
            }
            
            button {
                font-size: 0.7rem;
                min-width: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Start Screen -->
        <div id="start-screen" class="screen active">
            <h1>DRACULA'S REDEMPTION</h1>
            <h2>GAMEBOOK ADVENTURE</h2>
            <div class="game-text">
                <p>Transylvania, 1897. The blood moon rises over the Carpathian Mountains.</p>
                <p>You are Count Dracula, an ancient vampire prince, awakening from centuries of slumber.</p>
                <p>But something is different this night. An ancient prophecy speaks of redemption, or damnation.</p>
                <p class="warning">This is a Fighting Fantasy-style gamebook adventure. You will need:</p>
                <p>• Your CHARACTER SHEET (Stamina, Skill, Luck, Vampiric Powers)</p>
                <p>• Two six-sided dice (2D6)</p>
                <p>• A pencil and eraser to track your inventory and stats</p>
                <p class="outcome-good">Test your Skill against traps and enemies! Use Luck at critical moments!</p>
                <p class="outcome-bad">Beware: Death lurks around every corner!</p>
            </div>
            <div class="button-container">
                <button id="start-btn">BEGIN YOUR QUEST</button>
                <button id="rules-btn">GAME RULES</button>
            </div>
        </div>
        
        <!-- Rules Screen -->
        <div id="rules-screen" class="screen">
            <h2>GAMEBOOK RULES</h2>
            <div class="game-text">
                <h3>YOUR CHARACTER</h3>
                <p><span class="section-number">1.</span> <strong>STAMINA:</strong> Your health. If it reaches 0, you die.</p>
                <p><span class="section-number">2.</span> <strong>SKILL:</strong> Your combat ability and agility.</p>
                <p><span class="section-number">3.</span> <strong>LUCK:</strong> Your fortune. Test Luck to avoid traps or find treasure.</p>
                <p><span class="section-number">4.</span> <strong>VAMPIRIC POWER:</strong> Your dark abilities. Spend Blood Points to use them.</p>
                
                <h3>COMBAT</h3>
                <p><span class="section-number">1.</span> Roll 2D6 + your SKILL vs enemy's 2D6 + their SKILL</p>
                <p><span class="section-number">2.</span> Higher score hits for damage (see enemy stats)</p>
                <p><span class="section-number">3.</span> You may flee on your turn (Test Skill to escape)</p>
                
                <h3>TESTING SKILL</h3>
                <p>Roll 2D6. If result ≤ your SKILL, you succeed!</p>
                <p>Example: Skill 12 needs 12 or less on 2D6</p>
                
                <h3>TESTING LUCK</h3>
                <p>Roll 2D6. If result ≤ your LUCK, you're lucky!</p>
                <p>Each Luck test reduces LUCK by 1 (win or lose)</p>
                
                <h3>INVENTORY</h3>
                <p>You can carry 10 items. Weapons, armor, and special items take slots.</p>
                <p>Some items give combat bonuses or solve puzzles.</p>
            </div>
            <div class="button-container">
                <button onclick="showStartScreen()">BACK</button>
                <button onclick="showCharacterScreen()">CREATE CHARACTER</button>
            </div>
        </div>
        
        <!-- Character Creation Screen -->
        <div id="character-screen" class="screen">
            <h2>CREATE YOUR DRACULA</h2>
            <div class="game-text">
                <p>Roll 2D6 for each stat, then distribute 6 bonus points as you wish.</p>
                <p class="warning">Write these scores on your character sheet!</p>
                
                <div class="stats-container">
                    <div class="stat-item">
                        <h3>STAMINA</h3>
                        <div class="dice-roller">
                            <div class="dice-result" id="stamina-roll">--</div>
                            <button class="roll-button" onclick="rollStat('stamina')">ROLL 2D6 + 12</button>
                        </div>
                        <p>Current: <span id="stamina-value" class="stat-value">0</span></p>
                        <button onclick="adjustStat('stamina', 1)">+</button>
                        <button onclick="adjustStat('stamina', -1)">-</button>
                    </div>
                    
                    <div class="stat-item">
                        <h3>SKILL</h3>
                        <div class="dice-roller">
                            <div class="dice-result" id="skill-roll">--</div>
                            <button class="roll-button" onclick="rollStat('skill')">ROLL 2D6 + 6</button>
                        </div>
                        <p>Current: <span id="skill-value" class="stat-value">0</span></p>
                        <button onclick="adjustStat('skill', 1)">+</button>
                        <button onclick="adjustStat('skill', -1)">-</button>
                    </div>
                    
                    <div class="stat-item">
                        <h3>LUCK</h3>
                        <div class="dice-roller">
                            <div class="dice-result" id="luck-roll">--</div>
                            <button class="roll-button" onclick="rollStat('luck')">ROLL 2D6 + 6</button>
                        </div>
                        <p>Current: <span id="luck-value" class="stat-value">0</span></p>
                        <button onclick="adjustStat('luck', 1)">+</button>
                        <button onclick="adjustStat('luck', -1)">-</button>
                    </div>
                </div>
                
                <p>Bonus points remaining: <span id="bonus-points" class="stat-value">6</span></p>
                <p class="warning">Minimum Stamina: 12, Minimum Skill: 6, Minimum Luck: 6</p>
                
                <h3>CHOOSE STARTING EQUIPMENT</h3>
                <p>Select 3 items from the list below:</p>
            </div>
            
            <div class="button-container">
                <button onclick="selectEquipment('silver_dagger')">SILVER DAGGER (+1 Skill in combat)</button>
                <button onclick="selectEquipment('holy_water')">VIAL OF HOLY WATER (3 uses)</button>
                <button onclick="selectEquipment('garlic_charm')">GARLIC CHARM (vs vampires)</button>
                <button onclick="selectEquipment('healing_potion')">HEALING POTION (+4 Stamina)</button>
                <button onclick="selectEquipment('lantern')">BRASS LANTERN (light in darkness)</button>
                <button onclick="selectEquipment('lockpicks')">LOCKPICKS (+2 Skill for traps)</button>
                <button onclick="selectEquipment('wolfsbane')">WOLFSBANE (vs werewolves)</button>
                <button onclick="selectEquipment('thieves_tools')">THIEVES' TOOLS</button>
            </div>
            
            <div class="inventory" id="selected-equipment">
                <!-- Selected equipment will appear here -->
            </div>
            
            <div class="button-container">
                <button id="begin-btn" onclick="startGame()" disabled>BEGIN ADVENTURE AT SECTION 1</button>
            </div>
        </div>
        
        <!-- Main Game Screen -->
        <div id="game-screen" class="screen">
            <h2>DRACULA'S REDEMPTION</h2>
            
            <div class="stats-container">
                <div class="stat-item">
                    <h3>STAMINA</h3>
                    <div class="stat-value" id="current-stamina">0</div>
                    <div class="health-bar">
                        <div id="stamina-bar" class="health-fill health-fill-player" style="width: 100%"></div>
                    </div>
                </div>
                <div class="stat-item">
                    <h3>SKILL</h3>
                    <div class="stat-value" id="current-skill">0</div>
                    <div>Current Bonus: <span id="skill-bonus">+0</span></div>
                </div>
                <div class="stat-item">
                    <h3>LUCK</h3>
                    <div class="stat-value" id="current-luck">0</div>
                    <div>Next Test: <span id="luck-test">--</span></div>
                </div>
                <div class="stat-item">
                    <h3>BLOOD</h3>
                    <div class="stat-value" id="current-blood">5</div>
                    <div>Vampiric Power Points</div>
                </div>
                <div class="stat-item">
                    <h3>SECTION</h3>
                    <div class="stat-value" id="current-section">1</div>
                    <div>Gamebook Reference</div>
                </div>
            </div>
            
            <div class="button-container">
                <button onclick="showInventory()">INVENTORY (<span id="inventory-count">0</span>/10)</button>
                <button onclick="showPowers()">VAMPIRIC POWERS</button>
                <button onclick="rollDice()">ROLL DICE</button>
                <button onclick="testLuck()">TEST LUCK</button>
            </div>
            
            <div class="game-text" id="game-text">
                <!-- Game text will be added here dynamically -->
            </div>
            
            <div class="button-container" id="action-buttons">
                <!-- Action buttons will be added here dynamically -->
            </div>
            
            <div id="dice-results" style="display:none;">
                <!-- Dice results will appear here -->
            </div>
        </div>
        
        <!-- Inventory Screen -->
        <div id="inventory-screen" class="screen">
            <h2>INVENTORY</h2>
            <div class="game-text">
                <h3>EQUIPMENT (<span id="total-items">0</span>/10 slots)</h3>
                <div class="inventory" id="inventory-items">
                    <!-- Inventory items will appear here -->
                </div>
                
                <h3>WEAPONS (Equipped)</h3>
                <div id="equipped-weapons">
                    <!-- Equipped weapons will appear here -->
                </div>
                
                <h3>SPECIAL ITEMS</h3>
                <div id="special-items">
                    <!-- Special items will appear here -->
                </div>
                
                <h3>PROVISIONS</h3>
                <div id="provisions">
                    <!-- Provisions will appear here -->
                </div>
            </div>
            <div class="button-container">
                <button onclick="showGameScreen()">RETURN TO GAME</button>
                <button onclick="useHealing()">USE HEALING (if available)</button>
            </div>
        </div>
        
        <!-- Powers Screen -->
        <div id="powers-screen" class="screen">
            <h2>VAMPIRIC POWERS</h2>
            <div class="game-text">
                <p>Blood Points: <span class="stat-value" id="blood-points-display">5</span></p>
                <p>Spend 1 Blood Point to use a power. Regain 1 Blood Point by drinking blood from a victim.</p>
                
                <div class="button-container">
                    <button onclick="usePower('hypnotic_gaze')" id="power-hypnotic">HYPNOTIC GAZE (Cost: 1)</button>
                    <button onclick="usePower('shadow_form')" id="power-shadow">SHADOW FORM (Cost: 1)</button>
                    <button onclick="usePower('bat_swarm')" id="power-bat">BAT SWARM (Cost: 1)</button>
                    <button onclick="usePower('blood_drain')" id="power-drain">BLOOD DRAIN (Cost: 0, combat)</button>
                    <button onclick="usePower('mist_form')" id="power-mist">MIST FORM (Cost: 2)</button>
                    <button onclick="usePower('animal_call')" id="power-animal">ANIMAL CALL (Cost: 1)</button>
                </div>
                
                <h3>POWER DESCRIPTIONS</h3>
                <p><strong>Hypnotic Gaze:</strong> Test Skill vs target's Skill. If successful, they obey one command.</p>
                <p><strong>Shadow Form:</strong> Become shadows for 3 turns. +4 to escape rolls.</p>
                <p><strong>Bat Swarm:</strong> Transform into bats. Fly over obstacles or confuse enemies.</p>
                <p><strong>Blood Drain:</strong> In combat, restore 2 Stamina if you hit.</p>
                <p><strong>Mist Form:</strong> Become intangible. Pass through bars or under doors.</p>
                <p><strong>Animal Call:</strong> Summon wolves or bats to aid you.</p>
            </div>
            <div class="button-container">
                <button onclick="showGameScreen()">RETURN TO GAME</button>
            </div>
        </div>
        
        <!-- Combat Screen -->
        <div id="combat-screen" class="screen">
            <h2>COMBAT!</h2>
            <div class="game-text combat-screen" id="combat-text">
                <!-- Combat text will appear here -->
            </div>
            
            <div class="stats-container">
                <div class="stat-item">
                    <h3>YOUR STAMINA</h3>
                    <div class="stat-value" id="combat-player-stamina">0</div>
                    <div class="health-bar">
                        <div id="player-combat-bar" class="health-fill health-fill-player" style="width: 100%"></div>
                    </div>
                </div>
                <div class="stat-item">
                    <h3>ENEMY STAMINA</h3>
                    <div class="stat-value" id="combat-enemy-stamina">0</div>
                    <div class="health-bar">
                        <div id="enemy-combat-bar" class="health-fill" style="width: 100%"></div>
                    </div>
                </div>
            </div>
            
            <div id="combat-round">
                <!-- Combat round info will appear here -->
            </div>
            
            <div class="button-container" id="combat-actions">
                <!-- Combat actions will appear here -->
            </div>
        </div>
        
        <!-- Game Over Screen -->
        <div id="gameover-screen" class="screen">
            <h2>YOUR ADVENTURE HAS ENDED</h2>
            <div class="game-text" id="gameover-text">
                <!-- Game over text will appear here -->
            </div>
            <div class="button-container">
                <button onclick="restartGame()">TRY AGAIN</button>
            </div>
        </div>
        
        <!-- Victory Screen -->
        <div id="victory-screen" class="screen">
            <h2>VICTORY!</h2>
            <div class="game-text" id="victory-text">
                <!-- Victory text will appear here -->
            </div>
            <div class="button-container">
                <button onclick="restartGame()">PLAY AGAIN</button>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>DRACULA'S REDEMPTION - FIGHTING FANTASY STYLE GAMEBOOK ADVENTURE</p>
        <p>Roll dice, test your Skill and Luck, and survive the horrors of Transylvania!</p>
    </div>

    <script>
        // Gamebook Adventure State
        const gameState = {
            screen: 'start',
            stats: {
                initialStamina: 0,
                stamina: 0,
                maxStamina: 0,
                initialSkill: 0,
                skill: 0,
                skillBonus: 0,
                initialLuck: 0,
                luck: 0,
                bloodPoints: 5,
                maxBloodPoints: 10
            },
            inventory: [],
            equippedWeapon: null,
            armor: null,
            currentSection: 1,
            visitedSections: [],
            combat: {
                active: false,
                enemy: null,
                enemyStamina: 0,
                round: 1,
                playerRoll: 0,
                enemyRoll: 0
            },
            dice: {
                value1: 0,
                value2: 0,
                total: 0
            },
            gameOver: false,
            victory: false,
            bonusPoints: 6,
            selectedEquipment: []
        };
        
        // Gamebook Sections (like a Fighting Fantasy book)
        const sections = {
            1: {
                text: "You awaken in your coffin as the blood moon rises. The centuries of sleep have left you weakened, but the ancient hunger returns. Through the castle window, you see lights in the village below. Do you:",
                options: [
                    { text: "Remain in the castle and explore your ancestral home", goto: 2, test: null },
                    { text: "Fly to the village as a bat to feed", goto: 3, test: null },
                    { text: "Use your hypnotic powers to call a victim to the castle", goto: 4, test: { type: "skill", difficulty: 10 } }
                ]
            },
            2: {
                text: "The castle is vast and filled with ancient secrets. Dust covers everything. In the main hall, you find three doors. The left door bears the symbol of a wolf. The center door has a dragon crest. The right door shows a crescent moon. Which do you choose?",
                options: [
                    { text: "The wolf door", goto: 5, test: null },
                    { text: "The dragon door", goto: 6, test: null },
                    { text: "The moon door", goto: 7, test: null },
                    { text: "Return to the coffin chamber", goto: 1, test: null }
                ]
            },
            3: {
                text: "You transform into a bat and fly toward the village. As you approach, you see a lone traveler on the road below, and a carriage approaching from the opposite direction. Do you:",
                options: [
                    { text: "Attack the lone traveler", goto: 8, test: null },
                    { text: "Investigate the carriage", goto: 9, test: { type: "skill", difficulty: 9 } },
                    { text: "Continue to the village square", goto: 10, test: null }
                ]
            },
            4: {
                text: "You concentrate your vampiric will, sending a mental call into the night. Roll 2D6 and add your Skill. If the total is 10 or more, turn to 11. If 9 or less, turn to 12.",
                options: [
                    { text: "Roll 2D6 + Skill", goto: 11, test: { type: "skill", target: 10 } },
                    { text: "The attempt fails", goto: 12, test: { type: "autoFail" } }
                ]
            },
            5: {
                text: "The wolf door leads to a trophy room filled with hunting relics. Among them, you find a SILVER DAGGER (add to inventory). On the wall hangs a WOLF PELT CLOAK that might offer protection. Suddenly, you hear growling from a shadowed corner! A WEREWOLF attacks!",
                options: [
                    { text: "Fight the werewolf", goto: 20, combat: "werewolf" },
                    { text: "Use Wolfsbane if you have it", goto: 21, test: { type: "item", item: "wolfsbane" } },
                    { text: "Flee back to the hall", goto: 2, test: { type: "skill", difficulty: 8 } }
                ]
            },
            6: {
                text: "The dragon door opens to a library filled with ancient books. Dust flies as you enter. One book on a pedestal glows with a faint light. As you approach, a SPIKE TRAP activates! Test your Skill to avoid it.",
                options: [
                    { text: "Test Skill to dodge", goto: 13, test: { type: "skill", difficulty: 10 } },
                    { text: "Use Mist Form to avoid damage", goto: 14, test: { type: "power", power: "mist_form" } },
                    { text: "Accept the damage", goto: 15, test: null }
                ]
            },
            7: {
                text: "The moon door reveals an alchemy laboratory. Strange potions bubble on tables. You see three vials: red, blue, and green. A note says 'One grants strength, one grants wisdom, one is poison.' Which do you drink?",
                options: [
                    { text: "Red potion", goto: 16, test: null },
                    { text: "Blue potion", goto: 17, test: null },
                    { text: "Green potion", goto: 18, test: null },
                    { text: "Leave them all", goto: 2, test: null }
                ]
            },
            8: {
                text: "You descend upon the traveler, but as you land, you realize it's VAN HELSING, the vampire hunter! He was waiting for you! 'At last, demon! Your reign ends tonight!' He draws a silver sword and a cross.",
                options: [
                    { text: "Fight Van Helsing", goto: 30, combat: "van_helsing" },
                    { text: "Flee as bats", goto: 31, test: { type: "skill", difficulty: 12 } },
                    { text: "Try to hypnotize him", goto: 32, test: { type: "skill", difficulty: 14 } }
                ]
            },
            9: {
                text: "You land silently on the carriage roof. Peering inside, you see a young woman in a white dress. She looks out the window, her face pale and beautiful. She seems to sense your presence. 'Who's there?' she whispers.",
                options: [
                    { text: "Reveal yourself", goto: 33, test: null },
                    { text: "Use Hypnotic Gaze through the window", goto: 34, test: { type: "skill", difficulty: 9 } },
                    { text: "Fly away", goto: 3, test: null }
                ]
            },
            10: {
                text: "The village square is empty except for a fountain and a gallows. Three buildings surround the square: the TAVERN with light and noise, the CHURCH dark and silent, and the MAYOR'S HOUSE with a single lit window. Where do you go?",
                options: [
                    { text: "The tavern", goto: 40, test: null },
                    { text: "The church", goto: 41, test: null },
                    { text: "The mayor's house", goto: 42, test: null },
                    { text: "Return to the castle", goto: 1, test: null }
                ]
            },
            11: {
                text: "Your mental call is successful! A young villager, entranced, stumbles up the mountain path to the castle gates. He enters willingly. Do you:",
                options: [
                    { text: "Drink his blood (gain 3 Stamina, lose 1 Luck)", goto: 50, test: null },
                    { text: "Turn him into a vampire servant", goto: 51, test: { type: "skill", difficulty: 11 } },
                    { text: "Release him unharmed (gain 1 Luck)", goto: 52, test: null }
                ]
            },
            12: {
                text: "Your powers fail you tonight. The hunger grows painful. Lose 2 Stamina from the effort. Do you:",
                options: [
                    { text: "Try again with more effort", goto: 4, test: null },
                    { text: "Leave the castle to hunt", goto: 3, test: null },
                    { text: "Search the castle for other prey", goto: 2, test: null }
                ]
            },
            13: {
                text: "You leap aside as spikes shoot from the wall! Test your Skill (roll 2D6). If you roll equal to or less than your Skill, turn to 60. If you roll higher, turn to 61.",
                options: [
                    { text: "Test Skill", goto: 60, test: { type: "skill", target: function() { return gameState.stats.skill; } } },
                    { text: "Test automatically fails", goto: 61, test: { type: "autoFail" } }
                ]
            },
            14: {
                text: "You dissolve into mist as the spikes pass harmlessly through you. The glowing book is 'The Necronomicon Vampyrica' - an ancient vampire text. Reading it, you gain 2 Blood Points and learn new powers.",
                effect: { blood: 2 },
                options: [
                    { text: "Continue reading", goto: 62, test: null },
                    { text: "Take the book", goto: 63, test: null },
                    { text: "Leave the library", goto: 2, test: null }
                ]
            },
            15: {
                text: "The spikes impale you! Lose 4 Stamina. If you survive, you find the book is about werewolf lore. It mentions silver weapons are their weakness.",
                effect: { stamina: -4 },
                options: [
                    { text: "Take the book", goto: 63, test: null },
                    { text: "Leave the library", goto: 2, test: null }
                ]
            },
            16: {
                text: "You drink the red potion. It burns as it goes down! Roll 2D6. If you roll 7 or more, turn to 64. If you roll 6 or less, turn to 65.",
                options: [
                    { text: "Roll 2D6", goto: 64, test: { type: "luck", target: 7 } },
                    { text: "Automatic failure", goto: 65, test: { type: "autoFail" } }
                ]
            },
            17: {
                text: "You drink the blue potion. It tastes of blueberries and lightning. Your mind becomes sharper. Gain 2 Skill points permanently!",
                effect: { skill: 2 },
                options: [
                    { text: "Leave the laboratory", goto: 2, test: null }
                ]
            },
            18: {
                text: "You drink the green potion. It tastes of herbs and earth. You feel energy course through your veins. Gain 4 Stamina!",
                effect: { stamina: 4 },
                options: [
                    { text: "Leave the laboratory", goto: 2, test: null }
                ]
            },
            20: {
                text: "WEREWOLF: Skill 9, Stamina 10, Damage 2D6+2. The creature is immune to normal weapons. Silver weapons deal double damage. Wolfsbane causes it to flee. Fight!",
                combat: {
                    enemy: "werewolf",
                    skill: 9,
                    stamina: 10,
                    damage: "2d6+2",
                    weakness: "silver",
                    loot: ["wolf_fang", "silver_amulet"],
                    escape: 2
                }
            },
            21: {
                text: "You throw the Wolfsbane at the creature. It howls in pain and retreats into the shadows. You are safe for now. In the room, you find a SILVER AMULET (add to inventory).",
                effect: { item: "silver_amulet" },
                options: [
                    { text: "Take the amulet and leave", goto: 2, test: null },
                    { text: "Search the room further", goto: 70, test: null }
                ]
            },
            30: {
                text: "VAN HELSING: Skill 12, Stamina 14, Damage 2D6+3. He has holy water (3 uses, 4 damage each) and a silver sword. If you have a crucifix, you can try to repel him. Fight!",
                combat: {
                    enemy: "van_helsing",
                    skill: 12,
                    stamina: 14,
                    damage: "2d6+3",
                    special: "holy_water",
                    loot: ["silver_sword", "holy_symbol"],
                    escape: 6
                }
            },
            31: {
                text: "You transform into a swarm of bats and fly away from Van Helsing. He shoots at you but misses. You escape to the village square.",
                options: [
                    { text: "Go to the village square", goto: 10, test: null },
                    { text: "Return to the castle", goto: 1, test: null }
                ]
            },
            32: {
                text: "You lock eyes with Van Helsing, attempting to hypnotize him. He resists with all his will! Test your Skill at difficulty 14.",
                options: [
                    { text: "Test Skill to hypnotize", goto: 320, test: { type: "skill", difficulty: 14 } },
                    { text: "Give up and fight", goto: 30, test: null }
                ]
            },
            33: {
                text: "You reveal yourself to the woman. She screams and tries to flee. The carriage driver hears and comes to investigate.",
                options: [
                    { text: "Attack the driver", goto: 330, test: null },
                    { text: "Flee as bats", goto: 31, test: null }
                ]
            },
            34: {
                text: "You use your Hypnotic Gaze on the woman. She falls into a trance. Do you:",
                options: [
                    { text: "Drink her blood", goto: 50, test: null },
                    { text: "Command her to come with you", goto: 340, test: null }
                ]
            },
            40: {
                text: "The tavern is filled with villagers drinking and singing. They fall silent as you enter. A large man stands up. 'We don't serve your kind here, stranger.' Do you:",
                options: [
                    { text: "Use Hypnotic Gaze on the crowd", goto: 80, test: { type: "skill", difficulty: 11 } },
                    { text: "Leave peacefully", goto: 10, test: null },
                    { text: "Attack the largest man", goto: 81, combat: "tavern_brawler" }
                ]
            },
            41: {
                text: "The church is dark and silent. You sense holy power here. There is a font of holy water and a silver cross on the altar. Do you:",
                options: [
                    { text: "Take the holy water", goto: 410, test: null },
                    { text: "Take the silver cross", goto: 411, test: null },
                    { text: "Leave the church", goto: 10, test: null }
                ]
            },
            42: {
                text: "You approach the mayor's house. Through the window, you see the mayor counting gold coins. He looks up and sees you! He draws a pistol and shoots!",
                options: [
                    { text: "Dodge the bullet", goto: 420, test: { type: "skill", difficulty: 12 } },
                    { text: "Use Mist Form", goto: 421, test: { type: "power", power: "mist_form" } },
                    { text: "Take the bullet", goto: 422, test: null }
                ]
            },
            50: {
                text: "You drink deeply, restoring your strength. Gain 3 Stamina, but lose 1 Luck for killing an innocent. The body must be disposed of. Do you:",
                effect: { stamina: 3, luck: -1 },
                options: [
                    { text: "Bury it in the castle crypt", goto: 90, test: null },
                    { text: "Throw it from the castle walls", goto: 91, test: null },
                    { text: "Leave it for others to find", goto: 92, test: null }
                ]
            },
            51: {
                text: "You use your vampiric powers to turn the villager into a vampire servant. He will obey your commands. Gain a SERVANT (can help in combat, +1 Skill).",
                effect: { skill: 1 },
                options: [
                    { text: "Continue", goto: 90, test: null }
                ]
            },
            52: {
                text: "You release the villager, showing mercy. He runs away, grateful. Gain 2 Luck.",
                effect: { luck: 2 },
                options: [
                    { text: "Continue", goto: 90, test: null }
                ]
            },
            60: {
                text: "You dodge successfully! The spikes clatter to the floor harmlessly. The glowing book contains ancient vampire secrets. Gain 1 Skill point and 2 Blood Points.",
                effect: { skill: 1, blood: 2 },
                options: [
                    { text: "Take the book", goto: 63, test: null },
                    { text: "Leave the library", goto: 2, test: null }
                ]
            },
            61: {
                text: "You're too slow! The spikes tear into you. Lose 3 Stamina. The book is knocked from its pedestal and opens to a page about 'The Cure for Vampirism.'",
                effect: { stamina: -3 },
                options: [
                    { text: "Read about the cure", goto: 100, test: null },
                    { text: "Ignore it and leave", goto: 2, test: null }
                ]
            },
            62: {
                text: "You read more of the ancient book. It tells of a cure for vampirism, but also of great dark powers. You gain 2 Blood Points and 1 Skill point.",
                effect: { blood: 2, skill: 1 },
                options: [
                    { text: "Take the book", goto: 63, test: null },
                    { text: "Leave the book", goto: 2, test: null }
                ]
            },
            63: {
                text: "You take the ancient book. It feels heavy with dark knowledge. This could be useful in your quest. The library has nothing else of interest, so you return to the main hall.",
                effect: { item: "ancient_tome" },
                options: [
                    { text: "Return to the main hall", goto: 2, test: null }
                ]
            },
            64: {
                text: "The potion was a Strength elixir! You feel power coursing through your veins. Gain 2 Skill points permanently!",
                effect: { skill: 2 },
                options: [
                    { text: "Leave the laboratory", goto: 2, test: null }
                ]
            },
            65: {
                text: "The potion was poison! You convulse in pain. Lose 4 Stamina. If you survive, you stumble out of the laboratory.",
                effect: { stamina: -4 },
                options: [
                    { text: "Stagger back to the main hall", goto: 2, test: null }
                ]
            },
            70: {
                text: "You search the werewolf room thoroughly. In a hidden compartment, you find a SILVER BULLET. It could be used in a firearm.",
                effect: { item: "silver_bullet" },
                options: [
                    { text: "Leave the room", goto: 2, test: null }
                ]
            },
            80: {
                text: "You hypnotize the entire tavern. They all fall under your spell. You feed on several of them, gaining 4 Stamina and 2 Blood Points, but lose 2 Luck for harming so many.",
                effect: { stamina: 4, blood: 2, luck: -2 },
                options: [
                    { text: "Leave the tavern", goto: 10, test: null }
                ]
            },
            81: {
                text: "You attack the tavern brawler. He is strong and angry!",
                combat: {
                    enemy: "tavern_brawler",
                    skill: 8,
                    stamina: 12,
                    damage: "2d6+1",
                    loot: ["iron_key"],
                    escape: 3
                }
            },
            90: {
                text: "You bury the body in the castle crypt. The act is respectful and may please dark forces. Gain 1 Luck.",
                effect: { luck: 1 },
                options: [
                    { text: "Return to the castle", goto: 2, test: null }
                ]
            },
            91: {
                text: "You throw the body from the castle walls. It will be found by villagers, who will become angry and afraid. Lose 1 Luck.",
                effect: { luck: -1 },
                options: [
                    { text: "Return to the castle", goto: 2, test: null }
                ]
            },
            92: {
                text: "You leave the body where it is. It will be found by your other servants and disposed of. No consequence.",
                options: [
                    { text: "Return to the castle", goto: 2, test: null }
                ]
            },
            100: {
                text: "The text describes a ritual requiring three items: Holy Water from a blessed font, Garlic from a virgin's garden, and the Blood of a Willing Sacrifice. If performed under a new moon, it can restore a vampire's humanity. Do you:",
                options: [
                    { text: "Seek the cure ingredients", goto: 101, test: null },
                    { text: "Reject the cure as weakness", goto: 102, test: null },
                    { text: "Destroy the book", goto: 103, test: null }
                ]
            },
            101: {
                text: "You decide to seek the cure. This path will be difficult, but redemption may be possible. Your adventure continues...",
                options: [
                    { text: "Continue your quest", goto: 201, test: null }
                ]
            },
            102: {
                text: "You reject humanity and embrace your vampiric nature fully. Power is your only desire now.",
                options: [
                    { text: "Embrace the darkness", goto: 202, test: null }
                ]
            },
            103: {
                text: "You destroy the book, rejecting the cure. You feel your vampiric powers grow stronger. Gain 3 Blood Points and 2 Skill points.",
                effect: { blood: 3, skill: 2 },
                options: [
                    { text: "Continue your dark path", goto: 202, test: null }
                ]
            },
            201: {
                text: "CONGRATULATIONS! You have chosen the path of redemption. Though difficult, you have begun the journey to reclaim your humanity. Your adventure will continue in the next installment...",
                victory: true
            },
            202: {
                text: "CONGRATULATIONS! You have embraced ultimate darkness. As Lord of Vampires, you will rule the night for eternity. Your reign begins now!",
                victory: true
            },
            320: {
                text: "You overpower Van Helsing's mind! He becomes your thrall. With him by your side, you gain a powerful ally. You may now use him in combat (gain +2 Skill in all combats).",
                effect: { skill: 2 },
                options: [
                    { text: "Continue your adventure", goto: 10, test: null }
                ]
            },
            330: {
                text: "The driver is a burly man with a whip. He attacks you!",
                combat: {
                    enemy: "carriage_driver",
                    skill: 7,
                    stamina: 8,
                    damage: "2d6+1",
                    loot: ["whip", "gold_coins"],
                    escape: 3
                }
            },
            340: {
                text: "The woman becomes your obedient servant. She may be useful in the future. You take her to the castle.",
                effect: { item: "servant" },
                options: [
                    { text: "Return to the castle", goto: 1, test: null }
                ]
            },
            410: {
                text: "You take the holy water. It burns your hand slightly, but you manage to bottle it. Add HOLY WATER (3 uses) to your inventory.",
                effect: { item: "holy_water" },
                options: [
                    { text: "Leave the church", goto: 10, test: null }
                ]
            },
            411: {
                text: "You take the silver cross. It is a powerful holy symbol. Add HOLY SYMBOL to your inventory.",
                effect: { item: "holy_symbol" },
                options: [
                    { text: "Leave the church", goto: 10, test: null }
                ]
            },
            420: {
                text: "You dodge the bullet and leap through the window. The mayor is defenseless. Do you:",
                options: [
                    { text: "Drink his blood", goto: 50, test: null },
                    { text: "Hypnotize him", goto: 51, test: null }
                ]
            },
            421: {
                text: "You turn to mist and the bullet passes through you. The mayor is terrified. You materialize and grab him.",
                options: [
                    { text: "Drink his blood", goto: 50, test: null },
                    { text: "Hypnotize him", goto: 51, test: null }
                ]
            },
            422: {
                text: "The bullet hits you! Lose 4 Stamina. If you survive, the mayor reloads. Do you:",
                effect: { stamina: -4 },
                options: [
                    { text: "Attack before he reloads", goto: 420, test: null },
                    { text: "Flee", goto: 10, test: null }
                ]
            }
        };
        
        // Enemies for Combat
        const enemies = {
            werewolf: {
                name: "WEREWOLF",
                description: "A half-man, half-wolf creature with razor-sharp claws.",
                skill: 9,
                stamina: 10,
                damage: "2d6+2",
                weakness: "silver",
                loot: ["wolf_fang", "silver_amulet"]
            },
            van_helsing: {
                name: "VAN HELSING",
                description: "The legendary vampire hunter, armed with holy relics.",
                skill: 12,
                stamina: 14,
                damage: "2d6+3",
                special: "holy_water",
                loot: ["silver_sword", "holy_symbol"]
            },
            tavern_brawler: {
                name: "TAVERN BRAWLER",
                description: "A huge villanger with fists like hams.",
                skill: 8,
                stamina: 12,
                damage: "2d6+1",
                loot: ["iron_key"]
            },
            carriage_driver: {
                name: "CARRIAGE DRIVER",
                description: "A strong man with a whip.",
                skill: 7,
                stamina: 8,
                damage: "2d6+1",
                loot: ["whip", "gold_coins"]
            }
        };
        
        // Items
        const items = {
            silver_dagger: {
                name: "Silver Dagger",
                description: "+1 Skill in combat. Effective against werewolves.",
                type: "weapon",
                bonus: 1,
                slots: 1
            },
            holy_water: {
                name: "Holy Water",
                description: "3 uses. Does 4 damage to undead.",
                type: "consumable",
                uses: 3,
                slots: 1
            },
            garlic_charm: {
                name: "Garlic Charm",
                description: "Protects against vampires. Can be used as weapon.",
                type: "special",
                slots: 1
            },
            healing_potion: {
                name: "Healing Potion",
                description: "Restores 4 Stamina when drunk.",
                type: "consumable",
                effect: 4,
                slots: 1
            },
            lantern: {
                name: "Brass Lantern",
                description: "Lights dark areas. Can blind enemies.",
                type: "tool",
                slots: 2
            },
            lockpicks: {
                name: "Lockpicks",
                description: "+2 Skill when picking locks or disarming traps.",
                type: "tool",
                bonus: 2,
                slots: 1
            },
            wolfsbane: {
                name: "Wolfsbane",
                description: "Causes werewolves to flee. One use.",
                type: "consumable",
                slots: 1
            },
            thieves_tools: {
                name: "Thieves' Tools",
                description: "Allows picking of complex locks.",
                type: "tool",
                slots: 2
            },
            silver_amulet: {
                name: "Silver Amulet",
                description: "Protects against curses. Worth 50 gold.",
                type: "treasure",
                slots: 1
            },
            wolf_fang: {
                name: "Wolf Fang",
                description: "Trophy from a werewolf. Can be made into necklace.",
                type: "treasure",
                slots: 1
            },
            silver_sword: {
                name: "Silver Sword",
                description: "+2 Skill in combat. Holy blessing.",
                type: "weapon",
                bonus: 2,
                slots: 2
            },
            holy_symbol: {
                name: "Holy Symbol",
                description: "Repels undead. Can be used as focus.",
                type: "special",
                slots: 1
            },
            iron_key: {
                name: "Iron Key",
                description: "Opens the castle dungeon.",
                type: "key",
                slots: 1
            },
            ancient_tome: {
                name: "Ancient Tome",
                description: "Contains vampire secrets. May be valuable.",
                type: "book",
                slots: 2
            },
            whip: {
                name: "Whip",
                description: "A leather whip. Can be used as a weapon (+0 Skill).",
                type: "weapon",
                bonus: 0,
                slots: 2
            },
            gold_coins: {
                name: "Gold Coins",
                description: "A bag of 50 gold coins. Useful for bribes.",
                type: "treasure",
                slots: 1
            },
            silver_bullet: {
                name: "Silver Bullet",
                description: "A single silver bullet. Can be used in a firearm.",
                type: "ammo",
                slots: 1
            },
            servant: {
                name: "Servant",
                description: "A loyal servant. Helps in combat (+1 Skill).",
                type: "follower",
                bonus: 1,
                slots: 0
            }
        };
        
        // Initialize Game
        function initGame() {
            document.getElementById('start-btn').addEventListener('click', showCharacterScreen);
            document.getElementById('rules-btn').addEventListener('click', showRulesScreen);
            
            console.log("Gamebook adventure initialized");
        }
        
        // Show Start Screen
        function showStartScreen() {
            hideAllScreens();
            document.getElementById('start-screen').classList.add('active');
            gameState.screen = 'start';
        }
        
        // Show Rules Screen
        function showRulesScreen() {
            hideAllScreens();
            document.getElementById('rules-screen').classList.add('active');
            gameState.screen = 'rules';
        }
        
        // Show Character Screen
        function showCharacterScreen() {
            hideAllScreens();
            document.getElementById('character-screen').classList.add('active');
            gameState.screen = 'character';
            
            // Reset selected equipment
            gameState.selectedEquipment = [];
            document.getElementById('selected-equipment').innerHTML = "";
            updateBeginButtonState();
            
            console.log("Character screen shown");
        }
        
        // Hide all screens
        function hideAllScreens() {
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => {
                screen.classList.remove('active');
            });
        }
        
        // Roll Stat Dice
        function rollStat(stat) {
            const dice1 = Math.floor(Math.random() * 6) + 1;
            const dice2 = Math.floor(Math.random() * 6) + 1;
            const total = dice1 + dice2;
            
            let baseValue = 0;
            if (stat === 'stamina') {
                baseValue = total + 12; // 2D6 + 12 for Stamina
            } else {
                baseValue = total + 6; // 2D6 + 6 for Skill and Luck
            }
            
            // Update display
            document.getElementById(`${stat}-roll`).textContent = `${dice1}+${dice2} = ${total} + ${baseValue - total} = ${baseValue}`;
            
            // Update stat value
            gameState.stats[`initial${stat.charAt(0).toUpperCase() + stat.slice(1)}`] = baseValue;
            gameState.stats[stat] = baseValue;
            
            if (stat === 'stamina') {
                gameState.stats.maxStamina = baseValue;
            }
            
            document.getElementById(`${stat}-value`).textContent = baseValue;
            
            // Update bonus points display
            updateBonusPoints();
            updateBeginButtonState();
            
            console.log(`Rolled ${stat}: ${baseValue}`);
        }
        
        // Adjust Stat with Bonus Points
        function adjustStat(stat, change) {
            if (change > 0 && gameState.bonusPoints <= 0) {
                return;
            }
            
            // Minimum values
            let minValue = 6;
            if (stat === 'stamina') minValue = 12;
            
            if (change < 0 && gameState.stats[stat] <= minValue) {
                return;
            }
            
            // Maximum values
            let maxValue = 18;
            if (stat === 'stamina') maxValue = 24;
            
            if (change > 0 && gameState.stats[stat] >= maxValue) {
                return;
            }
            
            gameState.stats[stat] += change;
            gameState.bonusPoints -= change;
            
            if (stat === 'stamina') {
                gameState.stats.maxStamina = gameState.stats.stamina;
            }
            
            document.getElementById(`${stat}-value`).textContent = gameState.stats[stat];
            document.getElementById('bonus-points').textContent = gameState.bonusPoints;
            
            updateBeginButtonState();
            console.log(`${stat} adjusted to ${gameState.stats[stat]}, bonus points: ${gameState.bonusPoints}`);
        }
        
        // Update Bonus Points Display
        function updateBonusPoints() {
            // Calculate used bonus points
            let usedPoints = 0;
            usedPoints += Math.max(0, gameState.stats.stamina - (gameState.stats.initialStamina || 0));
            usedPoints += Math.max(0, gameState.stats.skill - (gameState.stats.initialSkill || 0));
            usedPoints += Math.max(0, gameState.stats.luck - (gameState.stats.initialLuck || 0));
            
            gameState.bonusPoints = 6 - usedPoints;
            document.getElementById('bonus-points').textContent = gameState.bonusPoints;
        }
        
        // Select Starting Equipment
        function selectEquipment(itemId) {
            if (gameState.selectedEquipment.length >= 3 && !gameState.selectedEquipment.includes(itemId)) {
                alert("You can only select 3 starting items!");
                return;
            }
            
            if (gameState.selectedEquipment.includes(itemId)) {
                // Remove if already selected
                const index = gameState.selectedEquipment.indexOf(itemId);
                gameState.selectedEquipment.splice(index, 1);
            } else {
                // Add if not already selected
                gameState.selectedEquipment.push(itemId);
            }
            
            // Update display
            const equipmentDiv = document.getElementById('selected-equipment');
            equipmentDiv.innerHTML = "";
            
            gameState.selectedEquipment.forEach(itemId => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'item';
                itemDiv.textContent = items[itemId].name;
                equipmentDiv.appendChild(itemDiv);
            });
            
            updateBeginButtonState();
        }
        
        // Update Begin Button State
        function updateBeginButtonState() {
            const beginBtn = document.getElementById('begin-btn');
            const isValid = 
                gameState.stats.stamina >= 12 &&
                gameState.stats.skill >= 6 &&
                gameState.stats.luck >= 6 &&
                gameState.selectedEquipment.length === 3 &&
                gameState.bonusPoints === 0;
            
            beginBtn.disabled = !isValid;
            console.log(`Begin button validation: Stamina=${gameState.stats.stamina >= 12}, Skill=${gameState.stats.skill >= 6}, Luck=${gameState.stats.luck >= 6}, Equipment=${gameState.selectedEquipment.length === 3}, BonusPoints=${gameState.bonusPoints === 0}, Valid=${isValid}`);
        }
        
        // Start Game
        function startGame() {
            console.log("startGame function called");
            
            // Final validation
            if (gameState.stats.stamina < 12) {
                alert("Minimum Stamina not met: Need at least 12!");
                console.log("Stamina check failed:", gameState.stats.stamina);
                return;
            }
            
            if (gameState.stats.skill < 6) {
                alert("Minimum Skill not met: Need at least 6!");
                console.log("Skill check failed:", gameState.stats.skill);
                return;
            }
            
            if (gameState.stats.luck < 6) {
                alert("Minimum Luck not met: Need at least 6!");
                console.log("Luck check failed:", gameState.stats.luck);
                return;
            }
            
            if (gameState.selectedEquipment.length !== 3) {
                alert("You must select exactly 3 starting items!");
                console.log("Equipment check failed:", gameState.selectedEquipment.length);
                return;
            }
            
            if (gameState.bonusPoints !== 0) {
                alert("You must use all 6 bonus points!");
                console.log("Bonus points check failed:", gameState.bonusPoints);
                return;
            }
            
            console.log("Starting gamebook adventure with stats:", gameState.stats);
            
            // Set initial inventory
            gameState.inventory = [...gameState.selectedEquipment];
            
            // Update game screen stats
            document.getElementById('current-stamina').textContent = gameState.stats.stamina;
            document.getElementById('current-skill').textContent = gameState.stats.skill;
            document.getElementById('current-luck').textContent = gameState.stats.luck;
            document.getElementById('current-blood').textContent = gameState.stats.bloodPoints;
            document.getElementById('current-section').textContent = gameState.currentSection;
            
            // Update stamina bar
            updateStaminaBar();
            
            // Update inventory count
            updateInventoryCount();
            
            // Switch to game screen
            hideAllScreens();
            document.getElementById('game-screen').classList.add('active');
            gameState.screen = 'game';
            
            // Start at section 1
            showSection(1);
        }
        
        // Show Gamebook Section
        function showSection(sectionNumber) {
            gameState.currentSection = sectionNumber;
            gameState.visitedSections.push(sectionNumber);
            
            const section = sections[sectionNumber];
            if (!section) {
                // If section doesn't exist, it's an ending
                handleEnding(sectionNumber);
                return;
            }
            
            document.getElementById('current-section').textContent = sectionNumber;
            
            let html = `<p><span class="section-number">${sectionNumber}.</span> ${section.text}</p>`;
            
            // Apply any effects from previous section
            if (section.effect) {
                applyEffect(section.effect);
            }
            
            // Check for combat
            if (section.combat) {
                document.getElementById('game-text').innerHTML = html;
                startCombat(section.combat);
                return;
            }
            
            // Check for victory
            if (section.victory) {
                showVictory(section.text);
                return;
            }
            
            document.getElementById('game-text').innerHTML = html;
            
            // Create option buttons
            const buttonContainer = document.getElementById('action-buttons');
            buttonContainer.innerHTML = "";
            
            if (section.options) {
                section.options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.textContent = option.text;
                    
                    // Handle test requirements
                    if (option.test) {
                        button.onclick = () => handleTest(option.test, option.goto);
                    } else if (option.combat) {
                        button.onclick = () => {
                            document.getElementById('game-text').innerHTML = html;
                            startCombat(option.combat);
                        };
                    } else {
                        button.onclick = () => showSection(option.goto);
                    }
                    
                    buttonContainer.appendChild(button);
                });
            }
            
            // Add inventory button
            const inventoryButton = document.createElement('button');
            inventoryButton.textContent = "CHECK INVENTORY";
            inventoryButton.onclick = showInventory;
            buttonContainer.appendChild(inventoryButton);
            
            // Add dice roller button
            const diceButton = document.createElement('button');
            diceButton.textContent = "ROLL DICE";
            diceButton.onclick = rollDice;
            buttonContainer.appendChild(diceButton);
        }
        
        // Apply Section Effect
        function applyEffect(effect) {
            let message = "";
            
            if (effect.stamina) {
                gameState.stats.stamina += effect.stamina;
                gameState.stats.stamina = Math.min(gameState.stats.stamina, gameState.stats.maxStamina);
                if (gameState.stats.stamina <= 0) {
                    gameOver("Your Stamina has reached 0!");
                    return;
                }
                updateStaminaBar();
                message += ` Stamina ${effect.stamina > 0 ? '+' : ''}${effect.stamina}.`;
            }
            
            if (effect.skill) {
                gameState.stats.skill += effect.skill;
                document.getElementById('current-skill').textContent = gameState.stats.skill;
                message += ` Skill ${effect.skill > 0 ? '+' : ''}${effect.skill}.`;
            }
            
            if (effect.luck) {
                gameState.stats.luck += effect.luck;
                document.getElementById('current-luck').textContent = gameState.stats.luck;
                message += ` Luck ${effect.luck > 0 ? '+' : ''}${effect.luck}.`;
            }
            
            if (effect.blood) {
                gameState.stats.bloodPoints += effect.blood;
                gameState.stats.bloodPoints = Math.min(gameState.stats.bloodPoints, gameState.stats.maxBloodPoints);
                document.getElementById('current-blood').textContent = gameState.stats.bloodPoints;
                message += ` Blood Points ${effect.blood > 0 ? '+' : ''}${effect.blood}.`;
            }
            
            if (effect.item) {
                if (!gameState.inventory.includes(effect.item)) {
                    gameState.inventory.push(effect.item);
                    updateInventoryCount();
                    message += ` Added ${items[effect.item].name} to inventory.`;
                }
            }
            
            if (message) {
                const gameText = document.getElementById('game-text');
                gameText.innerHTML += `<p class="outcome-good">${message}</p>`;
            }
        }
        
        // Handle Skill/Luck Test
        function handleTest(test, successGoto) {
            let html = document.getElementById('game-text').innerHTML;
            
            if (test.type === "skill") {
                html += `<div class="skill-check">`;
                html += `<p>Testing Skill (${gameState.stats.skill})...</p>`;
                
                // Roll 2D6
                const dice1 = Math.floor(Math.random() * 6) + 1;
                const dice2 = Math.floor(Math.random() * 6) + 1;
                const total = dice1 + dice2;
                
                html += `<p>Roll: ${dice1} + ${dice2} = <strong>${total}</strong></p>`;
                
                let success = false;
                if (test.target) {
                    // Roll against target number
                    const target = typeof test.target === 'function' ? test.target() : test.target;
                    success = total <= target;
                    html += `<p>Need ${total} ≤ ${target}: ${success ? 'SUCCESS!' : 'FAILURE!'}</p>`;
                } else if (test.difficulty) {
                    // Roll + Skill vs difficulty
                    const checkTotal = total + gameState.stats.skill;
                    success = checkTotal >= test.difficulty;
                    html += `<p>${total} + Skill ${gameState.stats.skill} = ${checkTotal} vs ${test.difficulty}: ${success ? 'SUCCESS!' : 'FAILURE!'}</p>`;
                }
                
                if (success) {
                    html += `<p class="skill-success">You succeeded!</p>`;
                    document.getElementById('game-text').innerHTML = html;
                    setTimeout(() => showSection(successGoto), 1500);
                } else {
                    html += `<p class="skill-failure">You failed!</p>`;
                    // For now, just show failure
                    document.getElementById('game-text').innerHTML = html;
                    
                    // In a full gamebook, failure would go to a different section
                    const failureButton = document.createElement('button');
                    failureButton.textContent = "CONTINUE";
                    failureButton.onclick = () => showSection(successGoto + 1); // Simple failure handling
                    document.getElementById('action-buttons').innerHTML = "";
                    document.getElementById('action-buttons').appendChild(failureButton);
                }
                
            } else if (test.type === "luck") {
                html += `<div class="skill-check">`;
                html += `<p>Testing Luck (${gameState.stats.luck})...</p>`;
                
                // Roll 2D6
                const dice1 = Math.floor(Math.random() * 6) + 1;
                const dice2 = Math.floor(Math.random() * 6) + 1;
                const total = dice1 + dice2;
                
                html += `<p>Roll: ${dice1} + ${dice2} = <strong>${total}</strong></p>`;
                
                let success = false;
                if (test.target) {
                    // Roll against target number
                    success = total >= test.target;
                    html += `<p>Need ${total} ≥ ${test.target}: ${success ? 'LUCKY!' : 'UNLUCKY!'}</p>`;
                } else {
                    // Roll against Luck score
                    success = total <= gameState.stats.luck;
                    html += `<p>Need ${total} ≤ ${gameState.stats.luck}: ${success ? 'LUCKY!' : 'UNLUCKY!'}</p>`;
                }
                
                // Reduce luck by 1
                gameState.stats.luck--;
                document.getElementById('current-luck').textContent = gameState.stats.luck;
                html += `<p>Your Luck is now ${gameState.stats.luck}</p>`;
                
                if (success) {
                    html += `<p class="skill-success">You are lucky!</p>`;
                    document.getElementById('game-text').innerHTML = html;
                    setTimeout(() => showSection(successGoto), 1500);
                } else {
                    html += `<p class="skill-failure">You are unlucky!</p>`;
                    document.getElementById('game-text').innerHTML = html;
                    
                    const failureButton = document.createElement('button');
                    failureButton.textContent = "CONTINUE";
                    failureButton.onclick = () => showSection(successGoto + 1);
                    document.getElementById('action-buttons').innerHTML = "";
                    document.getElementById('action-buttons').appendChild(failureButton);
                }
                
            } else if (test.type === "item") {
                // Check if player has item
                const hasItem = gameState.inventory.includes(test.item);
                if (hasItem) {
                    html += `<p class="outcome-good">You use the ${items[test.item].name}!</p>`;
                    document.getElementById('game-text').innerHTML = html;
                    setTimeout(() => showSection(successGoto), 1000);
                } else {
                    html += `<p class="outcome-bad">You don't have the required item!</p>`;
                    document.getElementById('game-text').innerHTML = html;
                    
                    const failureButton = document.createElement('button');
                    failureButton.textContent = "CONTINUE";
                    failureButton.onclick = () => showSection(successGoto + 10); // Go to different section
                    document.getElementById('action-buttons').innerHTML = "";
                    document.getElementById('action-buttons').appendChild(failureButton);
                }
            } else if (test.type === "power") {
                // Check if player can use power
                if (gameState.stats.bloodPoints > 0) {
                    gameState.stats.bloodPoints--;
                    document.getElementById('current-blood').textContent = gameState.stats.bloodPoints;
                    html += `<p class="skill-success">You use your vampiric power!</p>`;
                    document.getElementById('game-text').innerHTML = html;
                    setTimeout(() => showSection(successGoto), 1000);
                } else {
                    html += `<p class="outcome-bad">Not enough Blood Points!</p>`;
                    document.getElementById('game-text').innerHTML = html;
                    
                    const failureButton = document.createElement('button');
                    failureButton.textContent = "CONTINUE";
                    failureButton.onclick = () => showSection(successGoto + 5); // Go to different section
                    document.getElementById('action-buttons').innerHTML = "";
                    document.getElementById('action-buttons').appendChild(failureButton);
                }
            } else if (test.type === "autoFail") {
                // Automatic failure
                html += `<p class="skill-failure">The attempt fails!</p>`;
                document.getElementById('game-text').innerHTML = html;
                setTimeout(() => showSection(successGoto), 1000);
            }
        }
        
        // Start Combat
        function startCombat(combatData) {
            gameState.combat.active = true;
            gameState.combat.enemy = combatData.enemy || combatData;
            gameState.combat.round = 1;
            
            const enemy = enemies[gameState.combat.enemy];
            
            // Switch to combat screen
            hideAllScreens();
            document.getElementById('combat-screen').classList.add('active');
            gameState.screen = 'combat';
            
            let html = `<p class="game-over">COMBAT!</p>`;
            html += `<p>You face a ${enemy.name}: ${enemy.description}</p>`;
            html += `<p>Enemy Skill: ${enemy.skill}, Stamina: ${enemy.stamina}</p>`;
            
            if (enemy.weakness) {
                html += `<p class="warning">Weakness: ${enemy.weakness}</p>`;
            }
            
            if (enemy.special) {
                html += `<p class="warning">Special: ${enemy.special}</p>`;
            }
            
            document.getElementById('combat-text').innerHTML = html;
            
            // Set combat stats
            gameState.combat.enemyStamina = enemy.stamina;
            document.getElementById('combat-player-stamina').textContent = gameState.stats.stamina;
            document.getElementById('combat-enemy-stamina').textContent = enemy.stamina;
            
            // Update health bars
            updateCombatBars();
            
            // Show combat actions
            showCombatActions();
        }
        
        // Show Combat Actions
        function showCombatActions() {
            const actionsDiv = document.getElementById('combat-actions');
            actionsDiv.innerHTML = "";
            
            const attackButton = document.createElement('button');
            attackButton.textContent = "ATTACK";
            attackButton.className = 'combat-option';
            attackButton.onclick = combatRound;
            actionsDiv.appendChild(attackButton);
            
            const bloodDrainButton = document.createElement('button');
            bloodDrainButton.textContent = "BLOOD DRAIN (if hit, +2 Stamina)";
            bloodDrainButton.onclick = () => combatRound(true);
            actionsDiv.appendChild(bloodDrainButton);
            
            // Check for special items
            if (hasItem('holy_water') && gameState.combat.enemy === 'van_helsing') {
                const holyButton = document.createElement('button');
                holyButton.textContent = "USE HOLY WATER (4 damage)";
                holyButton.onclick = useHolyWater;
                actionsDiv.appendChild(holyButton);
            }
            
            if (hasItem('silver_dagger') && gameState.combat.enemy === 'werewolf') {
                const silverButton = document.createElement('button');
                silverButton.textContent = "USE SILVER DAGGER (double damage)";
                silverButton.onclick = useSilverWeapon;
                actionsDiv.appendChild(silverButton);
            }
            
            const fleeButton = document.createElement('button');
            fleeButton.textContent = "ATTEMPT TO FLEE";
            fleeButton.onclick = attemptFlee;
            actionsDiv.appendChild(fleeButton);
        }
        
        // Combat Round
        function combatRound(useBloodDrain = false) {
            const enemy = enemies[gameState.combat.enemy];
            let html = document.getElementById('combat-text').innerHTML;
            
            html += `<h3>ROUND ${gameState.combat.round}</h3>`;
            
            // Player attacks
            html += `<p>You attack...</p>`;
            const playerRoll1 = Math.floor(Math.random() * 6) + 1;
            const playerRoll2 = Math.floor(Math.random() * 6) + 1;
            const playerAttack = playerRoll1 + playerRoll2 + gameState.stats.skill + gameState.stats.skillBonus;
            
            html += `<p>Roll: ${playerRoll1} + ${playerRoll2} + Skill ${gameState.stats.skill} = <strong>${playerAttack}</strong></p>`;
            
            // Enemy attacks
            html += `<p>${enemy.name} attacks...</p>`;
            const enemyRoll1 = Math.floor(Math.random() * 6) + 1;
            const enemyRoll2 = Math.floor(Math.random() * 6) + 1;
            const enemyAttack = enemyRoll1 + enemyRoll2 + enemy.skill;
            
            html += `<p>Roll: ${enemyRoll1} + ${enemyRoll2} + Skill ${enemy.skill} = <strong>${enemyAttack}</strong></p>`;
            
            // Determine hit
            if (playerAttack > enemyAttack) {
                // Player hits
                let damage = 0;
                if (gameState.combat.enemy === 'werewolf' && hasItem('silver_dagger')) {
                    // Silver weapon double damage vs werewolves
                    damage = 4;
                    html += `<p class="outcome-good">Your silver weapon strikes true! Damage: ${damage}</p>`;
                } else {
                    damage = Math.floor(Math.random() * 6) + 1 + 2; // 2D6+2 default
                    html += `<p class="outcome-good">You hit for ${damage} damage!</p>`;
                }
                
                gameState.combat.enemyStamina -= damage;
                
                // Blood drain if selected
                if (useBloodDrain) {
                    gameState.stats.stamina = Math.min(gameState.stats.maxStamina, gameState.stats.stamina + 2);
                    html += `<p class="skill-success">Blood drain restores 2 Stamina!</p>`;
                    updateStaminaBar();
                }
                
            } else if (enemyAttack > playerAttack) {
                // Enemy hits
                let damage = 0;
                if (enemy.special === 'holy_water' && Math.random() > 0.7) {
                    damage = 4; // Holy water damage
                    html += `<p class="outcome-bad">${enemy.name} uses holy water! Damage: ${damage}</p>`;
                } else {
                    damage = Math.floor(Math.random() * 6) + 1 + 2; // 2D6+2 default
                    html += `<p class="outcome-bad">${enemy.name} hits for ${damage} damage!</p>`;
                }
                
                gameState.stats.stamina -= damage;
                
            } else {
                // Tie
                html += `<p>Your attacks clash! No damage this round.</p>`;
            }
            
            gameState.combat.round++;
            
            document.getElementById('combat-text').innerHTML = html;
            
            // Update combat bars
            updateCombatBars();
            
            // Check for combat end
            setTimeout(() => checkCombatEnd(), 1000);
        }
        
        // Use Holy Water in Combat
        function useHolyWater() {
            // Find holy water in inventory
            const holyIndex = gameState.inventory.indexOf('holy_water');
            if (holyIndex === -1) return;
            
            let html = document.getElementById('combat-text').innerHTML;
            html += `<p class="skill-success">You throw holy water! 4 damage!</p>`;
            
            gameState.combat.enemyStamina -= 4;
            
            // Reduce uses or remove
            // For simplicity, we'll just remove it
            gameState.inventory.splice(holyIndex, 1);
            updateInventoryCount();
            
            document.getElementById('combat-text').innerHTML = html;
            updateCombatBars();
            
            setTimeout(() => checkCombatEnd(), 1000);
        }
        
        // Use Silver Weapon
        function useSilverWeapon() {
            if (!hasItem('silver_dagger')) return;
            
            let html = document.getElementById('combat-text').innerHTML;
            html += `<p class="skill-success">Silver weapon strikes true! 4 damage!</p>`;
            
            gameState.combat.enemyStamina -= 4;
            
            document.getElementById('combat-text').innerHTML = html;
            updateCombatBars();
            
            setTimeout(() => checkCombatEnd(), 1000);
        }
        
        // Attempt to Flee
        function attemptFlee() {
            let html = document.getElementById('combat-text').innerHTML;
            html += `<p>You attempt to flee...</p>`;
            
            // Roll 2D6 against Skill
            const dice1 = Math.floor(Math.random() * 6) + 1;
            const dice2 = Math.floor(Math.random() * 6) + 1;
            const total = dice1 + dice2;
            
            html += `<p>Roll: ${dice1} + ${dice2} = ${total}. Need ≤ Skill ${gameState.stats.skill}.</p>`;
            
            if (total <= gameState.stats.skill) {
                html += `<p class="outcome-good">You escape!</p>`;
                document.getElementById('combat-text').innerHTML = html;
                
                // Return to game
                setTimeout(() => {
                    endCombat(false);
                    showSection(gameState.currentSection + 1); // Go to next section
                }, 1500);
            } else {
                html += `<p class="outcome-bad">You fail to escape!</p>`;
                document.getElementById('combat-text').innerHTML = html;
                
                // Enemy gets a free attack
                setTimeout(() => {
                    const enemy = enemies[gameState.combat.enemy];
                    const damage = Math.floor(Math.random() * 6) + 1 + 2;
                    
                    html += `<p>${enemy.name} attacks as you flee! ${damage} damage!</p>`;
                    gameState.stats.stamina -= damage;
                    
                    document.getElementById('combat-text').innerHTML = html;
                    updateCombatBars();
                    
                    if (gameState.stats.stamina <= 0) {
                        gameOver("You were defeated in combat!");
                    } else {
                        setTimeout(() => checkCombatEnd(), 1000);
                    }
                }, 1000);
            }
        }
        
        // Update Combat Bars
        function updateCombatBars() {
            // Player stamina bar
            const playerPercent = (gameState.stats.stamina / gameState.stats.maxStamina) * 100;
            document.getElementById('player-combat-bar').style.width = `${playerPercent}%`;
            document.getElementById('combat-player-stamina').textContent = gameState.stats.stamina;
            
            // Enemy stamina bar
            const enemy = enemies[gameState.combat.enemy];
            const enemyPercent = (gameState.combat.enemyStamina / enemy.stamina) * 100;
            document.getElementById('enemy-combat-bar').style.width = `${enemyPercent}%`;
            document.getElementById('combat-enemy-stamina').textContent = gameState.combat.enemyStamina;
            
            // Update main stamina display
            document.getElementById('current-stamina').textContent = gameState.stats.stamina;
            updateStaminaBar();
        }
        
        // Check Combat End
        function checkCombatEnd() {
            if (gameState.stats.stamina <= 0) {
                gameOver("You were defeated in combat!");
                return;
            }
            
            if (gameState.combat.enemyStamina <= 0) {
                // Victory!
                const enemy = enemies[gameState.combat.enemy];
                let html = document.getElementById('combat-text').innerHTML;
                html += `<p class="victory">You defeated the ${enemy.name}!</p>`;
                
                // Award loot
                if (enemy.loot && enemy.loot.length > 0) {
                    html += `<p class="outcome-good">You find: ${enemy.loot.map(item => items[item].name).join(', ')}</p>`;
                    enemy.loot.forEach(item => {
                        if (!gameState.inventory.includes(item)) {
                            gameState.inventory.push(item);
                        }
                    });
                    updateInventoryCount();
                }
                
                // Award Blood Points
                gameState.stats.bloodPoints = Math.min(gameState.stats.maxBloodPoints, gameState.stats.bloodPoints + 2);
                document.getElementById('current-blood').textContent = gameState.stats.bloodPoints;
                html += `<p>Gained 2 Blood Points from the victory!</p>`;
                
                document.getElementById('combat-text').innerHTML = html;
                
                // End combat after delay
                setTimeout(() => {
                    endCombat(true);
                    // Go to next section
                    showSection(gameState.currentSection + 1);
                }, 2000);
            } else {
                // Continue combat
                showCombatActions();
            }
        }
        
        // End Combat
        function endCombat(victory) {
            gameState.combat.active = false;
            
            if (!victory && gameState.stats.stamina <= 0) {
                return; // Game over already handled
            }
            
            // Return to game screen
            hideAllScreens();
            document.getElementById('game-screen').classList.add('active');
            gameState.screen = 'game';
        }
        
        // Check if Player Has Item
        function hasItem(itemId) {
            return gameState.inventory.includes(itemId);
        }
        
        // Show Inventory
        function showInventory() {
            hideAllScreens();
            document.getElementById('inventory-screen').classList.add('active');
            gameState.screen = 'inventory';
            
            // Update total items
            document.getElementById('total-items').textContent = gameState.inventory.length;
            
            // Display inventory items
            const inventoryDiv = document.getElementById('inventory-items');
            inventoryDiv.innerHTML = "";
            
            if (gameState.inventory.length === 0) {
                inventoryDiv.innerHTML = "<p>Your inventory is empty.</p>";
            } else {
                gameState.inventory.forEach(itemId => {
                    if (items[itemId]) {
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'item';
                        itemDiv.innerHTML = `<strong>${items[itemId].name}</strong><br>${items[itemId].description}`;
                        inventoryDiv.appendChild(itemDiv);
                    }
                });
            }
            
            // Display equipped weapon
            const weaponDiv = document.getElementById('equipped-weapons');
            weaponDiv.innerHTML = "";
            
            if (gameState.equippedWeapon) {
                const weapon = items[gameState.equippedWeapon];
                weaponDiv.innerHTML = `<div class="item item-rare"><strong>${weapon.name}</strong><br>${weapon.description}</div>`;
            } else {
                weaponDiv.innerHTML = "<p>No weapon equipped.</p>";
            }
            
            // Display special items
            const specialDiv = document.getElementById('special-items');
            specialDiv.innerHTML = "";
            
            const specialItems = gameState.inventory.filter(itemId => 
                items[itemId] && items[itemId].type === 'special'
            );
            
            if (specialItems.length === 0) {
                specialDiv.innerHTML = "<p>No special items.</p>";
            } else {
                specialItems.forEach(itemId => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'item';
                    itemDiv.innerHTML = `<strong>${items[itemId].name}</strong><br>${items[itemId].description}`;
                    specialDiv.appendChild(itemDiv);
                });
            }
            
            // Display provisions (healing items)
            const provisionsDiv = document.getElementById('provisions');
            provisionsDiv.innerHTML = "";
            
            const healingItems = gameState.inventory.filter(itemId => 
                items[itemId] && items[itemId].type === 'consumable' && itemId.includes('healing')
            );
            
            if (healingItems.length === 0) {
                provisionsDiv.innerHTML = "<p>No healing items.</p>";
            } else {
                healingItems.forEach(itemId => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'item';
                    itemDiv.innerHTML = `<strong>${items[itemId].name}</strong><br>${items[itemId].description}`;
                    provisionsDiv.appendChild(itemDiv);
                });
            }
        }
        
        // Use Healing Item
        function useHealing() {
            const healingIndex = gameState.inventory.findIndex(itemId => 
                items[itemId] && items[itemId].type === 'consumable' && itemId.includes('healing')
            );
            
            if (healingIndex === -1) {
                alert("No healing items available!");
                return;
            }
            
            const healingItem = gameState.inventory[healingIndex];
            const healAmount = items[healingItem].effect || 4;
            
            gameState.stats.stamina = Math.min(gameState.stats.maxStamina, gameState.stats.stamina + healAmount);
            
            // Remove item
            gameState.inventory.splice(healingIndex, 1);
            
            // Update displays
            updateStaminaBar();
            updateInventoryCount();
            showInventory(); // Refresh inventory screen
            
            alert(`Used ${items[healingItem].name}! Restored ${healAmount} Stamina.`);
        }
        
        // Show Powers Screen
        function showPowers() {
            hideAllScreens();
            document.getElementById('powers-screen').classList.add('active');
            gameState.screen = 'powers';
            
            // Update blood points display
            document.getElementById('blood-points-display').textContent = gameState.stats.bloodPoints;
            
            // Enable/disable power buttons based on blood points
            const powers = ['hypnotic_gaze', 'shadow_form', 'bat_swarm', 'mist_form', 'animal_call'];
            powers.forEach(power => {
                const button = document.getElementById(`power-${power.split('_')[0]}`);
                if (button) {
                    if (gameState.stats.bloodPoints >= (power === 'mist_form' ? 2 : 1)) {
                        button.disabled = false;
                    } else {
                        button.disabled = true;
                    }
                }
            });
        }
        
        // Use Vampiric Power
        function usePower(powerId) {
            let cost = 1;
            if (powerId === 'mist_form') cost = 2;
            if (powerId === 'blood_drain') cost = 0; // Only in combat
            
            if (gameState.stats.bloodPoints < cost) {
                alert("Not enough Blood Points!");
                return;
            }
            
            gameState.stats.bloodPoints -= cost;
            document.getElementById('blood-points-display').textContent = gameState.stats.bloodPoints;
            document.getElementById('current-blood').textContent = gameState.stats.bloodPoints;
            
            let message = "";
            switch(powerId) {
                case 'hypnotic_gaze':
                    message = "Your eyes glow crimson. A weak-willed target would obey your commands.";
                    break;
                case 'shadow_form':
                    message = "You become one with the shadows. For the next few minutes, you are nearly invisible.";
                    break;
                case 'bat_swarm':
                    message = "You transform into a swarm of bats! You can fly over obstacles or confuse enemies.";
                    break;
                case 'mist_form':
                    message = "Your body dissolves into mist. You can pass through bars or under doors.";
                    break;
                case 'animal_call':
                    message = "You emit a silent call. Wolves or bats in the area will come to your aid.";
                    break;
            }
            
            alert(`Used ${powerId.replace('_', ' ').toUpperCase()}!\n\n${message}`);
            
            // Return to game
            showGameScreen();
        }
        
        // Show Game Screen
        function showGameScreen() {
            hideAllScreens();
            document.getElementById('game-screen').classList.add('active');
            gameState.screen = 'game';
        }
        
        // Roll Dice (for manual rolling)
        function rollDice() {
            const dice1 = Math.floor(Math.random() * 6) + 1;
            const dice2 = Math.floor(Math.random() * 6) + 1;
            const total = dice1 + dice2;
            
            const diceResults = document.getElementById('dice-results');
            diceResults.style.display = 'block';
            diceResults.innerHTML = `
                <div class="dice-roller">
                    <h3>DICE ROLL</h3>
                    <p>Rolled: ${dice1} and ${dice2}</p>
                    <p class="dice-result">Total: ${total}</p>
                    <p>2D6 = ${total}</p>
                </div>
            `;
            
            // Scroll to results
            diceResults.scrollIntoView({ behavior: 'smooth' });
            
            // Hide after 5 seconds
            setTimeout(() => {
                diceResults.style.display = 'none';
            }, 5000);
        }
        
        // Test Luck
        function testLuck() {
            if (gameState.stats.luck <= 0) {
                alert("Your Luck is 0! You cannot test Luck!");
                return;
            }
            
            const dice1 = Math.floor(Math.random() * 6) + 1;
            const dice2 = Math.floor(Math.random() * 6) + 1;
            const total = dice1 + dice2;
            
            const isLucky = total <= gameState.stats.luck;
            
            // Reduce luck by 1 (win or lose)
            gameState.stats.luck--;
            document.getElementById('current-luck').textContent = gameState.stats.luck;
            
            let message = `You roll: ${dice1} + ${dice2} = ${total}\n`;
            message += `Your Luck is ${gameState.stats.luck + 1}\n`;
            message += `Need ${total} ≤ ${gameState.stats.luck + 1}\n\n`;
            message += isLucky ? 
                "You are LUCKY! Good fortune favors you!" : 
                "You are UNLUCKY! Misfortune strikes!";
            
            alert(message);
            
            // Update luck test display
            document.getElementById('luck-test').textContent = isLucky ? "Lucky!" : "Unlucky!";
        }
        
        // Update Stamina Bar
        function updateStaminaBar() {
            const staminaPercent = (gameState.stats.stamina / gameState.stats.maxStamina) * 100;
            document.getElementById('stamina-bar').style.width = `${staminaPercent}%`;
            document.getElementById('current-stamina').textContent = gameState.stats.stamina;
        }
        
        // Update Inventory Count
        function updateInventoryCount() {
            document.getElementById('inventory-count').textContent = gameState.inventory.length;
        }
        
        // Handle Ending
        function handleEnding(sectionNumber) {
            // Simple ending system
            if (sectionNumber >= 200) {
                // Victory ending
                showVictory(sections[sectionNumber].text || "Congratulations! You have completed your adventure!");
            } else {
                // Game over
                gameOver("Your adventure has reached a dead end at section " + sectionNumber);
            }
        }
        
        // Show Victory
        function showVictory(message) {
            hideAllScreens();
            document.getElementById('victory-screen').classList.add('active');
            
            let victoryText = "<p class='victory'>VICTORY!</p>";
            victoryText += `<p>${message}</p>`;
            victoryText += "<p>Your adventure has reached its conclusion.</p>";
            victoryText += `<p>Final Stats: Stamina ${gameState.stats.stamina}, Skill ${gameState.stats.skill}, Luck ${gameState.stats.luck}</p>`;
            
            document.getElementById('victory-text').innerHTML = victoryText;
        }
        
        // Game Over
        function gameOver(reason) {
            hideAllScreens();
            document.getElementById('gameover-screen').classList.add('active');
            
            let html = `<p class="game-over">GAME OVER</p>`;
            html += `<p>${reason}</p>`;
            html += `<p>You reached section ${gameState.currentSection}</p>`;
            html += `<p>Final Stamina: ${gameState.stats.stamina}</p>`;
            html += `<p>Final Skill: ${gameState.stats.skill}</p>`;
            html += `<p>Final Luck: ${gameState.stats.luck}</p>`;
            html += `<p>Items collected: ${gameState.inventory.length}</p>`;
            
            document.getElementById('gameover-text').innerHTML = html;
        }
        
        // Restart Game
        function restartGame() {
            // Reset game state
            gameState.screen = 'start';
            gameState.stats = {
                initialStamina: 0,
                stamina: 0,
                maxStamina: 0,
                initialSkill: 0,
                skill: 0,
                skillBonus: 0,
                initialLuck: 0,
                luck: 0,
                bloodPoints: 5,
                maxBloodPoints: 10
            };
            gameState.inventory = [];
            gameState.equippedWeapon = null;
            gameState.armor = null;
            gameState.currentSection = 1;
            gameState.visitedSections = [];
            gameState.combat = {
                active: false,
                enemy: null,
                enemyStamina: 0,
                round: 1,
                playerRoll: 0,
                enemyRoll: 0
            };
            gameState.dice = {
                value1: 0,
                value2: 0,
                total: 0
            };
            gameState.gameOver = false;
            gameState.victory = false;
            gameState.bonusPoints = 6;
            gameState.selectedEquipment = [];
            
            // Reset UI displays
            document.getElementById('stamina-roll').textContent = '--';
            document.getElementById('skill-roll').textContent = '--';
            document.getElementById('luck-roll').textContent = '--';
            document.getElementById('stamina-value').textContent = '0';
            document.getElementById('skill-value').textContent = '0';
            document.getElementById('luck-value').textContent = '0';
            document.getElementById('bonus-points').textContent = '6';
            document.getElementById('selected-equipment').innerHTML = '';
            
            // Hide all screens
            hideAllScreens();
            
            // Show start screen
            document.getElementById('start-screen').classList.add('active');
            
            console.log("Game restarted");
        }
        
        // Initialize the game when page loads
        window.onload = initGame;
    </script>
</body>
</html>
